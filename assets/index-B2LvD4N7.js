var s8=e=>{throw TypeError(e)};var dD=(e,t,r)=>t.has(e)||s8("Cannot "+r);var ct=(e,t,r)=>(dD(e,t,"read from private field"),r?r.call(e):t.get(e)),dn=(e,t,r)=>t.has(e)?s8("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Mr=(e,t,r,n)=>(dD(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),Xn=(e,t,r)=>(dD(e,t,"access private method"),r);var D2=(e,t,r,n)=>({set _(l){Mr(e,t,l,r)},get _(){return ct(e,t,n)}});function Gfe(e,t){for(var r=0;r<t.length;r++){const n=t[r];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in e)){const u=Object.getOwnPropertyDescriptor(n,l);u&&Object.defineProperty(e,l,u.get?u:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const f of u.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&n(f)}).observe(document,{childList:!0,subtree:!0});function r(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(l){if(l.ep)return;l.ep=!0;const u=r(l);fetch(l.href,u)}})();var m1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zi(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var UX={exports:{}},sO={},GX={exports:{}},ci={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IT=Symbol.for("react.element"),qfe=Symbol.for("react.portal"),Hfe=Symbol.for("react.fragment"),Wfe=Symbol.for("react.strict_mode"),Zfe=Symbol.for("react.profiler"),Xfe=Symbol.for("react.provider"),Kfe=Symbol.for("react.context"),Yfe=Symbol.for("react.forward_ref"),Jfe=Symbol.for("react.suspense"),Qfe=Symbol.for("react.memo"),epe=Symbol.for("react.lazy"),a8=Symbol.iterator;function tpe(e){return e===null||typeof e!="object"?null:(e=a8&&e[a8]||e["@@iterator"],typeof e=="function"?e:null)}var qX={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},HX=Object.assign,WX={};function cx(e,t,r){this.props=e,this.context=t,this.refs=WX,this.updater=r||qX}cx.prototype.isReactComponent={};cx.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};cx.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ZX(){}ZX.prototype=cx.prototype;function XF(e,t,r){this.props=e,this.context=t,this.refs=WX,this.updater=r||qX}var KF=XF.prototype=new ZX;KF.constructor=XF;HX(KF,cx.prototype);KF.isPureReactComponent=!0;var l8=Array.isArray,XX=Object.prototype.hasOwnProperty,YF={current:null},KX={key:!0,ref:!0,__self:!0,__source:!0};function YX(e,t,r){var n,l={},u=null,f=null;if(t!=null)for(n in t.ref!==void 0&&(f=t.ref),t.key!==void 0&&(u=""+t.key),t)XX.call(t,n)&&!KX.hasOwnProperty(n)&&(l[n]=t[n]);var o=arguments.length-2;if(o===1)l.children=r;else if(1<o){for(var v=Array(o),w=0;w<o;w++)v[w]=arguments[w+2];l.children=v}if(e&&e.defaultProps)for(n in o=e.defaultProps,o)l[n]===void 0&&(l[n]=o[n]);return{$$typeof:IT,type:e,key:u,ref:f,props:l,_owner:YF.current}}function rpe(e,t){return{$$typeof:IT,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function JF(e){return typeof e=="object"&&e!==null&&e.$$typeof===IT}function npe(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var c8=/\/+/g;function hD(e,t){return typeof e=="object"&&e!==null&&e.key!=null?npe(""+e.key):t.toString(36)}function OP(e,t,r,n,l){var u=typeof e;(u==="undefined"||u==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(u){case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case IT:case qfe:f=!0}}if(f)return f=e,l=l(f),e=n===""?"."+hD(f,0):n,l8(l)?(r="",e!=null&&(r=e.replace(c8,"$&/")+"/"),OP(l,t,r,"",function(w){return w})):l!=null&&(JF(l)&&(l=rpe(l,r+(!l.key||f&&f.key===l.key?"":(""+l.key).replace(c8,"$&/")+"/")+e)),t.push(l)),1;if(f=0,n=n===""?".":n+":",l8(e))for(var o=0;o<e.length;o++){u=e[o];var v=n+hD(u,o);f+=OP(u,t,r,v,l)}else if(v=tpe(e),typeof v=="function")for(e=v.call(e),o=0;!(u=e.next()).done;)u=u.value,v=n+hD(u,o++),f+=OP(u,t,r,v,l);else if(u==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return f}function L2(e,t,r){if(e==null)return e;var n=[],l=0;return OP(e,n,"","",function(u){return t.call(r,u,l++)}),n}function ipe(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var xl={current:null},kP={transition:null},ope={ReactCurrentDispatcher:xl,ReactCurrentBatchConfig:kP,ReactCurrentOwner:YF};function JX(){throw Error("act(...) is not supported in production builds of React.")}ci.Children={map:L2,forEach:function(e,t,r){L2(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return L2(e,function(){t++}),t},toArray:function(e){return L2(e,function(t){return t})||[]},only:function(e){if(!JF(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ci.Component=cx;ci.Fragment=Hfe;ci.Profiler=Zfe;ci.PureComponent=XF;ci.StrictMode=Wfe;ci.Suspense=Jfe;ci.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ope;ci.act=JX;ci.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=HX({},e.props),l=e.key,u=e.ref,f=e._owner;if(t!=null){if(t.ref!==void 0&&(u=t.ref,f=YF.current),t.key!==void 0&&(l=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(v in t)XX.call(t,v)&&!KX.hasOwnProperty(v)&&(n[v]=t[v]===void 0&&o!==void 0?o[v]:t[v])}var v=arguments.length-2;if(v===1)n.children=r;else if(1<v){o=Array(v);for(var w=0;w<v;w++)o[w]=arguments[w+2];n.children=o}return{$$typeof:IT,type:e.type,key:l,ref:u,props:n,_owner:f}};ci.createContext=function(e){return e={$$typeof:Kfe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Xfe,_context:e},e.Consumer=e};ci.createElement=YX;ci.createFactory=function(e){var t=YX.bind(null,e);return t.type=e,t};ci.createRef=function(){return{current:null}};ci.forwardRef=function(e){return{$$typeof:Yfe,render:e}};ci.isValidElement=JF;ci.lazy=function(e){return{$$typeof:epe,_payload:{_status:-1,_result:e},_init:ipe}};ci.memo=function(e,t){return{$$typeof:Qfe,type:e,compare:t===void 0?null:t}};ci.startTransition=function(e){var t=kP.transition;kP.transition={};try{e()}finally{kP.transition=t}};ci.unstable_act=JX;ci.useCallback=function(e,t){return xl.current.useCallback(e,t)};ci.useContext=function(e){return xl.current.useContext(e)};ci.useDebugValue=function(){};ci.useDeferredValue=function(e){return xl.current.useDeferredValue(e)};ci.useEffect=function(e,t){return xl.current.useEffect(e,t)};ci.useId=function(){return xl.current.useId()};ci.useImperativeHandle=function(e,t,r){return xl.current.useImperativeHandle(e,t,r)};ci.useInsertionEffect=function(e,t){return xl.current.useInsertionEffect(e,t)};ci.useLayoutEffect=function(e,t){return xl.current.useLayoutEffect(e,t)};ci.useMemo=function(e,t){return xl.current.useMemo(e,t)};ci.useReducer=function(e,t,r){return xl.current.useReducer(e,t,r)};ci.useRef=function(e){return xl.current.useRef(e)};ci.useState=function(e){return xl.current.useState(e)};ci.useSyncExternalStore=function(e,t,r){return xl.current.useSyncExternalStore(e,t,r)};ci.useTransition=function(){return xl.current.useTransition()};ci.version="18.3.1";GX.exports=ci;var X=GX.exports;const De=zi(X),QF=Gfe({__proto__:null,default:De},[X]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var spe=X,ape=Symbol.for("react.element"),lpe=Symbol.for("react.fragment"),cpe=Object.prototype.hasOwnProperty,upe=spe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dpe={key:!0,ref:!0,__self:!0,__source:!0};function QX(e,t,r){var n,l={},u=null,f=null;r!==void 0&&(u=""+r),t.key!==void 0&&(u=""+t.key),t.ref!==void 0&&(f=t.ref);for(n in t)cpe.call(t,n)&&!dpe.hasOwnProperty(n)&&(l[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)l[n]===void 0&&(l[n]=t[n]);return{$$typeof:ape,type:e,key:u,ref:f,props:l,_owner:upe.current}}sO.Fragment=lpe;sO.jsx=QX;sO.jsxs=QX;UX.exports=sO;var A=UX.exports,eK={exports:{}},pc={},tK={exports:{}},rK={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(qe,He){var Et=qe.length;qe.push(He);e:for(;0<Et;){var Gt=Et-1>>>1,Ot=qe[Gt];if(0<l(Ot,He))qe[Gt]=He,qe[Et]=Ot,Et=Gt;else break e}}function r(qe){return qe.length===0?null:qe[0]}function n(qe){if(qe.length===0)return null;var He=qe[0],Et=qe.pop();if(Et!==He){qe[0]=Et;e:for(var Gt=0,Ot=qe.length,$t=Ot>>>1;Gt<$t;){var ur=2*(Gt+1)-1,Yr=qe[ur],hn=ur+1,rr=qe[hn];if(0>l(Yr,Et))hn<Ot&&0>l(rr,Yr)?(qe[Gt]=rr,qe[hn]=Et,Gt=hn):(qe[Gt]=Yr,qe[ur]=Et,Gt=ur);else if(hn<Ot&&0>l(rr,Et))qe[Gt]=rr,qe[hn]=Et,Gt=hn;else break e}}return He}function l(qe,He){var Et=qe.sortIndex-He.sortIndex;return Et!==0?Et:qe.id-He.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var f=Date,o=f.now();e.unstable_now=function(){return f.now()-o}}var v=[],w=[],P=1,C=null,k=3,L=!1,$=!1,j=!1,B=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function H(qe){for(var He=r(w);He!==null;){if(He.callback===null)n(w);else if(He.startTime<=qe)n(w),He.sortIndex=He.expirationTime,t(v,He);else break;He=r(w)}}function te(qe){if(j=!1,H(qe),!$)if(r(v)!==null)$=!0,rt(Q);else{var He=r(w);He!==null&&at(te,He.startTime-qe)}}function Q(qe,He){$=!1,j&&(j=!1,U(me),me=-1),L=!0;var Et=k;try{for(H(He),C=r(v);C!==null&&(!(C.expirationTime>He)||qe&&!Ge());){var Gt=C.callback;if(typeof Gt=="function"){C.callback=null,k=C.priorityLevel;var Ot=Gt(C.expirationTime<=He);He=e.unstable_now(),typeof Ot=="function"?C.callback=Ot:C===r(v)&&n(v),H(He)}else n(v);C=r(v)}if(C!==null)var $t=!0;else{var ur=r(w);ur!==null&&at(te,ur.startTime-He),$t=!1}return $t}finally{C=null,k=Et,L=!1}}var ae=!1,ue=null,me=-1,Ce=5,Fe=-1;function Ge(){return!(e.unstable_now()-Fe<Ce)}function Ve(){if(ue!==null){var qe=e.unstable_now();Fe=qe;var He=!0;try{He=ue(!0,qe)}finally{He?Ze():(ae=!1,ue=null)}}else ae=!1}var Ze;if(typeof q=="function")Ze=function(){q(Ve)};else if(typeof MessageChannel<"u"){var nt=new MessageChannel,dt=nt.port2;nt.port1.onmessage=Ve,Ze=function(){dt.postMessage(null)}}else Ze=function(){B(Ve,0)};function rt(qe){ue=qe,ae||(ae=!0,Ze())}function at(qe,He){me=B(function(){qe(e.unstable_now())},He)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(qe){qe.callback=null},e.unstable_continueExecution=function(){$||L||($=!0,rt(Q))},e.unstable_forceFrameRate=function(qe){0>qe||125<qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ce=0<qe?Math.floor(1e3/qe):5},e.unstable_getCurrentPriorityLevel=function(){return k},e.unstable_getFirstCallbackNode=function(){return r(v)},e.unstable_next=function(qe){switch(k){case 1:case 2:case 3:var He=3;break;default:He=k}var Et=k;k=He;try{return qe()}finally{k=Et}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(qe,He){switch(qe){case 1:case 2:case 3:case 4:case 5:break;default:qe=3}var Et=k;k=qe;try{return He()}finally{k=Et}},e.unstable_scheduleCallback=function(qe,He,Et){var Gt=e.unstable_now();switch(typeof Et=="object"&&Et!==null?(Et=Et.delay,Et=typeof Et=="number"&&0<Et?Gt+Et:Gt):Et=Gt,qe){case 1:var Ot=-1;break;case 2:Ot=250;break;case 5:Ot=1073741823;break;case 4:Ot=1e4;break;default:Ot=5e3}return Ot=Et+Ot,qe={id:P++,callback:He,priorityLevel:qe,startTime:Et,expirationTime:Ot,sortIndex:-1},Et>Gt?(qe.sortIndex=Et,t(w,qe),r(v)===null&&qe===r(w)&&(j?(U(me),me=-1):j=!0,at(te,Et-Gt))):(qe.sortIndex=Ot,t(v,qe),$||L||($=!0,rt(Q))),qe},e.unstable_shouldYield=Ge,e.unstable_wrapCallback=function(qe){var He=k;return function(){var Et=k;k=He;try{return qe.apply(this,arguments)}finally{k=Et}}}})(rK);tK.exports=rK;var hpe=tK.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fpe=X,hc=hpe;function cr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nK=new Set,rS={};function _y(e,t){y0(e,t),y0(e+"Capture",t)}function y0(e,t){for(rS[e]=t,e=0;e<t.length;e++)nK.add(t[e])}var Gh=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ij=Object.prototype.hasOwnProperty,ppe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u8={},d8={};function mpe(e){return ij.call(d8,e)?!0:ij.call(u8,e)?!1:ppe.test(e)?d8[e]=!0:(u8[e]=!0,!1)}function gpe(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function ype(e,t,r,n){if(t===null||typeof t>"u"||gpe(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function bl(e,t,r,n,l,u,f){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=l,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=u,this.removeEmptyString=f}var Ea={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ea[e]=new bl(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ea[t]=new bl(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ea[e]=new bl(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ea[e]=new bl(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ea[e]=new bl(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ea[e]=new bl(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ea[e]=new bl(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ea[e]=new bl(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ea[e]=new bl(e,5,!1,e.toLowerCase(),null,!1,!1)});var e3=/[\-:]([a-z])/g;function t3(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(e3,t3);Ea[t]=new bl(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(e3,t3);Ea[t]=new bl(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(e3,t3);Ea[t]=new bl(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ea[e]=new bl(e,1,!1,e.toLowerCase(),null,!1,!1)});Ea.xlinkHref=new bl("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ea[e]=new bl(e,1,!1,e.toLowerCase(),null,!0,!0)});function r3(e,t,r,n){var l=Ea.hasOwnProperty(t)?Ea[t]:null;(l!==null?l.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(ype(t,r,l,n)&&(r=null),n||l===null?mpe(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):l.mustUseProperty?e[l.propertyName]=r===null?l.type===3?!1:"":r:(t=l.attributeName,n=l.attributeNamespace,r===null?e.removeAttribute(t):(l=l.type,r=l===3||l===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var nf=fpe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j2=Symbol.for("react.element"),vv=Symbol.for("react.portal"),xv=Symbol.for("react.fragment"),n3=Symbol.for("react.strict_mode"),oj=Symbol.for("react.profiler"),iK=Symbol.for("react.provider"),oK=Symbol.for("react.context"),i3=Symbol.for("react.forward_ref"),sj=Symbol.for("react.suspense"),aj=Symbol.for("react.suspense_list"),o3=Symbol.for("react.memo"),op=Symbol.for("react.lazy"),sK=Symbol.for("react.offscreen"),h8=Symbol.iterator;function Hw(e){return e===null||typeof e!="object"?null:(e=h8&&e[h8]||e["@@iterator"],typeof e=="function"?e:null)}var Ho=Object.assign,fD;function g1(e){if(fD===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);fD=t&&t[1]||""}return`
`+fD+e}var pD=!1;function mD(e,t){if(!e||pD)return"";pD=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(w){var n=w}Reflect.construct(e,[],t)}else{try{t.call()}catch(w){n=w}e.call(t.prototype)}else{try{throw Error()}catch(w){n=w}e()}}catch(w){if(w&&n&&typeof w.stack=="string"){for(var l=w.stack.split(`
`),u=n.stack.split(`
`),f=l.length-1,o=u.length-1;1<=f&&0<=o&&l[f]!==u[o];)o--;for(;1<=f&&0<=o;f--,o--)if(l[f]!==u[o]){if(f!==1||o!==1)do if(f--,o--,0>o||l[f]!==u[o]){var v=`
`+l[f].replace(" at new "," at ");return e.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",e.displayName)),v}while(1<=f&&0<=o);break}}}finally{pD=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?g1(e):""}function _pe(e){switch(e.tag){case 5:return g1(e.type);case 16:return g1("Lazy");case 13:return g1("Suspense");case 19:return g1("SuspenseList");case 0:case 2:case 15:return e=mD(e.type,!1),e;case 11:return e=mD(e.type.render,!1),e;case 1:return e=mD(e.type,!0),e;default:return""}}function lj(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case xv:return"Fragment";case vv:return"Portal";case oj:return"Profiler";case n3:return"StrictMode";case sj:return"Suspense";case aj:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case oK:return(e.displayName||"Context")+".Consumer";case iK:return(e._context.displayName||"Context")+".Provider";case i3:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case o3:return t=e.displayName||null,t!==null?t:lj(e.type)||"Memo";case op:t=e._payload,e=e._init;try{return lj(e(t))}catch{}}return null}function vpe(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return lj(t);case 8:return t===n3?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Up(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function aK(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function xpe(e){var t=aK(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var l=r.get,u=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return l.call(this)},set:function(f){n=""+f,u.call(this,f)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(f){n=""+f},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function N2(e){e._valueTracker||(e._valueTracker=xpe(e))}function lK(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=aK(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function tC(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function cj(e,t){var r=t.checked;return Ho({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function f8(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Up(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function cK(e,t){t=t.checked,t!=null&&r3(e,"checked",t,!1)}function uj(e,t){cK(e,t);var r=Up(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?dj(e,t.type,r):t.hasOwnProperty("defaultValue")&&dj(e,t.type,Up(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function p8(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function dj(e,t,r){(t!=="number"||tC(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var y1=Array.isArray;function $v(e,t,r,n){if(e=e.options,t){t={};for(var l=0;l<r.length;l++)t["$"+r[l]]=!0;for(r=0;r<e.length;r++)l=t.hasOwnProperty("$"+e[r].value),e[r].selected!==l&&(e[r].selected=l),l&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Up(r),t=null,l=0;l<e.length;l++){if(e[l].value===r){e[l].selected=!0,n&&(e[l].defaultSelected=!0);return}t!==null||e[l].disabled||(t=e[l])}t!==null&&(t.selected=!0)}}function hj(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(cr(91));return Ho({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function m8(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(cr(92));if(y1(r)){if(1<r.length)throw Error(cr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Up(r)}}function uK(e,t){var r=Up(t.value),n=Up(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function g8(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function dK(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function fj(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?dK(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var z2,hK=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,l){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,l)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(z2=z2||document.createElement("div"),z2.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=z2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function nS(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var C1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},bpe=["Webkit","ms","Moz","O"];Object.keys(C1).forEach(function(e){bpe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),C1[t]=C1[e]})});function fK(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||C1.hasOwnProperty(e)&&C1[e]?(""+t).trim():t+"px"}function pK(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,l=fK(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,l):e[r]=l}}var wpe=Ho({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pj(e,t){if(t){if(wpe[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(cr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(cr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(cr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(cr(62))}}function mj(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gj=null;function s3(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yj=null,Vv=null,Uv=null;function y8(e){if(e=RT(e)){if(typeof yj!="function")throw Error(cr(280));var t=e.stateNode;t&&(t=dO(t),yj(e.stateNode,e.type,t))}}function mK(e){Vv?Uv?Uv.push(e):Uv=[e]:Vv=e}function gK(){if(Vv){var e=Vv,t=Uv;if(Uv=Vv=null,y8(e),t)for(e=0;e<t.length;e++)y8(t[e])}}function yK(e,t){return e(t)}function _K(){}var gD=!1;function vK(e,t,r){if(gD)return e(t,r);gD=!0;try{return yK(e,t,r)}finally{gD=!1,(Vv!==null||Uv!==null)&&(_K(),gK())}}function iS(e,t){var r=e.stateNode;if(r===null)return null;var n=dO(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(cr(231,t,typeof r));return r}var _j=!1;if(Gh)try{var Ww={};Object.defineProperty(Ww,"passive",{get:function(){_j=!0}}),window.addEventListener("test",Ww,Ww),window.removeEventListener("test",Ww,Ww)}catch{_j=!1}function Spe(e,t,r,n,l,u,f,o,v){var w=Array.prototype.slice.call(arguments,3);try{t.apply(r,w)}catch(P){this.onError(P)}}var I1=!1,rC=null,nC=!1,vj=null,Tpe={onError:function(e){I1=!0,rC=e}};function Epe(e,t,r,n,l,u,f,o,v){I1=!1,rC=null,Spe.apply(Tpe,arguments)}function Ape(e,t,r,n,l,u,f,o,v){if(Epe.apply(this,arguments),I1){if(I1){var w=rC;I1=!1,rC=null}else throw Error(cr(198));nC||(nC=!0,vj=w)}}function vy(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function xK(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function _8(e){if(vy(e)!==e)throw Error(cr(188))}function Ppe(e){var t=e.alternate;if(!t){if(t=vy(e),t===null)throw Error(cr(188));return t!==e?null:e}for(var r=e,n=t;;){var l=r.return;if(l===null)break;var u=l.alternate;if(u===null){if(n=l.return,n!==null){r=n;continue}break}if(l.child===u.child){for(u=l.child;u;){if(u===r)return _8(l),e;if(u===n)return _8(l),t;u=u.sibling}throw Error(cr(188))}if(r.return!==n.return)r=l,n=u;else{for(var f=!1,o=l.child;o;){if(o===r){f=!0,r=l,n=u;break}if(o===n){f=!0,n=l,r=u;break}o=o.sibling}if(!f){for(o=u.child;o;){if(o===r){f=!0,r=u,n=l;break}if(o===n){f=!0,n=u,r=l;break}o=o.sibling}if(!f)throw Error(cr(189))}}if(r.alternate!==n)throw Error(cr(190))}if(r.tag!==3)throw Error(cr(188));return r.stateNode.current===r?e:t}function bK(e){return e=Ppe(e),e!==null?wK(e):null}function wK(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=wK(e);if(t!==null)return t;e=e.sibling}return null}var SK=hc.unstable_scheduleCallback,v8=hc.unstable_cancelCallback,Cpe=hc.unstable_shouldYield,Ipe=hc.unstable_requestPaint,ds=hc.unstable_now,Ope=hc.unstable_getCurrentPriorityLevel,a3=hc.unstable_ImmediatePriority,TK=hc.unstable_UserBlockingPriority,iC=hc.unstable_NormalPriority,kpe=hc.unstable_LowPriority,EK=hc.unstable_IdlePriority,aO=null,Md=null;function Rpe(e){if(Md&&typeof Md.onCommitFiberRoot=="function")try{Md.onCommitFiberRoot(aO,e,void 0,(e.current.flags&128)===128)}catch{}}var Bu=Math.clz32?Math.clz32:Lpe,Mpe=Math.log,Dpe=Math.LN2;function Lpe(e){return e>>>=0,e===0?32:31-(Mpe(e)/Dpe|0)|0}var F2=64,B2=4194304;function _1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function oC(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,l=e.suspendedLanes,u=e.pingedLanes,f=r&268435455;if(f!==0){var o=f&~l;o!==0?n=_1(o):(u&=f,u!==0&&(n=_1(u)))}else f=r&~l,f!==0?n=_1(f):u!==0&&(n=_1(u));if(n===0)return 0;if(t!==0&&t!==n&&!(t&l)&&(l=n&-n,u=t&-t,l>=u||l===16&&(u&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Bu(t),l=1<<r,n|=e[r],t&=~l;return n}function jpe(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Npe(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,l=e.expirationTimes,u=e.pendingLanes;0<u;){var f=31-Bu(u),o=1<<f,v=l[f];v===-1?(!(o&r)||o&n)&&(l[f]=jpe(o,t)):v<=t&&(e.expiredLanes|=o),u&=~o}}function xj(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function AK(){var e=F2;return F2<<=1,!(F2&4194240)&&(F2=64),e}function yD(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function OT(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Bu(t),e[t]=r}function zpe(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var l=31-Bu(r),u=1<<l;t[l]=0,n[l]=-1,e[l]=-1,r&=~u}}function l3(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Bu(r),l=1<<n;l&t|e[n]&t&&(e[n]|=t),r&=~l}}var Ki=0;function PK(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var CK,c3,IK,OK,kK,bj=!1,$2=[],Op=null,kp=null,Rp=null,oS=new Map,sS=new Map,dp=[],Fpe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function x8(e,t){switch(e){case"focusin":case"focusout":Op=null;break;case"dragenter":case"dragleave":kp=null;break;case"mouseover":case"mouseout":Rp=null;break;case"pointerover":case"pointerout":oS.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":sS.delete(t.pointerId)}}function Zw(e,t,r,n,l,u){return e===null||e.nativeEvent!==u?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:u,targetContainers:[l]},t!==null&&(t=RT(t),t!==null&&c3(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,l!==null&&t.indexOf(l)===-1&&t.push(l),e)}function Bpe(e,t,r,n,l){switch(t){case"focusin":return Op=Zw(Op,e,t,r,n,l),!0;case"dragenter":return kp=Zw(kp,e,t,r,n,l),!0;case"mouseover":return Rp=Zw(Rp,e,t,r,n,l),!0;case"pointerover":var u=l.pointerId;return oS.set(u,Zw(oS.get(u)||null,e,t,r,n,l)),!0;case"gotpointercapture":return u=l.pointerId,sS.set(u,Zw(sS.get(u)||null,e,t,r,n,l)),!0}return!1}function RK(e){var t=Eg(e.target);if(t!==null){var r=vy(t);if(r!==null){if(t=r.tag,t===13){if(t=xK(r),t!==null){e.blockedOn=t,kK(e.priority,function(){IK(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function RP(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=wj(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);gj=n,r.target.dispatchEvent(n),gj=null}else return t=RT(r),t!==null&&c3(t),e.blockedOn=r,!1;t.shift()}return!0}function b8(e,t,r){RP(e)&&r.delete(t)}function $pe(){bj=!1,Op!==null&&RP(Op)&&(Op=null),kp!==null&&RP(kp)&&(kp=null),Rp!==null&&RP(Rp)&&(Rp=null),oS.forEach(b8),sS.forEach(b8)}function Xw(e,t){e.blockedOn===t&&(e.blockedOn=null,bj||(bj=!0,hc.unstable_scheduleCallback(hc.unstable_NormalPriority,$pe)))}function aS(e){function t(l){return Xw(l,e)}if(0<$2.length){Xw($2[0],e);for(var r=1;r<$2.length;r++){var n=$2[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Op!==null&&Xw(Op,e),kp!==null&&Xw(kp,e),Rp!==null&&Xw(Rp,e),oS.forEach(t),sS.forEach(t),r=0;r<dp.length;r++)n=dp[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<dp.length&&(r=dp[0],r.blockedOn===null);)RK(r),r.blockedOn===null&&dp.shift()}var Gv=nf.ReactCurrentBatchConfig,sC=!0;function Vpe(e,t,r,n){var l=Ki,u=Gv.transition;Gv.transition=null;try{Ki=1,u3(e,t,r,n)}finally{Ki=l,Gv.transition=u}}function Upe(e,t,r,n){var l=Ki,u=Gv.transition;Gv.transition=null;try{Ki=4,u3(e,t,r,n)}finally{Ki=l,Gv.transition=u}}function u3(e,t,r,n){if(sC){var l=wj(e,t,r,n);if(l===null)PD(e,t,n,aC,r),x8(e,n);else if(Bpe(l,e,t,r,n))n.stopPropagation();else if(x8(e,n),t&4&&-1<Fpe.indexOf(e)){for(;l!==null;){var u=RT(l);if(u!==null&&CK(u),u=wj(e,t,r,n),u===null&&PD(e,t,n,aC,r),u===l)break;l=u}l!==null&&n.stopPropagation()}else PD(e,t,n,null,r)}}var aC=null;function wj(e,t,r,n){if(aC=null,e=s3(n),e=Eg(e),e!==null)if(t=vy(e),t===null)e=null;else if(r=t.tag,r===13){if(e=xK(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return aC=e,null}function MK(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ope()){case a3:return 1;case TK:return 4;case iC:case kpe:return 16;case EK:return 536870912;default:return 16}default:return 16}}var Ep=null,d3=null,MP=null;function DK(){if(MP)return MP;var e,t=d3,r=t.length,n,l="value"in Ep?Ep.value:Ep.textContent,u=l.length;for(e=0;e<r&&t[e]===l[e];e++);var f=r-e;for(n=1;n<=f&&t[r-n]===l[u-n];n++);return MP=l.slice(e,1<n?1-n:void 0)}function DP(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function V2(){return!0}function w8(){return!1}function mc(e){function t(r,n,l,u,f){this._reactName=r,this._targetInst=l,this.type=n,this.nativeEvent=u,this.target=f,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(u):u[o]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?V2:w8,this.isPropagationStopped=w8,this}return Ho(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=V2)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=V2)},persist:function(){},isPersistent:V2}),t}var ux={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},h3=mc(ux),kT=Ho({},ux,{view:0,detail:0}),Gpe=mc(kT),_D,vD,Kw,lO=Ho({},kT,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:f3,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Kw&&(Kw&&e.type==="mousemove"?(_D=e.screenX-Kw.screenX,vD=e.screenY-Kw.screenY):vD=_D=0,Kw=e),_D)},movementY:function(e){return"movementY"in e?e.movementY:vD}}),S8=mc(lO),qpe=Ho({},lO,{dataTransfer:0}),Hpe=mc(qpe),Wpe=Ho({},kT,{relatedTarget:0}),xD=mc(Wpe),Zpe=Ho({},ux,{animationName:0,elapsedTime:0,pseudoElement:0}),Xpe=mc(Zpe),Kpe=Ho({},ux,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ype=mc(Kpe),Jpe=Ho({},ux,{data:0}),T8=mc(Jpe),Qpe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},eme={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tme={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rme(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=tme[e])?!!t[e]:!1}function f3(){return rme}var nme=Ho({},kT,{key:function(e){if(e.key){var t=Qpe[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=DP(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?eme[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:f3,charCode:function(e){return e.type==="keypress"?DP(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?DP(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),ime=mc(nme),ome=Ho({},lO,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),E8=mc(ome),sme=Ho({},kT,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:f3}),ame=mc(sme),lme=Ho({},ux,{propertyName:0,elapsedTime:0,pseudoElement:0}),cme=mc(lme),ume=Ho({},lO,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),dme=mc(ume),hme=[9,13,27,32],p3=Gh&&"CompositionEvent"in window,O1=null;Gh&&"documentMode"in document&&(O1=document.documentMode);var fme=Gh&&"TextEvent"in window&&!O1,LK=Gh&&(!p3||O1&&8<O1&&11>=O1),A8=" ",P8=!1;function jK(e,t){switch(e){case"keyup":return hme.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function NK(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var bv=!1;function pme(e,t){switch(e){case"compositionend":return NK(t);case"keypress":return t.which!==32?null:(P8=!0,A8);case"textInput":return e=t.data,e===A8&&P8?null:e;default:return null}}function mme(e,t){if(bv)return e==="compositionend"||!p3&&jK(e,t)?(e=DK(),MP=d3=Ep=null,bv=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return LK&&t.locale!=="ko"?null:t.data;default:return null}}var gme={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function C8(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!gme[e.type]:t==="textarea"}function zK(e,t,r,n){mK(n),t=lC(t,"onChange"),0<t.length&&(r=new h3("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var k1=null,lS=null;function yme(e){XK(e,0)}function cO(e){var t=Tv(e);if(lK(t))return e}function _me(e,t){if(e==="change")return t}var FK=!1;if(Gh){var bD;if(Gh){var wD="oninput"in document;if(!wD){var I8=document.createElement("div");I8.setAttribute("oninput","return;"),wD=typeof I8.oninput=="function"}bD=wD}else bD=!1;FK=bD&&(!document.documentMode||9<document.documentMode)}function O8(){k1&&(k1.detachEvent("onpropertychange",BK),lS=k1=null)}function BK(e){if(e.propertyName==="value"&&cO(lS)){var t=[];zK(t,lS,e,s3(e)),vK(yme,t)}}function vme(e,t,r){e==="focusin"?(O8(),k1=t,lS=r,k1.attachEvent("onpropertychange",BK)):e==="focusout"&&O8()}function xme(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return cO(lS)}function bme(e,t){if(e==="click")return cO(t)}function wme(e,t){if(e==="input"||e==="change")return cO(t)}function Sme(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var qu=typeof Object.is=="function"?Object.is:Sme;function cS(e,t){if(qu(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var l=r[n];if(!ij.call(t,l)||!qu(e[l],t[l]))return!1}return!0}function k8(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function R8(e,t){var r=k8(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=k8(r)}}function $K(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?$K(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function VK(){for(var e=window,t=tC();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=tC(e.document)}return t}function m3(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Tme(e){var t=VK(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&$K(r.ownerDocument.documentElement,r)){if(n!==null&&m3(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var l=r.textContent.length,u=Math.min(n.start,l);n=n.end===void 0?u:Math.min(n.end,l),!e.extend&&u>n&&(l=n,n=u,u=l),l=R8(r,u);var f=R8(r,n);l&&f&&(e.rangeCount!==1||e.anchorNode!==l.node||e.anchorOffset!==l.offset||e.focusNode!==f.node||e.focusOffset!==f.offset)&&(t=t.createRange(),t.setStart(l.node,l.offset),e.removeAllRanges(),u>n?(e.addRange(t),e.extend(f.node,f.offset)):(t.setEnd(f.node,f.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Eme=Gh&&"documentMode"in document&&11>=document.documentMode,wv=null,Sj=null,R1=null,Tj=!1;function M8(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Tj||wv==null||wv!==tC(n)||(n=wv,"selectionStart"in n&&m3(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),R1&&cS(R1,n)||(R1=n,n=lC(Sj,"onSelect"),0<n.length&&(t=new h3("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=wv)))}function U2(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Sv={animationend:U2("Animation","AnimationEnd"),animationiteration:U2("Animation","AnimationIteration"),animationstart:U2("Animation","AnimationStart"),transitionend:U2("Transition","TransitionEnd")},SD={},UK={};Gh&&(UK=document.createElement("div").style,"AnimationEvent"in window||(delete Sv.animationend.animation,delete Sv.animationiteration.animation,delete Sv.animationstart.animation),"TransitionEvent"in window||delete Sv.transitionend.transition);function uO(e){if(SD[e])return SD[e];if(!Sv[e])return e;var t=Sv[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in UK)return SD[e]=t[r];return e}var GK=uO("animationend"),qK=uO("animationiteration"),HK=uO("animationstart"),WK=uO("transitionend"),ZK=new Map,D8="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qp(e,t){ZK.set(e,t),_y(t,[e])}for(var TD=0;TD<D8.length;TD++){var ED=D8[TD],Ame=ED.toLowerCase(),Pme=ED[0].toUpperCase()+ED.slice(1);Qp(Ame,"on"+Pme)}Qp(GK,"onAnimationEnd");Qp(qK,"onAnimationIteration");Qp(HK,"onAnimationStart");Qp("dblclick","onDoubleClick");Qp("focusin","onFocus");Qp("focusout","onBlur");Qp(WK,"onTransitionEnd");y0("onMouseEnter",["mouseout","mouseover"]);y0("onMouseLeave",["mouseout","mouseover"]);y0("onPointerEnter",["pointerout","pointerover"]);y0("onPointerLeave",["pointerout","pointerover"]);_y("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_y("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_y("onBeforeInput",["compositionend","keypress","textInput","paste"]);_y("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_y("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_y("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var v1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cme=new Set("cancel close invalid load scroll toggle".split(" ").concat(v1));function L8(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,Ape(n,t,void 0,e),e.currentTarget=null}function XK(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],l=n.event;n=n.listeners;e:{var u=void 0;if(t)for(var f=n.length-1;0<=f;f--){var o=n[f],v=o.instance,w=o.currentTarget;if(o=o.listener,v!==u&&l.isPropagationStopped())break e;L8(l,o,w),u=v}else for(f=0;f<n.length;f++){if(o=n[f],v=o.instance,w=o.currentTarget,o=o.listener,v!==u&&l.isPropagationStopped())break e;L8(l,o,w),u=v}}}if(nC)throw e=vj,nC=!1,vj=null,e}function wo(e,t){var r=t[Ij];r===void 0&&(r=t[Ij]=new Set);var n=e+"__bubble";r.has(n)||(KK(t,e,2,!1),r.add(n))}function AD(e,t,r){var n=0;t&&(n|=4),KK(r,e,n,t)}var G2="_reactListening"+Math.random().toString(36).slice(2);function uS(e){if(!e[G2]){e[G2]=!0,nK.forEach(function(r){r!=="selectionchange"&&(Cme.has(r)||AD(r,!1,e),AD(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[G2]||(t[G2]=!0,AD("selectionchange",!1,t))}}function KK(e,t,r,n){switch(MK(t)){case 1:var l=Vpe;break;case 4:l=Upe;break;default:l=u3}r=l.bind(null,t,r,e),l=void 0,!_j||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(l=!0),n?l!==void 0?e.addEventListener(t,r,{capture:!0,passive:l}):e.addEventListener(t,r,!0):l!==void 0?e.addEventListener(t,r,{passive:l}):e.addEventListener(t,r,!1)}function PD(e,t,r,n,l){var u=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var f=n.tag;if(f===3||f===4){var o=n.stateNode.containerInfo;if(o===l||o.nodeType===8&&o.parentNode===l)break;if(f===4)for(f=n.return;f!==null;){var v=f.tag;if((v===3||v===4)&&(v=f.stateNode.containerInfo,v===l||v.nodeType===8&&v.parentNode===l))return;f=f.return}for(;o!==null;){if(f=Eg(o),f===null)return;if(v=f.tag,v===5||v===6){n=u=f;continue e}o=o.parentNode}}n=n.return}vK(function(){var w=u,P=s3(r),C=[];e:{var k=ZK.get(e);if(k!==void 0){var L=h3,$=e;switch(e){case"keypress":if(DP(r)===0)break e;case"keydown":case"keyup":L=ime;break;case"focusin":$="focus",L=xD;break;case"focusout":$="blur",L=xD;break;case"beforeblur":case"afterblur":L=xD;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=S8;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=Hpe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=ame;break;case GK:case qK:case HK:L=Xpe;break;case WK:L=cme;break;case"scroll":L=Gpe;break;case"wheel":L=dme;break;case"copy":case"cut":case"paste":L=Ype;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=E8}var j=(t&4)!==0,B=!j&&e==="scroll",U=j?k!==null?k+"Capture":null:k;j=[];for(var q=w,H;q!==null;){H=q;var te=H.stateNode;if(H.tag===5&&te!==null&&(H=te,U!==null&&(te=iS(q,U),te!=null&&j.push(dS(q,te,H)))),B)break;q=q.return}0<j.length&&(k=new L(k,$,null,r,P),C.push({event:k,listeners:j}))}}if(!(t&7)){e:{if(k=e==="mouseover"||e==="pointerover",L=e==="mouseout"||e==="pointerout",k&&r!==gj&&($=r.relatedTarget||r.fromElement)&&(Eg($)||$[qh]))break e;if((L||k)&&(k=P.window===P?P:(k=P.ownerDocument)?k.defaultView||k.parentWindow:window,L?($=r.relatedTarget||r.toElement,L=w,$=$?Eg($):null,$!==null&&(B=vy($),$!==B||$.tag!==5&&$.tag!==6)&&($=null)):(L=null,$=w),L!==$)){if(j=S8,te="onMouseLeave",U="onMouseEnter",q="mouse",(e==="pointerout"||e==="pointerover")&&(j=E8,te="onPointerLeave",U="onPointerEnter",q="pointer"),B=L==null?k:Tv(L),H=$==null?k:Tv($),k=new j(te,q+"leave",L,r,P),k.target=B,k.relatedTarget=H,te=null,Eg(P)===w&&(j=new j(U,q+"enter",$,r,P),j.target=H,j.relatedTarget=B,te=j),B=te,L&&$)t:{for(j=L,U=$,q=0,H=j;H;H=Q_(H))q++;for(H=0,te=U;te;te=Q_(te))H++;for(;0<q-H;)j=Q_(j),q--;for(;0<H-q;)U=Q_(U),H--;for(;q--;){if(j===U||U!==null&&j===U.alternate)break t;j=Q_(j),U=Q_(U)}j=null}else j=null;L!==null&&j8(C,k,L,j,!1),$!==null&&B!==null&&j8(C,B,$,j,!0)}}e:{if(k=w?Tv(w):window,L=k.nodeName&&k.nodeName.toLowerCase(),L==="select"||L==="input"&&k.type==="file")var Q=_me;else if(C8(k))if(FK)Q=wme;else{Q=xme;var ae=vme}else(L=k.nodeName)&&L.toLowerCase()==="input"&&(k.type==="checkbox"||k.type==="radio")&&(Q=bme);if(Q&&(Q=Q(e,w))){zK(C,Q,r,P);break e}ae&&ae(e,k,w),e==="focusout"&&(ae=k._wrapperState)&&ae.controlled&&k.type==="number"&&dj(k,"number",k.value)}switch(ae=w?Tv(w):window,e){case"focusin":(C8(ae)||ae.contentEditable==="true")&&(wv=ae,Sj=w,R1=null);break;case"focusout":R1=Sj=wv=null;break;case"mousedown":Tj=!0;break;case"contextmenu":case"mouseup":case"dragend":Tj=!1,M8(C,r,P);break;case"selectionchange":if(Eme)break;case"keydown":case"keyup":M8(C,r,P)}var ue;if(p3)e:{switch(e){case"compositionstart":var me="onCompositionStart";break e;case"compositionend":me="onCompositionEnd";break e;case"compositionupdate":me="onCompositionUpdate";break e}me=void 0}else bv?jK(e,r)&&(me="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(me="onCompositionStart");me&&(LK&&r.locale!=="ko"&&(bv||me!=="onCompositionStart"?me==="onCompositionEnd"&&bv&&(ue=DK()):(Ep=P,d3="value"in Ep?Ep.value:Ep.textContent,bv=!0)),ae=lC(w,me),0<ae.length&&(me=new T8(me,e,null,r,P),C.push({event:me,listeners:ae}),ue?me.data=ue:(ue=NK(r),ue!==null&&(me.data=ue)))),(ue=fme?pme(e,r):mme(e,r))&&(w=lC(w,"onBeforeInput"),0<w.length&&(P=new T8("onBeforeInput","beforeinput",null,r,P),C.push({event:P,listeners:w}),P.data=ue))}XK(C,t)})}function dS(e,t,r){return{instance:e,listener:t,currentTarget:r}}function lC(e,t){for(var r=t+"Capture",n=[];e!==null;){var l=e,u=l.stateNode;l.tag===5&&u!==null&&(l=u,u=iS(e,r),u!=null&&n.unshift(dS(e,u,l)),u=iS(e,t),u!=null&&n.push(dS(e,u,l))),e=e.return}return n}function Q_(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function j8(e,t,r,n,l){for(var u=t._reactName,f=[];r!==null&&r!==n;){var o=r,v=o.alternate,w=o.stateNode;if(v!==null&&v===n)break;o.tag===5&&w!==null&&(o=w,l?(v=iS(r,u),v!=null&&f.unshift(dS(r,v,o))):l||(v=iS(r,u),v!=null&&f.push(dS(r,v,o)))),r=r.return}f.length!==0&&e.push({event:t,listeners:f})}var Ime=/\r\n?/g,Ome=/\u0000|\uFFFD/g;function N8(e){return(typeof e=="string"?e:""+e).replace(Ime,`
`).replace(Ome,"")}function q2(e,t,r){if(t=N8(t),N8(e)!==t&&r)throw Error(cr(425))}function cC(){}var Ej=null,Aj=null;function Pj(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Cj=typeof setTimeout=="function"?setTimeout:void 0,kme=typeof clearTimeout=="function"?clearTimeout:void 0,z8=typeof Promise=="function"?Promise:void 0,Rme=typeof queueMicrotask=="function"?queueMicrotask:typeof z8<"u"?function(e){return z8.resolve(null).then(e).catch(Mme)}:Cj;function Mme(e){setTimeout(function(){throw e})}function CD(e,t){var r=t,n=0;do{var l=r.nextSibling;if(e.removeChild(r),l&&l.nodeType===8)if(r=l.data,r==="/$"){if(n===0){e.removeChild(l),aS(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=l}while(r);aS(t)}function Mp(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function F8(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var dx=Math.random().toString(36).slice(2),Cd="__reactFiber$"+dx,hS="__reactProps$"+dx,qh="__reactContainer$"+dx,Ij="__reactEvents$"+dx,Dme="__reactListeners$"+dx,Lme="__reactHandles$"+dx;function Eg(e){var t=e[Cd];if(t)return t;for(var r=e.parentNode;r;){if(t=r[qh]||r[Cd]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=F8(e);e!==null;){if(r=e[Cd])return r;e=F8(e)}return t}e=r,r=e.parentNode}return null}function RT(e){return e=e[Cd]||e[qh],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Tv(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(cr(33))}function dO(e){return e[hS]||null}var Oj=[],Ev=-1;function em(e){return{current:e}}function Eo(e){0>Ev||(e.current=Oj[Ev],Oj[Ev]=null,Ev--)}function co(e,t){Ev++,Oj[Ev]=e.current,e.current=t}var Gp={},Ga=em(Gp),zl=em(!1),Yg=Gp;function _0(e,t){var r=e.type.contextTypes;if(!r)return Gp;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var l={},u;for(u in r)l[u]=t[u];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function Fl(e){return e=e.childContextTypes,e!=null}function uC(){Eo(zl),Eo(Ga)}function B8(e,t,r){if(Ga.current!==Gp)throw Error(cr(168));co(Ga,t),co(zl,r)}function YK(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var l in n)if(!(l in t))throw Error(cr(108,vpe(e)||"Unknown",l));return Ho({},r,n)}function dC(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Gp,Yg=Ga.current,co(Ga,e),co(zl,zl.current),!0}function $8(e,t,r){var n=e.stateNode;if(!n)throw Error(cr(169));r?(e=YK(e,t,Yg),n.__reactInternalMemoizedMergedChildContext=e,Eo(zl),Eo(Ga),co(Ga,e)):Eo(zl),co(zl,r)}var Ph=null,hO=!1,ID=!1;function JK(e){Ph===null?Ph=[e]:Ph.push(e)}function jme(e){hO=!0,JK(e)}function tm(){if(!ID&&Ph!==null){ID=!0;var e=0,t=Ki;try{var r=Ph;for(Ki=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Ph=null,hO=!1}catch(l){throw Ph!==null&&(Ph=Ph.slice(e+1)),SK(a3,tm),l}finally{Ki=t,ID=!1}}return null}var Av=[],Pv=0,hC=null,fC=0,$c=[],Vc=0,Jg=null,Rh=1,Mh="";function mg(e,t){Av[Pv++]=fC,Av[Pv++]=hC,hC=e,fC=t}function QK(e,t,r){$c[Vc++]=Rh,$c[Vc++]=Mh,$c[Vc++]=Jg,Jg=e;var n=Rh;e=Mh;var l=32-Bu(n)-1;n&=~(1<<l),r+=1;var u=32-Bu(t)+l;if(30<u){var f=l-l%5;u=(n&(1<<f)-1).toString(32),n>>=f,l-=f,Rh=1<<32-Bu(t)+l|r<<l|n,Mh=u+e}else Rh=1<<u|r<<l|n,Mh=e}function g3(e){e.return!==null&&(mg(e,1),QK(e,1,0))}function y3(e){for(;e===hC;)hC=Av[--Pv],Av[Pv]=null,fC=Av[--Pv],Av[Pv]=null;for(;e===Jg;)Jg=$c[--Vc],$c[Vc]=null,Mh=$c[--Vc],$c[Vc]=null,Rh=$c[--Vc],$c[Vc]=null}var cc=null,lc=null,ko=!1,ju=null;function eY(e,t){var r=Gc(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function V8(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,cc=e,lc=Mp(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,cc=e,lc=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Jg!==null?{id:Rh,overflow:Mh}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=Gc(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,cc=e,lc=null,!0):!1;default:return!1}}function kj(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Rj(e){if(ko){var t=lc;if(t){var r=t;if(!V8(e,t)){if(kj(e))throw Error(cr(418));t=Mp(r.nextSibling);var n=cc;t&&V8(e,t)?eY(n,r):(e.flags=e.flags&-4097|2,ko=!1,cc=e)}}else{if(kj(e))throw Error(cr(418));e.flags=e.flags&-4097|2,ko=!1,cc=e}}}function U8(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;cc=e}function H2(e){if(e!==cc)return!1;if(!ko)return U8(e),ko=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Pj(e.type,e.memoizedProps)),t&&(t=lc)){if(kj(e))throw tY(),Error(cr(418));for(;t;)eY(e,t),t=Mp(t.nextSibling)}if(U8(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(cr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){lc=Mp(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}lc=null}}else lc=cc?Mp(e.stateNode.nextSibling):null;return!0}function tY(){for(var e=lc;e;)e=Mp(e.nextSibling)}function v0(){lc=cc=null,ko=!1}function _3(e){ju===null?ju=[e]:ju.push(e)}var Nme=nf.ReactCurrentBatchConfig;function Yw(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(cr(309));var n=r.stateNode}if(!n)throw Error(cr(147,e));var l=n,u=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===u?t.ref:(t=function(f){var o=l.refs;f===null?delete o[u]:o[u]=f},t._stringRef=u,t)}if(typeof e!="string")throw Error(cr(284));if(!r._owner)throw Error(cr(290,e))}return e}function W2(e,t){throw e=Object.prototype.toString.call(t),Error(cr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function G8(e){var t=e._init;return t(e._payload)}function rY(e){function t(U,q){if(e){var H=U.deletions;H===null?(U.deletions=[q],U.flags|=16):H.push(q)}}function r(U,q){if(!e)return null;for(;q!==null;)t(U,q),q=q.sibling;return null}function n(U,q){for(U=new Map;q!==null;)q.key!==null?U.set(q.key,q):U.set(q.index,q),q=q.sibling;return U}function l(U,q){return U=Np(U,q),U.index=0,U.sibling=null,U}function u(U,q,H){return U.index=H,e?(H=U.alternate,H!==null?(H=H.index,H<q?(U.flags|=2,q):H):(U.flags|=2,q)):(U.flags|=1048576,q)}function f(U){return e&&U.alternate===null&&(U.flags|=2),U}function o(U,q,H,te){return q===null||q.tag!==6?(q=jD(H,U.mode,te),q.return=U,q):(q=l(q,H),q.return=U,q)}function v(U,q,H,te){var Q=H.type;return Q===xv?P(U,q,H.props.children,te,H.key):q!==null&&(q.elementType===Q||typeof Q=="object"&&Q!==null&&Q.$$typeof===op&&G8(Q)===q.type)?(te=l(q,H.props),te.ref=Yw(U,q,H),te.return=U,te):(te=$P(H.type,H.key,H.props,null,U.mode,te),te.ref=Yw(U,q,H),te.return=U,te)}function w(U,q,H,te){return q===null||q.tag!==4||q.stateNode.containerInfo!==H.containerInfo||q.stateNode.implementation!==H.implementation?(q=ND(H,U.mode,te),q.return=U,q):(q=l(q,H.children||[]),q.return=U,q)}function P(U,q,H,te,Q){return q===null||q.tag!==7?(q=Hg(H,U.mode,te,Q),q.return=U,q):(q=l(q,H),q.return=U,q)}function C(U,q,H){if(typeof q=="string"&&q!==""||typeof q=="number")return q=jD(""+q,U.mode,H),q.return=U,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case j2:return H=$P(q.type,q.key,q.props,null,U.mode,H),H.ref=Yw(U,null,q),H.return=U,H;case vv:return q=ND(q,U.mode,H),q.return=U,q;case op:var te=q._init;return C(U,te(q._payload),H)}if(y1(q)||Hw(q))return q=Hg(q,U.mode,H,null),q.return=U,q;W2(U,q)}return null}function k(U,q,H,te){var Q=q!==null?q.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return Q!==null?null:o(U,q,""+H,te);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case j2:return H.key===Q?v(U,q,H,te):null;case vv:return H.key===Q?w(U,q,H,te):null;case op:return Q=H._init,k(U,q,Q(H._payload),te)}if(y1(H)||Hw(H))return Q!==null?null:P(U,q,H,te,null);W2(U,H)}return null}function L(U,q,H,te,Q){if(typeof te=="string"&&te!==""||typeof te=="number")return U=U.get(H)||null,o(q,U,""+te,Q);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case j2:return U=U.get(te.key===null?H:te.key)||null,v(q,U,te,Q);case vv:return U=U.get(te.key===null?H:te.key)||null,w(q,U,te,Q);case op:var ae=te._init;return L(U,q,H,ae(te._payload),Q)}if(y1(te)||Hw(te))return U=U.get(H)||null,P(q,U,te,Q,null);W2(q,te)}return null}function $(U,q,H,te){for(var Q=null,ae=null,ue=q,me=q=0,Ce=null;ue!==null&&me<H.length;me++){ue.index>me?(Ce=ue,ue=null):Ce=ue.sibling;var Fe=k(U,ue,H[me],te);if(Fe===null){ue===null&&(ue=Ce);break}e&&ue&&Fe.alternate===null&&t(U,ue),q=u(Fe,q,me),ae===null?Q=Fe:ae.sibling=Fe,ae=Fe,ue=Ce}if(me===H.length)return r(U,ue),ko&&mg(U,me),Q;if(ue===null){for(;me<H.length;me++)ue=C(U,H[me],te),ue!==null&&(q=u(ue,q,me),ae===null?Q=ue:ae.sibling=ue,ae=ue);return ko&&mg(U,me),Q}for(ue=n(U,ue);me<H.length;me++)Ce=L(ue,U,me,H[me],te),Ce!==null&&(e&&Ce.alternate!==null&&ue.delete(Ce.key===null?me:Ce.key),q=u(Ce,q,me),ae===null?Q=Ce:ae.sibling=Ce,ae=Ce);return e&&ue.forEach(function(Ge){return t(U,Ge)}),ko&&mg(U,me),Q}function j(U,q,H,te){var Q=Hw(H);if(typeof Q!="function")throw Error(cr(150));if(H=Q.call(H),H==null)throw Error(cr(151));for(var ae=Q=null,ue=q,me=q=0,Ce=null,Fe=H.next();ue!==null&&!Fe.done;me++,Fe=H.next()){ue.index>me?(Ce=ue,ue=null):Ce=ue.sibling;var Ge=k(U,ue,Fe.value,te);if(Ge===null){ue===null&&(ue=Ce);break}e&&ue&&Ge.alternate===null&&t(U,ue),q=u(Ge,q,me),ae===null?Q=Ge:ae.sibling=Ge,ae=Ge,ue=Ce}if(Fe.done)return r(U,ue),ko&&mg(U,me),Q;if(ue===null){for(;!Fe.done;me++,Fe=H.next())Fe=C(U,Fe.value,te),Fe!==null&&(q=u(Fe,q,me),ae===null?Q=Fe:ae.sibling=Fe,ae=Fe);return ko&&mg(U,me),Q}for(ue=n(U,ue);!Fe.done;me++,Fe=H.next())Fe=L(ue,U,me,Fe.value,te),Fe!==null&&(e&&Fe.alternate!==null&&ue.delete(Fe.key===null?me:Fe.key),q=u(Fe,q,me),ae===null?Q=Fe:ae.sibling=Fe,ae=Fe);return e&&ue.forEach(function(Ve){return t(U,Ve)}),ko&&mg(U,me),Q}function B(U,q,H,te){if(typeof H=="object"&&H!==null&&H.type===xv&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case j2:e:{for(var Q=H.key,ae=q;ae!==null;){if(ae.key===Q){if(Q=H.type,Q===xv){if(ae.tag===7){r(U,ae.sibling),q=l(ae,H.props.children),q.return=U,U=q;break e}}else if(ae.elementType===Q||typeof Q=="object"&&Q!==null&&Q.$$typeof===op&&G8(Q)===ae.type){r(U,ae.sibling),q=l(ae,H.props),q.ref=Yw(U,ae,H),q.return=U,U=q;break e}r(U,ae);break}else t(U,ae);ae=ae.sibling}H.type===xv?(q=Hg(H.props.children,U.mode,te,H.key),q.return=U,U=q):(te=$P(H.type,H.key,H.props,null,U.mode,te),te.ref=Yw(U,q,H),te.return=U,U=te)}return f(U);case vv:e:{for(ae=H.key;q!==null;){if(q.key===ae)if(q.tag===4&&q.stateNode.containerInfo===H.containerInfo&&q.stateNode.implementation===H.implementation){r(U,q.sibling),q=l(q,H.children||[]),q.return=U,U=q;break e}else{r(U,q);break}else t(U,q);q=q.sibling}q=ND(H,U.mode,te),q.return=U,U=q}return f(U);case op:return ae=H._init,B(U,q,ae(H._payload),te)}if(y1(H))return $(U,q,H,te);if(Hw(H))return j(U,q,H,te);W2(U,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,q!==null&&q.tag===6?(r(U,q.sibling),q=l(q,H),q.return=U,U=q):(r(U,q),q=jD(H,U.mode,te),q.return=U,U=q),f(U)):r(U,q)}return B}var x0=rY(!0),nY=rY(!1),pC=em(null),mC=null,Cv=null,v3=null;function x3(){v3=Cv=mC=null}function b3(e){var t=pC.current;Eo(pC),e._currentValue=t}function Mj(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function qv(e,t){mC=e,v3=Cv=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(jl=!0),e.firstContext=null)}function Yc(e){var t=e._currentValue;if(v3!==e)if(e={context:e,memoizedValue:t,next:null},Cv===null){if(mC===null)throw Error(cr(308));Cv=e,mC.dependencies={lanes:0,firstContext:e}}else Cv=Cv.next=e;return t}var Ag=null;function w3(e){Ag===null?Ag=[e]:Ag.push(e)}function iY(e,t,r,n){var l=t.interleaved;return l===null?(r.next=r,w3(t)):(r.next=l.next,l.next=r),t.interleaved=r,Hh(e,n)}function Hh(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var sp=!1;function S3(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function oY(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fh(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Dp(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,Ti&2){var l=n.pending;return l===null?t.next=t:(t.next=l.next,l.next=t),n.pending=t,Hh(e,r)}return l=n.interleaved,l===null?(t.next=t,w3(n)):(t.next=l.next,l.next=t),n.interleaved=t,Hh(e,r)}function LP(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,l3(e,r)}}function q8(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var l=null,u=null;if(r=r.firstBaseUpdate,r!==null){do{var f={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};u===null?l=u=f:u=u.next=f,r=r.next}while(r!==null);u===null?l=u=t:u=u.next=t}else l=u=t;r={baseState:n.baseState,firstBaseUpdate:l,lastBaseUpdate:u,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function gC(e,t,r,n){var l=e.updateQueue;sp=!1;var u=l.firstBaseUpdate,f=l.lastBaseUpdate,o=l.shared.pending;if(o!==null){l.shared.pending=null;var v=o,w=v.next;v.next=null,f===null?u=w:f.next=w,f=v;var P=e.alternate;P!==null&&(P=P.updateQueue,o=P.lastBaseUpdate,o!==f&&(o===null?P.firstBaseUpdate=w:o.next=w,P.lastBaseUpdate=v))}if(u!==null){var C=l.baseState;f=0,P=w=v=null,o=u;do{var k=o.lane,L=o.eventTime;if((n&k)===k){P!==null&&(P=P.next={eventTime:L,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var $=e,j=o;switch(k=t,L=r,j.tag){case 1:if($=j.payload,typeof $=="function"){C=$.call(L,C,k);break e}C=$;break e;case 3:$.flags=$.flags&-65537|128;case 0:if($=j.payload,k=typeof $=="function"?$.call(L,C,k):$,k==null)break e;C=Ho({},C,k);break e;case 2:sp=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,k=l.effects,k===null?l.effects=[o]:k.push(o))}else L={eventTime:L,lane:k,tag:o.tag,payload:o.payload,callback:o.callback,next:null},P===null?(w=P=L,v=C):P=P.next=L,f|=k;if(o=o.next,o===null){if(o=l.shared.pending,o===null)break;k=o,o=k.next,k.next=null,l.lastBaseUpdate=k,l.shared.pending=null}}while(!0);if(P===null&&(v=C),l.baseState=v,l.firstBaseUpdate=w,l.lastBaseUpdate=P,t=l.shared.interleaved,t!==null){l=t;do f|=l.lane,l=l.next;while(l!==t)}else u===null&&(l.shared.lanes=0);ey|=f,e.lanes=f,e.memoizedState=C}}function H8(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],l=n.callback;if(l!==null){if(n.callback=null,n=r,typeof l!="function")throw Error(cr(191,l));l.call(n)}}}var MT={},Dd=em(MT),fS=em(MT),pS=em(MT);function Pg(e){if(e===MT)throw Error(cr(174));return e}function T3(e,t){switch(co(pS,t),co(fS,e),co(Dd,MT),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:fj(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=fj(t,e)}Eo(Dd),co(Dd,t)}function b0(){Eo(Dd),Eo(fS),Eo(pS)}function sY(e){Pg(pS.current);var t=Pg(Dd.current),r=fj(t,e.type);t!==r&&(co(fS,e),co(Dd,r))}function E3(e){fS.current===e&&(Eo(Dd),Eo(fS))}var $o=em(0);function yC(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var OD=[];function A3(){for(var e=0;e<OD.length;e++)OD[e]._workInProgressVersionPrimary=null;OD.length=0}var jP=nf.ReactCurrentDispatcher,kD=nf.ReactCurrentBatchConfig,Qg=0,qo=null,Bs=null,na=null,_C=!1,M1=!1,mS=0,zme=0;function ja(){throw Error(cr(321))}function P3(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!qu(e[r],t[r]))return!1;return!0}function C3(e,t,r,n,l,u){if(Qg=u,qo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,jP.current=e===null||e.memoizedState===null?Vme:Ume,e=r(n,l),M1){u=0;do{if(M1=!1,mS=0,25<=u)throw Error(cr(301));u+=1,na=Bs=null,t.updateQueue=null,jP.current=Gme,e=r(n,l)}while(M1)}if(jP.current=vC,t=Bs!==null&&Bs.next!==null,Qg=0,na=Bs=qo=null,_C=!1,t)throw Error(cr(300));return e}function I3(){var e=mS!==0;return mS=0,e}function Td(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return na===null?qo.memoizedState=na=e:na=na.next=e,na}function Jc(){if(Bs===null){var e=qo.alternate;e=e!==null?e.memoizedState:null}else e=Bs.next;var t=na===null?qo.memoizedState:na.next;if(t!==null)na=t,Bs=e;else{if(e===null)throw Error(cr(310));Bs=e,e={memoizedState:Bs.memoizedState,baseState:Bs.baseState,baseQueue:Bs.baseQueue,queue:Bs.queue,next:null},na===null?qo.memoizedState=na=e:na=na.next=e}return na}function gS(e,t){return typeof t=="function"?t(e):t}function RD(e){var t=Jc(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=Bs,l=n.baseQueue,u=r.pending;if(u!==null){if(l!==null){var f=l.next;l.next=u.next,u.next=f}n.baseQueue=l=u,r.pending=null}if(l!==null){u=l.next,n=n.baseState;var o=f=null,v=null,w=u;do{var P=w.lane;if((Qg&P)===P)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),n=w.hasEagerState?w.eagerState:e(n,w.action);else{var C={lane:P,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(o=v=C,f=n):v=v.next=C,qo.lanes|=P,ey|=P}w=w.next}while(w!==null&&w!==u);v===null?f=n:v.next=o,qu(n,t.memoizedState)||(jl=!0),t.memoizedState=n,t.baseState=f,t.baseQueue=v,r.lastRenderedState=n}if(e=r.interleaved,e!==null){l=e;do u=l.lane,qo.lanes|=u,ey|=u,l=l.next;while(l!==e)}else l===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function MD(e){var t=Jc(),r=t.queue;if(r===null)throw Error(cr(311));r.lastRenderedReducer=e;var n=r.dispatch,l=r.pending,u=t.memoizedState;if(l!==null){r.pending=null;var f=l=l.next;do u=e(u,f.action),f=f.next;while(f!==l);qu(u,t.memoizedState)||(jl=!0),t.memoizedState=u,t.baseQueue===null&&(t.baseState=u),r.lastRenderedState=u}return[u,n]}function aY(){}function lY(e,t){var r=qo,n=Jc(),l=t(),u=!qu(n.memoizedState,l);if(u&&(n.memoizedState=l,jl=!0),n=n.queue,O3(dY.bind(null,r,n,e),[e]),n.getSnapshot!==t||u||na!==null&&na.memoizedState.tag&1){if(r.flags|=2048,yS(9,uY.bind(null,r,n,l,t),void 0,null),oa===null)throw Error(cr(349));Qg&30||cY(r,t,l)}return l}function cY(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=qo.updateQueue,t===null?(t={lastEffect:null,stores:null},qo.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function uY(e,t,r,n){t.value=r,t.getSnapshot=n,hY(t)&&fY(e)}function dY(e,t,r){return r(function(){hY(t)&&fY(e)})}function hY(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!qu(e,r)}catch{return!0}}function fY(e){var t=Hh(e,1);t!==null&&$u(t,e,1,-1)}function W8(e){var t=Td();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gS,lastRenderedState:e},t.queue=e,e=e.dispatch=$me.bind(null,qo,e),[t.memoizedState,e]}function yS(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=qo.updateQueue,t===null?(t={lastEffect:null,stores:null},qo.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function pY(){return Jc().memoizedState}function NP(e,t,r,n){var l=Td();qo.flags|=e,l.memoizedState=yS(1|t,r,void 0,n===void 0?null:n)}function fO(e,t,r,n){var l=Jc();n=n===void 0?null:n;var u=void 0;if(Bs!==null){var f=Bs.memoizedState;if(u=f.destroy,n!==null&&P3(n,f.deps)){l.memoizedState=yS(t,r,u,n);return}}qo.flags|=e,l.memoizedState=yS(1|t,r,u,n)}function Z8(e,t){return NP(8390656,8,e,t)}function O3(e,t){return fO(2048,8,e,t)}function mY(e,t){return fO(4,2,e,t)}function gY(e,t){return fO(4,4,e,t)}function yY(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function _Y(e,t,r){return r=r!=null?r.concat([e]):null,fO(4,4,yY.bind(null,t,e),r)}function k3(){}function vY(e,t){var r=Jc();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&P3(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function xY(e,t){var r=Jc();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&P3(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function bY(e,t,r){return Qg&21?(qu(r,t)||(r=AK(),qo.lanes|=r,ey|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,jl=!0),e.memoizedState=r)}function Fme(e,t){var r=Ki;Ki=r!==0&&4>r?r:4,e(!0);var n=kD.transition;kD.transition={};try{e(!1),t()}finally{Ki=r,kD.transition=n}}function wY(){return Jc().memoizedState}function Bme(e,t,r){var n=jp(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},SY(e))TY(t,r);else if(r=iY(e,t,r,n),r!==null){var l=vl();$u(r,e,n,l),EY(r,t,n)}}function $me(e,t,r){var n=jp(e),l={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(SY(e))TY(t,l);else{var u=e.alternate;if(e.lanes===0&&(u===null||u.lanes===0)&&(u=t.lastRenderedReducer,u!==null))try{var f=t.lastRenderedState,o=u(f,r);if(l.hasEagerState=!0,l.eagerState=o,qu(o,f)){var v=t.interleaved;v===null?(l.next=l,w3(t)):(l.next=v.next,v.next=l),t.interleaved=l;return}}catch{}finally{}r=iY(e,t,l,n),r!==null&&(l=vl(),$u(r,e,n,l),EY(r,t,n))}}function SY(e){var t=e.alternate;return e===qo||t!==null&&t===qo}function TY(e,t){M1=_C=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function EY(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,l3(e,r)}}var vC={readContext:Yc,useCallback:ja,useContext:ja,useEffect:ja,useImperativeHandle:ja,useInsertionEffect:ja,useLayoutEffect:ja,useMemo:ja,useReducer:ja,useRef:ja,useState:ja,useDebugValue:ja,useDeferredValue:ja,useTransition:ja,useMutableSource:ja,useSyncExternalStore:ja,useId:ja,unstable_isNewReconciler:!1},Vme={readContext:Yc,useCallback:function(e,t){return Td().memoizedState=[e,t===void 0?null:t],e},useContext:Yc,useEffect:Z8,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,NP(4194308,4,yY.bind(null,t,e),r)},useLayoutEffect:function(e,t){return NP(4194308,4,e,t)},useInsertionEffect:function(e,t){return NP(4,2,e,t)},useMemo:function(e,t){var r=Td();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Td();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Bme.bind(null,qo,e),[n.memoizedState,e]},useRef:function(e){var t=Td();return e={current:e},t.memoizedState=e},useState:W8,useDebugValue:k3,useDeferredValue:function(e){return Td().memoizedState=e},useTransition:function(){var e=W8(!1),t=e[0];return e=Fme.bind(null,e[1]),Td().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=qo,l=Td();if(ko){if(r===void 0)throw Error(cr(407));r=r()}else{if(r=t(),oa===null)throw Error(cr(349));Qg&30||cY(n,t,r)}l.memoizedState=r;var u={value:r,getSnapshot:t};return l.queue=u,Z8(dY.bind(null,n,u,e),[e]),n.flags|=2048,yS(9,uY.bind(null,n,u,r,t),void 0,null),r},useId:function(){var e=Td(),t=oa.identifierPrefix;if(ko){var r=Mh,n=Rh;r=(n&~(1<<32-Bu(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=mS++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=zme++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Ume={readContext:Yc,useCallback:vY,useContext:Yc,useEffect:O3,useImperativeHandle:_Y,useInsertionEffect:mY,useLayoutEffect:gY,useMemo:xY,useReducer:RD,useRef:pY,useState:function(){return RD(gS)},useDebugValue:k3,useDeferredValue:function(e){var t=Jc();return bY(t,Bs.memoizedState,e)},useTransition:function(){var e=RD(gS)[0],t=Jc().memoizedState;return[e,t]},useMutableSource:aY,useSyncExternalStore:lY,useId:wY,unstable_isNewReconciler:!1},Gme={readContext:Yc,useCallback:vY,useContext:Yc,useEffect:O3,useImperativeHandle:_Y,useInsertionEffect:mY,useLayoutEffect:gY,useMemo:xY,useReducer:MD,useRef:pY,useState:function(){return MD(gS)},useDebugValue:k3,useDeferredValue:function(e){var t=Jc();return Bs===null?t.memoizedState=e:bY(t,Bs.memoizedState,e)},useTransition:function(){var e=MD(gS)[0],t=Jc().memoizedState;return[e,t]},useMutableSource:aY,useSyncExternalStore:lY,useId:wY,unstable_isNewReconciler:!1};function Cu(e,t){if(e&&e.defaultProps){t=Ho({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Dj(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:Ho({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var pO={isMounted:function(e){return(e=e._reactInternals)?vy(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=vl(),l=jp(e),u=Fh(n,l);u.payload=t,r!=null&&(u.callback=r),t=Dp(e,u,l),t!==null&&($u(t,e,l,n),LP(t,e,l))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=vl(),l=jp(e),u=Fh(n,l);u.tag=1,u.payload=t,r!=null&&(u.callback=r),t=Dp(e,u,l),t!==null&&($u(t,e,l,n),LP(t,e,l))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=vl(),n=jp(e),l=Fh(r,n);l.tag=2,t!=null&&(l.callback=t),t=Dp(e,l,n),t!==null&&($u(t,e,n,r),LP(t,e,n))}};function X8(e,t,r,n,l,u,f){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,u,f):t.prototype&&t.prototype.isPureReactComponent?!cS(r,n)||!cS(l,u):!0}function AY(e,t,r){var n=!1,l=Gp,u=t.contextType;return typeof u=="object"&&u!==null?u=Yc(u):(l=Fl(t)?Yg:Ga.current,n=t.contextTypes,u=(n=n!=null)?_0(e,l):Gp),t=new t(r,u),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=pO,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=l,e.__reactInternalMemoizedMaskedChildContext=u),t}function K8(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&pO.enqueueReplaceState(t,t.state,null)}function Lj(e,t,r,n){var l=e.stateNode;l.props=r,l.state=e.memoizedState,l.refs={},S3(e);var u=t.contextType;typeof u=="object"&&u!==null?l.context=Yc(u):(u=Fl(t)?Yg:Ga.current,l.context=_0(e,u)),l.state=e.memoizedState,u=t.getDerivedStateFromProps,typeof u=="function"&&(Dj(e,t,u,r),l.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof l.getSnapshotBeforeUpdate=="function"||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(t=l.state,typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount(),t!==l.state&&pO.enqueueReplaceState(l,l.state,null),gC(e,r,l,n),l.state=e.memoizedState),typeof l.componentDidMount=="function"&&(e.flags|=4194308)}function w0(e,t){try{var r="",n=t;do r+=_pe(n),n=n.return;while(n);var l=r}catch(u){l=`
Error generating stack: `+u.message+`
`+u.stack}return{value:e,source:t,stack:l,digest:null}}function DD(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function jj(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var qme=typeof WeakMap=="function"?WeakMap:Map;function PY(e,t,r){r=Fh(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){bC||(bC=!0,Hj=n),jj(e,t)},r}function CY(e,t,r){r=Fh(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var l=t.value;r.payload=function(){return n(l)},r.callback=function(){jj(e,t)}}var u=e.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(r.callback=function(){jj(e,t),typeof n!="function"&&(Lp===null?Lp=new Set([this]):Lp.add(this));var f=t.stack;this.componentDidCatch(t.value,{componentStack:f!==null?f:""})}),r}function Y8(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new qme;var l=new Set;n.set(t,l)}else l=n.get(t),l===void 0&&(l=new Set,n.set(t,l));l.has(r)||(l.add(r),e=oge.bind(null,e,t,r),t.then(e,e))}function J8(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Q8(e,t,r,n,l){return e.mode&1?(e.flags|=65536,e.lanes=l,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Fh(-1,1),t.tag=2,Dp(r,t,1))),r.lanes|=1),e)}var Hme=nf.ReactCurrentOwner,jl=!1;function dl(e,t,r,n){t.child=e===null?nY(t,null,r,n):x0(t,e.child,r,n)}function eG(e,t,r,n,l){r=r.render;var u=t.ref;return qv(t,l),n=C3(e,t,r,n,u,l),r=I3(),e!==null&&!jl?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,Wh(e,t,l)):(ko&&r&&g3(t),t.flags|=1,dl(e,t,n,l),t.child)}function tG(e,t,r,n,l){if(e===null){var u=r.type;return typeof u=="function"&&!F3(u)&&u.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=u,IY(e,t,u,n,l)):(e=$P(r.type,null,n,t,t.mode,l),e.ref=t.ref,e.return=t,t.child=e)}if(u=e.child,!(e.lanes&l)){var f=u.memoizedProps;if(r=r.compare,r=r!==null?r:cS,r(f,n)&&e.ref===t.ref)return Wh(e,t,l)}return t.flags|=1,e=Np(u,n),e.ref=t.ref,e.return=t,t.child=e}function IY(e,t,r,n,l){if(e!==null){var u=e.memoizedProps;if(cS(u,n)&&e.ref===t.ref)if(jl=!1,t.pendingProps=n=u,(e.lanes&l)!==0)e.flags&131072&&(jl=!0);else return t.lanes=e.lanes,Wh(e,t,l)}return Nj(e,t,r,n,l)}function OY(e,t,r){var n=t.pendingProps,l=n.children,u=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},co(Ov,Ql),Ql|=r;else{if(!(r&1073741824))return e=u!==null?u.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,co(Ov,Ql),Ql|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=u!==null?u.baseLanes:r,co(Ov,Ql),Ql|=n}else u!==null?(n=u.baseLanes|r,t.memoizedState=null):n=r,co(Ov,Ql),Ql|=n;return dl(e,t,l,r),t.child}function kY(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Nj(e,t,r,n,l){var u=Fl(r)?Yg:Ga.current;return u=_0(t,u),qv(t,l),r=C3(e,t,r,n,u,l),n=I3(),e!==null&&!jl?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~l,Wh(e,t,l)):(ko&&n&&g3(t),t.flags|=1,dl(e,t,r,l),t.child)}function rG(e,t,r,n,l){if(Fl(r)){var u=!0;dC(t)}else u=!1;if(qv(t,l),t.stateNode===null)zP(e,t),AY(t,r,n),Lj(t,r,n,l),n=!0;else if(e===null){var f=t.stateNode,o=t.memoizedProps;f.props=o;var v=f.context,w=r.contextType;typeof w=="object"&&w!==null?w=Yc(w):(w=Fl(r)?Yg:Ga.current,w=_0(t,w));var P=r.getDerivedStateFromProps,C=typeof P=="function"||typeof f.getSnapshotBeforeUpdate=="function";C||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(o!==n||v!==w)&&K8(t,f,n,w),sp=!1;var k=t.memoizedState;f.state=k,gC(t,n,f,l),v=t.memoizedState,o!==n||k!==v||zl.current||sp?(typeof P=="function"&&(Dj(t,r,P,n),v=t.memoizedState),(o=sp||X8(t,r,o,n,k,v,w))?(C||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(t.flags|=4194308)):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=v),f.props=n,f.state=v,f.context=w,n=o):(typeof f.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{f=t.stateNode,oY(e,t),o=t.memoizedProps,w=t.type===t.elementType?o:Cu(t.type,o),f.props=w,C=t.pendingProps,k=f.context,v=r.contextType,typeof v=="object"&&v!==null?v=Yc(v):(v=Fl(r)?Yg:Ga.current,v=_0(t,v));var L=r.getDerivedStateFromProps;(P=typeof L=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(o!==C||k!==v)&&K8(t,f,n,v),sp=!1,k=t.memoizedState,f.state=k,gC(t,n,f,l);var $=t.memoizedState;o!==C||k!==$||zl.current||sp?(typeof L=="function"&&(Dj(t,r,L,n),$=t.memoizedState),(w=sp||X8(t,r,w,n,k,$,v)||!1)?(P||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(n,$,v),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(n,$,v)),typeof f.componentDidUpdate=="function"&&(t.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof f.componentDidUpdate!="function"||o===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=$),f.props=n,f.state=$,f.context=v,n=w):(typeof f.componentDidUpdate!="function"||o===e.memoizedProps&&k===e.memoizedState||(t.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&k===e.memoizedState||(t.flags|=1024),n=!1)}return zj(e,t,r,n,u,l)}function zj(e,t,r,n,l,u){kY(e,t);var f=(t.flags&128)!==0;if(!n&&!f)return l&&$8(t,r,!1),Wh(e,t,u);n=t.stateNode,Hme.current=t;var o=f&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&f?(t.child=x0(t,e.child,null,u),t.child=x0(t,null,o,u)):dl(e,t,o,u),t.memoizedState=n.state,l&&$8(t,r,!0),t.child}function RY(e){var t=e.stateNode;t.pendingContext?B8(e,t.pendingContext,t.pendingContext!==t.context):t.context&&B8(e,t.context,!1),T3(e,t.containerInfo)}function nG(e,t,r,n,l){return v0(),_3(l),t.flags|=256,dl(e,t,r,n),t.child}var Fj={dehydrated:null,treeContext:null,retryLane:0};function Bj(e){return{baseLanes:e,cachePool:null,transitions:null}}function MY(e,t,r){var n=t.pendingProps,l=$o.current,u=!1,f=(t.flags&128)!==0,o;if((o=f)||(o=e!==null&&e.memoizedState===null?!1:(l&2)!==0),o?(u=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(l|=1),co($o,l&1),e===null)return Rj(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(f=n.children,e=n.fallback,u?(n=t.mode,u=t.child,f={mode:"hidden",children:f},!(n&1)&&u!==null?(u.childLanes=0,u.pendingProps=f):u=yO(f,n,0,null),e=Hg(e,n,r,null),u.return=t,e.return=t,u.sibling=e,t.child=u,t.child.memoizedState=Bj(r),t.memoizedState=Fj,e):R3(t,f));if(l=e.memoizedState,l!==null&&(o=l.dehydrated,o!==null))return Wme(e,t,f,n,o,l,r);if(u){u=n.fallback,f=t.mode,l=e.child,o=l.sibling;var v={mode:"hidden",children:n.children};return!(f&1)&&t.child!==l?(n=t.child,n.childLanes=0,n.pendingProps=v,t.deletions=null):(n=Np(l,v),n.subtreeFlags=l.subtreeFlags&14680064),o!==null?u=Np(o,u):(u=Hg(u,f,r,null),u.flags|=2),u.return=t,n.return=t,n.sibling=u,t.child=n,n=u,u=t.child,f=e.child.memoizedState,f=f===null?Bj(r):{baseLanes:f.baseLanes|r,cachePool:null,transitions:f.transitions},u.memoizedState=f,u.childLanes=e.childLanes&~r,t.memoizedState=Fj,n}return u=e.child,e=u.sibling,n=Np(u,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function R3(e,t){return t=yO({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Z2(e,t,r,n){return n!==null&&_3(n),x0(t,e.child,null,r),e=R3(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Wme(e,t,r,n,l,u,f){if(r)return t.flags&256?(t.flags&=-257,n=DD(Error(cr(422))),Z2(e,t,f,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(u=n.fallback,l=t.mode,n=yO({mode:"visible",children:n.children},l,0,null),u=Hg(u,l,f,null),u.flags|=2,n.return=t,u.return=t,n.sibling=u,t.child=n,t.mode&1&&x0(t,e.child,null,f),t.child.memoizedState=Bj(f),t.memoizedState=Fj,u);if(!(t.mode&1))return Z2(e,t,f,null);if(l.data==="$!"){if(n=l.nextSibling&&l.nextSibling.dataset,n)var o=n.dgst;return n=o,u=Error(cr(419)),n=DD(u,n,void 0),Z2(e,t,f,n)}if(o=(f&e.childLanes)!==0,jl||o){if(n=oa,n!==null){switch(f&-f){case 4:l=2;break;case 16:l=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:l=32;break;case 536870912:l=268435456;break;default:l=0}l=l&(n.suspendedLanes|f)?0:l,l!==0&&l!==u.retryLane&&(u.retryLane=l,Hh(e,l),$u(n,e,l,-1))}return z3(),n=DD(Error(cr(421))),Z2(e,t,f,n)}return l.data==="$?"?(t.flags|=128,t.child=e.child,t=sge.bind(null,e),l._reactRetry=t,null):(e=u.treeContext,lc=Mp(l.nextSibling),cc=t,ko=!0,ju=null,e!==null&&($c[Vc++]=Rh,$c[Vc++]=Mh,$c[Vc++]=Jg,Rh=e.id,Mh=e.overflow,Jg=t),t=R3(t,n.children),t.flags|=4096,t)}function iG(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Mj(e.return,t,r)}function LD(e,t,r,n,l){var u=e.memoizedState;u===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:l}:(u.isBackwards=t,u.rendering=null,u.renderingStartTime=0,u.last=n,u.tail=r,u.tailMode=l)}function DY(e,t,r){var n=t.pendingProps,l=n.revealOrder,u=n.tail;if(dl(e,t,n.children,r),n=$o.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&iG(e,r,t);else if(e.tag===19)iG(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(co($o,n),!(t.mode&1))t.memoizedState=null;else switch(l){case"forwards":for(r=t.child,l=null;r!==null;)e=r.alternate,e!==null&&yC(e)===null&&(l=r),r=r.sibling;r=l,r===null?(l=t.child,t.child=null):(l=r.sibling,r.sibling=null),LD(t,!1,l,r,u);break;case"backwards":for(r=null,l=t.child,t.child=null;l!==null;){if(e=l.alternate,e!==null&&yC(e)===null){t.child=l;break}e=l.sibling,l.sibling=r,r=l,l=e}LD(t,!0,r,null,u);break;case"together":LD(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function zP(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Wh(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),ey|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(cr(153));if(t.child!==null){for(e=t.child,r=Np(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Np(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Zme(e,t,r){switch(t.tag){case 3:RY(t),v0();break;case 5:sY(t);break;case 1:Fl(t.type)&&dC(t);break;case 4:T3(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,l=t.memoizedProps.value;co(pC,n._currentValue),n._currentValue=l;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(co($o,$o.current&1),t.flags|=128,null):r&t.child.childLanes?MY(e,t,r):(co($o,$o.current&1),e=Wh(e,t,r),e!==null?e.sibling:null);co($o,$o.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return DY(e,t,r);t.flags|=128}if(l=t.memoizedState,l!==null&&(l.rendering=null,l.tail=null,l.lastEffect=null),co($o,$o.current),n)break;return null;case 22:case 23:return t.lanes=0,OY(e,t,r)}return Wh(e,t,r)}var LY,$j,jY,NY;LY=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};$j=function(){};jY=function(e,t,r,n){var l=e.memoizedProps;if(l!==n){e=t.stateNode,Pg(Dd.current);var u=null;switch(r){case"input":l=cj(e,l),n=cj(e,n),u=[];break;case"select":l=Ho({},l,{value:void 0}),n=Ho({},n,{value:void 0}),u=[];break;case"textarea":l=hj(e,l),n=hj(e,n),u=[];break;default:typeof l.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=cC)}pj(r,n);var f;r=null;for(w in l)if(!n.hasOwnProperty(w)&&l.hasOwnProperty(w)&&l[w]!=null)if(w==="style"){var o=l[w];for(f in o)o.hasOwnProperty(f)&&(r||(r={}),r[f]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(rS.hasOwnProperty(w)?u||(u=[]):(u=u||[]).push(w,null));for(w in n){var v=n[w];if(o=l!=null?l[w]:void 0,n.hasOwnProperty(w)&&v!==o&&(v!=null||o!=null))if(w==="style")if(o){for(f in o)!o.hasOwnProperty(f)||v&&v.hasOwnProperty(f)||(r||(r={}),r[f]="");for(f in v)v.hasOwnProperty(f)&&o[f]!==v[f]&&(r||(r={}),r[f]=v[f])}else r||(u||(u=[]),u.push(w,r)),r=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,o=o?o.__html:void 0,v!=null&&o!==v&&(u=u||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(u=u||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(rS.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&wo("scroll",e),u||o===v||(u=[])):(u=u||[]).push(w,v))}r&&(u=u||[]).push("style",r);var w=u;(t.updateQueue=w)&&(t.flags|=4)}};NY=function(e,t,r,n){r!==n&&(t.flags|=4)};function Jw(e,t){if(!ko)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Na(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var l=e.child;l!==null;)r|=l.lanes|l.childLanes,n|=l.subtreeFlags&14680064,n|=l.flags&14680064,l.return=e,l=l.sibling;else for(l=e.child;l!==null;)r|=l.lanes|l.childLanes,n|=l.subtreeFlags,n|=l.flags,l.return=e,l=l.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Xme(e,t,r){var n=t.pendingProps;switch(y3(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Na(t),null;case 1:return Fl(t.type)&&uC(),Na(t),null;case 3:return n=t.stateNode,b0(),Eo(zl),Eo(Ga),A3(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(H2(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,ju!==null&&(Xj(ju),ju=null))),$j(e,t),Na(t),null;case 5:E3(t);var l=Pg(pS.current);if(r=t.type,e!==null&&t.stateNode!=null)jY(e,t,r,n,l),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(cr(166));return Na(t),null}if(e=Pg(Dd.current),H2(t)){n=t.stateNode,r=t.type;var u=t.memoizedProps;switch(n[Cd]=t,n[hS]=u,e=(t.mode&1)!==0,r){case"dialog":wo("cancel",n),wo("close",n);break;case"iframe":case"object":case"embed":wo("load",n);break;case"video":case"audio":for(l=0;l<v1.length;l++)wo(v1[l],n);break;case"source":wo("error",n);break;case"img":case"image":case"link":wo("error",n),wo("load",n);break;case"details":wo("toggle",n);break;case"input":f8(n,u),wo("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!u.multiple},wo("invalid",n);break;case"textarea":m8(n,u),wo("invalid",n)}pj(r,u),l=null;for(var f in u)if(u.hasOwnProperty(f)){var o=u[f];f==="children"?typeof o=="string"?n.textContent!==o&&(u.suppressHydrationWarning!==!0&&q2(n.textContent,o,e),l=["children",o]):typeof o=="number"&&n.textContent!==""+o&&(u.suppressHydrationWarning!==!0&&q2(n.textContent,o,e),l=["children",""+o]):rS.hasOwnProperty(f)&&o!=null&&f==="onScroll"&&wo("scroll",n)}switch(r){case"input":N2(n),p8(n,u,!0);break;case"textarea":N2(n),g8(n);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(n.onclick=cC)}n=l,t.updateQueue=n,n!==null&&(t.flags|=4)}else{f=l.nodeType===9?l:l.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=dK(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=f.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=f.createElement(r,{is:n.is}):(e=f.createElement(r),r==="select"&&(f=e,n.multiple?f.multiple=!0:n.size&&(f.size=n.size))):e=f.createElementNS(e,r),e[Cd]=t,e[hS]=n,LY(e,t,!1,!1),t.stateNode=e;e:{switch(f=mj(r,n),r){case"dialog":wo("cancel",e),wo("close",e),l=n;break;case"iframe":case"object":case"embed":wo("load",e),l=n;break;case"video":case"audio":for(l=0;l<v1.length;l++)wo(v1[l],e);l=n;break;case"source":wo("error",e),l=n;break;case"img":case"image":case"link":wo("error",e),wo("load",e),l=n;break;case"details":wo("toggle",e),l=n;break;case"input":f8(e,n),l=cj(e,n),wo("invalid",e);break;case"option":l=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},l=Ho({},n,{value:void 0}),wo("invalid",e);break;case"textarea":m8(e,n),l=hj(e,n),wo("invalid",e);break;default:l=n}pj(r,l),o=l;for(u in o)if(o.hasOwnProperty(u)){var v=o[u];u==="style"?pK(e,v):u==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&hK(e,v)):u==="children"?typeof v=="string"?(r!=="textarea"||v!=="")&&nS(e,v):typeof v=="number"&&nS(e,""+v):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(rS.hasOwnProperty(u)?v!=null&&u==="onScroll"&&wo("scroll",e):v!=null&&r3(e,u,v,f))}switch(r){case"input":N2(e),p8(e,n,!1);break;case"textarea":N2(e),g8(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Up(n.value));break;case"select":e.multiple=!!n.multiple,u=n.value,u!=null?$v(e,!!n.multiple,u,!1):n.defaultValue!=null&&$v(e,!!n.multiple,n.defaultValue,!0);break;default:typeof l.onClick=="function"&&(e.onclick=cC)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Na(t),null;case 6:if(e&&t.stateNode!=null)NY(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(cr(166));if(r=Pg(pS.current),Pg(Dd.current),H2(t)){if(n=t.stateNode,r=t.memoizedProps,n[Cd]=t,(u=n.nodeValue!==r)&&(e=cc,e!==null))switch(e.tag){case 3:q2(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&q2(n.nodeValue,r,(e.mode&1)!==0)}u&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Cd]=t,t.stateNode=n}return Na(t),null;case 13:if(Eo($o),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ko&&lc!==null&&t.mode&1&&!(t.flags&128))tY(),v0(),t.flags|=98560,u=!1;else if(u=H2(t),n!==null&&n.dehydrated!==null){if(e===null){if(!u)throw Error(cr(318));if(u=t.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(cr(317));u[Cd]=t}else v0(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Na(t),u=!1}else ju!==null&&(Xj(ju),ju=null),u=!0;if(!u)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||$o.current&1?Vs===0&&(Vs=3):z3())),t.updateQueue!==null&&(t.flags|=4),Na(t),null);case 4:return b0(),$j(e,t),e===null&&uS(t.stateNode.containerInfo),Na(t),null;case 10:return b3(t.type._context),Na(t),null;case 17:return Fl(t.type)&&uC(),Na(t),null;case 19:if(Eo($o),u=t.memoizedState,u===null)return Na(t),null;if(n=(t.flags&128)!==0,f=u.rendering,f===null)if(n)Jw(u,!1);else{if(Vs!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(f=yC(e),f!==null){for(t.flags|=128,Jw(u,!1),n=f.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)u=r,e=n,u.flags&=14680066,f=u.alternate,f===null?(u.childLanes=0,u.lanes=e,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=f.childLanes,u.lanes=f.lanes,u.child=f.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=f.memoizedProps,u.memoizedState=f.memoizedState,u.updateQueue=f.updateQueue,u.type=f.type,e=f.dependencies,u.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return co($o,$o.current&1|2),t.child}e=e.sibling}u.tail!==null&&ds()>S0&&(t.flags|=128,n=!0,Jw(u,!1),t.lanes=4194304)}else{if(!n)if(e=yC(f),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),Jw(u,!0),u.tail===null&&u.tailMode==="hidden"&&!f.alternate&&!ko)return Na(t),null}else 2*ds()-u.renderingStartTime>S0&&r!==1073741824&&(t.flags|=128,n=!0,Jw(u,!1),t.lanes=4194304);u.isBackwards?(f.sibling=t.child,t.child=f):(r=u.last,r!==null?r.sibling=f:t.child=f,u.last=f)}return u.tail!==null?(t=u.tail,u.rendering=t,u.tail=t.sibling,u.renderingStartTime=ds(),t.sibling=null,r=$o.current,co($o,n?r&1|2:r&1),t):(Na(t),null);case 22:case 23:return N3(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Ql&1073741824&&(Na(t),t.subtreeFlags&6&&(t.flags|=8192)):Na(t),null;case 24:return null;case 25:return null}throw Error(cr(156,t.tag))}function Kme(e,t){switch(y3(t),t.tag){case 1:return Fl(t.type)&&uC(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return b0(),Eo(zl),Eo(Ga),A3(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return E3(t),null;case 13:if(Eo($o),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(cr(340));v0()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Eo($o),null;case 4:return b0(),null;case 10:return b3(t.type._context),null;case 22:case 23:return N3(),null;case 24:return null;default:return null}}var X2=!1,Ba=!1,Yme=typeof WeakSet=="function"?WeakSet:Set,zr=null;function Iv(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){is(e,t,n)}else r.current=null}function Vj(e,t,r){try{r()}catch(n){is(e,t,n)}}var oG=!1;function Jme(e,t){if(Ej=sC,e=VK(),m3(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var l=n.anchorOffset,u=n.focusNode;n=n.focusOffset;try{r.nodeType,u.nodeType}catch{r=null;break e}var f=0,o=-1,v=-1,w=0,P=0,C=e,k=null;t:for(;;){for(var L;C!==r||l!==0&&C.nodeType!==3||(o=f+l),C!==u||n!==0&&C.nodeType!==3||(v=f+n),C.nodeType===3&&(f+=C.nodeValue.length),(L=C.firstChild)!==null;)k=C,C=L;for(;;){if(C===e)break t;if(k===r&&++w===l&&(o=f),k===u&&++P===n&&(v=f),(L=C.nextSibling)!==null)break;C=k,k=C.parentNode}C=L}r=o===-1||v===-1?null:{start:o,end:v}}else r=null}r=r||{start:0,end:0}}else r=null;for(Aj={focusedElem:e,selectionRange:r},sC=!1,zr=t;zr!==null;)if(t=zr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,zr=e;else for(;zr!==null;){t=zr;try{var $=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if($!==null){var j=$.memoizedProps,B=$.memoizedState,U=t.stateNode,q=U.getSnapshotBeforeUpdate(t.elementType===t.type?j:Cu(t.type,j),B);U.__reactInternalSnapshotBeforeUpdate=q}break;case 3:var H=t.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(cr(163))}}catch(te){is(t,t.return,te)}if(e=t.sibling,e!==null){e.return=t.return,zr=e;break}zr=t.return}return $=oG,oG=!1,$}function D1(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var l=n=n.next;do{if((l.tag&e)===e){var u=l.destroy;l.destroy=void 0,u!==void 0&&Vj(t,r,u)}l=l.next}while(l!==n)}}function mO(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Uj(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function zY(e){var t=e.alternate;t!==null&&(e.alternate=null,zY(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Cd],delete t[hS],delete t[Ij],delete t[Dme],delete t[Lme])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function FY(e){return e.tag===5||e.tag===3||e.tag===4}function sG(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||FY(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Gj(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=cC));else if(n!==4&&(e=e.child,e!==null))for(Gj(e,t,r),e=e.sibling;e!==null;)Gj(e,t,r),e=e.sibling}function qj(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(qj(e,t,r),e=e.sibling;e!==null;)qj(e,t,r),e=e.sibling}var wa=null,Ru=!1;function Qf(e,t,r){for(r=r.child;r!==null;)BY(e,t,r),r=r.sibling}function BY(e,t,r){if(Md&&typeof Md.onCommitFiberUnmount=="function")try{Md.onCommitFiberUnmount(aO,r)}catch{}switch(r.tag){case 5:Ba||Iv(r,t);case 6:var n=wa,l=Ru;wa=null,Qf(e,t,r),wa=n,Ru=l,wa!==null&&(Ru?(e=wa,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):wa.removeChild(r.stateNode));break;case 18:wa!==null&&(Ru?(e=wa,r=r.stateNode,e.nodeType===8?CD(e.parentNode,r):e.nodeType===1&&CD(e,r),aS(e)):CD(wa,r.stateNode));break;case 4:n=wa,l=Ru,wa=r.stateNode.containerInfo,Ru=!0,Qf(e,t,r),wa=n,Ru=l;break;case 0:case 11:case 14:case 15:if(!Ba&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){l=n=n.next;do{var u=l,f=u.destroy;u=u.tag,f!==void 0&&(u&2||u&4)&&Vj(r,t,f),l=l.next}while(l!==n)}Qf(e,t,r);break;case 1:if(!Ba&&(Iv(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(o){is(r,t,o)}Qf(e,t,r);break;case 21:Qf(e,t,r);break;case 22:r.mode&1?(Ba=(n=Ba)||r.memoizedState!==null,Qf(e,t,r),Ba=n):Qf(e,t,r);break;default:Qf(e,t,r)}}function aG(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Yme),t.forEach(function(n){var l=age.bind(null,e,n);r.has(n)||(r.add(n),n.then(l,l))})}}function bu(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var l=r[n];try{var u=e,f=t,o=f;e:for(;o!==null;){switch(o.tag){case 5:wa=o.stateNode,Ru=!1;break e;case 3:wa=o.stateNode.containerInfo,Ru=!0;break e;case 4:wa=o.stateNode.containerInfo,Ru=!0;break e}o=o.return}if(wa===null)throw Error(cr(160));BY(u,f,l),wa=null,Ru=!1;var v=l.alternate;v!==null&&(v.return=null),l.return=null}catch(w){is(l,t,w)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)$Y(t,e),t=t.sibling}function $Y(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(bu(t,e),Sd(e),n&4){try{D1(3,e,e.return),mO(3,e)}catch(j){is(e,e.return,j)}try{D1(5,e,e.return)}catch(j){is(e,e.return,j)}}break;case 1:bu(t,e),Sd(e),n&512&&r!==null&&Iv(r,r.return);break;case 5:if(bu(t,e),Sd(e),n&512&&r!==null&&Iv(r,r.return),e.flags&32){var l=e.stateNode;try{nS(l,"")}catch(j){is(e,e.return,j)}}if(n&4&&(l=e.stateNode,l!=null)){var u=e.memoizedProps,f=r!==null?r.memoizedProps:u,o=e.type,v=e.updateQueue;if(e.updateQueue=null,v!==null)try{o==="input"&&u.type==="radio"&&u.name!=null&&cK(l,u),mj(o,f);var w=mj(o,u);for(f=0;f<v.length;f+=2){var P=v[f],C=v[f+1];P==="style"?pK(l,C):P==="dangerouslySetInnerHTML"?hK(l,C):P==="children"?nS(l,C):r3(l,P,C,w)}switch(o){case"input":uj(l,u);break;case"textarea":uK(l,u);break;case"select":var k=l._wrapperState.wasMultiple;l._wrapperState.wasMultiple=!!u.multiple;var L=u.value;L!=null?$v(l,!!u.multiple,L,!1):k!==!!u.multiple&&(u.defaultValue!=null?$v(l,!!u.multiple,u.defaultValue,!0):$v(l,!!u.multiple,u.multiple?[]:"",!1))}l[hS]=u}catch(j){is(e,e.return,j)}}break;case 6:if(bu(t,e),Sd(e),n&4){if(e.stateNode===null)throw Error(cr(162));l=e.stateNode,u=e.memoizedProps;try{l.nodeValue=u}catch(j){is(e,e.return,j)}}break;case 3:if(bu(t,e),Sd(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{aS(t.containerInfo)}catch(j){is(e,e.return,j)}break;case 4:bu(t,e),Sd(e);break;case 13:bu(t,e),Sd(e),l=e.child,l.flags&8192&&(u=l.memoizedState!==null,l.stateNode.isHidden=u,!u||l.alternate!==null&&l.alternate.memoizedState!==null||(L3=ds())),n&4&&aG(e);break;case 22:if(P=r!==null&&r.memoizedState!==null,e.mode&1?(Ba=(w=Ba)||P,bu(t,e),Ba=w):bu(t,e),Sd(e),n&8192){if(w=e.memoizedState!==null,(e.stateNode.isHidden=w)&&!P&&e.mode&1)for(zr=e,P=e.child;P!==null;){for(C=zr=P;zr!==null;){switch(k=zr,L=k.child,k.tag){case 0:case 11:case 14:case 15:D1(4,k,k.return);break;case 1:Iv(k,k.return);var $=k.stateNode;if(typeof $.componentWillUnmount=="function"){n=k,r=k.return;try{t=n,$.props=t.memoizedProps,$.state=t.memoizedState,$.componentWillUnmount()}catch(j){is(n,r,j)}}break;case 5:Iv(k,k.return);break;case 22:if(k.memoizedState!==null){cG(C);continue}}L!==null?(L.return=k,zr=L):cG(C)}P=P.sibling}e:for(P=null,C=e;;){if(C.tag===5){if(P===null){P=C;try{l=C.stateNode,w?(u=l.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(o=C.stateNode,v=C.memoizedProps.style,f=v!=null&&v.hasOwnProperty("display")?v.display:null,o.style.display=fK("display",f))}catch(j){is(e,e.return,j)}}}else if(C.tag===6){if(P===null)try{C.stateNode.nodeValue=w?"":C.memoizedProps}catch(j){is(e,e.return,j)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;P===C&&(P=null),C=C.return}P===C&&(P=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:bu(t,e),Sd(e),n&4&&aG(e);break;case 21:break;default:bu(t,e),Sd(e)}}function Sd(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(FY(r)){var n=r;break e}r=r.return}throw Error(cr(160))}switch(n.tag){case 5:var l=n.stateNode;n.flags&32&&(nS(l,""),n.flags&=-33);var u=sG(e);qj(e,u,l);break;case 3:case 4:var f=n.stateNode.containerInfo,o=sG(e);Gj(e,o,f);break;default:throw Error(cr(161))}}catch(v){is(e,e.return,v)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Qme(e,t,r){zr=e,VY(e)}function VY(e,t,r){for(var n=(e.mode&1)!==0;zr!==null;){var l=zr,u=l.child;if(l.tag===22&&n){var f=l.memoizedState!==null||X2;if(!f){var o=l.alternate,v=o!==null&&o.memoizedState!==null||Ba;o=X2;var w=Ba;if(X2=f,(Ba=v)&&!w)for(zr=l;zr!==null;)f=zr,v=f.child,f.tag===22&&f.memoizedState!==null?uG(l):v!==null?(v.return=f,zr=v):uG(l);for(;u!==null;)zr=u,VY(u),u=u.sibling;zr=l,X2=o,Ba=w}lG(e)}else l.subtreeFlags&8772&&u!==null?(u.return=l,zr=u):lG(e)}}function lG(e){for(;zr!==null;){var t=zr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Ba||mO(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!Ba)if(r===null)n.componentDidMount();else{var l=t.elementType===t.type?r.memoizedProps:Cu(t.type,r.memoizedProps);n.componentDidUpdate(l,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var u=t.updateQueue;u!==null&&H8(t,u,n);break;case 3:var f=t.updateQueue;if(f!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}H8(t,f,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var v=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&r.focus();break;case"img":v.src&&(r.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var w=t.alternate;if(w!==null){var P=w.memoizedState;if(P!==null){var C=P.dehydrated;C!==null&&aS(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(cr(163))}Ba||t.flags&512&&Uj(t)}catch(k){is(t,t.return,k)}}if(t===e){zr=null;break}if(r=t.sibling,r!==null){r.return=t.return,zr=r;break}zr=t.return}}function cG(e){for(;zr!==null;){var t=zr;if(t===e){zr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,zr=r;break}zr=t.return}}function uG(e){for(;zr!==null;){var t=zr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{mO(4,t)}catch(v){is(t,r,v)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var l=t.return;try{n.componentDidMount()}catch(v){is(t,l,v)}}var u=t.return;try{Uj(t)}catch(v){is(t,u,v)}break;case 5:var f=t.return;try{Uj(t)}catch(v){is(t,f,v)}}}catch(v){is(t,t.return,v)}if(t===e){zr=null;break}var o=t.sibling;if(o!==null){o.return=t.return,zr=o;break}zr=t.return}}var ege=Math.ceil,xC=nf.ReactCurrentDispatcher,M3=nf.ReactCurrentOwner,Wc=nf.ReactCurrentBatchConfig,Ti=0,oa=null,Ts=null,Ta=0,Ql=0,Ov=em(0),Vs=0,_S=null,ey=0,gO=0,D3=0,L1=null,Ll=null,L3=0,S0=1/0,Th=null,bC=!1,Hj=null,Lp=null,K2=!1,Ap=null,wC=0,j1=0,Wj=null,FP=-1,BP=0;function vl(){return Ti&6?ds():FP!==-1?FP:FP=ds()}function jp(e){return e.mode&1?Ti&2&&Ta!==0?Ta&-Ta:Nme.transition!==null?(BP===0&&(BP=AK()),BP):(e=Ki,e!==0||(e=window.event,e=e===void 0?16:MK(e.type)),e):1}function $u(e,t,r,n){if(50<j1)throw j1=0,Wj=null,Error(cr(185));OT(e,r,n),(!(Ti&2)||e!==oa)&&(e===oa&&(!(Ti&2)&&(gO|=r),Vs===4&&hp(e,Ta)),Bl(e,n),r===1&&Ti===0&&!(t.mode&1)&&(S0=ds()+500,hO&&tm()))}function Bl(e,t){var r=e.callbackNode;Npe(e,t);var n=oC(e,e===oa?Ta:0);if(n===0)r!==null&&v8(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&v8(r),t===1)e.tag===0?jme(dG.bind(null,e)):JK(dG.bind(null,e)),Rme(function(){!(Ti&6)&&tm()}),r=null;else{switch(PK(n)){case 1:r=a3;break;case 4:r=TK;break;case 16:r=iC;break;case 536870912:r=EK;break;default:r=iC}r=KY(r,UY.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function UY(e,t){if(FP=-1,BP=0,Ti&6)throw Error(cr(327));var r=e.callbackNode;if(Hv()&&e.callbackNode!==r)return null;var n=oC(e,e===oa?Ta:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=SC(e,n);else{t=n;var l=Ti;Ti|=2;var u=qY();(oa!==e||Ta!==t)&&(Th=null,S0=ds()+500,qg(e,t));do try{nge();break}catch(o){GY(e,o)}while(!0);x3(),xC.current=u,Ti=l,Ts!==null?t=0:(oa=null,Ta=0,t=Vs)}if(t!==0){if(t===2&&(l=xj(e),l!==0&&(n=l,t=Zj(e,l))),t===1)throw r=_S,qg(e,0),hp(e,n),Bl(e,ds()),r;if(t===6)hp(e,n);else{if(l=e.current.alternate,!(n&30)&&!tge(l)&&(t=SC(e,n),t===2&&(u=xj(e),u!==0&&(n=u,t=Zj(e,u))),t===1))throw r=_S,qg(e,0),hp(e,n),Bl(e,ds()),r;switch(e.finishedWork=l,e.finishedLanes=n,t){case 0:case 1:throw Error(cr(345));case 2:gg(e,Ll,Th);break;case 3:if(hp(e,n),(n&130023424)===n&&(t=L3+500-ds(),10<t)){if(oC(e,0)!==0)break;if(l=e.suspendedLanes,(l&n)!==n){vl(),e.pingedLanes|=e.suspendedLanes&l;break}e.timeoutHandle=Cj(gg.bind(null,e,Ll,Th),t);break}gg(e,Ll,Th);break;case 4:if(hp(e,n),(n&4194240)===n)break;for(t=e.eventTimes,l=-1;0<n;){var f=31-Bu(n);u=1<<f,f=t[f],f>l&&(l=f),n&=~u}if(n=l,n=ds()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*ege(n/1960))-n,10<n){e.timeoutHandle=Cj(gg.bind(null,e,Ll,Th),n);break}gg(e,Ll,Th);break;case 5:gg(e,Ll,Th);break;default:throw Error(cr(329))}}}return Bl(e,ds()),e.callbackNode===r?UY.bind(null,e):null}function Zj(e,t){var r=L1;return e.current.memoizedState.isDehydrated&&(qg(e,t).flags|=256),e=SC(e,t),e!==2&&(t=Ll,Ll=r,t!==null&&Xj(t)),e}function Xj(e){Ll===null?Ll=e:Ll.push.apply(Ll,e)}function tge(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var l=r[n],u=l.getSnapshot;l=l.value;try{if(!qu(u(),l))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hp(e,t){for(t&=~D3,t&=~gO,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Bu(t),n=1<<r;e[r]=-1,t&=~n}}function dG(e){if(Ti&6)throw Error(cr(327));Hv();var t=oC(e,0);if(!(t&1))return Bl(e,ds()),null;var r=SC(e,t);if(e.tag!==0&&r===2){var n=xj(e);n!==0&&(t=n,r=Zj(e,n))}if(r===1)throw r=_S,qg(e,0),hp(e,t),Bl(e,ds()),r;if(r===6)throw Error(cr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,gg(e,Ll,Th),Bl(e,ds()),null}function j3(e,t){var r=Ti;Ti|=1;try{return e(t)}finally{Ti=r,Ti===0&&(S0=ds()+500,hO&&tm())}}function ty(e){Ap!==null&&Ap.tag===0&&!(Ti&6)&&Hv();var t=Ti;Ti|=1;var r=Wc.transition,n=Ki;try{if(Wc.transition=null,Ki=1,e)return e()}finally{Ki=n,Wc.transition=r,Ti=t,!(Ti&6)&&tm()}}function N3(){Ql=Ov.current,Eo(Ov)}function qg(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,kme(r)),Ts!==null)for(r=Ts.return;r!==null;){var n=r;switch(y3(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&uC();break;case 3:b0(),Eo(zl),Eo(Ga),A3();break;case 5:E3(n);break;case 4:b0();break;case 13:Eo($o);break;case 19:Eo($o);break;case 10:b3(n.type._context);break;case 22:case 23:N3()}r=r.return}if(oa=e,Ts=e=Np(e.current,null),Ta=Ql=t,Vs=0,_S=null,D3=gO=ey=0,Ll=L1=null,Ag!==null){for(t=0;t<Ag.length;t++)if(r=Ag[t],n=r.interleaved,n!==null){r.interleaved=null;var l=n.next,u=r.pending;if(u!==null){var f=u.next;u.next=l,n.next=f}r.pending=n}Ag=null}return e}function GY(e,t){do{var r=Ts;try{if(x3(),jP.current=vC,_C){for(var n=qo.memoizedState;n!==null;){var l=n.queue;l!==null&&(l.pending=null),n=n.next}_C=!1}if(Qg=0,na=Bs=qo=null,M1=!1,mS=0,M3.current=null,r===null||r.return===null){Vs=1,_S=t,Ts=null;break}e:{var u=e,f=r.return,o=r,v=t;if(t=Ta,o.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,P=o,C=P.tag;if(!(P.mode&1)&&(C===0||C===11||C===15)){var k=P.alternate;k?(P.updateQueue=k.updateQueue,P.memoizedState=k.memoizedState,P.lanes=k.lanes):(P.updateQueue=null,P.memoizedState=null)}var L=J8(f);if(L!==null){L.flags&=-257,Q8(L,f,o,u,t),L.mode&1&&Y8(u,w,t),t=L,v=w;var $=t.updateQueue;if($===null){var j=new Set;j.add(v),t.updateQueue=j}else $.add(v);break e}else{if(!(t&1)){Y8(u,w,t),z3();break e}v=Error(cr(426))}}else if(ko&&o.mode&1){var B=J8(f);if(B!==null){!(B.flags&65536)&&(B.flags|=256),Q8(B,f,o,u,t),_3(w0(v,o));break e}}u=v=w0(v,o),Vs!==4&&(Vs=2),L1===null?L1=[u]:L1.push(u),u=f;do{switch(u.tag){case 3:u.flags|=65536,t&=-t,u.lanes|=t;var U=PY(u,v,t);q8(u,U);break e;case 1:o=v;var q=u.type,H=u.stateNode;if(!(u.flags&128)&&(typeof q.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(Lp===null||!Lp.has(H)))){u.flags|=65536,t&=-t,u.lanes|=t;var te=CY(u,o,t);q8(u,te);break e}}u=u.return}while(u!==null)}WY(r)}catch(Q){t=Q,Ts===r&&r!==null&&(Ts=r=r.return);continue}break}while(!0)}function qY(){var e=xC.current;return xC.current=vC,e===null?vC:e}function z3(){(Vs===0||Vs===3||Vs===2)&&(Vs=4),oa===null||!(ey&268435455)&&!(gO&268435455)||hp(oa,Ta)}function SC(e,t){var r=Ti;Ti|=2;var n=qY();(oa!==e||Ta!==t)&&(Th=null,qg(e,t));do try{rge();break}catch(l){GY(e,l)}while(!0);if(x3(),Ti=r,xC.current=n,Ts!==null)throw Error(cr(261));return oa=null,Ta=0,Vs}function rge(){for(;Ts!==null;)HY(Ts)}function nge(){for(;Ts!==null&&!Cpe();)HY(Ts)}function HY(e){var t=XY(e.alternate,e,Ql);e.memoizedProps=e.pendingProps,t===null?WY(e):Ts=t,M3.current=null}function WY(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Kme(r,t),r!==null){r.flags&=32767,Ts=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Vs=6,Ts=null;return}}else if(r=Xme(r,t,Ql),r!==null){Ts=r;return}if(t=t.sibling,t!==null){Ts=t;return}Ts=t=e}while(t!==null);Vs===0&&(Vs=5)}function gg(e,t,r){var n=Ki,l=Wc.transition;try{Wc.transition=null,Ki=1,ige(e,t,r,n)}finally{Wc.transition=l,Ki=n}return null}function ige(e,t,r,n){do Hv();while(Ap!==null);if(Ti&6)throw Error(cr(327));r=e.finishedWork;var l=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(cr(177));e.callbackNode=null,e.callbackPriority=0;var u=r.lanes|r.childLanes;if(zpe(e,u),e===oa&&(Ts=oa=null,Ta=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||K2||(K2=!0,KY(iC,function(){return Hv(),null})),u=(r.flags&15990)!==0,r.subtreeFlags&15990||u){u=Wc.transition,Wc.transition=null;var f=Ki;Ki=1;var o=Ti;Ti|=4,M3.current=null,Jme(e,r),$Y(r,e),Tme(Aj),sC=!!Ej,Aj=Ej=null,e.current=r,Qme(r),Ipe(),Ti=o,Ki=f,Wc.transition=u}else e.current=r;if(K2&&(K2=!1,Ap=e,wC=l),u=e.pendingLanes,u===0&&(Lp=null),Rpe(r.stateNode),Bl(e,ds()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)l=t[r],n(l.value,{componentStack:l.stack,digest:l.digest});if(bC)throw bC=!1,e=Hj,Hj=null,e;return wC&1&&e.tag!==0&&Hv(),u=e.pendingLanes,u&1?e===Wj?j1++:(j1=0,Wj=e):j1=0,tm(),null}function Hv(){if(Ap!==null){var e=PK(wC),t=Wc.transition,r=Ki;try{if(Wc.transition=null,Ki=16>e?16:e,Ap===null)var n=!1;else{if(e=Ap,Ap=null,wC=0,Ti&6)throw Error(cr(331));var l=Ti;for(Ti|=4,zr=e.current;zr!==null;){var u=zr,f=u.child;if(zr.flags&16){var o=u.deletions;if(o!==null){for(var v=0;v<o.length;v++){var w=o[v];for(zr=w;zr!==null;){var P=zr;switch(P.tag){case 0:case 11:case 15:D1(8,P,u)}var C=P.child;if(C!==null)C.return=P,zr=C;else for(;zr!==null;){P=zr;var k=P.sibling,L=P.return;if(zY(P),P===w){zr=null;break}if(k!==null){k.return=L,zr=k;break}zr=L}}}var $=u.alternate;if($!==null){var j=$.child;if(j!==null){$.child=null;do{var B=j.sibling;j.sibling=null,j=B}while(j!==null)}}zr=u}}if(u.subtreeFlags&2064&&f!==null)f.return=u,zr=f;else e:for(;zr!==null;){if(u=zr,u.flags&2048)switch(u.tag){case 0:case 11:case 15:D1(9,u,u.return)}var U=u.sibling;if(U!==null){U.return=u.return,zr=U;break e}zr=u.return}}var q=e.current;for(zr=q;zr!==null;){f=zr;var H=f.child;if(f.subtreeFlags&2064&&H!==null)H.return=f,zr=H;else e:for(f=q;zr!==null;){if(o=zr,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:mO(9,o)}}catch(Q){is(o,o.return,Q)}if(o===f){zr=null;break e}var te=o.sibling;if(te!==null){te.return=o.return,zr=te;break e}zr=o.return}}if(Ti=l,tm(),Md&&typeof Md.onPostCommitFiberRoot=="function")try{Md.onPostCommitFiberRoot(aO,e)}catch{}n=!0}return n}finally{Ki=r,Wc.transition=t}}return!1}function hG(e,t,r){t=w0(r,t),t=PY(e,t,1),e=Dp(e,t,1),t=vl(),e!==null&&(OT(e,1,t),Bl(e,t))}function is(e,t,r){if(e.tag===3)hG(e,e,r);else for(;t!==null;){if(t.tag===3){hG(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Lp===null||!Lp.has(n))){e=w0(r,e),e=CY(t,e,1),t=Dp(t,e,1),e=vl(),t!==null&&(OT(t,1,e),Bl(t,e));break}}t=t.return}}function oge(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=vl(),e.pingedLanes|=e.suspendedLanes&r,oa===e&&(Ta&r)===r&&(Vs===4||Vs===3&&(Ta&130023424)===Ta&&500>ds()-L3?qg(e,0):D3|=r),Bl(e,t)}function ZY(e,t){t===0&&(e.mode&1?(t=B2,B2<<=1,!(B2&130023424)&&(B2=4194304)):t=1);var r=vl();e=Hh(e,t),e!==null&&(OT(e,t,r),Bl(e,r))}function sge(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),ZY(e,r)}function age(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,l=e.memoizedState;l!==null&&(r=l.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(cr(314))}n!==null&&n.delete(t),ZY(e,r)}var XY;XY=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||zl.current)jl=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return jl=!1,Zme(e,t,r);jl=!!(e.flags&131072)}else jl=!1,ko&&t.flags&1048576&&QK(t,fC,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;zP(e,t),e=t.pendingProps;var l=_0(t,Ga.current);qv(t,r),l=C3(null,t,n,e,l,r);var u=I3();return t.flags|=1,typeof l=="object"&&l!==null&&typeof l.render=="function"&&l.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Fl(n)?(u=!0,dC(t)):u=!1,t.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,S3(t),l.updater=pO,t.stateNode=l,l._reactInternals=t,Lj(t,n,e,r),t=zj(null,t,n,!0,u,r)):(t.tag=0,ko&&u&&g3(t),dl(null,t,l,r),t=t.child),t;case 16:n=t.elementType;e:{switch(zP(e,t),e=t.pendingProps,l=n._init,n=l(n._payload),t.type=n,l=t.tag=cge(n),e=Cu(n,e),l){case 0:t=Nj(null,t,n,e,r);break e;case 1:t=rG(null,t,n,e,r);break e;case 11:t=eG(null,t,n,e,r);break e;case 14:t=tG(null,t,n,Cu(n.type,e),r);break e}throw Error(cr(306,n,""))}return t;case 0:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Cu(n,l),Nj(e,t,n,l,r);case 1:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Cu(n,l),rG(e,t,n,l,r);case 3:e:{if(RY(t),e===null)throw Error(cr(387));n=t.pendingProps,u=t.memoizedState,l=u.element,oY(e,t),gC(t,n,null,r);var f=t.memoizedState;if(n=f.element,u.isDehydrated)if(u={element:n,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},t.updateQueue.baseState=u,t.memoizedState=u,t.flags&256){l=w0(Error(cr(423)),t),t=nG(e,t,n,r,l);break e}else if(n!==l){l=w0(Error(cr(424)),t),t=nG(e,t,n,r,l);break e}else for(lc=Mp(t.stateNode.containerInfo.firstChild),cc=t,ko=!0,ju=null,r=nY(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(v0(),n===l){t=Wh(e,t,r);break e}dl(e,t,n,r)}t=t.child}return t;case 5:return sY(t),e===null&&Rj(t),n=t.type,l=t.pendingProps,u=e!==null?e.memoizedProps:null,f=l.children,Pj(n,l)?f=null:u!==null&&Pj(n,u)&&(t.flags|=32),kY(e,t),dl(e,t,f,r),t.child;case 6:return e===null&&Rj(t),null;case 13:return MY(e,t,r);case 4:return T3(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=x0(t,null,n,r):dl(e,t,n,r),t.child;case 11:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Cu(n,l),eG(e,t,n,l,r);case 7:return dl(e,t,t.pendingProps,r),t.child;case 8:return dl(e,t,t.pendingProps.children,r),t.child;case 12:return dl(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,l=t.pendingProps,u=t.memoizedProps,f=l.value,co(pC,n._currentValue),n._currentValue=f,u!==null)if(qu(u.value,f)){if(u.children===l.children&&!zl.current){t=Wh(e,t,r);break e}}else for(u=t.child,u!==null&&(u.return=t);u!==null;){var o=u.dependencies;if(o!==null){f=u.child;for(var v=o.firstContext;v!==null;){if(v.context===n){if(u.tag===1){v=Fh(-1,r&-r),v.tag=2;var w=u.updateQueue;if(w!==null){w=w.shared;var P=w.pending;P===null?v.next=v:(v.next=P.next,P.next=v),w.pending=v}}u.lanes|=r,v=u.alternate,v!==null&&(v.lanes|=r),Mj(u.return,r,t),o.lanes|=r;break}v=v.next}}else if(u.tag===10)f=u.type===t.type?null:u.child;else if(u.tag===18){if(f=u.return,f===null)throw Error(cr(341));f.lanes|=r,o=f.alternate,o!==null&&(o.lanes|=r),Mj(f,r,t),f=u.sibling}else f=u.child;if(f!==null)f.return=u;else for(f=u;f!==null;){if(f===t){f=null;break}if(u=f.sibling,u!==null){u.return=f.return,f=u;break}f=f.return}u=f}dl(e,t,l.children,r),t=t.child}return t;case 9:return l=t.type,n=t.pendingProps.children,qv(t,r),l=Yc(l),n=n(l),t.flags|=1,dl(e,t,n,r),t.child;case 14:return n=t.type,l=Cu(n,t.pendingProps),l=Cu(n.type,l),tG(e,t,n,l,r);case 15:return IY(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,l=t.pendingProps,l=t.elementType===n?l:Cu(n,l),zP(e,t),t.tag=1,Fl(n)?(e=!0,dC(t)):e=!1,qv(t,r),AY(t,n,l),Lj(t,n,l,r),zj(null,t,n,!0,e,r);case 19:return DY(e,t,r);case 22:return OY(e,t,r)}throw Error(cr(156,t.tag))};function KY(e,t){return SK(e,t)}function lge(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gc(e,t,r,n){return new lge(e,t,r,n)}function F3(e){return e=e.prototype,!(!e||!e.isReactComponent)}function cge(e){if(typeof e=="function")return F3(e)?1:0;if(e!=null){if(e=e.$$typeof,e===i3)return 11;if(e===o3)return 14}return 2}function Np(e,t){var r=e.alternate;return r===null?(r=Gc(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function $P(e,t,r,n,l,u){var f=2;if(n=e,typeof e=="function")F3(e)&&(f=1);else if(typeof e=="string")f=5;else e:switch(e){case xv:return Hg(r.children,l,u,t);case n3:f=8,l|=8;break;case oj:return e=Gc(12,r,t,l|2),e.elementType=oj,e.lanes=u,e;case sj:return e=Gc(13,r,t,l),e.elementType=sj,e.lanes=u,e;case aj:return e=Gc(19,r,t,l),e.elementType=aj,e.lanes=u,e;case sK:return yO(r,l,u,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case iK:f=10;break e;case oK:f=9;break e;case i3:f=11;break e;case o3:f=14;break e;case op:f=16,n=null;break e}throw Error(cr(130,e==null?e:typeof e,""))}return t=Gc(f,r,t,l),t.elementType=e,t.type=n,t.lanes=u,t}function Hg(e,t,r,n){return e=Gc(7,e,n,t),e.lanes=r,e}function yO(e,t,r,n){return e=Gc(22,e,n,t),e.elementType=sK,e.lanes=r,e.stateNode={isHidden:!1},e}function jD(e,t,r){return e=Gc(6,e,null,t),e.lanes=r,e}function ND(e,t,r){return t=Gc(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function uge(e,t,r,n,l){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yD(0),this.expirationTimes=yD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yD(0),this.identifierPrefix=n,this.onRecoverableError=l,this.mutableSourceEagerHydrationData=null}function B3(e,t,r,n,l,u,f,o,v){return e=new uge(e,t,r,o,v),t===1?(t=1,u===!0&&(t|=8)):t=0,u=Gc(3,null,null,t),e.current=u,u.stateNode=e,u.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},S3(u),e}function dge(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vv,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function YY(e){if(!e)return Gp;e=e._reactInternals;e:{if(vy(e)!==e||e.tag!==1)throw Error(cr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Fl(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(cr(171))}if(e.tag===1){var r=e.type;if(Fl(r))return YK(e,r,t)}return t}function JY(e,t,r,n,l,u,f,o,v){return e=B3(r,n,!0,e,l,u,f,o,v),e.context=YY(null),r=e.current,n=vl(),l=jp(r),u=Fh(n,l),u.callback=t??null,Dp(r,u,l),e.current.lanes=l,OT(e,l,n),Bl(e,n),e}function _O(e,t,r,n){var l=t.current,u=vl(),f=jp(l);return r=YY(r),t.context===null?t.context=r:t.pendingContext=r,t=Fh(u,f),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Dp(l,t,f),e!==null&&($u(e,l,f,u),LP(e,l,f)),f}function TC(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function fG(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function $3(e,t){fG(e,t),(e=e.alternate)&&fG(e,t)}function hge(){return null}var QY=typeof reportError=="function"?reportError:function(e){console.error(e)};function V3(e){this._internalRoot=e}vO.prototype.render=V3.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(cr(409));_O(e,t,null,null)};vO.prototype.unmount=V3.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ty(function(){_O(null,e,null,null)}),t[qh]=null}};function vO(e){this._internalRoot=e}vO.prototype.unstable_scheduleHydration=function(e){if(e){var t=OK();e={blockedOn:null,target:e,priority:t};for(var r=0;r<dp.length&&t!==0&&t<dp[r].priority;r++);dp.splice(r,0,e),r===0&&RK(e)}};function U3(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function xO(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pG(){}function fge(e,t,r,n,l){if(l){if(typeof n=="function"){var u=n;n=function(){var w=TC(f);u.call(w)}}var f=JY(t,n,e,0,null,!1,!1,"",pG);return e._reactRootContainer=f,e[qh]=f.current,uS(e.nodeType===8?e.parentNode:e),ty(),f}for(;l=e.lastChild;)e.removeChild(l);if(typeof n=="function"){var o=n;n=function(){var w=TC(v);o.call(w)}}var v=B3(e,0,!1,null,null,!1,!1,"",pG);return e._reactRootContainer=v,e[qh]=v.current,uS(e.nodeType===8?e.parentNode:e),ty(function(){_O(t,v,r,n)}),v}function bO(e,t,r,n,l){var u=r._reactRootContainer;if(u){var f=u;if(typeof l=="function"){var o=l;l=function(){var v=TC(f);o.call(v)}}_O(t,f,e,l)}else f=fge(r,t,e,l,n);return TC(f)}CK=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=_1(t.pendingLanes);r!==0&&(l3(t,r|1),Bl(t,ds()),!(Ti&6)&&(S0=ds()+500,tm()))}break;case 13:ty(function(){var n=Hh(e,1);if(n!==null){var l=vl();$u(n,e,1,l)}}),$3(e,1)}};c3=function(e){if(e.tag===13){var t=Hh(e,134217728);if(t!==null){var r=vl();$u(t,e,134217728,r)}$3(e,134217728)}};IK=function(e){if(e.tag===13){var t=jp(e),r=Hh(e,t);if(r!==null){var n=vl();$u(r,e,t,n)}$3(e,t)}};OK=function(){return Ki};kK=function(e,t){var r=Ki;try{return Ki=e,t()}finally{Ki=r}};yj=function(e,t,r){switch(t){case"input":if(uj(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var l=dO(n);if(!l)throw Error(cr(90));lK(n),uj(n,l)}}}break;case"textarea":uK(e,r);break;case"select":t=r.value,t!=null&&$v(e,!!r.multiple,t,!1)}};yK=j3;_K=ty;var pge={usingClientEntryPoint:!1,Events:[RT,Tv,dO,mK,gK,j3]},Qw={findFiberByHostInstance:Eg,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},mge={bundleType:Qw.bundleType,version:Qw.version,rendererPackageName:Qw.rendererPackageName,rendererConfig:Qw.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:nf.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=bK(e),e===null?null:e.stateNode},findFiberByHostInstance:Qw.findFiberByHostInstance||hge,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Y2=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Y2.isDisabled&&Y2.supportsFiber)try{aO=Y2.inject(mge),Md=Y2}catch{}}pc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pge;pc.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!U3(t))throw Error(cr(200));return dge(e,t,null,r)};pc.createRoot=function(e,t){if(!U3(e))throw Error(cr(299));var r=!1,n="",l=QY;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(l=t.onRecoverableError)),t=B3(e,1,!1,null,null,r,!1,n,l),e[qh]=t.current,uS(e.nodeType===8?e.parentNode:e),new V3(t)};pc.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(cr(188)):(e=Object.keys(e).join(","),Error(cr(268,e)));return e=bK(t),e=e===null?null:e.stateNode,e};pc.flushSync=function(e){return ty(e)};pc.hydrate=function(e,t,r){if(!xO(t))throw Error(cr(200));return bO(null,e,t,!0,r)};pc.hydrateRoot=function(e,t,r){if(!U3(e))throw Error(cr(405));var n=r!=null&&r.hydratedSources||null,l=!1,u="",f=QY;if(r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(u=r.identifierPrefix),r.onRecoverableError!==void 0&&(f=r.onRecoverableError)),t=JY(t,null,e,1,r??null,l,!1,u,f),e[qh]=t.current,uS(e),n)for(e=0;e<n.length;e++)r=n[e],l=r._getVersion,l=l(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,l]:t.mutableSourceEagerHydrationData.push(r,l);return new vO(t)};pc.render=function(e,t,r){if(!xO(t))throw Error(cr(200));return bO(null,e,t,!1,r)};pc.unmountComponentAtNode=function(e){if(!xO(e))throw Error(cr(40));return e._reactRootContainer?(ty(function(){bO(null,null,e,!1,function(){e._reactRootContainer=null,e[qh]=null})}),!0):!1};pc.unstable_batchedUpdates=j3;pc.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!xO(r))throw Error(cr(200));if(e==null||e._reactInternals===void 0)throw Error(cr(38));return bO(e,t,r,!1,n)};pc.version="18.3.1-next-f1338f8080-20240426";function eJ(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(eJ)}catch(e){console.error(e)}}eJ(),eK.exports=pc;var xy=eK.exports;const tJ=zi(xy);var rJ,mG=xy;rJ=mG.createRoot,mG.hydrateRoot;const gge=1,yge=1e6;let zD=0;function _ge(){return zD=(zD+1)%Number.MAX_SAFE_INTEGER,zD.toString()}const FD=new Map,gG=e=>{if(FD.has(e))return;const t=setTimeout(()=>{FD.delete(e),N1({type:"REMOVE_TOAST",toastId:e})},yge);FD.set(e,t)},vge=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,gge)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?gG(r):e.toasts.forEach(n=>{gG(n.id)}),{...e,toasts:e.toasts.map(n=>n.id===r||r===void 0?{...n,open:!1}:n)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},VP=[];let UP={toasts:[]};function N1(e){UP=vge(UP,e),VP.forEach(t=>{t(UP)})}function xge({...e}){const t=_ge(),r=l=>N1({type:"UPDATE_TOAST",toast:{...l,id:t}}),n=()=>N1({type:"DISMISS_TOAST",toastId:t});return N1({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:l=>{l||n()}}}),{id:t,dismiss:n,update:r}}function bge(){const[e,t]=X.useState(UP);return X.useEffect(()=>(VP.push(t),()=>{const r=VP.indexOf(t);r>-1&&VP.splice(r,1)}),[e]),{...e,toast:xge,dismiss:r=>N1({type:"DISMISS_TOAST",toastId:r})}}function _r(e,t,{checkForDefaultPrevented:r=!0}={}){return function(l){if(e==null||e(l),r===!1||!l.defaultPrevented)return t==null?void 0:t(l)}}function yG(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function wO(...e){return t=>{let r=!1;const n=e.map(l=>{const u=yG(l,t);return!r&&typeof u=="function"&&(r=!0),u});if(r)return()=>{for(let l=0;l<n.length;l++){const u=n[l];typeof u=="function"?u():yG(e[l],null)}}}}function qn(...e){return X.useCallback(wO(...e),e)}function wge(e,t){const r=X.createContext(t),n=u=>{const{children:f,...o}=u,v=X.useMemo(()=>o,Object.values(o));return A.jsx(r.Provider,{value:v,children:f})};n.displayName=e+"Provider";function l(u){const f=X.useContext(r);if(f)return f;if(t!==void 0)return t;throw new Error(`\`${u}\` must be used within \`${e}\``)}return[n,l]}function $l(e,t=[]){let r=[];function n(u,f){const o=X.createContext(f),v=r.length;r=[...r,f];const w=C=>{var U;const{scope:k,children:L,...$}=C,j=((U=k==null?void 0:k[e])==null?void 0:U[v])||o,B=X.useMemo(()=>$,Object.values($));return A.jsx(j.Provider,{value:B,children:L})};w.displayName=u+"Provider";function P(C,k){var j;const L=((j=k==null?void 0:k[e])==null?void 0:j[v])||o,$=X.useContext(L);if($)return $;if(f!==void 0)return f;throw new Error(`\`${C}\` must be used within \`${u}\``)}return[w,P]}const l=()=>{const u=r.map(f=>X.createContext(f));return function(o){const v=(o==null?void 0:o[e])||u;return X.useMemo(()=>({[`__scope${e}`]:{...o,[e]:v}}),[o,v])}};return l.scopeName=e,[n,Sge(l,...t)]}function Sge(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const n=e.map(l=>({useScope:l(),scopeName:l.scopeName}));return function(u){const f=n.reduce((o,{useScope:v,scopeName:w})=>{const C=v(u)[`__scope${w}`];return{...o,...C}},{});return X.useMemo(()=>({[`__scope${t.scopeName}`]:f}),[f])}};return r.scopeName=t.scopeName,r}function ry(e){const t=Tge(e),r=X.forwardRef((n,l)=>{const{children:u,...f}=n,o=X.Children.toArray(u),v=o.find(Ege);if(v){const w=v.props.children,P=o.map(C=>C===v?X.Children.count(w)>1?X.Children.only(null):X.isValidElement(w)?w.props.children:null:C);return A.jsx(t,{...f,ref:l,children:X.isValidElement(w)?X.cloneElement(w,void 0,P):null})}return A.jsx(t,{...f,ref:l,children:u})});return r.displayName=`${e}.Slot`,r}var nJ=ry("Slot");function Tge(e){const t=X.forwardRef((r,n)=>{const{children:l,...u}=r;if(X.isValidElement(l)){const f=Pge(l),o=Age(u,l.props);return l.type!==X.Fragment&&(o.ref=n?wO(n,f):f),X.cloneElement(l,o)}return X.Children.count(l)>1?X.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}var iJ=Symbol("radix.slottable");function oJ(e){const t=({children:r})=>A.jsx(A.Fragment,{children:r});return t.displayName=`${e}.Slottable`,t.__radixId=iJ,t}function Ege(e){return X.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===iJ}function Age(e,t){const r={...t};for(const n in t){const l=e[n],u=t[n];/^on[A-Z]/.test(n)?l&&u?r[n]=(...o)=>{const v=u(...o);return l(...o),v}:l&&(r[n]=l):n==="style"?r[n]={...l,...u}:n==="className"&&(r[n]=[l,u].filter(Boolean).join(" "))}return{...e,...r}}function Pge(e){var n,l;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(l=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:l.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function SO(e){const t=e+"CollectionProvider",[r,n]=$l(t),[l,u]=r(t,{collectionRef:{current:null},itemMap:new Map}),f=j=>{const{scope:B,children:U}=j,q=De.useRef(null),H=De.useRef(new Map).current;return A.jsx(l,{scope:B,itemMap:H,collectionRef:q,children:U})};f.displayName=t;const o=e+"CollectionSlot",v=ry(o),w=De.forwardRef((j,B)=>{const{scope:U,children:q}=j,H=u(o,U),te=qn(B,H.collectionRef);return A.jsx(v,{ref:te,children:q})});w.displayName=o;const P=e+"CollectionItemSlot",C="data-radix-collection-item",k=ry(P),L=De.forwardRef((j,B)=>{const{scope:U,children:q,...H}=j,te=De.useRef(null),Q=qn(B,te),ae=u(P,U);return De.useEffect(()=>(ae.itemMap.set(te,{ref:te,...H}),()=>void ae.itemMap.delete(te))),A.jsx(k,{[C]:"",ref:Q,children:q})});L.displayName=P;function $(j){const B=u(e+"CollectionConsumer",j);return De.useCallback(()=>{const q=B.collectionRef.current;if(!q)return[];const H=Array.from(q.querySelectorAll(`[${C}]`));return Array.from(B.itemMap.values()).sort((ae,ue)=>H.indexOf(ae.ref.current)-H.indexOf(ue.ref.current))},[B.collectionRef,B.itemMap])}return[{Provider:f,Slot:w,ItemSlot:L},$,n]}var Cge=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],nn=Cge.reduce((e,t)=>{const r=ry(`Primitive.${t}`),n=X.forwardRef((l,u)=>{const{asChild:f,...o}=l,v=f?r:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),A.jsx(v,{...o,ref:u})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function G3(e,t){e&&xy.flushSync(()=>e.dispatchEvent(t))}function ss(e){const t=X.useRef(e);return X.useEffect(()=>{t.current=e}),X.useMemo(()=>(...r)=>{var n;return(n=t.current)==null?void 0:n.call(t,...r)},[])}function Ige(e,t=globalThis==null?void 0:globalThis.document){const r=ss(e);X.useEffect(()=>{const n=l=>{l.key==="Escape"&&r(l)};return t.addEventListener("keydown",n,{capture:!0}),()=>t.removeEventListener("keydown",n,{capture:!0})},[r,t])}var Oge="DismissableLayer",Kj="dismissableLayer.update",kge="dismissableLayer.pointerDownOutside",Rge="dismissableLayer.focusOutside",_G,sJ=X.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hx=X.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:n,onPointerDownOutside:l,onFocusOutside:u,onInteractOutside:f,onDismiss:o,...v}=e,w=X.useContext(sJ),[P,C]=X.useState(null),k=(P==null?void 0:P.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,L]=X.useState({}),$=qn(t,ue=>C(ue)),j=Array.from(w.layers),[B]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),U=j.indexOf(B),q=P?j.indexOf(P):-1,H=w.layersWithOutsidePointerEventsDisabled.size>0,te=q>=U,Q=Dge(ue=>{const me=ue.target,Ce=[...w.branches].some(Fe=>Fe.contains(me));!te||Ce||(l==null||l(ue),f==null||f(ue),ue.defaultPrevented||o==null||o())},k),ae=Lge(ue=>{const me=ue.target;[...w.branches].some(Fe=>Fe.contains(me))||(u==null||u(ue),f==null||f(ue),ue.defaultPrevented||o==null||o())},k);return Ige(ue=>{q===w.layers.size-1&&(n==null||n(ue),!ue.defaultPrevented&&o&&(ue.preventDefault(),o()))},k),X.useEffect(()=>{if(P)return r&&(w.layersWithOutsidePointerEventsDisabled.size===0&&(_G=k.body.style.pointerEvents,k.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(P)),w.layers.add(P),vG(),()=>{r&&w.layersWithOutsidePointerEventsDisabled.size===1&&(k.body.style.pointerEvents=_G)}},[P,k,r,w]),X.useEffect(()=>()=>{P&&(w.layers.delete(P),w.layersWithOutsidePointerEventsDisabled.delete(P),vG())},[P,w]),X.useEffect(()=>{const ue=()=>L({});return document.addEventListener(Kj,ue),()=>document.removeEventListener(Kj,ue)},[]),A.jsx(nn.div,{...v,ref:$,style:{pointerEvents:H?te?"auto":"none":void 0,...e.style},onFocusCapture:_r(e.onFocusCapture,ae.onFocusCapture),onBlurCapture:_r(e.onBlurCapture,ae.onBlurCapture),onPointerDownCapture:_r(e.onPointerDownCapture,Q.onPointerDownCapture)})});hx.displayName=Oge;var Mge="DismissableLayerBranch",aJ=X.forwardRef((e,t)=>{const r=X.useContext(sJ),n=X.useRef(null),l=qn(t,n);return X.useEffect(()=>{const u=n.current;if(u)return r.branches.add(u),()=>{r.branches.delete(u)}},[r.branches]),A.jsx(nn.div,{...e,ref:l})});aJ.displayName=Mge;function Dge(e,t=globalThis==null?void 0:globalThis.document){const r=ss(e),n=X.useRef(!1),l=X.useRef(()=>{});return X.useEffect(()=>{const u=o=>{if(o.target&&!n.current){let v=function(){lJ(kge,r,w,{discrete:!0})};const w={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",l.current),l.current=v,t.addEventListener("click",l.current,{once:!0})):v()}else t.removeEventListener("click",l.current);n.current=!1},f=window.setTimeout(()=>{t.addEventListener("pointerdown",u)},0);return()=>{window.clearTimeout(f),t.removeEventListener("pointerdown",u),t.removeEventListener("click",l.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}function Lge(e,t=globalThis==null?void 0:globalThis.document){const r=ss(e),n=X.useRef(!1);return X.useEffect(()=>{const l=u=>{u.target&&!n.current&&lJ(Rge,r,{originalEvent:u},{discrete:!1})};return t.addEventListener("focusin",l),()=>t.removeEventListener("focusin",l)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function vG(){const e=new CustomEvent(Kj);document.dispatchEvent(e)}function lJ(e,t,r,{discrete:n}){const l=r.originalEvent.target,u=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&l.addEventListener(e,t,{once:!0}),n?G3(l,u):l.dispatchEvent(u)}var jge=hx,Nge=aJ,fs=globalThis!=null&&globalThis.document?X.useLayoutEffect:()=>{},zge="Portal",DT=X.forwardRef((e,t)=>{var o;const{container:r,...n}=e,[l,u]=X.useState(!1);fs(()=>u(!0),[]);const f=r||l&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return f?tJ.createPortal(A.jsx(nn.div,{...n,ref:t}),f):null});DT.displayName=zge;function Fge(e,t){return X.useReducer((r,n)=>t[r][n]??r,e)}var wl=e=>{const{present:t,children:r}=e,n=Bge(t),l=typeof r=="function"?r({present:n.isPresent}):X.Children.only(r),u=qn(n.ref,$ge(l));return typeof r=="function"||n.isPresent?X.cloneElement(l,{ref:u}):null};wl.displayName="Presence";function Bge(e){const[t,r]=X.useState(),n=X.useRef(null),l=X.useRef(e),u=X.useRef("none"),f=e?"mounted":"unmounted",[o,v]=Fge(f,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return X.useEffect(()=>{const w=J2(n.current);u.current=o==="mounted"?w:"none"},[o]),fs(()=>{const w=n.current,P=l.current;if(P!==e){const k=u.current,L=J2(w);e?v("MOUNT"):L==="none"||(w==null?void 0:w.display)==="none"?v("UNMOUNT"):v(P&&k!==L?"ANIMATION_OUT":"UNMOUNT"),l.current=e}},[e,v]),fs(()=>{if(t){let w;const P=t.ownerDocument.defaultView??window,C=L=>{const j=J2(n.current).includes(L.animationName);if(L.target===t&&j&&(v("ANIMATION_END"),!l.current)){const B=t.style.animationFillMode;t.style.animationFillMode="forwards",w=P.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=B)})}},k=L=>{L.target===t&&(u.current=J2(n.current))};return t.addEventListener("animationstart",k),t.addEventListener("animationcancel",C),t.addEventListener("animationend",C),()=>{P.clearTimeout(w),t.removeEventListener("animationstart",k),t.removeEventListener("animationcancel",C),t.removeEventListener("animationend",C)}}else v("ANIMATION_END")},[t,v]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:X.useCallback(w=>{n.current=w?getComputedStyle(w):null,r(w)},[])}}function J2(e){return(e==null?void 0:e.animationName)||"none"}function $ge(e){var n,l;let t=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(l=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:l.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}var Vge=QF[" useInsertionEffect ".trim().toString()]||fs;function qp({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){const[l,u,f]=Uge({defaultProp:t,onChange:r}),o=e!==void 0,v=o?e:l;{const P=X.useRef(e!==void 0);X.useEffect(()=>{const C=P.current;C!==o&&console.warn(`${n} is changing from ${C?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),P.current=o},[o,n])}const w=X.useCallback(P=>{var C;if(o){const k=Gge(P)?P(e):P;k!==e&&((C=f.current)==null||C.call(f,k))}else u(P)},[o,e,u,f]);return[v,w]}function Uge({defaultProp:e,onChange:t}){const[r,n]=X.useState(e),l=X.useRef(r),u=X.useRef(t);return Vge(()=>{u.current=t},[t]),X.useEffect(()=>{var f;l.current!==r&&((f=u.current)==null||f.call(u,r),l.current=r)},[r,l]),[r,n,u]}function Gge(e){return typeof e=="function"}var cJ=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),qge="VisuallyHidden",TO=X.forwardRef((e,t)=>A.jsx(nn.span,{...e,ref:t,style:{...cJ,...e.style}}));TO.displayName=qge;var Hge=TO,q3="ToastProvider",[H3,Wge,Zge]=SO("Toast"),[uJ,ZQe]=$l("Toast",[Zge]),[Xge,EO]=uJ(q3),dJ=e=>{const{__scopeToast:t,label:r="Notification",duration:n=5e3,swipeDirection:l="right",swipeThreshold:u=50,children:f}=e,[o,v]=X.useState(null),[w,P]=X.useState(0),C=X.useRef(!1),k=X.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${q3}\`. Expected non-empty \`string\`.`),A.jsx(H3.Provider,{scope:t,children:A.jsx(Xge,{scope:t,label:r,duration:n,swipeDirection:l,swipeThreshold:u,toastCount:w,viewport:o,onViewportChange:v,onToastAdd:X.useCallback(()=>P(L=>L+1),[]),onToastRemove:X.useCallback(()=>P(L=>L-1),[]),isFocusedToastEscapeKeyDownRef:C,isClosePausedRef:k,children:f})})};dJ.displayName=q3;var hJ="ToastViewport",Kge=["F8"],Yj="toast.viewportPause",Jj="toast.viewportResume",fJ=X.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:n=Kge,label:l="Notifications ({hotkey})",...u}=e,f=EO(hJ,r),o=Wge(r),v=X.useRef(null),w=X.useRef(null),P=X.useRef(null),C=X.useRef(null),k=qn(t,C,f.onViewportChange),L=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),$=f.toastCount>0;X.useEffect(()=>{const B=U=>{var H;n.length!==0&&n.every(te=>U[te]||U.code===te)&&((H=C.current)==null||H.focus())};return document.addEventListener("keydown",B),()=>document.removeEventListener("keydown",B)},[n]),X.useEffect(()=>{const B=v.current,U=C.current;if($&&B&&U){const q=()=>{if(!f.isClosePausedRef.current){const ae=new CustomEvent(Yj);U.dispatchEvent(ae),f.isClosePausedRef.current=!0}},H=()=>{if(f.isClosePausedRef.current){const ae=new CustomEvent(Jj);U.dispatchEvent(ae),f.isClosePausedRef.current=!1}},te=ae=>{!B.contains(ae.relatedTarget)&&H()},Q=()=>{B.contains(document.activeElement)||H()};return B.addEventListener("focusin",q),B.addEventListener("focusout",te),B.addEventListener("pointermove",q),B.addEventListener("pointerleave",Q),window.addEventListener("blur",q),window.addEventListener("focus",H),()=>{B.removeEventListener("focusin",q),B.removeEventListener("focusout",te),B.removeEventListener("pointermove",q),B.removeEventListener("pointerleave",Q),window.removeEventListener("blur",q),window.removeEventListener("focus",H)}}},[$,f.isClosePausedRef]);const j=X.useCallback(({tabbingDirection:B})=>{const q=o().map(H=>{const te=H.ref.current,Q=[te,...cye(te)];return B==="forwards"?Q:Q.reverse()});return(B==="forwards"?q.reverse():q).flat()},[o]);return X.useEffect(()=>{const B=C.current;if(B){const U=q=>{var Q,ae,ue;const H=q.altKey||q.ctrlKey||q.metaKey;if(q.key==="Tab"&&!H){const me=document.activeElement,Ce=q.shiftKey;if(q.target===B&&Ce){(Q=w.current)==null||Q.focus();return}const Ve=j({tabbingDirection:Ce?"backwards":"forwards"}),Ze=Ve.findIndex(nt=>nt===me);BD(Ve.slice(Ze+1))?q.preventDefault():Ce?(ae=w.current)==null||ae.focus():(ue=P.current)==null||ue.focus()}};return B.addEventListener("keydown",U),()=>B.removeEventListener("keydown",U)}},[o,j]),A.jsxs(Nge,{ref:v,role:"region","aria-label":l.replace("{hotkey}",L),tabIndex:-1,style:{pointerEvents:$?void 0:"none"},children:[$&&A.jsx(Qj,{ref:w,onFocusFromOutsideViewport:()=>{const B=j({tabbingDirection:"forwards"});BD(B)}}),A.jsx(H3.Slot,{scope:r,children:A.jsx(nn.ol,{tabIndex:-1,...u,ref:k})}),$&&A.jsx(Qj,{ref:P,onFocusFromOutsideViewport:()=>{const B=j({tabbingDirection:"backwards"});BD(B)}})]})});fJ.displayName=hJ;var pJ="ToastFocusProxy",Qj=X.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:n,...l}=e,u=EO(pJ,r);return A.jsx(TO,{"aria-hidden":!0,tabIndex:0,...l,ref:t,style:{position:"fixed"},onFocus:f=>{var w;const o=f.relatedTarget;!((w=u.viewport)!=null&&w.contains(o))&&n()}})});Qj.displayName=pJ;var LT="Toast",Yge="toast.swipeStart",Jge="toast.swipeMove",Qge="toast.swipeCancel",eye="toast.swipeEnd",mJ=X.forwardRef((e,t)=>{const{forceMount:r,open:n,defaultOpen:l,onOpenChange:u,...f}=e,[o,v]=qp({prop:n,defaultProp:l??!0,onChange:u,caller:LT});return A.jsx(wl,{present:r||o,children:A.jsx(nye,{open:o,...f,ref:t,onClose:()=>v(!1),onPause:ss(e.onPause),onResume:ss(e.onResume),onSwipeStart:_r(e.onSwipeStart,w=>{w.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:_r(e.onSwipeMove,w=>{const{x:P,y:C}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","move"),w.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${P}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${C}px`)}),onSwipeCancel:_r(e.onSwipeCancel,w=>{w.currentTarget.setAttribute("data-swipe","cancel"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:_r(e.onSwipeEnd,w=>{const{x:P,y:C}=w.detail.delta;w.currentTarget.setAttribute("data-swipe","end"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),w.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),w.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${P}px`),w.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${C}px`),v(!1)})})})});mJ.displayName=LT;var[tye,rye]=uJ(LT,{onClose(){}}),nye=X.forwardRef((e,t)=>{const{__scopeToast:r,type:n="foreground",duration:l,open:u,onClose:f,onEscapeKeyDown:o,onPause:v,onResume:w,onSwipeStart:P,onSwipeMove:C,onSwipeCancel:k,onSwipeEnd:L,...$}=e,j=EO(LT,r),[B,U]=X.useState(null),q=qn(t,nt=>U(nt)),H=X.useRef(null),te=X.useRef(null),Q=l||j.duration,ae=X.useRef(0),ue=X.useRef(Q),me=X.useRef(0),{onToastAdd:Ce,onToastRemove:Fe}=j,Ge=ss(()=>{var dt;(B==null?void 0:B.contains(document.activeElement))&&((dt=j.viewport)==null||dt.focus()),f()}),Ve=X.useCallback(nt=>{!nt||nt===1/0||(window.clearTimeout(me.current),ae.current=new Date().getTime(),me.current=window.setTimeout(Ge,nt))},[Ge]);X.useEffect(()=>{const nt=j.viewport;if(nt){const dt=()=>{Ve(ue.current),w==null||w()},rt=()=>{const at=new Date().getTime()-ae.current;ue.current=ue.current-at,window.clearTimeout(me.current),v==null||v()};return nt.addEventListener(Yj,rt),nt.addEventListener(Jj,dt),()=>{nt.removeEventListener(Yj,rt),nt.removeEventListener(Jj,dt)}}},[j.viewport,Q,v,w,Ve]),X.useEffect(()=>{u&&!j.isClosePausedRef.current&&Ve(Q)},[u,Q,j.isClosePausedRef,Ve]),X.useEffect(()=>(Ce(),()=>Fe()),[Ce,Fe]);const Ze=X.useMemo(()=>B?wJ(B):null,[B]);return j.viewport?A.jsxs(A.Fragment,{children:[Ze&&A.jsx(iye,{__scopeToast:r,role:"status","aria-live":n==="foreground"?"assertive":"polite","aria-atomic":!0,children:Ze}),A.jsx(tye,{scope:r,onClose:Ge,children:xy.createPortal(A.jsx(H3.ItemSlot,{scope:r,children:A.jsx(jge,{asChild:!0,onEscapeKeyDown:_r(o,()=>{j.isFocusedToastEscapeKeyDownRef.current||Ge(),j.isFocusedToastEscapeKeyDownRef.current=!1}),children:A.jsx(nn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":u?"open":"closed","data-swipe-direction":j.swipeDirection,...$,ref:q,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:_r(e.onKeyDown,nt=>{nt.key==="Escape"&&(o==null||o(nt.nativeEvent),nt.nativeEvent.defaultPrevented||(j.isFocusedToastEscapeKeyDownRef.current=!0,Ge()))}),onPointerDown:_r(e.onPointerDown,nt=>{nt.button===0&&(H.current={x:nt.clientX,y:nt.clientY})}),onPointerMove:_r(e.onPointerMove,nt=>{if(!H.current)return;const dt=nt.clientX-H.current.x,rt=nt.clientY-H.current.y,at=!!te.current,qe=["left","right"].includes(j.swipeDirection),He=["left","up"].includes(j.swipeDirection)?Math.min:Math.max,Et=qe?He(0,dt):0,Gt=qe?0:He(0,rt),Ot=nt.pointerType==="touch"?10:2,$t={x:Et,y:Gt},ur={originalEvent:nt,delta:$t};at?(te.current=$t,Q2(Jge,C,ur,{discrete:!1})):xG($t,j.swipeDirection,Ot)?(te.current=$t,Q2(Yge,P,ur,{discrete:!1}),nt.target.setPointerCapture(nt.pointerId)):(Math.abs(dt)>Ot||Math.abs(rt)>Ot)&&(H.current=null)}),onPointerUp:_r(e.onPointerUp,nt=>{const dt=te.current,rt=nt.target;if(rt.hasPointerCapture(nt.pointerId)&&rt.releasePointerCapture(nt.pointerId),te.current=null,H.current=null,dt){const at=nt.currentTarget,qe={originalEvent:nt,delta:dt};xG(dt,j.swipeDirection,j.swipeThreshold)?Q2(eye,L,qe,{discrete:!0}):Q2(Qge,k,qe,{discrete:!0}),at.addEventListener("click",He=>He.preventDefault(),{once:!0})}})})})}),j.viewport)})]}):null}),iye=e=>{const{__scopeToast:t,children:r,...n}=e,l=EO(LT,t),[u,f]=X.useState(!1),[o,v]=X.useState(!1);return aye(()=>f(!0)),X.useEffect(()=>{const w=window.setTimeout(()=>v(!0),1e3);return()=>window.clearTimeout(w)},[]),o?null:A.jsx(DT,{asChild:!0,children:A.jsx(TO,{...n,children:u&&A.jsxs(A.Fragment,{children:[l.label," ",r]})})})},oye="ToastTitle",gJ=X.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return A.jsx(nn.div,{...n,ref:t})});gJ.displayName=oye;var sye="ToastDescription",yJ=X.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e;return A.jsx(nn.div,{...n,ref:t})});yJ.displayName=sye;var _J="ToastAction",vJ=X.forwardRef((e,t)=>{const{altText:r,...n}=e;return r.trim()?A.jsx(bJ,{altText:r,asChild:!0,children:A.jsx(W3,{...n,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${_J}\`. Expected non-empty \`string\`.`),null)});vJ.displayName=_J;var xJ="ToastClose",W3=X.forwardRef((e,t)=>{const{__scopeToast:r,...n}=e,l=rye(xJ,r);return A.jsx(bJ,{asChild:!0,children:A.jsx(nn.button,{type:"button",...n,ref:t,onClick:_r(e.onClick,l.onClose)})})});W3.displayName=xJ;var bJ=X.forwardRef((e,t)=>{const{__scopeToast:r,altText:n,...l}=e;return A.jsx(nn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":n||void 0,...l,ref:t})});function wJ(e){const t=[];return Array.from(e.childNodes).forEach(n=>{if(n.nodeType===n.TEXT_NODE&&n.textContent&&t.push(n.textContent),lye(n)){const l=n.ariaHidden||n.hidden||n.style.display==="none",u=n.dataset.radixToastAnnounceExclude==="";if(!l)if(u){const f=n.dataset.radixToastAnnounceAlt;f&&t.push(f)}else t.push(...wJ(n))}}),t}function Q2(e,t,r,{discrete:n}){const l=r.originalEvent.currentTarget,u=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&l.addEventListener(e,t,{once:!0}),n?G3(l,u):l.dispatchEvent(u)}var xG=(e,t,r=0)=>{const n=Math.abs(e.x),l=Math.abs(e.y),u=n>l;return t==="left"||t==="right"?u&&n>r:!u&&l>r};function aye(e=()=>{}){const t=ss(e);fs(()=>{let r=0,n=0;return r=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(n)}},[t])}function lye(e){return e.nodeType===e.ELEMENT_NODE}function cye(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const l=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||l?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function BD(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var uye=dJ,SJ=fJ,TJ=mJ,EJ=gJ,AJ=yJ,PJ=vJ,CJ=W3;function IJ(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var l=e.length;for(t=0;t<l;t++)e[t]&&(r=IJ(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function Gn(){for(var e,t,r=0,n="",l=arguments.length;r<l;r++)(e=arguments[r])&&(t=IJ(e))&&(n&&(n+=" "),n+=t);return n}const bG=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,wG=Gn,jT=(e,t)=>r=>{var n;if((t==null?void 0:t.variants)==null)return wG(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:l,defaultVariants:u}=t,f=Object.keys(l).map(w=>{const P=r==null?void 0:r[w],C=u==null?void 0:u[w];if(P===null)return null;const k=bG(P)||bG(C);return l[w][k]}),o=r&&Object.entries(r).reduce((w,P)=>{let[C,k]=P;return k===void 0||(w[C]=k),w},{}),v=t==null||(n=t.compoundVariants)===null||n===void 0?void 0:n.reduce((w,P)=>{let{class:C,className:k,...L}=P;return Object.entries(L).every($=>{let[j,B]=$;return Array.isArray(B)?B.includes({...u,...o}[j]):{...u,...o}[j]===B})?[...w,C,k]:w},[]);return wG(e,f,v,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dye=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),OJ=(...e)=>e.filter((t,r,n)=>!!t&&t.trim()!==""&&n.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var hye={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fye=X.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:l="",children:u,iconNode:f,...o},v)=>X.createElement("svg",{ref:v,...hye,width:t,height:t,stroke:e,strokeWidth:n?Number(r)*24/Number(t):r,className:OJ("lucide",l),...o},[...f.map(([w,P])=>X.createElement(w,P)),...Array.isArray(u)?u:[u]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ur=(e,t)=>{const r=X.forwardRef(({className:n,...l},u)=>X.createElement(fye,{ref:u,iconNode:t,className:OJ(`lucide-${dye(e)}`,n),...l}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $D=Ur("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kJ=Ur("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wv=Ur("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pye=Ur("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RJ=Ur("Bath",[["path",{d:"M10 4 8 6",key:"1rru8s"}],["path",{d:"M17 19v2",key:"ts1sot"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M7 19v2",key:"12npes"}],["path",{d:"M9 5 7.621 3.621A2.121 2.121 0 0 0 4 5v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"14ym8i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MJ=Ur("Bed",[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SG=Ur("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EC=Ur("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z3=Ur("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mye=Ur("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eN=Ur("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DJ=Ur("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X3=Ur("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gye=Ur("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yye=Ur("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ye=Ur("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K3=Ur("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vye=Ur("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xye=Ur("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y3=Ur("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TG=Ur("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EG=Ur("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bye=Ur("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J3=Ur("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zv=Ur("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wye=Ur("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tN=Ur("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AG=Ur("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sye=Ur("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q3=Ur("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ud=Ur("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tye=Ur("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=Ur("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Aye=Ur("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pye=Ur("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cye=Ur("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VD=Ur("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Iye=Ur("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ld=Ur("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oye=Ur("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T0=Ur("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oh=Ur("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kye=Ur("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LJ=Ur("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vS=Ur("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rye=Ur("Mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mye=Ur("MousePointerClick",[["path",{d:"M14 4.1 12 6",key:"ita8i4"}],["path",{d:"m5.1 8-2.9-.8",key:"1go3kf"}],["path",{d:"m6 12-1.9 2",key:"mnht97"}],["path",{d:"M7.2 2.2 8 5.1",key:"1cfko1"}],["path",{d:"M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z",key:"s0h3yz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xS=Ur("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AC=Ur("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dye=Ur("Satellite",[["path",{d:"M13 7 9 3 5 7l4 4",key:"vyckw6"}],["path",{d:"m17 11 4 4-4 4-4-4",key:"rchckc"}],["path",{d:"m8 12 4 4 6-6-4-4Z",key:"1sshf7"}],["path",{d:"m16 8 3-3",key:"x428zp"}],["path",{d:"M9 21a6 6 0 0 0-6-6",key:"1iajcf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rN=Ur("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bS=Ur("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lye=Ur("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jJ=Ur("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jye=Ur("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nye=Ur("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eB=Ur("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zye=Ur("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NJ=Ur("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fye=Ur("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nN=Ur("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AO=Ur("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wS=Ur("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=Ur("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PG=Ur("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),tB="-",Bye=e=>{const t=Vye(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:n}=e;return{getClassGroupId:f=>{const o=f.split(tB);return o[0]===""&&o.length!==1&&o.shift(),zJ(o,t)||$ye(f)},getConflictingClassGroupIds:(f,o)=>{const v=r[f]||[];return o&&n[f]?[...v,...n[f]]:v}}},zJ=(e,t)=>{var f;if(e.length===0)return t.classGroupId;const r=e[0],n=t.nextPart.get(r),l=n?zJ(e.slice(1),n):void 0;if(l)return l;if(t.validators.length===0)return;const u=e.join(tB);return(f=t.validators.find(({validator:o})=>o(u)))==null?void 0:f.classGroupId},CG=/^\[(.+)\]$/,$ye=e=>{if(CG.test(e)){const t=CG.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},Vye=e=>{const{theme:t,prefix:r}=e,n={nextPart:new Map,validators:[]};return Gye(Object.entries(e.classGroups),r).forEach(([u,f])=>{iN(f,n,u,t)}),n},iN=(e,t,r,n)=>{e.forEach(l=>{if(typeof l=="string"){const u=l===""?t:IG(t,l);u.classGroupId=r;return}if(typeof l=="function"){if(Uye(l)){iN(l(n),t,r,n);return}t.validators.push({validator:l,classGroupId:r});return}Object.entries(l).forEach(([u,f])=>{iN(f,IG(t,u),r,n)})})},IG=(e,t)=>{let r=e;return t.split(tB).forEach(n=>{r.nextPart.has(n)||r.nextPart.set(n,{nextPart:new Map,validators:[]}),r=r.nextPart.get(n)}),r},Uye=e=>e.isThemeGetter,Gye=(e,t)=>t?e.map(([r,n])=>{const l=n.map(u=>typeof u=="string"?t+u:typeof u=="object"?Object.fromEntries(Object.entries(u).map(([f,o])=>[t+f,o])):u);return[r,l]}):e,qye=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,n=new Map;const l=(u,f)=>{r.set(u,f),t++,t>e&&(t=0,n=r,r=new Map)};return{get(u){let f=r.get(u);if(f!==void 0)return f;if((f=n.get(u))!==void 0)return l(u,f),f},set(u,f){r.has(u)?r.set(u,f):l(u,f)}}},FJ="!",Hye=e=>{const{separator:t,experimentalParseClassName:r}=e,n=t.length===1,l=t[0],u=t.length,f=o=>{const v=[];let w=0,P=0,C;for(let B=0;B<o.length;B++){let U=o[B];if(w===0){if(U===l&&(n||o.slice(B,B+u)===t)){v.push(o.slice(P,B)),P=B+u;continue}if(U==="/"){C=B;continue}}U==="["?w++:U==="]"&&w--}const k=v.length===0?o:o.substring(P),L=k.startsWith(FJ),$=L?k.substring(1):k,j=C&&C>P?C-P:void 0;return{modifiers:v,hasImportantModifier:L,baseClassName:$,maybePostfixModifierPosition:j}};return r?o=>r({className:o,parseClassName:f}):f},Wye=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(n=>{n[0]==="["?(t.push(...r.sort(),n),r=[]):r.push(n)}),t.push(...r.sort()),t},Zye=e=>({cache:qye(e.cacheSize),parseClassName:Hye(e),...Bye(e)}),Xye=/\s+/,Kye=(e,t)=>{const{parseClassName:r,getClassGroupId:n,getConflictingClassGroupIds:l}=t,u=[],f=e.trim().split(Xye);let o="";for(let v=f.length-1;v>=0;v-=1){const w=f[v],{modifiers:P,hasImportantModifier:C,baseClassName:k,maybePostfixModifierPosition:L}=r(w);let $=!!L,j=n($?k.substring(0,L):k);if(!j){if(!$){o=w+(o.length>0?" "+o:o);continue}if(j=n(k),!j){o=w+(o.length>0?" "+o:o);continue}$=!1}const B=Wye(P).join(":"),U=C?B+FJ:B,q=U+j;if(u.includes(q))continue;u.push(q);const H=l(j,$);for(let te=0;te<H.length;++te){const Q=H[te];u.push(U+Q)}o=w+(o.length>0?" "+o:o)}return o};function Yye(){let e=0,t,r,n="";for(;e<arguments.length;)(t=arguments[e++])&&(r=BJ(t))&&(n&&(n+=" "),n+=r);return n}const BJ=e=>{if(typeof e=="string")return e;let t,r="";for(let n=0;n<e.length;n++)e[n]&&(t=BJ(e[n]))&&(r&&(r+=" "),r+=t);return r};function Jye(e,...t){let r,n,l,u=f;function f(v){const w=t.reduce((P,C)=>C(P),e());return r=Zye(w),n=r.cache.get,l=r.cache.set,u=o,o(v)}function o(v){const w=n(v);if(w)return w;const P=Kye(v,r);return l(v,P),P}return function(){return u(Yye.apply(null,arguments))}}const bo=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},$J=/^\[(?:([a-z-]+):)?(.+)\]$/i,Qye=/^\d+\/\d+$/,e_e=new Set(["px","full","screen"]),t_e=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,r_e=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,n_e=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,i_e=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,o_e=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,xh=e=>Xv(e)||e_e.has(e)||Qye.test(e),ep=e=>fx(e,"length",f_e),Xv=e=>!!e&&!Number.isNaN(Number(e)),UD=e=>fx(e,"number",Xv),e1=e=>!!e&&Number.isInteger(Number(e)),s_e=e=>e.endsWith("%")&&Xv(e.slice(0,-1)),Un=e=>$J.test(e),tp=e=>t_e.test(e),a_e=new Set(["length","size","percentage"]),l_e=e=>fx(e,a_e,VJ),c_e=e=>fx(e,"position",VJ),u_e=new Set(["image","url"]),d_e=e=>fx(e,u_e,m_e),h_e=e=>fx(e,"",p_e),t1=()=>!0,fx=(e,t,r)=>{const n=$J.exec(e);return n?n[1]?typeof t=="string"?n[1]===t:t.has(n[1]):r(n[2]):!1},f_e=e=>r_e.test(e)&&!n_e.test(e),VJ=()=>!1,p_e=e=>i_e.test(e),m_e=e=>o_e.test(e),g_e=()=>{const e=bo("colors"),t=bo("spacing"),r=bo("blur"),n=bo("brightness"),l=bo("borderColor"),u=bo("borderRadius"),f=bo("borderSpacing"),o=bo("borderWidth"),v=bo("contrast"),w=bo("grayscale"),P=bo("hueRotate"),C=bo("invert"),k=bo("gap"),L=bo("gradientColorStops"),$=bo("gradientColorStopPositions"),j=bo("inset"),B=bo("margin"),U=bo("opacity"),q=bo("padding"),H=bo("saturate"),te=bo("scale"),Q=bo("sepia"),ae=bo("skew"),ue=bo("space"),me=bo("translate"),Ce=()=>["auto","contain","none"],Fe=()=>["auto","hidden","clip","visible","scroll"],Ge=()=>["auto",Un,t],Ve=()=>[Un,t],Ze=()=>["",xh,ep],nt=()=>["auto",Xv,Un],dt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],rt=()=>["solid","dashed","dotted","double","none"],at=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],qe=()=>["start","end","center","between","around","evenly","stretch"],He=()=>["","0",Un],Et=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Gt=()=>[Xv,Un];return{cacheSize:500,separator:":",theme:{colors:[t1],spacing:[xh,ep],blur:["none","",tp,Un],brightness:Gt(),borderColor:[e],borderRadius:["none","","full",tp,Un],borderSpacing:Ve(),borderWidth:Ze(),contrast:Gt(),grayscale:He(),hueRotate:Gt(),invert:He(),gap:Ve(),gradientColorStops:[e],gradientColorStopPositions:[s_e,ep],inset:Ge(),margin:Ge(),opacity:Gt(),padding:Ve(),saturate:Gt(),scale:Gt(),sepia:He(),skew:Gt(),space:Ve(),translate:Ve()},classGroups:{aspect:[{aspect:["auto","square","video",Un]}],container:["container"],columns:[{columns:[tp]}],"break-after":[{"break-after":Et()}],"break-before":[{"break-before":Et()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...dt(),Un]}],overflow:[{overflow:Fe()}],"overflow-x":[{"overflow-x":Fe()}],"overflow-y":[{"overflow-y":Fe()}],overscroll:[{overscroll:Ce()}],"overscroll-x":[{"overscroll-x":Ce()}],"overscroll-y":[{"overscroll-y":Ce()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[j]}],"inset-x":[{"inset-x":[j]}],"inset-y":[{"inset-y":[j]}],start:[{start:[j]}],end:[{end:[j]}],top:[{top:[j]}],right:[{right:[j]}],bottom:[{bottom:[j]}],left:[{left:[j]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",e1,Un]}],basis:[{basis:Ge()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Un]}],grow:[{grow:He()}],shrink:[{shrink:He()}],order:[{order:["first","last","none",e1,Un]}],"grid-cols":[{"grid-cols":[t1]}],"col-start-end":[{col:["auto",{span:["full",e1,Un]},Un]}],"col-start":[{"col-start":nt()}],"col-end":[{"col-end":nt()}],"grid-rows":[{"grid-rows":[t1]}],"row-start-end":[{row:["auto",{span:[e1,Un]},Un]}],"row-start":[{"row-start":nt()}],"row-end":[{"row-end":nt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Un]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Un]}],gap:[{gap:[k]}],"gap-x":[{"gap-x":[k]}],"gap-y":[{"gap-y":[k]}],"justify-content":[{justify:["normal",...qe()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...qe(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...qe(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[q]}],px:[{px:[q]}],py:[{py:[q]}],ps:[{ps:[q]}],pe:[{pe:[q]}],pt:[{pt:[q]}],pr:[{pr:[q]}],pb:[{pb:[q]}],pl:[{pl:[q]}],m:[{m:[B]}],mx:[{mx:[B]}],my:[{my:[B]}],ms:[{ms:[B]}],me:[{me:[B]}],mt:[{mt:[B]}],mr:[{mr:[B]}],mb:[{mb:[B]}],ml:[{ml:[B]}],"space-x":[{"space-x":[ue]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[ue]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Un,t]}],"min-w":[{"min-w":[Un,t,"min","max","fit"]}],"max-w":[{"max-w":[Un,t,"none","full","min","max","fit","prose",{screen:[tp]},tp]}],h:[{h:[Un,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Un,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Un,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Un,t,"auto","min","max","fit"]}],"font-size":[{text:["base",tp,ep]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",UD]}],"font-family":[{font:[t1]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Un]}],"line-clamp":[{"line-clamp":["none",Xv,UD]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",xh,Un]}],"list-image":[{"list-image":["none",Un]}],"list-style-type":[{list:["none","disc","decimal",Un]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[U]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[U]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...rt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",xh,ep]}],"underline-offset":[{"underline-offset":["auto",xh,Un]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ve()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Un]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Un]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[U]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...dt(),c_e]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",l_e]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},d_e]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[$]}],"gradient-via-pos":[{via:[$]}],"gradient-to-pos":[{to:[$]}],"gradient-from":[{from:[L]}],"gradient-via":[{via:[L]}],"gradient-to":[{to:[L]}],rounded:[{rounded:[u]}],"rounded-s":[{"rounded-s":[u]}],"rounded-e":[{"rounded-e":[u]}],"rounded-t":[{"rounded-t":[u]}],"rounded-r":[{"rounded-r":[u]}],"rounded-b":[{"rounded-b":[u]}],"rounded-l":[{"rounded-l":[u]}],"rounded-ss":[{"rounded-ss":[u]}],"rounded-se":[{"rounded-se":[u]}],"rounded-ee":[{"rounded-ee":[u]}],"rounded-es":[{"rounded-es":[u]}],"rounded-tl":[{"rounded-tl":[u]}],"rounded-tr":[{"rounded-tr":[u]}],"rounded-br":[{"rounded-br":[u]}],"rounded-bl":[{"rounded-bl":[u]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[U]}],"border-style":[{border:[...rt(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[U]}],"divide-style":[{divide:rt()}],"border-color":[{border:[l]}],"border-color-x":[{"border-x":[l]}],"border-color-y":[{"border-y":[l]}],"border-color-s":[{"border-s":[l]}],"border-color-e":[{"border-e":[l]}],"border-color-t":[{"border-t":[l]}],"border-color-r":[{"border-r":[l]}],"border-color-b":[{"border-b":[l]}],"border-color-l":[{"border-l":[l]}],"divide-color":[{divide:[l]}],"outline-style":[{outline:["",...rt()]}],"outline-offset":[{"outline-offset":[xh,Un]}],"outline-w":[{outline:[xh,ep]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Ze()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[U]}],"ring-offset-w":[{"ring-offset":[xh,ep]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",tp,h_e]}],"shadow-color":[{shadow:[t1]}],opacity:[{opacity:[U]}],"mix-blend":[{"mix-blend":[...at(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":at()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[n]}],contrast:[{contrast:[v]}],"drop-shadow":[{"drop-shadow":["","none",tp,Un]}],grayscale:[{grayscale:[w]}],"hue-rotate":[{"hue-rotate":[P]}],invert:[{invert:[C]}],saturate:[{saturate:[H]}],sepia:[{sepia:[Q]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[v]}],"backdrop-grayscale":[{"backdrop-grayscale":[w]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[P]}],"backdrop-invert":[{"backdrop-invert":[C]}],"backdrop-opacity":[{"backdrop-opacity":[U]}],"backdrop-saturate":[{"backdrop-saturate":[H]}],"backdrop-sepia":[{"backdrop-sepia":[Q]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[f]}],"border-spacing-x":[{"border-spacing-x":[f]}],"border-spacing-y":[{"border-spacing-y":[f]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Un]}],duration:[{duration:Gt()}],ease:[{ease:["linear","in","out","in-out",Un]}],delay:[{delay:Gt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Un]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[te]}],"scale-x":[{"scale-x":[te]}],"scale-y":[{"scale-y":[te]}],rotate:[{rotate:[e1,Un]}],"translate-x":[{"translate-x":[me]}],"translate-y":[{"translate-y":[me]}],"skew-x":[{"skew-x":[ae]}],"skew-y":[{"skew-y":[ae]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Un]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Un]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ve()}],"scroll-mx":[{"scroll-mx":Ve()}],"scroll-my":[{"scroll-my":Ve()}],"scroll-ms":[{"scroll-ms":Ve()}],"scroll-me":[{"scroll-me":Ve()}],"scroll-mt":[{"scroll-mt":Ve()}],"scroll-mr":[{"scroll-mr":Ve()}],"scroll-mb":[{"scroll-mb":Ve()}],"scroll-ml":[{"scroll-ml":Ve()}],"scroll-p":[{"scroll-p":Ve()}],"scroll-px":[{"scroll-px":Ve()}],"scroll-py":[{"scroll-py":Ve()}],"scroll-ps":[{"scroll-ps":Ve()}],"scroll-pe":[{"scroll-pe":Ve()}],"scroll-pt":[{"scroll-pt":Ve()}],"scroll-pr":[{"scroll-pr":Ve()}],"scroll-pb":[{"scroll-pb":Ve()}],"scroll-pl":[{"scroll-pl":Ve()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Un]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[xh,ep,UD]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},y_e=Jye(g_e);function sr(...e){return y_e(Gn(e))}const __e=uye,UJ=X.forwardRef(({className:e,...t},r)=>A.jsx(SJ,{ref:r,className:sr("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));UJ.displayName=SJ.displayName;const v_e=jT("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),GJ=X.forwardRef(({className:e,variant:t,...r},n)=>A.jsx(TJ,{ref:n,className:sr(v_e({variant:t}),e),...r}));GJ.displayName=TJ.displayName;const x_e=X.forwardRef(({className:e,...t},r)=>A.jsx(PJ,{ref:r,className:sr("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",e),...t}));x_e.displayName=PJ.displayName;const qJ=X.forwardRef(({className:e,...t},r)=>A.jsx(CJ,{ref:r,className:sr("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:A.jsx(Hp,{className:"h-4 w-4"})}));qJ.displayName=CJ.displayName;const HJ=X.forwardRef(({className:e,...t},r)=>A.jsx(EJ,{ref:r,className:sr("text-sm font-semibold",e),...t}));HJ.displayName=EJ.displayName;const WJ=X.forwardRef(({className:e,...t},r)=>A.jsx(AJ,{ref:r,className:sr("text-sm opacity-90",e),...t}));WJ.displayName=AJ.displayName;function b_e(){const{toasts:e}=bge();return A.jsxs(__e,{children:[e.map(function({id:t,title:r,description:n,action:l,...u}){return A.jsxs(GJ,{...u,children:[A.jsxs("div",{className:"grid gap-1",children:[r&&A.jsx(HJ,{children:r}),n&&A.jsx(WJ,{children:n})]}),l,A.jsx(qJ,{})]},t)}),A.jsx(UJ,{})]})}var OG=["light","dark"],w_e="(prefers-color-scheme: dark)",S_e=X.createContext(void 0),T_e={setTheme:e=>{},themes:[]},E_e=()=>{var e;return(e=X.useContext(S_e))!=null?e:T_e};X.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:n,enableColorScheme:l,defaultTheme:u,value:f,attrs:o,nonce:v})=>{let w=u==="system",P=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map($=>`'${$}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,C=l?OG.includes(u)&&u?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${u}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",k=($,j=!1,B=!0)=>{let U=f?f[$]:$,q=j?$+"|| ''":`'${U}'`,H="";return l&&B&&!j&&OG.includes($)&&(H+=`d.style.colorScheme = '${$}';`),r==="class"?j||U?H+=`c.add(${q})`:H+="null":U&&(H+=`d[s](n,${q})`),H},L=e?`!function(){${P}${k(e)}}()`:n?`!function(){try{${P}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${w})){var t='${w_e}',m=window.matchMedia(t);if(m.media!==t||m.matches){${k("dark")}}else{${k("light")}}}else if(e){${f?`var x=${JSON.stringify(f)};`:""}${k(f?"x[e]":"e",!0)}}${w?"":"else{"+k(u,!1,!1)+"}"}${C}}catch(e){}}()`:`!function(){try{${P}var e=localStorage.getItem('${t}');if(e){${f?`var x=${JSON.stringify(f)};`:""}${k(f?"x[e]":"e",!0)}}else{${k(u,!1,!1)};}${C}}catch(t){}}();`;return X.createElement("script",{nonce:v,dangerouslySetInnerHTML:{__html:L}})});var A_e=e=>{switch(e){case"success":return I_e;case"info":return k_e;case"warning":return O_e;case"error":return R_e;default:return null}},P_e=Array(12).fill(0),C_e=({visible:e,className:t})=>De.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},De.createElement("div",{className:"sonner-spinner"},P_e.map((r,n)=>De.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),I_e=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),O_e=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),k_e=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),R_e=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),M_e=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},De.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),De.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),D_e=()=>{let[e,t]=De.useState(document.hidden);return De.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},oN=1,L_e=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...n}=e,l=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:oN++,u=this.toasts.find(o=>o.id===l),f=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(l)&&this.dismissedToasts.delete(l),u?this.toasts=this.toasts.map(o=>o.id===l?(this.publish({...o,...e,id:l,title:r}),{...o,...e,id:l,dismissible:f,title:r}):o):this.addToast({title:r,...n,dismissible:f,id:l}),l},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let n=e instanceof Promise?e:e(),l=r!==void 0,u,f=n.then(async v=>{if(u=["resolve",v],De.isValidElement(v))l=!1,this.create({id:r,type:"default",message:v});else if(N_e(v)&&!v.ok){l=!1;let w=typeof t.error=="function"?await t.error(`HTTP error! status: ${v.status}`):t.error,P=typeof t.description=="function"?await t.description(`HTTP error! status: ${v.status}`):t.description;this.create({id:r,type:"error",message:w,description:P})}else if(t.success!==void 0){l=!1;let w=typeof t.success=="function"?await t.success(v):t.success,P=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"success",message:w,description:P})}}).catch(async v=>{if(u=["reject",v],t.error!==void 0){l=!1;let w=typeof t.error=="function"?await t.error(v):t.error,P=typeof t.description=="function"?await t.description(v):t.description;this.create({id:r,type:"error",message:w,description:P})}}).finally(()=>{var v;l&&(this.dismiss(r),r=void 0),(v=t.finally)==null||v.call(t)}),o=()=>new Promise((v,w)=>f.then(()=>u[0]==="reject"?w(u[1]):v(u[1])).catch(w));return typeof r!="string"&&typeof r!="number"?{unwrap:o}:Object.assign(r,{unwrap:o})},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||oN++;return this.create({jsx:e(r),id:r,...t}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Dl=new L_e,j_e=(e,t)=>{let r=(t==null?void 0:t.id)||oN++;return Dl.addToast({title:e,...t,id:r}),r},N_e=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",z_e=j_e,F_e=()=>Dl.toasts,B_e=()=>Dl.getActiveToasts(),Ni=Object.assign(z_e,{success:Dl.success,info:Dl.info,warning:Dl.warning,error:Dl.error,custom:Dl.custom,message:Dl.message,promise:Dl.promise,dismiss:Dl.dismiss,loading:Dl.loading},{getHistory:F_e,getToasts:B_e});function $_e(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",t==="top"&&r.firstChild?r.insertBefore(n,r.firstChild):r.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}$_e(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function eP(e){return e.label!==void 0}var V_e=3,U_e="32px",G_e="16px",kG=4e3,q_e=356,H_e=14,W_e=20,Z_e=200;function wu(...e){return e.filter(Boolean).join(" ")}function X_e(e){let[t,r]=e.split("-"),n=[];return t&&n.push(t),r&&n.push(r),n}var K_e=e=>{var t,r,n,l,u,f,o,v,w,P,C;let{invert:k,toast:L,unstyled:$,interacting:j,setHeights:B,visibleToasts:U,heights:q,index:H,toasts:te,expanded:Q,removeToast:ae,defaultRichColors:ue,closeButton:me,style:Ce,cancelButtonStyle:Fe,actionButtonStyle:Ge,className:Ve="",descriptionClassName:Ze="",duration:nt,position:dt,gap:rt,loadingIcon:at,expandByDefault:qe,classNames:He,icons:Et,closeButtonAriaLabel:Gt="Close toast",pauseWhenPageIsHidden:Ot}=e,[$t,ur]=De.useState(null),[Yr,hn]=De.useState(null),[rr,Wr]=De.useState(!1),[Rt,Yt]=De.useState(!1),[ir,jt]=De.useState(!1),[Ir,Xr]=De.useState(!1),[Vn,Hn]=De.useState(!1),[ei,Nn]=De.useState(0),[ho,ot]=De.useState(0),St=De.useRef(L.duration||nt||kG),Nt=De.useRef(null),dr=De.useRef(null),nr=H===0,er=H+1<=U,wr=L.type,Tn=L.dismissible!==!1,Kn=L.className||"",Po=L.descriptionClassName||"",Ji=De.useMemo(()=>q.findIndex(gn=>gn.toastId===L.id)||0,[q,L.id]),Ps=De.useMemo(()=>{var gn;return(gn=L.closeButton)!=null?gn:me},[L.closeButton,me]),ps=De.useMemo(()=>L.duration||nt||kG,[L.duration,nt]),qa=De.useRef(0),Wo=De.useRef(0),fo=De.useRef(0),as=De.useRef(null),[Ha,Wa]=dt.split("-"),Tl=De.useMemo(()=>q.reduce((gn,si,Wn)=>Wn>=Ji?gn:gn+si.height,0),[q,Ji]),Ul=D_e(),gc=L.invert||k,yc=wr==="loading";Wo.current=De.useMemo(()=>Ji*rt+Tl,[Ji,Tl]),De.useEffect(()=>{St.current=ps},[ps]),De.useEffect(()=>{Wr(!0)},[]),De.useEffect(()=>{let gn=dr.current;if(gn){let si=gn.getBoundingClientRect().height;return ot(si),B(Wn=>[{toastId:L.id,height:si,position:L.position},...Wn]),()=>B(Wn=>Wn.filter(aa=>aa.toastId!==L.id))}},[B,L.id]),De.useLayoutEffect(()=>{if(!rr)return;let gn=dr.current,si=gn.style.height;gn.style.height="auto";let Wn=gn.getBoundingClientRect().height;gn.style.height=si,ot(Wn),B(aa=>aa.find(ms=>ms.toastId===L.id)?aa.map(ms=>ms.toastId===L.id?{...ms,height:Wn}:ms):[{toastId:L.id,height:Wn,position:L.position},...aa])},[rr,L.title,L.description,B,L.id]);let Mn=De.useCallback(()=>{Yt(!0),Nn(Wo.current),B(gn=>gn.filter(si=>si.toastId!==L.id)),setTimeout(()=>{ae(L)},Z_e)},[L,ae,B,Wo]);De.useEffect(()=>{if(L.promise&&wr==="loading"||L.duration===1/0||L.type==="loading")return;let gn;return Q||j||Ot&&Ul?(()=>{if(fo.current<qa.current){let si=new Date().getTime()-qa.current;St.current=St.current-si}fo.current=new Date().getTime()})():St.current!==1/0&&(qa.current=new Date().getTime(),gn=setTimeout(()=>{var si;(si=L.onAutoClose)==null||si.call(L,L),Mn()},St.current)),()=>clearTimeout(gn)},[Q,j,L,wr,Ot,Ul,Mn]),De.useEffect(()=>{L.delete&&Mn()},[Mn,L.delete]);function Mo(){var gn,si,Wn;return Et!=null&&Et.loading?De.createElement("div",{className:wu(He==null?void 0:He.loader,(gn=L==null?void 0:L.classNames)==null?void 0:gn.loader,"sonner-loader"),"data-visible":wr==="loading"},Et.loading):at?De.createElement("div",{className:wu(He==null?void 0:He.loader,(si=L==null?void 0:L.classNames)==null?void 0:si.loader,"sonner-loader"),"data-visible":wr==="loading"},at):De.createElement(C_e,{className:wu(He==null?void 0:He.loader,(Wn=L==null?void 0:L.classNames)==null?void 0:Wn.loader),visible:wr==="loading"})}return De.createElement("li",{tabIndex:0,ref:dr,className:wu(Ve,Kn,He==null?void 0:He.toast,(t=L==null?void 0:L.classNames)==null?void 0:t.toast,He==null?void 0:He.default,He==null?void 0:He[wr],(r=L==null?void 0:L.classNames)==null?void 0:r[wr]),"data-sonner-toast":"","data-rich-colors":(n=L.richColors)!=null?n:ue,"data-styled":!(L.jsx||L.unstyled||$),"data-mounted":rr,"data-promise":!!L.promise,"data-swiped":Vn,"data-removed":Rt,"data-visible":er,"data-y-position":Ha,"data-x-position":Wa,"data-index":H,"data-front":nr,"data-swiping":ir,"data-dismissible":Tn,"data-type":wr,"data-invert":gc,"data-swipe-out":Ir,"data-swipe-direction":Yr,"data-expanded":!!(Q||qe&&rr),style:{"--index":H,"--toasts-before":H,"--z-index":te.length-H,"--offset":`${Rt?ei:Wo.current}px`,"--initial-height":qe?"auto":`${ho}px`,...Ce,...L.style},onDragEnd:()=>{jt(!1),ur(null),as.current=null},onPointerDown:gn=>{yc||!Tn||(Nt.current=new Date,Nn(Wo.current),gn.target.setPointerCapture(gn.pointerId),gn.target.tagName!=="BUTTON"&&(jt(!0),as.current={x:gn.clientX,y:gn.clientY}))},onPointerUp:()=>{var gn,si,Wn,aa;if(Ir||!Tn)return;as.current=null;let ms=Number(((gn=dr.current)==null?void 0:gn.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),wt=Number(((si=dr.current)==null?void 0:si.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Cs=new Date().getTime()-((Wn=Nt.current)==null?void 0:Wn.getTime()),la=$t==="x"?ms:wt,Aa=Math.abs(la)/Cs;if(Math.abs(la)>=W_e||Aa>.11){Nn(Wo.current),(aa=L.onDismiss)==null||aa.call(L,L),hn($t==="x"?ms>0?"right":"left":wt>0?"down":"up"),Mn(),Xr(!0),Hn(!1);return}jt(!1),ur(null)},onPointerMove:gn=>{var si,Wn,aa,ms;if(!as.current||!Tn||((si=window.getSelection())==null?void 0:si.toString().length)>0)return;let wt=gn.clientY-as.current.y,Cs=gn.clientX-as.current.x,la=(Wn=e.swipeDirections)!=null?Wn:X_e(dt);!$t&&(Math.abs(Cs)>1||Math.abs(wt)>1)&&ur(Math.abs(Cs)>Math.abs(wt)?"x":"y");let Aa={x:0,y:0};$t==="y"?(la.includes("top")||la.includes("bottom"))&&(la.includes("top")&&wt<0||la.includes("bottom")&&wt>0)&&(Aa.y=wt):$t==="x"&&(la.includes("left")||la.includes("right"))&&(la.includes("left")&&Cs<0||la.includes("right")&&Cs>0)&&(Aa.x=Cs),(Math.abs(Aa.x)>0||Math.abs(Aa.y)>0)&&Hn(!0),(aa=dr.current)==null||aa.style.setProperty("--swipe-amount-x",`${Aa.x}px`),(ms=dr.current)==null||ms.style.setProperty("--swipe-amount-y",`${Aa.y}px`)}},Ps&&!L.jsx?De.createElement("button",{"aria-label":Gt,"data-disabled":yc,"data-close-button":!0,onClick:yc||!Tn?()=>{}:()=>{var gn;Mn(),(gn=L.onDismiss)==null||gn.call(L,L)},className:wu(He==null?void 0:He.closeButton,(l=L==null?void 0:L.classNames)==null?void 0:l.closeButton)},(u=Et==null?void 0:Et.close)!=null?u:M_e):null,L.jsx||X.isValidElement(L.title)?L.jsx?L.jsx:typeof L.title=="function"?L.title():L.title:De.createElement(De.Fragment,null,wr||L.icon||L.promise?De.createElement("div",{"data-icon":"",className:wu(He==null?void 0:He.icon,(f=L==null?void 0:L.classNames)==null?void 0:f.icon)},L.promise||L.type==="loading"&&!L.icon?L.icon||Mo():null,L.type!=="loading"?L.icon||(Et==null?void 0:Et[wr])||A_e(wr):null):null,De.createElement("div",{"data-content":"",className:wu(He==null?void 0:He.content,(o=L==null?void 0:L.classNames)==null?void 0:o.content)},De.createElement("div",{"data-title":"",className:wu(He==null?void 0:He.title,(v=L==null?void 0:L.classNames)==null?void 0:v.title)},typeof L.title=="function"?L.title():L.title),L.description?De.createElement("div",{"data-description":"",className:wu(Ze,Po,He==null?void 0:He.description,(w=L==null?void 0:L.classNames)==null?void 0:w.description)},typeof L.description=="function"?L.description():L.description):null),X.isValidElement(L.cancel)?L.cancel:L.cancel&&eP(L.cancel)?De.createElement("button",{"data-button":!0,"data-cancel":!0,style:L.cancelButtonStyle||Fe,onClick:gn=>{var si,Wn;eP(L.cancel)&&Tn&&((Wn=(si=L.cancel).onClick)==null||Wn.call(si,gn),Mn())},className:wu(He==null?void 0:He.cancelButton,(P=L==null?void 0:L.classNames)==null?void 0:P.cancelButton)},L.cancel.label):null,X.isValidElement(L.action)?L.action:L.action&&eP(L.action)?De.createElement("button",{"data-button":!0,"data-action":!0,style:L.actionButtonStyle||Ge,onClick:gn=>{var si,Wn;eP(L.action)&&((Wn=(si=L.action).onClick)==null||Wn.call(si,gn),!gn.defaultPrevented&&Mn())},className:wu(He==null?void 0:He.actionButton,(C=L==null?void 0:L.classNames)==null?void 0:C.actionButton)},L.action.label):null))};function RG(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Y_e(e,t){let r={};return[e,t].forEach((n,l)=>{let u=l===1,f=u?"--mobile-offset":"--offset",o=u?G_e:U_e;function v(w){["top","right","bottom","left"].forEach(P=>{r[`${f}-${P}`]=typeof w=="number"?`${w}px`:w})}typeof n=="number"||typeof n=="string"?v(n):typeof n=="object"?["top","right","bottom","left"].forEach(w=>{n[w]===void 0?r[`${f}-${w}`]=o:r[`${f}-${w}`]=typeof n[w]=="number"?`${n[w]}px`:n[w]}):v(o)}),r}var J_e=X.forwardRef(function(e,t){let{invert:r,position:n="bottom-right",hotkey:l=["altKey","KeyT"],expand:u,closeButton:f,className:o,offset:v,mobileOffset:w,theme:P="light",richColors:C,duration:k,style:L,visibleToasts:$=V_e,toastOptions:j,dir:B=RG(),gap:U=H_e,loadingIcon:q,icons:H,containerAriaLabel:te="Notifications",pauseWhenPageIsHidden:Q}=e,[ae,ue]=De.useState([]),me=De.useMemo(()=>Array.from(new Set([n].concat(ae.filter(Ot=>Ot.position).map(Ot=>Ot.position)))),[ae,n]),[Ce,Fe]=De.useState([]),[Ge,Ve]=De.useState(!1),[Ze,nt]=De.useState(!1),[dt,rt]=De.useState(P!=="system"?P:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),at=De.useRef(null),qe=l.join("+").replace(/Key/g,"").replace(/Digit/g,""),He=De.useRef(null),Et=De.useRef(!1),Gt=De.useCallback(Ot=>{ue($t=>{var ur;return(ur=$t.find(Yr=>Yr.id===Ot.id))!=null&&ur.delete||Dl.dismiss(Ot.id),$t.filter(({id:Yr})=>Yr!==Ot.id)})},[]);return De.useEffect(()=>Dl.subscribe(Ot=>{if(Ot.dismiss){ue($t=>$t.map(ur=>ur.id===Ot.id?{...ur,delete:!0}:ur));return}setTimeout(()=>{tJ.flushSync(()=>{ue($t=>{let ur=$t.findIndex(Yr=>Yr.id===Ot.id);return ur!==-1?[...$t.slice(0,ur),{...$t[ur],...Ot},...$t.slice(ur+1)]:[Ot,...$t]})})})}),[]),De.useEffect(()=>{if(P!=="system"){rt(P);return}if(P==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?rt("dark"):rt("light")),typeof window>"u")return;let Ot=window.matchMedia("(prefers-color-scheme: dark)");try{Ot.addEventListener("change",({matches:$t})=>{rt($t?"dark":"light")})}catch{Ot.addListener(({matches:ur})=>{try{rt(ur?"dark":"light")}catch(Yr){console.error(Yr)}})}},[P]),De.useEffect(()=>{ae.length<=1&&Ve(!1)},[ae]),De.useEffect(()=>{let Ot=$t=>{var ur,Yr;l.every(hn=>$t[hn]||$t.code===hn)&&(Ve(!0),(ur=at.current)==null||ur.focus()),$t.code==="Escape"&&(document.activeElement===at.current||(Yr=at.current)!=null&&Yr.contains(document.activeElement))&&Ve(!1)};return document.addEventListener("keydown",Ot),()=>document.removeEventListener("keydown",Ot)},[l]),De.useEffect(()=>{if(at.current)return()=>{He.current&&(He.current.focus({preventScroll:!0}),He.current=null,Et.current=!1)}},[at.current]),De.createElement("section",{ref:t,"aria-label":`${te} ${qe}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},me.map((Ot,$t)=>{var ur;let[Yr,hn]=Ot.split("-");return ae.length?De.createElement("ol",{key:Ot,dir:B==="auto"?RG():B,tabIndex:-1,ref:at,className:o,"data-sonner-toaster":!0,"data-theme":dt,"data-y-position":Yr,"data-lifted":Ge&&ae.length>1&&!u,"data-x-position":hn,style:{"--front-toast-height":`${((ur=Ce[0])==null?void 0:ur.height)||0}px`,"--width":`${q_e}px`,"--gap":`${U}px`,...L,...Y_e(v,w)},onBlur:rr=>{Et.current&&!rr.currentTarget.contains(rr.relatedTarget)&&(Et.current=!1,He.current&&(He.current.focus({preventScroll:!0}),He.current=null))},onFocus:rr=>{rr.target instanceof HTMLElement&&rr.target.dataset.dismissible==="false"||Et.current||(Et.current=!0,He.current=rr.relatedTarget)},onMouseEnter:()=>Ve(!0),onMouseMove:()=>Ve(!0),onMouseLeave:()=>{Ze||Ve(!1)},onDragEnd:()=>Ve(!1),onPointerDown:rr=>{rr.target instanceof HTMLElement&&rr.target.dataset.dismissible==="false"||nt(!0)},onPointerUp:()=>nt(!1)},ae.filter(rr=>!rr.position&&$t===0||rr.position===Ot).map((rr,Wr)=>{var Rt,Yt;return De.createElement(K_e,{key:rr.id,icons:H,index:Wr,toast:rr,defaultRichColors:C,duration:(Rt=j==null?void 0:j.duration)!=null?Rt:k,className:j==null?void 0:j.className,descriptionClassName:j==null?void 0:j.descriptionClassName,invert:r,visibleToasts:$,closeButton:(Yt=j==null?void 0:j.closeButton)!=null?Yt:f,interacting:Ze,position:Ot,style:j==null?void 0:j.style,unstyled:j==null?void 0:j.unstyled,classNames:j==null?void 0:j.classNames,cancelButtonStyle:j==null?void 0:j.cancelButtonStyle,actionButtonStyle:j==null?void 0:j.actionButtonStyle,removeToast:Gt,toasts:ae.filter(ir=>ir.position==rr.position),heights:Ce.filter(ir=>ir.position==rr.position),setHeights:Fe,expandByDefault:u,gap:U,loadingIcon:q,expanded:Ge,pauseWhenPageIsHidden:Q,swipeDirections:e.swipeDirections})})):null}))});const Q_e=({...e})=>{const{theme:t="system"}=E_e();return A.jsx(J_e,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var eve=QF[" useId ".trim().toString()]||(()=>{}),tve=0;function jd(e){const[t,r]=X.useState(eve());return fs(()=>{r(n=>n??String(tve++))},[e]),t?`radix-${t}`:""}const rve=["top","right","bottom","left"],Wp=Math.min,ic=Math.max,PC=Math.round,tP=Math.floor,Nd=e=>({x:e,y:e}),nve={left:"right",right:"left",bottom:"top",top:"bottom"},ive={start:"end",end:"start"};function sN(e,t,r){return ic(e,Wp(t,r))}function Zh(e,t){return typeof e=="function"?e(t):e}function Xh(e){return e.split("-")[0]}function px(e){return e.split("-")[1]}function rB(e){return e==="x"?"y":"x"}function nB(e){return e==="y"?"height":"width"}const ove=new Set(["top","bottom"]);function Od(e){return ove.has(Xh(e))?"y":"x"}function iB(e){return rB(Od(e))}function sve(e,t,r){r===void 0&&(r=!1);const n=px(e),l=iB(e),u=nB(l);let f=l==="x"?n===(r?"end":"start")?"right":"left":n==="start"?"bottom":"top";return t.reference[u]>t.floating[u]&&(f=CC(f)),[f,CC(f)]}function ave(e){const t=CC(e);return[aN(e),t,aN(t)]}function aN(e){return e.replace(/start|end/g,t=>ive[t])}const MG=["left","right"],DG=["right","left"],lve=["top","bottom"],cve=["bottom","top"];function uve(e,t,r){switch(e){case"top":case"bottom":return r?t?DG:MG:t?MG:DG;case"left":case"right":return t?lve:cve;default:return[]}}function dve(e,t,r,n){const l=px(e);let u=uve(Xh(e),r==="start",n);return l&&(u=u.map(f=>f+"-"+l),t&&(u=u.concat(u.map(aN)))),u}function CC(e){return e.replace(/left|right|bottom|top/g,t=>nve[t])}function hve(e){return{top:0,right:0,bottom:0,left:0,...e}}function ZJ(e){return typeof e!="number"?hve(e):{top:e,right:e,bottom:e,left:e}}function IC(e){const{x:t,y:r,width:n,height:l}=e;return{width:n,height:l,top:r,left:t,right:t+n,bottom:r+l,x:t,y:r}}function LG(e,t,r){let{reference:n,floating:l}=e;const u=Od(t),f=iB(t),o=nB(f),v=Xh(t),w=u==="y",P=n.x+n.width/2-l.width/2,C=n.y+n.height/2-l.height/2,k=n[o]/2-l[o]/2;let L;switch(v){case"top":L={x:P,y:n.y-l.height};break;case"bottom":L={x:P,y:n.y+n.height};break;case"right":L={x:n.x+n.width,y:C};break;case"left":L={x:n.x-l.width,y:C};break;default:L={x:n.x,y:n.y}}switch(px(t)){case"start":L[f]-=k*(r&&w?-1:1);break;case"end":L[f]+=k*(r&&w?-1:1);break}return L}const fve=async(e,t,r)=>{const{placement:n="bottom",strategy:l="absolute",middleware:u=[],platform:f}=r,o=u.filter(Boolean),v=await(f.isRTL==null?void 0:f.isRTL(t));let w=await f.getElementRects({reference:e,floating:t,strategy:l}),{x:P,y:C}=LG(w,n,v),k=n,L={},$=0;for(let j=0;j<o.length;j++){const{name:B,fn:U}=o[j],{x:q,y:H,data:te,reset:Q}=await U({x:P,y:C,initialPlacement:n,placement:k,strategy:l,middlewareData:L,rects:w,platform:f,elements:{reference:e,floating:t}});P=q??P,C=H??C,L={...L,[B]:{...L[B],...te}},Q&&$<=50&&($++,typeof Q=="object"&&(Q.placement&&(k=Q.placement),Q.rects&&(w=Q.rects===!0?await f.getElementRects({reference:e,floating:t,strategy:l}):Q.rects),{x:P,y:C}=LG(w,k,v)),j=-1)}return{x:P,y:C,placement:k,strategy:l,middlewareData:L}};async function SS(e,t){var r;t===void 0&&(t={});const{x:n,y:l,platform:u,rects:f,elements:o,strategy:v}=e,{boundary:w="clippingAncestors",rootBoundary:P="viewport",elementContext:C="floating",altBoundary:k=!1,padding:L=0}=Zh(t,e),$=ZJ(L),B=o[k?C==="floating"?"reference":"floating":C],U=IC(await u.getClippingRect({element:(r=await(u.isElement==null?void 0:u.isElement(B)))==null||r?B:B.contextElement||await(u.getDocumentElement==null?void 0:u.getDocumentElement(o.floating)),boundary:w,rootBoundary:P,strategy:v})),q=C==="floating"?{x:n,y:l,width:f.floating.width,height:f.floating.height}:f.reference,H=await(u.getOffsetParent==null?void 0:u.getOffsetParent(o.floating)),te=await(u.isElement==null?void 0:u.isElement(H))?await(u.getScale==null?void 0:u.getScale(H))||{x:1,y:1}:{x:1,y:1},Q=IC(u.convertOffsetParentRelativeRectToViewportRelativeRect?await u.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:q,offsetParent:H,strategy:v}):q);return{top:(U.top-Q.top+$.top)/te.y,bottom:(Q.bottom-U.bottom+$.bottom)/te.y,left:(U.left-Q.left+$.left)/te.x,right:(Q.right-U.right+$.right)/te.x}}const pve=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:n,placement:l,rects:u,platform:f,elements:o,middlewareData:v}=t,{element:w,padding:P=0}=Zh(e,t)||{};if(w==null)return{};const C=ZJ(P),k={x:r,y:n},L=iB(l),$=nB(L),j=await f.getDimensions(w),B=L==="y",U=B?"top":"left",q=B?"bottom":"right",H=B?"clientHeight":"clientWidth",te=u.reference[$]+u.reference[L]-k[L]-u.floating[$],Q=k[L]-u.reference[L],ae=await(f.getOffsetParent==null?void 0:f.getOffsetParent(w));let ue=ae?ae[H]:0;(!ue||!await(f.isElement==null?void 0:f.isElement(ae)))&&(ue=o.floating[H]||u.floating[$]);const me=te/2-Q/2,Ce=ue/2-j[$]/2-1,Fe=Wp(C[U],Ce),Ge=Wp(C[q],Ce),Ve=Fe,Ze=ue-j[$]-Ge,nt=ue/2-j[$]/2+me,dt=sN(Ve,nt,Ze),rt=!v.arrow&&px(l)!=null&&nt!==dt&&u.reference[$]/2-(nt<Ve?Fe:Ge)-j[$]/2<0,at=rt?nt<Ve?nt-Ve:nt-Ze:0;return{[L]:k[L]+at,data:{[L]:dt,centerOffset:nt-dt-at,...rt&&{alignmentOffset:at}},reset:rt}}}),mve=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,n;const{placement:l,middlewareData:u,rects:f,initialPlacement:o,platform:v,elements:w}=t,{mainAxis:P=!0,crossAxis:C=!0,fallbackPlacements:k,fallbackStrategy:L="bestFit",fallbackAxisSideDirection:$="none",flipAlignment:j=!0,...B}=Zh(e,t);if((r=u.arrow)!=null&&r.alignmentOffset)return{};const U=Xh(l),q=Od(o),H=Xh(o)===o,te=await(v.isRTL==null?void 0:v.isRTL(w.floating)),Q=k||(H||!j?[CC(o)]:ave(o)),ae=$!=="none";!k&&ae&&Q.push(...dve(o,j,$,te));const ue=[o,...Q],me=await SS(t,B),Ce=[];let Fe=((n=u.flip)==null?void 0:n.overflows)||[];if(P&&Ce.push(me[U]),C){const nt=sve(l,f,te);Ce.push(me[nt[0]],me[nt[1]])}if(Fe=[...Fe,{placement:l,overflows:Ce}],!Ce.every(nt=>nt<=0)){var Ge,Ve;const nt=(((Ge=u.flip)==null?void 0:Ge.index)||0)+1,dt=ue[nt];if(dt&&(!(C==="alignment"?q!==Od(dt):!1)||Fe.every(qe=>qe.overflows[0]>0&&Od(qe.placement)===q)))return{data:{index:nt,overflows:Fe},reset:{placement:dt}};let rt=(Ve=Fe.filter(at=>at.overflows[0]<=0).sort((at,qe)=>at.overflows[1]-qe.overflows[1])[0])==null?void 0:Ve.placement;if(!rt)switch(L){case"bestFit":{var Ze;const at=(Ze=Fe.filter(qe=>{if(ae){const He=Od(qe.placement);return He===q||He==="y"}return!0}).map(qe=>[qe.placement,qe.overflows.filter(He=>He>0).reduce((He,Et)=>He+Et,0)]).sort((qe,He)=>qe[1]-He[1])[0])==null?void 0:Ze[0];at&&(rt=at);break}case"initialPlacement":rt=o;break}if(l!==rt)return{reset:{placement:rt}}}return{}}}};function jG(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function NG(e){return rve.some(t=>e[t]>=0)}const gve=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:n="referenceHidden",...l}=Zh(e,t);switch(n){case"referenceHidden":{const u=await SS(t,{...l,elementContext:"reference"}),f=jG(u,r.reference);return{data:{referenceHiddenOffsets:f,referenceHidden:NG(f)}}}case"escaped":{const u=await SS(t,{...l,altBoundary:!0}),f=jG(u,r.floating);return{data:{escapedOffsets:f,escaped:NG(f)}}}default:return{}}}}},XJ=new Set(["left","top"]);async function yve(e,t){const{placement:r,platform:n,elements:l}=e,u=await(n.isRTL==null?void 0:n.isRTL(l.floating)),f=Xh(r),o=px(r),v=Od(r)==="y",w=XJ.has(f)?-1:1,P=u&&v?-1:1,C=Zh(t,e);let{mainAxis:k,crossAxis:L,alignmentAxis:$}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:C.mainAxis||0,crossAxis:C.crossAxis||0,alignmentAxis:C.alignmentAxis};return o&&typeof $=="number"&&(L=o==="end"?$*-1:$),v?{x:L*P,y:k*w}:{x:k*w,y:L*P}}const _ve=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,n;const{x:l,y:u,placement:f,middlewareData:o}=t,v=await yve(t,e);return f===((r=o.offset)==null?void 0:r.placement)&&(n=o.arrow)!=null&&n.alignmentOffset?{}:{x:l+v.x,y:u+v.y,data:{...v,placement:f}}}}},vve=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:n,placement:l}=t,{mainAxis:u=!0,crossAxis:f=!1,limiter:o={fn:B=>{let{x:U,y:q}=B;return{x:U,y:q}}},...v}=Zh(e,t),w={x:r,y:n},P=await SS(t,v),C=Od(Xh(l)),k=rB(C);let L=w[k],$=w[C];if(u){const B=k==="y"?"top":"left",U=k==="y"?"bottom":"right",q=L+P[B],H=L-P[U];L=sN(q,L,H)}if(f){const B=C==="y"?"top":"left",U=C==="y"?"bottom":"right",q=$+P[B],H=$-P[U];$=sN(q,$,H)}const j=o.fn({...t,[k]:L,[C]:$});return{...j,data:{x:j.x-r,y:j.y-n,enabled:{[k]:u,[C]:f}}}}}},xve=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:n,placement:l,rects:u,middlewareData:f}=t,{offset:o=0,mainAxis:v=!0,crossAxis:w=!0}=Zh(e,t),P={x:r,y:n},C=Od(l),k=rB(C);let L=P[k],$=P[C];const j=Zh(o,t),B=typeof j=="number"?{mainAxis:j,crossAxis:0}:{mainAxis:0,crossAxis:0,...j};if(v){const H=k==="y"?"height":"width",te=u.reference[k]-u.floating[H]+B.mainAxis,Q=u.reference[k]+u.reference[H]-B.mainAxis;L<te?L=te:L>Q&&(L=Q)}if(w){var U,q;const H=k==="y"?"width":"height",te=XJ.has(Xh(l)),Q=u.reference[C]-u.floating[H]+(te&&((U=f.offset)==null?void 0:U[C])||0)+(te?0:B.crossAxis),ae=u.reference[C]+u.reference[H]+(te?0:((q=f.offset)==null?void 0:q[C])||0)-(te?B.crossAxis:0);$<Q?$=Q:$>ae&&($=ae)}return{[k]:L,[C]:$}}}},bve=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,n;const{placement:l,rects:u,platform:f,elements:o}=t,{apply:v=()=>{},...w}=Zh(e,t),P=await SS(t,w),C=Xh(l),k=px(l),L=Od(l)==="y",{width:$,height:j}=u.floating;let B,U;C==="top"||C==="bottom"?(B=C,U=k===(await(f.isRTL==null?void 0:f.isRTL(o.floating))?"start":"end")?"left":"right"):(U=C,B=k==="end"?"top":"bottom");const q=j-P.top-P.bottom,H=$-P.left-P.right,te=Wp(j-P[B],q),Q=Wp($-P[U],H),ae=!t.middlewareData.shift;let ue=te,me=Q;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(me=H),(n=t.middlewareData.shift)!=null&&n.enabled.y&&(ue=q),ae&&!k){const Fe=ic(P.left,0),Ge=ic(P.right,0),Ve=ic(P.top,0),Ze=ic(P.bottom,0);L?me=$-2*(Fe!==0||Ge!==0?Fe+Ge:ic(P.left,P.right)):ue=j-2*(Ve!==0||Ze!==0?Ve+Ze:ic(P.top,P.bottom))}await v({...t,availableWidth:me,availableHeight:ue});const Ce=await f.getDimensions(o.floating);return $!==Ce.width||j!==Ce.height?{reset:{rects:!0}}:{}}}};function PO(){return typeof window<"u"}function mx(e){return KJ(e)?(e.nodeName||"").toLowerCase():"#document"}function uc(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function Wd(e){var t;return(t=(KJ(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function KJ(e){return PO()?e instanceof Node||e instanceof uc(e).Node:!1}function Hu(e){return PO()?e instanceof Element||e instanceof uc(e).Element:!1}function Gd(e){return PO()?e instanceof HTMLElement||e instanceof uc(e).HTMLElement:!1}function zG(e){return!PO()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof uc(e).ShadowRoot}const wve=new Set(["inline","contents"]);function NT(e){const{overflow:t,overflowX:r,overflowY:n,display:l}=Wu(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!wve.has(l)}const Sve=new Set(["table","td","th"]);function Tve(e){return Sve.has(mx(e))}const Eve=[":popover-open",":modal"];function CO(e){return Eve.some(t=>{try{return e.matches(t)}catch{return!1}})}const Ave=["transform","translate","scale","rotate","perspective"],Pve=["transform","translate","scale","rotate","perspective","filter"],Cve=["paint","layout","strict","content"];function oB(e){const t=sB(),r=Hu(e)?Wu(e):e;return Ave.some(n=>r[n]?r[n]!=="none":!1)||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||Pve.some(n=>(r.willChange||"").includes(n))||Cve.some(n=>(r.contain||"").includes(n))}function Ive(e){let t=Zp(e);for(;Gd(t)&&!E0(t);){if(oB(t))return t;if(CO(t))return null;t=Zp(t)}return null}function sB(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Ove=new Set(["html","body","#document"]);function E0(e){return Ove.has(mx(e))}function Wu(e){return uc(e).getComputedStyle(e)}function IO(e){return Hu(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Zp(e){if(mx(e)==="html")return e;const t=e.assignedSlot||e.parentNode||zG(e)&&e.host||Wd(e);return zG(t)?t.host:t}function YJ(e){const t=Zp(e);return E0(t)?e.ownerDocument?e.ownerDocument.body:e.body:Gd(t)&&NT(t)?t:YJ(t)}function TS(e,t,r){var n;t===void 0&&(t=[]),r===void 0&&(r=!0);const l=YJ(e),u=l===((n=e.ownerDocument)==null?void 0:n.body),f=uc(l);if(u){const o=lN(f);return t.concat(f,f.visualViewport||[],NT(l)?l:[],o&&r?TS(o):[])}return t.concat(l,TS(l,[],r))}function lN(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function JJ(e){const t=Wu(e);let r=parseFloat(t.width)||0,n=parseFloat(t.height)||0;const l=Gd(e),u=l?e.offsetWidth:r,f=l?e.offsetHeight:n,o=PC(r)!==u||PC(n)!==f;return o&&(r=u,n=f),{width:r,height:n,$:o}}function aB(e){return Hu(e)?e:e.contextElement}function Kv(e){const t=aB(e);if(!Gd(t))return Nd(1);const r=t.getBoundingClientRect(),{width:n,height:l,$:u}=JJ(t);let f=(u?PC(r.width):r.width)/n,o=(u?PC(r.height):r.height)/l;return(!f||!Number.isFinite(f))&&(f=1),(!o||!Number.isFinite(o))&&(o=1),{x:f,y:o}}const kve=Nd(0);function QJ(e){const t=uc(e);return!sB()||!t.visualViewport?kve:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Rve(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==uc(e)?!1:t}function ny(e,t,r,n){t===void 0&&(t=!1),r===void 0&&(r=!1);const l=e.getBoundingClientRect(),u=aB(e);let f=Nd(1);t&&(n?Hu(n)&&(f=Kv(n)):f=Kv(e));const o=Rve(u,r,n)?QJ(u):Nd(0);let v=(l.left+o.x)/f.x,w=(l.top+o.y)/f.y,P=l.width/f.x,C=l.height/f.y;if(u){const k=uc(u),L=n&&Hu(n)?uc(n):n;let $=k,j=lN($);for(;j&&n&&L!==$;){const B=Kv(j),U=j.getBoundingClientRect(),q=Wu(j),H=U.left+(j.clientLeft+parseFloat(q.paddingLeft))*B.x,te=U.top+(j.clientTop+parseFloat(q.paddingTop))*B.y;v*=B.x,w*=B.y,P*=B.x,C*=B.y,v+=H,w+=te,$=uc(j),j=lN($)}}return IC({width:P,height:C,x:v,y:w})}function lB(e,t){const r=IO(e).scrollLeft;return t?t.left+r:ny(Wd(e)).left+r}function eQ(e,t,r){r===void 0&&(r=!1);const n=e.getBoundingClientRect(),l=n.left+t.scrollLeft-(r?0:lB(e,n)),u=n.top+t.scrollTop;return{x:l,y:u}}function Mve(e){let{elements:t,rect:r,offsetParent:n,strategy:l}=e;const u=l==="fixed",f=Wd(n),o=t?CO(t.floating):!1;if(n===f||o&&u)return r;let v={scrollLeft:0,scrollTop:0},w=Nd(1);const P=Nd(0),C=Gd(n);if((C||!C&&!u)&&((mx(n)!=="body"||NT(f))&&(v=IO(n)),Gd(n))){const L=ny(n);w=Kv(n),P.x=L.x+n.clientLeft,P.y=L.y+n.clientTop}const k=f&&!C&&!u?eQ(f,v,!0):Nd(0);return{width:r.width*w.x,height:r.height*w.y,x:r.x*w.x-v.scrollLeft*w.x+P.x+k.x,y:r.y*w.y-v.scrollTop*w.y+P.y+k.y}}function Dve(e){return Array.from(e.getClientRects())}function Lve(e){const t=Wd(e),r=IO(e),n=e.ownerDocument.body,l=ic(t.scrollWidth,t.clientWidth,n.scrollWidth,n.clientWidth),u=ic(t.scrollHeight,t.clientHeight,n.scrollHeight,n.clientHeight);let f=-r.scrollLeft+lB(e);const o=-r.scrollTop;return Wu(n).direction==="rtl"&&(f+=ic(t.clientWidth,n.clientWidth)-l),{width:l,height:u,x:f,y:o}}function jve(e,t){const r=uc(e),n=Wd(e),l=r.visualViewport;let u=n.clientWidth,f=n.clientHeight,o=0,v=0;if(l){u=l.width,f=l.height;const w=sB();(!w||w&&t==="fixed")&&(o=l.offsetLeft,v=l.offsetTop)}return{width:u,height:f,x:o,y:v}}const Nve=new Set(["absolute","fixed"]);function zve(e,t){const r=ny(e,!0,t==="fixed"),n=r.top+e.clientTop,l=r.left+e.clientLeft,u=Gd(e)?Kv(e):Nd(1),f=e.clientWidth*u.x,o=e.clientHeight*u.y,v=l*u.x,w=n*u.y;return{width:f,height:o,x:v,y:w}}function FG(e,t,r){let n;if(t==="viewport")n=jve(e,r);else if(t==="document")n=Lve(Wd(e));else if(Hu(t))n=zve(t,r);else{const l=QJ(e);n={x:t.x-l.x,y:t.y-l.y,width:t.width,height:t.height}}return IC(n)}function tQ(e,t){const r=Zp(e);return r===t||!Hu(r)||E0(r)?!1:Wu(r).position==="fixed"||tQ(r,t)}function Fve(e,t){const r=t.get(e);if(r)return r;let n=TS(e,[],!1).filter(o=>Hu(o)&&mx(o)!=="body"),l=null;const u=Wu(e).position==="fixed";let f=u?Zp(e):e;for(;Hu(f)&&!E0(f);){const o=Wu(f),v=oB(f);!v&&o.position==="fixed"&&(l=null),(u?!v&&!l:!v&&o.position==="static"&&!!l&&Nve.has(l.position)||NT(f)&&!v&&tQ(e,f))?n=n.filter(P=>P!==f):l=o,f=Zp(f)}return t.set(e,n),n}function Bve(e){let{element:t,boundary:r,rootBoundary:n,strategy:l}=e;const f=[...r==="clippingAncestors"?CO(t)?[]:Fve(t,this._c):[].concat(r),n],o=f[0],v=f.reduce((w,P)=>{const C=FG(t,P,l);return w.top=ic(C.top,w.top),w.right=Wp(C.right,w.right),w.bottom=Wp(C.bottom,w.bottom),w.left=ic(C.left,w.left),w},FG(t,o,l));return{width:v.right-v.left,height:v.bottom-v.top,x:v.left,y:v.top}}function $ve(e){const{width:t,height:r}=JJ(e);return{width:t,height:r}}function Vve(e,t,r){const n=Gd(t),l=Wd(t),u=r==="fixed",f=ny(e,!0,u,t);let o={scrollLeft:0,scrollTop:0};const v=Nd(0);function w(){v.x=lB(l)}if(n||!n&&!u)if((mx(t)!=="body"||NT(l))&&(o=IO(t)),n){const L=ny(t,!0,u,t);v.x=L.x+t.clientLeft,v.y=L.y+t.clientTop}else l&&w();u&&!n&&l&&w();const P=l&&!n&&!u?eQ(l,o):Nd(0),C=f.left+o.scrollLeft-v.x-P.x,k=f.top+o.scrollTop-v.y-P.y;return{x:C,y:k,width:f.width,height:f.height}}function GD(e){return Wu(e).position==="static"}function BG(e,t){if(!Gd(e)||Wu(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return Wd(e)===r&&(r=r.ownerDocument.body),r}function rQ(e,t){const r=uc(e);if(CO(e))return r;if(!Gd(e)){let l=Zp(e);for(;l&&!E0(l);){if(Hu(l)&&!GD(l))return l;l=Zp(l)}return r}let n=BG(e,t);for(;n&&Tve(n)&&GD(n);)n=BG(n,t);return n&&E0(n)&&GD(n)&&!oB(n)?r:n||Ive(e)||r}const Uve=async function(e){const t=this.getOffsetParent||rQ,r=this.getDimensions,n=await r(e.floating);return{reference:Vve(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Gve(e){return Wu(e).direction==="rtl"}const qve={convertOffsetParentRelativeRectToViewportRelativeRect:Mve,getDocumentElement:Wd,getClippingRect:Bve,getOffsetParent:rQ,getElementRects:Uve,getClientRects:Dve,getDimensions:$ve,getScale:Kv,isElement:Hu,isRTL:Gve};function nQ(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}function Hve(e,t){let r=null,n;const l=Wd(e);function u(){var o;clearTimeout(n),(o=r)==null||o.disconnect(),r=null}function f(o,v){o===void 0&&(o=!1),v===void 0&&(v=1),u();const w=e.getBoundingClientRect(),{left:P,top:C,width:k,height:L}=w;if(o||t(),!k||!L)return;const $=tP(C),j=tP(l.clientWidth-(P+k)),B=tP(l.clientHeight-(C+L)),U=tP(P),H={rootMargin:-$+"px "+-j+"px "+-B+"px "+-U+"px",threshold:ic(0,Wp(1,v))||1};let te=!0;function Q(ae){const ue=ae[0].intersectionRatio;if(ue!==v){if(!te)return f();ue?f(!1,ue):n=setTimeout(()=>{f(!1,1e-7)},1e3)}ue===1&&!nQ(w,e.getBoundingClientRect())&&f(),te=!1}try{r=new IntersectionObserver(Q,{...H,root:l.ownerDocument})}catch{r=new IntersectionObserver(Q,H)}r.observe(e)}return f(!0),u}function Wve(e,t,r,n){n===void 0&&(n={});const{ancestorScroll:l=!0,ancestorResize:u=!0,elementResize:f=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:v=!1}=n,w=aB(e),P=l||u?[...w?TS(w):[],...TS(t)]:[];P.forEach(U=>{l&&U.addEventListener("scroll",r,{passive:!0}),u&&U.addEventListener("resize",r)});const C=w&&o?Hve(w,r):null;let k=-1,L=null;f&&(L=new ResizeObserver(U=>{let[q]=U;q&&q.target===w&&L&&(L.unobserve(t),cancelAnimationFrame(k),k=requestAnimationFrame(()=>{var H;(H=L)==null||H.observe(t)})),r()}),w&&!v&&L.observe(w),L.observe(t));let $,j=v?ny(e):null;v&&B();function B(){const U=ny(e);j&&!nQ(j,U)&&r(),j=U,$=requestAnimationFrame(B)}return r(),()=>{var U;P.forEach(q=>{l&&q.removeEventListener("scroll",r),u&&q.removeEventListener("resize",r)}),C==null||C(),(U=L)==null||U.disconnect(),L=null,v&&cancelAnimationFrame($)}}const Zve=_ve,Xve=vve,Kve=mve,Yve=bve,Jve=gve,$G=pve,Qve=xve,e0e=(e,t,r)=>{const n=new Map,l={platform:qve,...r},u={...l.platform,_c:n};return fve(e,t,{...l,platform:u})};var t0e=typeof document<"u",r0e=function(){},GP=t0e?X.useLayoutEffect:r0e;function OC(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,n,l;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(n=r;n--!==0;)if(!OC(e[n],t[n]))return!1;return!0}if(l=Object.keys(e),r=l.length,r!==Object.keys(t).length)return!1;for(n=r;n--!==0;)if(!{}.hasOwnProperty.call(t,l[n]))return!1;for(n=r;n--!==0;){const u=l[n];if(!(u==="_owner"&&e.$$typeof)&&!OC(e[u],t[u]))return!1}return!0}return e!==e&&t!==t}function iQ(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function VG(e,t){const r=iQ(e);return Math.round(t*r)/r}function qD(e){const t=X.useRef(e);return GP(()=>{t.current=e}),t}function n0e(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:l,elements:{reference:u,floating:f}={},transform:o=!0,whileElementsMounted:v,open:w}=e,[P,C]=X.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[k,L]=X.useState(n);OC(k,n)||L(n);const[$,j]=X.useState(null),[B,U]=X.useState(null),q=X.useCallback(qe=>{qe!==ae.current&&(ae.current=qe,j(qe))},[]),H=X.useCallback(qe=>{qe!==ue.current&&(ue.current=qe,U(qe))},[]),te=u||$,Q=f||B,ae=X.useRef(null),ue=X.useRef(null),me=X.useRef(P),Ce=v!=null,Fe=qD(v),Ge=qD(l),Ve=qD(w),Ze=X.useCallback(()=>{if(!ae.current||!ue.current)return;const qe={placement:t,strategy:r,middleware:k};Ge.current&&(qe.platform=Ge.current),e0e(ae.current,ue.current,qe).then(He=>{const Et={...He,isPositioned:Ve.current!==!1};nt.current&&!OC(me.current,Et)&&(me.current=Et,xy.flushSync(()=>{C(Et)}))})},[k,t,r,Ge,Ve]);GP(()=>{w===!1&&me.current.isPositioned&&(me.current.isPositioned=!1,C(qe=>({...qe,isPositioned:!1})))},[w]);const nt=X.useRef(!1);GP(()=>(nt.current=!0,()=>{nt.current=!1}),[]),GP(()=>{if(te&&(ae.current=te),Q&&(ue.current=Q),te&&Q){if(Fe.current)return Fe.current(te,Q,Ze);Ze()}},[te,Q,Ze,Fe,Ce]);const dt=X.useMemo(()=>({reference:ae,floating:ue,setReference:q,setFloating:H}),[q,H]),rt=X.useMemo(()=>({reference:te,floating:Q}),[te,Q]),at=X.useMemo(()=>{const qe={position:r,left:0,top:0};if(!rt.floating)return qe;const He=VG(rt.floating,P.x),Et=VG(rt.floating,P.y);return o?{...qe,transform:"translate("+He+"px, "+Et+"px)",...iQ(rt.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:He,top:Et}},[r,o,rt.floating,P.x,P.y]);return X.useMemo(()=>({...P,update:Ze,refs:dt,elements:rt,floatingStyles:at}),[P,Ze,dt,rt,at])}const i0e=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:n,padding:l}=typeof e=="function"?e(r):e;return n&&t(n)?n.current!=null?$G({element:n.current,padding:l}).fn(r):{}:n?$G({element:n,padding:l}).fn(r):{}}}},o0e=(e,t)=>({...Zve(e),options:[e,t]}),s0e=(e,t)=>({...Xve(e),options:[e,t]}),a0e=(e,t)=>({...Qve(e),options:[e,t]}),l0e=(e,t)=>({...Kve(e),options:[e,t]}),c0e=(e,t)=>({...Yve(e),options:[e,t]}),u0e=(e,t)=>({...Jve(e),options:[e,t]}),d0e=(e,t)=>({...i0e(e),options:[e,t]});var h0e="Arrow",oQ=X.forwardRef((e,t)=>{const{children:r,width:n=10,height:l=5,...u}=e;return A.jsx(nn.svg,{...u,ref:t,width:n,height:l,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:A.jsx("polygon",{points:"0,0 30,0 15,10"})})});oQ.displayName=h0e;var f0e=oQ;function sQ(e){const[t,r]=X.useState(void 0);return fs(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const n=new ResizeObserver(l=>{if(!Array.isArray(l)||!l.length)return;const u=l[0];let f,o;if("borderBoxSize"in u){const v=u.borderBoxSize,w=Array.isArray(v)?v[0]:v;f=w.inlineSize,o=w.blockSize}else f=e.offsetWidth,o=e.offsetHeight;r({width:f,height:o})});return n.observe(e,{box:"border-box"}),()=>n.unobserve(e)}else r(void 0)},[e]),t}var cB="Popper",[aQ,gx]=$l(cB),[p0e,lQ]=aQ(cB),cQ=e=>{const{__scopePopper:t,children:r}=e,[n,l]=X.useState(null);return A.jsx(p0e,{scope:t,anchor:n,onAnchorChange:l,children:r})};cQ.displayName=cB;var uQ="PopperAnchor",dQ=X.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:n,...l}=e,u=lQ(uQ,r),f=X.useRef(null),o=qn(t,f);return X.useEffect(()=>{u.onAnchorChange((n==null?void 0:n.current)||f.current)}),n?null:A.jsx(nn.div,{...l,ref:o})});dQ.displayName=uQ;var uB="PopperContent",[m0e,g0e]=aQ(uB),hQ=X.forwardRef((e,t)=>{var rr,Wr,Rt,Yt,ir,jt;const{__scopePopper:r,side:n="bottom",sideOffset:l=0,align:u="center",alignOffset:f=0,arrowPadding:o=0,avoidCollisions:v=!0,collisionBoundary:w=[],collisionPadding:P=0,sticky:C="partial",hideWhenDetached:k=!1,updatePositionStrategy:L="optimized",onPlaced:$,...j}=e,B=lQ(uB,r),[U,q]=X.useState(null),H=qn(t,Ir=>q(Ir)),[te,Q]=X.useState(null),ae=sQ(te),ue=(ae==null?void 0:ae.width)??0,me=(ae==null?void 0:ae.height)??0,Ce=n+(u!=="center"?"-"+u:""),Fe=typeof P=="number"?P:{top:0,right:0,bottom:0,left:0,...P},Ge=Array.isArray(w)?w:[w],Ve=Ge.length>0,Ze={padding:Fe,boundary:Ge.filter(_0e),altBoundary:Ve},{refs:nt,floatingStyles:dt,placement:rt,isPositioned:at,middlewareData:qe}=n0e({strategy:"fixed",placement:Ce,whileElementsMounted:(...Ir)=>Wve(...Ir,{animationFrame:L==="always"}),elements:{reference:B.anchor},middleware:[o0e({mainAxis:l+me,alignmentAxis:f}),v&&s0e({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?a0e():void 0,...Ze}),v&&l0e({...Ze}),c0e({...Ze,apply:({elements:Ir,rects:Xr,availableWidth:Vn,availableHeight:Hn})=>{const{width:ei,height:Nn}=Xr.reference,ho=Ir.floating.style;ho.setProperty("--radix-popper-available-width",`${Vn}px`),ho.setProperty("--radix-popper-available-height",`${Hn}px`),ho.setProperty("--radix-popper-anchor-width",`${ei}px`),ho.setProperty("--radix-popper-anchor-height",`${Nn}px`)}}),te&&d0e({element:te,padding:o}),v0e({arrowWidth:ue,arrowHeight:me}),k&&u0e({strategy:"referenceHidden",...Ze})]}),[He,Et]=mQ(rt),Gt=ss($);fs(()=>{at&&(Gt==null||Gt())},[at,Gt]);const Ot=(rr=qe.arrow)==null?void 0:rr.x,$t=(Wr=qe.arrow)==null?void 0:Wr.y,ur=((Rt=qe.arrow)==null?void 0:Rt.centerOffset)!==0,[Yr,hn]=X.useState();return fs(()=>{U&&hn(window.getComputedStyle(U).zIndex)},[U]),A.jsx("div",{ref:nt.setFloating,"data-radix-popper-content-wrapper":"",style:{...dt,transform:at?dt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Yr,"--radix-popper-transform-origin":[(Yt=qe.transformOrigin)==null?void 0:Yt.x,(ir=qe.transformOrigin)==null?void 0:ir.y].join(" "),...((jt=qe.hide)==null?void 0:jt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:A.jsx(m0e,{scope:r,placedSide:He,onArrowChange:Q,arrowX:Ot,arrowY:$t,shouldHideArrow:ur,children:A.jsx(nn.div,{"data-side":He,"data-align":Et,...j,ref:H,style:{...j.style,animation:at?void 0:"none"}})})})});hQ.displayName=uB;var fQ="PopperArrow",y0e={top:"bottom",right:"left",bottom:"top",left:"right"},pQ=X.forwardRef(function(t,r){const{__scopePopper:n,...l}=t,u=g0e(fQ,n),f=y0e[u.placedSide];return A.jsx("span",{ref:u.onArrowChange,style:{position:"absolute",left:u.arrowX,top:u.arrowY,[f]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[u.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[u.placedSide],visibility:u.shouldHideArrow?"hidden":void 0},children:A.jsx(f0e,{...l,ref:r,style:{...l.style,display:"block"}})})});pQ.displayName=fQ;function _0e(e){return e!==null}var v0e=e=>({name:"transformOrigin",options:e,fn(t){var B,U,q;const{placement:r,rects:n,middlewareData:l}=t,f=((B=l.arrow)==null?void 0:B.centerOffset)!==0,o=f?0:e.arrowWidth,v=f?0:e.arrowHeight,[w,P]=mQ(r),C={start:"0%",center:"50%",end:"100%"}[P],k=(((U=l.arrow)==null?void 0:U.x)??0)+o/2,L=(((q=l.arrow)==null?void 0:q.y)??0)+v/2;let $="",j="";return w==="bottom"?($=f?C:`${k}px`,j=`${-v}px`):w==="top"?($=f?C:`${k}px`,j=`${n.floating.height+v}px`):w==="right"?($=`${-v}px`,j=f?C:`${L}px`):w==="left"&&($=`${n.floating.width+v}px`,j=f?C:`${L}px`),{data:{x:$,y:j}}}});function mQ(e){const[t,r="center"]=e.split("-");return[t,r]}var gQ=cQ,dB=dQ,hB=hQ,fB=pQ,[OO,XQe]=$l("Tooltip",[gx]),pB=gx(),yQ="TooltipProvider",x0e=700,UG="tooltip.open",[b0e,_Q]=OO(yQ),vQ=e=>{const{__scopeTooltip:t,delayDuration:r=x0e,skipDelayDuration:n=300,disableHoverableContent:l=!1,children:u}=e,f=X.useRef(!0),o=X.useRef(!1),v=X.useRef(0);return X.useEffect(()=>{const w=v.current;return()=>window.clearTimeout(w)},[]),A.jsx(b0e,{scope:t,isOpenDelayedRef:f,delayDuration:r,onOpen:X.useCallback(()=>{window.clearTimeout(v.current),f.current=!1},[]),onClose:X.useCallback(()=>{window.clearTimeout(v.current),v.current=window.setTimeout(()=>f.current=!0,n)},[n]),isPointerInTransitRef:o,onPointerInTransitChange:X.useCallback(w=>{o.current=w},[]),disableHoverableContent:l,children:u})};vQ.displayName=yQ;var xQ="Tooltip",[KQe,kO]=OO(xQ),cN="TooltipTrigger",w0e=X.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,l=kO(cN,r),u=_Q(cN,r),f=pB(r),o=X.useRef(null),v=qn(t,o,l.onTriggerChange),w=X.useRef(!1),P=X.useRef(!1),C=X.useCallback(()=>w.current=!1,[]);return X.useEffect(()=>()=>document.removeEventListener("pointerup",C),[C]),A.jsx(dB,{asChild:!0,...f,children:A.jsx(nn.button,{"aria-describedby":l.open?l.contentId:void 0,"data-state":l.stateAttribute,...n,ref:v,onPointerMove:_r(e.onPointerMove,k=>{k.pointerType!=="touch"&&!P.current&&!u.isPointerInTransitRef.current&&(l.onTriggerEnter(),P.current=!0)}),onPointerLeave:_r(e.onPointerLeave,()=>{l.onTriggerLeave(),P.current=!1}),onPointerDown:_r(e.onPointerDown,()=>{l.open&&l.onClose(),w.current=!0,document.addEventListener("pointerup",C,{once:!0})}),onFocus:_r(e.onFocus,()=>{w.current||l.onOpen()}),onBlur:_r(e.onBlur,l.onClose),onClick:_r(e.onClick,l.onClose)})})});w0e.displayName=cN;var S0e="TooltipPortal",[YQe,T0e]=OO(S0e,{forceMount:void 0}),A0="TooltipContent",bQ=X.forwardRef((e,t)=>{const r=T0e(A0,e.__scopeTooltip),{forceMount:n=r.forceMount,side:l="top",...u}=e,f=kO(A0,e.__scopeTooltip);return A.jsx(wl,{present:n||f.open,children:f.disableHoverableContent?A.jsx(wQ,{side:l,...u,ref:t}):A.jsx(E0e,{side:l,...u,ref:t})})}),E0e=X.forwardRef((e,t)=>{const r=kO(A0,e.__scopeTooltip),n=_Q(A0,e.__scopeTooltip),l=X.useRef(null),u=qn(t,l),[f,o]=X.useState(null),{trigger:v,onClose:w}=r,P=l.current,{onPointerInTransitChange:C}=n,k=X.useCallback(()=>{o(null),C(!1)},[C]),L=X.useCallback(($,j)=>{const B=$.currentTarget,U={x:$.clientX,y:$.clientY},q=O0e(U,B.getBoundingClientRect()),H=k0e(U,q),te=R0e(j.getBoundingClientRect()),Q=D0e([...H,...te]);o(Q),C(!0)},[C]);return X.useEffect(()=>()=>k(),[k]),X.useEffect(()=>{if(v&&P){const $=B=>L(B,P),j=B=>L(B,v);return v.addEventListener("pointerleave",$),P.addEventListener("pointerleave",j),()=>{v.removeEventListener("pointerleave",$),P.removeEventListener("pointerleave",j)}}},[v,P,L,k]),X.useEffect(()=>{if(f){const $=j=>{const B=j.target,U={x:j.clientX,y:j.clientY},q=(v==null?void 0:v.contains(B))||(P==null?void 0:P.contains(B)),H=!M0e(U,f);q?k():H&&(k(),w())};return document.addEventListener("pointermove",$),()=>document.removeEventListener("pointermove",$)}},[v,P,f,w,k]),A.jsx(wQ,{...e,ref:u})}),[A0e,P0e]=OO(xQ,{isInside:!1}),C0e=oJ("TooltipContent"),wQ=X.forwardRef((e,t)=>{const{__scopeTooltip:r,children:n,"aria-label":l,onEscapeKeyDown:u,onPointerDownOutside:f,...o}=e,v=kO(A0,r),w=pB(r),{onClose:P}=v;return X.useEffect(()=>(document.addEventListener(UG,P),()=>document.removeEventListener(UG,P)),[P]),X.useEffect(()=>{if(v.trigger){const C=k=>{const L=k.target;L!=null&&L.contains(v.trigger)&&P()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[v.trigger,P]),A.jsx(hx,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:u,onPointerDownOutside:f,onFocusOutside:C=>C.preventDefault(),onDismiss:P,children:A.jsxs(hB,{"data-state":v.stateAttribute,...w,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[A.jsx(C0e,{children:n}),A.jsx(A0e,{scope:r,isInside:!0,children:A.jsx(Hge,{id:v.contentId,role:"tooltip",children:l||n})})]})})});bQ.displayName=A0;var SQ="TooltipArrow",I0e=X.forwardRef((e,t)=>{const{__scopeTooltip:r,...n}=e,l=pB(r);return P0e(SQ,r).isInside?null:A.jsx(fB,{...l,...n,ref:t})});I0e.displayName=SQ;function O0e(e,t){const r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),l=Math.abs(t.right-e.x),u=Math.abs(t.left-e.x);switch(Math.min(r,n,l,u)){case u:return"left";case l:return"right";case r:return"top";case n:return"bottom";default:throw new Error("unreachable")}}function k0e(e,t,r=5){const n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return n}function R0e(e){const{top:t,right:r,bottom:n,left:l}=e;return[{x:l,y:t},{x:r,y:t},{x:r,y:n},{x:l,y:n}]}function M0e(e,t){const{x:r,y:n}=e;let l=!1;for(let u=0,f=t.length-1;u<t.length;f=u++){const o=t[u],v=t[f],w=o.x,P=o.y,C=v.x,k=v.y;P>n!=k>n&&r<(C-w)*(n-P)/(k-P)+w&&(l=!l)}return l}function D0e(e){const t=e.slice();return t.sort((r,n)=>r.x<n.x?-1:r.x>n.x?1:r.y<n.y?-1:r.y>n.y?1:0),L0e(t)}function L0e(e){if(e.length<=1)return e.slice();const t=[];for(let n=0;n<e.length;n++){const l=e[n];for(;t.length>=2;){const u=t[t.length-1],f=t[t.length-2];if((u.x-f.x)*(l.y-f.y)>=(u.y-f.y)*(l.x-f.x))t.pop();else break}t.push(l)}t.pop();const r=[];for(let n=e.length-1;n>=0;n--){const l=e[n];for(;r.length>=2;){const u=r[r.length-1],f=r[r.length-2];if((u.x-f.x)*(l.y-f.y)>=(u.y-f.y)*(l.x-f.x))r.pop();else break}r.push(l)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var j0e=vQ,TQ=bQ;const N0e=j0e,z0e=X.forwardRef(({className:e,sideOffset:t=4,...r},n)=>A.jsx(TQ,{ref:n,sideOffset:t,className:sr("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));z0e.displayName=TQ.displayName;var yx=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},iy=typeof window>"u"||"Deno"in globalThis;function hl(){}function F0e(e,t){return typeof e=="function"?e(t):e}function uN(e){return typeof e=="number"&&e>=0&&e!==1/0}function EQ(e,t){return Math.max(e+(t||0)-Date.now(),0)}function zp(e,t){return typeof e=="function"?e(t):e}function Bc(e,t){return typeof e=="function"?e(t):e}function GG(e,t){const{type:r="all",exact:n,fetchStatus:l,predicate:u,queryKey:f,stale:o}=e;if(f){if(n){if(t.queryHash!==mB(f,t.options))return!1}else if(!ES(t.queryKey,f))return!1}if(r!=="all"){const v=t.isActive();if(r==="active"&&!v||r==="inactive"&&v)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||l&&l!==t.state.fetchStatus||u&&!u(t))}function qG(e,t){const{exact:r,status:n,predicate:l,mutationKey:u}=e;if(u){if(!t.options.mutationKey)return!1;if(r){if(oy(t.options.mutationKey)!==oy(u))return!1}else if(!ES(t.options.mutationKey,u))return!1}return!(n&&t.state.status!==n||l&&!l(t))}function mB(e,t){return((t==null?void 0:t.queryKeyHashFn)||oy)(e)}function oy(e){return JSON.stringify(e,(t,r)=>dN(r)?Object.keys(r).sort().reduce((n,l)=>(n[l]=r[l],n),{}):r)}function ES(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(t).every(r=>ES(e[r],t[r])):!1}function AQ(e,t){if(e===t)return e;const r=HG(e)&&HG(t);if(r||dN(e)&&dN(t)){const n=r?e:Object.keys(e),l=n.length,u=r?t:Object.keys(t),f=u.length,o=r?[]:{},v=new Set(n);let w=0;for(let P=0;P<f;P++){const C=r?P:u[P];(!r&&v.has(C)||r)&&e[C]===void 0&&t[C]===void 0?(o[C]=void 0,w++):(o[C]=AQ(e[C],t[C]),o[C]===e[C]&&e[C]!==void 0&&w++)}return l===f&&w===l?e:o}return t}function kC(e,t){if(!t||Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}function HG(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function dN(e){if(!WG(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!WG(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function WG(e){return Object.prototype.toString.call(e)==="[object Object]"}function B0e(e){return new Promise(t=>{setTimeout(t,e)})}function hN(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?AQ(e,t):t}function $0e(e,t,r=0){const n=[...e,t];return r&&n.length>r?n.slice(1):n}function V0e(e,t,r=0){const n=[t,...e];return r&&n.length>r?n.slice(0,-1):n}var gB=Symbol();function PQ(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===gB?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}function CQ(e,t){return typeof e=="function"?e(...t):!!e}var jg,mp,o0,MX,U0e=(MX=class extends yx{constructor(){super();dn(this,jg);dn(this,mp);dn(this,o0);Mr(this,o0,t=>{if(!iy&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){ct(this,mp)||this.setEventListener(ct(this,o0))}onUnsubscribe(){var t;this.hasListeners()||((t=ct(this,mp))==null||t.call(this),Mr(this,mp,void 0))}setEventListener(t){var r;Mr(this,o0,t),(r=ct(this,mp))==null||r.call(this),Mr(this,mp,t(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(t){ct(this,jg)!==t&&(Mr(this,jg,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof ct(this,jg)=="boolean"?ct(this,jg):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},jg=new WeakMap,mp=new WeakMap,o0=new WeakMap,MX),yB=new U0e,s0,gp,a0,DX,G0e=(DX=class extends yx{constructor(){super();dn(this,s0,!0);dn(this,gp);dn(this,a0);Mr(this,a0,t=>{if(!iy&&window.addEventListener){const r=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",n)}}})}onSubscribe(){ct(this,gp)||this.setEventListener(ct(this,a0))}onUnsubscribe(){var t;this.hasListeners()||((t=ct(this,gp))==null||t.call(this),Mr(this,gp,void 0))}setEventListener(t){var r;Mr(this,a0,t),(r=ct(this,gp))==null||r.call(this),Mr(this,gp,t(this.setOnline.bind(this)))}setOnline(t){ct(this,s0)!==t&&(Mr(this,s0,t),this.listeners.forEach(n=>{n(t)}))}isOnline(){return ct(this,s0)}},s0=new WeakMap,gp=new WeakMap,a0=new WeakMap,DX),RC=new G0e;function fN(){let e,t;const r=new Promise((l,u)=>{e=l,t=u});r.status="pending",r.catch(()=>{});function n(l){Object.assign(r,l),delete r.resolve,delete r.reject}return r.resolve=l=>{n({status:"fulfilled",value:l}),e(l)},r.reject=l=>{n({status:"rejected",reason:l}),t(l)},r}function q0e(e){return Math.min(1e3*2**e,3e4)}function IQ(e){return(e??"online")==="online"?RC.isOnline():!0}var OQ=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function HD(e){return e instanceof OQ}function kQ(e){let t=!1,r=0,n=!1,l;const u=fN(),f=j=>{var B;n||(k(new OQ(j)),(B=e.abort)==null||B.call(e))},o=()=>{t=!0},v=()=>{t=!1},w=()=>yB.isFocused()&&(e.networkMode==="always"||RC.isOnline())&&e.canRun(),P=()=>IQ(e.networkMode)&&e.canRun(),C=j=>{var B;n||(n=!0,(B=e.onSuccess)==null||B.call(e,j),l==null||l(),u.resolve(j))},k=j=>{var B;n||(n=!0,(B=e.onError)==null||B.call(e,j),l==null||l(),u.reject(j))},L=()=>new Promise(j=>{var B;l=U=>{(n||w())&&j(U)},(B=e.onPause)==null||B.call(e)}).then(()=>{var j;l=void 0,n||(j=e.onContinue)==null||j.call(e)}),$=()=>{if(n)return;let j;const B=r===0?e.initialPromise:void 0;try{j=B??e.fn()}catch(U){j=Promise.reject(U)}Promise.resolve(j).then(C).catch(U=>{var ae;if(n)return;const q=e.retry??(iy?0:3),H=e.retryDelay??q0e,te=typeof H=="function"?H(r,U):H,Q=q===!0||typeof q=="number"&&r<q||typeof q=="function"&&q(r,U);if(t||!Q){k(U);return}r++,(ae=e.onFail)==null||ae.call(e,r,U),B0e(te).then(()=>w()?void 0:L()).then(()=>{t?k(U):$()})})};return{promise:u,cancel:f,continue:()=>(l==null||l(),u),cancelRetry:o,continueRetry:v,canStart:P,start:()=>(P()?$():L().then($),u)}}var H0e=e=>setTimeout(e,0);function W0e(){let e=[],t=0,r=o=>{o()},n=o=>{o()},l=H0e;const u=o=>{t?e.push(o):l(()=>{r(o)})},f=()=>{const o=e;e=[],o.length&&l(()=>{n(()=>{o.forEach(v=>{r(v)})})})};return{batch:o=>{let v;t++;try{v=o()}finally{t--,t||f()}return v},batchCalls:o=>(...v)=>{u(()=>{o(...v)})},schedule:u,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{n=o},setScheduler:o=>{l=o}}}var $s=W0e(),Ng,LX,RQ=(LX=class{constructor(){dn(this,Ng)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),uN(this.gcTime)&&Mr(this,Ng,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(iy?1/0:5*60*1e3))}clearGcTimeout(){ct(this,Ng)&&(clearTimeout(ct(this,Ng)),Mr(this,Ng,void 0))}},Ng=new WeakMap,LX),l0,zg,Nc,Fg,za,ET,Bg,Ou,Sh,jX,Z0e=(jX=class extends RQ{constructor(t){super();dn(this,Ou);dn(this,l0);dn(this,zg);dn(this,Nc);dn(this,Fg);dn(this,za);dn(this,ET);dn(this,Bg);Mr(this,Bg,!1),Mr(this,ET,t.defaultOptions),this.setOptions(t.options),this.observers=[],Mr(this,Fg,t.client),Mr(this,Nc,ct(this,Fg).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Mr(this,l0,X0e(this.options)),this.state=t.state??ct(this,l0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=ct(this,za))==null?void 0:t.promise}setOptions(t){this.options={...ct(this,ET),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&ct(this,Nc).remove(this)}setData(t,r){const n=hN(this.state.data,t,this.options);return Xn(this,Ou,Sh).call(this,{data:n,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),n}setState(t,r){Xn(this,Ou,Sh).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var n,l;const r=(n=ct(this,za))==null?void 0:n.promise;return(l=ct(this,za))==null||l.cancel(t),r?r.then(hl).catch(hl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(ct(this,l0))}isActive(){return this.observers.some(t=>Bc(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===gB||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>zp(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!EQ(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(n=>n.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=ct(this,za))==null||r.continue()}onOnline(){var r;const t=this.observers.find(n=>n.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=ct(this,za))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),ct(this,Nc).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(ct(this,za)&&(ct(this,Bg)?ct(this,za).cancel({revert:!0}):ct(this,za).cancelRetry()),this.scheduleGc()),ct(this,Nc).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Xn(this,Ou,Sh).call(this,{type:"invalidate"})}fetch(t,r){var w,P,C;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(ct(this,za))return ct(this,za).continueRetry(),ct(this,za).promise}if(t&&this.setOptions(t),!this.options.queryFn){const k=this.observers.find(L=>L.options.queryFn);k&&this.setOptions(k.options)}const n=new AbortController,l=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(Mr(this,Bg,!0),n.signal)})},u=()=>{const k=PQ(this.options,r),$=(()=>{const j={client:ct(this,Fg),queryKey:this.queryKey,meta:this.meta};return l(j),j})();return Mr(this,Bg,!1),this.options.persister?this.options.persister(k,$,this):k($)},o=(()=>{const k={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:ct(this,Fg),state:this.state,fetchFn:u};return l(k),k})();(w=this.options.behavior)==null||w.onFetch(o,this),Mr(this,zg,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((P=o.fetchOptions)==null?void 0:P.meta))&&Xn(this,Ou,Sh).call(this,{type:"fetch",meta:(C=o.fetchOptions)==null?void 0:C.meta});const v=k=>{var L,$,j,B;HD(k)&&k.silent||Xn(this,Ou,Sh).call(this,{type:"error",error:k}),HD(k)||(($=(L=ct(this,Nc).config).onError)==null||$.call(L,k,this),(B=(j=ct(this,Nc).config).onSettled)==null||B.call(j,this.state.data,k,this)),this.scheduleGc()};return Mr(this,za,kQ({initialPromise:r==null?void 0:r.initialPromise,fn:o.fetchFn,abort:n.abort.bind(n),onSuccess:k=>{var L,$,j,B;if(k===void 0){v(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(k)}catch(U){v(U);return}($=(L=ct(this,Nc).config).onSuccess)==null||$.call(L,k,this),(B=(j=ct(this,Nc).config).onSettled)==null||B.call(j,k,this.state.error,this),this.scheduleGc()},onError:v,onFail:(k,L)=>{Xn(this,Ou,Sh).call(this,{type:"failed",failureCount:k,error:L})},onPause:()=>{Xn(this,Ou,Sh).call(this,{type:"pause"})},onContinue:()=>{Xn(this,Ou,Sh).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),ct(this,za).start()}},l0=new WeakMap,zg=new WeakMap,Nc=new WeakMap,Fg=new WeakMap,za=new WeakMap,ET=new WeakMap,Bg=new WeakMap,Ou=new WeakSet,Sh=function(t){const r=n=>{switch(t.type){case"failed":return{...n,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...MQ(n.data,this.options),fetchMeta:t.meta??null};case"success":return Mr(this,zg,void 0),{...n,data:t.data,dataUpdateCount:n.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const l=t.error;return HD(l)&&l.revert&&ct(this,zg)?{...ct(this,zg),fetchStatus:"idle"}:{...n,error:l,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...t.state}}};this.state=r(this.state),$s.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),ct(this,Nc).notify({query:this,type:"updated",action:t})})},jX);function MQ(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:IQ(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function X0e(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,n=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var Ed,NX,K0e=(NX=class extends yx{constructor(t={}){super();dn(this,Ed);this.config=t,Mr(this,Ed,new Map)}build(t,r,n){const l=r.queryKey,u=r.queryHash??mB(l,r);let f=this.get(u);return f||(f=new Z0e({client:t,queryKey:l,queryHash:u,options:t.defaultQueryOptions(r),state:n,defaultOptions:t.getQueryDefaults(l)}),this.add(f)),f}add(t){ct(this,Ed).has(t.queryHash)||(ct(this,Ed).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=ct(this,Ed).get(t.queryHash);r&&(t.destroy(),r===t&&ct(this,Ed).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){$s.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return ct(this,Ed).get(t)}getAll(){return[...ct(this,Ed).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(n=>GG(r,n))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(n=>GG(t,n)):r}notify(t){$s.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){$s.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){$s.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Ed=new WeakMap,NX),Ad,cl,$g,Pd,rp,zX,Y0e=(zX=class extends RQ{constructor(t){super();dn(this,Pd);dn(this,Ad);dn(this,cl);dn(this,$g);this.mutationId=t.mutationId,Mr(this,cl,t.mutationCache),Mr(this,Ad,[]),this.state=t.state||DQ(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){ct(this,Ad).includes(t)||(ct(this,Ad).push(t),this.clearGcTimeout(),ct(this,cl).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Mr(this,Ad,ct(this,Ad).filter(r=>r!==t)),this.scheduleGc(),ct(this,cl).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){ct(this,Ad).length||(this.state.status==="pending"?this.scheduleGc():ct(this,cl).remove(this))}continue(){var t;return((t=ct(this,$g))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var u,f,o,v,w,P,C,k,L,$,j,B,U,q,H,te,Q,ae,ue,me;const r=()=>{Xn(this,Pd,rp).call(this,{type:"continue"})};Mr(this,$g,kQ({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(Ce,Fe)=>{Xn(this,Pd,rp).call(this,{type:"failed",failureCount:Ce,error:Fe})},onPause:()=>{Xn(this,Pd,rp).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>ct(this,cl).canRun(this)}));const n=this.state.status==="pending",l=!ct(this,$g).canStart();try{if(n)r();else{Xn(this,Pd,rp).call(this,{type:"pending",variables:t,isPaused:l}),await((f=(u=ct(this,cl).config).onMutate)==null?void 0:f.call(u,t,this));const Fe=await((v=(o=this.options).onMutate)==null?void 0:v.call(o,t));Fe!==this.state.context&&Xn(this,Pd,rp).call(this,{type:"pending",context:Fe,variables:t,isPaused:l})}const Ce=await ct(this,$g).start();return await((P=(w=ct(this,cl).config).onSuccess)==null?void 0:P.call(w,Ce,t,this.state.context,this)),await((k=(C=this.options).onSuccess)==null?void 0:k.call(C,Ce,t,this.state.context)),await(($=(L=ct(this,cl).config).onSettled)==null?void 0:$.call(L,Ce,null,this.state.variables,this.state.context,this)),await((B=(j=this.options).onSettled)==null?void 0:B.call(j,Ce,null,t,this.state.context)),Xn(this,Pd,rp).call(this,{type:"success",data:Ce}),Ce}catch(Ce){try{throw await((q=(U=ct(this,cl).config).onError)==null?void 0:q.call(U,Ce,t,this.state.context,this)),await((te=(H=this.options).onError)==null?void 0:te.call(H,Ce,t,this.state.context)),await((ae=(Q=ct(this,cl).config).onSettled)==null?void 0:ae.call(Q,void 0,Ce,this.state.variables,this.state.context,this)),await((me=(ue=this.options).onSettled)==null?void 0:me.call(ue,void 0,Ce,t,this.state.context)),Ce}finally{Xn(this,Pd,rp).call(this,{type:"error",error:Ce})}}finally{ct(this,cl).runNext(this)}}},Ad=new WeakMap,cl=new WeakMap,$g=new WeakMap,Pd=new WeakSet,rp=function(t){const r=n=>{switch(t.type){case"failed":return{...n,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...n,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:t.error,failureCount:n.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),$s.batch(()=>{ct(this,Ad).forEach(n=>{n.onMutationUpdate(t)}),ct(this,cl).notify({mutation:this,type:"updated",action:t})})},zX);function DQ(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ch,ku,AT,FX,J0e=(FX=class extends yx{constructor(t={}){super();dn(this,Ch);dn(this,ku);dn(this,AT);this.config=t,Mr(this,Ch,new Set),Mr(this,ku,new Map),Mr(this,AT,0)}build(t,r,n){const l=new Y0e({mutationCache:this,mutationId:++D2(this,AT)._,options:t.defaultMutationOptions(r),state:n});return this.add(l),l}add(t){ct(this,Ch).add(t);const r=rP(t);if(typeof r=="string"){const n=ct(this,ku).get(r);n?n.push(t):ct(this,ku).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(ct(this,Ch).delete(t)){const r=rP(t);if(typeof r=="string"){const n=ct(this,ku).get(r);if(n)if(n.length>1){const l=n.indexOf(t);l!==-1&&n.splice(l,1)}else n[0]===t&&ct(this,ku).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=rP(t);if(typeof r=="string"){const n=ct(this,ku).get(r),l=n==null?void 0:n.find(u=>u.state.status==="pending");return!l||l===t}else return!0}runNext(t){var n;const r=rP(t);if(typeof r=="string"){const l=(n=ct(this,ku).get(r))==null?void 0:n.find(u=>u!==t&&u.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}else return Promise.resolve()}clear(){$s.batch(()=>{ct(this,Ch).forEach(t=>{this.notify({type:"removed",mutation:t})}),ct(this,Ch).clear(),ct(this,ku).clear()})}getAll(){return Array.from(ct(this,Ch))}find(t){const r={exact:!0,...t};return this.getAll().find(n=>qG(r,n))}findAll(t={}){return this.getAll().filter(r=>qG(t,r))}notify(t){$s.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return $s.batch(()=>Promise.all(t.map(r=>r.continue().catch(hl))))}},Ch=new WeakMap,ku=new WeakMap,AT=new WeakMap,FX);function rP(e){var t;return(t=e.options.scope)==null?void 0:t.id}function ZG(e){return{onFetch:(t,r)=>{var P,C,k,L,$;const n=t.options,l=(k=(C=(P=t.fetchOptions)==null?void 0:P.meta)==null?void 0:C.fetchMore)==null?void 0:k.direction,u=((L=t.state.data)==null?void 0:L.pages)||[],f=(($=t.state.data)==null?void 0:$.pageParams)||[];let o={pages:[],pageParams:[]},v=0;const w=async()=>{let j=!1;const B=H=>{Object.defineProperty(H,"signal",{enumerable:!0,get:()=>(t.signal.aborted?j=!0:t.signal.addEventListener("abort",()=>{j=!0}),t.signal)})},U=PQ(t.options,t.fetchOptions),q=async(H,te,Q)=>{if(j)return Promise.reject();if(te==null&&H.pages.length)return Promise.resolve(H);const ue=(()=>{const Ge={client:t.client,queryKey:t.queryKey,pageParam:te,direction:Q?"backward":"forward",meta:t.options.meta};return B(Ge),Ge})(),me=await U(ue),{maxPages:Ce}=t.options,Fe=Q?V0e:$0e;return{pages:Fe(H.pages,me,Ce),pageParams:Fe(H.pageParams,te,Ce)}};if(l&&u.length){const H=l==="backward",te=H?Q0e:XG,Q={pages:u,pageParams:f},ae=te(n,Q);o=await q(Q,ae,H)}else{const H=e??u.length;do{const te=v===0?f[0]??n.initialPageParam:XG(n,o);if(v>0&&te==null)break;o=await q(o,te),v++}while(v<H)}return o};t.options.persister?t.fetchFn=()=>{var j,B;return(B=(j=t.options).persister)==null?void 0:B.call(j,w,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=w}}}function XG(e,{pages:t,pageParams:r}){const n=t.length-1;return t.length>0?e.getNextPageParam(t[n],t,r[n],r):void 0}function Q0e(e,{pages:t,pageParams:r}){var n;return t.length>0?(n=e.getPreviousPageParam)==null?void 0:n.call(e,t[0],t,r[0],r):void 0}var ts,yp,_p,c0,u0,vp,d0,h0,BX,exe=(BX=class{constructor(e={}){dn(this,ts);dn(this,yp);dn(this,_p);dn(this,c0);dn(this,u0);dn(this,vp);dn(this,d0);dn(this,h0);Mr(this,ts,e.queryCache||new K0e),Mr(this,yp,e.mutationCache||new J0e),Mr(this,_p,e.defaultOptions||{}),Mr(this,c0,new Map),Mr(this,u0,new Map),Mr(this,vp,0)}mount(){D2(this,vp)._++,ct(this,vp)===1&&(Mr(this,d0,yB.subscribe(async e=>{e&&(await this.resumePausedMutations(),ct(this,ts).onFocus())})),Mr(this,h0,RC.subscribe(async e=>{e&&(await this.resumePausedMutations(),ct(this,ts).onOnline())})))}unmount(){var e,t;D2(this,vp)._--,ct(this,vp)===0&&((e=ct(this,d0))==null||e.call(this),Mr(this,d0,void 0),(t=ct(this,h0))==null||t.call(this),Mr(this,h0,void 0))}isFetching(e){return ct(this,ts).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return ct(this,yp).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=ct(this,ts).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),r=ct(this,ts).build(this,t),n=r.state.data;return n===void 0?this.fetchQuery(e):(e.revalidateIfStale&&r.isStaleByTime(zp(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(n))}getQueriesData(e){return ct(this,ts).findAll(e).map(({queryKey:t,state:r})=>{const n=r.data;return[t,n]})}setQueryData(e,t,r){const n=this.defaultQueryOptions({queryKey:e}),l=ct(this,ts).get(n.queryHash),u=l==null?void 0:l.state.data,f=F0e(t,u);if(f!==void 0)return ct(this,ts).build(this,n).setData(f,{...r,manual:!0})}setQueriesData(e,t,r){return $s.batch(()=>ct(this,ts).findAll(e).map(({queryKey:n})=>[n,this.setQueryData(n,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=ct(this,ts).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=ct(this,ts);$s.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=ct(this,ts);return $s.batch(()=>(r.findAll(e).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const r={revert:!0,...t},n=$s.batch(()=>ct(this,ts).findAll(e).map(l=>l.cancel(r)));return Promise.all(n).then(hl).catch(hl)}invalidateQueries(e,t={}){return $s.batch(()=>(ct(this,ts).findAll(e).forEach(r=>{r.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},n=$s.batch(()=>ct(this,ts).findAll(e).filter(l=>!l.isDisabled()&&!l.isStatic()).map(l=>{let u=l.fetch(void 0,r);return r.throwOnError||(u=u.catch(hl)),l.state.fetchStatus==="paused"?Promise.resolve():u}));return Promise.all(n).then(hl)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=ct(this,ts).build(this,t);return r.isStaleByTime(zp(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(hl).catch(hl)}fetchInfiniteQuery(e){return e.behavior=ZG(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(hl).catch(hl)}ensureInfiniteQueryData(e){return e.behavior=ZG(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return RC.isOnline()?ct(this,yp).resumePausedMutations():Promise.resolve()}getQueryCache(){return ct(this,ts)}getMutationCache(){return ct(this,yp)}getDefaultOptions(){return ct(this,_p)}setDefaultOptions(e){Mr(this,_p,e)}setQueryDefaults(e,t){ct(this,c0).set(oy(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...ct(this,c0).values()],r={};return t.forEach(n=>{ES(e,n.queryKey)&&Object.assign(r,n.defaultOptions)}),r}setMutationDefaults(e,t){ct(this,u0).set(oy(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...ct(this,u0).values()],r={};return t.forEach(n=>{ES(e,n.mutationKey)&&Object.assign(r,n.defaultOptions)}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...ct(this,_p).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=mB(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===gB&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...ct(this,_p).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){ct(this,ts).clear(),ct(this,yp).clear()}},ts=new WeakMap,yp=new WeakMap,_p=new WeakMap,c0=new WeakMap,u0=new WeakMap,vp=new WeakMap,d0=new WeakMap,h0=new WeakMap,BX),kl,vi,PT,ul,Vg,f0,xp,bp,CT,p0,m0,Ug,Gg,wp,g0,$i,x1,pN,mN,gN,yN,_N,vN,xN,LQ,$X,txe=($X=class extends yx{constructor(t,r){super();dn(this,$i);dn(this,kl);dn(this,vi);dn(this,PT);dn(this,ul);dn(this,Vg);dn(this,f0);dn(this,xp);dn(this,bp);dn(this,CT);dn(this,p0);dn(this,m0);dn(this,Ug);dn(this,Gg);dn(this,wp);dn(this,g0,new Set);this.options=r,Mr(this,kl,t),Mr(this,bp,null),Mr(this,xp,fN()),this.options.experimental_prefetchInRender||ct(this,xp).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(ct(this,vi).addObserver(this),KG(ct(this,vi),this.options)?Xn(this,$i,x1).call(this):this.updateResult(),Xn(this,$i,yN).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return bN(ct(this,vi),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return bN(ct(this,vi),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,Xn(this,$i,_N).call(this),Xn(this,$i,vN).call(this),ct(this,vi).removeObserver(this)}setOptions(t){const r=this.options,n=ct(this,vi);if(this.options=ct(this,kl).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Bc(this.options.enabled,ct(this,vi))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");Xn(this,$i,xN).call(this),ct(this,vi).setOptions(this.options),r._defaulted&&!kC(this.options,r)&&ct(this,kl).getQueryCache().notify({type:"observerOptionsUpdated",query:ct(this,vi),observer:this});const l=this.hasListeners();l&&YG(ct(this,vi),n,this.options,r)&&Xn(this,$i,x1).call(this),this.updateResult(),l&&(ct(this,vi)!==n||Bc(this.options.enabled,ct(this,vi))!==Bc(r.enabled,ct(this,vi))||zp(this.options.staleTime,ct(this,vi))!==zp(r.staleTime,ct(this,vi)))&&Xn(this,$i,pN).call(this);const u=Xn(this,$i,mN).call(this);l&&(ct(this,vi)!==n||Bc(this.options.enabled,ct(this,vi))!==Bc(r.enabled,ct(this,vi))||u!==ct(this,wp))&&Xn(this,$i,gN).call(this,u)}getOptimisticResult(t){const r=ct(this,kl).getQueryCache().build(ct(this,kl),t),n=this.createResult(r,t);return nxe(this,n)&&(Mr(this,ul,n),Mr(this,f0,this.options),Mr(this,Vg,ct(this,vi).state)),n}getCurrentResult(){return ct(this,ul)}trackResult(t,r){return new Proxy(t,{get:(n,l)=>(this.trackProp(l),r==null||r(l),Reflect.get(n,l))})}trackProp(t){ct(this,g0).add(t)}getCurrentQuery(){return ct(this,vi)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const r=ct(this,kl).defaultQueryOptions(t),n=ct(this,kl).getQueryCache().build(ct(this,kl),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(t){return Xn(this,$i,x1).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),ct(this,ul)))}createResult(t,r){var Ce;const n=ct(this,vi),l=this.options,u=ct(this,ul),f=ct(this,Vg),o=ct(this,f0),w=t!==n?t.state:ct(this,PT),{state:P}=t;let C={...P},k=!1,L;if(r._optimisticResults){const Fe=this.hasListeners(),Ge=!Fe&&KG(t,r),Ve=Fe&&YG(t,n,r,l);(Ge||Ve)&&(C={...C,...MQ(P.data,t.options)}),r._optimisticResults==="isRestoring"&&(C.fetchStatus="idle")}let{error:$,errorUpdatedAt:j,status:B}=C;L=C.data;let U=!1;if(r.placeholderData!==void 0&&L===void 0&&B==="pending"){let Fe;u!=null&&u.isPlaceholderData&&r.placeholderData===(o==null?void 0:o.placeholderData)?(Fe=u.data,U=!0):Fe=typeof r.placeholderData=="function"?r.placeholderData((Ce=ct(this,m0))==null?void 0:Ce.state.data,ct(this,m0)):r.placeholderData,Fe!==void 0&&(B="success",L=hN(u==null?void 0:u.data,Fe,r),k=!0)}if(r.select&&L!==void 0&&!U)if(u&&L===(f==null?void 0:f.data)&&r.select===ct(this,CT))L=ct(this,p0);else try{Mr(this,CT,r.select),L=r.select(L),L=hN(u==null?void 0:u.data,L,r),Mr(this,p0,L),Mr(this,bp,null)}catch(Fe){Mr(this,bp,Fe)}ct(this,bp)&&($=ct(this,bp),L=ct(this,p0),j=Date.now(),B="error");const q=C.fetchStatus==="fetching",H=B==="pending",te=B==="error",Q=H&&q,ae=L!==void 0,me={status:B,fetchStatus:C.fetchStatus,isPending:H,isSuccess:B==="success",isError:te,isInitialLoading:Q,isLoading:Q,data:L,dataUpdatedAt:C.dataUpdatedAt,error:$,errorUpdatedAt:j,failureCount:C.fetchFailureCount,failureReason:C.fetchFailureReason,errorUpdateCount:C.errorUpdateCount,isFetched:C.dataUpdateCount>0||C.errorUpdateCount>0,isFetchedAfterMount:C.dataUpdateCount>w.dataUpdateCount||C.errorUpdateCount>w.errorUpdateCount,isFetching:q,isRefetching:q&&!H,isLoadingError:te&&!ae,isPaused:C.fetchStatus==="paused",isPlaceholderData:k,isRefetchError:te&&ae,isStale:_B(t,r),refetch:this.refetch,promise:ct(this,xp),isEnabled:Bc(r.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const Fe=Ze=>{me.status==="error"?Ze.reject(me.error):me.data!==void 0&&Ze.resolve(me.data)},Ge=()=>{const Ze=Mr(this,xp,me.promise=fN());Fe(Ze)},Ve=ct(this,xp);switch(Ve.status){case"pending":t.queryHash===n.queryHash&&Fe(Ve);break;case"fulfilled":(me.status==="error"||me.data!==Ve.value)&&Ge();break;case"rejected":(me.status!=="error"||me.error!==Ve.reason)&&Ge();break}}return me}updateResult(){const t=ct(this,ul),r=this.createResult(ct(this,vi),this.options);if(Mr(this,Vg,ct(this,vi).state),Mr(this,f0,this.options),ct(this,Vg).data!==void 0&&Mr(this,m0,ct(this,vi)),kC(r,t))return;Mr(this,ul,r);const n=()=>{if(!t)return!0;const{notifyOnChangeProps:l}=this.options,u=typeof l=="function"?l():l;if(u==="all"||!u&&!ct(this,g0).size)return!0;const f=new Set(u??ct(this,g0));return this.options.throwOnError&&f.add("error"),Object.keys(ct(this,ul)).some(o=>{const v=o;return ct(this,ul)[v]!==t[v]&&f.has(v)})};Xn(this,$i,LQ).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&Xn(this,$i,yN).call(this)}},kl=new WeakMap,vi=new WeakMap,PT=new WeakMap,ul=new WeakMap,Vg=new WeakMap,f0=new WeakMap,xp=new WeakMap,bp=new WeakMap,CT=new WeakMap,p0=new WeakMap,m0=new WeakMap,Ug=new WeakMap,Gg=new WeakMap,wp=new WeakMap,g0=new WeakMap,$i=new WeakSet,x1=function(t){Xn(this,$i,xN).call(this);let r=ct(this,vi).fetch(this.options,t);return t!=null&&t.throwOnError||(r=r.catch(hl)),r},pN=function(){Xn(this,$i,_N).call(this);const t=zp(this.options.staleTime,ct(this,vi));if(iy||ct(this,ul).isStale||!uN(t))return;const n=EQ(ct(this,ul).dataUpdatedAt,t)+1;Mr(this,Ug,setTimeout(()=>{ct(this,ul).isStale||this.updateResult()},n))},mN=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(ct(this,vi)):this.options.refetchInterval)??!1},gN=function(t){Xn(this,$i,vN).call(this),Mr(this,wp,t),!(iy||Bc(this.options.enabled,ct(this,vi))===!1||!uN(ct(this,wp))||ct(this,wp)===0)&&Mr(this,Gg,setInterval(()=>{(this.options.refetchIntervalInBackground||yB.isFocused())&&Xn(this,$i,x1).call(this)},ct(this,wp)))},yN=function(){Xn(this,$i,pN).call(this),Xn(this,$i,gN).call(this,Xn(this,$i,mN).call(this))},_N=function(){ct(this,Ug)&&(clearTimeout(ct(this,Ug)),Mr(this,Ug,void 0))},vN=function(){ct(this,Gg)&&(clearInterval(ct(this,Gg)),Mr(this,Gg,void 0))},xN=function(){const t=ct(this,kl).getQueryCache().build(ct(this,kl),this.options);if(t===ct(this,vi))return;const r=ct(this,vi);Mr(this,vi,t),Mr(this,PT,t.state),this.hasListeners()&&(r==null||r.removeObserver(this),t.addObserver(this))},LQ=function(t){$s.batch(()=>{t.listeners&&this.listeners.forEach(r=>{r(ct(this,ul))}),ct(this,kl).getQueryCache().notify({query:ct(this,vi),type:"observerResultsUpdated"})})},$X);function rxe(e,t){return Bc(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function KG(e,t){return rxe(e,t)||e.state.data!==void 0&&bN(e,t,t.refetchOnMount)}function bN(e,t,r){if(Bc(t.enabled,e)!==!1&&zp(t.staleTime,e)!=="static"){const n=typeof r=="function"?r(e):r;return n==="always"||n!==!1&&_B(e,t)}return!1}function YG(e,t,r,n){return(e!==t||Bc(n.enabled,e)===!1)&&(!r.suspense||e.state.status!=="error")&&_B(e,r)}function _B(e,t){return Bc(t.enabled,e)!==!1&&e.isStaleByTime(zp(t.staleTime,e))}function nxe(e,t){return!kC(e.getCurrentResult(),t)}var Sp,Tp,Rl,Ih,Uh,qP,wN,VX,ixe=(VX=class extends yx{constructor(r,n){super();dn(this,Uh);dn(this,Sp);dn(this,Tp);dn(this,Rl);dn(this,Ih);Mr(this,Sp,r),this.setOptions(n),this.bindMethods(),Xn(this,Uh,qP).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(r){var l;const n=this.options;this.options=ct(this,Sp).defaultMutationOptions(r),kC(this.options,n)||ct(this,Sp).getMutationCache().notify({type:"observerOptionsUpdated",mutation:ct(this,Rl),observer:this}),n!=null&&n.mutationKey&&this.options.mutationKey&&oy(n.mutationKey)!==oy(this.options.mutationKey)?this.reset():((l=ct(this,Rl))==null?void 0:l.state.status)==="pending"&&ct(this,Rl).setOptions(this.options)}onUnsubscribe(){var r;this.hasListeners()||(r=ct(this,Rl))==null||r.removeObserver(this)}onMutationUpdate(r){Xn(this,Uh,qP).call(this),Xn(this,Uh,wN).call(this,r)}getCurrentResult(){return ct(this,Tp)}reset(){var r;(r=ct(this,Rl))==null||r.removeObserver(this),Mr(this,Rl,void 0),Xn(this,Uh,qP).call(this),Xn(this,Uh,wN).call(this)}mutate(r,n){var l;return Mr(this,Ih,n),(l=ct(this,Rl))==null||l.removeObserver(this),Mr(this,Rl,ct(this,Sp).getMutationCache().build(ct(this,Sp),this.options)),ct(this,Rl).addObserver(this),ct(this,Rl).execute(r)}},Sp=new WeakMap,Tp=new WeakMap,Rl=new WeakMap,Ih=new WeakMap,Uh=new WeakSet,qP=function(){var n;const r=((n=ct(this,Rl))==null?void 0:n.state)??DQ();Mr(this,Tp,{...r,isPending:r.status==="pending",isSuccess:r.status==="success",isError:r.status==="error",isIdle:r.status==="idle",mutate:this.mutate,reset:this.reset})},wN=function(r){$s.batch(()=>{var n,l,u,f,o,v,w,P;if(ct(this,Ih)&&this.hasListeners()){const C=ct(this,Tp).variables,k=ct(this,Tp).context;(r==null?void 0:r.type)==="success"?((l=(n=ct(this,Ih)).onSuccess)==null||l.call(n,r.data,C,k),(f=(u=ct(this,Ih)).onSettled)==null||f.call(u,r.data,null,C,k)):(r==null?void 0:r.type)==="error"&&((v=(o=ct(this,Ih)).onError)==null||v.call(o,r.error,C,k),(P=(w=ct(this,Ih)).onSettled)==null||P.call(w,void 0,r.error,C,k))}this.listeners.forEach(C=>{C(ct(this,Tp))})})},VX),jQ=X.createContext(void 0),by=e=>{const t=X.useContext(jQ);if(!t)throw new Error("No QueryClient set, use QueryClientProvider to set one");return t},oxe=({client:e,children:t})=>(X.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),A.jsx(jQ.Provider,{value:e,children:t})),NQ=X.createContext(!1),sxe=()=>X.useContext(NQ);NQ.Provider;function axe(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var lxe=X.createContext(axe()),cxe=()=>X.useContext(lxe),uxe=(e,t)=>{(e.suspense||e.throwOnError||e.experimental_prefetchInRender)&&(t.isReset()||(e.retryOnMount=!1))},dxe=e=>{X.useEffect(()=>{e.clearReset()},[e])},hxe=({result:e,errorResetBoundary:t,throwOnError:r,query:n,suspense:l})=>e.isError&&!t.isReset()&&!e.isFetching&&n&&(l&&e.data===void 0||CQ(r,[e.error,n])),fxe=e=>{if(e.suspense){const t=n=>n==="static"?n:Math.max(n??1e3,1e3),r=e.staleTime;e.staleTime=typeof r=="function"?(...n)=>t(r(...n)):t(r),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},pxe=(e,t)=>e.isLoading&&e.isFetching&&!t,mxe=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,JG=(e,t,r)=>t.fetchOptimistic(e).catch(()=>{r.clearReset()});function gxe(e,t,r){var C,k,L,$,j;const n=sxe(),l=cxe(),u=by(),f=u.defaultQueryOptions(e);(k=(C=u.getDefaultOptions().queries)==null?void 0:C._experimental_beforeQuery)==null||k.call(C,f),f._optimisticResults=n?"isRestoring":"optimistic",fxe(f),uxe(f,l),dxe(l);const o=!u.getQueryCache().get(f.queryHash),[v]=X.useState(()=>new t(u,f)),w=v.getOptimisticResult(f),P=!n&&e.subscribed!==!1;if(X.useSyncExternalStore(X.useCallback(B=>{const U=P?v.subscribe($s.batchCalls(B)):hl;return v.updateResult(),U},[v,P]),()=>v.getCurrentResult(),()=>v.getCurrentResult()),X.useEffect(()=>{v.setOptions(f)},[f,v]),mxe(f,w))throw JG(f,v,l);if(hxe({result:w,errorResetBoundary:l,throwOnError:f.throwOnError,query:u.getQueryCache().get(f.queryHash),suspense:f.suspense}))throw w.error;if(($=(L=u.getDefaultOptions().queries)==null?void 0:L._experimental_afterQuery)==null||$.call(L,f,w),f.experimental_prefetchInRender&&!iy&&pxe(w,n)){const B=o?JG(f,v,l):(j=u.getQueryCache().get(f.queryHash))==null?void 0:j.promise;B==null||B.catch(hl).finally(()=>{v.updateResult()})}return f.notifyOnChangeProps?w:v.trackResult(w)}function Qc(e,t){return gxe(e,txe)}function P0(e,t){const r=by(),[n]=X.useState(()=>new ixe(r,e));X.useEffect(()=>{n.setOptions(e)},[n,e]);const l=X.useSyncExternalStore(X.useCallback(f=>n.subscribe($s.batchCalls(f)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),u=X.useCallback((f,o)=>{n.mutate(f,o).catch(hl)},[n]);if(l.error&&CQ(n.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:u,mutateAsync:l.mutate}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function AS(){return AS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AS.apply(this,arguments)}var Pp;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Pp||(Pp={}));const QG="popstate";function yxe(e){e===void 0&&(e={});function t(l,u){let{pathname:f="/",search:o="",hash:v=""}=wy(l.location.hash.substr(1));return!f.startsWith("/")&&!f.startsWith(".")&&(f="/"+f),SN("",{pathname:f,search:o,hash:v},u.state&&u.state.usr||null,u.state&&u.state.key||"default")}function r(l,u){let f=l.document.querySelector("base"),o="";if(f&&f.getAttribute("href")){let v=l.location.href,w=v.indexOf("#");o=w===-1?v:v.slice(0,w)}return o+"#"+(typeof u=="string"?u:MC(u))}function n(l,u){vB(l.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(u)+")")}return vxe(t,r,n,e)}function Es(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function vB(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function _xe(){return Math.random().toString(36).substr(2,8)}function eq(e,t){return{usr:e.state,key:e.key,idx:t}}function SN(e,t,r,n){return r===void 0&&(r=null),AS({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?wy(t):t,{state:r,key:t&&t.key||n||_xe()})}function MC(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function wy(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function vxe(e,t,r,n){n===void 0&&(n={});let{window:l=document.defaultView,v5Compat:u=!1}=n,f=l.history,o=Pp.Pop,v=null,w=P();w==null&&(w=0,f.replaceState(AS({},f.state,{idx:w}),""));function P(){return(f.state||{idx:null}).idx}function C(){o=Pp.Pop;let B=P(),U=B==null?null:B-w;w=B,v&&v({action:o,location:j.location,delta:U})}function k(B,U){o=Pp.Push;let q=SN(j.location,B,U);r&&r(q,B),w=P()+1;let H=eq(q,w),te=j.createHref(q);try{f.pushState(H,"",te)}catch(Q){if(Q instanceof DOMException&&Q.name==="DataCloneError")throw Q;l.location.assign(te)}u&&v&&v({action:o,location:j.location,delta:1})}function L(B,U){o=Pp.Replace;let q=SN(j.location,B,U);r&&r(q,B),w=P();let H=eq(q,w),te=j.createHref(q);f.replaceState(H,"",te),u&&v&&v({action:o,location:j.location,delta:0})}function $(B){let U=l.location.origin!=="null"?l.location.origin:l.location.href,q=typeof B=="string"?B:MC(B);return q=q.replace(/ $/,"%20"),Es(U,"No window.location.(origin|href) available to create URL for href: "+q),new URL(q,U)}let j={get action(){return o},get location(){return e(l,f)},listen(B){if(v)throw new Error("A history only accepts one active listener");return l.addEventListener(QG,C),v=B,()=>{l.removeEventListener(QG,C),v=null}},createHref(B){return t(l,B)},createURL:$,encodeLocation(B){let U=$(B);return{pathname:U.pathname,search:U.search,hash:U.hash}},push:k,replace:L,go(B){return f.go(B)}};return j}var tq;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(tq||(tq={}));function xxe(e,t,r){return r===void 0&&(r="/"),bxe(e,t,r,!1)}function bxe(e,t,r,n){let l=typeof t=="string"?wy(t):t,u=xB(l.pathname||"/",r);if(u==null)return null;let f=zQ(e);wxe(f);let o=null;for(let v=0;o==null&&v<f.length;++v){let w=Mxe(u);o=kxe(f[v],w,n)}return o}function zQ(e,t,r,n){t===void 0&&(t=[]),r===void 0&&(r=[]),n===void 0&&(n="");let l=(u,f,o)=>{let v={relativePath:o===void 0?u.path||"":o,caseSensitive:u.caseSensitive===!0,childrenIndex:f,route:u};v.relativePath.startsWith("/")&&(Es(v.relativePath.startsWith(n),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(n.length));let w=Fp([n,v.relativePath]),P=r.concat(v);u.children&&u.children.length>0&&(Es(u.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),zQ(u.children,t,P,w)),!(u.path==null&&!u.index)&&t.push({path:w,score:Ixe(w,u.index),routesMeta:P})};return e.forEach((u,f)=>{var o;if(u.path===""||!((o=u.path)!=null&&o.includes("?")))l(u,f);else for(let v of FQ(u.path))l(u,f,v)}),t}function FQ(e){let t=e.split("/");if(t.length===0)return[];let[r,...n]=t,l=r.endsWith("?"),u=r.replace(/\?$/,"");if(n.length===0)return l?[u,""]:[u];let f=FQ(n.join("/")),o=[];return o.push(...f.map(v=>v===""?u:[u,v].join("/"))),l&&o.push(...f),o.map(v=>e.startsWith("/")&&v===""?"/":v)}function wxe(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:Oxe(t.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}const Sxe=/^:[\w-]+$/,Txe=3,Exe=2,Axe=1,Pxe=10,Cxe=-2,rq=e=>e==="*";function Ixe(e,t){let r=e.split("/"),n=r.length;return r.some(rq)&&(n+=Cxe),t&&(n+=Exe),r.filter(l=>!rq(l)).reduce((l,u)=>l+(Sxe.test(u)?Txe:u===""?Axe:Pxe),n)}function Oxe(e,t){return e.length===t.length&&e.slice(0,-1).every((n,l)=>n===t[l])?e[e.length-1]-t[t.length-1]:0}function kxe(e,t,r){let{routesMeta:n}=e,l={},u="/",f=[];for(let o=0;o<n.length;++o){let v=n[o],w=o===n.length-1,P=u==="/"?t:t.slice(u.length)||"/",C=nq({path:v.relativePath,caseSensitive:v.caseSensitive,end:w},P),k=v.route;if(!C&&w&&r&&!n[n.length-1].route.index&&(C=nq({path:v.relativePath,caseSensitive:v.caseSensitive,end:!1},P)),!C)return null;Object.assign(l,C.params),f.push({params:l,pathname:Fp([u,C.pathname]),pathnameBase:Nxe(Fp([u,C.pathnameBase])),route:k}),C.pathnameBase!=="/"&&(u=Fp([u,C.pathnameBase]))}return f}function nq(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=Rxe(e.path,e.caseSensitive,e.end),l=t.match(r);if(!l)return null;let u=l[0],f=u.replace(/(.)\/+$/,"$1"),o=l.slice(1);return{params:n.reduce((w,P,C)=>{let{paramName:k,isOptional:L}=P;if(k==="*"){let j=o[C]||"";f=u.slice(0,u.length-j.length).replace(/(.)\/+$/,"$1")}const $=o[C];return L&&!$?w[k]=void 0:w[k]=($||"").replace(/%2F/g,"/"),w},{}),pathname:u,pathnameBase:f,pattern:e}}function Rxe(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),vB(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let n=[],l="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,o,v)=>(n.push({paramName:o,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(n.push({paramName:"*"}),l+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?l+="\\/*$":e!==""&&e!=="/"&&(l+="(?:(?=\\/|$))"),[new RegExp(l,t?void 0:"i"),n]}function Mxe(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return vB(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function xB(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&n!=="/"?null:e.slice(r)||"/"}function Dxe(e,t){t===void 0&&(t="/");let{pathname:r,search:n="",hash:l=""}=typeof e=="string"?wy(e):e;return{pathname:r?r.startsWith("/")?r:Lxe(r,t):t,search:zxe(n),hash:Fxe(l)}}function Lxe(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(l=>{l===".."?r.length>1&&r.pop():l!=="."&&r.push(l)}),r.length>1?r.join("/"):"/"}function WD(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function jxe(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function BQ(e,t){let r=jxe(e);return t?r.map((n,l)=>l===r.length-1?n.pathname:n.pathnameBase):r.map(n=>n.pathnameBase)}function $Q(e,t,r,n){n===void 0&&(n=!1);let l;typeof e=="string"?l=wy(e):(l=AS({},e),Es(!l.pathname||!l.pathname.includes("?"),WD("?","pathname","search",l)),Es(!l.pathname||!l.pathname.includes("#"),WD("#","pathname","hash",l)),Es(!l.search||!l.search.includes("#"),WD("#","search","hash",l)));let u=e===""||l.pathname==="",f=u?"/":l.pathname,o;if(f==null)o=r;else{let C=t.length-1;if(!n&&f.startsWith("..")){let k=f.split("/");for(;k[0]==="..";)k.shift(),C-=1;l.pathname=k.join("/")}o=C>=0?t[C]:"/"}let v=Dxe(l,o),w=f&&f!=="/"&&f.endsWith("/"),P=(u||f===".")&&r.endsWith("/");return!v.pathname.endsWith("/")&&(w||P)&&(v.pathname+="/"),v}const Fp=e=>e.join("/").replace(/\/\/+/g,"/"),Nxe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),zxe=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Fxe=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Bxe(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const VQ=["post","put","patch","delete"];new Set(VQ);const $xe=["get",...VQ];new Set($xe);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function PS(){return PS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},PS.apply(this,arguments)}const bB=X.createContext(null),Vxe=X.createContext(null),Sy=X.createContext(null),RO=X.createContext(null),rm=X.createContext({outlet:null,matches:[],isDataRoute:!1}),UQ=X.createContext(null);function Uxe(e,t){let{relative:r}=t===void 0?{}:t;zT()||Es(!1);let{basename:n,navigator:l}=X.useContext(Sy),{hash:u,pathname:f,search:o}=HQ(e,{relative:r}),v=f;return n!=="/"&&(v=f==="/"?n:Fp([n,f])),l.createHref({pathname:v,search:o,hash:u})}function zT(){return X.useContext(RO)!=null}function Ty(){return zT()||Es(!1),X.useContext(RO).location}function GQ(e){X.useContext(Sy).static||X.useLayoutEffect(e)}function MO(){let{isDataRoute:e}=X.useContext(rm);return e?rbe():Gxe()}function Gxe(){zT()||Es(!1);let e=X.useContext(bB),{basename:t,future:r,navigator:n}=X.useContext(Sy),{matches:l}=X.useContext(rm),{pathname:u}=Ty(),f=JSON.stringify(BQ(l,r.v7_relativeSplatPath)),o=X.useRef(!1);return GQ(()=>{o.current=!0}),X.useCallback(function(w,P){if(P===void 0&&(P={}),!o.current)return;if(typeof w=="number"){n.go(w);return}let C=$Q(w,JSON.parse(f),u,P.relative==="path");e==null&&t!=="/"&&(C.pathname=C.pathname==="/"?t:Fp([t,C.pathname])),(P.replace?n.replace:n.push)(C,P.state,P)},[t,n,f,u,e])}function qQ(){let{matches:e}=X.useContext(rm),t=e[e.length-1];return t?t.params:{}}function HQ(e,t){let{relative:r}=t===void 0?{}:t,{future:n}=X.useContext(Sy),{matches:l}=X.useContext(rm),{pathname:u}=Ty(),f=JSON.stringify(BQ(l,n.v7_relativeSplatPath));return X.useMemo(()=>$Q(e,JSON.parse(f),u,r==="path"),[e,f,u,r])}function qxe(e,t){return Hxe(e,t)}function Hxe(e,t,r,n){zT()||Es(!1);let{navigator:l}=X.useContext(Sy),{matches:u}=X.useContext(rm),f=u[u.length-1],o=f?f.params:{};f&&f.pathname;let v=f?f.pathnameBase:"/";f&&f.route;let w=Ty(),P;if(t){var C;let B=typeof t=="string"?wy(t):t;v==="/"||(C=B.pathname)!=null&&C.startsWith(v)||Es(!1),P=B}else P=w;let k=P.pathname||"/",L=k;if(v!=="/"){let B=v.replace(/^\//,"").split("/");L="/"+k.replace(/^\//,"").split("/").slice(B.length).join("/")}let $=xxe(e,{pathname:L}),j=Yxe($&&$.map(B=>Object.assign({},B,{params:Object.assign({},o,B.params),pathname:Fp([v,l.encodeLocation?l.encodeLocation(B.pathname).pathname:B.pathname]),pathnameBase:B.pathnameBase==="/"?v:Fp([v,l.encodeLocation?l.encodeLocation(B.pathnameBase).pathname:B.pathnameBase])})),u,r,n);return t&&j?X.createElement(RO.Provider,{value:{location:PS({pathname:"/",search:"",hash:"",state:null,key:"default"},P),navigationType:Pp.Pop}},j):j}function Wxe(){let e=tbe(),t=Bxe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,l={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return X.createElement(X.Fragment,null,X.createElement("h2",null,"Unexpected Application Error!"),X.createElement("h3",{style:{fontStyle:"italic"}},t),r?X.createElement("pre",{style:l},r):null,null)}const Zxe=X.createElement(Wxe,null);class Xxe extends X.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?X.createElement(rm.Provider,{value:this.props.routeContext},X.createElement(UQ.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Kxe(e){let{routeContext:t,match:r,children:n}=e,l=X.useContext(bB);return l&&l.static&&l.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=r.route.id),X.createElement(rm.Provider,{value:t},n)}function Yxe(e,t,r,n){var l;if(t===void 0&&(t=[]),r===void 0&&(r=null),n===void 0&&(n=null),e==null){var u;if(!r)return null;if(r.errors)e=r.matches;else if((u=n)!=null&&u.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let f=e,o=(l=r)==null?void 0:l.errors;if(o!=null){let P=f.findIndex(C=>C.route.id&&(o==null?void 0:o[C.route.id])!==void 0);P>=0||Es(!1),f=f.slice(0,Math.min(f.length,P+1))}let v=!1,w=-1;if(r&&n&&n.v7_partialHydration)for(let P=0;P<f.length;P++){let C=f[P];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(w=P),C.route.id){let{loaderData:k,errors:L}=r,$=C.route.loader&&k[C.route.id]===void 0&&(!L||L[C.route.id]===void 0);if(C.route.lazy||$){v=!0,w>=0?f=f.slice(0,w+1):f=[f[0]];break}}}return f.reduceRight((P,C,k)=>{let L,$=!1,j=null,B=null;r&&(L=o&&C.route.id?o[C.route.id]:void 0,j=C.route.errorElement||Zxe,v&&(w<0&&k===0?($=!0,B=null):w===k&&($=!0,B=C.route.hydrateFallbackElement||null)));let U=t.concat(f.slice(0,k+1)),q=()=>{let H;return L?H=j:$?H=B:C.route.Component?H=X.createElement(C.route.Component,null):C.route.element?H=C.route.element:H=P,X.createElement(Kxe,{match:C,routeContext:{outlet:P,matches:U,isDataRoute:r!=null},children:H})};return r&&(C.route.ErrorBoundary||C.route.errorElement||k===0)?X.createElement(Xxe,{location:r.location,revalidation:r.revalidation,component:j,error:L,children:q(),routeContext:{outlet:null,matches:U,isDataRoute:!0}}):q()},null)}var WQ=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(WQ||{}),DC=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(DC||{});function Jxe(e){let t=X.useContext(bB);return t||Es(!1),t}function Qxe(e){let t=X.useContext(Vxe);return t||Es(!1),t}function ebe(e){let t=X.useContext(rm);return t||Es(!1),t}function ZQ(e){let t=ebe(),r=t.matches[t.matches.length-1];return r.route.id||Es(!1),r.route.id}function tbe(){var e;let t=X.useContext(UQ),r=Qxe(DC.UseRouteError),n=ZQ(DC.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[n]}function rbe(){let{router:e}=Jxe(WQ.UseNavigateStable),t=ZQ(DC.UseNavigateStable),r=X.useRef(!1);return GQ(()=>{r.current=!0}),X.useCallback(function(l,u){u===void 0&&(u={}),r.current&&(typeof l=="number"?e.navigate(l):e.navigate(l,PS({fromRouteId:t},u)))},[e,t])}function nbe(e,t){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function ll(e){Es(!1)}function ibe(e){let{basename:t="/",children:r=null,location:n,navigationType:l=Pp.Pop,navigator:u,static:f=!1,future:o}=e;zT()&&Es(!1);let v=t.replace(/^\/*/,"/"),w=X.useMemo(()=>({basename:v,navigator:u,static:f,future:PS({v7_relativeSplatPath:!1},o)}),[v,o,u,f]);typeof n=="string"&&(n=wy(n));let{pathname:P="/",search:C="",hash:k="",state:L=null,key:$="default"}=n,j=X.useMemo(()=>{let B=xB(P,v);return B==null?null:{location:{pathname:B,search:C,hash:k,state:L,key:$},navigationType:l}},[v,P,C,k,L,$,l]);return j==null?null:X.createElement(Sy.Provider,{value:w},X.createElement(RO.Provider,{children:r,value:j}))}function obe(e){let{children:t,location:r}=e;return qxe(TN(t),r)}new Promise(()=>{});function TN(e,t){t===void 0&&(t=[]);let r=[];return X.Children.forEach(e,(n,l)=>{if(!X.isValidElement(n))return;let u=[...t,l];if(n.type===X.Fragment){r.push.apply(r,TN(n.props.children,u));return}n.type!==ll&&Es(!1),!n.props.index||!n.props.children||Es(!1);let f={id:n.props.id||u.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(f.children=TN(n.props.children,u)),r.push(f)}),r}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function EN(){return EN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},EN.apply(this,arguments)}function sbe(e,t){if(e==null)return{};var r={},n=Object.keys(e),l,u;for(u=0;u<n.length;u++)l=n[u],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function abe(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function lbe(e,t){return e.button===0&&(!t||t==="_self")&&!abe(e)}const cbe=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ube="6";try{window.__reactRouterVersion=ube}catch{}const dbe="startTransition",iq=QF[dbe];function hbe(e){let{basename:t,children:r,future:n,window:l}=e,u=X.useRef();u.current==null&&(u.current=yxe({window:l,v5Compat:!0}));let f=u.current,[o,v]=X.useState({action:f.action,location:f.location}),{v7_startTransition:w}=n||{},P=X.useCallback(C=>{w&&iq?iq(()=>v(C)):v(C)},[v,w]);return X.useLayoutEffect(()=>f.listen(P),[f,P]),X.useEffect(()=>nbe(n),[n]),X.createElement(ibe,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:f,future:n})}const fbe=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",pbe=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xi=X.forwardRef(function(t,r){let{onClick:n,relative:l,reloadDocument:u,replace:f,state:o,target:v,to:w,preventScrollReset:P,viewTransition:C}=t,k=sbe(t,cbe),{basename:L}=X.useContext(Sy),$,j=!1;if(typeof w=="string"&&pbe.test(w)&&($=w,fbe))try{let H=new URL(window.location.href),te=w.startsWith("//")?new URL(H.protocol+w):new URL(w),Q=xB(te.pathname,L);te.origin===H.origin&&Q!=null?w=Q+te.search+te.hash:j=!0}catch{}let B=Uxe(w,{relative:l}),U=mbe(w,{replace:f,state:o,target:v,preventScrollReset:P,relative:l,viewTransition:C});function q(H){n&&n(H),H.defaultPrevented||U(H)}return X.createElement("a",EN({},k,{href:$||B,onClick:j||u?n:q,ref:r,target:v}))});var oq;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(oq||(oq={}));var sq;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(sq||(sq={}));function mbe(e,t){let{target:r,replace:n,state:l,preventScrollReset:u,relative:f,viewTransition:o}=t===void 0?{}:t,v=MO(),w=Ty(),P=HQ(e,{relative:f});return X.useCallback(C=>{if(lbe(C,r)){C.preventDefault();let k=n!==void 0?n:MC(w)===MC(P);v(e,{replace:k,state:l,preventScrollReset:u,relative:f,viewTransition:o})}},[w,v,P,n,l,r,e,u,f,o])}var Id=function(){return Id=Object.assign||function(t){for(var r,n=1,l=arguments.length;n<l;n++){r=arguments[n];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(t[u]=r[u])}return t},Id.apply(this,arguments)};function _x(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(r[n[l]]=e[n[l]]);return r}function gbe(e,t,r,n){function l(u){return u instanceof r?u:new r(function(f){f(u)})}return new(r||(r=Promise))(function(u,f){function o(P){try{w(n.next(P))}catch(C){f(C)}}function v(P){try{w(n.throw(P))}catch(C){f(C)}}function w(P){P.done?u(P.value):l(P.value).then(o,v)}w((n=n.apply(e,t||[])).next())})}function ybe(e,t,r){if(r||arguments.length===2)for(var n=0,l=t.length,u;n<l;n++)(u||!(n in t))&&(u||(u=Array.prototype.slice.call(t,0,n)),u[n]=t[n]);return e.concat(u||Array.prototype.slice.call(t))}const _be=e=>e?(...t)=>e(...t):(...t)=>fetch(...t);class wB extends Error{constructor(t,r="FunctionsError",n){super(t),this.name=r,this.context=n}}class vbe extends wB{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class aq extends wB{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class lq extends wB{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var AN;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(AN||(AN={}));class xbe{constructor(t,{headers:r={},customFetch:n,region:l=AN.Any}={}){this.url=t,this.headers=r,this.region=l,this.fetch=_be(n)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return gbe(this,arguments,void 0,function*(r,n={}){var l;let u,f;try{const{headers:o,method:v,body:w,signal:P,timeout:C}=n;let k={},{region:L}=n;L||(L=this.region);const $=new URL(`${this.url}/${r}`);L&&L!=="any"&&(k["x-region"]=L,$.searchParams.set("forceFunctionRegion",L));let j;w&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&w instanceof Blob||w instanceof ArrayBuffer?(k["Content-Type"]="application/octet-stream",j=w):typeof w=="string"?(k["Content-Type"]="text/plain",j=w):typeof FormData<"u"&&w instanceof FormData?j=w:(k["Content-Type"]="application/json",j=JSON.stringify(w)):w&&typeof w!="string"&&!(typeof Blob<"u"&&w instanceof Blob)&&!(w instanceof ArrayBuffer)&&!(typeof FormData<"u"&&w instanceof FormData)?j=JSON.stringify(w):j=w;let B=P;C&&(f=new AbortController,u=setTimeout(()=>f.abort(),C),P?(B=f.signal,P.addEventListener("abort",()=>f.abort())):B=f.signal);const U=yield this.fetch($.toString(),{method:v||"POST",headers:Object.assign(Object.assign(Object.assign({},k),this.headers),o),body:j,signal:B}).catch(Q=>{throw new vbe(Q)}),q=U.headers.get("x-relay-error");if(q&&q==="true")throw new aq(U);if(!U.ok)throw new lq(U);let H=((l=U.headers.get("Content-Type"))!==null&&l!==void 0?l:"text/plain").split(";")[0].trim(),te;return H==="application/json"?te=yield U.json():H==="application/octet-stream"||H==="application/pdf"?te=yield U.blob():H==="text/event-stream"?te=U:H==="multipart/form-data"?te=yield U.formData():te=yield U.text(),{data:te,error:null,response:U}}catch(o){return{data:null,error:o,response:o instanceof lq||o instanceof aq?o.context:void 0}}finally{u&&clearTimeout(u)}})}}var bbe=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},wbe=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let l=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{let f=null,o=null,v=null,w=u.status,P=u.statusText;if(u.ok){var C,k;if(r.method!=="HEAD"){var L;const U=await u.text();U===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((L=r.headers.get("Accept"))===null||L===void 0)&&L.includes("application/vnd.pgrst.plan+text"))?o=U:o=JSON.parse(U))}const j=(C=r.headers.get("Prefer"))===null||C===void 0?void 0:C.match(/count=(exact|planned|estimated)/),B=(k=u.headers.get("content-range"))===null||k===void 0?void 0:k.split("/");j&&B&&B.length>1&&(v=parseInt(B[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(o)&&(o.length>1?(f={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,v=null,w=406,P="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var $;const j=await u.text();try{f=JSON.parse(j),Array.isArray(f)&&u.status===404&&(o=[],f=null,w=200,P="OK")}catch{u.status===404&&j===""?(w=204,P="No Content"):f={message:j}}if(f&&r.isMaybeSingle&&(!(f==null||($=f.details)===null||$===void 0)&&$.includes("0 rows"))&&(f=null,w=200,P="OK"),f&&r.shouldThrowOnError)throw new bbe(f)}return{error:f,data:o,count:v,status:w,statusText:P}});return this.shouldThrowOnError||(l=l.catch(u=>{var f;let o="";const v=u==null?void 0:u.cause;if(v){var w,P,C,k;const $=(w=v==null?void 0:v.message)!==null&&w!==void 0?w:"",j=(P=v==null?void 0:v.code)!==null&&P!==void 0?P:"";o=`${(C=u==null?void 0:u.name)!==null&&C!==void 0?C:"FetchError"}: ${u==null?void 0:u.message}`,o+=`

Caused by: ${(k=v==null?void 0:v.name)!==null&&k!==void 0?k:"Error"}: ${$}`,j&&(o+=` (${j})`),v!=null&&v.stack&&(o+=`
${v.stack}`)}else{var L;o=(L=u==null?void 0:u.stack)!==null&&L!==void 0?L:""}return{error:{message:`${(f=u==null?void 0:u.name)!==null&&f!==void 0?f:"FetchError"}: ${u==null?void 0:u.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),l.then(e,t)}returns(){return this}overrideTypes(){return this}},Sbe=class extends wbe{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:l=n}={}){const u=l?`${l}.order`:"order",f=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${f?`${f},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const l=typeof n>"u"?"offset":`${n}.offset`,u=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(l,`${e}`),this.url.searchParams.set(u,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:l=!1,format:u="text"}={}){var f;const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,l?"wal":null].filter(Boolean).join("|"),v=(f=this.headers.get("Accept"))!==null&&f!==void 0?f:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${v}"; options=${o};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const cq=new RegExp("[,()]");var mv=class extends Sbe{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&cq.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}notIn(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&cq.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`not.in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let l="";n==="plain"?l="pl":n==="phrase"?l="ph":n==="websearch"&&(l="w");const u=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${l}fts${u}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}},Tbe=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:r=!1,count:n}=t??{},l=r?"HEAD":"GET";let u=!1;const f=(e??"*").split("").map(w=>/\s/.test(w)&&!u?"":(w==='"'&&(u=!u),w)).join(""),{url:o,headers:v}=this.cloneRequestState();return o.searchParams.set("select",f),n&&v.append("Prefer",`count=${n}`),new mv({method:l,url:o,headers:v,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var n;const l="POST",{url:u,headers:f}=this.cloneRequestState();if(t&&f.append("Prefer",`count=${t}`),r||f.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((v,w)=>v.concat(Object.keys(w)),[]);if(o.length>0){const v=[...new Set(o)].map(w=>`"${w}"`);u.searchParams.set("columns",v.join(","))}}return new mv({method:l,url:u,headers:f,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:l=!0}={}){var u;const f="POST",{url:o,headers:v}=this.cloneRequestState();if(v.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&o.searchParams.set("on_conflict",t),n&&v.append("Prefer",`count=${n}`),l||v.append("Prefer","missing=default"),Array.isArray(e)){const w=e.reduce((P,C)=>P.concat(Object.keys(C)),[]);if(w.length>0){const P=[...new Set(w)].map(C=>`"${C}"`);o.searchParams.set("columns",P.join(","))}}return new mv({method:f,url:o,headers:v,schema:this.schema,body:e,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(e,{count:t}={}){var r;const n="PATCH",{url:l,headers:u}=this.cloneRequestState();return t&&u.append("Prefer",`count=${t}`),new mv({method:n,url:l,headers:u,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE",{url:n,headers:l}=this.cloneRequestState();return e&&l.append("Prefer",`count=${e}`),new mv({method:r,url:n,headers:l,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}},Ebe=class XQ{constructor(t,{headers:r={},schema:n,fetch:l}={}){this.url=t,this.headers=new Headers(r),this.schemaName=n,this.fetch=l}from(t){if(!t||typeof t!="string"||t.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Tbe(new URL(`${this.url}/${t}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new XQ(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:n=!1,get:l=!1,count:u}={}){var f;let o;const v=new URL(`${this.url}/rpc/${t}`);let w;const P=L=>L!==null&&typeof L=="object"&&(!Array.isArray(L)||L.some(P)),C=n&&Object.values(r).some(P);C?(o="POST",w=r):n||l?(o=n?"HEAD":"GET",Object.entries(r).filter(([L,$])=>$!==void 0).map(([L,$])=>[L,Array.isArray($)?`{${$.join(",")}}`:`${$}`]).forEach(([L,$])=>{v.searchParams.append(L,$)})):(o="POST",w=r);const k=new Headers(this.headers);return C?k.set("Prefer",u?`count=${u},return=minimal`:"return=minimal"):u&&k.set("Prefer",`count=${u}`),new mv({method:o,url:v,headers:k,schema:this.schemaName,body:w,fetch:(f=this.fetch)!==null&&f!==void 0?f:fetch})}};class Abe{constructor(){}static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const n=r.versions;if(n&&n.node){const l=n.node,u=parseInt(l.replace(/^v/,"").split(".")[0]);return u>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${u} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${u} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let r=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(r+=`

Suggested solution: ${t.workaround}`),new Error(r)}static createWebSocket(t,r){const n=this.getWebSocketConstructor();return new n(t,r)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Pbe="2.90.1",Cbe=`realtime-js/${Pbe}`,KQ="1.0.0",Ibe="2.0.0",uq=KQ,PN=1e4,Obe=1e3,kbe=100;var ap;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(ap||(ap={}));var Ns;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Ns||(Ns={}));var Mu;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Mu||(Mu={}));var CN;(function(e){e.websocket="websocket"})(CN||(CN={}));var wg;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(wg||(wg={}));class Rbe{constructor(t){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=t??[]}encode(t,r){if(t.event===this.BROADCAST_EVENT&&!(t.payload instanceof ArrayBuffer)&&typeof t.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(t));let n=[t.join_ref,t.ref,t.topic,t.event,t.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(t){var r;return this._isArrayBuffer((r=t.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(t):this._encodeJsonUserBroadcastPush(t)}_encodeBinaryUserBroadcastPush(t){var r,n;const l=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(t,this.BINARY_ENCODING,l)}_encodeJsonUserBroadcastPush(t){var r,n;const l=(n=(r=t.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},f=new TextEncoder().encode(JSON.stringify(l)).buffer;return this._encodeUserBroadcastPush(t,this.JSON_ENCODING,f)}_encodeUserBroadcastPush(t,r,n){var l,u;const f=t.topic,o=(l=t.ref)!==null&&l!==void 0?l:"",v=(u=t.join_ref)!==null&&u!==void 0?u:"",w=t.payload.event,P=this.allowedMetadataKeys?this._pick(t.payload,this.allowedMetadataKeys):{},C=Object.keys(P).length===0?"":JSON.stringify(P);if(v.length>255)throw new Error(`joinRef length ${v.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(f.length>255)throw new Error(`topic length ${f.length} exceeds maximum of 255`);if(w.length>255)throw new Error(`userEvent length ${w.length} exceeds maximum of 255`);if(C.length>255)throw new Error(`metadata length ${C.length} exceeds maximum of 255`);const k=this.USER_BROADCAST_PUSH_META_LENGTH+v.length+o.length+f.length+w.length+C.length,L=new ArrayBuffer(this.HEADER_LENGTH+k);let $=new DataView(L),j=0;$.setUint8(j++,this.KINDS.userBroadcastPush),$.setUint8(j++,v.length),$.setUint8(j++,o.length),$.setUint8(j++,f.length),$.setUint8(j++,w.length),$.setUint8(j++,C.length),$.setUint8(j++,r),Array.from(v,U=>$.setUint8(j++,U.charCodeAt(0))),Array.from(o,U=>$.setUint8(j++,U.charCodeAt(0))),Array.from(f,U=>$.setUint8(j++,U.charCodeAt(0))),Array.from(w,U=>$.setUint8(j++,U.charCodeAt(0))),Array.from(C,U=>$.setUint8(j++,U.charCodeAt(0)));var B=new Uint8Array(L.byteLength+n.byteLength);return B.set(new Uint8Array(L),0),B.set(new Uint8Array(n),L.byteLength),B.buffer}decode(t,r){if(this._isArrayBuffer(t)){let n=this._binaryDecode(t);return r(n)}if(typeof t=="string"){const n=JSON.parse(t),[l,u,f,o,v]=n;return r({join_ref:l,ref:u,topic:f,event:o,payload:v})}return r({})}_binaryDecode(t){const r=new DataView(t),n=r.getUint8(0),l=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(t,r,l)}}_decodeUserBroadcast(t,r,n){const l=r.getUint8(1),u=r.getUint8(2),f=r.getUint8(3),o=r.getUint8(4);let v=this.HEADER_LENGTH+4;const w=n.decode(t.slice(v,v+l));v=v+l;const P=n.decode(t.slice(v,v+u));v=v+u;const C=n.decode(t.slice(v,v+f));v=v+f;const k=t.slice(v,t.byteLength),L=o===this.JSON_ENCODING?JSON.parse(n.decode(k)):k,$={type:this.BROADCAST_EVENT,event:P,payload:L};return f>0&&($.meta=JSON.parse(C)),{join_ref:null,ref:null,topic:w,event:this.BROADCAST_EVENT,payload:$}}_isArrayBuffer(t){var r;return t instanceof ArrayBuffer||((r=t==null?void 0:t.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(t,r){return!t||typeof t!="object"?{}:Object.fromEntries(Object.entries(t).filter(([n])=>r.includes(n)))}}class YQ{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var so;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(so||(so={}));const dq=(e,t,r={})=>{var n;const l=(n=r.skipTypes)!==null&&n!==void 0?n:[];return t?Object.keys(t).reduce((u,f)=>(u[f]=Mbe(f,e,t,l),u),{}):{}},Mbe=(e,t,r,n)=>{const l=t.find(o=>o.name===e),u=l==null?void 0:l.type,f=r[e];return u&&!n.includes(u)?JQ(u,f):IN(f)},JQ=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return Nbe(t,r)}switch(e){case so.bool:return Dbe(t);case so.float4:case so.float8:case so.int2:case so.int4:case so.int8:case so.numeric:case so.oid:return Lbe(t);case so.json:case so.jsonb:return jbe(t);case so.timestamp:return zbe(t);case so.abstime:case so.date:case so.daterange:case so.int4range:case so.int8range:case so.money:case so.reltime:case so.text:case so.time:case so.timestamptz:case so.timetz:case so.tsrange:case so.tstzrange:return IN(t);default:return IN(t)}},IN=e=>e,Dbe=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Lbe=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},jbe=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch{return e}return e},Nbe=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,n=e[r];if(e[0]==="{"&&n==="}"){let u;const f=e.slice(1,r);try{u=JSON.parse("["+f+"]")}catch{u=f?f.split(","):[]}return u.map(o=>JQ(t,o))}return e},zbe=e=>typeof e=="string"?e.replace(" ","T"):e,QQ=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class ZD{constructor(t,r,n={},l=PN){this.channel=t,this.event=r,this.payload=n,this.timeout=l,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var n;return this._hasReceived(t)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(n=>n.status===t).forEach(n=>n.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var hq;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(hq||(hq={}));class z1{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},l=>{const{onJoin:u,onLeave:f,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=z1.syncState(this.state,l,u,f),this.pendingDiffs.forEach(v=>{this.state=z1.syncDiff(this.state,v,u,f)}),this.pendingDiffs=[],o()}),this.channel._on(n.diff,{},l=>{const{onJoin:u,onLeave:f,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(l):(this.state=z1.syncDiff(this.state,l,u,f),o())}),this.onJoin((l,u,f)=>{this.channel._trigger("presence",{event:"join",key:l,currentPresences:u,newPresences:f})}),this.onLeave((l,u,f)=>{this.channel._trigger("presence",{event:"leave",key:l,currentPresences:u,leftPresences:f})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,n,l){const u=this.cloneDeep(t),f=this.transformState(r),o={},v={};return this.map(u,(w,P)=>{f[w]||(v[w]=P)}),this.map(f,(w,P)=>{const C=u[w];if(C){const k=P.map(B=>B.presence_ref),L=C.map(B=>B.presence_ref),$=P.filter(B=>L.indexOf(B.presence_ref)<0),j=C.filter(B=>k.indexOf(B.presence_ref)<0);$.length>0&&(o[w]=$),j.length>0&&(v[w]=j)}else o[w]=P}),this.syncDiff(u,{joins:o,leaves:v},n,l)}static syncDiff(t,r,n,l){const{joins:u,leaves:f}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),l||(l=()=>{}),this.map(u,(o,v)=>{var w;const P=(w=t[o])!==null&&w!==void 0?w:[];if(t[o]=this.cloneDeep(v),P.length>0){const C=t[o].map(L=>L.presence_ref),k=P.filter(L=>C.indexOf(L.presence_ref)<0);t[o].unshift(...k)}n(o,P,v)}),this.map(f,(o,v)=>{let w=t[o];if(!w)return;const P=v.map(C=>C.presence_ref);w=w.filter(C=>P.indexOf(C.presence_ref)<0),t[o]=w,l(o,w,v),w.length===0&&delete t[o]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(n=>r(n,t[n]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,n)=>{const l=t[n];return"metas"in l?r[n]=l.metas.map(u=>(u.presence_ref=u.phx_ref,delete u.phx_ref,delete u.phx_ref_prev,u)):r[n]=l,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var fq;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(fq||(fq={}));var F1;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(F1||(F1={}));var Eh;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Eh||(Eh={}));class kv{constructor(t,r={config:{}},n){var l,u;if(this.topic=t,this.params=r,this.socket=n,this.bindings={},this.state=Ns.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new ZD(this,Mu.join,this.params,this.timeout),this.rejoinTimer=new YQ(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ns.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(f=>f.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ns.closed,this.socket._remove(this)}),this._onError(f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=Ns.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ns.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",f=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,f),this.state=Ns.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Mu.reply,{},(f,o)=>{this._trigger(this._replyEventName(o),f)}),this.presence=new z1(this),this.broadcastEndpointURL=QQ(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((u=(l=this.params.config)===null||l===void 0?void 0:l.broadcast)===null||u===void 0)&&u.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,r=this.timeout){var n,l,u;if(this.socket.isConnected()||this.socket.connect(),this.state==Ns.closed){const{config:{broadcast:f,presence:o,private:v}}=this.params,w=(l=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(L=>L.filter))!==null&&l!==void 0?l:[],P=!!this.bindings[F1.PRESENCE]&&this.bindings[F1.PRESENCE].length>0||((u=this.params.config.presence)===null||u===void 0?void 0:u.enabled)===!0,C={},k={broadcast:f,presence:Object.assign(Object.assign({},o),{enabled:P}),postgres_changes:w,private:v};this.socket.accessTokenValue&&(C.access_token=this.socket.accessTokenValue),this._onError(L=>t==null?void 0:t(Eh.CHANNEL_ERROR,L)),this._onClose(()=>t==null?void 0:t(Eh.CLOSED)),this.updateJoinPayload(Object.assign({config:k},C)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:L})=>{var $;if(this.socket._isManualToken()||this.socket.setAuth(),L===void 0){t==null||t(Eh.SUBSCRIBED);return}else{const j=this.bindings.postgres_changes,B=($=j==null?void 0:j.length)!==null&&$!==void 0?$:0,U=[];for(let q=0;q<B;q++){const H=j[q],{filter:{event:te,schema:Q,table:ae,filter:ue}}=H,me=L&&L[q];if(me&&me.event===te&&kv.isFilterValueEqual(me.schema,Q)&&kv.isFilterValueEqual(me.table,ae)&&kv.isFilterValueEqual(me.filter,ue))U.push(Object.assign(Object.assign({},H),{id:me.id}));else{this.unsubscribe(),this.state=Ns.errored,t==null||t(Eh.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=U,t&&t(Eh.SUBSCRIBED);return}}).receive("error",L=>{this.state=Ns.errored,t==null||t(Eh.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(L).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Eh.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,n){return this.state===Ns.joined&&t===F1.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(t,r,n)}async httpSend(t,r,n={}){var l;if(r==null)return Promise.reject("Payload is required for httpSend()");const u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const f={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:r,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,f,(l=n.timeout)!==null&&l!==void 0?l:this.timeout);if(o.status===202)return{success:!0};let v=o.statusText;try{const w=await o.json();v=w.error||w.message||v}catch{}return Promise.reject(new Error(v))}async send(t,r={}){var n,l;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:u,payload:f}=t,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const v={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:u,payload:f,private:this.private}]})};try{const w=await this._fetchWithTimeout(this.broadcastEndpointURL,v,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((l=w.body)===null||l===void 0?void 0:l.cancel()),w.ok?"ok":"error"}catch(w){return w.name==="AbortError"?"timed out":"error"}}else return new Promise(u=>{var f,o,v;const w=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((v=(o=(f=this.params)===null||f===void 0?void 0:f.config)===null||o===void 0?void 0:o.broadcast)===null||v===void 0)&&v.ack)&&u("ok"),w.receive("ok",()=>u("ok")),w.receive("error",()=>u("error")),w.receive("timeout",()=>u("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ns.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Mu.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(l=>{n=new ZD(this,Mu.leave,{},t),n.receive("ok",()=>{r(),l("ok")}).receive("timeout",()=>{r(),l("timed out")}).receive("error",()=>{l("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ns.closed,this.bindings={}}async _fetchWithTimeout(t,r,n){const l=new AbortController,u=setTimeout(()=>l.abort(),n),f=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:l.signal}));return clearTimeout(u),f}_push(t,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let l=new ZD(this,t,r,n);return this._canPush()?l.send():this._addToPushBuffer(l),l}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>kbe){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(t,r,n){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,n){var l,u;const f=t.toLocaleLowerCase(),{close:o,error:v,leave:w,join:P}=Mu;if(n&&[o,v,w,P].indexOf(f)>=0&&n!==this._joinRef())return;let k=this._onMessage(f,r,n);if(r&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?(l=this.bindings.postgres_changes)===null||l===void 0||l.filter(L=>{var $,j,B;return(($=L.filter)===null||$===void 0?void 0:$.event)==="*"||((B=(j=L.filter)===null||j===void 0?void 0:j.event)===null||B===void 0?void 0:B.toLocaleLowerCase())===f}).map(L=>L.callback(k,n)):(u=this.bindings[f])===null||u===void 0||u.filter(L=>{var $,j,B,U,q,H,te,Q;if(["broadcast","presence","postgres_changes"].includes(f))if("id"in L){const ae=L.id,ue=($=L.filter)===null||$===void 0?void 0:$.event;return ae&&((j=r.ids)===null||j===void 0?void 0:j.includes(ae))&&(ue==="*"||(ue==null?void 0:ue.toLocaleLowerCase())===((B=r.data)===null||B===void 0?void 0:B.type.toLocaleLowerCase()))&&(!(!((U=L.filter)===null||U===void 0)&&U.table)||L.filter.table===((q=r.data)===null||q===void 0?void 0:q.table))}else{const ae=(te=(H=L==null?void 0:L.filter)===null||H===void 0?void 0:H.event)===null||te===void 0?void 0:te.toLocaleLowerCase();return ae==="*"||ae===((Q=r==null?void 0:r.event)===null||Q===void 0?void 0:Q.toLocaleLowerCase())}else return L.type.toLocaleLowerCase()===f}).map(L=>{if(typeof k=="object"&&"ids"in k){const $=k.data,{schema:j,table:B,commit_timestamp:U,type:q,errors:H}=$;k=Object.assign(Object.assign({},{schema:j,table:B,commit_timestamp:U,eventType:q,new:{},old:{},errors:H}),this._getPayloadRecords($))}L.callback(k,n)})}_isClosed(){return this.state===Ns.closed}_isJoined(){return this.state===Ns.joined}_isJoining(){return this.state===Ns.joining}_isLeaving(){return this.state===Ns.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,n){const l=t.toLocaleLowerCase(),u={type:l,filter:r,callback:n};return this.bindings[l]?this.bindings[l].push(u):this.bindings[l]=[u],this}_off(t,r){const n=t.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(l=>{var u;return!(((u=l.type)===null||u===void 0?void 0:u.toLocaleLowerCase())===n&&kv.isEqual(l.filter,r))})),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const n in t)if(t[n]!==r[n])return!1;return!0}static isFilterValueEqual(t,r){return(t??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Mu.close,{},t)}_onError(t){this._on(Mu.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ns.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=dq(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=dq(t.columns,t.old_record)),r}}const XD=()=>{},nP={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Fbe=[1e3,2e3,5e3,1e4],Bbe=1e4,$be=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Vbe{constructor(t,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=PN,this.transport=null,this.heartbeatIntervalMs=nP.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=XD,this.ref=0,this.reconnectTimer=null,this.vsn=uq,this.logger=XD,this.conn=null,this.sendBuffer=[],this.serializer=new Rbe,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=l=>l?(...u)=>l(...u):(...u)=>fetch(...u),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${t}/${CN.websocket}`,this.httpEndpoint=QQ(t),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Abe.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const r=t.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(t,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(t?this.conn.close(t,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,n){this.logger(t,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case ap.connecting:return wg.Connecting;case ap.open:return wg.Open;case ap.closing:return wg.Closing;default:return wg.Closed}}isConnected(){return this.connectionState()===wg.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,r={config:{}}){const n=`realtime:${t}`,l=this.getChannels().find(u=>u.topic===n);if(l)return l;{const u=new kv(`realtime:${t}`,r,this);return this.channels.push(u),u}}push(t){const{topic:r,event:n,payload:l,ref:u}=t,f=()=>{this.encode(t,o=>{var v;(v=this.conn)===null||v===void 0||v.send(o)})};this.log("push",`${r} ${n} (${u})`,l),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Obe,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},nP.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(n=>n.topic===t&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const w=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",w)}catch(P){this.log("error","error in heartbeat callback",P)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:l,payload:u,ref:f}=r,o=f?`(${f})`:"",v=u.status||"";this.log("receive",`${v} ${n} ${l} ${o}`.trim(),u),this.channels.filter(w=>w._isMember(n)).forEach(w=>w._trigger(l,u,f)),this._triggerStateCallbacks("message",r)})}_clearTimer(t){var r;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t),this.conn.readyState===ap.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===ap.open||this.conn.readyState===ap.connecting)try{this.conn.close()}catch(t){this.log("error","Error closing connection",t)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(t){var r;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Mu.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const n=t.match(/\?/)?"&":"?",l=new URLSearchParams(r);return`${t}${n}${l}`}_workerObjectUrl(t){let r;if(t)r=t;else{const n=new Blob([$be],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(t,r=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(t=null){let r,n=!1;if(t)r=t,n=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(l){this.log("error","Error fetching access token from callback",l),r=this.accessTokenValue}else r=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(l=>{const u={access_token:r,version:Cbe};r&&l.updateJoinPayload(u),l.joinedOnce&&l._isJoined()&&l._push(Mu.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${t}`,r)})}_triggerStateCallbacks(t,r){try{this.stateChangeCallbacks[t].forEach(n=>{try{n(r)}catch(l){this.log("error",`error in ${t} callback`,l)}})}catch(n){this.log("error",`error triggering ${t} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new YQ(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},nP.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var r,n,l,u,f,o,v,w,P,C,k,L;switch(this.transport=(r=t==null?void 0:t.transport)!==null&&r!==void 0?r:null,this.timeout=(n=t==null?void 0:t.timeout)!==null&&n!==void 0?n:PN,this.heartbeatIntervalMs=(l=t==null?void 0:t.heartbeatIntervalMs)!==null&&l!==void 0?l:nP.HEARTBEAT_INTERVAL,this.worker=(u=t==null?void 0:t.worker)!==null&&u!==void 0?u:!1,this.accessToken=(f=t==null?void 0:t.accessToken)!==null&&f!==void 0?f:null,this.heartbeatCallback=(o=t==null?void 0:t.heartbeatCallback)!==null&&o!==void 0?o:XD,this.vsn=(v=t==null?void 0:t.vsn)!==null&&v!==void 0?v:uq,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(w=t==null?void 0:t.reconnectAfterMs)!==null&&w!==void 0?w:$=>Fbe[$-1]||Bbe,this.vsn){case KQ:this.encode=(P=t==null?void 0:t.encode)!==null&&P!==void 0?P:($,j)=>j(JSON.stringify($)),this.decode=(C=t==null?void 0:t.decode)!==null&&C!==void 0?C:($,j)=>j(JSON.parse($));break;case Ibe:this.encode=(k=t==null?void 0:t.encode)!==null&&k!==void 0?k:this.serializer.encode.bind(this.serializer),this.decode=(L=t==null?void 0:t.decode)!==null&&L!==void 0?L:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}var CS=class extends Error{constructor(e,t){var r;super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown=t.icebergType==="CommitStateUnknownException"||[500,502,504].includes(t.status)&&((r=t.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function Ube(e,t,r){const n=new URL(t,e);if(r)for(const[l,u]of Object.entries(r))u!==void 0&&n.searchParams.set(l,u);return n.toString()}async function Gbe(e){return!e||e.type==="none"?{}:e.type==="bearer"?{Authorization:`Bearer ${e.token}`}:e.type==="header"?{[e.name]:e.value}:e.type==="custom"?await e.getHeaders():{}}function qbe(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:l,body:u,headers:f}){const o=Ube(e.baseUrl,n,l),v=await Gbe(e.auth),w=await t(o,{method:r,headers:{...u?{"Content-Type":"application/json"}:{},...v,...f},body:u?JSON.stringify(u):void 0}),P=await w.text(),C=(w.headers.get("content-type")||"").includes("application/json"),k=C&&P?JSON.parse(P):P;if(!w.ok){const L=C?k:void 0,$=L==null?void 0:L.error;throw new CS(($==null?void 0:$.message)??`Request failed with status ${w.status}`,{status:w.status,icebergType:$==null?void 0:$.type,icebergCode:$==null?void 0:$.code,details:L})}return{status:w.status,headers:w.headers,data:k}}}}function iP(e){return e.join("")}var Hbe=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:iP(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(e,t){const r={namespace:e.namespace,properties:t==null?void 0:t.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${iP(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${iP(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${iP(e.namespace)}`}),!0}catch(t){if(t instanceof CS&&t.status===404)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(r){if(r instanceof CS&&r.status===409)return;throw r}}};function ev(e){return e.join("")}var Wbe=class{constructor(e,t="",r){this.client=e,this.prefix=t,this.accessDelegation=r}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ev(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ev(e.namespace)}/tables`,body:t,headers:r})).data.metadata}async updateTable(e,t){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${ev(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${ev(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String((t==null?void 0:t.purge)??!1)}})}async loadTable(e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${ev(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${ev(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(r){if(r instanceof CS&&r.status===404)return!1;throw r}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(r){if(r instanceof CS&&r.status===409)return await this.loadTable({namespace:e.namespace,name:t.name});throw r}}},Zbe=class{constructor(e){var n;let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const r=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=qbe({baseUrl:r,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=(n=e.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new Hbe(this.client,t),this.tableOps=new Wbe(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},DO=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function Fo(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}var Xbe=class extends DO{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},ON=class extends DO{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}};const SB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),Kbe=()=>Response,kN=e=>{if(Array.isArray(e))return e.map(r=>kN(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,n])=>{const l=r.replace(/([-_][a-z])/gi,u=>u.toUpperCase().replace(/[-_]/g,""));t[l]=kN(n)}),t},Ybe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Jbe=e=>!e||typeof e!="string"||e.length===0||e.length>100||e.trim()!==e||e.includes("/")||e.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(e);function IS(e){"@babel/helpers - typeof";return IS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},IS(e)}function Qbe(e,t){if(IS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(IS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ewe(e){var t=Qbe(e,"string");return IS(t)=="symbol"?t:t+""}function twe(e,t,r){return(t=ewe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function wn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pq(Object(r),!0).forEach(function(n){twe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const KD=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},rwe=async(e,t,r)=>{e instanceof await Kbe()&&!(r!=null&&r.noResolveJson)?e.json().then(n=>{const l=e.status||500,u=(n==null?void 0:n.statusCode)||l+"";t(new Xbe(KD(n),l,u))}).catch(n=>{t(new ON(KD(n),n))}):t(new ON(KD(e),e))},nwe=(e,t,r,n)=>{const l={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!n?l:(Ybe(n)?(l.headers=wn({"Content-Type":"application/json"},t==null?void 0:t.headers),l.body=JSON.stringify(n)):l.body=n,t!=null&&t.duplex&&(l.duplex=t.duplex),wn(wn({},l),r))};async function FT(e,t,r,n,l,u){return new Promise((f,o)=>{e(r,nwe(t,n,l,u)).then(v=>{if(!v.ok)throw v;return n!=null&&n.noResolveJson?v:v.json()}).then(v=>f(v)).catch(v=>rwe(v,o,n))})}async function OS(e,t,r,n){return FT(e,"GET",t,r,n)}async function Iu(e,t,r,n,l){return FT(e,"POST",t,n,l,r)}async function RN(e,t,r,n,l){return FT(e,"PUT",t,n,l,r)}async function iwe(e,t,r,n){return FT(e,"HEAD",t,wn(wn({},r),{},{noResolveJson:!0}),n)}async function TB(e,t,r,n,l){return FT(e,"DELETE",t,n,l,r)}var owe=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){var e=this;try{return{data:(await e.downloadFn()).body,error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Fo(t))return{data:null,error:t};throw t}}};let eee;eee=Symbol.toStringTag;var swe=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[eee]="BlobDownloadBuilder",this.promise=null}asStream(){return new owe(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var e=this;try{return{data:await(await e.downloadFn()).blob(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(Fo(t))return{data:null,error:t};throw t}}};const awe={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},mq={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var lwe=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=SB(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(e,t,r,n){var l=this;try{let u;const f=wn(wn({},mq),n);let o=wn(wn({},l.headers),e==="POST"&&{"x-upsert":String(f.upsert)});const v=f.metadata;typeof Blob<"u"&&r instanceof Blob?(u=new FormData,u.append("cacheControl",f.cacheControl),v&&u.append("metadata",l.encodeMetadata(v)),u.append("",r)):typeof FormData<"u"&&r instanceof FormData?(u=r,u.has("cacheControl")||u.append("cacheControl",f.cacheControl),v&&!u.has("metadata")&&u.append("metadata",l.encodeMetadata(v))):(u=r,o["cache-control"]=`max-age=${f.cacheControl}`,o["content-type"]=f.contentType,v&&(o["x-metadata"]=l.toBase64(l.encodeMetadata(v))),(typeof ReadableStream<"u"&&u instanceof ReadableStream||u&&typeof u=="object"&&"pipe"in u&&typeof u.pipe=="function")&&!f.duplex&&(f.duplex="half")),n!=null&&n.headers&&(o=wn(wn({},o),n.headers));const w=l._removeEmptyFolders(t),P=l._getFinalPath(w),C=await(e=="PUT"?RN:Iu)(l.fetch,`${l.url}/object/${P}`,u,wn({headers:o},f!=null&&f.duplex?{duplex:f.duplex}:{}));return{data:{path:w,id:C.Id,fullPath:C.Key},error:null}}catch(u){if(l.shouldThrowOnError)throw u;if(Fo(u))return{data:null,error:u};throw u}}async upload(e,t,r){return this.uploadOrUpdate("POST",e,t,r)}async uploadToSignedUrl(e,t,r,n){var l=this;const u=l._removeEmptyFolders(e),f=l._getFinalPath(u),o=new URL(l.url+`/object/upload/sign/${f}`);o.searchParams.set("token",t);try{let v;const w=wn({upsert:mq.upsert},n),P=wn(wn({},l.headers),{"x-upsert":String(w.upsert)});return typeof Blob<"u"&&r instanceof Blob?(v=new FormData,v.append("cacheControl",w.cacheControl),v.append("",r)):typeof FormData<"u"&&r instanceof FormData?(v=r,v.append("cacheControl",w.cacheControl)):(v=r,P["cache-control"]=`max-age=${w.cacheControl}`,P["content-type"]=w.contentType),{data:{path:u,fullPath:(await RN(l.fetch,o.toString(),v,{headers:P})).Key},error:null}}catch(v){if(l.shouldThrowOnError)throw v;if(Fo(v))return{data:null,error:v};throw v}}async createSignedUploadUrl(e,t){var r=this;try{let n=r._getFinalPath(e);const l=wn({},r.headers);t!=null&&t.upsert&&(l["x-upsert"]="true");const u=await Iu(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:l}),f=new URL(r.url+u.url),o=f.searchParams.get("token");if(!o)throw new DO("No token returned by API");return{data:{signedUrl:f.toString(),path:e,token:o},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Fo(n))return{data:null,error:n};throw n}}async update(e,t,r){return this.uploadOrUpdate("PUT",e,t,r)}async move(e,t,r){var n=this;try{return{data:await Iu(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(Fo(l))return{data:null,error:l};throw l}}async copy(e,t,r){var n=this;try{return{data:{path:(await Iu(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(Fo(l))return{data:null,error:l};throw l}}async createSignedUrl(e,t,r){var n=this;try{let l=n._getFinalPath(e),u=await Iu(n.fetch,`${n.url}/object/sign/${l}`,wn({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:n.headers});const f=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return u={signedUrl:encodeURI(`${n.url}${u.signedURL}${f}`)},{data:u,error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(Fo(l))return{data:null,error:l};throw l}}async createSignedUrls(e,t,r){var n=this;try{const l=await Iu(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:t,paths:e},{headers:n.headers}),u=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:l.map(f=>wn(wn({},f),{},{signedUrl:f.signedURL?encodeURI(`${n.url}${f.signedURL}${u}`):null})),error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(Fo(l))return{data:null,error:l};throw l}}download(e,t){const r=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),l=n?`?${n}`:"",u=this._getFinalPath(e),f=()=>OS(this.fetch,`${this.url}/${r}/${u}${l}`,{headers:this.headers,noResolveJson:!0});return new swe(f,this.shouldThrowOnError)}async info(e){var t=this;const r=t._getFinalPath(e);try{return{data:kN(await OS(t.fetch,`${t.url}/object/info/${r}`,{headers:t.headers})),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Fo(n))return{data:null,error:n};throw n}}async exists(e){var t=this;const r=t._getFinalPath(e);try{return await iwe(t.fetch,`${t.url}/object/${r}`,{headers:t.headers}),{data:!0,error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(Fo(n)&&n instanceof ON){const l=n.originalError;if([400,404].includes(l==null?void 0:l.status))return{data:!1,error:n}}throw n}}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],l=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";l!==""&&n.push(l);const u=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",f=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});f!==""&&n.push(f);let o=n.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${r}${o}`)}}}async remove(e){var t=this;try{return{data:await TB(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}async list(e,t,r){var n=this;try{const l=wn(wn(wn({},awe),t),{},{prefix:e||""});return{data:await Iu(n.fetch,`${n.url}/object/list/${n.bucketId}`,l,{headers:n.headers},r),error:null}}catch(l){if(n.shouldThrowOnError)throw l;if(Fo(l))return{data:null,error:l};throw l}}async listV2(e,t){var r=this;try{const n=wn({},e);return{data:await Iu(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},t),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Fo(n))return{data:null,error:n};throw n}}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const tee="2.90.1",ree={"X-Client-Info":`storage-js/${tee}`};var cwe=class{constructor(e,t={},r,n){this.shouldThrowOnError=!1;const l=new URL(e);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(l.hostname)&&!l.hostname.includes("storage.supabase.")&&(l.hostname=l.hostname.replace("supabase.","storage.supabase.")),this.url=l.href.replace(/\/$/,""),this.headers=wn(wn({},ree),t),this.fetch=SB(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(e){var t=this;try{const r=t.listBucketOptionsToQueryString(e);return{data:await OS(t.fetch,`${t.url}/bucket${r}`,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}async getBucket(e){var t=this;try{return{data:await OS(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}async createBucket(e,t={public:!1}){var r=this;try{return{data:await Iu(r.fetch,`${r.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Fo(n))return{data:null,error:n};throw n}}async updateBucket(e,t){var r=this;try{return{data:await RN(r.fetch,`${r.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Fo(n))return{data:null,error:n};throw n}}async emptyBucket(e){var t=this;try{return{data:await Iu(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await TB(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},uwe=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=wn(wn({},ree),t),this.fetch=SB(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await Iu(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}async listBuckets(e){var t=this;try{const r=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&r.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&r.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&r.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&r.set("sortOrder",e.sortOrder),e!=null&&e.search&&r.set("search",e.search);const n=r.toString(),l=n?`${t.url}/bucket?${n}`:`${t.url}/bucket`;return{data:await OS(t.fetch,l,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await TB(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Fo(r))return{data:null,error:r};throw r}}from(e){var t=this;if(!Jbe(e))throw new DO("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new Zbe({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(l,u){const f=l[u];return typeof f!="function"?f:async(...o)=>{try{return{data:await f.apply(l,o),error:null}}catch(v){if(n)throw v;return{data:null,error:v}}}}})}};const EB={"X-Client-Info":`storage-js/${tee}`,"Content-Type":"application/json"};var nee=class extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function oc(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}var YD=class extends nee{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},dwe=class extends nee{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}};const AB=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),hwe=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},gq=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),fwe=async(e,t,r)=>{if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(r!=null&&r.noResolveJson)){const n=e.status||500,l=e;if(typeof l.json=="function")l.json().then(u=>{const f=(u==null?void 0:u.statusCode)||(u==null?void 0:u.code)||n+"";t(new YD(gq(u),n,f))}).catch(()=>{const u=n+"";t(new YD(l.statusText||`HTTP ${n} error`,n,u))});else{const u=n+"";t(new YD(l.statusText||`HTTP ${n} error`,n,u))}}else t(new dwe(gq(e),e))},pwe=(e,t,r,n)=>{const l={method:e,headers:(t==null?void 0:t.headers)||{}};return n?(hwe(n)?(l.headers=wn({"Content-Type":"application/json"},t==null?void 0:t.headers),l.body=JSON.stringify(n)):l.body=n,wn(wn({},l),r)):l};async function mwe(e,t,r,n,l,u){return new Promise((f,o)=>{e(r,pwe(t,n,l,u)).then(v=>{if(!v.ok)throw v;if(n!=null&&n.noResolveJson)return v;const w=v.headers.get("content-type");return!w||!w.includes("application/json")?{}:v.json()}).then(v=>f(v)).catch(v=>fwe(v,o,n))})}async function sc(e,t,r,n,l){return mwe(e,"POST",t,n,l,r)}var gwe=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=wn(wn({},EB),t),this.fetch=AB(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async getIndex(e,t){var r=this;try{return{data:await sc(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(oc(n))return{data:null,error:n};throw n}}async listIndexes(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async deleteIndex(e,t){var r=this;try{return{data:await sc(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:r.headers})||{},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(oc(n))return{data:null,error:n};throw n}}},ywe=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=wn(wn({},EB),t),this.fetch=AB(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(e){var t=this;try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await sc(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async getVectors(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async listVectors(e){var t=this;try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:await sc(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async queryVectors(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async deleteVectors(e){var t=this;try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await sc(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}},_we=class{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=wn(wn({},EB),t),this.fetch=AB(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async getBucket(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async listBuckets(e={}){var t=this;try{return{data:await sc(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}),error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}async deleteBucket(e){var t=this;try{return{data:await sc(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{},error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(oc(r))return{data:null,error:r};throw r}}},vwe=class extends _we{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new xwe(this.url,this.headers,e,this.fetch)}async createBucket(e){var t=()=>super.createBucket,r=this;return t().call(r,e)}async getBucket(e){var t=()=>super.getBucket,r=this;return t().call(r,e)}async listBuckets(e={}){var t=()=>super.listBuckets,r=this;return t().call(r,e)}async deleteBucket(e){var t=()=>super.deleteBucket,r=this;return t().call(r,e)}},xwe=class extends gwe{constructor(e,t,r,n){super(e,t,n),this.vectorBucketName=r}async createIndex(e){var t=()=>super.createIndex,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(e={}){var t=()=>super.listIndexes,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(e){var t=()=>super.getIndex,r=this;return t().call(r,r.vectorBucketName,e)}async deleteIndex(e){var t=()=>super.deleteIndex,r=this;return t().call(r,r.vectorBucketName,e)}index(e){return new bwe(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},bwe=class extends ywe{constructor(e,t,r,n,l){super(e,t,l),this.vectorBucketName=r,this.indexName=n}async putVectors(e){var t=()=>super.putVectors,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(e){var t=()=>super.getVectors,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(e={}){var t=()=>super.listVectors,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(e){var t=()=>super.queryVectors,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(e){var t=()=>super.deleteVectors,r=this;return t().call(r,wn(wn({},e),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},wwe=class extends cwe{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new lwe(this.url,this.headers,e,this.fetch)}get vectors(){return new vwe(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new uwe(this.url+"/iceberg",this.headers,this.fetch)}};const iee="2.90.1",gv=30*1e3,MN=3,JD=MN*gv,Swe="http://localhost:9999",Twe="supabase.auth.token",Ewe={"X-Client-Info":`gotrue-js/${iee}`},DN="X-Supabase-Api-Version",oee={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Awe=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Pwe=10*60*1e3;class kS extends Error{constructor(t,r,n){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function tn(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Cwe extends kS{constructor(t,r,n){super(t,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Iwe(e){return tn(e)&&e.name==="AuthApiError"}class Sg extends kS{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class of extends kS{constructor(t,r,n,l){super(t,n,l),this.name=r,this.status=n}}class Yl extends of{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Owe(e){return tn(e)&&e.name==="AuthSessionMissingError"}class tv extends of{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class oP extends of{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class sP extends of{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function kwe(e){return tn(e)&&e.name==="AuthImplicitGrantRedirectError"}class yq extends of{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Rwe extends of{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class LN extends of{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function QD(e){return tn(e)&&e.name==="AuthRetryableFetchError"}class _q extends of{constructor(t,r,n){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class jN extends of{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const LC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),vq=` 	
\r=`.split(""),Mwe=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<vq.length;t+=1)e[vq[t].charCodeAt(0)]=-2;for(let t=0;t<LC.length;t+=1)e[LC[t].charCodeAt(0)]=t;return e})();function xq(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(LC[n]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const n=t.queue>>t.queuedBits-6&63;r(LC[n]),t.queuedBits-=6}}function see(e,t,r){const n=Mwe[e];if(n>-1)for(t.queue=t.queue<<6|n,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function bq(e){const t=[],r=f=>{t.push(String.fromCodePoint(f))},n={utf8seq:0,codepoint:0},l={queue:0,queuedBits:0},u=f=>{jwe(f,n,r)};for(let f=0;f<e.length;f+=1)see(e.charCodeAt(f),l,u);return t.join("")}function Dwe(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Lwe(e,t){for(let r=0;r<e.length;r+=1){let n=e.charCodeAt(r);if(n>55295&&n<=56319){const l=(n-55296)*1024&65535;n=(e.charCodeAt(r+1)-56320&65535|l)+65536,r+=1}Dwe(n,t)}}function jwe(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function Yv(e){const t=[],r={queue:0,queuedBits:0},n=l=>{t.push(l)};for(let l=0;l<e.length;l+=1)see(e.charCodeAt(l),r,n);return new Uint8Array(t)}function Nwe(e){const t=[];return Lwe(e,r=>t.push(r)),new Uint8Array(t)}function Cg(e){const t=[],r={queue:0,queuedBits:0},n=l=>{t.push(l)};return e.forEach(l=>xq(l,r,n)),xq(null,r,n),t.join("")}function zwe(e){return Math.round(Date.now()/1e3)+e}function Fwe(){return Symbol("auth-callback")}const xa=()=>typeof window<"u"&&typeof document<"u",cg={tested:!1,writable:!1},aee=()=>{if(!xa())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(cg.tested)return cg.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),cg.tested=!0,cg.writable=!0}catch{cg.tested=!0,cg.writable=!1}return cg.writable};function Bwe(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((l,u)=>{t[u]=l})}catch{}return r.searchParams.forEach((n,l)=>{t[l]=n}),t}const lee=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),$we=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",yv=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},ug=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},va=async(e,t)=>{await e.removeItem(t)};class LO{constructor(){this.promise=new LO.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}LO.promiseConstructor=Promise;function eL(e){const t=e.split(".");if(t.length!==3)throw new jN("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!Awe.test(t[n]))throw new jN("JWT not in base64url format");return{header:JSON.parse(bq(t[0])),payload:JSON.parse(bq(t[1])),signature:Yv(t[2]),raw:{header:t[0],payload:t[1]}}}async function Vwe(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Uwe(e,t){return new Promise((n,l)=>{(async()=>{for(let u=0;u<1/0;u++)try{const f=await e(u);if(!t(u,null,f)){n(f);return}}catch(f){if(!t(u,f)){l(f);return}}})()})}function Gwe(e){return("0"+e.toString(16)).substr(-2)}function qwe(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let l="";for(let u=0;u<56;u++)l+=r.charAt(Math.floor(Math.random()*n));return l}return crypto.getRandomValues(t),Array.from(t,Gwe).join("")}async function Hwe(e){const r=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-256",r),l=new Uint8Array(n);return Array.from(l).map(u=>String.fromCharCode(u)).join("")}async function Wwe(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await Hwe(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function rv(e,t,r=!1){const n=qwe();let l=n;r&&(l+="/PASSWORD_RECOVERY"),await yv(e,`${t}-code-verifier`,l);const u=await Wwe(n);return[u,n===u?"plain":"s256"]}const Zwe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Xwe(e){const t=e.headers.get(DN);if(!t||!t.match(Zwe))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Kwe(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Ywe(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Jwe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function nv(e){if(!Jwe.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function tL(){const e={};return new Proxy(e,{get:(t,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Qwe(e,t){return new Proxy(e,{get:(r,n,l)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const u=n.toString();if(u==="Symbol(Symbol.toPrimitive)"||u==="Symbol(Symbol.toStringTag)"||u==="Symbol(util.inspect.custom)"||u==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,l)}return!t.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(r,n,l)}})}function wq(e){return JSON.parse(JSON.stringify(e))}const yg=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),e1e=[502,503,504];async function Sq(e){var t;if(!$we(e))throw new LN(yg(e),0);if(e1e.includes(e.status))throw new LN(yg(e),e.status);let r;try{r=await e.json()}catch(u){throw new Sg(yg(u),u)}let n;const l=Xwe(e);if(l&&l.getTime()>=oee["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new _q(yg(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(n==="session_not_found")throw new Yl}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((u,f)=>u&&typeof f=="string",!0))throw new _q(yg(r),e.status,r.weak_password.reasons);throw new Cwe(yg(r),e.status||500,n)}const t1e=(e,t,r,n)=>{const l={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?l:(l.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),l.body=JSON.stringify(n),Object.assign(Object.assign({},l),r))};async function bn(e,t,r,n){var l;const u=Object.assign({},n==null?void 0:n.headers);u[DN]||(u[DN]=oee["2024-01-01"].name),n!=null&&n.jwt&&(u.Authorization=`Bearer ${n.jwt}`);const f=(l=n==null?void 0:n.query)!==null&&l!==void 0?l:{};n!=null&&n.redirectTo&&(f.redirect_to=n.redirectTo);const o=Object.keys(f).length?"?"+new URLSearchParams(f).toString():"",v=await r1e(e,t,r+o,{headers:u,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(v):{data:Object.assign({},v),error:null}}async function r1e(e,t,r,n,l,u){const f=t1e(t,n,l,u);let o;try{o=await e(r,Object.assign({},f))}catch(v){throw console.error(v),new LN(yg(v),0)}if(o.ok||await Sq(o),n!=null&&n.noResolveJson)return o;try{return await o.json()}catch(v){await Sq(v)}}function Eu(e){var t;let r=null;o1e(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=zwe(e.expires_in)));const n=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:n},error:null}}function Tq(e){const t=Eu(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(t.data.weak_password=e.weak_password),t}function fp(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function n1e(e){return{data:e,error:null}}function i1e(e){const{action_link:t,email_otp:r,hashed_token:n,redirect_to:l,verification_type:u}=e,f=_x(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:r,hashed_token:n,redirect_to:l,verification_type:u},v=Object.assign({},f);return{data:{properties:o,user:v},error:null}}function Eq(e){return e}function o1e(e){return e.access_token&&e.refresh_token&&e.expires_in}const rL=["global","local","others"];class s1e{constructor({url:t="",headers:r={},fetch:n}){this.url=t,this.headers=r,this.fetch=lee(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,r=rL[0]){if(rL.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${rL.join(", ")}`);try{return await bn(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(n){if(tn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(t,r={}){try{return await bn(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:fp})}catch(n){if(tn(n))return{data:{user:null},error:n};throw n}}async generateLink(t){try{const{options:r}=t,n=_x(t,["options"]),l=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(l.new_email=n==null?void 0:n.newEmail,delete l.newEmail),await bn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:l,headers:this.headers,xform:i1e,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(tn(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await bn(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:fp})}catch(r){if(tn(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,n,l,u,f,o,v;try{const w={nextPage:null,lastPage:0,total:0},P=await bn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(u=(l=t==null?void 0:t.perPage)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""},xform:Eq});if(P.error)throw P.error;const C=await P.json(),k=(f=P.headers.get("x-total-count"))!==null&&f!==void 0?f:0,L=(v=(o=P.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&v!==void 0?v:[];return L.length>0&&(L.forEach($=>{const j=parseInt($.split(";")[0].split("=")[1].substring(0,1)),B=JSON.parse($.split(";")[1].split("=")[1]);w[`${B}Page`]=j}),w.total=parseInt(k)),{data:Object.assign(Object.assign({},C),w),error:null}}catch(w){if(tn(w))return{data:{users:[]},error:w};throw w}}async getUserById(t){nv(t);try{return await bn(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:fp})}catch(r){if(tn(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){nv(t);try{return await bn(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:fp})}catch(n){if(tn(n))return{data:{user:null},error:n};throw n}}async deleteUser(t,r=!1){nv(t);try{return await bn(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:fp})}catch(n){if(tn(n))return{data:{user:null},error:n};throw n}}async _listFactors(t){nv(t.userId);try{const{data:r,error:n}=await bn(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:l=>({data:{factors:l},error:null})});return{data:r,error:n}}catch(r){if(tn(r))return{data:null,error:r};throw r}}async _deleteFactor(t){nv(t.userId),nv(t.id);try{return{data:await bn(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(tn(r))return{data:null,error:r};throw r}}async _listOAuthClients(t){var r,n,l,u,f,o,v;try{const w={nextPage:null,lastPage:0,total:0},P=await bn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(u=(l=t==null?void 0:t.perPage)===null||l===void 0?void 0:l.toString())!==null&&u!==void 0?u:""},xform:Eq});if(P.error)throw P.error;const C=await P.json(),k=(f=P.headers.get("x-total-count"))!==null&&f!==void 0?f:0,L=(v=(o=P.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&v!==void 0?v:[];return L.length>0&&(L.forEach($=>{const j=parseInt($.split(";")[0].split("=")[1].substring(0,1)),B=JSON.parse($.split(";")[1].split("=")[1]);w[`${B}Page`]=j}),w.total=parseInt(k)),{data:Object.assign(Object.assign({},C),w),error:null}}catch(w){if(tn(w))return{data:{clients:[]},error:w};throw w}}async _createOAuthClient(t){try{return await bn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(tn(r))return{data:null,error:r};throw r}}async _getOAuthClient(t){try{return await bn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(tn(r))return{data:null,error:r};throw r}}async _updateOAuthClient(t,r){try{return await bn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(tn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(t){try{return await bn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(tn(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(t){try{return await bn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(tn(r))return{data:null,error:r};throw r}}}function Aq(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const iv={debug:!!(globalThis&&aee()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cee extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class a1e extends cee{}async function l1e(e,t,r){iv.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const n=new globalThis.AbortController;return t>0&&setTimeout(()=>{n.abort(),iv.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async l=>{if(l){iv.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,l.name);try{return await r()}finally{iv.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,l.name)}}else{if(t===0)throw iv.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new a1e(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(iv.debug)try{const u=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(u,null,"  "))}catch(u){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",u)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function c1e(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function uee(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function u1e(e){return parseInt(e,16)}function d1e(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,n=>n.toString(16).padStart(2,"0")).join("")}function h1e(e){var t;const{chainId:r,domain:n,expirationTime:l,issuedAt:u=new Date,nonce:f,notBefore:o,requestId:v,resources:w,scheme:P,uri:C,version:k}=e;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(f&&f.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${f}`);if(!C)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(k!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${k}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const L=uee(e.address),$=P?`${P}://${n}`:n,j=e.statement?`${e.statement}
`:"",B=`${$} wants you to sign in with your Ethereum account:
${L}

${j}`;let U=`URI: ${C}
Version: ${k}
Chain ID: ${r}${f?`
Nonce: ${f}`:""}
Issued At: ${u.toISOString()}`;if(l&&(U+=`
Expiration Time: ${l.toISOString()}`),o&&(U+=`
Not Before: ${o.toISOString()}`),v&&(U+=`
Request ID: ${v}`),w){let q=`
Resources:`;for(const H of w){if(!H||typeof H!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${H}`);q+=`
- ${H}`}U+=q}return`${B}
${U}`}class bs extends Error{constructor({message:t,code:r,cause:n,name:l}){var u;super(t,{cause:n}),this.__isWebAuthnError=!0,this.name=(u=l??(n instanceof Error?n.name:void 0))!==null&&u!==void 0?u:"Unknown Error",this.code=r}}class jC extends bs{constructor(t,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:t}),this.name="WebAuthnUnknownError",this.originalError=r}}function f1e({error:e,options:t}){var r,n,l;const{publicKey:u}=t;if(!u)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new bs({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((r=u.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new bs({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((n=u.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new bs({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((l=u.authenticatorSelection)===null||l===void 0?void 0:l.userVerification)==="required")return new bs({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new bs({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new bs({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return u.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new bs({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new bs({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const f=window.location.hostname;if(dee(f)){if(u.rp.id!==f)return new bs({message:`The RP ID "${u.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new bs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(u.user.id.byteLength<1||u.user.id.byteLength>64)return new bs({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new bs({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new bs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function p1e({error:e,options:t}){const{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new bs({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new bs({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const n=window.location.hostname;if(dee(n)){if(r.rpId!==n)return new bs({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new bs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new bs({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new bs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class m1e{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const g1e=new m1e;function y1e(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:r,excludeCredentials:n}=e,l=_x(e,["challenge","user","excludeCredentials"]),u=Yv(t).buffer,f=Object.assign(Object.assign({},r),{id:Yv(r.id).buffer}),o=Object.assign(Object.assign({},l),{challenge:u,user:f});if(n&&n.length>0){o.excludeCredentials=new Array(n.length);for(let v=0;v<n.length;v++){const w=n[v];o.excludeCredentials[v]=Object.assign(Object.assign({},w),{id:Yv(w.id).buffer,type:w.type||"public-key",transports:w.transports})}}return o}function _1e(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:r}=e,n=_x(e,["challenge","allowCredentials"]),l=Yv(t).buffer,u=Object.assign(Object.assign({},n),{challenge:l});if(r&&r.length>0){u.allowCredentials=new Array(r.length);for(let f=0;f<r.length;f++){const o=r[f];u.allowCredentials[f]=Object.assign(Object.assign({},o),{id:Yv(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return u}function v1e(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e;return{id:e.id,rawId:e.id,response:{attestationObject:Cg(new Uint8Array(e.response.attestationObject)),clientDataJSON:Cg(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function x1e(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const r=e,n=e.getClientExtensionResults(),l=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Cg(new Uint8Array(l.authenticatorData)),clientDataJSON:Cg(new Uint8Array(l.clientDataJSON)),signature:Cg(new Uint8Array(l.signature)),userHandle:l.userHandle?Cg(new Uint8Array(l.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(t=r.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function dee(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Pq(){var e,t;return!!(xa()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function b1e(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new jC("Browser returned unexpected credential type",t)}:{data:null,error:new jC("Empty credential response",t)}}catch(t){return{data:null,error:f1e({error:t,options:e})}}}async function w1e(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new jC("Browser returned unexpected credential type",t)}:{data:null,error:new jC("Empty credential response",t)}}catch(t){return{data:null,error:p1e({error:t,options:e})}}}const S1e={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},T1e={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function NC(...e){const t=l=>l!==null&&typeof l=="object"&&!Array.isArray(l),r=l=>l instanceof ArrayBuffer||ArrayBuffer.isView(l),n={};for(const l of e)if(l)for(const u in l){const f=l[u];if(f!==void 0)if(Array.isArray(f))n[u]=f;else if(r(f))n[u]=f;else if(t(f)){const o=n[u];t(o)?n[u]=NC(o,f):n[u]=NC(f)}else n[u]=f}return n}function E1e(e,t){return NC(S1e,e,t||{})}function A1e(e,t){return NC(T1e,e,t||{})}class P1e{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:r,friendlyName:n,signal:l},u){try{const{data:f,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:r});if(!f)return{data:null,error:o};const v=l??g1e.createNewAbortSignal();if(f.webauthn.type==="create"){const{user:w}=f.webauthn.credential_options.publicKey;w.name||(w.name=`${w.id}:${n}`),w.displayName||(w.displayName=w.name)}switch(f.webauthn.type){case"create":{const w=E1e(f.webauthn.credential_options.publicKey,u==null?void 0:u.create),{data:P,error:C}=await b1e({publicKey:w,signal:v});return P?{data:{factorId:t,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:P}},error:null}:{data:null,error:C}}case"request":{const w=A1e(f.webauthn.credential_options.publicKey,u==null?void 0:u.request),{data:P,error:C}=await w1e(Object.assign(Object.assign({},f.webauthn.credential_options),{publicKey:w,signal:v}));return P?{data:{factorId:t,challengeId:f.id,webauthn:{type:f.webauthn.type,credential_response:P}},error:null}:{data:null,error:C}}}}catch(f){return tn(f)?{data:null,error:f}:{data:null,error:new Sg("Unexpected error in challenge",f)}}}async _verify({challengeId:t,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:t,webauthn:n})}async _authenticate({factorId:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:l}={}},u){if(!r)return{data:null,error:new kS("rpId is required for WebAuthn authentication")};try{if(!Pq())return{data:null,error:new Sg("Browser does not support WebAuthn",null)};const{data:f,error:o}=await this.challenge({factorId:t,webauthn:{rpId:r,rpOrigins:n},signal:l},{request:u});if(!f)return{data:null,error:o};const{webauthn:v}=f;return this._verify({factorId:t,challengeId:f.challengeId,webauthn:{type:v.type,rpId:r,rpOrigins:n,credential_response:v.credential_response}})}catch(f){return tn(f)?{data:null,error:f}:{data:null,error:new Sg("Unexpected error in authenticate",f)}}}async _register({friendlyName:t,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:l}={}},u){if(!r)return{data:null,error:new kS("rpId is required for WebAuthn registration")};try{if(!Pq())return{data:null,error:new Sg("Browser does not support WebAuthn",null)};const{data:f,error:o}=await this._enroll({friendlyName:t});if(!f)return await this.client.mfa.listFactors().then(P=>{var C;return(C=P.data)===null||C===void 0?void 0:C.all.find(k=>k.factor_type==="webauthn"&&k.friendly_name===t&&k.status!=="unverified")}).then(P=>P?this.client.mfa.unenroll({factorId:P==null?void 0:P.id}):void 0),{data:null,error:o};const{data:v,error:w}=await this._challenge({factorId:f.id,friendlyName:f.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:l},{create:u});return v?this._verify({factorId:f.id,challengeId:v.challengeId,webauthn:{rpId:r,rpOrigins:n,type:v.webauthn.type,credential_response:v.webauthn.credential_response}}):{data:null,error:w}}catch(f){return tn(f)?{data:null,error:f}:{data:null,error:new Sg("Unexpected error in register",f)}}}}c1e();const C1e={url:Swe,storageKey:Twe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ewe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function Cq(e,t,r){return await r()}const ov={};class RS{get jwks(){var t,r;return(r=(t=ov[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(t){ov[this.storageKey]=Object.assign(Object.assign({},ov[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,r;return(r=(t=ov[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){ov[this.storageKey]=Object.assign(Object.assign({},ov[this.storageKey]),{cachedAt:t})}constructor(t){var r,n,l;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const u=Object.assign(Object.assign({},C1e),t);if(this.storageKey=u.storageKey,this.instanceID=(r=RS.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,RS.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!u.debug,typeof u.debug=="function"&&(this.logger=u.debug),this.instanceID>0&&xa()){const f=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(f),this.logDebugMessages&&console.trace(f)}if(this.persistSession=u.persistSession,this.autoRefreshToken=u.autoRefreshToken,this.admin=new s1e({url:u.url,headers:u.headers,fetch:u.fetch}),this.url=u.url,this.headers=u.headers,this.fetch=lee(u.fetch),this.lock=u.lock||Cq,this.detectSessionInUrl=u.detectSessionInUrl,this.flowType=u.flowType,this.hasCustomAuthorizationHeader=u.hasCustomAuthorizationHeader,this.throwOnError=u.throwOnError,this.lockAcquireTimeout=u.lockAcquireTimeout,u.lock?this.lock=u.lock:this.persistSession&&xa()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=l1e:this.lock=Cq,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new P1e(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(u.storage?this.storage=u.storage:aee()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Aq(this.memoryStorage)),u.userStorage&&(this.userStorage=u.userStorage)):(this.memoryStorage={},this.storage=Aq(this.memoryStorage)),xa()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(f){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",f)}(l=this.broadcastChannel)===null||l===void 0||l.addEventListener("message",async f=>{this._debug("received broadcast notification from other tab or client",f),await this._notifyAllSubscribers(f.data.event,f.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${iee}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let r={},n="none";if(xa()&&(r=Bwe(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),xa()&&this.detectSessionInUrl&&n!=="none"){const{data:l,error:u}=await this._getSessionFromURL(r,n);if(u){if(this._debug("#_initialize()","error detecting session from URL",u),kwe(u)){const v=(t=u.details)===null||t===void 0?void 0:t.code;if(v==="identity_already_exists"||v==="identity_not_found"||v==="single_identity_not_deletable")return{error:u}}return{error:u}}const{session:f,redirectType:o}=l;return this._debug("#_initialize()","detected session in URL",f,"redirect type",o),await this._saveSession(f),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",f):await this._notifyAllSubscribers("SIGNED_IN",f)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return tn(r)?this._returnResult({error:r}):this._returnResult({error:new Sg("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,n,l;try{const u=await bn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(l=t==null?void 0:t.options)===null||l===void 0?void 0:l.captchaToken}},xform:Eu}),{data:f,error:o}=u;if(o||!f)return this._returnResult({data:{user:null,session:null},error:o});const v=f.session,w=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",v)),this._returnResult({data:{user:w,session:v},error:null})}catch(u){if(tn(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signUp(t){var r,n,l;try{let u;if("email"in t){const{email:P,password:C,options:k}=t;let L=null,$=null;this.flowType==="pkce"&&([L,$]=await rv(this.storage,this.storageKey)),u=await bn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:k==null?void 0:k.emailRedirectTo,body:{email:P,password:C,data:(r=k==null?void 0:k.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:k==null?void 0:k.captchaToken},code_challenge:L,code_challenge_method:$},xform:Eu})}else if("phone"in t){const{phone:P,password:C,options:k}=t;u=await bn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:P,password:C,data:(n=k==null?void 0:k.data)!==null&&n!==void 0?n:{},channel:(l=k==null?void 0:k.channel)!==null&&l!==void 0?l:"sms",gotrue_meta_security:{captcha_token:k==null?void 0:k.captchaToken}},xform:Eu})}else throw new oP("You must provide either an email or phone number and a password");const{data:f,error:o}=u;if(o||!f)return await va(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const v=f.session,w=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",v)),this._returnResult({data:{user:w,session:v},error:null})}catch(u){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async signInWithPassword(t){try{let r;if("email"in t){const{email:u,password:f,options:o}=t;r=await bn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:u,password:f,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Tq})}else if("phone"in t){const{phone:u,password:f,options:o}=t;r=await bn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:u,password:f,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:Tq})}else throw new oP("You must provide either an email or phone number and a password");const{data:n,error:l}=r;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!n||!n.session||!n.user){const u=new tv;return this._returnResult({data:{user:null,session:null},error:u})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:l})}catch(r){if(tn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(t){var r,n,l,u;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=t.options)===null||n===void 0?void 0:n.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:(u=t.options)===null||u===void 0?void 0:u.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;switch(r){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(t){var r,n,l,u,f,o,v,w,P,C,k;let L,$;if("message"in t)L=t.message,$=t.signature;else{const{chain:j,wallet:B,statement:U,options:q}=t;let H;if(xa())if(typeof B=="object")H=B;else{const Ce=window;if("ethereum"in Ce&&typeof Ce.ethereum=="object"&&"request"in Ce.ethereum&&typeof Ce.ethereum.request=="function")H=Ce.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof B!="object"||!(q!=null&&q.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");H=B}const te=new URL((r=q==null?void 0:q.url)!==null&&r!==void 0?r:window.location.href),Q=await H.request({method:"eth_requestAccounts"}).then(Ce=>Ce).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Q||Q.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const ae=uee(Q[0]);let ue=(n=q==null?void 0:q.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!ue){const Ce=await H.request({method:"eth_chainId"});ue=u1e(Ce)}const me={domain:te.host,address:ae,statement:U,uri:te.href,version:"1",chainId:ue,nonce:(l=q==null?void 0:q.signInWithEthereum)===null||l===void 0?void 0:l.nonce,issuedAt:(f=(u=q==null?void 0:q.signInWithEthereum)===null||u===void 0?void 0:u.issuedAt)!==null&&f!==void 0?f:new Date,expirationTime:(o=q==null?void 0:q.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(v=q==null?void 0:q.signInWithEthereum)===null||v===void 0?void 0:v.notBefore,requestId:(w=q==null?void 0:q.signInWithEthereum)===null||w===void 0?void 0:w.requestId,resources:(P=q==null?void 0:q.signInWithEthereum)===null||P===void 0?void 0:P.resources};L=h1e(me),$=await H.request({method:"personal_sign",params:[d1e(L),ae]})}try{const{data:j,error:B}=await bn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:L,signature:$},!((C=t.options)===null||C===void 0)&&C.captchaToken?{gotrue_meta_security:{captcha_token:(k=t.options)===null||k===void 0?void 0:k.captchaToken}}:null),xform:Eu});if(B)throw B;if(!j||!j.session||!j.user){const U=new tv;return this._returnResult({data:{user:null,session:null},error:U})}return j.session&&(await this._saveSession(j.session),await this._notifyAllSubscribers("SIGNED_IN",j.session)),this._returnResult({data:Object.assign({},j),error:B})}catch(j){if(tn(j))return this._returnResult({data:{user:null,session:null},error:j});throw j}}async signInWithSolana(t){var r,n,l,u,f,o,v,w,P,C,k,L;let $,j;if("message"in t)$=t.message,j=t.signature;else{const{chain:B,wallet:U,statement:q,options:H}=t;let te;if(xa())if(typeof U=="object")te=U;else{const ae=window;if("solana"in ae&&typeof ae.solana=="object"&&("signIn"in ae.solana&&typeof ae.solana.signIn=="function"||"signMessage"in ae.solana&&typeof ae.solana.signMessage=="function"))te=ae.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof U!="object"||!(H!=null&&H.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");te=U}const Q=new URL((r=H==null?void 0:H.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in te&&te.signIn){const ae=await te.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},H==null?void 0:H.signInWithSolana),{version:"1",domain:Q.host,uri:Q.href}),q?{statement:q}:null));let ue;if(Array.isArray(ae)&&ae[0]&&typeof ae[0]=="object")ue=ae[0];else if(ae&&typeof ae=="object"&&"signedMessage"in ae&&"signature"in ae)ue=ae;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in ue&&"signature"in ue&&(typeof ue.signedMessage=="string"||ue.signedMessage instanceof Uint8Array)&&ue.signature instanceof Uint8Array)$=typeof ue.signedMessage=="string"?ue.signedMessage:new TextDecoder().decode(ue.signedMessage),j=ue.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in te)||typeof te.signMessage!="function"||!("publicKey"in te)||typeof te!="object"||!te.publicKey||!("toBase58"in te.publicKey)||typeof te.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");$=[`${Q.host} wants you to sign in with your Solana account:`,te.publicKey.toBase58(),...q?["",q,""]:[""],"Version: 1",`URI: ${Q.href}`,`Issued At: ${(l=(n=H==null?void 0:H.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&l!==void 0?l:new Date().toISOString()}`,...!((u=H==null?void 0:H.signInWithSolana)===null||u===void 0)&&u.notBefore?[`Not Before: ${H.signInWithSolana.notBefore}`]:[],...!((f=H==null?void 0:H.signInWithSolana)===null||f===void 0)&&f.expirationTime?[`Expiration Time: ${H.signInWithSolana.expirationTime}`]:[],...!((o=H==null?void 0:H.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${H.signInWithSolana.chainId}`]:[],...!((v=H==null?void 0:H.signInWithSolana)===null||v===void 0)&&v.nonce?[`Nonce: ${H.signInWithSolana.nonce}`]:[],...!((w=H==null?void 0:H.signInWithSolana)===null||w===void 0)&&w.requestId?[`Request ID: ${H.signInWithSolana.requestId}`]:[],...!((C=(P=H==null?void 0:H.signInWithSolana)===null||P===void 0?void 0:P.resources)===null||C===void 0)&&C.length?["Resources",...H.signInWithSolana.resources.map(ue=>`- ${ue}`)]:[]].join(`
`);const ae=await te.signMessage(new TextEncoder().encode($),"utf8");if(!ae||!(ae instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");j=ae}}try{const{data:B,error:U}=await bn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:$,signature:Cg(j)},!((k=t.options)===null||k===void 0)&&k.captchaToken?{gotrue_meta_security:{captcha_token:(L=t.options)===null||L===void 0?void 0:L.captchaToken}}:null),xform:Eu});if(U)throw U;if(!B||!B.session||!B.user){const q=new tv;return this._returnResult({data:{user:null,session:null},error:q})}return B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("SIGNED_IN",B.session)),this._returnResult({data:Object.assign({},B),error:U})}catch(B){if(tn(B))return this._returnResult({data:{user:null,session:null},error:B});throw B}}async _exchangeCodeForSession(t){const r=await ug(this.storage,`${this.storageKey}-code-verifier`),[n,l]=(r??"").split("/");try{if(!n&&this.flowType==="pkce")throw new Rwe;const{data:u,error:f}=await bn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:n},xform:Eu});if(await va(this.storage,`${this.storageKey}-code-verifier`),f)throw f;if(!u||!u.session||!u.user){const o=new tv;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return u.session&&(await this._saveSession(u.session),await this._notifyAllSubscribers("SIGNED_IN",u.session)),this._returnResult({data:Object.assign(Object.assign({},u),{redirectType:l??null}),error:f})}catch(u){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(u))return this._returnResult({data:{user:null,session:null,redirectType:null},error:u});throw u}}async signInWithIdToken(t){try{const{options:r,provider:n,token:l,access_token:u,nonce:f}=t,o=await bn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:l,access_token:u,nonce:f,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:Eu}),{data:v,error:w}=o;if(w)return this._returnResult({data:{user:null,session:null},error:w});if(!v||!v.session||!v.user){const P=new tv;return this._returnResult({data:{user:null,session:null},error:P})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:v,error:w})}catch(r){if(tn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(t){var r,n,l,u,f;try{if("email"in t){const{email:o,options:v}=t;let w=null,P=null;this.flowType==="pkce"&&([w,P]=await rv(this.storage,this.storageKey));const{error:C}=await bn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=v==null?void 0:v.data)!==null&&r!==void 0?r:{},create_user:(n=v==null?void 0:v.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},code_challenge:w,code_challenge_method:P},redirectTo:v==null?void 0:v.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:C})}if("phone"in t){const{phone:o,options:v}=t,{data:w,error:P}=await bn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(l=v==null?void 0:v.data)!==null&&l!==void 0?l:{},create_user:(u=v==null?void 0:v.shouldCreateUser)!==null&&u!==void 0?u:!0,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken},channel:(f=v==null?void 0:v.channel)!==null&&f!==void 0?f:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:w==null?void 0:w.message_id},error:P})}throw new oP("You must provide either an email or phone number.")}catch(o){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var r,n;try{let l,u;"options"in t&&(l=(r=t.options)===null||r===void 0?void 0:r.redirectTo,u=(n=t.options)===null||n===void 0?void 0:n.captchaToken);const{data:f,error:o}=await bn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:u}}),redirectTo:l,xform:Eu});if(o)throw o;if(!f)throw new Error("An error occurred on token verification.");const v=f.session,w=f.user;return v!=null&&v.access_token&&(await this._saveSession(v),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",v)),this._returnResult({data:{user:w,session:v},error:null})}catch(l){if(tn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async signInWithSSO(t){var r,n,l,u,f;try{let o=null,v=null;this.flowType==="pkce"&&([o,v]=await rv(this.storage,this.storageKey));const w=await bn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(n=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((l=t==null?void 0:t.options)===null||l===void 0)&&l.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:v}),headers:this.headers,xform:n1e});return!((u=w.data)===null||u===void 0)&&u.url&&xa()&&!(!((f=t.options)===null||f===void 0)&&f.skipBrowserRedirect)&&window.location.assign(w.data.url),this._returnResult(w)}catch(o){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;if(n)throw n;if(!r)throw new Yl;const{error:l}=await bn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:l})})}catch(t){if(tn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:n,type:l,options:u}=t,{error:f}=await bn(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:l,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}},redirectTo:u==null?void 0:u.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}else if("phone"in t){const{phone:n,type:l,options:u}=t,{data:f,error:o}=await bn(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:l,gotrue_meta_security:{captcha_token:u==null?void 0:u.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:f==null?void 0:f.message_id},error:o})}throw new oP("You must provide either an email or phone number and a type")}catch(r){if(tn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),l=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await l}catch{}})()),l}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const l=[...this.pendingInLock];await Promise.all(l),this.pendingInLock.splice(0,l.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await ug(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const n=t.expires_at?t.expires_at*1e3-Date.now()<JD:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",t.expires_at),!n){if(this.userStorage){const f=await ug(this.userStorage,this.storageKey+"-user");f!=null&&f.user?t.user=f.user:t.user=tL()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const f={value:this.suppressGetSessionWarning};t.user=Qwe(t.user,f),f.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:l,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{session:null},error:u}):this._returnResult({data:{session:l},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){if(t)return await this._getUser(t);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(t){try{return t?await bn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:fp}):await this._useSession(async r=>{var n,l,u;const{data:f,error:o}=r;if(o)throw o;return!(!((n=f.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yl}:await bn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(u=(l=f.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0,xform:fp})})}catch(r){if(tn(r))return Owe(r)&&(await this._removeSession(),await va(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async n=>{const{data:l,error:u}=n;if(u)throw u;if(!l.session)throw new Yl;const f=l.session;let o=null,v=null;this.flowType==="pkce"&&t.email!=null&&([o,v]=await rv(this.storage,this.storageKey));const{data:w,error:P}=await bn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:v}),jwt:f.access_token,xform:fp});if(P)throw P;return f.user=w.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),this._returnResult({data:{user:f.user},error:null})})}catch(n){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Yl;const r=Date.now()/1e3;let n=r,l=!0,u=null;const{payload:f}=eL(t.access_token);if(f.exp&&(n=f.exp,l=n<=r),l){const{data:o,error:v}=await this._callRefreshToken(t.refresh_token);if(v)return this._returnResult({data:{user:null,session:null},error:v});if(!o)return{data:{user:null,session:null},error:null};u=o}else{const{data:o,error:v}=await this._getUser(t.access_token);if(v)throw v;u={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(u),await this._notifyAllSubscribers("SIGNED_IN",u)}return this._returnResult({data:{user:u.user,session:u},error:null})}catch(r){if(tn(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var n;if(!t){const{data:f,error:o}=r;if(o)throw o;t=(n=f.session)!==null&&n!==void 0?n:void 0}if(!(t!=null&&t.refresh_token))throw new Yl;const{data:l,error:u}=await this._callRefreshToken(t.refresh_token);return u?this._returnResult({data:{user:null,session:null},error:u}):l?this._returnResult({data:{user:l.user,session:l},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(tn(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(t,r){try{if(!xa())throw new sP("No browser detected.");if(t.error||t.error_description||t.error_code)throw new sP(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new yq("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new sP("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new yq("No code detected.");const{data:q,error:H}=await this._exchangeCodeForSession(t.code);if(H)throw H;const te=new URL(window.location.href);return te.searchParams.delete("code"),window.history.replaceState(window.history.state,"",te.toString()),{data:{session:q.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:l,access_token:u,refresh_token:f,expires_in:o,expires_at:v,token_type:w}=t;if(!u||!o||!f||!w)throw new sP("No session defined in URL");const P=Math.round(Date.now()/1e3),C=parseInt(o);let k=P+C;v&&(k=parseInt(v));const L=k-P;L*1e3<=gv&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${L}s, should have been closer to ${C}s`);const $=k-C;P-$>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",$,k,P):P-$<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",$,k,P);const{data:j,error:B}=await this._getUser(u);if(B)throw B;const U={provider_token:n,provider_refresh_token:l,access_token:u,expires_in:C,expires_at:k,refresh_token:f,token_type:w,user:j.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:U,redirectType:t.type},error:null})}catch(n){if(tn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(t){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),t):!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await ug(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:l,error:u}=r;if(u)return this._returnResult({error:u});const f=(n=l.session)===null||n===void 0?void 0:n.access_token;if(f){const{error:o}=await this.admin.signOut(f,t);if(o&&!(Iwe(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return t!=="others"&&(await this._removeSession(),await va(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const r=Fwe(),n={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(t){return await this._useSession(async r=>{var n,l;try{const{data:{session:u},error:f}=r;if(f)throw f;await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",u)),this._debug("INITIAL_SESSION","callback id",t,"session",u)}catch(u){await((l=this.stateChangeEmitters.get(t))===null||l===void 0?void 0:l.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",u),console.error(u)}})}async resetPasswordForEmail(t,r={}){let n=null,l=null;this.flowType==="pkce"&&([n,l]=await rv(this.storage,this.storageKey,!0));try{return await bn(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:n,code_challenge_method:l,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(u){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(u))return this._returnResult({data:null,error:u});throw u}}async getUserIdentities(){var t;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var r;try{const{data:n,error:l}=await this._useSession(async u=>{var f,o,v,w,P;const{data:C,error:k}=u;if(k)throw k;const L=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(f=t.options)===null||f===void 0?void 0:f.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(v=t.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:!0});return await bn(this.fetch,"GET",L,{headers:this.headers,jwt:(P=(w=C.session)===null||w===void 0?void 0:w.access_token)!==null&&P!==void 0?P:void 0})});if(l)throw l;return xa()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:t.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(tn(n))return this._returnResult({data:{provider:t.provider,url:null},error:n});throw n}}async linkIdentityIdToken(t){return await this._useSession(async r=>{var n;try{const{error:l,data:{session:u}}=r;if(l)throw l;const{options:f,provider:o,token:v,access_token:w,nonce:P}=t,C=await bn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=u==null?void 0:u.access_token)!==null&&n!==void 0?n:void 0,body:{provider:o,id_token:v,access_token:w,nonce:P,link_identity:!0,gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Eu}),{data:k,error:L}=C;return L?this._returnResult({data:{user:null,session:null},error:L}):!k||!k.session||!k.user?this._returnResult({data:{user:null,session:null},error:new tv}):(k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("USER_UPDATED",k.session)),this._returnResult({data:k,error:L}))}catch(l){if(await va(this.storage,`${this.storageKey}-code-verifier`),tn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}})}async unlinkIdentity(t){try{return await this._useSession(async r=>{var n,l;const{data:u,error:f}=r;if(f)throw f;return await bn(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(l=(n=u.session)===null||n===void 0?void 0:n.access_token)!==null&&l!==void 0?l:void 0})})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await Uwe(async l=>(l>0&&await Vwe(200*Math.pow(2,l-1)),this._debug(r,"refreshing attempt",l),await bn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Eu})),(l,u)=>{const f=200*Math.pow(2,l);return u&&QD(u)&&Date.now()+f-n<gv})}catch(n){if(this._debug(r,"error",n),tn(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",n),xa()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:t,url:n},error:null}}async _recoverAndRefresh(){var t,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const l=await ug(this.storage,this.storageKey);if(l&&this.userStorage){let f=await ug(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!f&&(f={user:l.user},await yv(this.userStorage,this.storageKey+"-user",f)),l.user=(t=f==null?void 0:f.user)!==null&&t!==void 0?t:tL()}else if(l&&!l.user&&!l.user){const f=await ug(this.storage,this.storageKey+"-user");f&&(f!=null&&f.user)?(l.user=f.user,await va(this.storage,this.storageKey+"-user"),await yv(this.storage,this.storageKey,l)):l.user=tL()}if(this._debug(n,"session from storage",l),!this._isValidSession(l)){this._debug(n,"session is not valid"),l!==null&&await this._removeSession();return}const u=((r=l.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<JD;if(this._debug(n,`session has${u?"":" not"} expired with margin of ${JD}s`),u){if(this.autoRefreshToken&&l.refresh_token){const{error:f}=await this._callRefreshToken(l.refresh_token);f&&(console.error(f),QD(f)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",f),await this._removeSession()))}}else if(l.user&&l.user.__isUserNotAvailableProxy===!0)try{const{data:f,error:o}=await this._getUser(l.access_token);!o&&(f!=null&&f.user)?(l.user=f.user,await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(f){console.error("Error getting user data:",f),this._debug(n,"error getting user data, skipping SIGNED_IN notification",f)}else await this._notifyAllSubscribers("SIGNED_IN",l)}catch(l){this._debug(n,"error",l),console.error(l);return}finally{this._debug(n,"end")}}async _callRefreshToken(t){var r,n;if(!t)throw new Yl;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const l=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(l,"begin");try{this.refreshingDeferred=new LO;const{data:u,error:f}=await this._refreshAccessToken(t);if(f)throw f;if(!u.session)throw new Yl;await this._saveSession(u.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",u.session);const o={data:u.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(u){if(this._debug(l,"error",u),tn(u)){const f={data:null,error:u};return QD(u)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(f),f}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(u),u}finally{this.refreshingDeferred=null,this._debug(l,"end")}}async _notifyAllSubscribers(t,r,n=!0){const l=`#_notifyAllSubscribers(${t})`;this._debug(l,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:t,session:r});const u=[],f=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,r)}catch(v){u.push(v)}});if(await Promise.all(f),u.length>0){for(let o=0;o<u.length;o+=1)console.error(u[o]);throw u[0]}}finally{this._debug(l,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await va(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},t),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await yv(this.userStorage,this.storageKey+"-user",{user:r.user});const l=Object.assign({},r);delete l.user;const u=wq(l);await yv(this.storage,this.storageKey,u)}else{const l=wq(r);await yv(this.storage,this.storageKey,l)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await va(this.storage,this.storageKey),await va(this.storage,this.storageKey+"-code-verifier"),await va(this.storage,this.storageKey+"-user"),this.userStorage&&await va(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&xa()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),gv);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const l=Math.floor((n.expires_at*1e3-t)/gv);this._debug("#_autoRefreshTokenTick()",`access token expires in ${l} ticks, a tick lasts ${gv}ms, refresh threshold is ${MN} ticks`),l<=MN&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof cee)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xa()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,n){const l=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&l.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&l.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[u,f]=await rv(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(u)}`,code_challenge_method:`${encodeURIComponent(f)}`});l.push(o.toString())}if(n!=null&&n.queryParams){const u=new URLSearchParams(n.queryParams);l.push(u.toString())}return n!=null&&n.skipBrowserRedirect&&l.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${t}?${l.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var n;const{data:l,error:u}=r;return u?this._returnResult({data:null,error:u}):await bn(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(n=l==null?void 0:l.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(t){try{return await this._useSession(async r=>{var n,l;const{data:u,error:f}=r;if(f)return this._returnResult({data:null,error:f});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:v,error:w}=await bn(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(n=u==null?void 0:u.session)===null||n===void 0?void 0:n.access_token});return w?this._returnResult({data:null,error:w}):(t.factorType==="totp"&&v.type==="totp"&&(!((l=v==null?void 0:v.totp)===null||l===void 0)&&l.qr_code)&&(v.totp.qr_code=`data:image/svg+xml;utf-8,${v.totp.qr_code}`),this._returnResult({data:v,error:null}))})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}}async _verify(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:l,error:u}=r;if(u)return this._returnResult({data:null,error:u});const f=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?v1e(t.webauthn.credential_response):x1e(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:v}=await bn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:f,headers:this.headers,jwt:(n=l==null?void 0:l.session)===null||n===void 0?void 0:n.access_token});return v?this._returnResult({data:null,error:v}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:v}))})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(t){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:l,error:u}=r;if(u)return this._returnResult({data:null,error:u});const f=await bn(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(n=l==null?void 0:l.session)===null||n===void 0?void 0:n.access_token});if(f.error)return f;const{data:o}=f;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:y1e(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:_1e(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(t){const{data:r,error:n}=await this._challenge({factorId:t.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){var t;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const l={all:[],phone:[],totp:[],webauthn:[]};for(const u of(t=r==null?void 0:r.factors)!==null&&t!==void 0?t:[])l.all.push(u),u.status==="verified"&&l[u.factor_type].push(u);return{data:l,error:null}}async _getAuthenticatorAssuranceLevel(){var t,r;const{data:{session:n},error:l}=await this.getSession();if(l)return this._returnResult({data:null,error:l});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:u}=eL(n.access_token);let f=null;u.aal&&(f=u.aal);let o=f;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(P=>P.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(o="aal2");const w=u.amr||[];return{data:{currentLevel:f,nextLevel:o,currentAuthenticationMethods:w},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async r=>{const{data:{session:n},error:l}=r;return l?this._returnResult({data:null,error:l}):n?await bn(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:n.access_token,xform:u=>({data:u,error:null})}):this._returnResult({data:null,error:new Yl})})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:l},error:u}=n;if(u)return this._returnResult({data:null,error:u});if(!l)return this._returnResult({data:null,error:new Yl});const f=await bn(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:l.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return f.data&&f.data.redirect_url&&xa()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(f.data.redirect_url),f})}catch(n){if(tn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(t,r){try{return await this._useSession(async n=>{const{data:{session:l},error:u}=n;if(u)return this._returnResult({data:null,error:u});if(!l)return this._returnResult({data:null,error:new Yl});const f=await bn(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:l.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return f.data&&f.data.redirect_url&&xa()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(f.data.redirect_url),f})}catch(n){if(tn(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async t=>{const{data:{session:r},error:n}=t;return n?this._returnResult({data:null,error:n}):r?await bn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:l=>({data:l,error:null})}):this._returnResult({data:null,error:new Yl})})}catch(t){if(tn(t))return this._returnResult({data:null,error:t});throw t}}async _revokeOAuthGrant(t){try{return await this._useSession(async r=>{const{data:{session:n},error:l}=r;return l?this._returnResult({data:null,error:l}):n?(await bn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:t.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Yl})})}catch(r){if(tn(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(t,r={keys:[]}){let n=r.keys.find(o=>o.kid===t);if(n)return n;const l=Date.now();if(n=this.jwks.keys.find(o=>o.kid===t),n&&this.jwks_cached_at+Pwe>l)return n;const{data:u,error:f}=await bn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return!u.keys||u.keys.length===0||(this.jwks=u,this.jwks_cached_at=l,n=u.keys.find(o=>o.kid===t),!n)?null:n}async getClaims(t,r={}){try{let n=t;if(!n){const{data:L,error:$}=await this.getSession();if($||!L.session)return this._returnResult({data:null,error:$});n=L.session.access_token}const{header:l,payload:u,signature:f,raw:{header:o,payload:v}}=eL(n);r!=null&&r.allowExpired||Kwe(u.exp);const w=!l.alg||l.alg.startsWith("HS")||!l.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(l.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!w){const{error:L}=await this.getUser(n);if(L)throw L;return{data:{claims:u,header:l,signature:f},error:null}}const P=Ywe(l.alg),C=await crypto.subtle.importKey("jwk",w,P,!0,["verify"]);if(!await crypto.subtle.verify(P,C,f,Nwe(`${o}.${v}`)))throw new jN("Invalid JWT signature");return{data:{claims:u,header:l,signature:f},error:null}}catch(n){if(tn(n))return this._returnResult({data:null,error:n});throw n}}}RS.nextInstanceID={};const I1e=RS,O1e="2.90.1";let b1="";typeof Deno<"u"?b1="deno":typeof document<"u"?b1="web":typeof navigator<"u"&&navigator.product==="ReactNative"?b1="react-native":b1="node";const k1e={"X-Client-Info":`supabase-js-${b1}/${O1e}`},R1e={headers:k1e},M1e={schema:"public"},D1e={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},L1e={};function MS(e){"@babel/helpers - typeof";return MS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},MS(e)}function j1e(e,t){if(MS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(MS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function N1e(e){var t=j1e(e,"string");return MS(t)=="symbol"?t:t+""}function z1e(e,t,r){return(t=N1e(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Iq(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function rs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Iq(Object(r),!0).forEach(function(n){z1e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iq(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}const F1e=e=>e?(...t)=>e(...t):(...t)=>fetch(...t),B1e=()=>Headers,$1e=(e,t,r)=>{const n=F1e(r),l=B1e();return async(u,f)=>{var o;const v=(o=await t())!==null&&o!==void 0?o:e;let w=new l(f==null?void 0:f.headers);return w.has("apikey")||w.set("apikey",e),w.has("Authorization")||w.set("Authorization",`Bearer ${v}`),n(u,rs(rs({},f),{},{headers:w}))}};function V1e(e){return e.endsWith("/")?e:e+"/"}function U1e(e,t){var r,n;const{db:l,auth:u,realtime:f,global:o}=e,{db:v,auth:w,realtime:P,global:C}=t,k={db:rs(rs({},v),l),auth:rs(rs({},w),u),realtime:rs(rs({},P),f),storage:{},global:rs(rs(rs({},C),o),{},{headers:rs(rs({},(r=C==null?void 0:C.headers)!==null&&r!==void 0?r:{}),(n=o==null?void 0:o.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return e.accessToken?k.accessToken=e.accessToken:delete k.accessToken,k}function G1e(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(V1e(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var q1e=class extends I1e{constructor(e){super(e)}},H1e=class{constructor(e,t,r){var n,l;this.supabaseUrl=e,this.supabaseKey=t;const u=G1e(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",u),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",u),this.storageUrl=new URL("storage/v1",u),this.functionsUrl=new URL("functions/v1",u);const f=`sb-${u.hostname.split(".")[0]}-auth-token`,o={db:M1e,realtime:L1e,auth:rs(rs({},D1e),{},{storageKey:f}),global:R1e},v=U1e(r??{},o);if(this.storageKey=(n=v.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(l=v.global.headers)!==null&&l!==void 0?l:{},v.accessToken)this.accessToken=v.accessToken,this.auth=new Proxy({},{get:(P,C)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(C)} is not possible`)}});else{var w;this.auth=this._initSupabaseAuthClient((w=v.auth)!==null&&w!==void 0?w:{},this.headers,v.global.fetch)}this.fetch=$1e(t,this._getAccessToken.bind(this),v.global.fetch),this.realtime=this._initRealtimeClient(rs({headers:this.headers,accessToken:this._getAccessToken.bind(this)},v.realtime)),this.accessToken&&this.accessToken().then(P=>this.realtime.setAuth(P)).catch(P=>console.warn("Failed to set initial Realtime auth token:",P)),this.rest=new Ebe(new URL("rest/v1",u).href,{headers:this.headers,schema:v.db.schema,fetch:this.fetch}),this.storage=new wwe(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),v.accessToken||this._listenForAuthEvents()}get functions(){return new xbe(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e=this,t,r;if(e.accessToken)return await e.accessToken();const{data:n}=await e.auth.getSession();return(t=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&t!==void 0?t:e.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:l,storageKey:u,flowType:f,lock:o,debug:v,throwOnError:w},P,C){const k={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new q1e({url:this.authUrl.href,headers:rs(rs({},k),P),storageKey:u,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,userStorage:l,flowType:f,lock:o,debug:v,throwOnError:w,fetch:C,hasCustomAuthorizationHeader:Object.keys(this.headers).some(L=>L.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new Vbe(this.realtimeUrl.href,rs(rs({},e),{},{params:rs(rs({},{apikey:this.supabaseKey}),e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",t==null?void 0:t.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const W1e=(e,t,r)=>new H1e(e,t,r);function Z1e(){if(typeof window<"u")return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(t==null)return!1;const r=t.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}Z1e()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const X1e="https://mvaejxzbnssyewddscjy.supabase.co",K1e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12YWVqeHpibnNzeWV3ZGRzY2p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MzQ4ODUsImV4cCI6MjA4NDAxMDg4NX0.jRiLRvpqQdr7lG7yq8Dao3TSdeEvvFJckDuZgcgmH3E",ni=W1e(X1e,K1e,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),hee=X.createContext(void 0);function Y1e({children:e}){const[t,r]=X.useState(null),[n,l]=X.useState(null),[u,f]=X.useState(!0),[o,v]=X.useState(!1);X.useEffect(()=>{const{data:{subscription:L}}=ni.auth.onAuthStateChange(($,j)=>{l(j),r((j==null?void 0:j.user)??null),j!=null&&j.user?setTimeout(()=>{w(j.user.id)},0):v(!1)});return ni.auth.getSession().then(({data:{session:$}})=>{l($),r(($==null?void 0:$.user)??null),$!=null&&$.user&&w($.user.id),f(!1)}),()=>L.unsubscribe()},[]);const w=async L=>{try{const{data:$,error:j}=await ni.from("user_roles").select("role").eq("user_id",L).eq("role","admin").maybeSingle();if(j){console.error("Error checking admin role:",j),v(!1);return}v(!!$)}catch($){console.error("Error checking admin role:",$),v(!1)}},P=async(L,$)=>{const{error:j}=await ni.auth.signInWithPassword({email:L,password:$});return{error:j}},C=async(L,$,j)=>{const B=`${window.location.origin}/`,{error:U}=await ni.auth.signUp({email:L,password:$,options:{emailRedirectTo:B,data:{name:j||""}}});return{error:U}},k=async()=>{await ni.auth.signOut(),r(null),l(null),v(!1)};return A.jsx(hee.Provider,{value:{user:t,session:n,isLoading:u,isAdmin:o,signIn:P,signUp:C,signOut:k},children:e})}function sf(){const e=X.useContext(hee);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e}const PB=jT("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),fn=X.forwardRef(({className:e,variant:t,size:r,asChild:n=!1,...l},u)=>{const f=n?nJ:"button";return A.jsx(f,{className:sr(PB({variant:t,size:r,className:e})),ref:u,...l})});fn.displayName="Button";function J1e(){const{user:e}=sf(),t=Ty(),[r,n]=X.useState(!1),[l,u]=X.useState(!1);X.useEffect(()=>{const v=()=>{u(window.scrollY>50)};return window.addEventListener("scroll",v),()=>window.removeEventListener("scroll",v)},[]);const f=[{href:"/",label:"Home"},{href:"/listings",label:"Properties"},{href:"/contact",label:"Contact"}],o=v=>t.pathname===v;return A.jsxs("header",{className:sr("fixed top-0 left-0 right-0 z-50 transition-all duration-500",l?"py-3 bg-white shadow-elegant":"py-5 bg-transparent"),children:[A.jsxs("div",{className:"container flex items-center justify-between",children:[A.jsx("nav",{className:"hidden md:flex items-center gap-8",children:f.slice(0,2).map(v=>A.jsx(xi,{to:v.href,className:sr("text-sm font-medium uppercase tracking-luxury link-underline transition-colors duration-300",l?o(v.href)?"text-foreground":"text-muted-foreground hover:text-foreground":o(v.href)?"text-white":"text-white/80 hover:text-white"),children:v.label},v.href))}),A.jsx(xi,{to:"/",className:"flex items-center gap-3 group absolute left-1/2 transform -translate-x-1/2",children:A.jsxs("div",{className:"text-center",children:[A.jsx("span",{className:sr("font-display text-2xl md:text-3xl font-semibold tracking-wide transition-colors duration-300",l?"text-foreground":"text-white"),children:"PRESTIGE"}),A.jsx("div",{className:sr("text-[10px] uppercase tracking-luxury transition-colors duration-300",l?"text-muted-foreground":"text-white/70"),children:"Real Estate"})]})}),A.jsxs("nav",{className:"hidden md:flex items-center gap-8",children:[A.jsx(xi,{to:"/contact",className:sr("text-sm font-medium uppercase tracking-luxury link-underline transition-colors duration-300",l?o("/contact")?"text-foreground":"text-muted-foreground hover:text-foreground":o("/contact")?"text-white":"text-white/80 hover:text-white"),children:"Contact"}),e?A.jsx(xi,{to:"/admin",className:sr("text-sm font-medium uppercase tracking-luxury transition-colors duration-300",l?"text-foreground":"text-white"),children:"Dashboard"}):A.jsx(xi,{to:"/auth",className:sr("text-sm font-medium uppercase tracking-luxury transition-colors duration-300",l?"text-foreground":"text-white"),children:"Sign In"})]}),A.jsx("button",{className:sr("md:hidden p-2 transition-colors",l?"text-foreground":"text-white"),onClick:()=>n(!r),"aria-label":"Toggle menu",children:r?A.jsx(Hp,{className:"h-6 w-6"}):A.jsx(LJ,{className:"h-6 w-6"})})]}),A.jsx("div",{className:sr("md:hidden absolute top-full left-0 right-0 bg-white shadow-elegant transition-all duration-300 overflow-hidden",r?"max-h-96 opacity-100":"max-h-0 opacity-0"),children:A.jsxs("nav",{className:"container py-6 flex flex-col gap-1",children:[f.map(v=>A.jsx(xi,{to:v.href,onClick:()=>n(!1),className:sr("px-4 py-3 text-sm font-medium uppercase tracking-luxury transition-all",o(v.href)?"text-foreground bg-secondary":"text-muted-foreground hover:text-foreground hover:bg-secondary"),children:v.label},v.href)),A.jsx("div",{className:"pt-4 mt-2 border-t",children:e?A.jsx(fn,{asChild:!0,className:"w-full btn-primary",children:A.jsx(xi,{to:"/admin",onClick:()=>n(!1),children:"Dashboard"})}):A.jsx(fn,{asChild:!0,className:"w-full btn-primary",children:A.jsx(xi,{to:"/auth",onClick:()=>n(!1),children:"Sign In"})})})]})})]})}function Q1e(){return A.jsx("footer",{className:"bg-primary text-primary-foreground",children:A.jsxs("div",{className:"container py-16",children:[A.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12",children:[A.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[A.jsxs(xi,{to:"/",className:"block",children:[A.jsx("span",{className:"font-display text-2xl font-semibold tracking-wide",children:"PRESTIGE"}),A.jsx("div",{className:"text-[10px] uppercase tracking-luxury text-primary-foreground/60",children:"Real Estate"})]}),A.jsx("p",{className:"text-primary-foreground/70 text-sm leading-relaxed",children:"Your trusted partner in finding exceptional properties. We make your real estate dreams a reality."})]}),A.jsxs("div",{children:[A.jsx("h4",{className:"font-sans font-semibold text-sm uppercase tracking-luxury mb-6",children:"Navigation"}),A.jsx("ul",{className:"space-y-3",children:[{to:"/",label:"Home"},{to:"/listings",label:"Properties"},{to:"/contact",label:"Contact"}].map(e=>A.jsx("li",{children:A.jsx(xi,{to:e.to,className:"text-sm text-primary-foreground/70 hover:text-primary-foreground transition-colors",children:e.label})},e.to))})]}),A.jsxs("div",{children:[A.jsx("h4",{className:"font-sans font-semibold text-sm uppercase tracking-luxury mb-6",children:"Contact"}),A.jsxs("ul",{className:"space-y-3 text-sm text-primary-foreground/70",children:[A.jsxs("li",{className:"flex items-center gap-3",children:[A.jsx(xS,{className:"h-4 w-4 text-accent"}),A.jsx("span",{children:"(555) 123-4567"})]}),A.jsxs("li",{className:"flex items-center gap-3",children:[A.jsx(T0,{className:"h-4 w-4 text-accent"}),A.jsx("span",{children:"info@prestige.com"})]}),A.jsxs("li",{className:"flex items-start gap-3",children:[A.jsx(Oh,{className:"h-4 w-4 text-accent shrink-0 mt-0.5"}),A.jsxs("span",{children:["123 Main Street",A.jsx("br",{}),"Albuquerque, NM 87101"]})]})]})]}),A.jsxs("div",{children:[A.jsx("h4",{className:"font-sans font-semibold text-sm uppercase tracking-luxury mb-6",children:"Follow Us"}),A.jsx("div",{className:"flex gap-3",children:[{icon:Eye,href:"#"},{icon:wye,href:"#"},{icon:Iye,href:"#"}].map((e,t)=>A.jsx("a",{href:e.href,className:"h-10 w-10 border border-primary-foreground/20 flex items-center justify-center hover:bg-primary-foreground hover:text-primary transition-all duration-300",children:A.jsx(e.icon,{className:"h-4 w-4"})},t))})]})]}),A.jsxs("div",{className:"border-t border-primary-foreground/10 mt-12 pt-8 flex flex-col md:flex-row items-center justify-between gap-4",children:[A.jsxs("p",{className:"text-primary-foreground/50 text-xs uppercase tracking-wide",children:[" ",new Date().getFullYear()," Prestige Realty. All rights reserved."]}),A.jsxs("div",{className:"flex gap-6 text-xs uppercase tracking-wide text-primary-foreground/50",children:[A.jsx("a",{href:"#",className:"hover:text-primary-foreground transition-colors",children:"Privacy Policy"}),A.jsx("a",{href:"#",className:"hover:text-primary-foreground transition-colors",children:"Terms of Service"})]})]})]})})}function B1({children:e}){return A.jsxs("div",{className:"min-h-screen flex flex-col",children:[A.jsx(J1e,{}),A.jsx("main",{className:"flex-1",children:e}),A.jsx(Q1e,{})]})}const eSe=jT("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function Dh({className:e,variant:t,...r}){return A.jsx("div",{className:sr(eSe({variant:t}),e),...r})}function BT(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function zC(e){return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function tSe(e){return{house:"House",condo:"Condo",townhouse:"Townhouse",land:"Land",multi_family:"Multi-Family",commercial:"Commercial",other:"Other"}[e]||e}function CB(e){return{for_sale:"For Sale",for_rent:"For Rent",sold:"Sold",pending:"Pending"}[e]||e}function IB(e){return{for_sale:"bg-success text-white",for_rent:"bg-primary text-white",sold:"bg-muted text-muted-foreground",pending:"bg-accent text-white"}[e]||"bg-muted text-muted-foreground"}const OB=X.createContext({});function kB(e){const t=X.useRef(null);return t.current===null&&(t.current=e()),t.current}const fee=typeof window<"u",pee=fee?X.useLayoutEffect:X.useEffect,jO=X.createContext(null);function RB(e,t){e.indexOf(t)===-1&&e.push(t)}function MB(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}const qd=(e,t,r)=>r>t?t:r<e?e:r;let NO=()=>{},C0=()=>{};const Kh={},mee=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function gee(e){return typeof e=="object"&&e!==null}const yee=e=>/^0[^.\s]+$/u.test(e);function DB(e){let t;return()=>(t===void 0&&(t=e()),t)}const Zc=e=>e,rSe=(e,t)=>r=>t(e(r)),$T=(...e)=>e.reduce(rSe),DS=(e,t,r)=>{const n=t-e;return n===0?1:(r-e)/n};class LB{constructor(){this.subscriptions=[]}add(t){return RB(this.subscriptions,t),()=>MB(this.subscriptions,t)}notify(t,r,n){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,r,n);else for(let u=0;u<l;u++){const f=this.subscriptions[u];f&&f(t,r,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const zd=e=>e*1e3,qc=e=>e/1e3;function _ee(e,t){return t?e*(1e3/t):0}const vee=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,nSe=1e-7,iSe=12;function oSe(e,t,r,n,l){let u,f,o=0;do f=t+(r-t)/2,u=vee(f,n,l)-e,u>0?r=f:t=f;while(Math.abs(u)>nSe&&++o<iSe);return f}function VT(e,t,r,n){if(e===t&&r===n)return Zc;const l=u=>oSe(u,0,1,e,r);return u=>u===0||u===1?u:vee(l(u),t,n)}const xee=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,bee=e=>t=>1-e(1-t),wee=VT(.33,1.53,.69,.99),jB=bee(wee),See=xee(jB),Tee=e=>(e*=2)<1?.5*jB(e):.5*(2-Math.pow(2,-10*(e-1))),NB=e=>1-Math.sin(Math.acos(e)),Eee=bee(NB),Aee=xee(NB),sSe=VT(.42,0,1,1),aSe=VT(0,0,.58,1),Pee=VT(.42,0,.58,1),lSe=e=>Array.isArray(e)&&typeof e[0]!="number",Cee=e=>Array.isArray(e)&&typeof e[0]=="number",Oq={linear:Zc,easeIn:sSe,easeInOut:Pee,easeOut:aSe,circIn:NB,circInOut:Aee,circOut:Eee,backIn:jB,backInOut:See,backOut:wee,anticipate:Tee},cSe=e=>typeof e=="string",kq=e=>{if(Cee(e)){C0(e.length===4,"Cubic bezier arrays must contain four numerical values.","cubic-bezier-length");const[t,r,n,l]=e;return VT(t,r,n,l)}else if(cSe(e))return C0(Oq[e]!==void 0,`Invalid easing type '${e}'`,"invalid-easing-type"),Oq[e];return e},aP=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],Rq={value:null,addProjectionMetrics:null};function uSe(e,t){let r=new Set,n=new Set,l=!1,u=!1;const f=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},v=0;function w(C){f.has(C)&&(P.schedule(C),e()),v++,C(o)}const P={schedule:(C,k=!1,L=!1)=>{const j=L&&l?r:n;return k&&f.add(C),j.has(C)||j.add(C),C},cancel:C=>{n.delete(C),f.delete(C)},process:C=>{if(o=C,l){u=!0;return}l=!0,[r,n]=[n,r],r.forEach(w),t&&Rq.value&&Rq.value.frameloop[t].push(v),v=0,r.clear(),l=!1,u&&(u=!1,P.process(C))}};return P}const dSe=40;function Iee(e,t){let r=!1,n=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>r=!0,f=aP.reduce((H,te)=>(H[te]=uSe(u,t?te:void 0),H),{}),{setup:o,read:v,resolveKeyframes:w,preUpdate:P,update:C,preRender:k,render:L,postRender:$}=f,j=()=>{const H=Kh.useManualTiming?l.timestamp:performance.now();r=!1,Kh.useManualTiming||(l.delta=n?1e3/60:Math.max(Math.min(H-l.timestamp,dSe),1)),l.timestamp=H,l.isProcessing=!0,o.process(l),v.process(l),w.process(l),P.process(l),C.process(l),k.process(l),L.process(l),$.process(l),l.isProcessing=!1,r&&t&&(n=!1,e(j))},B=()=>{r=!0,n=!0,l.isProcessing||e(j)};return{schedule:aP.reduce((H,te)=>{const Q=f[te];return H[te]=(ae,ue=!1,me=!1)=>(r||B(),Q.schedule(ae,ue,me)),H},{}),cancel:H=>{for(let te=0;te<aP.length;te++)f[aP[te]].cancel(H)},state:l,steps:f}}const{schedule:Ao,cancel:Xp,state:Sa,steps:nL}=Iee(typeof requestAnimationFrame<"u"?requestAnimationFrame:Zc,!0);let HP;function hSe(){HP=void 0}const pl={now:()=>(HP===void 0&&pl.set(Sa.isProcessing||Kh.useManualTiming?Sa.timestamp:performance.now()),HP),set:e=>{HP=e,queueMicrotask(hSe)}},Oee=e=>t=>typeof t=="string"&&t.startsWith(e),kee=Oee("--"),fSe=Oee("var(--"),zB=e=>fSe(e)?pSe.test(e.split("/*")[0].trim()):!1,pSe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Mq(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const vx={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},LS={...vx,transform:e=>qd(0,1,e)},lP={...vx,default:1},$1=e=>Math.round(e*1e5)/1e5,FB=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function mSe(e){return e==null}const gSe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,BB=(e,t)=>r=>!!(typeof r=="string"&&gSe.test(r)&&r.startsWith(e)||t&&!mSe(r)&&Object.prototype.hasOwnProperty.call(r,t)),Ree=(e,t,r)=>n=>{if(typeof n!="string")return n;const[l,u,f,o]=n.match(FB);return{[e]:parseFloat(l),[t]:parseFloat(u),[r]:parseFloat(f),alpha:o!==void 0?parseFloat(o):1}},ySe=e=>qd(0,255,e),iL={...vx,transform:e=>Math.round(ySe(e))},Ig={test:BB("rgb","red"),parse:Ree("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:n=1})=>"rgba("+iL.transform(e)+", "+iL.transform(t)+", "+iL.transform(r)+", "+$1(LS.transform(n))+")"};function _Se(e){let t="",r="",n="",l="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),n=e.substring(5,7),l=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),n=e.substring(3,4),l=e.substring(4,5),t+=t,r+=r,n+=n,l+=l),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(n,16),alpha:l?parseInt(l,16)/255:1}}const NN={test:BB("#"),parse:_Se,transform:Ig.transform},UT=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),np=UT("deg"),Fd=UT("%"),Nr=UT("px"),vSe=UT("vh"),xSe=UT("vw"),Dq={...Fd,parse:e=>Fd.parse(e)/100,transform:e=>Fd.transform(e*100)},Rv={test:BB("hsl","hue"),parse:Ree("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:n=1})=>"hsla("+Math.round(e)+", "+Fd.transform($1(t))+", "+Fd.transform($1(r))+", "+$1(LS.transform(n))+")"},ws={test:e=>Ig.test(e)||NN.test(e)||Rv.test(e),parse:e=>Ig.test(e)?Ig.parse(e):Rv.test(e)?Rv.parse(e):NN.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Ig.transform(e):Rv.transform(e),getAnimatableNone:e=>{const t=ws.parse(e);return t.alpha=0,ws.transform(t)}},bSe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function wSe(e){var t,r;return isNaN(e)&&typeof e=="string"&&(((t=e.match(FB))==null?void 0:t.length)||0)+(((r=e.match(bSe))==null?void 0:r.length)||0)>0}const Mee="number",Dee="color",SSe="var",TSe="var(",Lq="${}",ESe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function jS(e){const t=e.toString(),r=[],n={color:[],number:[],var:[]},l=[];let u=0;const o=t.replace(ESe,v=>(ws.test(v)?(n.color.push(u),l.push(Dee),r.push(ws.parse(v))):v.startsWith(TSe)?(n.var.push(u),l.push(SSe),r.push(v)):(n.number.push(u),l.push(Mee),r.push(parseFloat(v))),++u,Lq)).split(Lq);return{values:r,split:o,indexes:n,types:l}}function Lee(e){return jS(e).values}function jee(e){const{split:t,types:r}=jS(e),n=t.length;return l=>{let u="";for(let f=0;f<n;f++)if(u+=t[f],l[f]!==void 0){const o=r[f];o===Mee?u+=$1(l[f]):o===Dee?u+=ws.transform(l[f]):u+=l[f]}return u}}const ASe=e=>typeof e=="number"?0:ws.test(e)?ws.getAnimatableNone(e):e;function PSe(e){const t=Lee(e);return jee(e)(t.map(ASe))}const Kp={test:wSe,parse:Lee,createTransformer:jee,getAnimatableNone:PSe};function oL(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function CSe({hue:e,saturation:t,lightness:r,alpha:n}){e/=360,t/=100,r/=100;let l=0,u=0,f=0;if(!t)l=u=f=r;else{const o=r<.5?r*(1+t):r+t-r*t,v=2*r-o;l=oL(v,o,e+1/3),u=oL(v,o,e),f=oL(v,o,e-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:n}}function FC(e,t){return r=>r>0?t:e}const Go=(e,t,r)=>e+(t-e)*r,sL=(e,t,r)=>{const n=e*e,l=r*(t*t-n)+n;return l<0?0:Math.sqrt(l)},ISe=[NN,Ig,Rv],OSe=e=>ISe.find(t=>t.test(e));function jq(e){const t=OSe(e);if(NO(!!t,`'${e}' is not an animatable color. Use the equivalent color code instead.`,"color-not-animatable"),!t)return!1;let r=t.parse(e);return t===Rv&&(r=CSe(r)),r}const Nq=(e,t)=>{const r=jq(e),n=jq(t);if(!r||!n)return FC(e,t);const l={...r};return u=>(l.red=sL(r.red,n.red,u),l.green=sL(r.green,n.green,u),l.blue=sL(r.blue,n.blue,u),l.alpha=Go(r.alpha,n.alpha,u),Ig.transform(l))},zN=new Set(["none","hidden"]);function kSe(e,t){return zN.has(e)?r=>r<=0?e:t:r=>r>=1?t:e}function RSe(e,t){return r=>Go(e,t,r)}function $B(e){return typeof e=="number"?RSe:typeof e=="string"?zB(e)?FC:ws.test(e)?Nq:LSe:Array.isArray(e)?Nee:typeof e=="object"?ws.test(e)?Nq:MSe:FC}function Nee(e,t){const r=[...e],n=r.length,l=e.map((u,f)=>$B(u)(u,t[f]));return u=>{for(let f=0;f<n;f++)r[f]=l[f](u);return r}}function MSe(e,t){const r={...e,...t},n={};for(const l in r)e[l]!==void 0&&t[l]!==void 0&&(n[l]=$B(e[l])(e[l],t[l]));return l=>{for(const u in n)r[u]=n[u](l);return r}}function DSe(e,t){const r=[],n={color:0,var:0,number:0};for(let l=0;l<t.values.length;l++){const u=t.types[l],f=e.indexes[u][n[u]],o=e.values[f]??0;r[l]=o,n[u]++}return r}const LSe=(e,t)=>{const r=Kp.createTransformer(t),n=jS(e),l=jS(t);return n.indexes.var.length===l.indexes.var.length&&n.indexes.color.length===l.indexes.color.length&&n.indexes.number.length>=l.indexes.number.length?zN.has(e)&&!l.values.length||zN.has(t)&&!n.values.length?kSe(e,t):$T(Nee(DSe(n,l),l.values),r):(NO(!0,`Complex values '${e}' and '${t}' too different to mix. Ensure all colors are of the same type, and that each contains the same quantity of number and color values. Falling back to instant transition.`,"complex-values-different"),FC(e,t))};function zee(e,t,r){return typeof e=="number"&&typeof t=="number"&&typeof r=="number"?Go(e,t,r):$B(e)(e,t)}const jSe=e=>{const t=({timestamp:r})=>e(r);return{start:(r=!0)=>Ao.update(t,r),stop:()=>Xp(t),now:()=>Sa.isProcessing?Sa.timestamp:pl.now()}},Fee=(e,t,r=10)=>{let n="";const l=Math.max(Math.round(t/r),2);for(let u=0;u<l;u++)n+=Math.round(e(u/(l-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},BC=2e4;function VB(e){let t=0;const r=50;let n=e.next(t);for(;!n.done&&t<BC;)t+=r,n=e.next(t);return t>=BC?1/0:t}function NSe(e,t=100,r){const n=r({...e,keyframes:[0,t]}),l=Math.min(VB(n),BC);return{type:"keyframes",ease:u=>n.next(l*u).value/t,duration:qc(l)}}const zSe=5;function Bee(e,t,r){const n=Math.max(t-zSe,0);return _ee(r-e(n),t-n)}const Bo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},aL=.001;function FSe({duration:e=Bo.duration,bounce:t=Bo.bounce,velocity:r=Bo.velocity,mass:n=Bo.mass}){let l,u;NO(e<=zd(Bo.maxDuration),"Spring duration must be 10 seconds or less","spring-duration-limit");let f=1-t;f=qd(Bo.minDamping,Bo.maxDamping,f),e=qd(Bo.minDuration,Bo.maxDuration,qc(e)),f<1?(l=w=>{const P=w*f,C=P*e,k=P-r,L=FN(w,f),$=Math.exp(-C);return aL-k/L*$},u=w=>{const C=w*f*e,k=C*r+r,L=Math.pow(f,2)*Math.pow(w,2)*e,$=Math.exp(-C),j=FN(Math.pow(w,2),f);return(-l(w)+aL>0?-1:1)*((k-L)*$)/j}):(l=w=>{const P=Math.exp(-w*e),C=(w-r)*e+1;return-aL+P*C},u=w=>{const P=Math.exp(-w*e),C=(r-w)*(e*e);return P*C});const o=5/e,v=$Se(l,u,o);if(e=zd(e),isNaN(v))return{stiffness:Bo.stiffness,damping:Bo.damping,duration:e};{const w=Math.pow(v,2)*n;return{stiffness:w,damping:f*2*Math.sqrt(n*w),duration:e}}}const BSe=12;function $Se(e,t,r){let n=r;for(let l=1;l<BSe;l++)n=n-e(n)/t(n);return n}function FN(e,t){return e*Math.sqrt(1-t*t)}const VSe=["duration","bounce"],USe=["stiffness","damping","mass"];function zq(e,t){return t.some(r=>e[r]!==void 0)}function GSe(e){let t={velocity:Bo.velocity,stiffness:Bo.stiffness,damping:Bo.damping,mass:Bo.mass,isResolvedFromDuration:!1,...e};if(!zq(e,USe)&&zq(e,VSe))if(e.visualDuration){const r=e.visualDuration,n=2*Math.PI/(r*1.2),l=n*n,u=2*qd(.05,1,1-(e.bounce||0))*Math.sqrt(l);t={...t,mass:Bo.mass,stiffness:l,damping:u}}else{const r=FSe(e);t={...t,...r,mass:Bo.mass},t.isResolvedFromDuration=!0}return t}function $C(e=Bo.visualDuration,t=Bo.bounce){const r=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:n,restDelta:l}=r;const u=r.keyframes[0],f=r.keyframes[r.keyframes.length-1],o={done:!1,value:u},{stiffness:v,damping:w,mass:P,duration:C,velocity:k,isResolvedFromDuration:L}=GSe({...r,velocity:-qc(r.velocity||0)}),$=k||0,j=w/(2*Math.sqrt(v*P)),B=f-u,U=qc(Math.sqrt(v/P)),q=Math.abs(B)<5;n||(n=q?Bo.restSpeed.granular:Bo.restSpeed.default),l||(l=q?Bo.restDelta.granular:Bo.restDelta.default);let H;if(j<1){const Q=FN(U,j);H=ae=>{const ue=Math.exp(-j*U*ae);return f-ue*(($+j*U*B)/Q*Math.sin(Q*ae)+B*Math.cos(Q*ae))}}else if(j===1)H=Q=>f-Math.exp(-U*Q)*(B+($+U*B)*Q);else{const Q=U*Math.sqrt(j*j-1);H=ae=>{const ue=Math.exp(-j*U*ae),me=Math.min(Q*ae,300);return f-ue*(($+j*U*B)*Math.sinh(me)+Q*B*Math.cosh(me))/Q}}const te={calculatedDuration:L&&C||null,next:Q=>{const ae=H(Q);if(L)o.done=Q>=C;else{let ue=Q===0?$:0;j<1&&(ue=Q===0?zd($):Bee(H,Q,ae));const me=Math.abs(ue)<=n,Ce=Math.abs(f-ae)<=l;o.done=me&&Ce}return o.value=o.done?f:ae,o},toString:()=>{const Q=Math.min(VB(te),BC),ae=Fee(ue=>te.next(Q*ue).value,Q,30);return Q+"ms "+ae},toTransition:()=>{}};return te}$C.applyToOptions=e=>{const t=NSe(e,100,$C);return e.ease=t.ease,e.duration=zd(t.duration),e.type="keyframes",e};function BN({keyframes:e,velocity:t=0,power:r=.8,timeConstant:n=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:f,min:o,max:v,restDelta:w=.5,restSpeed:P}){const C=e[0],k={done:!1,value:C},L=me=>o!==void 0&&me<o||v!==void 0&&me>v,$=me=>o===void 0?v:v===void 0||Math.abs(o-me)<Math.abs(v-me)?o:v;let j=r*t;const B=C+j,U=f===void 0?B:f(B);U!==B&&(j=U-C);const q=me=>-j*Math.exp(-me/n),H=me=>U+q(me),te=me=>{const Ce=q(me),Fe=H(me);k.done=Math.abs(Ce)<=w,k.value=k.done?U:Fe};let Q,ae;const ue=me=>{L(k.value)&&(Q=me,ae=$C({keyframes:[k.value,$(k.value)],velocity:Bee(H,me,k.value),damping:l,stiffness:u,restDelta:w,restSpeed:P}))};return ue(0),{calculatedDuration:null,next:me=>{let Ce=!1;return!ae&&Q===void 0&&(Ce=!0,te(me),ue(me)),Q!==void 0&&me>=Q?ae.next(me-Q):(!Ce&&te(me),k)}}}function qSe(e,t,r){const n=[],l=r||Kh.mix||zee,u=e.length-1;for(let f=0;f<u;f++){let o=l(e[f],e[f+1]);if(t){const v=Array.isArray(t)?t[f]||Zc:t;o=$T(v,o)}n.push(o)}return n}function HSe(e,t,{clamp:r=!0,ease:n,mixer:l}={}){const u=e.length;if(C0(u===t.length,"Both input and output ranges must be the same length","range-length"),u===1)return()=>t[0];if(u===2&&t[0]===t[1])return()=>t[1];const f=e[0]===e[1];e[0]>e[u-1]&&(e=[...e].reverse(),t=[...t].reverse());const o=qSe(t,n,l),v=o.length,w=P=>{if(f&&P<e[0])return t[0];let C=0;if(v>1)for(;C<e.length-2&&!(P<e[C+1]);C++);const k=DS(e[C],e[C+1],P);return o[C](k)};return r?P=>w(qd(e[0],e[u-1],P)):w}function WSe(e,t){const r=e[e.length-1];for(let n=1;n<=t;n++){const l=DS(0,t,n);e.push(Go(r,1,l))}}function ZSe(e){const t=[0];return WSe(t,e.length-1),t}function XSe(e,t){return e.map(r=>r*t)}function KSe(e,t){return e.map(()=>t||Pee).splice(0,e.length-1)}function V1({duration:e=300,keyframes:t,times:r,ease:n="easeInOut"}){const l=lSe(n)?n.map(kq):kq(n),u={done:!1,value:t[0]},f=XSe(r&&r.length===t.length?r:ZSe(t),e),o=HSe(f,t,{ease:Array.isArray(l)?l:KSe(t,l)});return{calculatedDuration:e,next:v=>(u.value=o(v),u.done=v>=e,u)}}const YSe=e=>e!==null;function UB(e,{repeat:t,repeatType:r="loop"},n,l=1){const u=e.filter(YSe),o=l<0||t&&r!=="loop"&&t%2===1?0:u.length-1;return!o||n===void 0?u[o]:n}const JSe={decay:BN,inertia:BN,tween:V1,keyframes:V1,spring:$C};function $ee(e){typeof e.type=="string"&&(e.type=JSe[e.type])}class GB{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,r){return this.finished.then(t,r)}}const QSe=e=>e/100;class qB extends GB{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,l;const{motionValue:r}=this.options;r&&r.updatedAt!==pl.now()&&this.tick(pl.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(l=(n=this.options).onStop)==null||l.call(n))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;$ee(t);const{type:r=V1,repeat:n=0,repeatDelay:l=0,repeatType:u,velocity:f=0}=t;let{keyframes:o}=t;const v=r||V1;v!==V1&&typeof o[0]!="number"&&(this.mixKeyframes=$T(QSe,zee(o[0],o[1])),o=[0,100]);const w=v({...t,keyframes:o});u==="mirror"&&(this.mirroredGenerator=v({...t,keyframes:[...o].reverse(),velocity:-f})),w.calculatedDuration===null&&(w.calculatedDuration=VB(w));const{calculatedDuration:P}=w;this.calculatedDuration=P,this.resolvedDuration=P+l,this.totalDuration=this.resolvedDuration*(n+1)-l,this.generator=w}updateTime(t){const r=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=r}tick(t,r=!1){const{generator:n,totalDuration:l,mixKeyframes:u,mirroredGenerator:f,resolvedDuration:o,calculatedDuration:v}=this;if(this.startTime===null)return n.next(0);const{delay:w=0,keyframes:P,repeat:C,repeatType:k,repeatDelay:L,type:$,onUpdate:j,finalKeyframe:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-l/this.speed,this.startTime)),r?this.currentTime=t:this.updateTime(t);const U=this.currentTime-w*(this.playbackSpeed>=0?1:-1),q=this.playbackSpeed>=0?U<0:U>l;this.currentTime=Math.max(U,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=l);let H=this.currentTime,te=n;if(C){const me=Math.min(this.currentTime,l)/o;let Ce=Math.floor(me),Fe=me%1;!Fe&&me>=1&&(Fe=1),Fe===1&&Ce--,Ce=Math.min(Ce,C+1),!!(Ce%2)&&(k==="reverse"?(Fe=1-Fe,L&&(Fe-=L/o)):k==="mirror"&&(te=f)),H=qd(0,1,Fe)*o}const Q=q?{done:!1,value:P[0]}:te.next(H);u&&(Q.value=u(Q.value));let{done:ae}=Q;!q&&v!==null&&(ae=this.playbackSpeed>=0?this.currentTime>=l:this.currentTime<=0);const ue=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ae);return ue&&$!==BN&&(Q.value=UB(P,this.options,B,this.speed)),j&&j(Q.value),ue&&this.finish(),Q}then(t,r){return this.finished.then(t,r)}get duration(){return qc(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+qc(t)}get time(){return qc(this.currentTime)}set time(t){var r;t=zd(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(r=this.driver)==null||r.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(pl.now());const r=this.playbackSpeed!==t;this.playbackSpeed=t,r&&(this.time=qc(this.currentTime))}play(){var l,u;if(this.isStopped)return;const{driver:t=jSe,startTime:r}=this.options;this.driver||(this.driver=t(f=>this.tick(f))),(u=(l=this.options).onPlay)==null||u.call(l);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=r??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(pl.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,r;this.notifyFinished(),this.teardown(),this.state="finished",(r=(t=this.options).onComplete)==null||r.call(t)}cancel(){var t,r;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(r=(t=this.options).onCancel)==null||r.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var r;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(r=this.driver)==null||r.stop(),t.observe(this)}}function eTe(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Og=e=>e*180/Math.PI,$N=e=>{const t=Og(Math.atan2(e[1],e[0]));return VN(t)},tTe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:$N,rotateZ:$N,skewX:e=>Og(Math.atan(e[1])),skewY:e=>Og(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},VN=e=>(e=e%360,e<0&&(e+=360),e),Fq=$N,Bq=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),$q=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),rTe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Bq,scaleY:$q,scale:e=>(Bq(e)+$q(e))/2,rotateX:e=>VN(Og(Math.atan2(e[6],e[5]))),rotateY:e=>VN(Og(Math.atan2(-e[2],e[0]))),rotateZ:Fq,rotate:Fq,skewX:e=>Og(Math.atan(e[4])),skewY:e=>Og(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function UN(e){return e.includes("scale")?1:0}function GN(e,t){if(!e||e==="none")return UN(t);const r=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,l;if(r)n=rTe,l=r;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=tTe,l=o}if(!l)return UN(t);const u=n[t],f=l[1].split(",").map(iTe);return typeof u=="function"?u(f):f[u]}const nTe=(e,t)=>{const{transform:r="none"}=getComputedStyle(e);return GN(r,t)};function iTe(e){return parseFloat(e.trim())}const xx=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],bx=new Set(xx),Vq=e=>e===vx||e===Nr,oTe=new Set(["x","y","z"]),sTe=xx.filter(e=>!oTe.has(e));function aTe(e){const t=[];return sTe.forEach(r=>{const n=e.getValue(r);n!==void 0&&(t.push([r,n.get()]),n.set(r.startsWith("scale")?1:0))}),t}const Cp={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>GN(t,"x"),y:(e,{transform:t})=>GN(t,"y")};Cp.translateX=Cp.x;Cp.translateY=Cp.y;const Wg=new Set;let qN=!1,HN=!1,WN=!1;function Vee(){if(HN){const e=Array.from(Wg).filter(n=>n.needsMeasurement),t=new Set(e.map(n=>n.element)),r=new Map;t.forEach(n=>{const l=aTe(n);l.length&&(r.set(n,l),n.render())}),e.forEach(n=>n.measureInitialState()),t.forEach(n=>{n.render();const l=r.get(n);l&&l.forEach(([u,f])=>{var o;(o=n.getValue(u))==null||o.set(f)})}),e.forEach(n=>n.measureEndState()),e.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}HN=!1,qN=!1,Wg.forEach(e=>e.complete(WN)),Wg.clear()}function Uee(){Wg.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(HN=!0)})}function lTe(){WN=!0,Uee(),Vee(),WN=!1}class HB{constructor(t,r,n,l,u,f=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=r,this.name=n,this.motionValue=l,this.element=u,this.isAsync=f}scheduleResolve(){this.state="scheduled",this.isAsync?(Wg.add(this),qN||(qN=!0,Ao.read(Uee),Ao.resolveKeyframes(Vee))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:r,element:n,motionValue:l}=this;if(t[0]===null){const u=l==null?void 0:l.get(),f=t[t.length-1];if(u!==void 0)t[0]=u;else if(n&&r){const o=n.readValue(r,f);o!=null&&(t[0]=o)}t[0]===void 0&&(t[0]=f),l&&u===void 0&&l.set(t[0])}eTe(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Wg.delete(this)}cancel(){this.state==="scheduled"&&(Wg.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const cTe=e=>e.startsWith("--");function uTe(e,t,r){cTe(t)?e.style.setProperty(t,r):e.style[t]=r}const dTe=DB(()=>window.ScrollTimeline!==void 0),hTe={};function fTe(e,t){const r=DB(e);return()=>hTe[t]??r()}const Gee=fTe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),w1=([e,t,r,n])=>`cubic-bezier(${e}, ${t}, ${r}, ${n})`,Uq={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:w1([0,.65,.55,1]),circOut:w1([.55,0,1,.45]),backIn:w1([.31,.01,.66,-.59]),backOut:w1([.33,1.53,.69,.99])};function qee(e,t){if(e)return typeof e=="function"?Gee()?Fee(e,t):"ease-out":Cee(e)?w1(e):Array.isArray(e)?e.map(r=>qee(r,t)||Uq.easeOut):Uq[e]}function pTe(e,t,r,{delay:n=0,duration:l=300,repeat:u=0,repeatType:f="loop",ease:o="easeOut",times:v}={},w=void 0){const P={[t]:r};v&&(P.offset=v);const C=qee(o,l);Array.isArray(C)&&(P.easing=C);const k={delay:n,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"};return w&&(k.pseudoElement=w),e.animate(P,k)}function Hee(e){return typeof e=="function"&&"applyToOptions"in e}function mTe({type:e,...t}){return Hee(e)&&Gee()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class gTe extends GB{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:r,name:n,keyframes:l,pseudoElement:u,allowFlatten:f=!1,finalKeyframe:o,onComplete:v}=t;this.isPseudoElement=!!u,this.allowFlatten=f,this.options=t,C0(typeof t.type!="string",`Mini animate() doesn't support "type" as a string.`,"mini-spring");const w=mTe(t);this.animation=pTe(r,n,l,w,u),w.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!u){const P=UB(l,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(P):uTe(r,n,P),this.animation.cancel()}v==null||v(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,r;(r=(t=this.animation).finish)==null||r.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var t,r;this.isPseudoElement||(r=(t=this.animation).commitStyles)==null||r.call(t)}get duration(){var r,n;const t=((n=(r=this.animation.effect)==null?void 0:r.getComputedTiming)==null?void 0:n.call(r).duration)||0;return qc(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+qc(t)}get time(){return qc(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=zd(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:r}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&dTe()?(this.animation.timeline=t,Zc):r(this)}}const Wee={anticipate:Tee,backInOut:See,circInOut:Aee};function yTe(e){return e in Wee}function _Te(e){typeof e.ease=="string"&&yTe(e.ease)&&(e.ease=Wee[e.ease])}const lL=10;class vTe extends gTe{constructor(t){_Te(t),$ee(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:r,onUpdate:n,onComplete:l,element:u,...f}=this.options;if(!r)return;if(t!==void 0){r.set(t);return}const o=new qB({...f,autoplay:!1}),v=Math.max(lL,pl.now()-this.startTime),w=qd(0,lL,v-lL);r.setWithVelocity(o.sample(Math.max(0,v-w)).value,o.sample(v).value,w),o.stop()}}const Gq=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Kp.test(e)||e==="0")&&!e.startsWith("url("));function xTe(e){const t=e[0];if(e.length===1)return!0;for(let r=0;r<e.length;r++)if(e[r]!==t)return!0}function bTe(e,t,r,n){const l=e[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const u=e[e.length-1],f=Gq(l,t),o=Gq(u,t);return NO(f===o,`You are trying to animate ${t} from "${l}" to "${u}". "${f?u:l}" is not an animatable value.`,"value-not-animatable"),!f||!o?!1:xTe(e)||(r==="spring"||Hee(r))&&n}function ZN(e){e.duration=0,e.type="keyframes"}const wTe=new Set(["opacity","clipPath","filter","transform"]),STe=DB(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function TTe(e){var P;const{motionValue:t,name:r,repeatDelay:n,repeatType:l,damping:u,type:f}=e;if(!(((P=t==null?void 0:t.owner)==null?void 0:P.current)instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:w}=t.owner.getProps();return STe()&&r&&wTe.has(r)&&(r!=="transform"||!w)&&!v&&!n&&l!=="mirror"&&u!==0&&f!=="inertia"}const ETe=40;class ATe extends GB{constructor({autoplay:t=!0,delay:r=0,type:n="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:f="loop",keyframes:o,name:v,motionValue:w,element:P,...C}){var $;super(),this.stop=()=>{var j,B;this._animation&&(this._animation.stop(),(j=this.stopTimeline)==null||j.call(this)),(B=this.keyframeResolver)==null||B.cancel()},this.createdAt=pl.now();const k={autoplay:t,delay:r,type:n,repeat:l,repeatDelay:u,repeatType:f,name:v,motionValue:w,element:P,...C},L=(P==null?void 0:P.KeyframeResolver)||HB;this.keyframeResolver=new L(o,(j,B,U)=>this.onKeyframesResolved(j,B,k,!U),v,w,P),($=this.keyframeResolver)==null||$.scheduleResolve()}onKeyframesResolved(t,r,n,l){this.keyframeResolver=void 0;const{name:u,type:f,velocity:o,delay:v,isHandoff:w,onUpdate:P}=n;this.resolvedAt=pl.now(),bTe(t,u,f,o)||((Kh.instantAnimations||!v)&&(P==null||P(UB(t,n,r))),t[0]=t[t.length-1],ZN(n),n.repeat=0);const k={startTime:l?this.resolvedAt?this.resolvedAt-this.createdAt>ETe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:r,...n,keyframes:t},L=!w&&TTe(k)?new vTe({...k,element:k.motionValue.owner.current}):new qB(k);L.finished.then(()=>this.notifyFinished()).catch(Zc),this.pendingTimeline&&(this.stopTimeline=L.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=L}get finished(){return this._animation?this.animation.finished:this._finished}then(t,r){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),lTe()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}const PTe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function CTe(e){const t=PTe.exec(e);if(!t)return[,];const[,r,n,l]=t;return[`--${r??n}`,l]}const ITe=4;function Zee(e,t,r=1){C0(r<=ITe,`Max CSS variable fallback depth detected in property "${e}". This may indicate a circular fallback dependency.`,"max-css-var-depth");const[n,l]=CTe(e);if(!n)return;const u=window.getComputedStyle(t).getPropertyValue(n);if(u){const f=u.trim();return mee(f)?parseFloat(f):f}return zB(l)?Zee(l,t,r+1):l}function WB(e,t){return(e==null?void 0:e[t])??(e==null?void 0:e.default)??e}const OTe={type:"spring",stiffness:500,damping:25,restSpeed:10},kTe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),RTe={type:"keyframes",duration:.8},MTe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},DTe=(e,{keyframes:t})=>t.length>2?RTe:bx.has(e)?e.startsWith("scale")?kTe(t[1]):OTe:MTe;function LTe({when:e,delay:t,delayChildren:r,staggerChildren:n,staggerDirection:l,repeat:u,repeatType:f,repeatDelay:o,from:v,elapsed:w,...P}){return!!Object.keys(P).length}const jTe=e=>e!==null;function NTe(e,{repeat:t,repeatType:r="loop"},n){const l=e.filter(jTe),u=t&&r!=="loop"&&t%2===1?0:l.length-1;return!u||n===void 0?l[u]:n}function Xee(e,t,r,n=0,l=1){const u=Array.from(e).sort((w,P)=>w.sortNodePosition(P)).indexOf(t),f=e.size,o=(f-1)*n;return typeof r=="function"?r(u,f):l===1?u*n:o-u*n}const ZB=(e,t,r,n={},l,u)=>f=>{const o=WB(n,e)||{},v=o.delay||n.delay||0;let{elapsed:w=0}=n;w=w-zd(v);const P={keyframes:Array.isArray(r)?r:[null,r],ease:"easeOut",velocity:t.getVelocity(),...o,delay:-w,onUpdate:k=>{t.set(k),o.onUpdate&&o.onUpdate(k)},onComplete:()=>{f(),o.onComplete&&o.onComplete()},name:e,motionValue:t,element:u?void 0:l};LTe(o)||Object.assign(P,DTe(e,P)),P.duration&&(P.duration=zd(P.duration)),P.repeatDelay&&(P.repeatDelay=zd(P.repeatDelay)),P.from!==void 0&&(P.keyframes[0]=P.from);let C=!1;if((P.type===!1||P.duration===0&&!P.repeatDelay)&&(ZN(P),P.delay===0&&(C=!0)),(Kh.instantAnimations||Kh.skipAnimations)&&(C=!0,ZN(P),P.delay=0),P.allowFlatten=!o.type&&!o.ease,C&&!u&&t.get()!==void 0){const k=NTe(P.keyframes,o);if(k!==void 0){Ao.update(()=>{P.onUpdate(k),P.onComplete()});return}}return o.isSync?new qB(P):new ATe(P)},Kee=new Set(["width","height","top","left","right","bottom",...xx]),qq=30,zTe=e=>!isNaN(parseFloat(e));class FTe{constructor(t,r={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var u;const l=pl.now();if(this.updatedAt!==l&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((u=this.events.change)==null||u.notify(this.current),this.dependents))for(const f of this.dependents)f.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=r.owner}setCurrent(t){this.current=t,this.updatedAt=pl.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=zTe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new LB);const n=this.events[t].add(r);return t==="change"?()=>{n(),Ao.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,r,n){this.set(r),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-n}jump(t,r=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,r&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=pl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>qq)return 0;const r=Math.min(this.updatedAt-this.prevUpdatedAt,qq);return _ee(parseFloat(this.current)-parseFloat(this.prevFrameValue),r)}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,r;(t=this.dependents)==null||t.clear(),(r=this.events.destroy)==null||r.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function I0(e,t){return new FTe(e,t)}function Hq(e){const t=[{},{}];return e==null||e.values.forEach((r,n)=>{t[0][n]=r.get(),t[1][n]=r.getVelocity()}),t}function XB(e,t,r,n){if(typeof t=="function"){const[l,u]=Hq(n);t=t(r!==void 0?r:e.custom,l,u)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[l,u]=Hq(n);t=t(r!==void 0?r:e.custom,l,u)}return t}function Jv(e,t,r){const n=e.getProps();return XB(n,t,r!==void 0?r:n.custom,e)}const XN=e=>Array.isArray(e);function BTe(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,I0(r))}function $Te(e){return XN(e)?e[e.length-1]||0:e}function VTe(e,t){const r=Jv(e,t);let{transitionEnd:n={},transition:l={},...u}=r||{};u={...u,...n};for(const f in u){const o=$Te(u[f]);BTe(e,f,o)}}const Ua=e=>!!(e&&e.getVelocity);function UTe(e){return!!(Ua(e)&&e.add)}function KN(e,t){const r=e.getValue("willChange");if(UTe(r))return r.add(t);if(!r&&Kh.WillChange){const n=new Kh.WillChange("auto");e.addValue("willChange",n),n.add(t)}}function KB(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const GTe="framerAppearId",Yee="data-"+KB(GTe);function Jee(e){return e.props[Yee]}function qTe({protectedKeys:e,needsAnimating:t},r){const n=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,n}function Qee(e,t,{delay:r=0,transitionOverride:n,type:l}={}){let{transition:u=e.getDefaultTransition(),transitionEnd:f,...o}=t;n&&(u=n);const v=[],w=l&&e.animationState&&e.animationState.getState()[l];for(const P in o){const C=e.getValue(P,e.latestValues[P]??null),k=o[P];if(k===void 0||w&&qTe(w,P))continue;const L={delay:r,...WB(u||{},P)},$=C.get();if($!==void 0&&!C.isAnimating&&!Array.isArray(k)&&k===$&&!L.velocity)continue;let j=!1;if(window.MotionHandoffAnimation){const U=Jee(e);if(U){const q=window.MotionHandoffAnimation(U,P,Ao);q!==null&&(L.startTime=q,j=!0)}}KN(e,P),C.start(ZB(P,C,k,e.shouldReduceMotion&&Kee.has(P)?{type:!1}:L,e,j));const B=C.animation;B&&v.push(B)}return f&&Promise.all(v).then(()=>{Ao.update(()=>{f&&VTe(e,f)})}),v}function YN(e,t,r={}){var v;const n=Jv(e,t,r.type==="exit"?(v=e.presenceContext)==null?void 0:v.custom:void 0);let{transition:l=e.getDefaultTransition()||{}}=n||{};r.transitionOverride&&(l=r.transitionOverride);const u=n?()=>Promise.all(Qee(e,n,r)):()=>Promise.resolve(),f=e.variantChildren&&e.variantChildren.size?(w=0)=>{const{delayChildren:P=0,staggerChildren:C,staggerDirection:k}=l;return HTe(e,t,w,P,C,k,r)}:()=>Promise.resolve(),{when:o}=l;if(o){const[w,P]=o==="beforeChildren"?[u,f]:[f,u];return w().then(()=>P())}else return Promise.all([u(),f(r.delay)])}function HTe(e,t,r=0,n=0,l=0,u=1,f){const o=[];for(const v of e.variantChildren)v.notify("AnimationStart",t),o.push(YN(v,t,{...f,delay:r+(typeof n=="function"?0:n)+Xee(e.variantChildren,v,n,l,u)}).then(()=>v.notify("AnimationComplete",t)));return Promise.all(o)}function WTe(e,t,r={}){e.notify("AnimationStart",t);let n;if(Array.isArray(t)){const l=t.map(u=>YN(e,u,r));n=Promise.all(l)}else if(typeof t=="string")n=YN(e,t,r);else{const l=typeof t=="function"?Jv(e,t,r.custom):t;n=Promise.all(Qee(e,l,r))}return n.then(()=>{e.notify("AnimationComplete",t)})}const ZTe={test:e=>e==="auto",parse:e=>e},ete=e=>t=>t.test(e),tte=[vx,Nr,Fd,np,xSe,vSe,ZTe],Wq=e=>tte.find(ete(e));function XTe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||yee(e):!0}const KTe=new Set(["brightness","contrast","saturate","opacity"]);function YTe(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[n]=r.match(FB)||[];if(!n)return e;const l=r.replace(n,"");let u=KTe.has(t)?1:0;return n!==r&&(u*=100),t+"("+u+l+")"}const JTe=/\b([a-z-]*)\(.*?\)/gu,JN={...Kp,getAnimatableNone:e=>{const t=e.match(JTe);return t?t.map(YTe).join(" "):e}},Zq={...vx,transform:Math.round},QTe={rotate:np,rotateX:np,rotateY:np,rotateZ:np,scale:lP,scaleX:lP,scaleY:lP,scaleZ:lP,skew:np,skewX:np,skewY:np,distance:Nr,translateX:Nr,translateY:Nr,translateZ:Nr,x:Nr,y:Nr,z:Nr,perspective:Nr,transformPerspective:Nr,opacity:LS,originX:Dq,originY:Dq,originZ:Nr},YB={borderWidth:Nr,borderTopWidth:Nr,borderRightWidth:Nr,borderBottomWidth:Nr,borderLeftWidth:Nr,borderRadius:Nr,radius:Nr,borderTopLeftRadius:Nr,borderTopRightRadius:Nr,borderBottomRightRadius:Nr,borderBottomLeftRadius:Nr,width:Nr,maxWidth:Nr,height:Nr,maxHeight:Nr,top:Nr,right:Nr,bottom:Nr,left:Nr,inset:Nr,insetBlock:Nr,insetBlockStart:Nr,insetBlockEnd:Nr,insetInline:Nr,insetInlineStart:Nr,insetInlineEnd:Nr,padding:Nr,paddingTop:Nr,paddingRight:Nr,paddingBottom:Nr,paddingLeft:Nr,paddingBlock:Nr,paddingBlockStart:Nr,paddingBlockEnd:Nr,paddingInline:Nr,paddingInlineStart:Nr,paddingInlineEnd:Nr,margin:Nr,marginTop:Nr,marginRight:Nr,marginBottom:Nr,marginLeft:Nr,marginBlock:Nr,marginBlockStart:Nr,marginBlockEnd:Nr,marginInline:Nr,marginInlineStart:Nr,marginInlineEnd:Nr,backgroundPositionX:Nr,backgroundPositionY:Nr,...QTe,zIndex:Zq,fillOpacity:LS,strokeOpacity:LS,numOctaves:Zq},eEe={...YB,color:ws,backgroundColor:ws,outlineColor:ws,fill:ws,stroke:ws,borderColor:ws,borderTopColor:ws,borderRightColor:ws,borderBottomColor:ws,borderLeftColor:ws,filter:JN,WebkitFilter:JN},rte=e=>eEe[e];function nte(e,t){let r=rte(e);return r!==JN&&(r=Kp),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const tEe=new Set(["auto","none","0"]);function rEe(e,t,r){let n=0,l;for(;n<e.length&&!l;){const u=e[n];typeof u=="string"&&!tEe.has(u)&&jS(u).values.length&&(l=e[n]),n++}if(l&&r)for(const u of t)e[u]=nte(r,l)}class nEe extends HB{constructor(t,r,n,l,u){super(t,r,n,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:r,name:n}=this;if(!r||!r.current)return;super.readKeyframes();for(let P=0;P<t.length;P++){let C=t[P];if(typeof C=="string"&&(C=C.trim(),zB(C))){const k=Zee(C,r.current);k!==void 0&&(t[P]=k),P===t.length-1&&(this.finalKeyframe=C)}}if(this.resolveNoneKeyframes(),!Kee.has(n)||t.length!==2)return;const[l,u]=t,f=Wq(l),o=Wq(u),v=Mq(l),w=Mq(u);if(v!==w&&Cp[n]){this.needsMeasurement=!0;return}if(f!==o)if(Vq(f)&&Vq(o))for(let P=0;P<t.length;P++){const C=t[P];typeof C=="string"&&(t[P]=parseFloat(C))}else Cp[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:r}=this,n=[];for(let l=0;l<t.length;l++)(t[l]===null||XTe(t[l]))&&n.push(l);n.length&&rEe(t,n,r)}measureInitialState(){const{element:t,unresolvedKeyframes:r,name:n}=this;if(!t||!t.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Cp[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r[0]=this.measuredOrigin;const l=r[r.length-1];l!==void 0&&t.getValue(n,l).jump(l,!1)}measureEndState(){var o;const{element:t,name:r,unresolvedKeyframes:n}=this;if(!t||!t.current)return;const l=t.getValue(r);l&&l.jump(this.measuredOrigin,!1);const u=n.length-1,f=n[u];n[u]=Cp[r](t.measureViewportBox(),window.getComputedStyle(t.current)),f!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=f),(o=this.removedTransforms)!=null&&o.length&&this.removedTransforms.forEach(([v,w])=>{t.getValue(v).set(w)}),this.resolveNoneKeyframes()}}function iEe(e,t,r){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const l=document.querySelectorAll(e);return l?Array.from(l):[]}return Array.from(e)}const ite=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function ote(e){return gee(e)&&"offsetHeight"in e}const{schedule:JB,cancel:QQe}=Iee(queueMicrotask,!1),Au={x:!1,y:!1};function ste(){return Au.x||Au.y}function oEe(e){return e==="x"||e==="y"?Au[e]?null:(Au[e]=!0,()=>{Au[e]=!1}):Au.x||Au.y?null:(Au.x=Au.y=!0,()=>{Au.x=Au.y=!1})}function ate(e,t){const r=iEe(e),n=new AbortController,l={passive:!0,...t,signal:n.signal};return[r,l,()=>n.abort()]}function Xq(e){return!(e.pointerType==="touch"||ste())}function sEe(e,t,r={}){const[n,l,u]=ate(e,r),f=o=>{if(!Xq(o))return;const{target:v}=o,w=t(v,o);if(typeof w!="function"||!v)return;const P=C=>{Xq(C)&&(w(C),v.removeEventListener("pointerleave",P))};v.addEventListener("pointerleave",P,l)};return n.forEach(o=>{o.addEventListener("pointerenter",f,l)}),u}const lte=(e,t)=>t?e===t?!0:lte(e,t.parentElement):!1,QB=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,aEe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function cte(e){return aEe.has(e.tagName)||e.isContentEditable===!0}const WP=new WeakSet;function Kq(e){return t=>{t.key==="Enter"&&e(t)}}function cL(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const lEe=(e,t)=>{const r=e.currentTarget;if(!r)return;const n=Kq(()=>{if(WP.has(r))return;cL(r,"down");const l=Kq(()=>{cL(r,"up")}),u=()=>cL(r,"cancel");r.addEventListener("keyup",l,t),r.addEventListener("blur",u,t)});r.addEventListener("keydown",n,t),r.addEventListener("blur",()=>r.removeEventListener("keydown",n),t)};function Yq(e){return QB(e)&&!ste()}function cEe(e,t,r={}){const[n,l,u]=ate(e,r),f=o=>{const v=o.currentTarget;if(!Yq(o))return;WP.add(v);const w=t(v,o),P=(L,$)=>{window.removeEventListener("pointerup",C),window.removeEventListener("pointercancel",k),WP.has(v)&&WP.delete(v),Yq(L)&&typeof w=="function"&&w(L,{success:$})},C=L=>{P(L,v===window||v===document||r.useGlobalTarget||lte(v,L.target))},k=L=>{P(L,!1)};window.addEventListener("pointerup",C,l),window.addEventListener("pointercancel",k,l)};return n.forEach(o=>{(r.useGlobalTarget?window:o).addEventListener("pointerdown",f,l),ote(o)&&(o.addEventListener("focus",w=>lEe(w,l)),!cte(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),u}function ute(e){return gee(e)&&"ownerSVGElement"in e}function uEe(e){return ute(e)&&e.tagName==="svg"}const dEe=[...tte,ws,Kp],hEe=e=>dEe.find(ete(e)),Jq=()=>({translate:0,scale:1,origin:0,originPoint:0}),Mv=()=>({x:Jq(),y:Jq()}),Qq=()=>({min:0,max:0}),Fs=()=>({x:Qq(),y:Qq()}),QN={current:null},dte={current:!1},fEe=typeof window<"u";function pEe(){if(dte.current=!0,!!fEe)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>QN.current=e.matches;e.addEventListener("change",t),t()}else QN.current=!1}const mEe=new WeakMap;function zO(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function NS(e){return typeof e=="string"||Array.isArray(e)}const e5=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],t5=["initial",...e5];function FO(e){return zO(e.animate)||t5.some(t=>NS(e[t]))}function hte(e){return!!(FO(e)||e.variants)}function gEe(e,t,r){for(const n in t){const l=t[n],u=r[n];if(Ua(l))e.addValue(n,l);else if(Ua(u))e.addValue(n,I0(l,{owner:e}));else if(u!==l)if(e.hasValue(n)){const f=e.getValue(n);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=e.getStaticValue(n);e.addValue(n,I0(f!==void 0?f:l,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const eH=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let VC={};function fte(e){VC=e}function yEe(){return VC}class _Ee{scrapeMotionValuesFromProps(t,r,n){return{}}constructor({parent:t,props:r,presenceContext:n,reducedMotionConfig:l,blockInitialAnimation:u,visualState:f},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=HB,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const k=pl.now();this.renderScheduledAt<k&&(this.renderScheduledAt=k,Ao.render(this.render,!1,!0))};const{latestValues:v,renderState:w}=f;this.latestValues=v,this.baseTarget={...v},this.initialValues=r.initial?{...v}:{},this.renderState=w,this.parent=t,this.props=r,this.presenceContext=n,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=o,this.blockInitialAnimation=!!u,this.isControllingVariants=FO(r),this.isVariantNode=hte(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:P,...C}=this.scrapeMotionValuesFromProps(r,{},this);for(const k in C){const L=C[k];v[k]!==void 0&&Ua(L)&&L.set(v[k])}}mount(t){var r;this.current=t,mEe.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,l)=>this.bindToMotionValue(l,n)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(dte.current||pEe(),this.shouldReduceMotion=QN.current),(r=this.parent)==null||r.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var t;this.projection&&this.projection.unmount(),Xp(this.notifyUpdate),Xp(this.render),this.valueSubscriptions.forEach(r=>r()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const r in this.events)this.events[r].clear();for(const r in this.features){const n=this.features[r];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,r){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const n=bx.has(t);n&&this.onBindTransform&&this.onBindTransform();const l=r.on("change",f=>{this.latestValues[t]=f,this.props.onUpdate&&Ao.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let u;typeof window<"u"&&window.MotionCheckAppearSync&&(u=window.MotionCheckAppearSync(this,t,r)),this.valueSubscriptions.set(t,()=>{l(),u&&u(),r.owner&&r.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in VC){const r=VC[t];if(!r)continue;const{isEnabled:n,Feature:l}=r;if(!this.features[t]&&l&&n(this.props)&&(this.features[t]=new l(this)),this.features[t]){const u=this.features[t];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Fs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let n=0;n<eH.length;n++){const l=eH[n];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,f=t[u];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=gEe(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){const n=this.values.get(t);r!==n&&(n&&this.removeValue(t),this.bindToMotionValue(t,r),this.values.set(t,r),this.latestValues[t]=r.get())}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let n=this.values.get(t);return n===void 0&&r!==void 0&&(n=I0(r===null?void 0:r,{owner:this}),this.addValue(t,n)),n}readValue(t,r){let n=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return n!=null&&(typeof n=="string"&&(mee(n)||yee(n))?n=parseFloat(n):!hEe(n)&&Kp.test(r)&&(n=nte(t,r)),this.setBaseTarget(t,Ua(n)?n.get():n)),Ua(n)?n.get():n}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var u;const{initial:r}=this.props;let n;if(typeof r=="string"||typeof r=="object"){const f=XB(this.props,r,(u=this.presenceContext)==null?void 0:u.custom);f&&(n=f[t])}if(r&&n!==void 0)return n;const l=this.getBaseTargetFromProps(this.props,t);return l!==void 0&&!Ua(l)?l:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new LB),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}scheduleRenderMicrotask(){JB.render(this.render)}}class nm{constructor(t){this.isMounted=!1,this.node=t}update(){}}class pte extends _Ee{constructor(){super(...arguments),this.KeyframeResolver=nEe}sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){const n=t.style;return n?n[r]:void 0}removeValueFromRenderState(t,{vars:r,style:n}){delete r[t],delete n[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;Ua(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}}function mte({top:e,left:t,right:r,bottom:n}){return{x:{min:t,max:r},y:{min:e,max:n}}}function vEe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function xEe(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),n=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:n.y,right:n.x}}function uL(e){return e===void 0||e===1}function ez({scale:e,scaleX:t,scaleY:r}){return!uL(e)||!uL(t)||!uL(r)}function _g(e){return ez(e)||gte(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function gte(e){return tH(e.x)||tH(e.y)}function tH(e){return e&&e!=="0%"}function UC(e,t,r){const n=e-r,l=t*n;return r+l}function rH(e,t,r,n,l){return l!==void 0&&(e=UC(e,l,n)),UC(e,r,n)+t}function tz(e,t=0,r=1,n,l){e.min=rH(e.min,t,r,n,l),e.max=rH(e.max,t,r,n,l)}function yte(e,{x:t,y:r}){tz(e.x,t.translate,t.scale,t.originPoint),tz(e.y,r.translate,r.scale,r.originPoint)}const nH=.999999999999,iH=1.0000000000001;function bEe(e,t,r,n=!1){const l=r.length;if(!l)return;t.x=t.y=1;let u,f;for(let o=0;o<l;o++){u=r[o],f=u.projectionDelta;const{visualElement:v}=u.options;v&&v.props.style&&v.props.style.display==="contents"||(n&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Lv(e,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,yte(e,f)),n&&_g(u.latestValues)&&Lv(e,u.latestValues))}t.x<iH&&t.x>nH&&(t.x=1),t.y<iH&&t.y>nH&&(t.y=1)}function Dv(e,t){e.min=e.min+t,e.max=e.max+t}function oH(e,t,r,n,l=.5){const u=Go(e.min,e.max,l);tz(e,t,r,u,n)}function Lv(e,t){oH(e.x,t.x,t.scaleX,t.scale,t.originX),oH(e.y,t.y,t.scaleY,t.scale,t.originY)}function _te(e,t){return mte(xEe(e.getBoundingClientRect(),t))}function wEe(e,t,r){const n=_te(e,r),{scroll:l}=t;return l&&(Dv(n.x,l.offset.x),Dv(n.y,l.offset.y)),n}const SEe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},TEe=xx.length;function EEe(e,t,r){let n="",l=!0;for(let u=0;u<TEe;u++){const f=xx[u],o=e[f];if(o===void 0)continue;let v=!0;if(typeof o=="number"?v=o===(f.startsWith("scale")?1:0):v=parseFloat(o)===0,!v||r){const w=ite(o,YB[f]);if(!v){l=!1;const P=SEe[f]||f;n+=`${P}(${w}) `}r&&(t[f]=w)}}return n=n.trim(),r?n=r(t,l?"":n):l&&(n="none"),n}function r5(e,t,r){const{style:n,vars:l,transformOrigin:u}=e;let f=!1,o=!1;for(const v in t){const w=t[v];if(bx.has(v)){f=!0;continue}else if(kee(v)){l[v]=w;continue}else{const P=ite(w,YB[v]);v.startsWith("origin")?(o=!0,u[v]=P):n[v]=P}}if(t.transform||(f||r?n.transform=EEe(t,e.transform,r):n.transform&&(n.transform="none")),o){const{originX:v="50%",originY:w="50%",originZ:P=0}=u;n.transformOrigin=`${v} ${w} ${P}`}}function vte(e,{style:t,vars:r},n,l){const u=e.style;let f;for(f in t)u[f]=t[f];l==null||l.applyProjectionStyles(u,n);for(f in r)u.setProperty(f,r[f])}function sH(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const r1={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Nr.test(e))e=parseFloat(e);else return e;const r=sH(e,t.target.x),n=sH(e,t.target.y);return`${r}% ${n}%`}},AEe={correct:(e,{treeScale:t,projectionDelta:r})=>{const n=e,l=Kp.parse(e);if(l.length>5)return n;const u=Kp.createTransformer(e),f=typeof l[0]!="number"?1:0,o=r.x.scale*t.x,v=r.y.scale*t.y;l[0+f]/=o,l[1+f]/=v;const w=Go(o,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=w),typeof l[3+f]=="number"&&(l[3+f]/=w),u(l)}},rz={borderRadius:{...r1,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:r1,borderTopRightRadius:r1,borderBottomLeftRadius:r1,borderBottomRightRadius:r1,boxShadow:AEe};function xte(e,{layout:t,layoutId:r}){return bx.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!rz[e]||e==="opacity")}function n5(e,t,r){var f;const n=e.style,l=t==null?void 0:t.style,u={};if(!n)return u;for(const o in n)(Ua(n[o])||l&&Ua(l[o])||xte(o,e)||((f=r==null?void 0:r.getValue(o))==null?void 0:f.liveStyle)!==void 0)&&(u[o]=n[o]);return u}function PEe(e){return window.getComputedStyle(e)}class CEe extends pte{constructor(){super(...arguments),this.type="html",this.renderInstance=vte}readValueFromInstance(t,r){var n;if(bx.has(r))return(n=this.projection)!=null&&n.isProjecting?UN(r):nTe(t,r);{const l=PEe(t),u=(kee(r)?l.getPropertyValue(r):l[r])||0;return typeof u=="string"?u.trim():u}}measureInstanceViewportBox(t,{transformPagePoint:r}){return _te(t,r)}build(t,r,n){r5(t,r,n.transformTemplate)}scrapeMotionValuesFromProps(t,r,n){return n5(t,r,n)}}const IEe={offset:"stroke-dashoffset",array:"stroke-dasharray"},OEe={offset:"strokeDashoffset",array:"strokeDasharray"};function kEe(e,t,r=1,n=0,l=!0){e.pathLength=1;const u=l?IEe:OEe;e[u.offset]=Nr.transform(-n);const f=Nr.transform(t),o=Nr.transform(r);e[u.array]=`${f} ${o}`}const REe=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function bte(e,{attrX:t,attrY:r,attrScale:n,pathLength:l,pathSpacing:u=1,pathOffset:f=0,...o},v,w,P){if(r5(e,o,w),v){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:C,style:k}=e;C.transform&&(k.transform=C.transform,delete C.transform),(k.transform||C.transformOrigin)&&(k.transformOrigin=C.transformOrigin??"50% 50%",delete C.transformOrigin),k.transform&&(k.transformBox=(P==null?void 0:P.transformBox)??"fill-box",delete C.transformBox);for(const L of REe)C[L]!==void 0&&(k[L]=C[L],delete C[L]);t!==void 0&&(C.x=t),r!==void 0&&(C.y=r),n!==void 0&&(C.scale=n),l!==void 0&&kEe(C,l,u,f,!1)}const wte=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),Ste=e=>typeof e=="string"&&e.toLowerCase()==="svg";function MEe(e,t,r,n){vte(e,t,void 0,n);for(const l in t.attrs)e.setAttribute(wte.has(l)?l:KB(l),t.attrs[l])}function Tte(e,t,r){const n=n5(e,t,r);for(const l in e)if(Ua(e[l])||Ua(t[l])){const u=xx.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;n[u]=e[l]}return n}class DEe extends pte{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Fs}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(bx.has(r)){const n=rte(r);return n&&n.default||0}return r=wte.has(r)?r:KB(r),t.getAttribute(r)}scrapeMotionValuesFromProps(t,r,n){return Tte(t,r,n)}build(t,r,n){bte(t,r,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(t,r,n,l){MEe(t,r,n,l)}mount(t){this.isSVGTag=Ste(t.tagName),super.mount(t)}}const LEe=t5.length;function Ete(e){if(!e)return;if(!e.isControllingVariants){const r=e.parent?Ete(e.parent)||{}:{};return e.props.initial!==void 0&&(r.initial=e.props.initial),r}const t={};for(let r=0;r<LEe;r++){const n=t5[r],l=e.props[n];(NS(l)||l===!1)&&(t[n]=l)}return t}function Ate(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}const jEe=[...e5].reverse(),NEe=e5.length;function zEe(e){return t=>Promise.all(t.map(({animation:r,options:n})=>WTe(e,r,n)))}function FEe(e){let t=zEe(e),r=aH(),n=!0;const l=v=>(w,P)=>{var k;const C=Jv(e,P,v==="exit"?(k=e.presenceContext)==null?void 0:k.custom:void 0);if(C){const{transition:L,transitionEnd:$,...j}=C;w={...w,...j,...$}}return w};function u(v){t=v(e)}function f(v){const{props:w}=e,P=Ete(e.parent)||{},C=[],k=new Set;let L={},$=1/0;for(let B=0;B<NEe;B++){const U=jEe[B],q=r[U],H=w[U]!==void 0?w[U]:P[U],te=NS(H),Q=U===v?q.isActive:null;Q===!1&&($=B);let ae=H===P[U]&&H!==w[U]&&te;if(ae&&n&&e.manuallyAnimateOnMount&&(ae=!1),q.protectedKeys={...L},!q.isActive&&Q===null||!H&&!q.prevProp||zO(H)||typeof H=="boolean")continue;const ue=BEe(q.prevProp,H);let me=ue||U===v&&q.isActive&&!ae&&te||B>$&&te,Ce=!1;const Fe=Array.isArray(H)?H:[H];let Ge=Fe.reduce(l(U),{});Q===!1&&(Ge={});const{prevResolvedValues:Ve={}}=q,Ze={...Ve,...Ge},nt=at=>{me=!0,k.has(at)&&(Ce=!0,k.delete(at)),q.needsAnimating[at]=!0;const qe=e.getValue(at);qe&&(qe.liveStyle=!1)};for(const at in Ze){const qe=Ge[at],He=Ve[at];if(L.hasOwnProperty(at))continue;let Et=!1;XN(qe)&&XN(He)?Et=!Ate(qe,He):Et=qe!==He,Et?qe!=null?nt(at):k.add(at):qe!==void 0&&k.has(at)?nt(at):q.protectedKeys[at]=!0}q.prevProp=H,q.prevResolvedValues=Ge,q.isActive&&(L={...L,...Ge}),n&&e.blockInitialAnimation&&(me=!1);const dt=ae&&ue;me&&(!dt||Ce)&&C.push(...Fe.map(at=>{const qe={type:U};if(typeof at=="string"&&n&&!dt&&e.manuallyAnimateOnMount&&e.parent){const{parent:He}=e,Et=Jv(He,at);if(He.enteringChildren&&Et){const{delayChildren:Gt}=Et.transition||{};qe.delay=Xee(He.enteringChildren,e,Gt)}}return{animation:at,options:qe}}))}if(k.size){const B={};if(typeof w.initial!="boolean"){const U=Jv(e,Array.isArray(w.initial)?w.initial[0]:w.initial);U&&U.transition&&(B.transition=U.transition)}k.forEach(U=>{const q=e.getBaseTarget(U),H=e.getValue(U);H&&(H.liveStyle=!0),B[U]=q??null}),C.push({animation:B})}let j=!!C.length;return n&&(w.initial===!1||w.initial===w.animate)&&!e.manuallyAnimateOnMount&&(j=!1),n=!1,j?t(C):Promise.resolve()}function o(v,w){var C;if(r[v].isActive===w)return Promise.resolve();(C=e.variantChildren)==null||C.forEach(k=>{var L;return(L=k.animationState)==null?void 0:L.setActive(v,w)}),r[v].isActive=w;const P=f(v);for(const k in r)r[k].protectedKeys={};return P}return{animateChanges:f,setActive:o,setAnimateFunction:u,getState:()=>r,reset:()=>{r=aH()}}}function BEe(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!Ate(t,e):!1}function dg(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function aH(){return{animate:dg(!0),whileInView:dg(),whileHover:dg(),whileTap:dg(),whileDrag:dg(),whileFocus:dg(),exit:dg()}}const Pte=1e-4,$Ee=1-Pte,VEe=1+Pte,Cte=.01,UEe=0-Cte,GEe=0+Cte;function ml(e){return e.max-e.min}function qEe(e,t,r){return Math.abs(e-t)<=r}function lH(e,t,r,n=.5){e.origin=n,e.originPoint=Go(t.min,t.max,e.origin),e.scale=ml(r)/ml(t),e.translate=Go(r.min,r.max,e.origin)-e.originPoint,(e.scale>=$Ee&&e.scale<=VEe||isNaN(e.scale))&&(e.scale=1),(e.translate>=UEe&&e.translate<=GEe||isNaN(e.translate))&&(e.translate=0)}function U1(e,t,r,n){lH(e.x,t.x,r.x,n?n.originX:void 0),lH(e.y,t.y,r.y,n?n.originY:void 0)}function cH(e,t,r){e.min=r.min+t.min,e.max=e.min+ml(t)}function HEe(e,t,r){cH(e.x,t.x,r.x),cH(e.y,t.y,r.y)}function uH(e,t,r){e.min=t.min-r.min,e.max=e.min+ml(t)}function GC(e,t,r){uH(e.x,t.x,r.x),uH(e.y,t.y,r.y)}function dH(e,t,r,n,l){return e-=t,e=UC(e,1/r,n),l!==void 0&&(e=UC(e,1/l,n)),e}function WEe(e,t=0,r=1,n=.5,l,u=e,f=e){if(Fd.test(t)&&(t=parseFloat(t),t=Go(f.min,f.max,t/100)-f.min),typeof t!="number")return;let o=Go(u.min,u.max,n);e===u&&(o-=t),e.min=dH(e.min,t,r,o,l),e.max=dH(e.max,t,r,o,l)}function hH(e,t,[r,n,l],u,f){WEe(e,t[r],t[n],t[l],t.scale,u,f)}const ZEe=["x","scaleX","originX"],XEe=["y","scaleY","originY"];function fH(e,t,r,n){hH(e.x,t,ZEe,r?r.x:void 0,n?n.x:void 0),hH(e.y,t,XEe,r?r.y:void 0,n?n.y:void 0)}function pH(e,t){e.min=t.min,e.max=t.max}function Su(e,t){pH(e.x,t.x),pH(e.y,t.y)}function mH(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function gH(e){return e.translate===0&&e.scale===1}function Ite(e){return gH(e.x)&&gH(e.y)}function yH(e,t){return e.min===t.min&&e.max===t.max}function KEe(e,t){return yH(e.x,t.x)&&yH(e.y,t.y)}function _H(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Ote(e,t){return _H(e.x,t.x)&&_H(e.y,t.y)}function vH(e){return ml(e.x)/ml(e.y)}function xH(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function jc(e){return[e("x"),e("y")]}function YEe(e,t,r){let n="";const l=e.x.translate/t.x,u=e.y.translate/t.y,f=(r==null?void 0:r.z)||0;if((l||u||f)&&(n=`translate3d(${l}px, ${u}px, ${f}px) `),(t.x!==1||t.y!==1)&&(n+=`scale(${1/t.x}, ${1/t.y}) `),r){const{transformPerspective:w,rotate:P,rotateX:C,rotateY:k,skewX:L,skewY:$}=r;w&&(n=`perspective(${w}px) ${n}`),P&&(n+=`rotate(${P}deg) `),C&&(n+=`rotateX(${C}deg) `),k&&(n+=`rotateY(${k}deg) `),L&&(n+=`skewX(${L}deg) `),$&&(n+=`skewY(${$}deg) `)}const o=e.x.scale*t.x,v=e.y.scale*t.y;return(o!==1||v!==1)&&(n+=`scale(${o}, ${v})`),n||"none"}const kte=["TopLeft","TopRight","BottomLeft","BottomRight"],JEe=kte.length,bH=e=>typeof e=="string"?parseFloat(e):e,wH=e=>typeof e=="number"||Nr.test(e);function QEe(e,t,r,n,l,u){l?(e.opacity=Go(0,r.opacity??1,eAe(n)),e.opacityExit=Go(t.opacity??1,0,tAe(n))):u&&(e.opacity=Go(t.opacity??1,r.opacity??1,n));for(let f=0;f<JEe;f++){const o=`border${kte[f]}Radius`;let v=SH(t,o),w=SH(r,o);if(v===void 0&&w===void 0)continue;v||(v=0),w||(w=0),v===0||w===0||wH(v)===wH(w)?(e[o]=Math.max(Go(bH(v),bH(w),n),0),(Fd.test(w)||Fd.test(v))&&(e[o]+="%")):e[o]=w}(t.rotate||r.rotate)&&(e.rotate=Go(t.rotate||0,r.rotate||0,n))}function SH(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const eAe=Rte(0,.5,Eee),tAe=Rte(.5,.95,Zc);function Rte(e,t,r){return n=>n<e?0:n>t?1:r(DS(e,t,n))}function rAe(e,t){const r=pl.now(),n=({timestamp:l})=>{const u=l-r;u>=t&&(Xp(n),e(u-t))};return Ao.setup(n,!0),()=>Xp(n)}function zS(e,t,r,n={passive:!0}){return e.addEventListener(t,r,n),()=>e.removeEventListener(t,r)}function ZP(e){return Ua(e)?e.get():e}function nAe(e,t,r){const n=Ua(e)?e:I0(e);return n.start(ZB("",n,t,r)),n.animation}const iAe=(e,t)=>e.depth-t.depth;class oAe{constructor(){this.children=[],this.isDirty=!1}add(t){RB(this.children,t),this.isDirty=!0}remove(t){MB(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(iAe),this.isDirty=!1,this.children.forEach(t)}}class sAe{constructor(){this.members=[]}add(t){RB(this.members,t),t.scheduleRender()}remove(t){if(MB(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(l=>t===l);if(r===0)return!1;let n;for(let l=r;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){n=u;break}}return n?(this.promote(n),!0):!1}promote(t,r){const n=this.lead;if(t!==n&&(this.prevLead=n,this.lead=t,t.show(),n)){n.instance&&n.scheduleRender(),t.scheduleRender(),t.resumeFrom=n,r&&(t.resumeFrom.preserveOpacity=!0),n.snapshot&&(t.snapshot=n.snapshot,t.snapshot.latestValues=n.animationValues||n.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:n}=t;r.onExitComplete&&r.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const XP={hasAnimatedSinceResize:!0,hasEverUpdated:!1},dL=["","X","Y","Z"],aAe=1e3;let lAe=0;function hL(e,t,r,n){const{latestValues:l}=t;l[e]&&(r[e]=l[e],t.setStaticValue(e,0),n&&(n[e]=0))}function Mte(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const r=Jee(t);if(window.MotionHasOptimisedAnimation(r,"transform")){const{layout:l,layoutId:u}=e.options;window.MotionCancelOptimisedAnimation(r,"transform",Ao,!(l||u))}const{parent:n}=e;n&&!n.hasCheckedOptimisedAppear&&Mte(n)}function Dte({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:n,resetTransform:l}){return class{constructor(f={},o=t==null?void 0:t()){this.id=lAe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(dAe),this.nodes.forEach(mAe),this.nodes.forEach(gAe),this.nodes.forEach(hAe)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new oAe)}addEventListener(f,o){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new LB),this.eventHandlers.get(f).add(o)}notifyListeners(f,...o){const v=this.eventHandlers.get(f);v&&v.notify(...o)}hasListeners(f){return this.eventHandlers.has(f)}mount(f){if(this.instance)return;this.isSVG=ute(f)&&!uEe(f),this.instance=f;const{layoutId:o,layout:v,visualElement:w}=this.options;if(w&&!w.current&&w.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(v||o)&&(this.isLayoutDirty=!0),e){let P,C=0;const k=()=>this.root.updateBlockedByResize=!1;Ao.read(()=>{C=window.innerWidth}),e(f,()=>{const L=window.innerWidth;L!==C&&(C=L,this.root.updateBlockedByResize=!0,P&&P(),P=rAe(k,250),XP.hasAnimatedSinceResize&&(XP.hasAnimatedSinceResize=!1,this.nodes.forEach(AH)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&w&&(o||v)&&this.addEventListener("didUpdate",({delta:P,hasLayoutChanged:C,hasRelativeLayoutChanged:k,layout:L})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const $=this.options.transition||w.getDefaultTransition()||bAe,{onLayoutAnimationStart:j,onLayoutAnimationComplete:B}=w.getProps(),U=!this.targetLayout||!Ote(this.targetLayout,L),q=!C&&k;if(this.options.layoutRoot||this.resumeFrom||q||C&&(U||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const H={...WB($,"layout"),onPlay:j,onComplete:B};(w.shouldReduceMotion||this.options.layoutRoot)&&(H.delay=0,H.type=!1),this.startAnimation(H),this.setAnimationOrigin(P,q)}else C||AH(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=L})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Xp(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(yAe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Mte(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let P=0;P<this.path.length;P++){const C=this.path[P];C.shouldResetTransform=!0,C.updateScroll("snapshot"),C.options.layoutRoot&&C.willUpdate(!1)}const{layoutId:o,layout:v}=this.options;if(o===void 0&&!v)return;const w=this.getTransformTemplate();this.prevTransformTemplateValue=w?w(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(TH);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(EH);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(pAe),this.nodes.forEach(cAe),this.nodes.forEach(uAe)):this.nodes.forEach(EH),this.clearAllSnapshots();const o=pl.now();Sa.delta=qd(0,1e3/60,o-Sa.timestamp),Sa.timestamp=o,Sa.isProcessing=!0,nL.update.process(Sa),nL.preRender.process(Sa),nL.render.process(Sa),Sa.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,JB.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(fAe),this.sharedNodes.forEach(_Ae)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Ao.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Ao.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ml(this.snapshot.measuredBox.x)&&!ml(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Fs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(o=!1),o&&this.instance){const v=n(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:r(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!Ite(this.projectionDelta),v=this.getTransformTemplate(),w=v?v(this.latestValues,""):void 0,P=w!==this.prevTransformTemplateValue;f&&this.instance&&(o||_g(this.latestValues)||P)&&(l(this.instance,w),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const o=this.measurePageBox();let v=this.removeElementScroll(o);return f&&(v=this.removeTransform(v)),wAe(v),{animationId:this.root.animationId,measuredBox:o,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var w;const{visualElement:f}=this.options;if(!f)return Fs();const o=f.measureViewportBox();if(!(((w=this.scroll)==null?void 0:w.wasRoot)||this.path.some(SAe))){const{scroll:P}=this.root;P&&(Dv(o.x,P.offset.x),Dv(o.y,P.offset.y))}return o}removeElementScroll(f){var v;const o=Fs();if(Su(o,f),(v=this.scroll)!=null&&v.wasRoot)return o;for(let w=0;w<this.path.length;w++){const P=this.path[w],{scroll:C,options:k}=P;P!==this.root&&C&&k.layoutScroll&&(C.wasRoot&&Su(o,f),Dv(o.x,C.offset.x),Dv(o.y,C.offset.y))}return o}applyTransform(f,o=!1){const v=Fs();Su(v,f);for(let w=0;w<this.path.length;w++){const P=this.path[w];!o&&P.options.layoutScroll&&P.scroll&&P!==P.root&&Lv(v,{x:-P.scroll.offset.x,y:-P.scroll.offset.y}),_g(P.latestValues)&&Lv(v,P.latestValues)}return _g(this.latestValues)&&Lv(v,this.latestValues),v}removeTransform(f){const o=Fs();Su(o,f);for(let v=0;v<this.path.length;v++){const w=this.path[v];if(!w.instance||!_g(w.latestValues))continue;ez(w.latestValues)&&w.updateSnapshot();const P=Fs(),C=w.measurePageBox();Su(P,C),fH(o,w.latestValues,w.snapshot?w.snapshot.layoutBox:void 0,P)}return _g(this.latestValues)&&fH(o,this.latestValues),o}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Sa.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var L;const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const v=!!this.resumingFrom||this!==o;if(!(f||v&&this.isSharedProjectionDirty||this.isProjectionDirty||(L=this.parent)!=null&&L.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:P,layoutId:C}=this.options;if(!this.layout||!(P||C))return;this.resolvedRelativeTargetAt=Sa.timestamp;const k=this.getClosestProjectingParent();k&&this.linkedParentVersion!==k.layoutVersion&&!k.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(k&&k.layout?this.createRelativeTarget(k,this.layout.layoutBox,k.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Fs(),this.targetWithTransforms=Fs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),HEe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Su(this.target,this.layout.layoutBox),yte(this.target,this.targetDelta)):Su(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,k&&!!k.resumingFrom==!!this.resumingFrom&&!k.options.layoutScroll&&k.target&&this.animationProgress!==1?this.createRelativeTarget(k,this.target,k.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||ez(this.parent.latestValues)||gte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(f,o,v){this.relativeParent=f,this.linkedParentVersion=f.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Fs(),this.relativeTargetOrigin=Fs(),GC(this.relativeTargetOrigin,o,v),Su(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var $;const f=this.getLead(),o=!!this.resumingFrom||this!==f;let v=!0;if((this.isProjectionDirty||($=this.parent)!=null&&$.isProjectionDirty)&&(v=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(v=!1),this.resolvedRelativeTargetAt===Sa.timestamp&&(v=!1),v)return;const{layout:w,layoutId:P}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(w||P))return;Su(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,k=this.treeScale.y;bEe(this.layoutCorrected,this.treeScale,this.path,o),f.layout&&!f.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(f.target=f.layout.layoutBox,f.targetWithTransforms=Fs());const{target:L}=f;if(!L){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(mH(this.prevProjectionDelta.x,this.projectionDelta.x),mH(this.prevProjectionDelta.y,this.projectionDelta.y)),U1(this.projectionDelta,this.layoutCorrected,L,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==k||!xH(this.projectionDelta.x,this.prevProjectionDelta.x)||!xH(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",L))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var o;if((o=this.options.visualElement)==null||o.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Mv(),this.projectionDelta=Mv(),this.projectionDeltaWithTransform=Mv()}setAnimationOrigin(f,o=!1){const v=this.snapshot,w=v?v.latestValues:{},P={...this.latestValues},C=Mv();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const k=Fs(),L=v?v.source:void 0,$=this.layout?this.layout.source:void 0,j=L!==$,B=this.getStack(),U=!B||B.members.length<=1,q=!!(j&&!U&&this.options.crossfade===!0&&!this.path.some(xAe));this.animationProgress=0;let H;this.mixTargetDelta=te=>{const Q=te/1e3;PH(C.x,f.x,Q),PH(C.y,f.y,Q),this.setTargetDelta(C),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(GC(k,this.layout.layoutBox,this.relativeParent.layout.layoutBox),vAe(this.relativeTarget,this.relativeTargetOrigin,k,Q),H&&KEe(this.relativeTarget,H)&&(this.isProjectionDirty=!1),H||(H=Fs()),Su(H,this.relativeTarget)),j&&(this.animationValues=P,QEe(P,w,this.latestValues,Q,q,U)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=Q},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){var o,v,w;this.notifyListeners("animationStart"),(o=this.currentAnimation)==null||o.stop(),(w=(v=this.resumingFrom)==null?void 0:v.currentAnimation)==null||w.stop(),this.pendingAnimation&&(Xp(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Ao.update(()=>{XP.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=I0(0)),this.currentAnimation=nAe(this.motionValue,[0,1e3],{...f,velocity:0,isSync:!0,onUpdate:P=>{this.mixTargetDelta(P),f.onUpdate&&f.onUpdate(P)},onStop:()=>{},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(aAe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:o,target:v,layout:w,latestValues:P}=f;if(!(!o||!v||!w)){if(this!==f&&this.layout&&w&&Lte(this.options.animationType,this.layout.layoutBox,w.layoutBox)){v=this.target||Fs();const C=ml(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+C;const k=ml(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+k}Su(o,v),Lv(o,P),U1(this.projectionDeltaWithTransform,this.layoutCorrected,o,P)}}registerSharedNode(f,o){this.sharedNodes.has(f)||this.sharedNodes.set(f,new sAe),this.sharedNodes.get(f).add(o);const w=o.options.initialPromotionConfig;o.promote({transition:w?w.transition:void 0,preserveFollowOpacity:w&&w.shouldPreserveFollowOpacity?w.shouldPreserveFollowOpacity(o):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var o;const{layoutId:f}=this.options;return f?((o=this.getStack())==null?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:f}=this.options;return f?(o=this.getStack())==null?void 0:o.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:o,preserveFollowOpacity:v}={}){const w=this.getStack();w&&w.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let o=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(o=!0),!o)return;const w={};v.z&&hL("z",f,w,this.animationValues);for(let P=0;P<dL.length;P++)hL(`rotate${dL[P]}`,f,w,this.animationValues),hL(`skew${dL[P]}`,f,w,this.animationValues);f.render();for(const P in w)f.setStaticValue(P,w[P]),this.animationValues&&(this.animationValues[P]=w[P]);f.scheduleRender()}applyProjectionStyles(f,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){f.visibility="hidden";return}const v=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,f.visibility="",f.opacity="",f.pointerEvents=ZP(o==null?void 0:o.pointerEvents)||"",f.transform=v?v(this.latestValues,""):"none";return}const w=this.getLead();if(!this.projectionDelta||!this.layout||!w.target){this.options.layoutId&&(f.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,f.pointerEvents=ZP(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!_g(this.latestValues)&&(f.transform=v?v({},""):"none",this.hasProjected=!1);return}f.visibility="";const P=w.animationValues||w.latestValues;this.applyTransformsToTarget();let C=YEe(this.projectionDeltaWithTransform,this.treeScale,P);v&&(C=v(P,C)),f.transform=C;const{x:k,y:L}=this.projectionDelta;f.transformOrigin=`${k.origin*100}% ${L.origin*100}% 0`,w.animationValues?f.opacity=w===this?P.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:P.opacityExit:f.opacity=w===this?P.opacity!==void 0?P.opacity:"":P.opacityExit!==void 0?P.opacityExit:0;for(const $ in rz){if(P[$]===void 0)continue;const{correct:j,applyTo:B,isCSSVariable:U}=rz[$],q=C==="none"?P[$]:j(P[$],w);if(B){const H=B.length;for(let te=0;te<H;te++)f[B[te]]=q}else U?this.options.visualElement.renderState.vars[$]=q:f[$]=q}this.options.layoutId&&(f.pointerEvents=w===this?ZP(o==null?void 0:o.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var o;return(o=f.currentAnimation)==null?void 0:o.stop()}),this.root.nodes.forEach(TH),this.root.sharedNodes.clear()}}}function cAe(e){e.updateLayout()}function uAe(e){var r;const t=((r=e.resumeFrom)==null?void 0:r.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:l}=e.layout,{animationType:u}=e.options,f=t.source!==e.layout.source;u==="size"?jc(C=>{const k=f?t.measuredBox[C]:t.layoutBox[C],L=ml(k);k.min=n[C].min,k.max=k.min+L}):Lte(u,t.layoutBox,n)&&jc(C=>{const k=f?t.measuredBox[C]:t.layoutBox[C],L=ml(n[C]);k.max=k.min+L,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[C].max=e.relativeTarget[C].min+L)});const o=Mv();U1(o,n,t.layoutBox);const v=Mv();f?U1(v,e.applyTransform(l,!0),t.measuredBox):U1(v,n,t.layoutBox);const w=!Ite(o);let P=!1;if(!e.resumeFrom){const C=e.getClosestProjectingParent();if(C&&!C.resumeFrom){const{snapshot:k,layout:L}=C;if(k&&L){const $=Fs();GC($,t.layoutBox,k.layoutBox);const j=Fs();GC(j,n,L.layoutBox),Ote($,j)||(P=!0),C.options.layoutRoot&&(e.relativeTarget=j,e.relativeTargetOrigin=$,e.relativeParent=C)}}}e.notifyListeners("didUpdate",{layout:n,snapshot:t,delta:v,layoutDelta:o,hasLayoutChanged:w,hasRelativeLayoutChanged:P})}else if(e.isLead()){const{onExitComplete:n}=e.options;n&&n()}e.options.transition=void 0}function dAe(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function hAe(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function fAe(e){e.clearSnapshot()}function TH(e){e.clearMeasurements()}function EH(e){e.isLayoutDirty=!1}function pAe(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function AH(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function mAe(e){e.resolveTargetDelta()}function gAe(e){e.calcProjection()}function yAe(e){e.resetSkewAndRotation()}function _Ae(e){e.removeLeadSnapshot()}function PH(e,t,r){e.translate=Go(t.translate,0,r),e.scale=Go(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function CH(e,t,r,n){e.min=Go(t.min,r.min,n),e.max=Go(t.max,r.max,n)}function vAe(e,t,r,n){CH(e.x,t.x,r.x,n),CH(e.y,t.y,r.y,n)}function xAe(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const bAe={duration:.45,ease:[.4,0,.1,1]},IH=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),OH=IH("applewebkit/")&&!IH("chrome/")?Math.round:Zc;function kH(e){e.min=OH(e.min),e.max=OH(e.max)}function wAe(e){kH(e.x),kH(e.y)}function Lte(e,t,r){return e==="position"||e==="preserve-aspect"&&!qEe(vH(t),vH(r),.2)}function SAe(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const TAe=Dte({attachResizeListener:(e,t)=>zS(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),fL={current:void 0},jte=Dte({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!fL.current){const e=new TAe({});e.mount(window),e.setOptions({layoutScroll:!0}),fL.current=e}return fL.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),i5=X.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function RH(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function EAe(...e){return t=>{let r=!1;const n=e.map(l=>{const u=RH(l,t);return!r&&typeof u=="function"&&(r=!0),u});if(r)return()=>{for(let l=0;l<n.length;l++){const u=n[l];typeof u=="function"?u():RH(e[l],null)}}}}function AAe(...e){return X.useCallback(EAe(...e),e)}class PAe extends X.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const n=r.offsetParent,l=ote(n)&&n.offsetWidth||0,u=this.props.sizeRef.current;u.height=r.offsetHeight||0,u.width=r.offsetWidth||0,u.top=r.offsetTop,u.left=r.offsetLeft,u.right=l-u.width-u.left}return null}componentDidUpdate(){}render(){return this.props.children}}function CAe({children:e,isPresent:t,anchorX:r,root:n}){var P;const l=X.useId(),u=X.useRef(null),f=X.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=X.useContext(i5),v=((P=e.props)==null?void 0:P.ref)??(e==null?void 0:e.ref),w=AAe(u,v);return X.useInsertionEffect(()=>{const{width:C,height:k,top:L,left:$,right:j}=f.current;if(t||!u.current||!C||!k)return;const B=r==="left"?`left: ${$}`:`right: ${j}`;u.current.dataset.motionPopId=l;const U=document.createElement("style");o&&(U.nonce=o);const q=n??document.head;return q.appendChild(U),U.sheet&&U.sheet.insertRule(`
          [data-motion-pop-id="${l}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${k}px !important;
            ${B}px !important;
            top: ${L}px !important;
          }
        `),()=>{q.contains(U)&&q.removeChild(U)}},[t]),A.jsx(PAe,{isPresent:t,childRef:u,sizeRef:f,children:X.cloneElement(e,{ref:w})})}const IAe=({children:e,initial:t,isPresent:r,onExitComplete:n,custom:l,presenceAffectsLayout:u,mode:f,anchorX:o,root:v})=>{const w=kB(OAe),P=X.useId();let C=!0,k=X.useMemo(()=>(C=!1,{id:P,initial:t,isPresent:r,custom:l,onExitComplete:L=>{w.set(L,!0);for(const $ of w.values())if(!$)return;n&&n()},register:L=>(w.set(L,!1),()=>w.delete(L))}),[r,w,n]);return u&&C&&(k={...k}),X.useMemo(()=>{w.forEach((L,$)=>w.set($,!1))},[r]),X.useEffect(()=>{!r&&!w.size&&n&&n()},[r]),f==="popLayout"&&(e=A.jsx(CAe,{isPresent:r,anchorX:o,root:v,children:e})),A.jsx(jO.Provider,{value:k,children:e})};function OAe(){return new Map}function Nte(e=!0){const t=X.useContext(jO);if(t===null)return[!0,null];const{isPresent:r,onExitComplete:n,register:l}=t,u=X.useId();X.useEffect(()=>{if(e)return l(u)},[e]);const f=X.useCallback(()=>e&&n&&n(u),[u,n,e]);return!r&&n?[!1,f]:[!0]}const cP=e=>e.key||"";function MH(e){const t=[];return X.Children.forEach(e,r=>{X.isValidElement(r)&&t.push(r)}),t}const O0=({children:e,custom:t,initial:r=!0,onExitComplete:n,presenceAffectsLayout:l=!0,mode:u="sync",propagate:f=!1,anchorX:o="left",root:v})=>{const[w,P]=Nte(f),C=X.useMemo(()=>MH(e),[e]),k=f&&!w?[]:C.map(cP),L=X.useRef(!0),$=X.useRef(C),j=kB(()=>new Map),B=X.useRef(new Set),[U,q]=X.useState(C),[H,te]=X.useState(C);pee(()=>{L.current=!1,$.current=C;for(let ue=0;ue<H.length;ue++){const me=cP(H[ue]);k.includes(me)?(j.delete(me),B.current.delete(me)):j.get(me)!==!0&&j.set(me,!1)}},[H,k.length,k.join("-")]);const Q=[];if(C!==U){let ue=[...C];for(let me=0;me<H.length;me++){const Ce=H[me],Fe=cP(Ce);k.includes(Fe)||(ue.splice(me,0,Ce),Q.push(Ce))}return u==="wait"&&Q.length&&(ue=Q),te(MH(ue)),q(C),null}const{forceRender:ae}=X.useContext(OB);return A.jsx(A.Fragment,{children:H.map(ue=>{const me=cP(ue),Ce=f&&!w?!1:C===H||k.includes(me),Fe=()=>{if(B.current.has(me))return;if(B.current.add(me),j.has(me))j.set(me,!0);else return;let Ge=!0;j.forEach(Ve=>{Ve||(Ge=!1)}),Ge&&(ae==null||ae(),te($.current),f&&(P==null||P()),n&&n())};return A.jsx(IAe,{isPresent:Ce,initial:!L.current||r?void 0:!1,custom:t,presenceAffectsLayout:l,mode:u,root:v,onExitComplete:Ce?void 0:Fe,anchorX:o,children:ue},me)})})},zte=X.createContext({strict:!1}),DH={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let LH=!1;function kAe(){if(LH)return;const e={};for(const t in DH)e[t]={isEnabled:r=>DH[t].some(n=>!!r[n])};fte(e),LH=!0}function Fte(){return kAe(),yEe()}function RAe(e){const t=Fte();for(const r in e)t[r]={...t[r],...e[r]};fte(t)}const MAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function qC(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||MAe.has(e)}let Bte=e=>!qC(e);function DAe(e){typeof e=="function"&&(Bte=t=>t.startsWith("on")?!qC(t):e(t))}try{DAe(require("@emotion/is-prop-valid").default)}catch{}function LAe(e,t,r){const n={};for(const l in e)l==="values"&&typeof e.values=="object"||(Bte(l)||r===!0&&qC(l)||!t&&!qC(l)||e.draggable&&l.startsWith("onDrag"))&&(n[l]=e[l]);return n}const BO=X.createContext({});function jAe(e,t){if(FO(e)){const{initial:r,animate:n}=e;return{initial:r===!1||NS(r)?r:void 0,animate:NS(n)?n:void 0}}return e.inherit!==!1?t:{}}function NAe(e){const{initial:t,animate:r}=jAe(e,X.useContext(BO));return X.useMemo(()=>({initial:t,animate:r}),[jH(t),jH(r)])}function jH(e){return Array.isArray(e)?e.join(" "):e}const o5=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function $te(e,t,r){for(const n in t)!Ua(t[n])&&!xte(n,r)&&(e[n]=t[n])}function zAe({transformTemplate:e},t){return X.useMemo(()=>{const r=o5();return r5(r,t,e),Object.assign({},r.vars,r.style)},[t])}function FAe(e,t){const r=e.style||{},n={};return $te(n,r,e),Object.assign(n,zAe(e,t)),n}function BAe(e,t){const r={},n=FAe(e,t);return e.drag&&e.dragListener!==!1&&(r.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(r.tabIndex=0),r.style=n,r}const Vte=()=>({...o5(),attrs:{}});function $Ae(e,t,r,n){const l=X.useMemo(()=>{const u=Vte();return bte(u,t,Ste(n),e.transformTemplate,e.style),{...u.attrs,style:{...u.style}}},[t]);if(e.style){const u={};$te(u,e.style,e),l.style={...u,...l.style}}return l}const VAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function s5(e){return typeof e!="string"||e.includes("-")?!1:!!(VAe.indexOf(e)>-1||/[A-Z]/u.test(e))}function UAe(e,t,r,{latestValues:n},l,u=!1,f){const v=(f??s5(e)?$Ae:BAe)(t,n,l,e),w=LAe(t,typeof e=="string",u),P=e!==X.Fragment?{...w,...v,ref:r}:{},{children:C}=t,k=X.useMemo(()=>Ua(C)?C.get():C,[C]);return X.createElement(e,{...P,children:k})}function GAe({scrapeMotionValuesFromProps:e,createRenderState:t},r,n,l){return{latestValues:qAe(r,n,l,e),renderState:t()}}function qAe(e,t,r,n){const l={},u=n(e,{});for(const k in u)l[k]=ZP(u[k]);let{initial:f,animate:o}=e;const v=FO(e),w=hte(e);t&&w&&!v&&e.inherit!==!1&&(f===void 0&&(f=t.initial),o===void 0&&(o=t.animate));let P=r?r.initial===!1:!1;P=P||f===!1;const C=P?o:f;if(C&&typeof C!="boolean"&&!zO(C)){const k=Array.isArray(C)?C:[C];for(let L=0;L<k.length;L++){const $=XB(e,k[L]);if($){const{transitionEnd:j,transition:B,...U}=$;for(const q in U){let H=U[q];if(Array.isArray(H)){const te=P?H.length-1:0;H=H[te]}H!==null&&(l[q]=H)}for(const q in j)l[q]=j[q]}}}return l}const Ute=e=>(t,r)=>{const n=X.useContext(BO),l=X.useContext(jO),u=()=>GAe(e,t,n,l);return r?u():kB(u)},HAe=Ute({scrapeMotionValuesFromProps:n5,createRenderState:o5}),WAe=Ute({scrapeMotionValuesFromProps:Tte,createRenderState:Vte}),ZAe=Symbol.for("motionComponentSymbol");function XAe(e,t,r){const n=X.useRef(r);X.useInsertionEffect(()=>{n.current=r});const l=X.useRef(null);return X.useCallback(u=>{var o;u&&((o=e.onMount)==null||o.call(e,u)),t&&(u?t.mount(u):t.unmount());const f=n.current;if(typeof f=="function")if(u){const v=f(u);typeof v=="function"&&(l.current=v)}else l.current?(l.current(),l.current=null):f(u);else f&&(f.current=u)},[t])}const Gte=X.createContext({});function S1(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function KAe(e,t,r,n,l,u){var B,U;const{visualElement:f}=X.useContext(BO),o=X.useContext(zte),v=X.useContext(jO),w=X.useContext(i5).reducedMotion,P=X.useRef(null);n=n||o.renderer,!P.current&&n&&(P.current=n(e,{visualState:t,parent:f,props:r,presenceContext:v,blockInitialAnimation:v?v.initial===!1:!1,reducedMotionConfig:w,isSVG:u}));const C=P.current,k=X.useContext(Gte);C&&!C.projection&&l&&(C.type==="html"||C.type==="svg")&&YAe(P.current,r,l,k);const L=X.useRef(!1);X.useInsertionEffect(()=>{C&&L.current&&C.update(r,v)});const $=r[Yee],j=X.useRef(!!$&&!((B=window.MotionHandoffIsComplete)!=null&&B.call(window,$))&&((U=window.MotionHasOptimisedAnimation)==null?void 0:U.call(window,$)));return pee(()=>{C&&(L.current=!0,window.MotionIsMounted=!0,C.updateFeatures(),C.scheduleRenderMicrotask(),j.current&&C.animationState&&C.animationState.animateChanges())}),X.useEffect(()=>{C&&(!j.current&&C.animationState&&C.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{var q;(q=window.MotionHandoffMarkAsComplete)==null||q.call(window,$)}),j.current=!1),C.enteringChildren=void 0)}),C}function YAe(e,t,r,n){const{layoutId:l,layout:u,drag:f,dragConstraints:o,layoutScroll:v,layoutRoot:w,layoutCrossfade:P}=t;e.projection=new r(e.latestValues,t["data-framer-portal-id"]?void 0:qte(e.parent)),e.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!f||o&&S1(o),visualElement:e,animationType:typeof u=="string"?u:"both",initialPromotionConfig:n,crossfade:P,layoutScroll:v,layoutRoot:w})}function qte(e){if(e)return e.options.allowProjection!==!1?e.projection:qte(e.parent)}function pL(e,{forwardMotionProps:t=!1,type:r}={},n,l){n&&RAe(n);const u=r?r==="svg":s5(e),f=u?WAe:HAe;function o(w,P){let C;const k={...X.useContext(i5),...w,layoutId:JAe(w)},{isStatic:L}=k,$=NAe(w),j=f(w,L);if(!L&&fee){QAe();const B=e2e(k);C=B.MeasureLayout,$.visualElement=KAe(e,j,k,l,B.ProjectionNode,u)}return A.jsxs(BO.Provider,{value:$,children:[C&&$.visualElement?A.jsx(C,{visualElement:$.visualElement,...k}):null,UAe(e,w,XAe(j,$.visualElement,P),j,L,t,u)]})}o.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const v=X.forwardRef(o);return v[ZAe]=e,v}function JAe({layoutId:e}){const t=X.useContext(OB).id;return t&&e!==void 0?t+"-"+e:e}function QAe(e,t){X.useContext(zte).strict}function e2e(e){const t=Fte(),{drag:r,layout:n}=t;if(!r&&!n)return{};const l={...r,...n};return{MeasureLayout:r!=null&&r.isEnabled(e)||n!=null&&n.isEnabled(e)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function t2e(e,t){if(typeof Proxy>"u")return pL;const r=new Map,n=(u,f)=>pL(u,f,e,t),l=(u,f)=>n(u,f);return new Proxy(l,{get:(u,f)=>f==="create"?n:(r.has(f)||r.set(f,pL(f,void 0,e,t)),r.get(f))})}const r2e=(e,t)=>t.isSVG??s5(e)?new DEe(t):new CEe(t,{allowProjection:e!==X.Fragment});class n2e extends nm{constructor(t){super(t),t.animationState||(t.animationState=FEe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();zO(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let i2e=0;class o2e extends nm{constructor(){super(...arguments),this.id=i2e++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const l=this.node.animationState.setActive("exit",!t);r&&!t&&l.then(()=>{r(this.id)})}mount(){const{register:t,onExitComplete:r}=this.node.presenceContext||{};r&&r(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const s2e={animation:{Feature:n2e},exit:{Feature:o2e}};function GT(e){return{point:{x:e.pageX,y:e.pageY}}}const a2e=e=>t=>QB(t)&&e(t,GT(t));function G1(e,t,r,n){return zS(e,t,a2e(r),n)}const Hte=({current:e})=>e?e.ownerDocument.defaultView:null,NH=(e,t)=>Math.abs(e-t);function l2e(e,t){const r=NH(e.x,t.x),n=NH(e.y,t.y);return Math.sqrt(r**2+n**2)}const zH=new Set(["auto","scroll"]);class Wte{constructor(t,r,{transformPagePoint:n,contextWindow:l=window,dragSnapToOrigin:u=!1,distanceThreshold:f=3,element:o}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=L=>{this.handleScroll(L.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const L=gL(this.lastMoveEventInfo,this.history),$=this.startEvent!==null,j=l2e(L.offset,{x:0,y:0})>=this.distanceThreshold;if(!$&&!j)return;const{point:B}=L,{timestamp:U}=Sa;this.history.push({...B,timestamp:U});const{onStart:q,onMove:H}=this.handlers;$||(q&&q(this.lastMoveEvent,L),this.startEvent=this.lastMoveEvent),H&&H(this.lastMoveEvent,L)},this.handlePointerMove=(L,$)=>{this.lastMoveEvent=L,this.lastMoveEventInfo=mL($,this.transformPagePoint),Ao.update(this.updatePoint,!0)},this.handlePointerUp=(L,$)=>{this.end();const{onEnd:j,onSessionEnd:B,resumeAnimation:U}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const q=gL(L.type==="pointercancel"?this.lastMoveEventInfo:mL($,this.transformPagePoint),this.history);this.startEvent&&j&&j(L,q),B&&B(L,q)},!QB(t))return;this.dragSnapToOrigin=u,this.handlers=r,this.transformPagePoint=n,this.distanceThreshold=f,this.contextWindow=l||window;const v=GT(t),w=mL(v,this.transformPagePoint),{point:P}=w,{timestamp:C}=Sa;this.history=[{...P,timestamp:C}];const{onSessionStart:k}=r;k&&k(t,gL(w,this.history)),this.removeListeners=$T(G1(this.contextWindow,"pointermove",this.handlePointerMove),G1(this.contextWindow,"pointerup",this.handlePointerUp),G1(this.contextWindow,"pointercancel",this.handlePointerUp)),o&&this.startScrollTracking(o)}startScrollTracking(t){let r=t.parentElement;for(;r;){const n=getComputedStyle(r);(zH.has(n.overflowX)||zH.has(n.overflowY))&&this.scrollPositions.set(r,{x:r.scrollLeft,y:r.scrollTop}),r=r.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const r=this.scrollPositions.get(t);if(!r)return;const n=t===window,l=n?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},u={x:l.x-r.x,y:l.y-r.y};u.x===0&&u.y===0||(n?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=u.x,this.lastMoveEventInfo.point.y+=u.y):this.history.length>0&&(this.history[0].x-=u.x,this.history[0].y-=u.y),this.scrollPositions.set(t,l),Ao.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Xp(this.updatePoint)}}function mL(e,t){return t?{point:t(e.point)}:e}function FH(e,t){return{x:e.x-t.x,y:e.y-t.y}}function gL({point:e},t){return{point:e,delta:FH(e,Zte(t)),offset:FH(e,c2e(t)),velocity:u2e(t,.1)}}function c2e(e){return e[0]}function Zte(e){return e[e.length-1]}function u2e(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,n=null;const l=Zte(e);for(;r>=0&&(n=e[r],!(l.timestamp-n.timestamp>zd(t)));)r--;if(!n)return{x:0,y:0};const u=qc(l.timestamp-n.timestamp);if(u===0)return{x:0,y:0};const f={x:(l.x-n.x)/u,y:(l.y-n.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function d2e(e,{min:t,max:r},n){return t!==void 0&&e<t?e=n?Go(t,e,n.min):Math.max(e,t):r!==void 0&&e>r&&(e=n?Go(r,e,n.max):Math.min(e,r)),e}function BH(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function h2e(e,{top:t,left:r,bottom:n,right:l}){return{x:BH(e.x,r,l),y:BH(e.y,t,n)}}function $H(e,t){let r=t.min-e.min,n=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,n]=[n,r]),{min:r,max:n}}function f2e(e,t){return{x:$H(e.x,t.x),y:$H(e.y,t.y)}}function p2e(e,t){let r=.5;const n=ml(e),l=ml(t);return l>n?r=DS(t.min,t.max-n,e.min):n>l&&(r=DS(e.min,e.max-l,t.min)),qd(0,1,r)}function m2e(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const nz=.35;function g2e(e=nz){return e===!1?e=0:e===!0&&(e=nz),{x:VH(e,"left","right"),y:VH(e,"top","bottom")}}function VH(e,t,r){return{min:UH(e,t),max:UH(e,r)}}function UH(e,t){return typeof e=="number"?e:e[t]||0}const y2e=new WeakMap;class _2e{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Fs(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:r=!1,distanceThreshold:n}={}){const{presenceContext:l}=this.visualElement;if(l&&l.isPresent===!1)return;const u=C=>{r?(this.stopAnimation(),this.snapToCursor(GT(C).point)):this.pauseAnimation()},f=(C,k)=>{this.stopAnimation();const{drag:L,dragPropagation:$,onDragStart:j}=this.getProps();if(L&&!$&&(this.openDragLock&&this.openDragLock(),this.openDragLock=oEe(L),!this.openDragLock))return;this.latestPointerEvent=C,this.latestPanInfo=k,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),jc(U=>{let q=this.getAxisMotionValue(U).get()||0;if(Fd.test(q)){const{projection:H}=this.visualElement;if(H&&H.layout){const te=H.layout.layoutBox[U];te&&(q=ml(te)*(parseFloat(q)/100))}}this.originPoint[U]=q}),j&&Ao.postRender(()=>j(C,k)),KN(this.visualElement,"transform");const{animationState:B}=this.visualElement;B&&B.setActive("whileDrag",!0)},o=(C,k)=>{this.latestPointerEvent=C,this.latestPanInfo=k;const{dragPropagation:L,dragDirectionLock:$,onDirectionLock:j,onDrag:B}=this.getProps();if(!L&&!this.openDragLock)return;const{offset:U}=k;if($&&this.currentDirection===null){this.currentDirection=v2e(U),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",k.point,U),this.updateAxis("y",k.point,U),this.visualElement.render(),B&&B(C,k)},v=(C,k)=>{this.latestPointerEvent=C,this.latestPanInfo=k,this.stop(C,k),this.latestPointerEvent=null,this.latestPanInfo=null},w=()=>jc(C=>{var k;return this.getAnimationState(C)==="paused"&&((k=this.getAxisMotionValue(C).animation)==null?void 0:k.play())}),{dragSnapToOrigin:P}=this.getProps();this.panSession=new Wte(t,{onSessionStart:u,onStart:f,onMove:o,onSessionEnd:v,resumeAnimation:w},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:P,distanceThreshold:n,contextWindow:Hte(this.visualElement),element:this.visualElement.current})}stop(t,r){const n=t||this.latestPointerEvent,l=r||this.latestPanInfo,u=this.isDragging;if(this.cancel(),!u||!l||!n)return;const{velocity:f}=l;this.startAnimation(f);const{onDragEnd:o}=this.getProps();o&&Ao.postRender(()=>o(n,l))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,n){const{drag:l}=this.getProps();if(!n||!uP(t,l,this.currentDirection))return;const u=this.getAxisMotionValue(t);let f=this.originPoint[t]+n[t];this.constraints&&this.constraints[t]&&(f=d2e(f,this.constraints[t],this.elastic[t])),u.set(f)}resolveConstraints(){var u;const{dragConstraints:t,dragElastic:r}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(u=this.visualElement.projection)==null?void 0:u.layout,l=this.constraints;t&&S1(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&n?this.constraints=h2e(n.layoutBox,t):this.constraints=!1,this.elastic=g2e(r),l!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&jc(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=m2e(n.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!S1(t))return!1;const n=t.current;C0(n!==null,"If `dragConstraints` is set as a React ref, that ref must be passed to another component's `ref` prop.","drag-constraints-ref");const{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=wEe(n,l.root,this.visualElement.getTransformPagePoint());let f=f2e(l.layout.layoutBox,u);if(r){const o=r(vEe(f));this.hasMutatedConstraints=!!o,o&&(f=mte(o))}return f}startAnimation(t){const{drag:r,dragMomentum:n,dragElastic:l,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:o}=this.getProps(),v=this.constraints||{},w=jc(P=>{if(!uP(P,r,this.currentDirection))return;let C=v&&v[P]||{};f&&(C={min:0,max:0});const k=l?200:1e6,L=l?40:1e7,$={type:"inertia",velocity:n?t[P]:0,bounceStiffness:k,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...u,...C};return this.startAxisValueAnimation(P,$)});return Promise.all(w).then(o)}startAxisValueAnimation(t,r){const n=this.getAxisMotionValue(t);return KN(this.visualElement,t),n.start(ZB(t,n,0,r,this.visualElement,!1))}stopAnimation(){jc(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){jc(t=>{var r;return(r=this.getAxisMotionValue(t).animation)==null?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)==null?void 0:r.state}getAxisMotionValue(t){const r=`_drag${t.toUpperCase()}`,n=this.visualElement.getProps(),l=n[r];return l||this.visualElement.getValue(t,(n.initial?n.initial[t]:void 0)||0)}snapToCursor(t){jc(r=>{const{drag:n}=this.getProps();if(!uP(r,n,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(r);if(l&&l.layout){const{min:f,max:o}=l.layout.layoutBox[r],v=u.get()||0;u.set(t[r]-Go(f,o,.5)+v)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:n}=this.visualElement;if(!S1(r)||!n||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};jc(f=>{const o=this.getAxisMotionValue(f);if(o&&this.constraints!==!1){const v=o.get();l[f]=p2e({min:v,max:v},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),jc(f=>{if(!uP(f,t,null))return;const o=this.getAxisMotionValue(f),{min:v,max:w}=this.constraints[f];o.set(Go(v,w,l[f]))})}addListeners(){if(!this.visualElement.current)return;y2e.set(this.visualElement,this);const t=this.visualElement.current,r=G1(t,"pointerdown",v=>{const{drag:w,dragListener:P=!0}=this.getProps();w&&P&&!cte(v.target)&&this.start(v)}),n=()=>{const{dragConstraints:v}=this.getProps();S1(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",n);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Ao.read(n);const f=zS(window,"resize",()=>this.scalePositionWithinConstraints()),o=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:w})=>{this.isDragging&&w&&(jc(P=>{const C=this.getAxisMotionValue(P);C&&(this.originPoint[P]+=v[P].translate,C.set(C.get()+v[P].translate))}),this.visualElement.render())});return()=>{f(),r(),u(),o&&o()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:n=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:f=nz,dragMomentum:o=!0}=t;return{...t,drag:r,dragDirectionLock:n,dragPropagation:l,dragConstraints:u,dragElastic:f,dragMomentum:o}}}function uP(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function v2e(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class x2e extends nm{constructor(t){super(t),this.removeGroupControls=Zc,this.removeListeners=Zc,this.controls=new _2e(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Zc}update(){const{dragControls:t}=this.node.getProps(),{dragControls:r}=this.node.prevProps||{};t!==r&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners()}}const GH=e=>(t,r)=>{e&&Ao.postRender(()=>e(t,r))};class b2e extends nm{constructor(){super(...arguments),this.removePointerDownListener=Zc}onPointerDown(t){this.session=new Wte(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Hte(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:n,onPanEnd:l}=this.node.getProps();return{onSessionStart:GH(t),onStart:GH(r),onMove:n,onEnd:(u,f)=>{delete this.session,l&&Ao.postRender(()=>l(u,f))}}}mount(){this.removePointerDownListener=G1(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let yL=!1;class w2e extends X.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n,layoutId:l}=this.props,{projection:u}=t;u&&(r.group&&r.group.add(u),n&&n.register&&l&&n.register(u),yL&&u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),XP.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:n,drag:l,isPresent:u}=this.props,{projection:f}=n;return f&&(f.isPresent=u,yL=!0,l||t.layoutDependency!==r||r===void 0||t.isPresent!==u?f.willUpdate():this.safeToRemove(),t.isPresent!==u&&(u?f.promote():f.relegate()||Ao.postRender(()=>{const o=f.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),JB.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:n}=this.props,{projection:l}=t;yL=!0,l&&(l.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(l),n&&n.deregister&&n.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Xte(e){const[t,r]=Nte(),n=X.useContext(OB);return A.jsx(w2e,{...e,layoutGroup:n,switchLayoutGroup:X.useContext(Gte),isPresent:t,safeToRemove:r})}const S2e={pan:{Feature:b2e},drag:{Feature:x2e,ProjectionNode:jte,MeasureLayout:Xte}};function qH(e,t,r){const{props:n}=e;e.animationState&&n.whileHover&&e.animationState.setActive("whileHover",r==="Start");const l="onHover"+r,u=n[l];u&&Ao.postRender(()=>u(t,GT(t)))}class T2e extends nm{mount(){const{current:t}=this.node;t&&(this.unmount=sEe(t,(r,n)=>(qH(this.node,n,"Start"),l=>qH(this.node,l,"End"))))}unmount(){}}class E2e extends nm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=$T(zS(this.node.current,"focus",()=>this.onFocus()),zS(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function HH(e,t,r){const{props:n}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&n.whileTap&&e.animationState.setActive("whileTap",r==="Start");const l="onTap"+(r==="End"?"":r),u=n[l];u&&Ao.postRender(()=>u(t,GT(t)))}class A2e extends nm{mount(){const{current:t}=this.node;t&&(this.unmount=cEe(t,(r,n)=>(HH(this.node,n,"Start"),(l,{success:u})=>HH(this.node,l,u?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const iz=new WeakMap,_L=new WeakMap,P2e=e=>{const t=iz.get(e.target);t&&t(e)},C2e=e=>{e.forEach(P2e)};function I2e({root:e,...t}){const r=e||document;_L.has(r)||_L.set(r,{});const n=_L.get(r),l=JSON.stringify(t);return n[l]||(n[l]=new IntersectionObserver(C2e,{root:e,...t})),n[l]}function O2e(e,t,r){const n=I2e(t);return iz.set(e,r),n.observe(e),()=>{iz.delete(e),n.unobserve(e)}}const k2e={some:0,all:1};class R2e extends nm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:n,amount:l="some",once:u}=t,f={root:r?r.current:void 0,rootMargin:n,threshold:typeof l=="number"?l:k2e[l]},o=v=>{const{isIntersecting:w}=v;if(this.isInView===w||(this.isInView=w,u&&!w&&this.hasEnteredView))return;w&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",w);const{onViewportEnter:P,onViewportLeave:C}=this.node.getProps(),k=w?P:C;k&&k(v)};return O2e(this.node.current,f,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(M2e(t,r))&&this.startObserver()}unmount(){}}function M2e({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const D2e={inView:{Feature:R2e},tap:{Feature:A2e},focus:{Feature:E2e},hover:{Feature:T2e}},L2e={layout:{ProjectionNode:jte,MeasureLayout:Xte}},j2e={...s2e,...D2e,...S2e,...L2e},Ar=t2e(j2e,r2e);function N2e({listing:e,index:t=0}){const[r,n]=X.useState(!1);return A.jsx(Ar.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.5,delay:t*.1,ease:[.25,.46,.45,.94]},children:A.jsx(xi,{to:`/listings/${e.slug}`,className:"block group",children:A.jsxs("div",{className:"bg-card overflow-hidden shadow-card hover-lift",children:[A.jsxs("div",{className:"relative aspect-[4/3] overflow-hidden image-hover-overlay",children:[A.jsx("img",{src:e.cover_image_url||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800&q=80",alt:e.title,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"}),A.jsx("button",{onClick:u=>{u.preventDefault(),n(!r)},className:sr("absolute top-4 right-4 h-10 w-10 flex items-center justify-center transition-all duration-300 z-10",r?"bg-primary text-white":"bg-white text-muted-foreground hover:bg-primary hover:text-white"),children:A.jsx(Q3,{className:sr("h-5 w-5",r&&"fill-current")})}),A.jsx(Dh,{className:sr("absolute top-4 left-4 rounded-none px-3 py-1 font-sans text-xs uppercase tracking-wider",IB(e.status)),children:CB(e.status)})]}),A.jsxs("div",{className:"p-6 space-y-4",children:[A.jsxs("div",{className:"flex items-baseline gap-2",children:[A.jsx("span",{className:"font-display text-2xl font-semibold text-foreground",children:BT(e.price)}),e.status==="for_rent"&&A.jsx("span",{className:"text-sm text-muted-foreground",children:"/month"})]}),A.jsxs("div",{children:[A.jsx("h3",{className:"font-sans font-medium text-foreground line-clamp-1 group-hover:text-accent transition-colors",children:e.title}),A.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground text-sm mt-1",children:[A.jsx(Oh,{className:"h-3.5 w-3.5"}),A.jsxs("span",{className:"line-clamp-1",children:[e.address,", ",e.city,", ",e.state]})]})]}),A.jsxs("div",{className:"flex items-center gap-4 pt-4 border-t border-border text-sm text-muted-foreground",children:[e.beds&&A.jsxs("div",{className:"flex items-center gap-1.5",children:[A.jsx(MJ,{className:"h-4 w-4"}),A.jsxs("span",{children:[e.beds," ",e.beds===1?"Bed":"Beds"]})]}),e.baths&&A.jsxs("div",{className:"flex items-center gap-1.5",children:[A.jsx(RJ,{className:"h-4 w-4"}),A.jsxs("span",{children:[e.baths," ",e.baths===1?"Bath":"Baths"]})]}),e.sqft&&A.jsxs("div",{className:"flex items-center gap-1.5",children:[A.jsx(NJ,{className:"h-4 w-4"}),A.jsxs("span",{children:[e.sqft.toLocaleString()," sqft"]})]})]})]})]})})})}function Kte(e){return Qc({queryKey:["public-listings",e],queryFn:async()=>{let t=ni.from("listings").select("*").eq("published",!0);switch(e!=null&&e.city&&(t=t.ilike("city",`%${e.city}%`)),e!=null&&e.status&&(t=t.eq("status",e.status)),e!=null&&e.propertyType&&(t=t.eq("property_type",e.propertyType)),e!=null&&e.minPrice&&(t=t.gte("price",e.minPrice)),e!=null&&e.maxPrice&&(t=t.lte("price",e.maxPrice)),e!=null&&e.minBeds&&(t=t.gte("beds",e.minBeds)),e==null?void 0:e.sortBy){case"price_asc":t=t.order("price",{ascending:!0});break;case"price_desc":t=t.order("price",{ascending:!1});break;default:t=t.order("created_at",{ascending:!1})}const{data:r,error:n}=await t;if(n)throw n;return r}})}function z2e(e){return Qc({queryKey:["listing",e],queryFn:async()=>{const{data:t,error:r}=await ni.from("listings").select("*").eq("slug",e).single();if(r)throw r;return t},enabled:!!e})}function F2e(e){return Qc({queryKey:["listing-images",e],queryFn:async()=>{const{data:t,error:r}=await ni.from("listing_images").select("*").eq("listing_id",e).order("sort_order",{ascending:!0});if(r)throw r;return t},enabled:!!e})}function $O(){const{user:e}=sf();return Qc({queryKey:["admin-listings",e==null?void 0:e.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await ni.from("listings").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(r)throw r;return t},enabled:!!e})}function Yte(){const e=by(),{user:t}=sf();return P0({mutationFn:async r=>{if(!t)throw new Error("Not authenticated");const n={title:r.title||"",address:r.address||"",city:r.city||"",state:r.state||"",zip:r.zip||"",price:r.price||0,slug:r.slug||"",beds:r.beds,baths:r.baths,sqft:r.sqft,lot_size:r.lot_size,property_type:r.property_type||"house",status:r.status||"for_sale",description:r.description,features_json:r.features_json,cover_image_url:r.cover_image_url,source:r.source||"manual",zillow_url:r.zillow_url,mls_number:r.mls_number,latitude:r.latitude,longitude:r.longitude,open_house_schedule:r.open_house_schedule,published:r.published||!1,user_id:t.id},{data:l,error:u}=await ni.from("listings").insert(n).select().single();if(u)throw u;return l},onSuccess:()=>{e.invalidateQueries({queryKey:["admin-listings"]}),Ni.success("Listing created successfully")},onError:r=>{Ni.error(`Failed to create listing: ${r.message}`)}})}function B2e(){const e=by();return P0({mutationFn:async({id:t,data:r})=>{const{data:n,error:l}=await ni.from("listings").update(r).eq("id",t).select().single();if(l)throw l;return n},onSuccess:t=>{e.invalidateQueries({queryKey:["admin-listings"]}),e.invalidateQueries({queryKey:["listing",t.slug]}),Ni.success("Listing updated successfully")},onError:t=>{Ni.error(`Failed to update listing: ${t.message}`)}})}function $2e(){const e=by();return P0({mutationFn:async t=>{const{error:r}=await ni.from("listings").delete().eq("id",t);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["admin-listings"]}),Ni.success("Listing deleted successfully")},onError:t=>{Ni.error(`Failed to delete listing: ${t.message}`)}})}function oz(e,t){const r=`${e}-${t}`.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),n=Math.random().toString(36).substring(2,8);return`${r}-${n}`}const Jte="/joelrealtor/assets/joel-aguirre-BoRKdkXb.png";var qT=e=>e.type==="checkbox",kg=e=>e instanceof Date,fl=e=>e==null;const Qte=e=>typeof e=="object";var hs=e=>!fl(e)&&!Array.isArray(e)&&Qte(e)&&!kg(e),ere=e=>hs(e)&&e.target?qT(e.target)?e.target.checked:e.target.value:e,V2e=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,tre=(e,t)=>e.has(V2e(t)),U2e=e=>{const t=e.constructor&&e.constructor.prototype;return hs(t)&&t.hasOwnProperty("isPrototypeOf")},a5=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function zs(e){let t;const r=Array.isArray(e),n=typeof FileList<"u"?e instanceof FileList:!1;if(e instanceof Date)t=new Date(e);else if(!(a5&&(e instanceof Blob||n))&&(r||hs(e)))if(t=r?[]:{},!r&&!U2e(e))t=e;else for(const l in e)e.hasOwnProperty(l)&&(t[l]=zs(e[l]));else return e;return t}var VO=e=>/^\w*$/.test(e),us=e=>e===void 0,l5=e=>Array.isArray(e)?e.filter(Boolean):[],c5=e=>l5(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Pr=(e,t,r)=>{if(!t||!hs(e))return r;const n=(VO(t)?[t]:c5(t)).reduce((l,u)=>fl(l)?l:l[u],e);return us(n)||n===e?us(e[t])?r:e[t]:n},nc=e=>typeof e=="boolean",Ui=(e,t,r)=>{let n=-1;const l=VO(t)?[t]:c5(t),u=l.length,f=u-1;for(;++n<u;){const o=l[n];let v=r;if(n!==f){const w=e[o];v=hs(w)||Array.isArray(w)?w:isNaN(+l[n+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;e[o]=v,e=e[o]}};const HC={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Nu={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},bh={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},u5=De.createContext(null);u5.displayName="HookFormContext";const UO=()=>De.useContext(u5),G2e=e=>{const{children:t,...r}=e;return De.createElement(u5.Provider,{value:r},t)};var rre=(e,t,r,n=!0)=>{const l={defaultValues:t._defaultValues};for(const u in e)Object.defineProperty(l,u,{get:()=>{const f=u;return t._proxyFormState[f]!==Nu.all&&(t._proxyFormState[f]=!n||Nu.all),r&&(r[f]=!0),e[f]}});return l};const d5=typeof window<"u"?De.useLayoutEffect:De.useEffect;function q2e(e){const t=UO(),{control:r=t.control,disabled:n,name:l,exact:u}=e||{},[f,o]=De.useState(r._formState),v=De.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return d5(()=>r._subscribe({name:l,formState:v.current,exact:u,callback:w=>{!n&&o({...r._formState,...w})}}),[l,n,u]),De.useEffect(()=>{v.current.isValid&&r._setValid(!0)},[r]),De.useMemo(()=>rre(f,r,v.current,!1),[f,r])}var kd=e=>typeof e=="string",nre=(e,t,r,n,l)=>kd(e)?(n&&t.watch.add(e),Pr(r,e,l)):Array.isArray(e)?e.map(u=>(n&&t.watch.add(u),Pr(r,u))):(n&&(t.watchAll=!0),r),sz=e=>fl(e)||!Qte(e);function kh(e,t,r=new WeakSet){if(sz(e)||sz(t))return e===t;if(kg(e)&&kg(t))return e.getTime()===t.getTime();const n=Object.keys(e),l=Object.keys(t);if(n.length!==l.length)return!1;if(r.has(e)||r.has(t))return!0;r.add(e),r.add(t);for(const u of n){const f=e[u];if(!l.includes(u))return!1;if(u!=="ref"){const o=t[u];if(kg(f)&&kg(o)||hs(f)&&hs(o)||Array.isArray(f)&&Array.isArray(o)?!kh(f,o,r):f!==o)return!1}}return!0}function H2e(e){const t=UO(),{control:r=t.control,name:n,defaultValue:l,disabled:u,exact:f,compute:o}=e||{},v=De.useRef(l),w=De.useRef(o),P=De.useRef(void 0);w.current=o;const C=De.useMemo(()=>r._getWatch(n,v.current),[r,n]),[k,L]=De.useState(w.current?w.current(C):C);return d5(()=>r._subscribe({name:n,formState:{values:!0},exact:f,callback:$=>{if(!u){const j=nre(n,r._names,$.values||r._formValues,!1,v.current);if(w.current){const B=w.current(j);kh(B,P.current)||(L(B),P.current=B)}else L(j)}}}),[r,u,n,f]),De.useEffect(()=>r._removeUnmounted()),k}function W2e(e){const t=UO(),{name:r,disabled:n,control:l=t.control,shouldUnregister:u,defaultValue:f}=e,o=tre(l._names.array,r),v=De.useMemo(()=>Pr(l._formValues,r,Pr(l._defaultValues,r,f)),[l,r,f]),w=H2e({control:l,name:r,defaultValue:v,exact:!0}),P=q2e({control:l,name:r,exact:!0}),C=De.useRef(e),k=De.useRef(l.register(r,{...e.rules,value:w,...nc(e.disabled)?{disabled:e.disabled}:{}}));C.current=e;const L=De.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Pr(P.errors,r)},isDirty:{enumerable:!0,get:()=>!!Pr(P.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!Pr(P.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!Pr(P.validatingFields,r)},error:{enumerable:!0,get:()=>Pr(P.errors,r)}}),[P,r]),$=De.useCallback(q=>k.current.onChange({target:{value:ere(q),name:r},type:HC.CHANGE}),[r]),j=De.useCallback(()=>k.current.onBlur({target:{value:Pr(l._formValues,r),name:r},type:HC.BLUR}),[r,l._formValues]),B=De.useCallback(q=>{const H=Pr(l._fields,r);H&&q&&(H._f.ref={focus:()=>q.focus&&q.focus(),select:()=>q.select&&q.select(),setCustomValidity:te=>q.setCustomValidity(te),reportValidity:()=>q.reportValidity()})},[l._fields,r]),U=De.useMemo(()=>({name:r,value:w,...nc(n)||P.disabled?{disabled:P.disabled||n}:{},onChange:$,onBlur:j,ref:B}),[r,n,P.disabled,$,j,B,w]);return De.useEffect(()=>{const q=l._options.shouldUnregister||u;l.register(r,{...C.current.rules,...nc(C.current.disabled)?{disabled:C.current.disabled}:{}});const H=(te,Q)=>{const ae=Pr(l._fields,te);ae&&ae._f&&(ae._f.mount=Q)};if(H(r,!0),q){const te=zs(Pr(l._options.defaultValues,r));Ui(l._defaultValues,r,te),us(Pr(l._formValues,r))&&Ui(l._formValues,r,te)}return!o&&l.register(r),()=>{(o?q&&!l._state.action:q)?l.unregister(r):H(r,!1)}},[r,l,o,u]),De.useEffect(()=>{l._setDisabledField({disabled:n,name:r})},[n,r,l]),De.useMemo(()=>({field:U,formState:P,fieldState:L}),[U,P,L])}const Z2e=e=>e.render(W2e(e));var ire=(e,t,r,n,l)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[n]:l||!0}}:{},q1=e=>Array.isArray(e)?e:[e],WH=()=>{let e=[];return{get observers(){return e},next:l=>{for(const u of e)u.next&&u.next(l)},subscribe:l=>(e.push(l),{unsubscribe:()=>{e=e.filter(u=>u!==l)}}),unsubscribe:()=>{e=[]}}},Ml=e=>hs(e)&&!Object.keys(e).length,h5=e=>e.type==="file",zu=e=>typeof e=="function",WC=e=>{if(!a5)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},ore=e=>e.type==="select-multiple",f5=e=>e.type==="radio",X2e=e=>f5(e)||qT(e),vL=e=>WC(e)&&e.isConnected;function K2e(e,t){const r=t.slice(0,-1).length;let n=0;for(;n<r;)e=us(e)?n++:e[t[n++]];return e}function Y2e(e){for(const t in e)if(e.hasOwnProperty(t)&&!us(e[t]))return!1;return!0}function vs(e,t){const r=Array.isArray(t)?t:VO(t)?[t]:c5(t),n=r.length===1?e:K2e(e,r),l=r.length-1,u=r[l];return n&&delete n[u],l!==0&&(hs(n)&&Ml(n)||Array.isArray(n)&&Y2e(n))&&vs(e,r.slice(0,-1)),e}var sre=e=>{for(const t in e)if(zu(e[t]))return!0;return!1};function ZC(e,t={}){const r=Array.isArray(e);if(hs(e)||r)for(const n in e)Array.isArray(e[n])||hs(e[n])&&!sre(e[n])?(t[n]=Array.isArray(e[n])?[]:{},ZC(e[n],t[n])):fl(e[n])||(t[n]=!0);return t}function are(e,t,r){const n=Array.isArray(e);if(hs(e)||n)for(const l in e)Array.isArray(e[l])||hs(e[l])&&!sre(e[l])?us(t)||sz(r[l])?r[l]=Array.isArray(e[l])?ZC(e[l],[]):{...ZC(e[l])}:are(e[l],fl(t)?{}:t[l],r[l]):r[l]=!kh(e[l],t[l]);return r}var n1=(e,t)=>are(e,t,ZC(t));const ZH={value:!1,isValid:!1},XH={value:!0,isValid:!0};var lre=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!us(e[0].attributes.value)?us(e[0].value)||e[0].value===""?XH:{value:e[0].value,isValid:!0}:XH:ZH}return ZH},cre=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:n})=>us(e)?e:t?e===""?NaN:e&&+e:r&&kd(e)?new Date(e):n?n(e):e;const KH={isValid:!1,value:null};var ure=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,KH):KH;function YH(e){const t=e.ref;return h5(t)?t.files:f5(t)?ure(e.refs).value:ore(t)?[...t.selectedOptions].map(({value:r})=>r):qT(t)?lre(e.refs).value:cre(us(t.value)?e.ref.value:t.value,e)}var J2e=(e,t,r,n)=>{const l={};for(const u of e){const f=Pr(t,u);f&&Ui(l,u,f._f)}return{criteriaMode:r,names:[...e],fields:l,shouldUseNativeValidation:n}},XC=e=>e instanceof RegExp,i1=e=>us(e)?e:XC(e)?e.source:hs(e)?XC(e.value)?e.value.source:e.value:e,JH=e=>({isOnSubmit:!e||e===Nu.onSubmit,isOnBlur:e===Nu.onBlur,isOnChange:e===Nu.onChange,isOnAll:e===Nu.all,isOnTouch:e===Nu.onTouched});const QH="AsyncFunction";var Q2e=e=>!!e&&!!e.validate&&!!(zu(e.validate)&&e.validate.constructor.name===QH||hs(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===QH)),ePe=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate),eW=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(n=>e.startsWith(n)&&/^\.\w+/.test(e.slice(n.length))));const H1=(e,t,r,n)=>{for(const l of r||Object.keys(e)){const u=Pr(e,l);if(u){const{_f:f,...o}=u;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!n)return!0;if(f.ref&&t(f.ref,f.name)&&!n)return!0;if(H1(o,t))break}else if(hs(o)&&H1(o,t))break}}};function tW(e,t,r){const n=Pr(e,r);if(n||VO(r))return{error:n,name:r};const l=r.split(".");for(;l.length;){const u=l.join("."),f=Pr(t,u),o=Pr(e,u);if(f&&!Array.isArray(f)&&r!==u)return{name:r};if(o&&o.type)return{name:u,error:o};if(o&&o.root&&o.root.type)return{name:`${u}.root`,error:o.root};l.pop()}return{name:r}}var tPe=(e,t,r,n)=>{r(e);const{name:l,...u}=e;return Ml(u)||Object.keys(u).length>=Object.keys(t).length||Object.keys(u).find(f=>t[f]===(!n||Nu.all))},rPe=(e,t,r)=>!e||!t||e===t||q1(e).some(n=>n&&(r?n===t:n.startsWith(t)||t.startsWith(n))),nPe=(e,t,r,n,l)=>l.isOnAll?!1:!r&&l.isOnTouch?!(t||e):(r?n.isOnBlur:l.isOnBlur)?!e:(r?n.isOnChange:l.isOnChange)?e:!0,iPe=(e,t)=>!l5(Pr(e,t)).length&&vs(e,t),oPe=(e,t,r)=>{const n=q1(Pr(e,r));return Ui(n,"root",t[r]),Ui(e,r,n),e},KP=e=>kd(e);function rW(e,t,r="validate"){if(KP(e)||Array.isArray(e)&&e.every(KP)||nc(e)&&!e)return{type:r,message:KP(e)?e:"",ref:t}}var sv=e=>hs(e)&&!XC(e)?e:{value:e,message:""},nW=async(e,t,r,n,l,u)=>{const{ref:f,refs:o,required:v,maxLength:w,minLength:P,min:C,max:k,pattern:L,validate:$,name:j,valueAsNumber:B,mount:U}=e._f,q=Pr(r,j);if(!U||t.has(j))return{};const H=o?o[0]:f,te=Ve=>{l&&H.reportValidity&&(H.setCustomValidity(nc(Ve)?"":Ve||""),H.reportValidity())},Q={},ae=f5(f),ue=qT(f),me=ae||ue,Ce=(B||h5(f))&&us(f.value)&&us(q)||WC(f)&&f.value===""||q===""||Array.isArray(q)&&!q.length,Fe=ire.bind(null,j,n,Q),Ge=(Ve,Ze,nt,dt=bh.maxLength,rt=bh.minLength)=>{const at=Ve?Ze:nt;Q[j]={type:Ve?dt:rt,message:at,ref:f,...Fe(Ve?dt:rt,at)}};if(u?!Array.isArray(q)||!q.length:v&&(!me&&(Ce||fl(q))||nc(q)&&!q||ue&&!lre(o).isValid||ae&&!ure(o).isValid)){const{value:Ve,message:Ze}=KP(v)?{value:!!v,message:v}:sv(v);if(Ve&&(Q[j]={type:bh.required,message:Ze,ref:H,...Fe(bh.required,Ze)},!n))return te(Ze),Q}if(!Ce&&(!fl(C)||!fl(k))){let Ve,Ze;const nt=sv(k),dt=sv(C);if(!fl(q)&&!isNaN(q)){const rt=f.valueAsNumber||q&&+q;fl(nt.value)||(Ve=rt>nt.value),fl(dt.value)||(Ze=rt<dt.value)}else{const rt=f.valueAsDate||new Date(q),at=Et=>new Date(new Date().toDateString()+" "+Et),qe=f.type=="time",He=f.type=="week";kd(nt.value)&&q&&(Ve=qe?at(q)>at(nt.value):He?q>nt.value:rt>new Date(nt.value)),kd(dt.value)&&q&&(Ze=qe?at(q)<at(dt.value):He?q<dt.value:rt<new Date(dt.value))}if((Ve||Ze)&&(Ge(!!Ve,nt.message,dt.message,bh.max,bh.min),!n))return te(Q[j].message),Q}if((w||P)&&!Ce&&(kd(q)||u&&Array.isArray(q))){const Ve=sv(w),Ze=sv(P),nt=!fl(Ve.value)&&q.length>+Ve.value,dt=!fl(Ze.value)&&q.length<+Ze.value;if((nt||dt)&&(Ge(nt,Ve.message,Ze.message),!n))return te(Q[j].message),Q}if(L&&!Ce&&kd(q)){const{value:Ve,message:Ze}=sv(L);if(XC(Ve)&&!q.match(Ve)&&(Q[j]={type:bh.pattern,message:Ze,ref:f,...Fe(bh.pattern,Ze)},!n))return te(Ze),Q}if($){if(zu($)){const Ve=await $(q,r),Ze=rW(Ve,H);if(Ze&&(Q[j]={...Ze,...Fe(bh.validate,Ze.message)},!n))return te(Ze.message),Q}else if(hs($)){let Ve={};for(const Ze in $){if(!Ml(Ve)&&!n)break;const nt=rW(await $[Ze](q,r),H,Ze);nt&&(Ve={...nt,...Fe(Ze,nt.message)},te(nt.message),n&&(Q[j]=Ve))}if(!Ml(Ve)&&(Q[j]={ref:H,...Ve},!n))return Q}}return te(!0),Q};const sPe={mode:Nu.onSubmit,reValidateMode:Nu.onChange,shouldFocusError:!0};function aPe(e={}){let t={...sPe,...e},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:zu(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},n={},l=hs(t.defaultValues)||hs(t.values)?zs(t.defaultValues||t.values)||{}:{},u=t.shouldUnregister?{}:zs(l),f={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,w=0;const P={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let C={...P};const k={array:WH(),state:WH()},L=t.criteriaMode===Nu.all,$=ot=>St=>{clearTimeout(w),w=setTimeout(ot,St)},j=async ot=>{if(!t.disabled&&(P.isValid||C.isValid||ot)){const St=t.resolver?Ml((await ue()).errors):await Ce(n,!0);St!==r.isValid&&k.state.next({isValid:St})}},B=(ot,St)=>{!t.disabled&&(P.isValidating||P.validatingFields||C.isValidating||C.validatingFields)&&((ot||Array.from(o.mount)).forEach(Nt=>{Nt&&(St?Ui(r.validatingFields,Nt,St):vs(r.validatingFields,Nt))}),k.state.next({validatingFields:r.validatingFields,isValidating:!Ml(r.validatingFields)}))},U=(ot,St=[],Nt,dr,nr=!0,er=!0)=>{if(dr&&Nt&&!t.disabled){if(f.action=!0,er&&Array.isArray(Pr(n,ot))){const wr=Nt(Pr(n,ot),dr.argA,dr.argB);nr&&Ui(n,ot,wr)}if(er&&Array.isArray(Pr(r.errors,ot))){const wr=Nt(Pr(r.errors,ot),dr.argA,dr.argB);nr&&Ui(r.errors,ot,wr),iPe(r.errors,ot)}if((P.touchedFields||C.touchedFields)&&er&&Array.isArray(Pr(r.touchedFields,ot))){const wr=Nt(Pr(r.touchedFields,ot),dr.argA,dr.argB);nr&&Ui(r.touchedFields,ot,wr)}(P.dirtyFields||C.dirtyFields)&&(r.dirtyFields=n1(l,u)),k.state.next({name:ot,isDirty:Ge(ot,St),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else Ui(u,ot,St)},q=(ot,St)=>{Ui(r.errors,ot,St),k.state.next({errors:r.errors})},H=ot=>{r.errors=ot,k.state.next({errors:r.errors,isValid:!1})},te=(ot,St,Nt,dr)=>{const nr=Pr(n,ot);if(nr){const er=Pr(u,ot,us(Nt)?Pr(l,ot):Nt);us(er)||dr&&dr.defaultChecked||St?Ui(u,ot,St?er:YH(nr._f)):nt(ot,er),f.mount&&j()}},Q=(ot,St,Nt,dr,nr)=>{let er=!1,wr=!1;const Tn={name:ot};if(!t.disabled){if(!Nt||dr){(P.isDirty||C.isDirty)&&(wr=r.isDirty,r.isDirty=Tn.isDirty=Ge(),er=wr!==Tn.isDirty);const Kn=kh(Pr(l,ot),St);wr=!!Pr(r.dirtyFields,ot),Kn?vs(r.dirtyFields,ot):Ui(r.dirtyFields,ot,!0),Tn.dirtyFields=r.dirtyFields,er=er||(P.dirtyFields||C.dirtyFields)&&wr!==!Kn}if(Nt){const Kn=Pr(r.touchedFields,ot);Kn||(Ui(r.touchedFields,ot,Nt),Tn.touchedFields=r.touchedFields,er=er||(P.touchedFields||C.touchedFields)&&Kn!==Nt)}er&&nr&&k.state.next(Tn)}return er?Tn:{}},ae=(ot,St,Nt,dr)=>{const nr=Pr(r.errors,ot),er=(P.isValid||C.isValid)&&nc(St)&&r.isValid!==St;if(t.delayError&&Nt?(v=$(()=>q(ot,Nt)),v(t.delayError)):(clearTimeout(w),v=null,Nt?Ui(r.errors,ot,Nt):vs(r.errors,ot)),(Nt?!kh(nr,Nt):nr)||!Ml(dr)||er){const wr={...dr,...er&&nc(St)?{isValid:St}:{},errors:r.errors,name:ot};r={...r,...wr},k.state.next(wr)}},ue=async ot=>{B(ot,!0);const St=await t.resolver(u,t.context,J2e(ot||o.mount,n,t.criteriaMode,t.shouldUseNativeValidation));return B(ot),St},me=async ot=>{const{errors:St}=await ue(ot);if(ot)for(const Nt of ot){const dr=Pr(St,Nt);dr?Ui(r.errors,Nt,dr):vs(r.errors,Nt)}else r.errors=St;return St},Ce=async(ot,St,Nt={valid:!0})=>{for(const dr in ot){const nr=ot[dr];if(nr){const{_f:er,...wr}=nr;if(er){const Tn=o.array.has(er.name),Kn=nr._f&&Q2e(nr._f);Kn&&P.validatingFields&&B([dr],!0);const Po=await nW(nr,o.disabled,u,L,t.shouldUseNativeValidation&&!St,Tn);if(Kn&&P.validatingFields&&B([dr]),Po[er.name]&&(Nt.valid=!1,St))break;!St&&(Pr(Po,er.name)?Tn?oPe(r.errors,Po,er.name):Ui(r.errors,er.name,Po[er.name]):vs(r.errors,er.name))}!Ml(wr)&&await Ce(wr,St,Nt)}}return Nt.valid},Fe=()=>{for(const ot of o.unMount){const St=Pr(n,ot);St&&(St._f.refs?St._f.refs.every(Nt=>!vL(Nt)):!vL(St._f.ref))&&rr(ot)}o.unMount=new Set},Ge=(ot,St)=>!t.disabled&&(ot&&St&&Ui(u,ot,St),!kh(Et(),l)),Ve=(ot,St,Nt)=>nre(ot,o,{...f.mount?u:us(St)?l:kd(ot)?{[ot]:St}:St},Nt,St),Ze=ot=>l5(Pr(f.mount?u:l,ot,t.shouldUnregister?Pr(l,ot,[]):[])),nt=(ot,St,Nt={})=>{const dr=Pr(n,ot);let nr=St;if(dr){const er=dr._f;er&&(!er.disabled&&Ui(u,ot,cre(St,er)),nr=WC(er.ref)&&fl(St)?"":St,ore(er.ref)?[...er.ref.options].forEach(wr=>wr.selected=nr.includes(wr.value)):er.refs?qT(er.ref)?er.refs.forEach(wr=>{(!wr.defaultChecked||!wr.disabled)&&(Array.isArray(nr)?wr.checked=!!nr.find(Tn=>Tn===wr.value):wr.checked=nr===wr.value||!!nr)}):er.refs.forEach(wr=>wr.checked=wr.value===nr):h5(er.ref)?er.ref.value="":(er.ref.value=nr,er.ref.type||k.state.next({name:ot,values:zs(u)})))}(Nt.shouldDirty||Nt.shouldTouch)&&Q(ot,nr,Nt.shouldTouch,Nt.shouldDirty,!0),Nt.shouldValidate&&He(ot)},dt=(ot,St,Nt)=>{for(const dr in St){if(!St.hasOwnProperty(dr))return;const nr=St[dr],er=ot+"."+dr,wr=Pr(n,er);(o.array.has(ot)||hs(nr)||wr&&!wr._f)&&!kg(nr)?dt(er,nr,Nt):nt(er,nr,Nt)}},rt=(ot,St,Nt={})=>{const dr=Pr(n,ot),nr=o.array.has(ot),er=zs(St);Ui(u,ot,er),nr?(k.array.next({name:ot,values:zs(u)}),(P.isDirty||P.dirtyFields||C.isDirty||C.dirtyFields)&&Nt.shouldDirty&&k.state.next({name:ot,dirtyFields:n1(l,u),isDirty:Ge(ot,er)})):dr&&!dr._f&&!fl(er)?dt(ot,er,Nt):nt(ot,er,Nt),eW(ot,o)&&k.state.next({...r,name:ot}),k.state.next({name:f.mount?ot:void 0,values:zs(u)})},at=async ot=>{f.mount=!0;const St=ot.target;let Nt=St.name,dr=!0;const nr=Pr(n,Nt),er=Kn=>{dr=Number.isNaN(Kn)||kg(Kn)&&isNaN(Kn.getTime())||kh(Kn,Pr(u,Nt,Kn))},wr=JH(t.mode),Tn=JH(t.reValidateMode);if(nr){let Kn,Po;const Ji=St.type?YH(nr._f):ere(ot),Ps=ot.type===HC.BLUR||ot.type===HC.FOCUS_OUT,ps=!ePe(nr._f)&&!t.resolver&&!Pr(r.errors,Nt)&&!nr._f.deps||nPe(Ps,Pr(r.touchedFields,Nt),r.isSubmitted,Tn,wr),qa=eW(Nt,o,Ps);Ui(u,Nt,Ji),Ps?(nr._f.onBlur&&nr._f.onBlur(ot),v&&v(0)):nr._f.onChange&&nr._f.onChange(ot);const Wo=Q(Nt,Ji,Ps),fo=!Ml(Wo)||qa;if(!Ps&&k.state.next({name:Nt,type:ot.type,values:zs(u)}),ps)return(P.isValid||C.isValid)&&(t.mode==="onBlur"?Ps&&j():Ps||j()),fo&&k.state.next({name:Nt,...qa?{}:Wo});if(!Ps&&qa&&k.state.next({...r}),t.resolver){const{errors:as}=await ue([Nt]);if(er(Ji),dr){const Ha=tW(r.errors,n,Nt),Wa=tW(as,n,Ha.name||Nt);Kn=Wa.error,Nt=Wa.name,Po=Ml(as)}}else B([Nt],!0),Kn=(await nW(nr,o.disabled,u,L,t.shouldUseNativeValidation))[Nt],B([Nt]),er(Ji),dr&&(Kn?Po=!1:(P.isValid||C.isValid)&&(Po=await Ce(n,!0)));dr&&(nr._f.deps&&He(nr._f.deps),ae(Nt,Po,Kn,Wo))}},qe=(ot,St)=>{if(Pr(r.errors,St)&&ot.focus)return ot.focus(),1},He=async(ot,St={})=>{let Nt,dr;const nr=q1(ot);if(t.resolver){const er=await me(us(ot)?ot:nr);Nt=Ml(er),dr=ot?!nr.some(wr=>Pr(er,wr)):Nt}else ot?(dr=(await Promise.all(nr.map(async er=>{const wr=Pr(n,er);return await Ce(wr&&wr._f?{[er]:wr}:wr)}))).every(Boolean),!(!dr&&!r.isValid)&&j()):dr=Nt=await Ce(n);return k.state.next({...!kd(ot)||(P.isValid||C.isValid)&&Nt!==r.isValid?{}:{name:ot},...t.resolver||!ot?{isValid:Nt}:{},errors:r.errors}),St.shouldFocus&&!dr&&H1(n,qe,ot?nr:o.mount),dr},Et=ot=>{const St={...f.mount?u:l};return us(ot)?St:kd(ot)?Pr(St,ot):ot.map(Nt=>Pr(St,Nt))},Gt=(ot,St)=>({invalid:!!Pr((St||r).errors,ot),isDirty:!!Pr((St||r).dirtyFields,ot),error:Pr((St||r).errors,ot),isValidating:!!Pr(r.validatingFields,ot),isTouched:!!Pr((St||r).touchedFields,ot)}),Ot=ot=>{ot&&q1(ot).forEach(St=>vs(r.errors,St)),k.state.next({errors:ot?r.errors:{}})},$t=(ot,St,Nt)=>{const dr=(Pr(n,ot,{_f:{}})._f||{}).ref,nr=Pr(r.errors,ot)||{},{ref:er,message:wr,type:Tn,...Kn}=nr;Ui(r.errors,ot,{...Kn,...St,ref:dr}),k.state.next({name:ot,errors:r.errors,isValid:!1}),Nt&&Nt.shouldFocus&&dr&&dr.focus&&dr.focus()},ur=(ot,St)=>zu(ot)?k.state.subscribe({next:Nt=>"values"in Nt&&ot(Ve(void 0,St),Nt)}):Ve(ot,St,!0),Yr=ot=>k.state.subscribe({next:St=>{rPe(ot.name,St.name,ot.exact)&&tPe(St,ot.formState||P,ei,ot.reRenderRoot)&&ot.callback({values:{...u},...r,...St,defaultValues:l})}}).unsubscribe,hn=ot=>(f.mount=!0,C={...C,...ot.formState},Yr({...ot,formState:C})),rr=(ot,St={})=>{for(const Nt of ot?q1(ot):o.mount)o.mount.delete(Nt),o.array.delete(Nt),St.keepValue||(vs(n,Nt),vs(u,Nt)),!St.keepError&&vs(r.errors,Nt),!St.keepDirty&&vs(r.dirtyFields,Nt),!St.keepTouched&&vs(r.touchedFields,Nt),!St.keepIsValidating&&vs(r.validatingFields,Nt),!t.shouldUnregister&&!St.keepDefaultValue&&vs(l,Nt);k.state.next({values:zs(u)}),k.state.next({...r,...St.keepDirty?{isDirty:Ge()}:{}}),!St.keepIsValid&&j()},Wr=({disabled:ot,name:St})=>{(nc(ot)&&f.mount||ot||o.disabled.has(St))&&(ot?o.disabled.add(St):o.disabled.delete(St))},Rt=(ot,St={})=>{let Nt=Pr(n,ot);const dr=nc(St.disabled)||nc(t.disabled);return Ui(n,ot,{...Nt||{},_f:{...Nt&&Nt._f?Nt._f:{ref:{name:ot}},name:ot,mount:!0,...St}}),o.mount.add(ot),Nt?Wr({disabled:nc(St.disabled)?St.disabled:t.disabled,name:ot}):te(ot,!0,St.value),{...dr?{disabled:St.disabled||t.disabled}:{},...t.progressive?{required:!!St.required,min:i1(St.min),max:i1(St.max),minLength:i1(St.minLength),maxLength:i1(St.maxLength),pattern:i1(St.pattern)}:{},name:ot,onChange:at,onBlur:at,ref:nr=>{if(nr){Rt(ot,St),Nt=Pr(n,ot);const er=us(nr.value)&&nr.querySelectorAll&&nr.querySelectorAll("input,select,textarea")[0]||nr,wr=X2e(er),Tn=Nt._f.refs||[];if(wr?Tn.find(Kn=>Kn===er):er===Nt._f.ref)return;Ui(n,ot,{_f:{...Nt._f,...wr?{refs:[...Tn.filter(vL),er,...Array.isArray(Pr(l,ot))?[{}]:[]],ref:{type:er.type,name:ot}}:{ref:er}}}),te(ot,!1,void 0,er)}else Nt=Pr(n,ot,{}),Nt._f&&(Nt._f.mount=!1),(t.shouldUnregister||St.shouldUnregister)&&!(tre(o.array,ot)&&f.action)&&o.unMount.add(ot)}}},Yt=()=>t.shouldFocusError&&H1(n,qe,o.mount),ir=ot=>{nc(ot)&&(k.state.next({disabled:ot}),H1(n,(St,Nt)=>{const dr=Pr(n,Nt);dr&&(St.disabled=dr._f.disabled||ot,Array.isArray(dr._f.refs)&&dr._f.refs.forEach(nr=>{nr.disabled=dr._f.disabled||ot}))},0,!1))},jt=(ot,St)=>async Nt=>{let dr;Nt&&(Nt.preventDefault&&Nt.preventDefault(),Nt.persist&&Nt.persist());let nr=zs(u);if(k.state.next({isSubmitting:!0}),t.resolver){const{errors:er,values:wr}=await ue();r.errors=er,nr=zs(wr)}else await Ce(n);if(o.disabled.size)for(const er of o.disabled)vs(nr,er);if(vs(r.errors,"root"),Ml(r.errors)){k.state.next({errors:{}});try{await ot(nr,Nt)}catch(er){dr=er}}else St&&await St({...r.errors},Nt),Yt(),setTimeout(Yt);if(k.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Ml(r.errors)&&!dr,submitCount:r.submitCount+1,errors:r.errors}),dr)throw dr},Ir=(ot,St={})=>{Pr(n,ot)&&(us(St.defaultValue)?rt(ot,zs(Pr(l,ot))):(rt(ot,St.defaultValue),Ui(l,ot,zs(St.defaultValue))),St.keepTouched||vs(r.touchedFields,ot),St.keepDirty||(vs(r.dirtyFields,ot),r.isDirty=St.defaultValue?Ge(ot,zs(Pr(l,ot))):Ge()),St.keepError||(vs(r.errors,ot),P.isValid&&j()),k.state.next({...r}))},Xr=(ot,St={})=>{const Nt=ot?zs(ot):l,dr=zs(Nt),nr=Ml(ot),er=nr?l:dr;if(St.keepDefaultValues||(l=Nt),!St.keepValues){if(St.keepDirtyValues){const wr=new Set([...o.mount,...Object.keys(n1(l,u))]);for(const Tn of Array.from(wr))Pr(r.dirtyFields,Tn)?Ui(er,Tn,Pr(u,Tn)):rt(Tn,Pr(er,Tn))}else{if(a5&&us(ot))for(const wr of o.mount){const Tn=Pr(n,wr);if(Tn&&Tn._f){const Kn=Array.isArray(Tn._f.refs)?Tn._f.refs[0]:Tn._f.ref;if(WC(Kn)){const Po=Kn.closest("form");if(Po){Po.reset();break}}}}if(St.keepFieldsRef)for(const wr of o.mount)rt(wr,Pr(er,wr));else n={}}u=t.shouldUnregister?St.keepDefaultValues?zs(l):{}:zs(er),k.array.next({values:{...er}}),k.state.next({values:{...er}})}o={mount:St.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!P.isValid||!!St.keepIsValid||!!St.keepDirtyValues,f.watch=!!t.shouldUnregister,k.state.next({submitCount:St.keepSubmitCount?r.submitCount:0,isDirty:nr?!1:St.keepDirty?r.isDirty:!!(St.keepDefaultValues&&!kh(ot,l)),isSubmitted:St.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:nr?{}:St.keepDirtyValues?St.keepDefaultValues&&u?n1(l,u):r.dirtyFields:St.keepDefaultValues&&ot?n1(l,ot):St.keepDirty?r.dirtyFields:{},touchedFields:St.keepTouched?r.touchedFields:{},errors:St.keepErrors?r.errors:{},isSubmitSuccessful:St.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},Vn=(ot,St)=>Xr(zu(ot)?ot(u):ot,St),Hn=(ot,St={})=>{const Nt=Pr(n,ot),dr=Nt&&Nt._f;if(dr){const nr=dr.refs?dr.refs[0]:dr.ref;nr.focus&&(nr.focus(),St.shouldSelect&&zu(nr.select)&&nr.select())}},ei=ot=>{r={...r,...ot}},ho={control:{register:Rt,unregister:rr,getFieldState:Gt,handleSubmit:jt,setError:$t,_subscribe:Yr,_runSchema:ue,_focusError:Yt,_getWatch:Ve,_getDirty:Ge,_setValid:j,_setFieldArray:U,_setDisabledField:Wr,_setErrors:H,_getFieldArray:Ze,_reset:Xr,_resetDefaultValues:()=>zu(t.defaultValues)&&t.defaultValues().then(ot=>{Vn(ot,t.resetOptions),k.state.next({isLoading:!1})}),_removeUnmounted:Fe,_disableForm:ir,_subjects:k,_proxyFormState:P,get _fields(){return n},get _formValues(){return u},get _state(){return f},set _state(ot){f=ot},get _defaultValues(){return l},get _names(){return o},set _names(ot){o=ot},get _formState(){return r},get _options(){return t},set _options(ot){t={...t,...ot}}},subscribe:hn,trigger:He,register:Rt,handleSubmit:jt,watch:ur,setValue:rt,getValues:Et,reset:Vn,resetField:Ir,clearErrors:Ot,unregister:rr,setError:$t,setFocus:Hn,getFieldState:Gt};return{...ho,formControl:ho}}function FS(e={}){const t=De.useRef(void 0),r=De.useRef(void 0),[n,l]=De.useState({isDirty:!1,isValidating:!1,isLoading:zu(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,isReady:!1,defaultValues:zu(e.defaultValues)?void 0:e.defaultValues});if(!t.current)if(e.formControl)t.current={...e.formControl,formState:n},e.defaultValues&&!zu(e.defaultValues)&&e.formControl.reset(e.defaultValues,e.resetOptions);else{const{formControl:f,...o}=aPe(e);t.current={...o,formState:n}}const u=t.current.control;return u._options=e,d5(()=>{const f=u._subscribe({formState:u._proxyFormState,callback:()=>l({...u._formState}),reRenderRoot:!0});return l(o=>({...o,isReady:!0})),u._formState.isReady=!0,f},[u]),De.useEffect(()=>u._disableForm(e.disabled),[u,e.disabled]),De.useEffect(()=>{e.mode&&(u._options.mode=e.mode),e.reValidateMode&&(u._options.reValidateMode=e.reValidateMode)},[u,e.mode,e.reValidateMode]),De.useEffect(()=>{e.errors&&(u._setErrors(e.errors),u._focusError())},[u,e.errors]),De.useEffect(()=>{e.shouldUnregister&&u._subjects.state.next({values:u._getWatch()})},[u,e.shouldUnregister]),De.useEffect(()=>{if(u._proxyFormState.isDirty){const f=u._getDirty();f!==n.isDirty&&u._subjects.state.next({isDirty:f})}},[u,n.isDirty]),De.useEffect(()=>{e.values&&!kh(e.values,r.current)?(u._reset(e.values,{keepFieldsRef:!0,...u._options.resetOptions}),r.current=e.values,l(f=>({...f}))):u._resetDefaultValues()},[u,e.values]),De.useEffect(()=>{u._state.mount||(u._setValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),t.current.formState=rre(n,u),t.current}const iW=(e,t,r)=>{if(e&&"reportValidity"in e){const n=Pr(r,t);e.setCustomValidity(n&&n.message||""),e.reportValidity()}},dre=(e,t)=>{for(const r in t.fields){const n=t.fields[r];n&&n.ref&&"reportValidity"in n.ref?iW(n.ref,r,e):n.refs&&n.refs.forEach(l=>iW(l,r,e))}},lPe=(e,t)=>{t.shouldUseNativeValidation&&dre(e,t);const r={};for(const n in e){const l=Pr(t.fields,n),u=Object.assign(e[n]||{},{ref:l&&l.ref});if(cPe(t.names||Object.keys(e),n)){const f=Object.assign({},Pr(r,n));Ui(f,"root",u),Ui(r,n,f)}else Ui(r,n,u)}return r},cPe=(e,t)=>e.some(r=>r.startsWith(t+"."));var uPe=function(e,t){for(var r={};e.length;){var n=e[0],l=n.code,u=n.message,f=n.path.join(".");if(!r[f])if("unionErrors"in n){var o=n.unionErrors[0].errors[0];r[f]={message:o.message,type:o.code}}else r[f]={message:u,type:l};if("unionErrors"in n&&n.unionErrors.forEach(function(P){return P.errors.forEach(function(C){return e.push(C)})}),t){var v=r[f].types,w=v&&v[n.code];r[f]=ire(f,t,r,l,w?[].concat(w,n.message):n.message)}e.shift()}return r},BS=function(e,t,r){return r===void 0&&(r={}),function(n,l,u){try{return Promise.resolve(function(f,o){try{var v=Promise.resolve(e[r.mode==="sync"?"parse":"parseAsync"](n,t)).then(function(w){return u.shouldUseNativeValidation&&dre({},u),{errors:{},values:r.raw?n:w}})}catch(w){return o(w)}return v&&v.then?v.then(void 0,o):v}(0,function(f){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(f))return{values:{},errors:lPe(uPe(f.errors,!u.shouldUseNativeValidation&&u.criteriaMode==="all"),u)};throw f}))}catch(f){return Promise.reject(f)}}},Pi;(function(e){e.assertEqual=l=>{};function t(l){}e.assertIs=t;function r(l){throw new Error}e.assertNever=r,e.arrayToEnum=l=>{const u={};for(const f of l)u[f]=f;return u},e.getValidEnumValues=l=>{const u=e.objectKeys(l).filter(o=>typeof l[l[o]]!="number"),f={};for(const o of u)f[o]=l[o];return e.objectValues(f)},e.objectValues=l=>e.objectKeys(l).map(function(u){return l[u]}),e.objectKeys=typeof Object.keys=="function"?l=>Object.keys(l):l=>{const u=[];for(const f in l)Object.prototype.hasOwnProperty.call(l,f)&&u.push(f);return u},e.find=(l,u)=>{for(const f of l)if(u(f))return f},e.isInteger=typeof Number.isInteger=="function"?l=>Number.isInteger(l):l=>typeof l=="number"&&Number.isFinite(l)&&Math.floor(l)===l;function n(l,u=" | "){return l.map(f=>typeof f=="string"?`'${f}'`:f).join(u)}e.joinValues=n,e.jsonStringifyReplacer=(l,u)=>typeof u=="bigint"?u.toString():u})(Pi||(Pi={}));var oW;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(oW||(oW={}));const Hr=Pi.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),lp=e=>{switch(typeof e){case"undefined":return Hr.undefined;case"string":return Hr.string;case"number":return Number.isNaN(e)?Hr.nan:Hr.number;case"boolean":return Hr.boolean;case"function":return Hr.function;case"bigint":return Hr.bigint;case"symbol":return Hr.symbol;case"object":return Array.isArray(e)?Hr.array:e===null?Hr.null:e.then&&typeof e.then=="function"&&e.catch&&typeof e.catch=="function"?Hr.promise:typeof Map<"u"&&e instanceof Map?Hr.map:typeof Set<"u"&&e instanceof Set?Hr.set:typeof Date<"u"&&e instanceof Date?Hr.date:Hr.object;default:return Hr.unknown}},hr=Pi.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Yh extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(u){return u.message},n={_errors:[]},l=u=>{for(const f of u.issues)if(f.code==="invalid_union")f.unionErrors.map(l);else if(f.code==="invalid_return_type")l(f.returnTypeError);else if(f.code==="invalid_arguments")l(f.argumentsError);else if(f.path.length===0)n._errors.push(r(f));else{let o=n,v=0;for(;v<f.path.length;){const w=f.path[v];v===f.path.length-1?(o[w]=o[w]||{_errors:[]},o[w]._errors.push(r(f))):o[w]=o[w]||{_errors:[]},o=o[w],v++}}};return l(this),n}static assert(t){if(!(t instanceof Yh))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Pi.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},n=[];for(const l of this.issues)if(l.path.length>0){const u=l.path[0];r[u]=r[u]||[],r[u].push(t(l))}else n.push(t(l));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}Yh.create=e=>new Yh(e);const az=(e,t)=>{let r;switch(e.code){case hr.invalid_type:e.received===Hr.undefined?r="Required":r=`Expected ${e.expected}, received ${e.received}`;break;case hr.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,Pi.jsonStringifyReplacer)}`;break;case hr.unrecognized_keys:r=`Unrecognized key(s) in object: ${Pi.joinValues(e.keys,", ")}`;break;case hr.invalid_union:r="Invalid input";break;case hr.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${Pi.joinValues(e.options)}`;break;case hr.invalid_enum_value:r=`Invalid enum value. Expected ${Pi.joinValues(e.options)}, received '${e.received}'`;break;case hr.invalid_arguments:r="Invalid function arguments";break;case hr.invalid_return_type:r="Invalid function return type";break;case hr.invalid_date:r="Invalid date";break;case hr.invalid_string:typeof e.validation=="object"?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,typeof e.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:Pi.assertNever(e.validation):e.validation!=="regex"?r=`Invalid ${e.validation}`:r="Invalid";break;case hr.too_small:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="bigint"?r=`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:r="Invalid input";break;case hr.too_big:e.type==="array"?r=`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:e.type==="string"?r=`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:e.type==="number"?r=`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="bigint"?r=`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:e.type==="date"?r=`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:r="Invalid input";break;case hr.custom:r="Invalid input";break;case hr.invalid_intersection_types:r="Intersection results could not be merged";break;case hr.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case hr.not_finite:r="Number must be finite";break;default:r=t.defaultError,Pi.assertNever(e)}return{message:r}};let dPe=az;function hPe(){return dPe}const fPe=e=>{const{data:t,path:r,errorMaps:n,issueData:l}=e,u=[...r,...l.path||[]],f={...l,path:u};if(l.message!==void 0)return{...l,path:u,message:l.message};let o="";const v=n.filter(w=>!!w).slice().reverse();for(const w of v)o=w(f,{data:t,defaultError:o}).message;return{...l,path:u,message:o}};function Dr(e,t){const r=hPe(),n=fPe({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===az?void 0:az].filter(l=>!!l)});e.common.issues.push(n)}class fc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const n=[];for(const l of r){if(l.status==="aborted")return zn;l.status==="dirty"&&t.dirty(),n.push(l.value)}return{status:t.value,value:n}}static async mergeObjectAsync(t,r){const n=[];for(const l of r){const u=await l.key,f=await l.value;n.push({key:u,value:f})}return fc.mergeObjectSync(t,n)}static mergeObjectSync(t,r){const n={};for(const l of r){const{key:u,value:f}=l;if(u.status==="aborted"||f.status==="aborted")return zn;u.status==="dirty"&&t.dirty(),f.status==="dirty"&&t.dirty(),u.value!=="__proto__"&&(typeof f.value<"u"||l.alwaysSet)&&(n[u.value]=f.value)}return{status:t.value,value:n}}}const zn=Object.freeze({status:"aborted"}),T1=e=>({status:"dirty",value:e}),tu=e=>({status:"valid",value:e}),sW=e=>e.status==="aborted",aW=e=>e.status==="dirty",k0=e=>e.status==="valid",KC=e=>typeof Promise<"u"&&e instanceof Promise;var Kr;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(Kr||(Kr={}));class Yp{constructor(t,r,n,l){this._cachedPath=[],this.parent=t,this.data=r,this._path=n,this._key=l}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const lW=(e,t)=>{if(k0(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new Yh(e.common.issues);return this._error=r,this._error}}};function ii(e){if(!e)return{};const{errorMap:t,invalid_type_error:r,required_error:n,description:l}=e;if(t&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:l}:{errorMap:(f,o)=>{const{message:v}=e;return f.code==="invalid_enum_value"?{message:v??o.defaultError}:typeof o.data>"u"?{message:v??n??o.defaultError}:f.code!=="invalid_type"?{message:o.defaultError}:{message:v??r??o.defaultError}},description:l}}class Ei{get description(){return this._def.description}_getType(t){return lp(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:lp(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new fc,ctx:{common:t.parent.common,data:t.data,parsedType:lp(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if(KC(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const n=this.safeParse(t,r);if(n.success)return n.data;throw n.error}safeParse(t,r){const n={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:lp(t)},l=this._parseSync({data:t,path:n.path,parent:n});return lW(n,l)}"~validate"(t){var n,l;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:lp(t)};if(!this["~standard"].async)try{const u=this._parseSync({data:t,path:[],parent:r});return k0(u)?{value:u.value}:{issues:r.common.issues}}catch(u){(l=(n=u==null?void 0:u.message)==null?void 0:n.toLowerCase())!=null&&l.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(u=>k0(u)?{value:u.value}:{issues:r.common.issues})}async parseAsync(t,r){const n=await this.safeParseAsync(t,r);if(n.success)return n.data;throw n.error}async safeParseAsync(t,r){const n={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:lp(t)},l=this._parse({data:t,path:n.path,parent:n}),u=await(KC(l)?l:Promise.resolve(l));return lW(n,u)}refine(t,r){const n=l=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(l):r;return this._refinement((l,u)=>{const f=t(l),o=()=>u.addIssue({code:hr.custom,...n(l)});return typeof Promise<"u"&&f instanceof Promise?f.then(v=>v?!0:(o(),!1)):f?!0:(o(),!1)})}refinement(t,r){return this._refinement((n,l)=>t(n)?!0:(l.addIssue(typeof r=="function"?r(n,l):r),!1))}_refinement(t){return new D0({schema:this,typeName:Fn.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Bp.create(this,this._def)}nullable(){return L0.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Bd.create(this)}promise(){return eI.create(this,this._def)}or(t){return JC.create([this,t],this._def)}and(t){return QC.create(this,t,this._def)}transform(t){return new D0({...ii(this._def),schema:this,typeName:Fn.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new uz({...ii(this._def),innerType:this,defaultValue:r,typeName:Fn.ZodDefault})}brand(){return new jPe({typeName:Fn.ZodBranded,type:this,...ii(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new dz({...ii(this._def),innerType:this,catchValue:r,typeName:Fn.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return p5.create(this,t)}readonly(){return hz.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const pPe=/^c[^\s-]{8,}$/i,mPe=/^[0-9a-z]+$/,gPe=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yPe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,_Pe=/^[a-z0-9_-]{21}$/i,vPe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,xPe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bPe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wPe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let xL;const SPe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,TPe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,EPe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,APe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,PPe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,CPe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,hre="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IPe=new RegExp(`^${hre}$`);function fre(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:e.precision==null&&(t=`${t}(\\.\\d+)?`);const r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function OPe(e){return new RegExp(`^${fre(e)}$`)}function kPe(e){let t=`${hre}T${fre(e)}`;const r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function RPe(e,t){return!!((t==="v4"||!t)&&SPe.test(e)||(t==="v6"||!t)&&EPe.test(e))}function MPe(e,t){if(!vPe.test(e))return!1;try{const[r]=e.split(".");if(!r)return!1;const n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),l=JSON.parse(atob(n));return!(typeof l!="object"||l===null||"typ"in l&&(l==null?void 0:l.typ)!=="JWT"||!l.alg||t&&l.alg!==t)}catch{return!1}}function DPe(e,t){return!!((t==="v4"||!t)&&TPe.test(e)||(t==="v6"||!t)&&APe.test(e))}class Lh extends Ei{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==Hr.string){const u=this._getOrReturnCtx(t);return Dr(u,{code:hr.invalid_type,expected:Hr.string,received:u.parsedType}),zn}const n=new fc;let l;for(const u of this._def.checks)if(u.kind==="min")t.data.length<u.value&&(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),n.dirty());else if(u.kind==="max")t.data.length>u.value&&(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!1,message:u.message}),n.dirty());else if(u.kind==="length"){const f=t.data.length>u.value,o=t.data.length<u.value;(f||o)&&(l=this._getOrReturnCtx(t,l),f?Dr(l,{code:hr.too_big,maximum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}):o&&Dr(l,{code:hr.too_small,minimum:u.value,type:"string",inclusive:!0,exact:!0,message:u.message}),n.dirty())}else if(u.kind==="email")bPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"email",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="emoji")xL||(xL=new RegExp(wPe,"u")),xL.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"emoji",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="uuid")yPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"uuid",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="nanoid")_Pe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"nanoid",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="cuid")pPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"cuid",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="cuid2")mPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"cuid2",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="ulid")gPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"ulid",code:hr.invalid_string,message:u.message}),n.dirty());else if(u.kind==="url")try{new URL(t.data)}catch{l=this._getOrReturnCtx(t,l),Dr(l,{validation:"url",code:hr.invalid_string,message:u.message}),n.dirty()}else u.kind==="regex"?(u.regex.lastIndex=0,u.regex.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"regex",code:hr.invalid_string,message:u.message}),n.dirty())):u.kind==="trim"?t.data=t.data.trim():u.kind==="includes"?t.data.includes(u.value,u.position)||(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.invalid_string,validation:{includes:u.value,position:u.position},message:u.message}),n.dirty()):u.kind==="toLowerCase"?t.data=t.data.toLowerCase():u.kind==="toUpperCase"?t.data=t.data.toUpperCase():u.kind==="startsWith"?t.data.startsWith(u.value)||(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.invalid_string,validation:{startsWith:u.value},message:u.message}),n.dirty()):u.kind==="endsWith"?t.data.endsWith(u.value)||(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.invalid_string,validation:{endsWith:u.value},message:u.message}),n.dirty()):u.kind==="datetime"?kPe(u).test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.invalid_string,validation:"datetime",message:u.message}),n.dirty()):u.kind==="date"?IPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.invalid_string,validation:"date",message:u.message}),n.dirty()):u.kind==="time"?OPe(u).test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.invalid_string,validation:"time",message:u.message}),n.dirty()):u.kind==="duration"?xPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"duration",code:hr.invalid_string,message:u.message}),n.dirty()):u.kind==="ip"?RPe(t.data,u.version)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"ip",code:hr.invalid_string,message:u.message}),n.dirty()):u.kind==="jwt"?MPe(t.data,u.alg)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"jwt",code:hr.invalid_string,message:u.message}),n.dirty()):u.kind==="cidr"?DPe(t.data,u.version)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"cidr",code:hr.invalid_string,message:u.message}),n.dirty()):u.kind==="base64"?PPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"base64",code:hr.invalid_string,message:u.message}),n.dirty()):u.kind==="base64url"?CPe.test(t.data)||(l=this._getOrReturnCtx(t,l),Dr(l,{validation:"base64url",code:hr.invalid_string,message:u.message}),n.dirty()):Pi.assertNever(u);return{status:n.value,value:t.data}}_regex(t,r,n){return this.refinement(l=>t.test(l),{validation:r,code:hr.invalid_string,...Kr.errToObj(n)})}_addCheck(t){return new Lh({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...Kr.errToObj(t)})}url(t){return this._addCheck({kind:"url",...Kr.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...Kr.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...Kr.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...Kr.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...Kr.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...Kr.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...Kr.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...Kr.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...Kr.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...Kr.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...Kr.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...Kr.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...Kr.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...Kr.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...Kr.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...Kr.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...Kr.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...Kr.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...Kr.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...Kr.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...Kr.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...Kr.errToObj(r)})}nonempty(t){return this.min(1,Kr.errToObj(t))}trim(){return new Lh({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Lh({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Lh({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Lh.create=e=>new Lh({checks:[],typeName:Fn.ZodString,coerce:(e==null?void 0:e.coerce)??!1,...ii(e)});function LPe(e,t){const r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,l=r>n?r:n,u=Number.parseInt(e.toFixed(l).replace(".","")),f=Number.parseInt(t.toFixed(l).replace(".",""));return u%f/10**l}class sy extends Ei{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==Hr.number){const u=this._getOrReturnCtx(t);return Dr(u,{code:hr.invalid_type,expected:Hr.number,received:u.parsedType}),zn}let n;const l=new fc;for(const u of this._def.checks)u.kind==="int"?Pi.isInteger(t.data)||(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.invalid_type,expected:"integer",received:"float",message:u.message}),l.dirty()):u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.too_small,minimum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),l.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.too_big,maximum:u.value,type:"number",inclusive:u.inclusive,exact:!1,message:u.message}),l.dirty()):u.kind==="multipleOf"?LPe(t.data,u.value)!==0&&(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.not_multiple_of,multipleOf:u.value,message:u.message}),l.dirty()):u.kind==="finite"?Number.isFinite(t.data)||(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.not_finite,message:u.message}),l.dirty()):Pi.assertNever(u);return{status:l.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,Kr.toString(r))}gt(t,r){return this.setLimit("min",t,!1,Kr.toString(r))}lte(t,r){return this.setLimit("max",t,!0,Kr.toString(r))}lt(t,r){return this.setLimit("max",t,!1,Kr.toString(r))}setLimit(t,r,n,l){return new sy({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:Kr.toString(l)}]})}_addCheck(t){return new sy({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:Kr.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Kr.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Kr.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Kr.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Kr.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:Kr.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:Kr.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Kr.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Kr.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Pi.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(t===null||n.value<t)&&(t=n.value)}return Number.isFinite(r)&&Number.isFinite(t)}}sy.create=e=>new sy({checks:[],typeName:Fn.ZodNumber,coerce:(e==null?void 0:e.coerce)||!1,...ii(e)});class ay extends Ei{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==Hr.bigint)return this._getInvalidInput(t);let n;const l=new fc;for(const u of this._def.checks)u.kind==="min"?(u.inclusive?t.data<u.value:t.data<=u.value)&&(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.too_small,type:"bigint",minimum:u.value,inclusive:u.inclusive,message:u.message}),l.dirty()):u.kind==="max"?(u.inclusive?t.data>u.value:t.data>=u.value)&&(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.too_big,type:"bigint",maximum:u.value,inclusive:u.inclusive,message:u.message}),l.dirty()):u.kind==="multipleOf"?t.data%u.value!==BigInt(0)&&(n=this._getOrReturnCtx(t,n),Dr(n,{code:hr.not_multiple_of,multipleOf:u.value,message:u.message}),l.dirty()):Pi.assertNever(u);return{status:l.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return Dr(r,{code:hr.invalid_type,expected:Hr.bigint,received:r.parsedType}),zn}gte(t,r){return this.setLimit("min",t,!0,Kr.toString(r))}gt(t,r){return this.setLimit("min",t,!1,Kr.toString(r))}lte(t,r){return this.setLimit("max",t,!0,Kr.toString(r))}lt(t,r){return this.setLimit("max",t,!1,Kr.toString(r))}setLimit(t,r,n,l){return new ay({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:n,message:Kr.toString(l)}]})}_addCheck(t){return new ay({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Kr.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Kr.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Kr.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Kr.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:Kr.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}ay.create=e=>new ay({checks:[],typeName:Fn.ZodBigInt,coerce:(e==null?void 0:e.coerce)??!1,...ii(e)});class YC extends Ei{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==Hr.boolean){const n=this._getOrReturnCtx(t);return Dr(n,{code:hr.invalid_type,expected:Hr.boolean,received:n.parsedType}),zn}return tu(t.data)}}YC.create=e=>new YC({typeName:Fn.ZodBoolean,coerce:(e==null?void 0:e.coerce)||!1,...ii(e)});class R0 extends Ei{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==Hr.date){const u=this._getOrReturnCtx(t);return Dr(u,{code:hr.invalid_type,expected:Hr.date,received:u.parsedType}),zn}if(Number.isNaN(t.data.getTime())){const u=this._getOrReturnCtx(t);return Dr(u,{code:hr.invalid_date}),zn}const n=new fc;let l;for(const u of this._def.checks)u.kind==="min"?t.data.getTime()<u.value&&(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.too_small,message:u.message,inclusive:!0,exact:!1,minimum:u.value,type:"date"}),n.dirty()):u.kind==="max"?t.data.getTime()>u.value&&(l=this._getOrReturnCtx(t,l),Dr(l,{code:hr.too_big,message:u.message,inclusive:!0,exact:!1,maximum:u.value,type:"date"}),n.dirty()):Pi.assertNever(u);return{status:n.value,value:new Date(t.data.getTime())}}_addCheck(t){return new R0({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:Kr.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:Kr.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}R0.create=e=>new R0({checks:[],coerce:(e==null?void 0:e.coerce)||!1,typeName:Fn.ZodDate,...ii(e)});class cW extends Ei{_parse(t){if(this._getType(t)!==Hr.symbol){const n=this._getOrReturnCtx(t);return Dr(n,{code:hr.invalid_type,expected:Hr.symbol,received:n.parsedType}),zn}return tu(t.data)}}cW.create=e=>new cW({typeName:Fn.ZodSymbol,...ii(e)});class uW extends Ei{_parse(t){if(this._getType(t)!==Hr.undefined){const n=this._getOrReturnCtx(t);return Dr(n,{code:hr.invalid_type,expected:Hr.undefined,received:n.parsedType}),zn}return tu(t.data)}}uW.create=e=>new uW({typeName:Fn.ZodUndefined,...ii(e)});class dW extends Ei{_parse(t){if(this._getType(t)!==Hr.null){const n=this._getOrReturnCtx(t);return Dr(n,{code:hr.invalid_type,expected:Hr.null,received:n.parsedType}),zn}return tu(t.data)}}dW.create=e=>new dW({typeName:Fn.ZodNull,...ii(e)});class hW extends Ei{constructor(){super(...arguments),this._any=!0}_parse(t){return tu(t.data)}}hW.create=e=>new hW({typeName:Fn.ZodAny,...ii(e)});class fW extends Ei{constructor(){super(...arguments),this._unknown=!0}_parse(t){return tu(t.data)}}fW.create=e=>new fW({typeName:Fn.ZodUnknown,...ii(e)});class Jp extends Ei{_parse(t){const r=this._getOrReturnCtx(t);return Dr(r,{code:hr.invalid_type,expected:Hr.never,received:r.parsedType}),zn}}Jp.create=e=>new Jp({typeName:Fn.ZodNever,...ii(e)});class pW extends Ei{_parse(t){if(this._getType(t)!==Hr.undefined){const n=this._getOrReturnCtx(t);return Dr(n,{code:hr.invalid_type,expected:Hr.void,received:n.parsedType}),zn}return tu(t.data)}}pW.create=e=>new pW({typeName:Fn.ZodVoid,...ii(e)});class Bd extends Ei{_parse(t){const{ctx:r,status:n}=this._processInputParams(t),l=this._def;if(r.parsedType!==Hr.array)return Dr(r,{code:hr.invalid_type,expected:Hr.array,received:r.parsedType}),zn;if(l.exactLength!==null){const f=r.data.length>l.exactLength.value,o=r.data.length<l.exactLength.value;(f||o)&&(Dr(r,{code:f?hr.too_big:hr.too_small,minimum:o?l.exactLength.value:void 0,maximum:f?l.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:l.exactLength.message}),n.dirty())}if(l.minLength!==null&&r.data.length<l.minLength.value&&(Dr(r,{code:hr.too_small,minimum:l.minLength.value,type:"array",inclusive:!0,exact:!1,message:l.minLength.message}),n.dirty()),l.maxLength!==null&&r.data.length>l.maxLength.value&&(Dr(r,{code:hr.too_big,maximum:l.maxLength.value,type:"array",inclusive:!0,exact:!1,message:l.maxLength.message}),n.dirty()),r.common.async)return Promise.all([...r.data].map((f,o)=>l.type._parseAsync(new Yp(r,f,r.path,o)))).then(f=>fc.mergeArray(n,f));const u=[...r.data].map((f,o)=>l.type._parseSync(new Yp(r,f,r.path,o)));return fc.mergeArray(n,u)}get element(){return this._def.type}min(t,r){return new Bd({...this._def,minLength:{value:t,message:Kr.toString(r)}})}max(t,r){return new Bd({...this._def,maxLength:{value:t,message:Kr.toString(r)}})}length(t,r){return new Bd({...this._def,exactLength:{value:t,message:Kr.toString(r)}})}nonempty(t){return this.min(1,t)}}Bd.create=(e,t)=>new Bd({type:e,minLength:null,maxLength:null,exactLength:null,typeName:Fn.ZodArray,...ii(t)});function _v(e){if(e instanceof ns){const t={};for(const r in e.shape){const n=e.shape[r];t[r]=Bp.create(_v(n))}return new ns({...e._def,shape:()=>t})}else return e instanceof Bd?new Bd({...e._def,type:_v(e.element)}):e instanceof Bp?Bp.create(_v(e.unwrap())):e instanceof L0?L0.create(_v(e.unwrap())):e instanceof ly?ly.create(e.items.map(t=>_v(t))):e}class ns extends Ei{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=Pi.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==Hr.object){const w=this._getOrReturnCtx(t);return Dr(w,{code:hr.invalid_type,expected:Hr.object,received:w.parsedType}),zn}const{status:n,ctx:l}=this._processInputParams(t),{shape:u,keys:f}=this._getCached(),o=[];if(!(this._def.catchall instanceof Jp&&this._def.unknownKeys==="strip"))for(const w in l.data)f.includes(w)||o.push(w);const v=[];for(const w of f){const P=u[w],C=l.data[w];v.push({key:{status:"valid",value:w},value:P._parse(new Yp(l,C,l.path,w)),alwaysSet:w in l.data})}if(this._def.catchall instanceof Jp){const w=this._def.unknownKeys;if(w==="passthrough")for(const P of o)v.push({key:{status:"valid",value:P},value:{status:"valid",value:l.data[P]}});else if(w==="strict")o.length>0&&(Dr(l,{code:hr.unrecognized_keys,keys:o}),n.dirty());else if(w!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const w=this._def.catchall;for(const P of o){const C=l.data[P];v.push({key:{status:"valid",value:P},value:w._parse(new Yp(l,C,l.path,P)),alwaysSet:P in l.data})}}return l.common.async?Promise.resolve().then(async()=>{const w=[];for(const P of v){const C=await P.key,k=await P.value;w.push({key:C,value:k,alwaysSet:P.alwaysSet})}return w}).then(w=>fc.mergeObjectSync(n,w)):fc.mergeObjectSync(n,v)}get shape(){return this._def.shape()}strict(t){return Kr.errToObj,new ns({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,n)=>{var u,f;const l=((f=(u=this._def).errorMap)==null?void 0:f.call(u,r,n).message)??n.defaultError;return r.code==="unrecognized_keys"?{message:Kr.errToObj(t).message??l}:{message:l}}}:{}})}strip(){return new ns({...this._def,unknownKeys:"strip"})}passthrough(){return new ns({...this._def,unknownKeys:"passthrough"})}extend(t){return new ns({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new ns({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Fn.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new ns({...this._def,catchall:t})}pick(t){const r={};for(const n of Pi.objectKeys(t))t[n]&&this.shape[n]&&(r[n]=this.shape[n]);return new ns({...this._def,shape:()=>r})}omit(t){const r={};for(const n of Pi.objectKeys(this.shape))t[n]||(r[n]=this.shape[n]);return new ns({...this._def,shape:()=>r})}deepPartial(){return _v(this)}partial(t){const r={};for(const n of Pi.objectKeys(this.shape)){const l=this.shape[n];t&&!t[n]?r[n]=l:r[n]=l.optional()}return new ns({...this._def,shape:()=>r})}required(t){const r={};for(const n of Pi.objectKeys(this.shape))if(t&&!t[n])r[n]=this.shape[n];else{let u=this.shape[n];for(;u instanceof Bp;)u=u._def.innerType;r[n]=u}return new ns({...this._def,shape:()=>r})}keyof(){return pre(Pi.objectKeys(this.shape))}}ns.create=(e,t)=>new ns({shape:()=>e,unknownKeys:"strip",catchall:Jp.create(),typeName:Fn.ZodObject,...ii(t)});ns.strictCreate=(e,t)=>new ns({shape:()=>e,unknownKeys:"strict",catchall:Jp.create(),typeName:Fn.ZodObject,...ii(t)});ns.lazycreate=(e,t)=>new ns({shape:e,unknownKeys:"strip",catchall:Jp.create(),typeName:Fn.ZodObject,...ii(t)});class JC extends Ei{_parse(t){const{ctx:r}=this._processInputParams(t),n=this._def.options;function l(u){for(const o of u)if(o.result.status==="valid")return o.result;for(const o of u)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;const f=u.map(o=>new Yh(o.ctx.common.issues));return Dr(r,{code:hr.invalid_union,unionErrors:f}),zn}if(r.common.async)return Promise.all(n.map(async u=>{const f={...r,common:{...r.common,issues:[]},parent:null};return{result:await u._parseAsync({data:r.data,path:r.path,parent:f}),ctx:f}})).then(l);{let u;const f=[];for(const v of n){const w={...r,common:{...r.common,issues:[]},parent:null},P=v._parseSync({data:r.data,path:r.path,parent:w});if(P.status==="valid")return P;P.status==="dirty"&&!u&&(u={result:P,ctx:w}),w.common.issues.length&&f.push(w.common.issues)}if(u)return r.common.issues.push(...u.ctx.common.issues),u.result;const o=f.map(v=>new Yh(v));return Dr(r,{code:hr.invalid_union,unionErrors:o}),zn}}get options(){return this._def.options}}JC.create=(e,t)=>new JC({options:e,typeName:Fn.ZodUnion,...ii(t)});function lz(e,t){const r=lp(e),n=lp(t);if(e===t)return{valid:!0,data:e};if(r===Hr.object&&n===Hr.object){const l=Pi.objectKeys(t),u=Pi.objectKeys(e).filter(o=>l.indexOf(o)!==-1),f={...e,...t};for(const o of u){const v=lz(e[o],t[o]);if(!v.valid)return{valid:!1};f[o]=v.data}return{valid:!0,data:f}}else if(r===Hr.array&&n===Hr.array){if(e.length!==t.length)return{valid:!1};const l=[];for(let u=0;u<e.length;u++){const f=e[u],o=t[u],v=lz(f,o);if(!v.valid)return{valid:!1};l.push(v.data)}return{valid:!0,data:l}}else return r===Hr.date&&n===Hr.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class QC extends Ei{_parse(t){const{status:r,ctx:n}=this._processInputParams(t),l=(u,f)=>{if(sW(u)||sW(f))return zn;const o=lz(u.value,f.value);return o.valid?((aW(u)||aW(f))&&r.dirty(),{status:r.value,value:o.data}):(Dr(n,{code:hr.invalid_intersection_types}),zn)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([u,f])=>l(u,f)):l(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}QC.create=(e,t,r)=>new QC({left:e,right:t,typeName:Fn.ZodIntersection,...ii(r)});class ly extends Ei{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Hr.array)return Dr(n,{code:hr.invalid_type,expected:Hr.array,received:n.parsedType}),zn;if(n.data.length<this._def.items.length)return Dr(n,{code:hr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),zn;!this._def.rest&&n.data.length>this._def.items.length&&(Dr(n,{code:hr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const u=[...n.data].map((f,o)=>{const v=this._def.items[o]||this._def.rest;return v?v._parse(new Yp(n,f,n.path,o)):null}).filter(f=>!!f);return n.common.async?Promise.all(u).then(f=>fc.mergeArray(r,f)):fc.mergeArray(r,u)}get items(){return this._def.items}rest(t){return new ly({...this._def,rest:t})}}ly.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ly({items:e,typeName:Fn.ZodTuple,rest:null,...ii(t)})};class mW extends Ei{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Hr.map)return Dr(n,{code:hr.invalid_type,expected:Hr.map,received:n.parsedType}),zn;const l=this._def.keyType,u=this._def.valueType,f=[...n.data.entries()].map(([o,v],w)=>({key:l._parse(new Yp(n,o,n.path,[w,"key"])),value:u._parse(new Yp(n,v,n.path,[w,"value"]))}));if(n.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const v of f){const w=await v.key,P=await v.value;if(w.status==="aborted"||P.status==="aborted")return zn;(w.status==="dirty"||P.status==="dirty")&&r.dirty(),o.set(w.value,P.value)}return{status:r.value,value:o}})}else{const o=new Map;for(const v of f){const w=v.key,P=v.value;if(w.status==="aborted"||P.status==="aborted")return zn;(w.status==="dirty"||P.status==="dirty")&&r.dirty(),o.set(w.value,P.value)}return{status:r.value,value:o}}}}mW.create=(e,t,r)=>new mW({valueType:t,keyType:e,typeName:Fn.ZodMap,...ii(r)});class $S extends Ei{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.parsedType!==Hr.set)return Dr(n,{code:hr.invalid_type,expected:Hr.set,received:n.parsedType}),zn;const l=this._def;l.minSize!==null&&n.data.size<l.minSize.value&&(Dr(n,{code:hr.too_small,minimum:l.minSize.value,type:"set",inclusive:!0,exact:!1,message:l.minSize.message}),r.dirty()),l.maxSize!==null&&n.data.size>l.maxSize.value&&(Dr(n,{code:hr.too_big,maximum:l.maxSize.value,type:"set",inclusive:!0,exact:!1,message:l.maxSize.message}),r.dirty());const u=this._def.valueType;function f(v){const w=new Set;for(const P of v){if(P.status==="aborted")return zn;P.status==="dirty"&&r.dirty(),w.add(P.value)}return{status:r.value,value:w}}const o=[...n.data.values()].map((v,w)=>u._parse(new Yp(n,v,n.path,w)));return n.common.async?Promise.all(o).then(v=>f(v)):f(o)}min(t,r){return new $S({...this._def,minSize:{value:t,message:Kr.toString(r)}})}max(t,r){return new $S({...this._def,maxSize:{value:t,message:Kr.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}$S.create=(e,t)=>new $S({valueType:e,minSize:null,maxSize:null,typeName:Fn.ZodSet,...ii(t)});class gW extends Ei{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}gW.create=(e,t)=>new gW({getter:e,typeName:Fn.ZodLazy,...ii(t)});class cz extends Ei{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return Dr(r,{received:r.data,code:hr.invalid_literal,expected:this._def.value}),zn}return{status:"valid",value:t.data}}get value(){return this._def.value}}cz.create=(e,t)=>new cz({value:e,typeName:Fn.ZodLiteral,...ii(t)});function pre(e,t){return new M0({values:e,typeName:Fn.ZodEnum,...ii(t)})}class M0 extends Ei{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),n=this._def.values;return Dr(r,{expected:Pi.joinValues(n),received:r.parsedType,code:hr.invalid_type}),zn}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),n=this._def.values;return Dr(r,{received:r.data,code:hr.invalid_enum_value,options:n}),zn}return tu(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return M0.create(t,{...this._def,...r})}exclude(t,r=this._def){return M0.create(this.options.filter(n=>!t.includes(n)),{...this._def,...r})}}M0.create=pre;class yW extends Ei{_parse(t){const r=Pi.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(t);if(n.parsedType!==Hr.string&&n.parsedType!==Hr.number){const l=Pi.objectValues(r);return Dr(n,{expected:Pi.joinValues(l),received:n.parsedType,code:hr.invalid_type}),zn}if(this._cache||(this._cache=new Set(Pi.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const l=Pi.objectValues(r);return Dr(n,{received:n.data,code:hr.invalid_enum_value,options:l}),zn}return tu(t.data)}get enum(){return this._def.values}}yW.create=(e,t)=>new yW({values:e,typeName:Fn.ZodNativeEnum,...ii(t)});class eI extends Ei{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==Hr.promise&&r.common.async===!1)return Dr(r,{code:hr.invalid_type,expected:Hr.promise,received:r.parsedType}),zn;const n=r.parsedType===Hr.promise?r.data:Promise.resolve(r.data);return tu(n.then(l=>this._def.type.parseAsync(l,{path:r.path,errorMap:r.common.contextualErrorMap})))}}eI.create=(e,t)=>new eI({type:e,typeName:Fn.ZodPromise,...ii(t)});class D0 extends Ei{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Fn.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:n}=this._processInputParams(t),l=this._def.effect||null,u={addIssue:f=>{Dr(n,f),f.fatal?r.abort():r.dirty()},get path(){return n.path}};if(u.addIssue=u.addIssue.bind(u),l.type==="preprocess"){const f=l.transform(n.data,u);if(n.common.async)return Promise.resolve(f).then(async o=>{if(r.value==="aborted")return zn;const v=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return v.status==="aborted"?zn:v.status==="dirty"||r.value==="dirty"?T1(v.value):v});{if(r.value==="aborted")return zn;const o=this._def.schema._parseSync({data:f,path:n.path,parent:n});return o.status==="aborted"?zn:o.status==="dirty"||r.value==="dirty"?T1(o.value):o}}if(l.type==="refinement"){const f=o=>{const v=l.refinement(o,u);if(n.common.async)return Promise.resolve(v);if(v instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?zn:(o.status==="dirty"&&r.dirty(),f(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?zn:(o.status==="dirty"&&r.dirty(),f(o.value).then(()=>({status:r.value,value:o.value}))))}if(l.type==="transform")if(n.common.async===!1){const f=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!k0(f))return zn;const o=l.transform(f.value,u);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(f=>k0(f)?Promise.resolve(l.transform(f.value,u)).then(o=>({status:r.value,value:o})):zn);Pi.assertNever(l)}}D0.create=(e,t,r)=>new D0({schema:e,typeName:Fn.ZodEffects,effect:t,...ii(r)});D0.createWithPreprocess=(e,t,r)=>new D0({schema:t,effect:{type:"preprocess",transform:e},typeName:Fn.ZodEffects,...ii(r)});class Bp extends Ei{_parse(t){return this._getType(t)===Hr.undefined?tu(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Bp.create=(e,t)=>new Bp({innerType:e,typeName:Fn.ZodOptional,...ii(t)});class L0 extends Ei{_parse(t){return this._getType(t)===Hr.null?tu(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}L0.create=(e,t)=>new L0({innerType:e,typeName:Fn.ZodNullable,...ii(t)});class uz extends Ei{_parse(t){const{ctx:r}=this._processInputParams(t);let n=r.data;return r.parsedType===Hr.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}uz.create=(e,t)=>new uz({innerType:e,typeName:Fn.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ii(t)});class dz extends Ei{_parse(t){const{ctx:r}=this._processInputParams(t),n={...r,common:{...r.common,issues:[]}},l=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return KC(l)?l.then(u=>({status:"valid",value:u.status==="valid"?u.value:this._def.catchValue({get error(){return new Yh(n.common.issues)},input:n.data})})):{status:"valid",value:l.status==="valid"?l.value:this._def.catchValue({get error(){return new Yh(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}dz.create=(e,t)=>new dz({innerType:e,typeName:Fn.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ii(t)});class _W extends Ei{_parse(t){if(this._getType(t)!==Hr.nan){const n=this._getOrReturnCtx(t);return Dr(n,{code:hr.invalid_type,expected:Hr.nan,received:n.parsedType}),zn}return{status:"valid",value:t.data}}}_W.create=e=>new _W({typeName:Fn.ZodNaN,...ii(e)});class jPe extends Ei{_parse(t){const{ctx:r}=this._processInputParams(t),n=r.data;return this._def.type._parse({data:n,path:r.path,parent:r})}unwrap(){return this._def.type}}class p5 extends Ei{_parse(t){const{status:r,ctx:n}=this._processInputParams(t);if(n.common.async)return(async()=>{const u=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return u.status==="aborted"?zn:u.status==="dirty"?(r.dirty(),T1(u.value)):this._def.out._parseAsync({data:u.value,path:n.path,parent:n})})();{const l=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?zn:l.status==="dirty"?(r.dirty(),{status:"dirty",value:l.value}):this._def.out._parseSync({data:l.value,path:n.path,parent:n})}}static create(t,r){return new p5({in:t,out:r,typeName:Fn.ZodPipeline})}}class hz extends Ei{_parse(t){const r=this._def.innerType._parse(t),n=l=>(k0(l)&&(l.value=Object.freeze(l.value)),l);return KC(r)?r.then(l=>n(l)):n(r)}unwrap(){return this._def.innerType}}hz.create=(e,t)=>new hz({innerType:e,typeName:Fn.ZodReadonly,...ii(t)});ns.lazycreate;var Fn;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(Fn||(Fn={}));const Ss=Lh.create;sy.create;ay.create;const NPe=YC.create;R0.create;Jp.create;Bd.create;const HT=ns.create;ns.strictCreate;JC.create;QC.create;ly.create;const zPe=cz.create,vW=M0.create;eI.create;Bp.create;L0.create;const dP={string:e=>Lh.create({...e,coerce:!0}),number:e=>sy.create({...e,coerce:!0}),boolean:e=>YC.create({...e,coerce:!0}),bigint:e=>ay.create({...e,coerce:!0}),date:e=>R0.create({...e,coerce:!0})},jn=X.forwardRef(({className:e,type:t,...r},n)=>A.jsx("input",{type:t,className:sr("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:n,...r}));jn.displayName="Input";var FPe="Label",mre=X.forwardRef((e,t)=>A.jsx(nn.label,{...e,ref:t,onMouseDown:r=>{var l;r.target.closest("button, input, select, textarea")||((l=e.onMouseDown)==null||l.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));mre.displayName=FPe;var gre=mre;const BPe=jT("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Oo=X.forwardRef(({className:e,...t},r)=>A.jsx(gre,{ref:r,className:sr(BPe(),e),...t}));Oo.displayName=gre.displayName;const j0=G2e,yre=X.createContext({}),Gi=({...e})=>A.jsx(yre.Provider,{value:{name:e.name},children:A.jsx(Z2e,{...e})}),GO=()=>{const e=X.useContext(yre),t=X.useContext(_re),{getFieldState:r,formState:n}=UO(),l=r(e.name,n);if(!e)throw new Error("useFormField should be used within <FormField>");const{id:u}=t;return{id:u,name:e.name,formItemId:`${u}-form-item`,formDescriptionId:`${u}-form-item-description`,formMessageId:`${u}-form-item-message`,...l}},_re=X.createContext({}),qi=X.forwardRef(({className:e,...t},r)=>{const n=X.useId();return A.jsx(_re.Provider,{value:{id:n},children:A.jsx("div",{ref:r,className:sr("space-y-2",e),...t})})});qi.displayName="FormItem";const Hi=X.forwardRef(({className:e,...t},r)=>{const{error:n,formItemId:l}=GO();return A.jsx(Oo,{ref:r,className:sr(n&&"text-destructive",e),htmlFor:l,...t})});Hi.displayName="FormLabel";const Wi=X.forwardRef(({...e},t)=>{const{error:r,formItemId:n,formDescriptionId:l,formMessageId:u}=GO();return A.jsx(nJ,{ref:t,id:n,"aria-describedby":r?`${l} ${u}`:`${l}`,"aria-invalid":!!r,...e})});Wi.displayName="FormControl";const $Pe=X.forwardRef(({className:e,...t},r)=>{const{formDescriptionId:n}=GO();return A.jsx("p",{ref:r,id:n,className:sr("text-sm text-muted-foreground",e),...t})});$Pe.displayName="FormDescription";const Zi=X.forwardRef(({className:e,children:t,...r},n)=>{const{error:l,formMessageId:u}=GO(),f=l?String(l==null?void 0:l.message):t;return f?A.jsx("p",{ref:n,id:u,className:sr("text-sm font-medium text-destructive",e),...r,children:f}):null});Zi.displayName="FormMessage";var bL="focusScope.autoFocusOnMount",wL="focusScope.autoFocusOnUnmount",xW={bubbles:!1,cancelable:!0},VPe="FocusScope",qO=X.forwardRef((e,t)=>{const{loop:r=!1,trapped:n=!1,onMountAutoFocus:l,onUnmountAutoFocus:u,...f}=e,[o,v]=X.useState(null),w=ss(l),P=ss(u),C=X.useRef(null),k=qn(t,j=>v(j)),L=X.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;X.useEffect(()=>{if(n){let j=function(H){if(L.paused||!o)return;const te=H.target;o.contains(te)?C.current=te:ip(C.current,{select:!0})},B=function(H){if(L.paused||!o)return;const te=H.relatedTarget;te!==null&&(o.contains(te)||ip(C.current,{select:!0}))},U=function(H){if(document.activeElement===document.body)for(const Q of H)Q.removedNodes.length>0&&ip(o)};document.addEventListener("focusin",j),document.addEventListener("focusout",B);const q=new MutationObserver(U);return o&&q.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",j),document.removeEventListener("focusout",B),q.disconnect()}}},[n,o,L.paused]),X.useEffect(()=>{if(o){wW.add(L);const j=document.activeElement;if(!o.contains(j)){const U=new CustomEvent(bL,xW);o.addEventListener(bL,w),o.dispatchEvent(U),U.defaultPrevented||(UPe(ZPe(vre(o)),{select:!0}),document.activeElement===j&&ip(o))}return()=>{o.removeEventListener(bL,w),setTimeout(()=>{const U=new CustomEvent(wL,xW);o.addEventListener(wL,P),o.dispatchEvent(U),U.defaultPrevented||ip(j??document.body,{select:!0}),o.removeEventListener(wL,P),wW.remove(L)},0)}}},[o,w,P,L]);const $=X.useCallback(j=>{if(!r&&!n||L.paused)return;const B=j.key==="Tab"&&!j.altKey&&!j.ctrlKey&&!j.metaKey,U=document.activeElement;if(B&&U){const q=j.currentTarget,[H,te]=GPe(q);H&&te?!j.shiftKey&&U===te?(j.preventDefault(),r&&ip(H,{select:!0})):j.shiftKey&&U===H&&(j.preventDefault(),r&&ip(te,{select:!0})):U===q&&j.preventDefault()}},[r,n,L.paused]);return A.jsx(nn.div,{tabIndex:-1,...f,ref:k,onKeyDown:$})});qO.displayName=VPe;function UPe(e,{select:t=!1}={}){const r=document.activeElement;for(const n of e)if(ip(n,{select:t}),document.activeElement!==r)return}function GPe(e){const t=vre(e),r=bW(t,e),n=bW(t.reverse(),e);return[r,n]}function vre(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const l=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||l?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function bW(e,t){for(const r of e)if(!qPe(r,{upTo:t}))return r}function qPe(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function HPe(e){return e instanceof HTMLInputElement&&"select"in e}function ip(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&HPe(e)&&t&&e.select()}}var wW=WPe();function WPe(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=SW(e,t),e.unshift(t)},remove(t){var r;e=SW(e,t),(r=e[0])==null||r.resume()}}}function SW(e,t){const r=[...e],n=r.indexOf(t);return n!==-1&&r.splice(n,1),r}function ZPe(e){return e.filter(t=>t.tagName!=="A")}var SL=0;function m5(){X.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??TW()),document.body.insertAdjacentElement("beforeend",e[1]??TW()),SL++,()=>{SL===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),SL--}},[])}function TW(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var YP="right-scroll-bar-position",JP="width-before-scroll-bar",XPe="with-scroll-bars-hidden",KPe="--removed-body-scroll-bar-size";function TL(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function YPe(e,t){var r=X.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(n){var l=r.value;l!==n&&(r.value=n,r.callback(n,l))}}}})[0];return r.callback=t,r.facade}var JPe=typeof window<"u"?X.useLayoutEffect:X.useEffect,EW=new WeakMap;function QPe(e,t){var r=YPe(null,function(n){return e.forEach(function(l){return TL(l,n)})});return JPe(function(){var n=EW.get(r);if(n){var l=new Set(n),u=new Set(e),f=r.current;l.forEach(function(o){u.has(o)||TL(o,null)}),u.forEach(function(o){l.has(o)||TL(o,f)})}EW.set(r,e)},[e]),r}function eCe(e){return e}function tCe(e,t){t===void 0&&(t=eCe);var r=[],n=!1,l={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(u){var f=t(u,n);return r.push(f),function(){r=r.filter(function(o){return o!==f})}},assignSyncMedium:function(u){for(n=!0;r.length;){var f=r;r=[],f.forEach(u)}r={push:function(o){return u(o)},filter:function(){return r}}},assignMedium:function(u){n=!0;var f=[];if(r.length){var o=r;r=[],o.forEach(u),f=r}var v=function(){var P=f;f=[],P.forEach(u)},w=function(){return Promise.resolve().then(v)};w(),r={push:function(P){f.push(P),w()},filter:function(P){return f=f.filter(P),r}}}};return l}function rCe(e){e===void 0&&(e={});var t=tCe(null);return t.options=Id({async:!0,ssr:!1},e),t}var xre=function(e){var t=e.sideCar,r=_x(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=t.read();if(!n)throw new Error("Sidecar medium not found");return X.createElement(n,Id({},r))};xre.isSideCarExport=!0;function nCe(e,t){return e.useMedium(t),xre}var bre=rCe(),EL=function(){},HO=X.forwardRef(function(e,t){var r=X.useRef(null),n=X.useState({onScrollCapture:EL,onWheelCapture:EL,onTouchMoveCapture:EL}),l=n[0],u=n[1],f=e.forwardProps,o=e.children,v=e.className,w=e.removeScrollBar,P=e.enabled,C=e.shards,k=e.sideCar,L=e.noRelative,$=e.noIsolation,j=e.inert,B=e.allowPinchZoom,U=e.as,q=U===void 0?"div":U,H=e.gapMode,te=_x(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),Q=k,ae=QPe([r,t]),ue=Id(Id({},te),l);return X.createElement(X.Fragment,null,P&&X.createElement(Q,{sideCar:bre,removeScrollBar:w,shards:C,noRelative:L,noIsolation:$,inert:j,setCallbacks:u,allowPinchZoom:!!B,lockRef:r,gapMode:H}),f?X.cloneElement(X.Children.only(o),Id(Id({},ue),{ref:ae})):X.createElement(q,Id({},ue,{className:v,ref:ae}),o))});HO.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};HO.classNames={fullWidth:JP,zeroRight:YP};var iCe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function oCe(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=iCe();return t&&e.setAttribute("nonce",t),e}function sCe(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function aCe(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var lCe=function(){var e=0,t=null;return{add:function(r){e==0&&(t=oCe())&&(sCe(t,r),aCe(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},cCe=function(){var e=lCe();return function(t,r){X.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},wre=function(){var e=cCe(),t=function(r){var n=r.styles,l=r.dynamic;return e(n,l),null};return t},uCe={left:0,top:0,right:0,gap:0},AL=function(e){return parseInt(e||"",10)||0},dCe=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],n=t[e==="padding"?"paddingTop":"marginTop"],l=t[e==="padding"?"paddingRight":"marginRight"];return[AL(r),AL(n),AL(l)]},hCe=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return uCe;var t=dCe(e),r=document.documentElement.clientWidth,n=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,n-r+t[2]-t[0])}},fCe=wre(),Qv="data-scroll-locked",pCe=function(e,t,r,n){var l=e.left,u=e.top,f=e.right,o=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(XPe,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(o,"px ").concat(n,`;
  }
  body[`).concat(Qv,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(n,";"),r==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(n,`;
    `),r==="padding"&&"padding-right: ".concat(o,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(YP,` {
    right: `).concat(o,"px ").concat(n,`;
  }
  
  .`).concat(JP,` {
    margin-right: `).concat(o,"px ").concat(n,`;
  }
  
  .`).concat(YP," .").concat(YP,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(JP," .").concat(JP,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(Qv,`] {
    `).concat(KPe,": ").concat(o,`px;
  }
`)},AW=function(){var e=parseInt(document.body.getAttribute(Qv)||"0",10);return isFinite(e)?e:0},mCe=function(){X.useEffect(function(){return document.body.setAttribute(Qv,(AW()+1).toString()),function(){var e=AW()-1;e<=0?document.body.removeAttribute(Qv):document.body.setAttribute(Qv,e.toString())}},[])},gCe=function(e){var t=e.noRelative,r=e.noImportant,n=e.gapMode,l=n===void 0?"margin":n;mCe();var u=X.useMemo(function(){return hCe(l)},[l]);return X.createElement(fCe,{styles:pCe(u,!t,l,r?"":"!important")})},fz=!1;if(typeof window<"u")try{var hP=Object.defineProperty({},"passive",{get:function(){return fz=!0,!0}});window.addEventListener("test",hP,hP),window.removeEventListener("test",hP,hP)}catch{fz=!1}var av=fz?{passive:!1}:!1,yCe=function(e){return e.tagName==="TEXTAREA"},Sre=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!yCe(e)&&r[t]==="visible")},_Ce=function(e){return Sre(e,"overflowY")},vCe=function(e){return Sre(e,"overflowX")},PW=function(e,t){var r=t.ownerDocument,n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var l=Tre(e,n);if(l){var u=Ere(e,n),f=u[1],o=u[2];if(f>o)return!0}n=n.parentNode}while(n&&n!==r.body);return!1},xCe=function(e){var t=e.scrollTop,r=e.scrollHeight,n=e.clientHeight;return[t,r,n]},bCe=function(e){var t=e.scrollLeft,r=e.scrollWidth,n=e.clientWidth;return[t,r,n]},Tre=function(e,t){return e==="v"?_Ce(t):vCe(t)},Ere=function(e,t){return e==="v"?xCe(t):bCe(t)},wCe=function(e,t){return e==="h"&&t==="rtl"?-1:1},SCe=function(e,t,r,n,l){var u=wCe(e,window.getComputedStyle(t).direction),f=u*n,o=r.target,v=t.contains(o),w=!1,P=f>0,C=0,k=0;do{if(!o)break;var L=Ere(e,o),$=L[0],j=L[1],B=L[2],U=j-B-u*$;($||U)&&Tre(e,o)&&(C+=U,k+=$);var q=o.parentNode;o=q&&q.nodeType===Node.DOCUMENT_FRAGMENT_NODE?q.host:q}while(!v&&o!==document.body||v&&(t.contains(o)||t===o));return(P&&(Math.abs(C)<1||!l)||!P&&(Math.abs(k)<1||!l))&&(w=!0),w},fP=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},CW=function(e){return[e.deltaX,e.deltaY]},IW=function(e){return e&&"current"in e?e.current:e},TCe=function(e,t){return e[0]===t[0]&&e[1]===t[1]},ECe=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},ACe=0,lv=[];function PCe(e){var t=X.useRef([]),r=X.useRef([0,0]),n=X.useRef(),l=X.useState(ACe++)[0],u=X.useState(wre)[0],f=X.useRef(e);X.useEffect(function(){f.current=e},[e]),X.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(l));var j=ybe([e.lockRef.current],(e.shards||[]).map(IW),!0).filter(Boolean);return j.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),j.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[e.inert,e.lockRef.current,e.shards]);var o=X.useCallback(function(j,B){if("touches"in j&&j.touches.length===2||j.type==="wheel"&&j.ctrlKey)return!f.current.allowPinchZoom;var U=fP(j),q=r.current,H="deltaX"in j?j.deltaX:q[0]-U[0],te="deltaY"in j?j.deltaY:q[1]-U[1],Q,ae=j.target,ue=Math.abs(H)>Math.abs(te)?"h":"v";if("touches"in j&&ue==="h"&&ae.type==="range")return!1;var me=PW(ue,ae);if(!me)return!0;if(me?Q=ue:(Q=ue==="v"?"h":"v",me=PW(ue,ae)),!me)return!1;if(!n.current&&"changedTouches"in j&&(H||te)&&(n.current=Q),!Q)return!0;var Ce=n.current||Q;return SCe(Ce,B,j,Ce==="h"?H:te,!0)},[]),v=X.useCallback(function(j){var B=j;if(!(!lv.length||lv[lv.length-1]!==u)){var U="deltaY"in B?CW(B):fP(B),q=t.current.filter(function(Q){return Q.name===B.type&&(Q.target===B.target||B.target===Q.shadowParent)&&TCe(Q.delta,U)})[0];if(q&&q.should){B.cancelable&&B.preventDefault();return}if(!q){var H=(f.current.shards||[]).map(IW).filter(Boolean).filter(function(Q){return Q.contains(B.target)}),te=H.length>0?o(B,H[0]):!f.current.noIsolation;te&&B.cancelable&&B.preventDefault()}}},[]),w=X.useCallback(function(j,B,U,q){var H={name:j,delta:B,target:U,should:q,shadowParent:CCe(U)};t.current.push(H),setTimeout(function(){t.current=t.current.filter(function(te){return te!==H})},1)},[]),P=X.useCallback(function(j){r.current=fP(j),n.current=void 0},[]),C=X.useCallback(function(j){w(j.type,CW(j),j.target,o(j,e.lockRef.current))},[]),k=X.useCallback(function(j){w(j.type,fP(j),j.target,o(j,e.lockRef.current))},[]);X.useEffect(function(){return lv.push(u),e.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:k}),document.addEventListener("wheel",v,av),document.addEventListener("touchmove",v,av),document.addEventListener("touchstart",P,av),function(){lv=lv.filter(function(j){return j!==u}),document.removeEventListener("wheel",v,av),document.removeEventListener("touchmove",v,av),document.removeEventListener("touchstart",P,av)}},[]);var L=e.removeScrollBar,$=e.inert;return X.createElement(X.Fragment,null,$?X.createElement(u,{styles:ECe(l)}):null,L?X.createElement(gCe,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function CCe(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const ICe=nCe(bre,PCe);var WO=X.forwardRef(function(e,t){return X.createElement(HO,Id({},e,{ref:t,sideCar:ICe}))});WO.classNames=HO.classNames;var OCe=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},cv=new WeakMap,pP=new WeakMap,mP={},PL=0,Are=function(e){return e&&(e.host||Are(e.parentNode))},kCe=function(e,t){return t.map(function(r){if(e.contains(r))return r;var n=Are(r);return n&&e.contains(n)?n:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},RCe=function(e,t,r,n){var l=kCe(t,Array.isArray(e)?e:[e]);mP[r]||(mP[r]=new WeakMap);var u=mP[r],f=[],o=new Set,v=new Set(l),w=function(C){!C||o.has(C)||(o.add(C),w(C.parentNode))};l.forEach(w);var P=function(C){!C||v.has(C)||Array.prototype.forEach.call(C.children,function(k){if(o.has(k))P(k);else try{var L=k.getAttribute(n),$=L!==null&&L!=="false",j=(cv.get(k)||0)+1,B=(u.get(k)||0)+1;cv.set(k,j),u.set(k,B),f.push(k),j===1&&$&&pP.set(k,!0),B===1&&k.setAttribute(r,"true"),$||k.setAttribute(n,"true")}catch(U){console.error("aria-hidden: cannot operate on ",k,U)}})};return P(t),o.clear(),PL++,function(){f.forEach(function(C){var k=cv.get(C)-1,L=u.get(C)-1;cv.set(C,k),u.set(C,L),k||(pP.has(C)||C.removeAttribute(n),pP.delete(C)),L||C.removeAttribute(r)}),PL--,PL||(cv=new WeakMap,cv=new WeakMap,pP=new WeakMap,mP={})}},g5=function(e,t,r){r===void 0&&(r="data-aria-hidden");var n=Array.from(Array.isArray(e)?e:[e]),l=OCe(e);return l?(n.push.apply(n,Array.from(l.querySelectorAll("[aria-live]"))),RCe(n,l,r,"aria-hidden")):function(){return null}},ZO="Dialog",[Pre,Cre]=$l(ZO),[MCe,Zu]=Pre(ZO),Ire=e=>{const{__scopeDialog:t,children:r,open:n,defaultOpen:l,onOpenChange:u,modal:f=!0}=e,o=X.useRef(null),v=X.useRef(null),[w,P]=qp({prop:n,defaultProp:l??!1,onChange:u,caller:ZO});return A.jsx(MCe,{scope:t,triggerRef:o,contentRef:v,contentId:jd(),titleId:jd(),descriptionId:jd(),open:w,onOpenChange:P,onOpenToggle:X.useCallback(()=>P(C=>!C),[P]),modal:f,children:r})};Ire.displayName=ZO;var Ore="DialogTrigger",kre=X.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Zu(Ore,r),u=qn(t,l.triggerRef);return A.jsx(nn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":v5(l.open),...n,ref:u,onClick:_r(e.onClick,l.onOpenToggle)})});kre.displayName=Ore;var y5="DialogPortal",[DCe,Rre]=Pre(y5,{forceMount:void 0}),Mre=e=>{const{__scopeDialog:t,forceMount:r,children:n,container:l}=e,u=Zu(y5,t);return A.jsx(DCe,{scope:t,forceMount:r,children:X.Children.map(n,f=>A.jsx(wl,{present:r||u.open,children:A.jsx(DT,{asChild:!0,container:l,children:f})}))})};Mre.displayName=y5;var tI="DialogOverlay",Dre=X.forwardRef((e,t)=>{const r=Rre(tI,e.__scopeDialog),{forceMount:n=r.forceMount,...l}=e,u=Zu(tI,e.__scopeDialog);return u.modal?A.jsx(wl,{present:n||u.open,children:A.jsx(jCe,{...l,ref:t})}):null});Dre.displayName=tI;var LCe=ry("DialogOverlay.RemoveScroll"),jCe=X.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Zu(tI,r);return A.jsx(WO,{as:LCe,allowPinchZoom:!0,shards:[l.contentRef],children:A.jsx(nn.div,{"data-state":v5(l.open),...n,ref:t,style:{pointerEvents:"auto",...n.style}})})}),cy="DialogContent",Lre=X.forwardRef((e,t)=>{const r=Rre(cy,e.__scopeDialog),{forceMount:n=r.forceMount,...l}=e,u=Zu(cy,e.__scopeDialog);return A.jsx(wl,{present:n||u.open,children:u.modal?A.jsx(NCe,{...l,ref:t}):A.jsx(zCe,{...l,ref:t})})});Lre.displayName=cy;var NCe=X.forwardRef((e,t)=>{const r=Zu(cy,e.__scopeDialog),n=X.useRef(null),l=qn(t,r.contentRef,n);return X.useEffect(()=>{const u=n.current;if(u)return g5(u)},[]),A.jsx(jre,{...e,ref:l,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_r(e.onCloseAutoFocus,u=>{var f;u.preventDefault(),(f=r.triggerRef.current)==null||f.focus()}),onPointerDownOutside:_r(e.onPointerDownOutside,u=>{const f=u.detail.originalEvent,o=f.button===0&&f.ctrlKey===!0;(f.button===2||o)&&u.preventDefault()}),onFocusOutside:_r(e.onFocusOutside,u=>u.preventDefault())})}),zCe=X.forwardRef((e,t)=>{const r=Zu(cy,e.__scopeDialog),n=X.useRef(!1),l=X.useRef(!1);return A.jsx(jre,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:u=>{var f,o;(f=e.onCloseAutoFocus)==null||f.call(e,u),u.defaultPrevented||(n.current||(o=r.triggerRef.current)==null||o.focus(),u.preventDefault()),n.current=!1,l.current=!1},onInteractOutside:u=>{var v,w;(v=e.onInteractOutside)==null||v.call(e,u),u.defaultPrevented||(n.current=!0,u.detail.originalEvent.type==="pointerdown"&&(l.current=!0));const f=u.target;((w=r.triggerRef.current)==null?void 0:w.contains(f))&&u.preventDefault(),u.detail.originalEvent.type==="focusin"&&l.current&&u.preventDefault()}})}),jre=X.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:n,onOpenAutoFocus:l,onCloseAutoFocus:u,...f}=e,o=Zu(cy,r),v=X.useRef(null),w=qn(t,v);return m5(),A.jsxs(A.Fragment,{children:[A.jsx(qO,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:l,onUnmountAutoFocus:u,children:A.jsx(hx,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":v5(o.open),...f,ref:w,onDismiss:()=>o.onOpenChange(!1)})}),A.jsxs(A.Fragment,{children:[A.jsx(BCe,{titleId:o.titleId}),A.jsx(VCe,{contentRef:v,descriptionId:o.descriptionId})]})]})}),_5="DialogTitle",Nre=X.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Zu(_5,r);return A.jsx(nn.h2,{id:l.titleId,...n,ref:t})});Nre.displayName=_5;var zre="DialogDescription",Fre=X.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Zu(zre,r);return A.jsx(nn.p,{id:l.descriptionId,...n,ref:t})});Fre.displayName=zre;var Bre="DialogClose",$re=X.forwardRef((e,t)=>{const{__scopeDialog:r,...n}=e,l=Zu(Bre,r);return A.jsx(nn.button,{type:"button",...n,ref:t,onClick:_r(e.onClick,()=>l.onOpenChange(!1))})});$re.displayName=Bre;function v5(e){return e?"open":"closed"}var Vre="DialogTitleWarning",[FCe,Ure]=wge(Vre,{contentName:cy,titleName:_5,docsSlug:"dialog"}),BCe=({titleId:e})=>{const t=Ure(Vre),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return X.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},$Ce="DialogDescriptionWarning",VCe=({contentRef:e,descriptionId:t})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Ure($Ce).contentName}}.`;return X.useEffect(()=>{var u;const l=(u=e.current)==null?void 0:u.getAttribute("aria-describedby");t&&l&&(document.getElementById(t)||console.warn(n))},[n,e,t]),null},x5=Ire,Gre=kre,b5=Mre,WT=Dre,ZT=Lre,XT=Nre,KT=Fre,XO=$re;const qre=x5,UCe=b5,Hre=X.forwardRef(({className:e,...t},r)=>A.jsx(WT,{ref:r,className:sr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));Hre.displayName=WT.displayName;const w5=X.forwardRef(({className:e,children:t,...r},n)=>A.jsxs(UCe,{children:[A.jsx(Hre,{}),A.jsxs(ZT,{ref:n,className:sr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...r,children:[t,A.jsxs(XO,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[A.jsx(Hp,{className:"h-4 w-4"}),A.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));w5.displayName=ZT.displayName;const rI=({className:e,...t})=>A.jsx("div",{className:sr("flex flex-col space-y-1.5 text-center sm:text-left",e),...t});rI.displayName="DialogHeader";const W1=X.forwardRef(({className:e,...t},r)=>A.jsx(XT,{ref:r,className:sr("text-lg font-semibold leading-none tracking-tight",e),...t}));W1.displayName=XT.displayName;const Z1=X.forwardRef(({className:e,...t},r)=>A.jsx(KT,{ref:r,className:sr("text-sm text-muted-foreground",e),...t}));Z1.displayName=KT.displayName;function GCe(){let e=sessionStorage.getItem("tracking_session_id");return e||(e=`sess_${Date.now()}_${Math.random().toString(36).substring(2,15)}`,sessionStorage.setItem("tracking_session_id",e)),e}function qCe(){const e=new URLSearchParams(window.location.search),t={};return["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach(r=>{const n=e.get(r);n&&(t[r]=n)}),t}function HCe(){const e=navigator.userAgent;return{type:/iPhone|iPad|iPod|Android/i.test(e)?"mobile":"desktop",userAgent:e.substring(0,500),language:navigator.language,screenWidth:window.screen.width.toString(),screenHeight:window.screen.height.toString()}}function KO(){const e=X.useRef(!1),t=X.useCallback(async f=>{try{await ni.from("events").insert({listing_id:f.listingId||null,session_id:GCe(),event_type:f.eventType,referrer:document.referrer||null,utm_json:qCe(),device_json:HCe(),page_path:f.pagePath||window.location.pathname})}catch(o){console.error("Failed to track event:",o)}},[]),r=X.useCallback(f=>{e.current||(e.current=!0,t({listingId:f,eventType:"page_view"}))},[t]),n=X.useCallback(f=>{t({listingId:f,eventType:"contact_click"})},[t]),l=X.useCallback(f=>{t({listingId:f,eventType:"schedule_showing"})},[t]),u=X.useCallback((f,o)=>{t({listingId:f,eventType:"outbound_click",pagePath:o})},[t]);return{trackPageView:r,trackContactClick:n,trackScheduleShowing:l,trackOutboundClick:u}}function WCe(e){const{trackPageView:t}=KO();X.useEffect(()=>{t(e)},[e,t])}const ZCe=HT({address:Ss().min(5,"Please enter a valid address")}),XCe=HT({name:Ss().min(2,"Name must be at least 2 characters"),email:Ss().email("Please enter a valid email"),phone:Ss().optional()});function KCe({open:e,onOpenChange:t}){const[r,n]=X.useState(1),[l,u]=X.useState(""),[f,o]=X.useState(!1),[v,w]=X.useState(null),[P,C]=X.useState([]),[k,L]=X.useState(!1),{trackContactClick:$}=KO(),j=FS({resolver:BS(ZCe),defaultValues:{address:""}}),B=FS({resolver:BS(XCe),defaultValues:{name:"",email:"",phone:""}});X.useEffect(()=>{e&&(async()=>{try{const{data:me,error:Ce}=await ni.functions.invoke("get-mapbox-token");if(Ce)throw Ce;w(me.token)}catch(me){console.error("Failed to fetch Mapbox token:",me)}})()},[e]);const U=async ue=>{if(!v||ue.length<3){C([]);return}try{const Ce=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(ue)}.json?access_token=${v}&country=US&types=address&limit=5`)).json();C(Ce.features||[]),L(!0)}catch(me){console.error("Address search error:",me)}},q=ue=>{const me=ue.place_name;j.setValue("address",me),u(me),C([]),L(!1)},H=ue=>{u(ue.address),n(2)},te=async ue=>{o(!0);try{const{error:me}=await ni.from("contact_requests").insert({name:ue.name,email:ue.email,phone:ue.phone||null,message:`Home Valuation Request for: ${l}`});if(me)throw me;$(),n(3)}catch(me){Ni.error(`Failed to submit request: ${me.message}`)}finally{o(!1)}},Q=()=>{n(1),u(""),j.reset(),B.reset(),t(!1)},ae=()=>{n(1)};return A.jsx(qre,{open:e,onOpenChange:Q,children:A.jsxs(w5,{className:"sm:max-w-[500px] p-0 overflow-hidden",children:[A.jsxs("div",{className:"flex items-center justify-center gap-2 pt-6 px-6",children:[A.jsx("div",{className:`h-2 w-16 rounded-full transition-colors ${r>=1?"bg-primary":"bg-muted"}`}),A.jsx("div",{className:`h-2 w-16 rounded-full transition-colors ${r>=2?"bg-primary":"bg-muted"}`}),A.jsx("div",{className:`h-2 w-16 rounded-full transition-colors ${r>=3?"bg-primary":"bg-muted"}`})]}),A.jsxs(O0,{mode:"wait",children:[r===1&&A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"p-6",children:[A.jsxs(rI,{className:"mb-6",children:[A.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:A.jsx(Oh,{className:"h-6 w-6 text-primary"})}),A.jsx(W1,{className:"font-display text-2xl",children:"What's Your Home Worth?"}),A.jsx(Z1,{children:"Enter your property address to receive a free home valuation."})]}),A.jsx(j0,{...j,children:A.jsxs("form",{onSubmit:j.handleSubmit(H),className:"space-y-4",children:[A.jsx(Gi,{control:j.control,name:"address",render:({field:ue})=>A.jsxs(qi,{className:"relative",children:[A.jsx(Hi,{children:"Property Address"}),A.jsx(Wi,{children:A.jsxs("div",{className:"relative",children:[A.jsx(Oh,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),A.jsx(jn,{...ue,placeholder:"123 Main St, City, State",className:"h-12 rounded-xl pl-10",onChange:me=>{ue.onChange(me),U(me.target.value)},onFocus:()=>L(P.length>0),autoComplete:"off"})]})}),A.jsx(Zi,{}),k&&P.length>0&&A.jsx("div",{className:"absolute z-50 w-full mt-1 bg-background border border-border rounded-lg shadow-lg overflow-hidden",children:P.map(me=>A.jsxs("button",{type:"button",className:"w-full px-4 py-3 text-left hover:bg-muted transition-colors flex items-start gap-3 border-b border-border last:border-0",onClick:()=>q(me),children:[A.jsx(Oh,{className:"h-4 w-4 text-muted-foreground mt-0.5 flex-shrink-0"}),A.jsx("span",{className:"text-sm",children:me.place_name})]},me.id))})]})}),A.jsxs(fn,{type:"submit",className:"w-full h-12 btn-primary rounded-xl",children:["Continue",A.jsx(Wv,{className:"ml-2 h-5 w-5"})]})]})})]},"step1"),r===2&&A.jsxs(Ar.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"p-6",children:[A.jsxs(rI,{className:"mb-6",children:[A.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:A.jsx(Ud,{className:"h-6 w-6 text-primary"})}),A.jsx(W1,{className:"font-display text-2xl",children:"Almost There!"}),A.jsx(Z1,{children:"Enter your contact information to receive your free home valuation."})]}),A.jsxs("div",{className:"bg-muted rounded-xl p-4 mb-6",children:[A.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wide mb-1",children:"Property Address"}),A.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[A.jsx(Oh,{className:"h-4 w-4 text-primary"}),l]})]}),A.jsx(j0,{...B,children:A.jsxs("form",{onSubmit:B.handleSubmit(te),className:"space-y-4",children:[A.jsx(Gi,{control:B.control,name:"name",render:({field:ue})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Full Name"}),A.jsx(Wi,{children:A.jsx(jn,{...ue,placeholder:"John Doe",className:"h-12 rounded-xl"})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"email",render:({field:ue})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Email"}),A.jsx(Wi,{children:A.jsx(jn,{...ue,type:"email",placeholder:"john@example.com",className:"h-12 rounded-xl"})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"phone",render:({field:ue})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Phone (Optional)"}),A.jsx(Wi,{children:A.jsx(jn,{...ue,type:"tel",placeholder:"(555) 123-4567",className:"h-12 rounded-xl"})}),A.jsx(Zi,{})]})}),A.jsxs("div",{className:"flex gap-3 pt-2",children:[A.jsxs(fn,{type:"button",variant:"outline",onClick:ae,className:"h-12 rounded-xl",children:[A.jsx(kJ,{className:"mr-2 h-4 w-4"}),"Back"]}),A.jsx(fn,{type:"submit",disabled:f,className:"flex-1 h-12 btn-primary rounded-xl",children:f?A.jsxs(A.Fragment,{children:[A.jsx(Ld,{className:"mr-2 h-5 w-5 animate-spin"}),"Submitting..."]}):A.jsxs(A.Fragment,{children:["Get My Free Valuation",A.jsx(Wv,{className:"ml-2 h-5 w-5"})]})})]})]})})]},"step2"),r===3&&A.jsxs(Ar.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0},transition:{duration:.3},className:"p-6 py-12 text-center",children:[A.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:A.jsx(K3,{className:"h-8 w-8 text-green-600"})}),A.jsx(W1,{className:"font-display text-2xl mb-3",children:"Request Received!"}),A.jsx(Z1,{className:"text-base mb-6",children:"Thank you! We've received your home valuation request for:"}),A.jsx("div",{className:"bg-muted rounded-xl p-4 mb-8 inline-block",children:A.jsxs("p",{className:"text-sm font-medium flex items-center gap-2",children:[A.jsx(Oh,{className:"h-4 w-4 text-primary"}),l]})}),A.jsx("p",{className:"text-muted-foreground text-sm mb-8",children:"We'll analyze your property and get back to you within 24-48 hours with a personalized home valuation report."}),A.jsx(fn,{onClick:Q,className:"btn-primary rounded-xl px-8 h-12",children:"Done"})]},"step3")]})]})})}function YCe(){const[e,t]=X.useState(!1),{data:r,isLoading:n}=Kte({sortBy:"newest"}),l=(r==null?void 0:r.slice(0,6))||[],u=()=>{var f;(f=document.getElementById("featured-listings"))==null||f.scrollIntoView({behavior:"smooth"})};return A.jsxs(B1,{children:[A.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[A.jsxs("div",{className:"absolute inset-0",children:[A.jsx("video",{autoPlay:!0,muted:!0,loop:!0,playsInline:!0,className:"w-full h-full object-cover",poster:"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=1920&q=80",children:A.jsx("source",{src:"https://player.vimeo.com/external/370331493.sd.mp4?s=e90dcaba73c19e0e36f03406b47bbd6992dd6c1c&profile_id=139&oauth2_token_id=57447761",type:"video/mp4"})}),A.jsx("div",{className:"absolute inset-0 hero-overlay"})]}),A.jsxs("div",{className:"relative z-10 text-center px-4 max-w-4xl mx-auto",children:[A.jsxs(Ar.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:1,ease:[.25,.46,.45,.94]},children:[A.jsx("h1",{className:"font-display text-5xl sm:text-6xl lg:text-7xl xl:text-8xl text-white mb-6 tracking-tight",children:"Let's Find Home"}),A.jsx("p",{className:"text-lg sm:text-xl text-white/80 mb-12 font-light max-w-2xl mx-auto",children:"Buy and sell real estate, search neighborhoods, and get home estimates."}),A.jsxs("div",{className:"flex flex-wrap justify-center gap-4 mb-16",children:[A.jsx(fn,{asChild:!0,size:"lg",className:"btn-outline rounded-none px-10 py-6 text-base",children:A.jsxs(xi,{to:"/listings",children:[A.jsx(bS,{className:"mr-2 h-5 w-5"}),"Buy"]})}),A.jsx(fn,{asChild:!0,size:"lg",className:"btn-outline rounded-none px-10 py-6 text-base",children:A.jsxs(xi,{to:"/contact",children:[A.jsx(EG,{className:"mr-2 h-5 w-5"}),"Sell"]})}),A.jsxs(fn,{size:"lg",className:"btn-outline rounded-none px-10 py-6 text-base",onClick:()=>t(!0),children:[A.jsx(Ud,{className:"mr-2 h-5 w-5"}),"Home Value"]})]})]}),A.jsx(Ar.button,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1,duration:.5},onClick:u,className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 text-white/60 hover:text-white transition-colors",children:A.jsx(X3,{className:"h-8 w-8 animate-bounce"})})]})]}),A.jsx("section",{id:"featured-listings",className:"py-24 bg-background",children:A.jsxs("div",{className:"container",children:[A.jsxs(Ar.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},className:"text-center mb-16",children:[A.jsx("h2",{className:"font-display text-4xl md:text-5xl font-semibold mb-4",children:"Featured Properties"}),A.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Discover our handpicked selection of exceptional homes"})]}),n?A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[1,2,3,4,5,6].map(f=>A.jsxs("div",{className:"animate-pulse",children:[A.jsx("div",{className:"bg-muted aspect-[4/3]"}),A.jsx("div",{className:"mt-4 h-6 bg-muted w-3/4"}),A.jsx("div",{className:"mt-2 h-4 bg-muted w-1/2"})]},f))}):l.length>0?A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:l.map((f,o)=>A.jsx(N2e,{listing:f,index:o},f.id))}):A.jsxs("div",{className:"text-center py-20 bg-secondary",children:[A.jsx(EC,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),A.jsx("h3",{className:"font-display text-xl font-semibold mb-2",children:"No listings yet"}),A.jsx("p",{className:"text-muted-foreground",children:"Check back soon for new properties."})]}),A.jsx(Ar.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.6,delay:.2},viewport:{once:!0},className:"text-center mt-12",children:A.jsx(fn,{asChild:!0,size:"lg",className:"btn-primary rounded-none",children:A.jsxs(xi,{to:"/listings",children:["Explore All Properties",A.jsx(Wv,{className:"ml-2 h-5 w-5"})]})})})]})}),A.jsx("section",{className:"py-24 bg-secondary",children:A.jsx("div",{className:"container",children:A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-16 items-center",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-30},whileInView:{opacity:1,x:0},transition:{duration:.7},viewport:{once:!0},className:"relative",children:[A.jsx("div",{className:"aspect-[3/4] overflow-hidden shadow-elegant",children:A.jsx("img",{src:Jte,alt:"Joel Aguirre - Real Estate Agent",className:"w-full h-full object-cover object-top"})}),A.jsx("div",{className:"absolute -bottom-6 -right-6 w-32 h-32 bg-primary -z-10"})]}),A.jsxs(Ar.div,{initial:{opacity:0,x:30},whileInView:{opacity:1,x:0},transition:{duration:.7,delay:.1},viewport:{once:!0},children:[A.jsx("p",{className:"text-sm uppercase tracking-luxury text-muted-foreground mb-4",children:"About"}),A.jsx("h2",{className:"font-display text-4xl md:text-5xl font-semibold mb-6",children:"Joel Aguirre"}),A.jsxs("div",{className:"space-y-4 text-muted-foreground leading-relaxed",children:[A.jsx("p",{children:"My name is Joel Aguirre, I was born in Vail Colorado and moved here to Albuquerque, New Mexico at the young age of 10 years old. I graduated from West Mesa High School and then went on to pursue my BBA at the University of New Mexico."}),A.jsx("p",{children:"In my time at UNM I realized that helping others was something that I enjoyed and came easy to me. Once I graduated from UNM, I knew that I wanted to help people in my community. That is why as one of EXP Albuquerque's Top Producers, I am proud to represent home buyers & sellers in the Albuquerque, Rio Rancho, Santa Fe and surrounding areas."}),A.jsx("p",{children:"I have an in-depth knowledge of the market and the skills to help you achieve your real estate needs. My dedication to excellence and commitment to service sets me apart in the competitive real estate market. I would love the opportunity to be your trusted partner in achieving your real estate goals."})]}),A.jsx(fn,{asChild:!0,size:"lg",className:"btn-primary rounded-none mt-8",children:A.jsxs(xi,{to:"/contact",children:["Learn More",A.jsx(Wv,{className:"ml-2 h-5 w-5"})]})})]})]})})}),A.jsx("section",{className:"py-24 bg-background",children:A.jsxs("div",{className:"container",children:[A.jsxs(Ar.div,{initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},transition:{duration:.6},viewport:{once:!0},className:"text-center mb-16",children:[A.jsx("h2",{className:"font-display text-4xl md:text-5xl font-semibold mb-4",children:"How Can We Help?"}),A.jsx("p",{className:"text-muted-foreground max-w-2xl mx-auto",children:"Whether you're buying, selling, or just exploring, we're here to guide you"})]}),A.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[{icon:bS,title:"Buy a Home",description:"Search our extensive collection of properties to find your perfect match.",link:"/listings",linkText:"Start Searching"},{icon:EG,title:"Sell Your Home",description:"Get expert guidance and maximum value for your property.",link:"/contact",linkText:"Get Started"},{icon:Ud,title:"Home Valuation",description:"Discover what your home is worth in today's market.",link:null,linkText:"Get Estimate",onClick:()=>t(!0)}].map((f,o)=>A.jsxs(Ar.div,{initial:{opacity:0,y:24},whileInView:{opacity:1,y:0},transition:{duration:.5,delay:o*.1},viewport:{once:!0},className:"bg-card p-8 shadow-card hover-lift group",children:[A.jsx("div",{className:"w-14 h-14 bg-primary flex items-center justify-center mb-6 group-hover:bg-accent transition-colors duration-300",children:A.jsx(f.icon,{className:"h-7 w-7 text-primary-foreground"})}),A.jsx("h3",{className:"font-display text-xl font-semibold mb-3",children:f.title}),A.jsx("p",{className:"text-muted-foreground mb-6",children:f.description}),f.link?A.jsx(xi,{to:f.link,className:"text-sm font-medium uppercase tracking-luxury text-primary hover:text-accent transition-colors link-underline",children:f.linkText}):A.jsx("button",{onClick:f.onClick,className:"text-sm font-medium uppercase tracking-luxury text-primary hover:text-accent transition-colors link-underline",children:f.linkText})]},f.title))})]})}),A.jsx("section",{className:"py-24 bg-primary text-primary-foreground",children:A.jsx("div",{className:"container",children:A.jsxs(Ar.div,{initial:{opacity:0,scale:.95},whileInView:{opacity:1,scale:1},transition:{duration:.6},viewport:{once:!0},className:"text-center max-w-3xl mx-auto",children:[A.jsx("h2",{className:"font-display text-4xl md:text-5xl font-semibold mb-6",children:"Ready to Find Your Dream Home?"}),A.jsx("p",{className:"text-primary-foreground/80 mb-10 text-lg",children:"Let our experienced team guide you through every step of your real estate journey."}),A.jsxs("div",{className:"flex flex-wrap justify-center gap-4",children:[A.jsx(fn,{asChild:!0,size:"lg",className:"bg-white text-primary hover:bg-white/90 rounded-none px-10 py-6 text-sm font-medium uppercase tracking-luxury",children:A.jsxs(xi,{to:"/contact",children:["Contact Us Today",A.jsx(Wv,{className:"ml-2 h-5 w-5"})]})}),A.jsx(fn,{asChild:!0,size:"lg",variant:"outline",className:"border-2 border-white text-white hover:bg-white hover:text-primary rounded-none px-10 py-6 text-sm font-medium uppercase tracking-luxury bg-transparent",children:A.jsx(xi,{to:"/listings",children:"Browse Properties"})})]})]})})}),A.jsx(KCe,{open:e,onOpenChange:t})]})}function pz(e,[t,r]){return Math.min(r,Math.max(t,e))}var JCe=X.createContext(void 0);function YT(e){const t=X.useContext(JCe);return e||t||"ltr"}function Wre(e){const t=X.useRef({value:e,previous:e});return X.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var QCe=[" ","Enter","ArrowUp","ArrowDown"],eIe=[" ","Enter"],uy="Select",[YO,JO,tIe]=SO(uy),[wx,tet]=$l(uy,[tIe,gx]),QO=gx(),[rIe,im]=wx(uy),[nIe,iIe]=wx(uy),Zre=e=>{const{__scopeSelect:t,children:r,open:n,defaultOpen:l,onOpenChange:u,value:f,defaultValue:o,onValueChange:v,dir:w,name:P,autoComplete:C,disabled:k,required:L,form:$}=e,j=QO(t),[B,U]=X.useState(null),[q,H]=X.useState(null),[te,Q]=X.useState(!1),ae=YT(w),[ue,me]=qp({prop:n,defaultProp:l??!1,onChange:u,caller:uy}),[Ce,Fe]=qp({prop:f,defaultProp:o,onChange:v,caller:uy}),Ge=X.useRef(null),Ve=B?$||!!B.closest("form"):!0,[Ze,nt]=X.useState(new Set),dt=Array.from(Ze).map(rt=>rt.props.value).join(";");return A.jsx(gQ,{...j,children:A.jsxs(rIe,{required:L,scope:t,trigger:B,onTriggerChange:U,valueNode:q,onValueNodeChange:H,valueNodeHasChildren:te,onValueNodeHasChildrenChange:Q,contentId:jd(),value:Ce,onValueChange:Fe,open:ue,onOpenChange:me,dir:ae,triggerPointerDownPosRef:Ge,disabled:k,children:[A.jsx(YO.Provider,{scope:t,children:A.jsx(nIe,{scope:e.__scopeSelect,onNativeOptionAdd:X.useCallback(rt=>{nt(at=>new Set(at).add(rt))},[]),onNativeOptionRemove:X.useCallback(rt=>{nt(at=>{const qe=new Set(at);return qe.delete(rt),qe})},[]),children:r})}),Ve?A.jsxs(_ne,{"aria-hidden":!0,required:L,tabIndex:-1,name:P,autoComplete:C,value:Ce,onChange:rt=>Fe(rt.target.value),disabled:k,form:$,children:[Ce===void 0?A.jsx("option",{value:""}):null,Array.from(Ze)]},dt):null]})})};Zre.displayName=uy;var Xre="SelectTrigger",Kre=X.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:n=!1,...l}=e,u=QO(r),f=im(Xre,r),o=f.disabled||n,v=qn(t,f.onTriggerChange),w=JO(r),P=X.useRef("touch"),[C,k,L]=xne(j=>{const B=w().filter(H=>!H.disabled),U=B.find(H=>H.value===f.value),q=bne(B,j,U);q!==void 0&&f.onValueChange(q.value)}),$=j=>{o||(f.onOpenChange(!0),L()),j&&(f.triggerPointerDownPosRef.current={x:Math.round(j.pageX),y:Math.round(j.pageY)})};return A.jsx(dB,{asChild:!0,...u,children:A.jsx(nn.button,{type:"button",role:"combobox","aria-controls":f.contentId,"aria-expanded":f.open,"aria-required":f.required,"aria-autocomplete":"none",dir:f.dir,"data-state":f.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":vne(f.value)?"":void 0,...l,ref:v,onClick:_r(l.onClick,j=>{j.currentTarget.focus(),P.current!=="mouse"&&$(j)}),onPointerDown:_r(l.onPointerDown,j=>{P.current=j.pointerType;const B=j.target;B.hasPointerCapture(j.pointerId)&&B.releasePointerCapture(j.pointerId),j.button===0&&j.ctrlKey===!1&&j.pointerType==="mouse"&&($(j),j.preventDefault())}),onKeyDown:_r(l.onKeyDown,j=>{const B=C.current!=="";!(j.ctrlKey||j.altKey||j.metaKey)&&j.key.length===1&&k(j.key),!(B&&j.key===" ")&&QCe.includes(j.key)&&($(),j.preventDefault())})})})});Kre.displayName=Xre;var Yre="SelectValue",Jre=X.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:l,children:u,placeholder:f="",...o}=e,v=im(Yre,r),{onValueNodeHasChildrenChange:w}=v,P=u!==void 0,C=qn(t,v.onValueNodeChange);return fs(()=>{w(P)},[w,P]),A.jsx(nn.span,{...o,ref:C,style:{pointerEvents:"none"},children:vne(v.value)?A.jsx(A.Fragment,{children:f}):u})});Jre.displayName=Yre;var oIe="SelectIcon",Qre=X.forwardRef((e,t)=>{const{__scopeSelect:r,children:n,...l}=e;return A.jsx(nn.span,{"aria-hidden":!0,...l,ref:t,children:n||""})});Qre.displayName=oIe;var sIe="SelectPortal",ene=e=>A.jsx(DT,{asChild:!0,...e});ene.displayName=sIe;var dy="SelectContent",tne=X.forwardRef((e,t)=>{const r=im(dy,e.__scopeSelect),[n,l]=X.useState();if(fs(()=>{l(new DocumentFragment)},[]),!r.open){const u=n;return u?xy.createPortal(A.jsx(rne,{scope:e.__scopeSelect,children:A.jsx(YO.Slot,{scope:e.__scopeSelect,children:A.jsx("div",{children:e.children})})}),u):null}return A.jsx(nne,{...e,ref:t})});tne.displayName=dy;var Pu=10,[rne,om]=wx(dy),aIe="SelectContentImpl",lIe=ry("SelectContent.RemoveScroll"),nne=X.forwardRef((e,t)=>{const{__scopeSelect:r,position:n="item-aligned",onCloseAutoFocus:l,onEscapeKeyDown:u,onPointerDownOutside:f,side:o,sideOffset:v,align:w,alignOffset:P,arrowPadding:C,collisionBoundary:k,collisionPadding:L,sticky:$,hideWhenDetached:j,avoidCollisions:B,...U}=e,q=im(dy,r),[H,te]=X.useState(null),[Q,ae]=X.useState(null),ue=qn(t,rr=>te(rr)),[me,Ce]=X.useState(null),[Fe,Ge]=X.useState(null),Ve=JO(r),[Ze,nt]=X.useState(!1),dt=X.useRef(!1);X.useEffect(()=>{if(H)return g5(H)},[H]),m5();const rt=X.useCallback(rr=>{const[Wr,...Rt]=Ve().map(jt=>jt.ref.current),[Yt]=Rt.slice(-1),ir=document.activeElement;for(const jt of rr)if(jt===ir||(jt==null||jt.scrollIntoView({block:"nearest"}),jt===Wr&&Q&&(Q.scrollTop=0),jt===Yt&&Q&&(Q.scrollTop=Q.scrollHeight),jt==null||jt.focus(),document.activeElement!==ir))return},[Ve,Q]),at=X.useCallback(()=>rt([me,H]),[rt,me,H]);X.useEffect(()=>{Ze&&at()},[Ze,at]);const{onOpenChange:qe,triggerPointerDownPosRef:He}=q;X.useEffect(()=>{if(H){let rr={x:0,y:0};const Wr=Yt=>{var ir,jt;rr={x:Math.abs(Math.round(Yt.pageX)-(((ir=He.current)==null?void 0:ir.x)??0)),y:Math.abs(Math.round(Yt.pageY)-(((jt=He.current)==null?void 0:jt.y)??0))}},Rt=Yt=>{rr.x<=10&&rr.y<=10?Yt.preventDefault():H.contains(Yt.target)||qe(!1),document.removeEventListener("pointermove",Wr),He.current=null};return He.current!==null&&(document.addEventListener("pointermove",Wr),document.addEventListener("pointerup",Rt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Wr),document.removeEventListener("pointerup",Rt,{capture:!0})}}},[H,qe,He]),X.useEffect(()=>{const rr=()=>qe(!1);return window.addEventListener("blur",rr),window.addEventListener("resize",rr),()=>{window.removeEventListener("blur",rr),window.removeEventListener("resize",rr)}},[qe]);const[Et,Gt]=xne(rr=>{const Wr=Ve().filter(ir=>!ir.disabled),Rt=Wr.find(ir=>ir.ref.current===document.activeElement),Yt=bne(Wr,rr,Rt);Yt&&setTimeout(()=>Yt.ref.current.focus())}),Ot=X.useCallback((rr,Wr,Rt)=>{const Yt=!dt.current&&!Rt;(q.value!==void 0&&q.value===Wr||Yt)&&(Ce(rr),Yt&&(dt.current=!0))},[q.value]),$t=X.useCallback(()=>H==null?void 0:H.focus(),[H]),ur=X.useCallback((rr,Wr,Rt)=>{const Yt=!dt.current&&!Rt;(q.value!==void 0&&q.value===Wr||Yt)&&Ge(rr)},[q.value]),Yr=n==="popper"?mz:ine,hn=Yr===mz?{side:o,sideOffset:v,align:w,alignOffset:P,arrowPadding:C,collisionBoundary:k,collisionPadding:L,sticky:$,hideWhenDetached:j,avoidCollisions:B}:{};return A.jsx(rne,{scope:r,content:H,viewport:Q,onViewportChange:ae,itemRefCallback:Ot,selectedItem:me,onItemLeave:$t,itemTextRefCallback:ur,focusSelectedItem:at,selectedItemText:Fe,position:n,isPositioned:Ze,searchRef:Et,children:A.jsx(WO,{as:lIe,allowPinchZoom:!0,children:A.jsx(qO,{asChild:!0,trapped:q.open,onMountAutoFocus:rr=>{rr.preventDefault()},onUnmountAutoFocus:_r(l,rr=>{var Wr;(Wr=q.trigger)==null||Wr.focus({preventScroll:!0}),rr.preventDefault()}),children:A.jsx(hx,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:u,onPointerDownOutside:f,onFocusOutside:rr=>rr.preventDefault(),onDismiss:()=>q.onOpenChange(!1),children:A.jsx(Yr,{role:"listbox",id:q.contentId,"data-state":q.open?"open":"closed",dir:q.dir,onContextMenu:rr=>rr.preventDefault(),...U,...hn,onPlaced:()=>nt(!0),ref:ue,style:{display:"flex",flexDirection:"column",outline:"none",...U.style},onKeyDown:_r(U.onKeyDown,rr=>{const Wr=rr.ctrlKey||rr.altKey||rr.metaKey;if(rr.key==="Tab"&&rr.preventDefault(),!Wr&&rr.key.length===1&&Gt(rr.key),["ArrowUp","ArrowDown","Home","End"].includes(rr.key)){let Yt=Ve().filter(ir=>!ir.disabled).map(ir=>ir.ref.current);if(["ArrowUp","End"].includes(rr.key)&&(Yt=Yt.slice().reverse()),["ArrowUp","ArrowDown"].includes(rr.key)){const ir=rr.target,jt=Yt.indexOf(ir);Yt=Yt.slice(jt+1)}setTimeout(()=>rt(Yt)),rr.preventDefault()}})})})})})})});nne.displayName=aIe;var cIe="SelectItemAlignedPosition",ine=X.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:n,...l}=e,u=im(dy,r),f=om(dy,r),[o,v]=X.useState(null),[w,P]=X.useState(null),C=qn(t,ue=>P(ue)),k=JO(r),L=X.useRef(!1),$=X.useRef(!0),{viewport:j,selectedItem:B,selectedItemText:U,focusSelectedItem:q}=f,H=X.useCallback(()=>{if(u.trigger&&u.valueNode&&o&&w&&j&&B&&U){const ue=u.trigger.getBoundingClientRect(),me=w.getBoundingClientRect(),Ce=u.valueNode.getBoundingClientRect(),Fe=U.getBoundingClientRect();if(u.dir!=="rtl"){const ir=Fe.left-me.left,jt=Ce.left-ir,Ir=ue.left-jt,Xr=ue.width+Ir,Vn=Math.max(Xr,me.width),Hn=window.innerWidth-Pu,ei=pz(jt,[Pu,Math.max(Pu,Hn-Vn)]);o.style.minWidth=Xr+"px",o.style.left=ei+"px"}else{const ir=me.right-Fe.right,jt=window.innerWidth-Ce.right-ir,Ir=window.innerWidth-ue.right-jt,Xr=ue.width+Ir,Vn=Math.max(Xr,me.width),Hn=window.innerWidth-Pu,ei=pz(jt,[Pu,Math.max(Pu,Hn-Vn)]);o.style.minWidth=Xr+"px",o.style.right=ei+"px"}const Ge=k(),Ve=window.innerHeight-Pu*2,Ze=j.scrollHeight,nt=window.getComputedStyle(w),dt=parseInt(nt.borderTopWidth,10),rt=parseInt(nt.paddingTop,10),at=parseInt(nt.borderBottomWidth,10),qe=parseInt(nt.paddingBottom,10),He=dt+rt+Ze+qe+at,Et=Math.min(B.offsetHeight*5,He),Gt=window.getComputedStyle(j),Ot=parseInt(Gt.paddingTop,10),$t=parseInt(Gt.paddingBottom,10),ur=ue.top+ue.height/2-Pu,Yr=Ve-ur,hn=B.offsetHeight/2,rr=B.offsetTop+hn,Wr=dt+rt+rr,Rt=He-Wr;if(Wr<=ur){const ir=Ge.length>0&&B===Ge[Ge.length-1].ref.current;o.style.bottom="0px";const jt=w.clientHeight-j.offsetTop-j.offsetHeight,Ir=Math.max(Yr,hn+(ir?$t:0)+jt+at),Xr=Wr+Ir;o.style.height=Xr+"px"}else{const ir=Ge.length>0&&B===Ge[0].ref.current;o.style.top="0px";const Ir=Math.max(ur,dt+j.offsetTop+(ir?Ot:0)+hn)+Rt;o.style.height=Ir+"px",j.scrollTop=Wr-ur+j.offsetTop}o.style.margin=`${Pu}px 0`,o.style.minHeight=Et+"px",o.style.maxHeight=Ve+"px",n==null||n(),requestAnimationFrame(()=>L.current=!0)}},[k,u.trigger,u.valueNode,o,w,j,B,U,u.dir,n]);fs(()=>H(),[H]);const[te,Q]=X.useState();fs(()=>{w&&Q(window.getComputedStyle(w).zIndex)},[w]);const ae=X.useCallback(ue=>{ue&&$.current===!0&&(H(),q==null||q(),$.current=!1)},[H,q]);return A.jsx(dIe,{scope:r,contentWrapper:o,shouldExpandOnScrollRef:L,onScrollButtonChange:ae,children:A.jsx("div",{ref:v,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:te},children:A.jsx(nn.div,{...l,ref:C,style:{boxSizing:"border-box",maxHeight:"100%",...l.style}})})})});ine.displayName=cIe;var uIe="SelectPopperPosition",mz=X.forwardRef((e,t)=>{const{__scopeSelect:r,align:n="start",collisionPadding:l=Pu,...u}=e,f=QO(r);return A.jsx(hB,{...f,...u,ref:t,align:n,collisionPadding:l,style:{boxSizing:"border-box",...u.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});mz.displayName=uIe;var[dIe,S5]=wx(dy,{}),gz="SelectViewport",one=X.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:n,...l}=e,u=om(gz,r),f=S5(gz,r),o=qn(t,u.onViewportChange),v=X.useRef(0);return A.jsxs(A.Fragment,{children:[A.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),A.jsx(YO.Slot,{scope:r,children:A.jsx(nn.div,{"data-radix-select-viewport":"",role:"presentation",...l,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...l.style},onScroll:_r(l.onScroll,w=>{const P=w.currentTarget,{contentWrapper:C,shouldExpandOnScrollRef:k}=f;if(k!=null&&k.current&&C){const L=Math.abs(v.current-P.scrollTop);if(L>0){const $=window.innerHeight-Pu*2,j=parseFloat(C.style.minHeight),B=parseFloat(C.style.height),U=Math.max(j,B);if(U<$){const q=U+L,H=Math.min($,q),te=q-H;C.style.height=H+"px",C.style.bottom==="0px"&&(P.scrollTop=te>0?te:0,C.style.justifyContent="flex-end")}}}v.current=P.scrollTop})})})]})});one.displayName=gz;var sne="SelectGroup",[hIe,fIe]=wx(sne),pIe=X.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=jd();return A.jsx(hIe,{scope:r,id:l,children:A.jsx(nn.div,{role:"group","aria-labelledby":l,...n,ref:t})})});pIe.displayName=sne;var ane="SelectLabel",lne=X.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=fIe(ane,r);return A.jsx(nn.div,{id:l.id,...n,ref:t})});lne.displayName=ane;var nI="SelectItem",[mIe,cne]=wx(nI),une=X.forwardRef((e,t)=>{const{__scopeSelect:r,value:n,disabled:l=!1,textValue:u,...f}=e,o=im(nI,r),v=om(nI,r),w=o.value===n,[P,C]=X.useState(u??""),[k,L]=X.useState(!1),$=qn(t,q=>{var H;return(H=v.itemRefCallback)==null?void 0:H.call(v,q,n,l)}),j=jd(),B=X.useRef("touch"),U=()=>{l||(o.onValueChange(n),o.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return A.jsx(mIe,{scope:r,value:n,disabled:l,textId:j,isSelected:w,onItemTextChange:X.useCallback(q=>{C(H=>H||((q==null?void 0:q.textContent)??"").trim())},[]),children:A.jsx(YO.ItemSlot,{scope:r,value:n,disabled:l,textValue:P,children:A.jsx(nn.div,{role:"option","aria-labelledby":j,"data-highlighted":k?"":void 0,"aria-selected":w&&k,"data-state":w?"checked":"unchecked","aria-disabled":l||void 0,"data-disabled":l?"":void 0,tabIndex:l?void 0:-1,...f,ref:$,onFocus:_r(f.onFocus,()=>L(!0)),onBlur:_r(f.onBlur,()=>L(!1)),onClick:_r(f.onClick,()=>{B.current!=="mouse"&&U()}),onPointerUp:_r(f.onPointerUp,()=>{B.current==="mouse"&&U()}),onPointerDown:_r(f.onPointerDown,q=>{B.current=q.pointerType}),onPointerMove:_r(f.onPointerMove,q=>{var H;B.current=q.pointerType,l?(H=v.onItemLeave)==null||H.call(v):B.current==="mouse"&&q.currentTarget.focus({preventScroll:!0})}),onPointerLeave:_r(f.onPointerLeave,q=>{var H;q.currentTarget===document.activeElement&&((H=v.onItemLeave)==null||H.call(v))}),onKeyDown:_r(f.onKeyDown,q=>{var te;((te=v.searchRef)==null?void 0:te.current)!==""&&q.key===" "||(eIe.includes(q.key)&&U(),q.key===" "&&q.preventDefault())})})})})});une.displayName=nI;var E1="SelectItemText",dne=X.forwardRef((e,t)=>{const{__scopeSelect:r,className:n,style:l,...u}=e,f=im(E1,r),o=om(E1,r),v=cne(E1,r),w=iIe(E1,r),[P,C]=X.useState(null),k=qn(t,U=>C(U),v.onItemTextChange,U=>{var q;return(q=o.itemTextRefCallback)==null?void 0:q.call(o,U,v.value,v.disabled)}),L=P==null?void 0:P.textContent,$=X.useMemo(()=>A.jsx("option",{value:v.value,disabled:v.disabled,children:L},v.value),[v.disabled,v.value,L]),{onNativeOptionAdd:j,onNativeOptionRemove:B}=w;return fs(()=>(j($),()=>B($)),[j,B,$]),A.jsxs(A.Fragment,{children:[A.jsx(nn.span,{id:v.textId,...u,ref:k}),v.isSelected&&f.valueNode&&!f.valueNodeHasChildren?xy.createPortal(u.children,f.valueNode):null]})});dne.displayName=E1;var hne="SelectItemIndicator",fne=X.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return cne(hne,r).isSelected?A.jsx(nn.span,{"aria-hidden":!0,...n,ref:t}):null});fne.displayName=hne;var yz="SelectScrollUpButton",pne=X.forwardRef((e,t)=>{const r=om(yz,e.__scopeSelect),n=S5(yz,e.__scopeSelect),[l,u]=X.useState(!1),f=qn(t,n.onScrollButtonChange);return fs(()=>{if(r.viewport&&r.isPositioned){let o=function(){const w=v.scrollTop>0;u(w)};const v=r.viewport;return o(),v.addEventListener("scroll",o),()=>v.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),l?A.jsx(gne,{...e,ref:f,onAutoScroll:()=>{const{viewport:o,selectedItem:v}=r;o&&v&&(o.scrollTop=o.scrollTop-v.offsetHeight)}}):null});pne.displayName=yz;var _z="SelectScrollDownButton",mne=X.forwardRef((e,t)=>{const r=om(_z,e.__scopeSelect),n=S5(_z,e.__scopeSelect),[l,u]=X.useState(!1),f=qn(t,n.onScrollButtonChange);return fs(()=>{if(r.viewport&&r.isPositioned){let o=function(){const w=v.scrollHeight-v.clientHeight,P=Math.ceil(v.scrollTop)<w;u(P)};const v=r.viewport;return o(),v.addEventListener("scroll",o),()=>v.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),l?A.jsx(gne,{...e,ref:f,onAutoScroll:()=>{const{viewport:o,selectedItem:v}=r;o&&v&&(o.scrollTop=o.scrollTop+v.offsetHeight)}}):null});mne.displayName=_z;var gne=X.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:n,...l}=e,u=om("SelectScrollButton",r),f=X.useRef(null),o=JO(r),v=X.useCallback(()=>{f.current!==null&&(window.clearInterval(f.current),f.current=null)},[]);return X.useEffect(()=>()=>v(),[v]),fs(()=>{var P;const w=o().find(C=>C.ref.current===document.activeElement);(P=w==null?void 0:w.ref.current)==null||P.scrollIntoView({block:"nearest"})},[o]),A.jsx(nn.div,{"aria-hidden":!0,...l,ref:t,style:{flexShrink:0,...l.style},onPointerDown:_r(l.onPointerDown,()=>{f.current===null&&(f.current=window.setInterval(n,50))}),onPointerMove:_r(l.onPointerMove,()=>{var w;(w=u.onItemLeave)==null||w.call(u),f.current===null&&(f.current=window.setInterval(n,50))}),onPointerLeave:_r(l.onPointerLeave,()=>{v()})})}),gIe="SelectSeparator",yne=X.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e;return A.jsx(nn.div,{"aria-hidden":!0,...n,ref:t})});yne.displayName=gIe;var vz="SelectArrow",yIe=X.forwardRef((e,t)=>{const{__scopeSelect:r,...n}=e,l=QO(r),u=im(vz,r),f=om(vz,r);return u.open&&f.position==="popper"?A.jsx(fB,{...l,...n,ref:t}):null});yIe.displayName=vz;var _Ie="SelectBubbleInput",_ne=X.forwardRef(({__scopeSelect:e,value:t,...r},n)=>{const l=X.useRef(null),u=qn(n,l),f=Wre(t);return X.useEffect(()=>{const o=l.current;if(!o)return;const v=window.HTMLSelectElement.prototype,P=Object.getOwnPropertyDescriptor(v,"value").set;if(f!==t&&P){const C=new Event("change",{bubbles:!0});P.call(o,t),o.dispatchEvent(C)}},[f,t]),A.jsx(nn.select,{...r,style:{...cJ,...r.style},ref:u,defaultValue:t})});_ne.displayName=_Ie;function vne(e){return e===""||e===void 0}function xne(e){const t=ss(e),r=X.useRef(""),n=X.useRef(0),l=X.useCallback(f=>{const o=r.current+f;t(o),function v(w){r.current=w,window.clearTimeout(n.current),w!==""&&(n.current=window.setTimeout(()=>v(""),1e3))}(o)},[t]),u=X.useCallback(()=>{r.current="",window.clearTimeout(n.current)},[]);return X.useEffect(()=>()=>window.clearTimeout(n.current),[]),[r,l,u]}function bne(e,t,r){const l=t.length>1&&Array.from(t).every(w=>w===t[0])?t[0]:t,u=r?e.indexOf(r):-1;let f=vIe(e,Math.max(u,0));l.length===1&&(f=f.filter(w=>w!==r));const v=f.find(w=>w.textValue.toLowerCase().startsWith(l.toLowerCase()));return v!==r?v:void 0}function vIe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var xIe=Zre,wne=Kre,bIe=Jre,wIe=Qre,SIe=ene,Sne=tne,TIe=one,Tne=lne,Ene=une,EIe=dne,AIe=fne,Ane=pne,Pne=mne,Cne=yne;const zc=xIe,Fc=bIe,ec=X.forwardRef(({className:e,children:t,...r},n)=>A.jsxs(wne,{ref:n,className:sr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,A.jsx(wIe,{asChild:!0,children:A.jsx(X3,{className:"h-4 w-4 opacity-50"})})]}));ec.displayName=wne.displayName;const Ine=X.forwardRef(({className:e,...t},r)=>A.jsx(Ane,{ref:r,className:sr("flex cursor-default items-center justify-center py-1",e),...t,children:A.jsx(_ye,{className:"h-4 w-4"})}));Ine.displayName=Ane.displayName;const One=X.forwardRef(({className:e,...t},r)=>A.jsx(Pne,{ref:r,className:sr("flex cursor-default items-center justify-center py-1",e),...t,children:A.jsx(X3,{className:"h-4 w-4"})}));One.displayName=Pne.displayName;const tc=X.forwardRef(({className:e,children:t,position:r="popper",...n},l)=>A.jsx(SIe,{children:A.jsxs(Sne,{ref:l,className:sr("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...n,children:[A.jsx(Ine,{}),A.jsx(TIe,{className:sr("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),A.jsx(One,{})]})}));tc.displayName=Sne.displayName;const PIe=X.forwardRef(({className:e,...t},r)=>A.jsx(Tne,{ref:r,className:sr("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));PIe.displayName=Tne.displayName;const Qr=X.forwardRef(({className:e,children:t,...r},n)=>A.jsxs(Ene,{ref:n,className:sr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[A.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:A.jsx(AIe,{children:A.jsx(DJ,{className:"h-4 w-4"})})}),A.jsx(EIe,{children:t})]}));Qr.displayName=Ene.displayName;const CIe=X.forwardRef(({className:e,...t},r)=>A.jsx(Cne,{ref:r,className:sr("-mx-1 my-1 h-px bg-muted",e),...t}));CIe.displayName=Cne.displayName;const IIe=x5,OIe=Gre,kIe=b5,kne=X.forwardRef(({className:e,...t},r)=>A.jsx(WT,{className:sr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));kne.displayName=WT.displayName;const RIe=jT("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Rne=X.forwardRef(({side:e="right",className:t,children:r,...n},l)=>A.jsxs(kIe,{children:[A.jsx(kne,{}),A.jsxs(ZT,{ref:l,className:sr(RIe({side:e}),t),...n,children:[r,A.jsxs(XO,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none",children:[A.jsx(Hp,{className:"h-4 w-4"}),A.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Rne.displayName=ZT.displayName;const Mne=({className:e,...t})=>A.jsx("div",{className:sr("flex flex-col space-y-2 text-center sm:text-left",e),...t});Mne.displayName="SheetHeader";const Dne=X.forwardRef(({className:e,...t},r)=>A.jsx(XT,{ref:r,className:sr("text-lg font-semibold text-foreground",e),...t}));Dne.displayName=XT.displayName;const MIe=X.forwardRef(({className:e,...t},r)=>A.jsx(KT,{ref:r,className:sr("text-sm text-muted-foreground",e),...t}));MIe.displayName=KT.displayName;function DIe({filters:e,onFiltersChange:t}){var v;const[r,n]=X.useState(e.city||""),l=()=>{t({...e,city:r||void 0})},u=()=>{n(""),t({})},f=Object.values(e).some(w=>w!==void 0),o=()=>{var w;return A.jsxs("div",{className:"space-y-5",children:[A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Status"}),A.jsxs(zc,{value:e.status||"",onValueChange:P=>t({...e,status:P||void 0}),children:[A.jsx(ec,{className:"h-12 rounded-2xl",children:A.jsx(Fc,{placeholder:"All Statuses"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"all",children:"All Statuses"}),A.jsx(Qr,{value:"for_sale",children:"For Sale"}),A.jsx(Qr,{value:"for_rent",children:"For Rent"}),A.jsx(Qr,{value:"pending",children:"Pending"}),A.jsx(Qr,{value:"sold",children:"Sold"})]})]})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Property Type"}),A.jsxs(zc,{value:e.propertyType||"",onValueChange:P=>t({...e,propertyType:P||void 0}),children:[A.jsx(ec,{className:"h-12 rounded-2xl",children:A.jsx(Fc,{placeholder:"All Types"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"all",children:"All Types"}),A.jsx(Qr,{value:"house",children:"House"}),A.jsx(Qr,{value:"condo",children:"Condo"}),A.jsx(Qr,{value:"townhouse",children:"Townhouse"}),A.jsx(Qr,{value:"land",children:"Land"}),A.jsx(Qr,{value:"multi_family",children:"Multi-Family"}),A.jsx(Qr,{value:"commercial",children:"Commercial"})]})]})]}),A.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Min Price"}),A.jsx(jn,{type:"number",placeholder:"$0",className:"h-12 rounded-2xl",value:e.minPrice||"",onChange:P=>t({...e,minPrice:P.target.value?Number(P.target.value):void 0})})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Max Price"}),A.jsx(jn,{type:"number",placeholder:"Any",className:"h-12 rounded-2xl",value:e.maxPrice||"",onChange:P=>t({...e,maxPrice:P.target.value?Number(P.target.value):void 0})})]})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Minimum Beds"}),A.jsxs(zc,{value:((w=e.minBeds)==null?void 0:w.toString())||"",onValueChange:P=>t({...e,minBeds:P?Number(P):void 0}),children:[A.jsx(ec,{className:"h-12 rounded-2xl",children:A.jsx(Fc,{placeholder:"Any"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"any",children:"Any"}),A.jsx(Qr,{value:"1",children:"1+"}),A.jsx(Qr,{value:"2",children:"2+"}),A.jsx(Qr,{value:"3",children:"3+"}),A.jsx(Qr,{value:"4",children:"4+"}),A.jsx(Qr,{value:"5",children:"5+"})]})]})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Sort By"}),A.jsxs(zc,{value:e.sortBy||"newest",onValueChange:P=>t({...e,sortBy:P}),children:[A.jsx(ec,{className:"h-12 rounded-2xl",children:A.jsx(Fc,{placeholder:"Newest First"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"newest",children:"Newest First"}),A.jsx(Qr,{value:"price_asc",children:"Price: Low to High"}),A.jsx(Qr,{value:"price_desc",children:"Price: High to Low"})]})]})]}),f&&A.jsxs(fn,{variant:"outline",onClick:u,className:"w-full h-12 rounded-2xl",children:[A.jsx(Hp,{className:"h-4 w-4 mr-2"}),"Clear All Filters"]})]})};return A.jsxs("div",{className:"space-y-4",children:[A.jsxs("div",{className:"flex gap-3",children:[A.jsxs("div",{className:"relative flex-1",children:[A.jsx(bS,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),A.jsx(jn,{placeholder:"Search by city...",value:r,onChange:w=>n(w.target.value),onKeyDown:w=>w.key==="Enter"&&l(),className:"pl-12 h-14 rounded-2xl text-base"})]}),A.jsx(fn,{onClick:l,className:"h-14 px-8 bg-gradient-primary text-white rounded-2xl shadow-glow hover:shadow-lg hover:scale-105 transition-all",children:"Search"}),A.jsxs(IIe,{children:[A.jsx(OIe,{asChild:!0,children:A.jsx(fn,{variant:"outline",className:"h-14 w-14 rounded-2xl md:hidden",children:A.jsx(Nye,{className:"h-5 w-5"})})}),A.jsxs(Rne,{className:"rounded-l-3xl",children:[A.jsx(Mne,{children:A.jsx(Dne,{className:"font-display",children:"Filters"})}),A.jsx("div",{className:"mt-6",children:A.jsx(o,{})})]})]})]}),A.jsx("div",{className:"hidden md:block",children:A.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[A.jsxs(zc,{value:e.status||"",onValueChange:w=>t({...e,status:w==="all"?void 0:w}),children:[A.jsx(ec,{className:"w-[140px] h-11 rounded-2xl",children:A.jsx(Fc,{placeholder:"Status"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"all",children:"All Statuses"}),A.jsx(Qr,{value:"for_sale",children:"For Sale"}),A.jsx(Qr,{value:"for_rent",children:"For Rent"}),A.jsx(Qr,{value:"pending",children:"Pending"}),A.jsx(Qr,{value:"sold",children:"Sold"})]})]}),A.jsxs(zc,{value:e.propertyType||"",onValueChange:w=>t({...e,propertyType:w==="all"?void 0:w}),children:[A.jsx(ec,{className:"w-[140px] h-11 rounded-2xl",children:A.jsx(Fc,{placeholder:"Type"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"all",children:"All Types"}),A.jsx(Qr,{value:"house",children:"House"}),A.jsx(Qr,{value:"condo",children:"Condo"}),A.jsx(Qr,{value:"townhouse",children:"Townhouse"}),A.jsx(Qr,{value:"land",children:"Land"}),A.jsx(Qr,{value:"multi_family",children:"Multi-Family"})]})]}),A.jsxs(zc,{value:((v=e.minBeds)==null?void 0:v.toString())||"",onValueChange:w=>t({...e,minBeds:w==="any"?void 0:Number(w)}),children:[A.jsx(ec,{className:"w-[120px] h-11 rounded-2xl",children:A.jsx(Fc,{placeholder:"Beds"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"any",children:"Any Beds"}),A.jsx(Qr,{value:"1",children:"1+ Beds"}),A.jsx(Qr,{value:"2",children:"2+ Beds"}),A.jsx(Qr,{value:"3",children:"3+ Beds"}),A.jsx(Qr,{value:"4",children:"4+ Beds"})]})]}),A.jsxs(zc,{value:e.sortBy||"newest",onValueChange:w=>t({...e,sortBy:w}),children:[A.jsx(ec,{className:"w-[130px] h-11 rounded-2xl",children:A.jsx(Fc,{placeholder:"Sort"})}),A.jsxs(tc,{children:[A.jsx(Qr,{value:"newest",children:"Newest"}),A.jsx(Qr,{value:"price_asc",children:"Price "}),A.jsx(Qr,{value:"price_desc",children:"Price "})]})]}),f&&A.jsxs(fn,{variant:"ghost",onClick:u,className:"text-destructive hover:text-destructive h-11 px-4 rounded-2xl",children:[A.jsx(Hp,{className:"h-4 w-4 mr-1"}),"Clear"]})]})})]})}var Lne={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(m1,function(){var r,n,l;function u(o,v){if(!r)r=v;else if(!n)n=v;else{var w="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk); self.onerror = null;",P={};r(P),l=v(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(l.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}u(["exports"],function(o){var v=1e-6,w=typeof Float32Array<"u"?Float32Array:Array;function P(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=a*y-p*d;return _?(c[0]=y*(_=1/_),c[1]=-d*_,c[2]=-p*_,c[3]=a*_,c):null}function C(){var c=new w(9);return w!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c}function k(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=i[4],b=i[5],E=i[6],I=i[7],M=i[8];return c[0]=_*M-b*I,c[1]=p*I-d*M,c[2]=d*b-p*_,c[3]=b*E-y*M,c[4]=a*M-p*E,c[5]=p*y-a*b,c[6]=y*I-_*E,c[7]=d*E-a*I,c[8]=a*_-d*y,c}function L(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3],b=i[4],E=i[5],I=i[6],M=i[7],D=i[8],N=a[0],V=a[1],G=a[2],Y=a[3],re=a[4],J=a[5],oe=a[6],le=a[7],de=a[8];return c[0]=N*d+V*_+G*I,c[1]=N*p+V*b+G*M,c[2]=N*y+V*E+G*D,c[3]=Y*d+re*_+J*I,c[4]=Y*p+re*b+J*M,c[5]=Y*y+re*E+J*D,c[6]=oe*d+le*_+de*I,c[7]=oe*p+le*b+de*M,c[8]=oe*y+le*E+de*D,c}function $(){var c=new w(16);return w!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c}function j(c){var i=new w(16);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=c[7],i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=c[11],i[12]=c[12],i[13]=c[13],i[14]=c[14],i[15]=c[15],i}function B(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function U(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=i[4],b=i[5],E=i[6],I=i[7],M=i[8],D=i[9],N=i[10],V=i[11],G=i[12],Y=i[13],re=i[14],J=i[15],oe=a*b-d*_,le=a*E-p*_,de=a*I-y*_,_e=d*E-p*b,ye=d*I-y*b,Te=p*I-y*E,Ae=M*Y-D*G,Se=M*re-N*G,Oe=M*J-V*G,Me=D*re-N*Y,st=D*J-V*Y,et=N*J-V*re,it=oe*et-le*st+de*Me+_e*Oe-ye*Se+Te*Ae;return it?(c[0]=(b*et-E*st+I*Me)*(it=1/it),c[1]=(p*st-d*et-y*Me)*it,c[2]=(Y*Te-re*ye+J*_e)*it,c[3]=(N*ye-D*Te-V*_e)*it,c[4]=(E*Oe-_*et-I*Se)*it,c[5]=(a*et-p*Oe+y*Se)*it,c[6]=(re*de-G*Te-J*le)*it,c[7]=(M*Te-N*de+V*le)*it,c[8]=(_*st-b*Oe+I*Ae)*it,c[9]=(d*Oe-a*st-y*Ae)*it,c[10]=(G*ye-Y*de+J*oe)*it,c[11]=(D*de-M*ye-V*oe)*it,c[12]=(b*Se-_*Me-E*Ae)*it,c[13]=(a*Me-d*Se+p*Ae)*it,c[14]=(Y*le-G*_e-re*oe)*it,c[15]=(M*_e-D*le+N*oe)*it,c):null}function q(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3],b=i[4],E=i[5],I=i[6],M=i[7],D=i[8],N=i[9],V=i[10],G=i[11],Y=i[12],re=i[13],J=i[14],oe=i[15],le=a[0],de=a[1],_e=a[2],ye=a[3];return c[0]=le*d+de*b+_e*D+ye*Y,c[1]=le*p+de*E+_e*N+ye*re,c[2]=le*y+de*I+_e*V+ye*J,c[3]=le*_+de*M+_e*G+ye*oe,c[4]=(le=a[4])*d+(de=a[5])*b+(_e=a[6])*D+(ye=a[7])*Y,c[5]=le*p+de*E+_e*N+ye*re,c[6]=le*y+de*I+_e*V+ye*J,c[7]=le*_+de*M+_e*G+ye*oe,c[8]=(le=a[8])*d+(de=a[9])*b+(_e=a[10])*D+(ye=a[11])*Y,c[9]=le*p+de*E+_e*N+ye*re,c[10]=le*y+de*I+_e*V+ye*J,c[11]=le*_+de*M+_e*G+ye*oe,c[12]=(le=a[12])*d+(de=a[13])*b+(_e=a[14])*D+(ye=a[15])*Y,c[13]=le*p+de*E+_e*N+ye*re,c[14]=le*y+de*I+_e*V+ye*J,c[15]=le*_+de*M+_e*G+ye*oe,c}function H(c,i,a){var d,p,y,_,b,E,I,M,D,N,V,G,Y=a[0],re=a[1],J=a[2];return i===c?(c[12]=i[0]*Y+i[4]*re+i[8]*J+i[12],c[13]=i[1]*Y+i[5]*re+i[9]*J+i[13],c[14]=i[2]*Y+i[6]*re+i[10]*J+i[14],c[15]=i[3]*Y+i[7]*re+i[11]*J+i[15]):(p=i[1],y=i[2],_=i[3],b=i[4],E=i[5],I=i[6],M=i[7],D=i[8],N=i[9],V=i[10],G=i[11],c[0]=d=i[0],c[1]=p,c[2]=y,c[3]=_,c[4]=b,c[5]=E,c[6]=I,c[7]=M,c[8]=D,c[9]=N,c[10]=V,c[11]=G,c[12]=d*Y+b*re+D*J+i[12],c[13]=p*Y+E*re+N*J+i[13],c[14]=y*Y+I*re+V*J+i[14],c[15]=_*Y+M*re+G*J+i[15]),c}function te(c,i,a){var d=a[0],p=a[1],y=a[2];return c[0]=i[0]*d,c[1]=i[1]*d,c[2]=i[2]*d,c[3]=i[3]*d,c[4]=i[4]*p,c[5]=i[5]*p,c[6]=i[6]*p,c[7]=i[7]*p,c[8]=i[8]*y,c[9]=i[9]*y,c[10]=i[10]*y,c[11]=i[11]*y,c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15],c}function Q(c,i,a){var d=Math.sin(a),p=Math.cos(a),y=i[4],_=i[5],b=i[6],E=i[7],I=i[8],M=i[9],D=i[10],N=i[11];return i!==c&&(c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[4]=y*p+I*d,c[5]=_*p+M*d,c[6]=b*p+D*d,c[7]=E*p+N*d,c[8]=I*p-y*d,c[9]=M*p-_*d,c[10]=D*p-b*d,c[11]=N*p-E*d,c}function ae(c,i,a){var d=Math.sin(a),p=Math.cos(a),y=i[0],_=i[1],b=i[2],E=i[3],I=i[8],M=i[9],D=i[10],N=i[11];return i!==c&&(c[4]=i[4],c[5]=i[5],c[6]=i[6],c[7]=i[7],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=y*p-I*d,c[1]=_*p-M*d,c[2]=b*p-D*d,c[3]=E*p-N*d,c[8]=y*d+I*p,c[9]=_*d+M*p,c[10]=b*d+D*p,c[11]=E*d+N*p,c}function ue(c,i,a){var d=Math.sin(a),p=Math.cos(a),y=i[0],_=i[1],b=i[2],E=i[3],I=i[4],M=i[5],D=i[6],N=i[7];return i!==c&&(c[8]=i[8],c[9]=i[9],c[10]=i[10],c[11]=i[11],c[12]=i[12],c[13]=i[13],c[14]=i[14],c[15]=i[15]),c[0]=y*p+I*d,c[1]=_*p+M*d,c[2]=b*p+D*d,c[3]=E*p+N*d,c[4]=I*p-y*d,c[5]=M*p-_*d,c[6]=D*p-b*d,c[7]=N*p-E*d,c}function me(c,i){return c[0]=i[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=i[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=i[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function Ce(c,i,a){var d,p,y,_=a[0],b=a[1],E=a[2],I=Math.sqrt(_*_+b*b+E*E);return I<v?null:(_*=I=1/I,b*=I,E*=I,d=Math.sin(i),p=Math.cos(i),c[0]=_*_*(y=1-p)+p,c[1]=b*_*y+E*d,c[2]=E*_*y-b*d,c[3]=0,c[4]=_*b*y-E*d,c[5]=b*b*y+p,c[6]=E*b*y+_*d,c[7]=0,c[8]=_*E*y+b*d,c[9]=b*E*y-_*d,c[10]=E*E*y+p,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c)}function Fe(c,i){var a=i[0],d=i[1],p=i[2],y=i[4],_=i[5],b=i[6],E=i[8],I=i[9],M=i[10];return c[0]=Math.sqrt(a*a+d*d+p*p),c[1]=Math.sqrt(y*y+_*_+b*b),c[2]=Math.sqrt(E*E+I*I+M*M),c}function Ge(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=a+a,b=d+d,E=p+p,I=a*_,M=d*_,D=d*b,N=p*_,V=p*b,G=p*E,Y=y*_,re=y*b,J=y*E;return c[0]=1-D-G,c[1]=M+J,c[2]=N-re,c[3]=0,c[4]=M-J,c[5]=1-I-G,c[6]=V+Y,c[7]=0,c[8]=N+re,c[9]=V-Y,c[10]=1-I-D,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}var Ve=q;function Ze(){var c=new w(3);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c}function nt(c){var i=new w(3);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i}function dt(c){var i=c[0],a=c[1],d=c[2];return Math.sqrt(i*i+a*a+d*d)}function rt(c,i,a){var d=new w(3);return d[0]=c,d[1]=i,d[2]=a,d}function at(c,i,a,d){return c[0]=i,c[1]=a,c[2]=d,c}function qe(c,i,a){return c[0]=i[0]+a[0],c[1]=i[1]+a[1],c[2]=i[2]+a[2],c}function He(c,i,a){return c[0]=i[0]-a[0],c[1]=i[1]-a[1],c[2]=i[2]-a[2],c}function Et(c,i,a){return c[0]=i[0]*a[0],c[1]=i[1]*a[1],c[2]=i[2]*a[2],c}function Gt(c,i,a){return c[0]=Math.min(i[0],a[0]),c[1]=Math.min(i[1],a[1]),c[2]=Math.min(i[2],a[2]),c}function Ot(c,i,a){return c[0]=Math.max(i[0],a[0]),c[1]=Math.max(i[1],a[1]),c[2]=Math.max(i[2],a[2]),c}function $t(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c[2]=i[2]*a,c}function ur(c,i,a,d){return c[0]=i[0]+a[0]*d,c[1]=i[1]+a[1]*d,c[2]=i[2]+a[2]*d,c}function Yr(c,i){var a=i[0]-c[0],d=i[1]-c[1],p=i[2]-c[2];return Math.sqrt(a*a+d*d+p*p)}function hn(c,i){var a=i[0]-c[0],d=i[1]-c[1],p=i[2]-c[2];return a*a+d*d+p*p}function rr(c){var i=c[0],a=c[1],d=c[2];return i*i+a*a+d*d}function Wr(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c}function Rt(c,i){var a=i[0],d=i[1],p=i[2],y=a*a+d*d+p*p;return y>0&&(y=1/Math.sqrt(y)),c[0]=i[0]*y,c[1]=i[1]*y,c[2]=i[2]*y,c}function Yt(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]}function ir(c,i,a){var d=i[0],p=i[1],y=i[2],_=a[0],b=a[1],E=a[2];return c[0]=p*E-y*b,c[1]=y*_-d*E,c[2]=d*b-p*_,c}function jt(c,i,a,d){var p=i[0],y=i[1],_=i[2];return c[0]=p+d*(a[0]-p),c[1]=y+d*(a[1]-y),c[2]=_+d*(a[2]-_),c}function Ir(c,i,a){var d=i[0],p=i[1],y=i[2],_=a[3]*d+a[7]*p+a[11]*y+a[15];return c[0]=(a[0]*d+a[4]*p+a[8]*y+a[12])/(_=_||1),c[1]=(a[1]*d+a[5]*p+a[9]*y+a[13])/_,c[2]=(a[2]*d+a[6]*p+a[10]*y+a[14])/_,c}function Xr(c,i,a){var d=i[0],p=i[1],y=i[2];return c[0]=d*a[0]+p*a[3]+y*a[6],c[1]=d*a[1]+p*a[4]+y*a[7],c[2]=d*a[2]+p*a[5]+y*a[8],c}function Vn(c,i,a){var d=a[0],p=a[1],y=a[2],_=a[3],b=i[0],E=i[1],I=i[2],M=p*I-y*E,D=y*b-d*I,N=d*E-p*b;return c[0]=b+_*(M+=M)+p*(N+=N)-y*(D+=D),c[1]=E+_*D+y*M-d*N,c[2]=I+_*N+d*D-p*M,c}function Hn(c){return c[0]=0,c[1]=0,c[2]=0,c}function ei(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]}var Nn=He,ho=Et,ot=dt;function St(){var c=new w(4);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),c}function Nt(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c[2]=i[2]*a,c[3]=i[3]*a,c}function dr(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=a*a+d*d+p*p+y*y;return _>0&&(_=1/Math.sqrt(_)),c[0]=a*_,c[1]=d*_,c[2]=p*_,c[3]=y*_,c}function nr(c,i){return c[0]*i[0]+c[1]*i[1]+c[2]*i[2]+c[3]*i[3]}function er(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3];return c[0]=a[0]*d+a[4]*p+a[8]*y+a[12]*_,c[1]=a[1]*d+a[5]*p+a[9]*y+a[13]*_,c[2]=a[2]*d+a[6]*p+a[10]*y+a[14]*_,c[3]=a[3]*d+a[7]*p+a[11]*y+a[15]*_,c}function wr(){var c=new w(4);return w!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0),c[3]=1,c}function Tn(c){return c[0]=0,c[1]=0,c[2]=0,c[3]=1,c}function Kn(c,i,a){a*=.5;var d=i[0],p=i[1],y=i[2],_=i[3],b=Math.sin(a),E=Math.cos(a);return c[0]=d*E+_*b,c[1]=p*E+y*b,c[2]=y*E-p*b,c[3]=_*E-d*b,c}function Po(c,i,a){a*=.5;var d=i[0],p=i[1],y=i[2],_=i[3],b=Math.sin(a),E=Math.cos(a);return c[0]=d*E-y*b,c[1]=p*E+_*b,c[2]=y*E+d*b,c[3]=_*E-p*b,c}Ze(),St();var Ji,Ps,ps,qa=dr,Wo=(Ji=Ze(),Ps=rt(1,0,0),ps=rt(0,1,0),function(c,i,a){var d=Yt(i,a);return d<-.999999?(ir(Ji,Ps,i),ot(Ji)<1e-6&&ir(Ji,ps,i),Rt(Ji,Ji),function(p,y,_){_*=.5;var b=Math.sin(_);p[0]=b*y[0],p[1]=b*y[1],p[2]=b*y[2],p[3]=Math.cos(_)}(c,Ji,Math.PI),c):d>.999999?(c[0]=0,c[1]=0,c[2]=0,c[3]=1,c):(ir(Ji,i,a),c[0]=Ji[0],c[1]=Ji[1],c[2]=Ji[2],c[3]=1+d,qa(c,c))});function fo(){var c=new w(2);return w!=Float32Array&&(c[0]=0,c[1]=0),c}function as(c,i){var a=new w(2);return a[0]=c,a[1]=i,a}function Ha(c,i,a){return c[0]=i,c[1]=a,c}function Wa(c,i,a){return c[0]=i[0]+a[0],c[1]=i[1]+a[1],c}function Tl(c,i,a){return c[0]=i[0]-a[0],c[1]=i[1]-a[1],c}function Ul(c,i,a){return c[0]=i[0]*a,c[1]=i[1]*a,c}function gc(c){var i=c[0],a=c[1];return Math.sqrt(i*i+a*a)}function yc(c,i){var a=i[0],d=i[1],p=a*a+d*d;return p>0&&(p=1/Math.sqrt(p)),c[0]=i[0]*p,c[1]=i[1]*p,c}function Mn(c,i){return c[0]*i[0]+c[1]*i[1]}wr(),wr(),C();var Mo,gn,si=Tl;function Wn(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}fo();var aa=function(){if(gn)return Mo;function c(i,a,d,p){this.cx=3*i,this.bx=3*(d-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=a,this.p2x=d,this.p2y=p}return gn=1,Mo=c,c.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,a){if(a===void 0&&(a=1e-6),i<0)return 0;if(i>1)return 1;for(var d=i,p=0;p<8;p++){var y=this.sampleCurveX(d)-i;if(Math.abs(y)<a)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var b=0,E=1;for(d=i,p=0;p<20&&(y=this.sampleCurveX(d),!(Math.abs(y-i)<a));p++)i>y?b=d:E=d,d=.5*(E-b)+b;return d},solve:function(i,a){return this.sampleCurveY(this.solveCurveX(i,a))}},Mo}(),ms=Wn(aa);function wt(c,i){this.x=c,this.y=i}function Cs(c,i){if(Array.isArray(c)){if(!Array.isArray(i)||c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(!Cs(c[a],i[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&i!==null){if(typeof i!="object"||Object.keys(c).length!==Object.keys(i).length)return!1;for(const a in c)if(!Cs(c[a],i[a]))return!1;return!0}return c===i}wt.prototype={clone(){return new wt(this.x,this.y)},add(c){return this.clone()._add(c)},sub(c){return this.clone()._sub(c)},multByPoint(c){return this.clone()._multByPoint(c)},divByPoint(c){return this.clone()._divByPoint(c)},mult(c){return this.clone()._mult(c)},div(c){return this.clone()._div(c)},rotate(c){return this.clone()._rotate(c)},rotateAround(c,i){return this.clone()._rotateAround(c,i)},matMult(c){return this.clone()._matMult(c)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(c){return this.x===c.x&&this.y===c.y},dist(c){return Math.sqrt(this.distSqr(c))},distSqr(c){const i=c.x-this.x,a=c.y-this.y;return i*i+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith(c){return this.angleWithSep(c.x,c.y)},angleWithSep(c,i){return Math.atan2(this.x*i-this.y*c,this.x*c+this.y*i)},_matMult(c){const i=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=i,this},_add(c){return this.x+=c.x,this.y+=c.y,this},_sub(c){return this.x-=c.x,this.y-=c.y,this},_mult(c){return this.x*=c,this.y*=c,this},_div(c){return this.x/=c,this.y/=c,this},_multByPoint(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint(c){return this.x/=c.x,this.y/=c.y,this},_unit(){return this._div(this.mag()),this},_perp(){const c=this.y;return this.y=this.x,this.x=-c,this},_rotate(c){const i=Math.cos(c),a=Math.sin(c),d=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=d,this},_rotateAround(c,i){const a=Math.cos(c),d=Math.sin(c),p=i.y+d*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-d*(this.y-i.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:wt},wt.convert=function(c){if(c instanceof wt)return c;if(Array.isArray(c))return new wt(+c[0],+c[1]);if(c.x!==void 0&&c.y!==void 0)return new wt(+c.x,+c.y);throw new Error("Expected [x, y] or {x, y} point format")};const la=Math.PI/180,Aa=180/Math.PI;function an(c){return c*la}function Be(c){return c*Aa}const se=[[0,0],[1,0],[1,1],[0,1]];function he(c){if(c<=0)return 0;if(c>=1)return 1;const i=c*c,a=i*c;return 4*(c<.5?a:3*(c-i)+a-.75)}function xe(c,i,a,d){const p=new ms(c,i,a,d);return function(y){return p.solve(y)}}const Le=xe(.25,.1,.25,1);function we(c,i,a){return Math.min(a,Math.max(i,c))}function je(c,i,a){return(a=we((a-c)/(i-c),0,1))*a*(3-2*a)}function Ye(c,i,a){const d=a-i,p=((c-i)%d+d)%d+i;return p===i?a:p}function ze(c,i,a){if(!c.length)return a(null,[]);let d=c.length;const p=new Array(c.length);let y=null;c.forEach((_,b)=>{i(_,(E,I)=>{E&&(y=E),p[b]=I,--d===0&&a(y,p)})})}let tt=1;function Tt(){return tt++}function xt(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log2(c)))}function qt(c,i){c.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function ar(c,i,a){const d={};for(const p in c)d[p]=i.call(this,c[p],p,c);return d}function pr(c,i,a){const d={};for(const p in c)i.call(this,c[p],p,c)&&(d[p]=c[p]);return d}function Or(c){return Array.isArray(c)?c.map(Or):typeof c=="object"&&c?ar(c,Or):c}function Br(c,i){for(let a=0;a<c.length;a++)if(i.indexOf(c[a])>=0)return!0;return!1}const Sr={};function vr(c){Sr[c]||(typeof console<"u"&&console.warn(c),Sr[c]=!0)}function Yn(c,i,a){return(a.y-c.y)*(i.x-c.x)>(i.y-c.y)*(a.x-c.x)}function no(c){let i=0;for(let a,d,p=0,y=c.length,_=y-1;p<y;_=p++)a=c[p],d=c[_],i+=(d.x-a.x)*(a.y+d.y);return i}function ki([c,i,a]){const d=an(i+90),p=an(a);return{x:c*Math.cos(d)*Math.sin(p),y:c*Math.sin(d)*Math.sin(p),z:c*Math.cos(p),azimuthal:i,polar:a}}function Ri(c){return(typeof self<"u"||c!==void 0)&&typeof WorkerGlobalScope<"u"&&(c!==void 0?c:self)instanceof WorkerGlobalScope}function ui(c){const i={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,p,y)=>{const _=p||y;return i[d]=!_||_.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let on=null;function pi(c,i){return[c[4*i],c[4*i+1],c[4*i+2],c[4*i+3]]}function Bn(c,i,a,d){for(;i<a;){const p=i+a>>1;c[p]<d?i=p+1:a=p}return i}function $n(c,i,a,d){for(;i<a;){const p=i+a>>1;c[p]<=d?i=p+1:a=p}return i}function Ai(c){return c>0?1/(1.001-c):1+c}function ls(c){return c>0?1-1/(1.001-c):-c}function Zo(c,i,a){return(c-i.min)*(a.max-a.min)/(i.max-i.min)+a.min}const po={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!po.API_URL)return null;try{const c=new URL(po.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ku(c){return po.API_URL_REGEX.test(c)}function Is(c){return po.API_SPRITE_REGEX.test(c)}let Pa,El,Gl,Ca,qs,ou;function Yd(){return Pa==null&&(Pa=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Pa}const Za={now:()=>Ca!==void 0?Ca:performance.now(),setNow(c){Ca=c},restoreNow(){Ca=void 0},frame(c){const i=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(i)}},getImageData(c,i=0){const{width:a,height:d}=c;qs||(qs=document.createElement("canvas"));const p=qs.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(a>qs.width||d>qs.height)&&(qs.width=a,qs.height=d),p.clearRect(-i,-i,a+2*i,d+2*i),p.drawImage(c,0,0,a,d),p.getImageData(-i,-i,a+2*i,d+2*i)},resolveURL:c=>(El||(El=document.createElement("a")),El.href=c,El.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Gl==null&&(Gl=window.matchMedia("(prefers-reduced-motion: reduce)")),Gl.matches)},hasCanvasFingerprintNoise(){if(ou!==void 0)return ou;if(!Yd())return ou=!1,!1;const c=new OffscreenCanvas(85,1),i=c.getContext("2d",{willReadFrequently:!0});let a=0;for(let p=0;p<c.width;++p)i.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,i.fillRect(p,0,1,1);const d=i.getImageData(0,0,c.width,c.height);a=0;for(let p=0;p<d.data.length;++p)if(p%4!=3&&a++!==d.data[p])return ou=!0,!0;return ou=!1,!1}};function um(c,i){const a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(i).toString()}`;const d=new URLSearchParams(c.slice(a));for(const p in i)d.set(p,i[p]);return`${c.slice(0,a)}?${d.toString()}`}function dm(c,i={persistentParams:[]}){const a=c.indexOf("?");if(a<0)return c;const d=new URLSearchParams,p=new URLSearchParams(c.slice(a));for(const _ of i.persistentParams){const b=p.get(_);b&&d.set(_,b)}const y=d.toString();return`${c.slice(0,a)}${y.length>0?`?${y}`:""}`}const dE="mapbox-tiles";let hE=500,Lx=50;const jx=["language","worldview","jobid"];let Xo,Xa;function su(){try{return caches}catch{}}function Ka(){const c=su();c&&Xo==null&&(Xo=c.open(dE))}let _c=1/0;const hf={supported:!1,testSupport:function(c){!Yu&&Jd&&(Ry?pE(c):ff=c)}};let ff,Jd,Yu=!1,Ry=!1;const fE=typeof self<"u"?self:{};function pE(c){const i=c.createTexture();c.bindTexture(c.TEXTURE_2D,i);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,Jd),c.isContextLost())return;hf.supported=!0}catch{}c.deleteTexture(i),Yu=!0}fE.document&&(Jd=fE.document.createElement("img"),Jd.onload=function(){ff&&pE(ff),ff=null,Ry=!0},Jd.onerror=function(){Yu=!0,ff=null},Jd.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ca={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ca);class hm extends Error{constructor(i,a,d){a===401&&Ku(d)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=d}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fm=Ri()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,au=function(c,i){if(!(/^file:/.test(a=c.url)||/^file:/.test(fm())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(d,p){const y=new AbortController,_=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:fm(),referrerPolicy:d.referrerPolicy,signal:y.signal});let b=!1,E=!1;const I=(M=_.url).indexOf("sku=")>0&&Ku(M);var M;d.type==="json"&&_.headers.set("Accept","application/json");const D=(V,G,Y)=>{if(E)return;if(V&&V.message!=="SecurityError"&&vr(V.toString()),G&&Y)return N(G);const re=Date.now();fetch(_).then(J=>{if(J.ok){const oe=I?J.clone():null;return N(J,oe,re)}return p(new hm(J.statusText,J.status,d.url))}).catch(J=>{J.name!=="AbortError"&&p(new Error(`${J.message} ${d.url}`))})},N=(V,G,Y)=>{(d.type==="arrayBuffer"?V.arrayBuffer():d.type==="json"?V.json():V.text()).then(re=>{E||(G&&Y&&function(J,oe,le){if(Ka(),Xo==null)return;const de=ui(oe.headers.get("Cache-Control")||"");if(de["no-store"])return;const _e={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((Ae,Se)=>_e.headers.set(Se,Ae)),de["max-age"]&&_e.headers.set("Expires",new Date(le+1e3*de["max-age"]).toUTCString());const ye=_e.headers.get("Expires");if(!ye||new Date(ye).getTime()-le<42e4)return;let Te=dm(J.url,{persistentParams:jx});if(oe.status===206){const Ae=J.headers.get("Range");if(!Ae)return;_e.status=200,Te=um(Te,{range:Ae})}(function(Ae,Se){if(Xa===void 0)try{new Response(new ReadableStream),Xa=!0}catch{Xa=!1}Xa?Se(Ae.body):Ae.blob().then(Se).catch(Oe=>vr(Oe.message))})(oe,Ae=>{const Se=new Response((Oe=oe.status)!==200&&Oe!==404&&[101,103,204,205,304].includes(Oe)?null:Ae,_e);var Oe;Ka(),Xo!=null&&Xo.then(Me=>Me.put(Te,Se)).catch(Me=>vr(Me.message))})}(_,G,Y),b=!0,p(null,re,V.headers))}).catch(re=>{E||p(new Error(re.message))})};return I?function(V,G){if(Ka(),Xo==null)return G(null);Xo.then(Y=>{let re=dm(V.url,{persistentParams:jx});const J=V.headers.get("Range");J&&(re=um(re,{range:J})),Y.match(re).then(oe=>{const le=function(de){if(!de)return!1;const _e=new Date(de.headers.get("Expires")||0),ye=ui(de.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!ye["no-cache"]}(oe);Y.delete(re).catch(G),le&&Y.put(re,oe.clone()).catch(G),G(null,oe,le)}).catch(G)}).catch(G)}(_,D):D(null,null),{cancel:()=>{E=!0,b||y.abort()}}}(c,i);if(Ri(self)&&self.worker.actor)return self.worker.actor.send("getResource",c,i,void 0,!0)}var a;return function(d,p){const y=new XMLHttpRequest;y.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const _ in d.headers)y.setRequestHeader(_,d.headers[_]);return d.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=d.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let _=y.response;if(d.type==="json")try{_=JSON.parse(y.response)}catch(E){return p(E)}const b=new Headers;y.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(E=>{const I=E.split(": "),M=I.shift(),D=I.join(": ");b.append(M,D)}),p(null,_,b)}else p(new hm(y.statusText,y.status,d.url))},y.send(d.body),{cancel:()=>y.abort()}}(c,i)},pm=function(c,i){return au(Object.assign(c,{type:"arrayBuffer"}),i)};function oR(c){const i=document.createElement("a");return i.href=c,i.protocol===location.protocol&&i.host===location.host}const Nx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cn,pf;cn=[],pf=0;const My=function(c,i){if(hf.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),pf>=po.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:c,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return cn.push(y),y}pf++;let a=!1;const d=()=>{if(!a)for(a=!0,pf--;cn.length&&pf<po.MAX_PARALLEL_IMAGE_REQUESTS;){const y=cn.shift(),{requestParameters:_,callback:b,cancelled:E}=y;E||(y.cancel=My(_,b).cancel)}},p=pm(c,(y,_,b)=>{d(),y?i(y):_&&(self.createImageBitmap?function(E,I){const M=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(M).then(D=>{I(null,D)}).catch(D=>{I(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(E,I)=>i(E,I,b)):function(E,I){const M=new Image;M.onload=()=>{I(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Nx})},M.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(E)],{type:"image/png"});M.src=E.byteLength?URL.createObjectURL(D):Nx}(_,(E,I)=>i(E,I,b)))});return{cancel:()=>{p.cancel(),d()}}};var mE,gE,mm,Ju={exports:{}},gm={exports:{}},Dy={exports:{}},sR=function(){if(mm)return Ju.exports;mm=1;var c=(mE||(mE=1,gm.exports=function(a,d){var p,y,_,b,E,I,M,D;for(y=a.length-(p=3&a.length),_=d,E=3432918353,I=461845907,D=0;D<y;)M=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,_=27492+(65535&(b=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+(((b>>>16)+58964&65535)<<16);switch(M=0,p){case 3:M^=(255&a.charCodeAt(D+2))<<16;case 2:M^=(255&a.charCodeAt(D+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&a.charCodeAt(D)))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*I+(((M>>>16)*I&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),gm.exports),i=(gE||(gE=1,Dy.exports=function(a,d){for(var p,y=a.length,_=d^y,b=0;y>=4;)p=1540483477*(65535&(p=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(p>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++b;switch(y){case 3:_^=(255&a.charCodeAt(b+2))<<16;case 2:_^=(255&a.charCodeAt(b+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(b)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Dy.exports);return Ju.exports=c,Ju.exports.murmur3=c,Ju.exports.murmur2=i,Ju.exports}(),mf=Wn(sR);class lu{constructor(i,...a){Object.assign(this,a[0]||{}),this.type=i}}class ym extends lu{constructor(i,a={}){super("error",Object.assign({error:i},a))}}function yE(c,i,a){a[c]&&a[c].indexOf(i)!==-1||(a[c]=a[c]||[],a[c].push(i))}function Qd(c,i,a){if(a&&a[c]){const d=a[c].indexOf(i);d!==-1&&a[c].splice(d,1)}}class cu{on(i,a){return this._listeners=this._listeners||{},yE(i,a,this._listeners),this}off(i,a){return Qd(i,a,this._listeners),Qd(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},yE(i,a,this._oneTimeListeners),this):new Promise(d=>{this.once(i,d)})}fire(i,a){const d=typeof i=="string"?new lu(i,a):i,p=d.type;if(this.listens(p)){d.target=this;const y=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of y)E.call(this,d);const _=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of _)Qd(p,E,this._oneTimeListeners),E.call(this,d);const b=this._eventedParent;if(b){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(d,E),b.fire(d)}}else d instanceof ym&&console.error(d.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}class ua{constructor(i){typeof i=="string"?this.name=i:(this.name=i.name,this.iconsetId=i.iconsetId)}static from(i){return new ua(i)}static toString(i){return i.iconsetId?`${i.name}${i.iconsetId}`:i.name}static parse(i){const[a,d]=i.split("");return new ua({name:a,iconsetId:d})}static isEqual(i,a){return i.name===a.name&&i.iconsetId===a.iconsetId}toString(){return ua.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Al,Ly={},_E=function(){if(Al)return Ly;Al=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(y){return(y=Math.round(y))<0?0:y>255?255:y}function a(y){return i(y[y.length-1]==="%"?parseFloat(y)/100*255:parseInt(y))}function d(y){return(_=y[y.length-1]==="%"?parseFloat(y)/100:parseFloat(y))<0?0:_>1?1:_;var _}function p(y,_,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?y+(_-y)*b*6:2*b<1?_:3*b<2?y+(_-y)*(2/3-b)*6:y}try{Ly.parseCSSColor=function(y){var _,b=y.replace(/ /g,"").toLowerCase();if(b in c)return c[b].slice();if(b[0]==="#")return b.length===4?(_=parseInt(b.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:b.length===7&&(_=parseInt(b.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var E=b.indexOf("("),I=b.indexOf(")");if(E!==-1&&I+1===b.length){var M=b.substr(0,E),D=b.substr(E+1,I-(E+1)).split(","),N=1;switch(M){case"rgba":if(D.length!==4)return null;N=d(D.pop());case"rgb":return D.length!==3?null:[a(D[0]),a(D[1]),a(D[2]),N];case"hsla":if(D.length!==4)return null;N=d(D.pop());case"hsl":if(D.length!==3)return null;var V=(parseFloat(D[0])%360+360)%360/360,G=d(D[1]),Y=d(D[2]),re=Y<=.5?Y*(G+1):Y+G-Y*G,J=2*Y-re;return[i(255*p(J,re,V+1/3)),i(255*p(J,re,V)),i(255*p(J,re,V-1/3)),N];default:return null}}return null}}catch{}return Ly}();class En{constructor(i,a,d,p=1){this.r=i,this.g=a,this.b=d,this.a=p}static parse(i){if(!i)return;if(i instanceof En)return i;if(typeof i!="string")return;const a=_E.parseCSSColor(i);return a?new En(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[i,a,d,p]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*i)},${Math.round(255*a)},${Math.round(255*d)},${p})`}toNonPremultipliedRenderColor(i){const{r:a,g:d,b:p,a:y}=this;return new vE(i,a,d,p,y)}toPremultipliedRenderColor(i){const{r:a,g:d,b:p,a:y}=this;return new xE(i,a*y,d*y,p*y,y)}clone(){return new En(this.r,this.g,this.b,this.a)}}class zx{constructor(i,a,d,p,y,_=!1){if(this.premultiplied=!1,this.premultiplied=_,i){const b=i.image.height,E=b*b;this.premultiplied?(a=y===0?0:a/y*(b-1),d=y===0?0:d/y*(b-1),p=y===0?0:p/y*(b-1)):(a*=b-1,d*=b-1,p*=b-1);const I=Math.floor(a),M=Math.floor(d),D=Math.floor(p),N=Math.ceil(a),V=Math.ceil(d),G=Math.ceil(p),Y=a-I,re=d-M,J=p-D,oe=i.image.data,le=4*(I+M*E+D*b),de=4*(I+M*E+G*b),_e=4*(I+V*E+D*b),ye=4*(I+V*E+G*b),Te=4*(N+M*E+D*b),Ae=4*(N+M*E+G*b),Se=4*(N+V*E+D*b),Oe=4*(N+V*E+G*b);if(le<0||Oe>=oe.length)throw new Error("out of range");this.r=mr(mr(mr(oe[le],oe[de],J),mr(oe[_e],oe[ye],J),re),mr(mr(oe[Te],oe[Ae],J),mr(oe[Se],oe[Oe],J),re),Y)/255*(this.premultiplied?y:1),this.g=mr(mr(mr(oe[le+1],oe[de+1],J),mr(oe[_e+1],oe[ye+1],J),re),mr(mr(oe[Te+1],oe[Ae+1],J),mr(oe[Se+1],oe[Oe+1],J),re),Y)/255*(this.premultiplied?y:1),this.b=mr(mr(mr(oe[le+2],oe[de+2],J),mr(oe[_e+2],oe[ye+2],J),re),mr(mr(oe[Te+2],oe[Ae+2],J),mr(oe[Se+2],oe[Oe+2],J),re),Y)/255*(this.premultiplied?y:1),this.a=y}else this.r=a,this.g=d,this.b=p,this.a=y}toArray(){const{r:i,g:a,b:d,a:p}=this;return[255*i,255*a,255*d,p]}toHslaArray(){let{r:i,g:a,b:d,a:p}=this;if(this.premultiplied){if(p===0)return[0,0,0,0];const G=1/p;i*=G,a*=G,d*=G}const y=Math.min(Math.max(i,0),1),_=Math.min(Math.max(a,0),1),b=Math.min(Math.max(d,0),1),E=Math.min(y,_,b),I=Math.max(y,_,b),M=I-E,D=.5*(E+I);if(M===0)return[0,0,100*D,p];const N=D>.5?M/(2-I-E):M/(I+E);let V;switch(I){case y:V=60*((_-b)/M+(_<b?6:0));break;case _:V=60*((b-y)/M+2);break;default:V=60*((y-_)/M+4)}return[V,100*N,100*D,p]}toArray01(){const{r:i,g:a,b:d,a:p}=this;return[i,a,d,p]}toArray01Scaled(i){const{r:a,g:d,b:p}=this;return[a*i,d*i,p*i]}toArray01Linear(){const{r:i,g:a,b:d,a:p}=this;return[Math.pow(i,2.2),Math.pow(a,2.2),Math.pow(d,2.2),p]}}class vE extends zx{constructor(i,a,d,p,y){super(i,a,d,p,y,!1)}}class xE extends zx{constructor(i,a,d,p,y){super(i,a,d,p,y,!0)}}function mr(c,i,a){return c*(1-a)+i*a}function Fx(c,i,a){return c.map((d,p)=>mr(d,i[p],a))}En.black=new En(0,0,0,1),En.white=new En(1,1,1,1),En.transparent=new En(0,0,0,0),En.red=new En(1,0,0,1),En.blue=new En(0,0,1,1);var eh=Object.freeze({__proto__:null,array:Fx,color:function(c,i,a){return new En(mr(c.r,i.r,a),mr(c.g,i.g,a),mr(c.b,i.b,a),mr(c.a,i.a,a))},number:mr});class Hs extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}class jy{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[d,p]of a)this.bindings[d]=p}concat(i){return new jy(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const da={kind:"null"},tr={kind:"number"},Sn={kind:"string"},pn={kind:"boolean"},Ws={kind:"color"},gf={kind:"object"},Cn={kind:"value"},Ny={kind:"collator"},yf={kind:"formatted"},th={kind:"resolvedImage"};function Os(c,i){return{kind:"array",itemType:c,N:i}}function Vi(c){if(c.kind==="array"){const i=Vi(c.itemType);return typeof c.N=="number"?`array<${i}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${i}>`}return c.kind}const aR=[da,tr,Sn,pn,Ws,yf,gf,Os(Cn),th];function _m(c,i){if(i.kind==="error")return null;if(c.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!_m(c.itemType,i.itemType))&&(typeof c.N!="number"||c.N===i.N))return null}else{if(c.kind===i.kind)return null;if(c.kind==="value"){for(const a of aR)if(!_m(a,i))return null}}return`Expected ${Vi(c)} but found ${Vi(i)} instead.`}function Bx(c,i){return i.some(a=>a.kind===c.kind)}function vm(c,i){return i.some(a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c)}function zy(c,i){return c.kind==="array"&&i.kind==="array"?c.N===i.N&&zy(c.itemType,i.itemType):c.kind===i.kind}class $x{constructor(i,a,d){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fy{constructor(i,a,d,p,y){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=d,this.fontStack=p,this.textColor=y}}class ks{constructor(i){this.sections=i}static fromString(i){return new ks([new Fy(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||!!i.image&&i.image.hasPrimary())}static factory(i){return i instanceof ks?i:ks.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){const p=a.image.getPrimary().id.toString();i.push(["image",p]);continue}i.push(a.text);const d={};a.fontStack&&(d["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(d["font-scale"]=a.scale),a.textColor&&(d["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),i.push(d)}return i}}class ha{constructor(i,a={}){this.id=ua.from(i),this.params=a.params,this.sx=a.sx||1,this.sy=a.sy||1}toString(){return JSON.stringify(this)}static parse(i){let a,d,p,y;try{({id:a,params:d,sx:p,sy:y}=JSON.parse(i)||{})}catch{return null}return a?new ha(a,{params:d,sx:p,sy:y}):null}scaleSelf(i,a=i){return this.sx*=i,this.sy*=a,this}}class fa{constructor(i,a,d,p,y=!1){this.primaryId=ua.from(i),this.primaryOptions=a,d&&(this.secondaryId=ua.from(d)),this.secondaryOptions=p,this.available=y}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ha(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ha(this.secondaryId,this.secondaryOptions):null}static from(i){return typeof i=="string"?fa.build({name:i}):i}static build(i,a,d,p){return!i||typeof i=="object"&&!("name"in i)?null:new fa(i,d,a,p)}}function Vx(c,i,a,d){return typeof c=="number"&&c>=0&&c<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[c,i,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[c,i,a,d]:[c,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Qu(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof En||c instanceof $x||c instanceof ks||c instanceof fa)return!0;if(Array.isArray(c)){for(const i of c)if(!Qu(i))return!1;return!0}if(typeof c=="object"){for(const i in c)if(!Qu(c[i]))return!1;return!0}return!1}function Co(c){if(c===null)return da;if(typeof c=="string")return Sn;if(typeof c=="boolean")return pn;if(typeof c=="number")return tr;if(c instanceof En)return Ws;if(c instanceof $x)return Ny;if(c instanceof ks)return yf;if(c instanceof fa)return th;if(Array.isArray(c)){const i=c.length;let a;for(const d of c){const p=Co(d);if(a){if(a===p)continue;a=Cn;break}a=p}return Os(a||Cn,i)}return gf}function vc(c){const i=typeof c;return c===null?"":i==="string"||i==="number"||i==="boolean"?String(c):c instanceof ks||c instanceof fa||c instanceof En?c.toString():JSON.stringify(c)}class uu{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(i.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Qu(i[1]))return a.error("invalid value");const d=i[1];let p=Co(d);const y=a.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new uu(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof En?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ks?this.value.serialize():this.value}}class mo{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ed={string:Sn,number:tr,boolean:pn,object:gf};class Er{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let d,p=1;const y=i[0];if(y==="array"){let b,E;if(i.length>2){const I=i[1];if(typeof I!="string"||!(I in ed)||I==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=ed[I],p++}else b=Cn;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=i[2],p++}d=Os(b,E)}else d=ed[y];const _=[];for(;p<i.length;p++){const b=a.parse(i[p],p,Cn);if(!b)return null;_.push(b)}return new Er(d,_)}evaluate(i){for(let a=0;a<this.args.length;a++){const d=this.args[a].evaluate(i);if(!_m(this.type,Co(d)))return d;if(a===this.args.length-1)throw new mo(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Vi(Co(d))} but was expected to be of type ${Vi(this.type)}.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if(i.kind==="array"){const d=i.itemType;if(d.kind==="string"||d.kind==="number"||d.kind==="boolean"){a.push(d.kind);const p=i.N;(typeof p=="number"||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(d=>d.serialize()))}}class Qt{constructor(i){this.type=yf,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");const p=[];let y=!1;for(let _=1;_<=i.length-1;++_){const b=i[_];if(y&&typeof b=="object"&&!Array.isArray(b)){y=!1;let E=null;if(b["font-scale"]&&(E=a.parseObjectValue(b["font-scale"],_,"font-scale",tr),!E))return null;let I=null;if(b["text-font"]&&(I=a.parseObjectValue(b["text-font"],_,"text-font",Os(Sn)),!I))return null;let M=null;if(b["text-color"]&&(M=a.parseObjectValue(b["text-color"],_,"text-color",Ws),!M))return null;const D=p[p.length-1];D.scale=E,D.font=I,D.textColor=M}else{const E=a.parse(i[_],_,Cn);if(!E)return null;const I=E.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:E,scale:null,font:null,textColor:null})}}return new Qt(p)}evaluate(i){return new ks(this.sections.map(a=>{const d=a.content.evaluate(i);return zy(Co(d),th)?new Fy("",d,null,null,null):new Fy(vc(d),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const d={};a.scale&&(d["font-scale"]=a.scale.serialize()),a.font&&(d["text-font"]=a.font.serialize()),a.textColor&&(d["text-color"]=a.textColor.serialize()),i.push(d)}return i}}class _f{constructor(i,a,d,p){this._imageWarnHistory={},this.type=th,this.namePrimary=i,this.nameSecondary=a,d&&(this.paramsPrimary=d.params,this.iconsetIdPrimary=d.iconset?d.iconset.id:void 0),p&&(this.paramsSecondary=p.params,this.iconsetIdSecondary=p.iconset?p.iconset.id:void 0)}static parse(i,a){if(i.length<2)return a.error("Expected two or more arguments.");let d=1;const p=[];function y(){if(d<i.length){const b=a.parse(i[d],d++,Sn);return b?(p.push({image:b,options:{}}),!0):(a.error(p.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(d<i.length){const E=i[d];if((b=E)===null||typeof b!="object"||Array.isArray(b))return!0;const I=E.params,M=E.iconset,D=a.concat(d);if(!I&&!M)return d++,!0;if(I){if(typeof I!="object"||I.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const N={},V=D.concat(void 0,"params");for(const G in I){if(!G)return V.error("Image parameter name should be non-empty"),!1;const Y=V.concat(void 0,G).parse(I[G],void 0,Ws,void 0,{typeAnnotation:"coerce"});if(!Y)return!1;N[G]=Y}p[p.length-1].options.params=N}if(M){if(typeof M!="object"||M.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!M.id)return D.error('Image options "iconset" should have an "id" property'),!1;p[p.length-1].options.iconset=M}return d++,!0}var b;return!0}for(let b=0;b<2;b++)if(!y()||!_())return;return new _f(p[0].image,p[1]?p[1].image:void 0,p[0].options,p[1]?p[1].options:void 0)}evaluateParams(i,a){const d={};if(a){for(const p in a)if(a[p])try{d[p]=a[p].evaluate(i)}catch{continue}if(Object.keys(d).length!==0)return{params:d}}}evaluate(i){const a={name:this.namePrimary.evaluate(i),iconsetId:this.iconsetIdPrimary},d=this.nameSecondary?{name:this.nameSecondary.evaluate(i),iconsetId:this.iconsetIdSecondary}:void 0,p=fa.build(a,d,this.paramsPrimary?this.evaluateParams(i,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(i,this.paramsSecondary):void 0);if(p&&i.availableImages){const y=p.getPrimary().id;if(p.available=i.availableImages.some(_=>ua.isEqual(_,y)),p.available){const _=p.getSecondary()?p.getSecondary().id:null;_&&(p.available=i.availableImages.some(b=>ua.isEqual(b,_)))}}return p}eachChild(i){if(i(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&i(this.paramsPrimary[a]);if(this.nameSecondary&&(i(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&i(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(i,a){const d={};if(a&&(d.iconset={id:a}),i){d.params={};for(const p in i)i[p]&&(d.params[p]=i[p].serialize())}return Object.keys(d).length>0?d:void 0}serialize(){const i=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&i.push(a)}if(this.nameSecondary&&(i.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&i.push(a)}return i}}function xr(c){return xm(c)?"string":gr(c)?"number":Ux(c)?"boolean":Array.isArray(c)?"array":c===null?"null":By(c)?"object":typeof c}function By(c){return c!=null&&!Array.isArray(c)&&typeof c!="function"&&!(c instanceof String||c instanceof Number||c instanceof Boolean)&&typeof c=="object"}function xm(c){return typeof c=="string"||c instanceof String}function gr(c){return typeof c=="number"||c instanceof Number}function Ux(c){return typeof c=="boolean"||c instanceof Boolean}const Gx={"to-boolean":pn,"to-color":Ws,"to-number":tr,"to-string":Sn};class xc{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const d=i[0],p=[];let y=da;if(d==="to-array"){if(!Array.isArray(i[1]))return null;const _=i[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);y=Os(a.expectedType.itemType,_)}else{if(!(_>0&&Qu(i[1][0])))return null;y=Os(Co(i[1][0]),_)}for(let b=0;b<_;b++){const E=i[1][b];let I;if(Array.isArray(E))I=a.parse(E,void 0,y.itemType);else{const M=xr(E);if(M!==y.itemType.kind)return a.error(`Expected ${y.itemType.kind} but found ${M}.`);I=a.registry.literal.parse(["literal",E===void 0?null:E],a)}if(!I)return null;p.push(I)}}else{if((d==="to-boolean"||d==="to-string")&&i.length!==2)return a.error("Expected one argument.");y=Gx[d];for(let _=1;_<i.length;_++){const b=a.parse(i[_],_,Cn);if(!b)return null;p.push(b)}}return new xc(y,p)}evaluate(i){if(this.type.kind==="boolean")return!!this.args[0].evaluate(i);if(this.type.kind==="color"){let a,d;for(const p of this.args){if(a=p.evaluate(i),d=null,a instanceof En)return a;if(typeof a=="string"){const y=i.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Vx(a[0],a[1],a[2],a[3]),!d))return new En(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new mo(d||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const d of this.args){if(a=d.evaluate(i),a===null)return 0;const p=Number(a);if(!isNaN(p))return p}throw new mo(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?ks.fromString(vc(this.args[0].evaluate(i))):this.type.kind==="resolvedImage"?fa.build(vc(this.args[0].evaluate(i))):this.type.kind==="array"?this.args.map(a=>a.evaluate(i)):vc(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Qt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new _f(this.args[0]).serialize();const i=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}const bE=["Unknown","Point","LineString","Polygon"];class vf{constructor(i,a,d){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=i,this.options=a,this.iconImageUseTheme=d}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bE[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(i){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:d,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(d*a-i[0])+this.featureDistanceData.bearing[1]*(p*a-i[1])}return 0}parseColor(i){let a=this._parseColorCache[i];return a||(a=this._parseColorCache[i]=En.parse(i)),a}getConfig(i){return this.options?this.options.get(i):null}}class pa{constructor(i,a,d,p,y){this.name=i,this.type=a,this._evaluate=d,this.args=p,this._overloadIndex=y}evaluate(i){if(!this._evaluate){const a=pa.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const d=i[0],p=pa.definitions[d];if(!p)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,b=[];let E=null,I=-1;for(const[M,D]of _){if(Array.isArray(M)&&M.length!==i.length-1)continue;b.push(M),I++,E=new Ky(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const N=[];let V=!1;for(let G=1;G<i.length;G++){const Y=i[G],re=Array.isArray(M)?M[G-1]:M.type,J=E.parse(Y,1+N.length,re);if(!J){V=!0;break}N.push(J)}if(!V)if(Array.isArray(M)&&M.length!==N.length)E.error(`Expected ${M.length} arguments, but found ${N.length} instead.`);else{for(let G=0;G<N.length;G++){const Y=Array.isArray(M)?M[G]:M.type,re=N[G];E.concat(G+1).checkSubtype(Y,re.type)}if(E.errors.length===0)return new pa(d,y,D,N,I)}}if(b.length===1)a.errors.push(...E.errors);else{const M=(b.length?b:_.map(([N])=>N)).map(qx).join(" | "),D=[];for(let N=1;N<i.length;N++){const V=a.parse(i[N],1+D.length);if(!V)return null;D.push(Vi(V.type))}a.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(i,a){pa.definitions=a;for(const d in a)i[d]=pa}}function qx(c){return Array.isArray(c)?`(${c.map(Vi).join(", ")})`:`(${Vi(c.type)}...)`}class bc{constructor(i,a,d){this.type=Ny,this.locale=d,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(i.length!==2)return a.error("Expected one argument.");const d=i[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");const p=d["case-sensitive"]===void 0?a.parse(!1,1,pn):a.parseObjectValue(d["case-sensitive"],1,"case-sensitive",pn);if(!p)return null;const y=d["diacritic-sensitive"]===void 0?a.parse(!1,1,pn):a.parseObjectValue(d["diacritic-sensitive"],1,"diacritic-sensitive",pn);if(!y)return null;let _=null;return d.locale&&(_=a.parseObjectValue(d.locale,1,"locale",Sn),!_)?null:new bc(p,y,_)}evaluate(i){return new $x(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}function $y(c,i,a=0,d=c.length-1,p=td){for(;d>a;){if(d-a>600){const E=d-a+1,I=i-a+1,M=Math.log(E),D=.5*Math.exp(2*M/3),N=.5*Math.sqrt(M*D*(E-D)/E)*(I-E/2<0?-1:1);$y(c,i,Math.max(a,Math.floor(i-I*D/E+N)),Math.min(d,Math.floor(i+(E-I)*D/E+N)),p)}const y=c[i];let _=a,b=d;for(Pl(c,a,i),p(c[d],y)>0&&Pl(c,a,d);_<b;){for(Pl(c,_,b),_++,b--;p(c[_],y)<0;)_++;for(;p(c[b],y)>0;)b--}p(c[a],y)===0?Pl(c,a,b):(b++,Pl(c,b,d)),b<=i&&(a=b+1),i<=b&&(d=b-1)}}function Pl(c,i,a){const d=c[i];c[i]=c[a],c[a]=d}function td(c,i){return c<i?-1:c>i?1:0}function lR(c){let i=0;for(let a,d,p=0,y=c.length,_=y-1;p<y;_=p++)a=c[p],d=c[_],i+=(d.x-a.x)*(a.y+d.y);return i}function bm(c,i){c[0]=Math.min(c[0],i[0]),c[1]=Math.min(c[1],i[1]),c[2]=Math.max(c[2],i[0]),c[3]=Math.max(c[3],i[1])}function wm(c,i){return!(c[0]<=i[0]||c[2]>=i[2]||c[1]<=i[1]||c[3]>=i[3])}function Vy(c,i,a){const d=c[0]-i[0],p=c[1]-i[1],y=c[0]-a[0],_=c[1]-a[1];return d*_-y*p===0&&d*y<=0&&p*_<=0}function wE(c,i,a){return i[1]>c[1]!=a[1]>c[1]&&c[0]<(a[0]-i[0])*(c[1]-i[1])/(a[1]-i[1])+i[0]}function Cl(c,i,a=!1){let d=!1;for(let p=0,y=i.length;p<y;p++){const _=i[p];for(let b=0,E=_.length,I=E-1;b<E;I=b++){const M=_[I],D=_[b];if(Vy(c,M,D))return a;wE(c,M,D)&&(d=!d)}}return d}function SE(c,i,a,d){const p=d[0]-a[0],y=d[1]-a[1],_=(c[0]-a[0])*y-p*(c[1]-a[1]),b=(i[0]-a[0])*y-p*(i[1]-a[1]);return _>0&&b<0||_<0&&b>0}function Uy(c,i,a,d){return(p=[d[0]-a[0],d[1]-a[1]])[0]*(y=[i[0]-c[0],i[1]-c[1]])[1]-p[1]*y[0]!==0&&!(!SE(c,i,a,d)||!SE(a,d,c,i));var p,y}function Sm(c){const i=new wt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new wt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const d of c[0])i.x>d.x&&(i.x=d.x),i.y>d.y&&(i.y=d.y),a.x<d.x&&(a.x=d.x),a.y<d.y&&(a.y=d.y);return{min:i,max:a}}const rd=8192;function cR(c,i){const a=(180+c[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,p=Math.pow(2,i.z);return[Math.round(a*p*rd),Math.round(d*p*rd)]}function TE(c,i){for(let a=0;a<i.length;a++)if(Cl(c,i[a]))return!0;return!1}function uR(c,i,a){for(const d of a)for(let p=0,y=d.length,_=y-1;p<y;_=p++)if(Uy(c,i,d[_],d[p]))return!0;return!1}function Hx(c,i){for(let a=0;a<c.length;++a)if(!Cl(c[a],i))return!1;for(let a=0;a<c.length-1;++a)if(uR(c[a],c[a+1],i))return!1;return!0}function dR(c,i){for(let a=0;a<i.length;a++)if(Hx(c,i[a]))return!0;return!1}function du(c,i,a){const d=[];for(let p=0;p<c.length;p++){const y=[];for(let _=0;_<c[p].length;_++){const b=cR(c[p][_],a);bm(i,b),y.push(b)}d.push(y)}return d}function EE(c,i,a){const d=[];for(let p=0;p<c.length;p++){const y=du(c[p],i,a);d.push(y)}return d}function AE(c,i,a,d){if(c[0]<a[0]||c[0]>a[2]){const p=.5*d;let y=c[0]-a[0]>p?-d:a[0]-c[0]>p?d:0;y===0&&(y=c[0]-a[2]>p?-d:a[2]-c[0]>p?d:0),c[0]+=y}bm(i,c)}function Gy(c,i,a,d){const p=Math.pow(2,d.z)*rd,y=[d.x*rd,d.y*rd],_=[];if(!c)return _;for(const b of c)for(const E of b){const I=[E.x+y[0],E.y+y[1]];AE(I,i,a,p),_.push(I)}return _}function Wx(c,i,a,d){const p=Math.pow(2,d.z)*rd,y=[d.x*rd,d.y*rd],_=[];if(!c)return _;for(const E of c){const I=[];for(const M of E){const D=[M.x+y[0],M.y+y[1]];bm(i,D),I.push(D)}_.push(I)}if(i[2]-i[0]<=p/2){(b=i)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of _)for(const I of E)AE(I,i,a,p)}var b;return _}class nd{constructor(i,a){this.type=pn,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Qu(i[1])){const d=i[1];if(d.type==="FeatureCollection")for(let p=0;p<d.features.length;++p){const y=d.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new nd(d,d.features[p].geometry)}else if(d.type==="Feature"){const p=d.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new nd(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new nd(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(a,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const b=du(d.coordinates,y,_),E=Gy(a.geometry(),p,y,_);if(!wm(p,y))return!1;for(const I of E)if(!Cl(I,b))return!1}if(d.type==="MultiPolygon"){const b=EE(d.coordinates,y,_),E=Gy(a.geometry(),p,y,_);if(!wm(p,y))return!1;for(const I of E)if(!TE(I,b))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(a,d){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if(d.type==="Polygon"){const b=du(d.coordinates,y,_),E=Wx(a.geometry(),p,y,_);if(!wm(p,y))return!1;for(const I of E)if(!Hx(I,b))return!1}if(d.type==="MultiPolygon"){const b=EE(d.coordinates,y,_),E=Wx(a.geometry(),p,y,_);if(!wm(p,y))return!1;for(const I of E)if(!dR(I,b))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ia={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zx=1/298.257223563,Xx=Zx*(2-Zx),xf=Math.PI/180;class bf{static fromTile(i,a,d){const p=Math.PI*(1-2*(i+.5)/Math.pow(2,a)),y=Math.atan(.5*(Math.exp(p)-Math.exp(-p)))/xf;return new bf(y,d)}static get units(){return Ia}constructor(i,a){if(i===void 0)throw new Error("No latitude given.");if(a&&!Ia[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Ia).join(", ")}`);const d=6378.137*xf*(a?Ia[a]:1),p=Math.cos(i*xf),y=1/(1-Xx*(1-p*p)),_=Math.sqrt(y);this.kx=d*_*p,this.ky=d*_*y*(1-Xx)}distance(i,a){const d=Ya(i[0]-a[0])*this.kx,p=(i[1]-a[1])*this.ky;return Math.sqrt(d*d+p*p)}bearing(i,a){const d=Ya(a[0]-i[0])*this.kx;return Math.atan2(d,(a[1]-i[1])*this.ky)/xf}destination(i,a,d){const p=d*xf;return this.offset(i,Math.sin(p)*a,Math.cos(p)*a)}offset(i,a,d){return[i[0]+a/this.kx,i[1]+d/this.ky]}lineDistance(i){let a=0;for(let d=0;d<i.length-1;d++)a+=this.distance(i[d],i[d+1]);return a}area(i){let a=0;for(let d=0;d<i.length;d++){const p=i[d];for(let y=0,_=p.length,b=_-1;y<_;b=y++)a+=Ya(p[y][0]-p[b][0])*(p[y][1]+p[b][1])*(d?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(i,a){let d=0;if(a<=0)return i[0];for(let p=0;p<i.length-1;p++){const y=i[p],_=i[p+1],b=this.distance(y,_);if(d+=b,d>a)return qy(y,_,(a-(d-b))/b)}return i[i.length-1]}pointToSegmentDistance(i,a,d){let[p,y]=a,_=Ya(d[0]-p)*this.kx,b=(d[1]-y)*this.ky;if(_!==0||b!==0){const E=(Ya(i[0]-p)*this.kx*_+(i[1]-y)*this.ky*b)/(_*_+b*b);E>1?(p=d[0],y=d[1]):E>0&&(p+=_/this.kx*E,y+=b/this.ky*E)}return _=Ya(i[0]-p)*this.kx,b=(i[1]-y)*this.ky,Math.sqrt(_*_+b*b)}pointOnLine(i,a){let d=1/0,p=i[0][0],y=i[0][1],_=0,b=0;for(let E=0;E<i.length-1;E++){let I=i[E][0],M=i[E][1],D=Ya(i[E+1][0]-I)*this.kx,N=(i[E+1][1]-M)*this.ky,V=0;D===0&&N===0||(V=(Ya(a[0]-I)*this.kx*D+(a[1]-M)*this.ky*N)/(D*D+N*N),V>1?(I=i[E+1][0],M=i[E+1][1]):V>0&&(I+=D/this.kx*V,M+=N/this.ky*V)),D=Ya(a[0]-I)*this.kx,N=(a[1]-M)*this.ky;const G=D*D+N*N;G<d&&(d=G,p=I,y=M,_=E,b=V)}return{point:[p,y],index:_,t:Math.max(0,Math.min(1,b))}}lineSlice(i,a,d){let p=this.pointOnLine(d,i),y=this.pointOnLine(d,a);if(p.index>y.index||p.index===y.index&&p.t>y.t){const I=p;p=y,y=I}const _=[p.point],b=p.index+1,E=y.index;!Kx(d[b],_[0])&&b<=E&&_.push(d[b]);for(let I=b+1;I<=E;I++)_.push(d[I]);return Kx(d[E],y.point)||_.push(y.point),_}lineSliceAlong(i,a,d){let p=0;const y=[];for(let _=0;_<d.length-1;_++){const b=d[_],E=d[_+1],I=this.distance(b,E);if(p+=I,p>i&&y.length===0&&y.push(qy(b,E,(i-(p-I))/I)),p>=a)return y.push(qy(b,E,(a-(p-I))/I)),y;p>i&&y.push(E)}return y}bufferPoint(i,a){const d=a/this.ky,p=a/this.kx;return[i[0]-p,i[1]-d,i[0]+p,i[1]+d]}bufferBBox(i,a){const d=a/this.ky,p=a/this.kx;return[i[0]-p,i[1]-d,i[2]+p,i[3]+d]}insideBBox(i,a){return Ya(i[0]-a[0])>=0&&Ya(i[0]-a[2])<=0&&i[1]>=a[1]&&i[1]<=a[3]}}function Kx(c,i){return c[0]===i[0]&&c[1]===i[1]}function qy(c,i,a){const d=Ya(i[0]-c[0]);return[c[0]+d*a,c[1]+(i[1]-c[1])*a]}function Ya(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class Tm{constructor(i=[],a=(d,p)=>d<p?-1:d>p?1:0){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:d}=this,p=a[i];for(;i>0;){const y=i-1>>1,_=a[y];if(d(p,_)>=0)break;a[i]=_,i=y}a[i]=p}_down(i){const{data:a,compare:d}=this,p=this.length>>1,y=a[i];for(;i<p;){let _=1+(i<<1);const b=_+1;if(b<this.length&&d(a[b],a[_])<0&&(_=b),d(a[_],y)>=0)break;a[i]=a[_],i=_}a[i]=y}}var Mt=8192;function Yx(c,i){return i.dist-c.dist}function Jx(c){const i=[1/0,1/0,-1/0,-1/0];if(i.length!==c.length)return!1;for(let a=0;a<i.length;a++)if(i[a]!==c[a])return!1;return!0}function Em(c){return c[1]-c[0]+1}function wc(c,i){const a=c[1]>=c[0]&&c[1]<i;return a||console.warn("Distance Expression: Index is out of range"),a}function Qx(c,i){if(c[0]>c[1])return[null,null];const a=Em(c);if(i){if(a===2)return[c,null];const d=Math.floor(a/2);return[[c[0],c[0]+d],[c[0]+d,c[1]]]}{if(a===1)return[c,null];const d=Math.floor(a/2)-1;return[[c[0],c[0]+d],[c[0]+d+1,c[1]]]}}function rh(c,i){const a=[1/0,1/0,-1/0,-1/0];if(!wc(i,c.length))return a;for(let d=i[0];d<=i[1];++d)bm(a,c[d]);return a}function nh(c){const i=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let d=0;d<c[a].length;++d)bm(i,c[a][d]);return i}function id(c,i,a){if(Jx(c)||Jx(i))return NaN;let d=0,p=0;return c[2]<i[0]&&(d=i[0]-c[2]),c[0]>i[2]&&(d=c[0]-i[2]),c[1]>i[3]&&(p=c[1]-i[3]),c[3]<i[1]&&(p=i[1]-c[3]),a.distance([0,0],[d,p])}function Hy(c){return 360*c-180}function PE(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function Wy(c,i){const a=Math.pow(2,i.z),d=(c.y/Mt+i.y)/a;return[Hy((c.x/Mt+i.x)/a),PE(d)]}function hR(c,i){const a=[];for(let d=0;d<c.length;++d)a.push(Wy(c[d],i));return a}function CE(c,i,a){const d=a.pointOnLine(i,c).point;return a.distance(c,d)}function eb(c,i,a,d,p){const y=a.slice(d[0],d[1]+1);let _=1/0;for(let b=i[0];b<=i[1];++b)if((_=Math.min(_,CE(c[b],y,p)))===0)return 0;return _}function od(c,i,a,d,p){const y=Math.min(p.pointToSegmentDistance(c,a,d),p.pointToSegmentDistance(i,a,d)),_=Math.min(p.pointToSegmentDistance(a,c,i),p.pointToSegmentDistance(d,c,i));return Math.min(y,_)}function rn(c,i,a,d,p){if(!wc(i,c.length)||!wc(d,a.length))return NaN;let y=1/0;for(let _=i[0];_<i[1];++_)for(let b=d[0];b<d[1];++b){if(Uy(c[_],c[_+1],a[b],a[b+1]))return 0;y=Math.min(y,od(c[_],c[_+1],a[b],a[b+1],p))}return y}function fR(c,i,a,d,p){if(!wc(i,c.length)||!wc(d,a.length))return NaN;let y=1/0;for(let _=i[0];_<=i[1];++_)for(let b=d[0];b<=d[1];++b)if((y=Math.min(y,p.distance(c[_],a[b])))===0)return y;return y}function pR(c,i,a){if(Cl(c,i,!0))return 0;let d=1/0;for(const p of i){const y=p.length;if(y<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(p[0]!==p[y-1]&&(d=Math.min(d,a.pointToSegmentDistance(c,p[y-1],p[0])))===0||(d=Math.min(d,CE(c,p,a)))===0)return d}return d}function mR(c,i,a,d){if(!wc(i,c.length))return NaN;for(let y=i[0];y<=i[1];++y)if(Cl(c[y],a,!0))return 0;let p=1/0;for(let y=i[0];y<i[1];++y)for(const _ of a)for(let b=0,E=_.length,I=E-1;b<E;I=b++){if(Uy(c[y],c[y+1],_[I],_[b]))return 0;p=Math.min(p,od(c[y],c[y+1],_[I],_[b],d))}return p}function tb(c,i){for(const a of c)for(let d=0;d<=a.length-1;++d)if(Cl(a[d],i,!0))return!0;return!1}function gR(c,i,a,d=1/0){const p=nh(c),y=nh(i);if(d!==1/0&&id(p,y,a)>=d)return d;if(wm(p,y)){if(tb(c,i))return 0}else if(tb(i,c))return 0;let _=d;for(const b of c)for(let E=0,I=b.length,M=I-1;E<I;M=E++)for(const D of i)for(let N=0,V=D.length,G=V-1;N<V;G=N++){if(Uy(b[M],b[E],D[G],D[N]))return 0;_=Math.min(_,od(b[M],b[E],D[G],D[N],a))}return _}function ai(c,i,a,d,p,y,_){if(y===null||_===null)return;const b=id(rh(d,y),rh(p,_),a);b<i&&c.push({dist:b,range1:y,range2:_})}function yR(c,i,a,d,p=1/0){let y=Math.min(d.distance(c[0],a[0][0]),p);if(y===0)return y;const _=new Tm([{dist:0,range1:[0,c.length-1],range2:[0,0]}],Yx),b=i?50:100,E=nh(a);for(;_.length;){const I=_.pop();if(I.dist>=y)continue;const M=I.range1;if(Em(M)<=b){if(!wc(M,c.length))return NaN;if(i){const D=mR(c,M,a,d);if((y=Math.min(y,D))===0)return y}else for(let D=M[0];D<=M[1];++D){const N=pR(c[D],a,d);if((y=Math.min(y,N))===0)return y}}else{const D=Qx(M,i);if(D[0]!==null){const N=id(rh(c,D[0]),E,d);N<y&&_.push({dist:N,range1:D[0],range2:[0,0]})}if(D[1]!==null){const N=id(rh(c,D[1]),E,d);N<y&&_.push({dist:N,range1:D[1],range2:[0,0]})}}}return y}function IE(c,i,a,d,p,y=1/0){let _=Math.min(y,p.distance(c[0],a[0]));if(_===0)return _;const b=new Tm([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],Yx),E=i?50:100,I=d?50:100;for(;b.length;){const M=b.pop();if(M.dist>=_)continue;const D=M.range1,N=M.range2;if(Em(D)<=E&&Em(N)<=I){if(!wc(D,c.length)||!wc(N,a.length))return NaN;if(i&&d?_=Math.min(_,rn(c,D,a,N,p)):i||d?i&&!d?_=Math.min(_,eb(a,N,c,D,p)):!i&&d&&(_=Math.min(_,eb(c,D,a,N,p))):_=Math.min(_,fR(c,D,a,N,p)),_===0)return _}else{const V=Qx(D,i),G=Qx(N,d);ai(b,_,p,c,a,V[0],G[0]),ai(b,_,p,c,a,V[0],G[1]),ai(b,_,p,c,a,V[1],G[0]),ai(b,_,p,c,a,V[1],G[1])}}return _}function rb(c,i,a,d,p=1/0){let y=p;const _=rh(c,[0,c.length-1]);for(const b of a)if(!(y!==1/0&&id(_,rh(b,[0,b.length-1]),d)>=y)&&(y=Math.min(y,IE(c,i,b,!0,d,y)),y===0))return y;return y}function Zy(c,i,a,d,p=1/0){let y=p;const _=rh(c,[0,c.length-1]);for(const b of a){if(y!==1/0&&id(_,nh(b),d)>=y)continue;const E=yR(c,i,b,d,y);if(isNaN(E))return E;if((y=Math.min(y,E))===0)return y}return y}function nb(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class ih{constructor(i,a){this.type=tr,this.geojson=i,this.geometries=a}static parse(i,a){if(i.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${i.length-1} instead.`);if(Qu(i[1])){const d=i[1];if(d.type==="FeatureCollection"){for(let p=0;p<d.features.length;++p)if(nb(d.features[p].geometry.type))return new ih(d,d.features[p].geometry)}else if(d.type==="Feature"){if(nb(d.geometry.type))return new ih(d,d.geometry)}else if(nb(d.type))return new ih(d,d)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(i){const a=i.geometry(),d=i.canonicalID();if(a!=null&&d!=null){if(i.geometryType()==="Point")return function(p,y,_){const b=[];for(const I of p)for(const M of I)b.push(Wy(M,y));const E=new bf(b[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?IE(b,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",E):_.type==="MultiLineString"?rb(b,!1,_.coordinates,E):_.type==="Polygon"||_.type==="MultiPolygon"?Zy(b,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,E):null}(a,d,this.geometries);if(i.geometryType()==="LineString")return function(p,y,_){const b=[];for(const I of p){const M=[];for(const D of I)M.push(Wy(D,y));b.push(M)}const E=new bf(b[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return rb(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",b,E);if(_.type==="MultiLineString"){let I=1/0;for(let M=0;M<_.coordinates.length;M++){const D=rb(_.coordinates[M],!0,b,E,I);if(isNaN(D))return D;if((I=Math.min(I,D))===0)return I}return I}if(_.type==="Polygon"||_.type==="MultiPolygon"){let I=1/0;for(let M=0;M<b.length;M++){const D=Zy(b[M],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,E,I);if(isNaN(D))return D;if((I=Math.min(I,D))===0)return I}return I}return null}(a,d,this.geometries);if(i.geometryType()==="Polygon")return function(p,y,_){const b=[];for(const I of function(M){const D=M.length;if(D<=1)return[M];const N=[];let V,G;for(let Y=0;Y<D;Y++){const re=lR(M[Y]);re!==0&&(M[Y].area=Math.abs(re),G===void 0&&(G=re<0),G===re<0?(V&&N.push(V),V=[M[Y]]):V.push(M[Y]))}return V&&N.push(V),N}(p)){const M=[];for(let D=0;D<I.length;++D)M.push(hR(I[D],y));b.push(M)}const E=new bf(b[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Zy(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",b,E);if(_.type==="MultiLineString"){let I=1/0;for(let M=0;M<_.coordinates.length;M++){const D=Zy(_.coordinates[M],!0,b,E,I);if(isNaN(D))return D;if((I=Math.min(I,D))===0)return I}return I}return _.type==="Polygon"||_.type==="MultiPolygon"?function(I,M,D){let N=1/0;for(const V of I)for(const G of M){const Y=gR(V,G,D,N);if(isNaN(Y))return Y;if((N=Math.min(N,Y))===0)return N}return N}(_.type==="Polygon"?[_.coordinates]:_.coordinates,b,E):null}(a,d,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function wf(c){if(c instanceof pa&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof nd||c instanceof ih)return!1;if(c instanceof Tf)return c.featureConstant;let i=!0;return c.eachChild(a=>{i&&!wf(a)&&(i=!1)}),i}function Am(c){if(c instanceof pa&&c.name==="feature-state")return!1;let i=!0;return c.eachChild(a=>{i&&!Am(a)&&(i=!1)}),i}function Sf(c,i){if(c instanceof pa&&i.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild(d=>{a&&!Sf(d,i)&&(a=!1)}),a}function OE(c,i,a){return[c,i,a].filter(Boolean).join("")}function ib(c,i){switch(c){case"string":return vc(i);case"number":return+i;case"boolean":return!!i;case"color":return En.parse(i);case"formatted":return ks.fromString(vc(i));case"resolvedImage":return fa.build(vc(i))}return i}function kE(c,i,a,d){return d!==void 0&&(c=d*Math.round(c/d)),i!==void 0&&c<i&&(c=i),a!==void 0&&c>a&&(c=a),c}class Tf{constructor(i,a,d,p=!1){this.type=i,this.key=a,this.scope=d,this.featureConstant=p}static parse(i,a){let d=a.expectedType;if(d==null&&(d=Cn),i.length<2||i.length>3)return a.error("Invalid number of arguments for 'config' expression.");const p=a.parse(i[1],1);if(!(p instanceof uu))return a.error("Key name of 'config' expression must be a string literal.");let y,_=!0;const b=vc(p.value);if(i.length>=3){const E=a.parse(i[2],2);if(!(E instanceof uu))return a.error("Scope of 'config' expression must be a string literal.");y=vc(E.value)}if(a.options){const E=OE(b,y,a._scope),I=a.options.get(E);I&&(_=wf(I.value||I.default))}return new Tf(d,b,y,_)}evaluate(i){const a=OE(this.key,this.scope,i.scope),d=i.getConfig(a);if(!d)return null;const{type:p,value:y,values:_,minValue:b,maxValue:E,stepValue:I}=d,M=d.default.evaluate(i);let D=M;if(y){const N=i.scope;i.scope=(N||"").split("").slice(1).join(""),D=y.evaluate(i),i.scope=N}return p&&(D=ib(p,D)),D===void 0||b===void 0&&E===void 0&&I===void 0||(typeof D=="number"?D=kE(D,b,E,I):Array.isArray(D)&&(D=D.map(N=>typeof N=="number"?kE(N,b,E,I):N))),y!==void 0&&D!==void 0&&_&&!_.includes(D)&&(D=M,p&&(D=ib(p,D))),(p&&p!==this.type||D!==void 0&&!zy(Co(D),this.type))&&(D=ib(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const i=["config",this.key];return this.scope&&i.concat(this.scope),i}}class Xy{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(i.length!==2||typeof i[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const d=i[1];return a.scope.has(d)?new Xy(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ky{constructor(i,a=[],d,p=new jy,y=[],_,b,E){this.registry=i,this.path=a,this.key=a.map(I=>typeof I=="string"?`['${I}']`:`[${I}]`).join(""),this.scope=p,this.errors=y,this.expectedType=d,this._scope=_,this.options=b,this.iconImageUseTheme=E}parse(i,a,d,p,y={}){return a||d?this.concat(a,null,d,p)._parse(i,y):this._parse(i,y)}parseObjectValue(i,a,d,p,y,_={}){return this.concat(a,d,p,y)._parse(i,_)}_parse(i,a){function d(p,y,_){return _==="assert"?new Er(y,[p]):_==="coerce"?new xc(y,[p]):p}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=typeof i[0]=="string"?this.registry[i[0]]:void 0;if(p){let y=p.parse(i,this);if(!y)return null;if(this.expectedType){const _=this.expectedType,b=y.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||b.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(_,b))return null}else y=d(y,_,a.typeAnnotation||"coerce");else y=d(y,_,a.typeAnnotation||"assert")}if(!(y instanceof uu)&&y.type.kind!=="resolvedImage"&&ob(y)){const _=new vf(this._scope,this.options,this.iconImageUseTheme);try{y=new uu(y.type,y.evaluate(_))}catch(b){return this.error(b.message),null}}return y}return xc.parse(["to-array",i],this)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,d,p){let y=typeof i=="number"?this.path.concat(i):this.path;y=typeof a=="string"?y.concat(a):y;const _=p?this.scope.concat(p):this.scope;return new Ky(this.registry,y,d||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(i,...a){const d=`${this.key}${a.map(p=>`[${p}]`).join("")}`;this.errors.push(new Hs(d,i))}checkSubtype(i,a){const d=_m(i,a);return d&&this.error(d),d}}function ob(c){if(c instanceof Xy)return ob(c.boundExpression);if(c instanceof pa&&c.name==="error"||c instanceof bc||c instanceof nd||c instanceof ih||c instanceof Tf)return!1;const i=c instanceof xc||c instanceof Er;let a=!0;return c.eachChild(d=>{a=i?a&&ob(d):a&&d instanceof uu}),!!a&&wf(c)&&Sf(c,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Yy(c,i){const a=c.length-1;let d,p,y=0,_=a,b=0;for(;y<=_;)if(b=Math.floor((y+_)/2),d=c[b],p=c[b+1],d<=i){if(b===a||i<p)return b;y=b+1}else{if(!(d>i))throw new mo("Input is not a number.");_=b-1}return 0}class Pm{constructor(i,a,d){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[p,y]of d)this.labels.push(p),this.outputs.push(y)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const d=a.parse(i[1],1,tr);if(!d)return null;const p=[];let y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(let _=1;_<i.length;_+=2){const b=_===1?-1/0:i[_],E=i[_+1],I=_,M=_+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const D=a.parse(E,M,y);if(!D)return null;y=y||D.type,p.push([b,D])}return new Pm(y,d,p)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const p=this.input.evaluate(i);if(p<=a[0])return d[0].evaluate(i);const y=a.length;return p>=a[y-1]?d[y-1].evaluate(i):d[Yy(a,p)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}const RE=.95047,ME=1.08883,DE=4/29,Ef=6/29,LE=3*Ef*Ef,_R=Ef*Ef*Ef,vR=Math.PI/180,xR=180/Math.PI;function sb(c){return c>_R?Math.pow(c,1/3):c/LE+DE}function ab(c){return c>Ef?c*c*c:LE*(c-DE)}function lb(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function cb(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function jE(c){const i=cb(c.r),a=cb(c.g),d=cb(c.b),p=sb((.4124564*i+.3575761*a+.1804375*d)/RE),y=sb((.2126729*i+.7151522*a+.072175*d)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-sb((.0193339*i+.119192*a+.9503041*d)/ME)),alpha:c.a}}function Jy(c){let i=(c.l+16)/116,a=isNaN(c.a)?i:i+c.a/500,d=isNaN(c.b)?i:i-c.b/200;return i=1*ab(i),a=RE*ab(a),d=ME*ab(d),new En(lb(3.2404542*a-1.5371385*i-.4985314*d),lb(-.969266*a+1.8760108*i+.041556*d),lb(.0556434*a-.2040259*i+1.0572252*d),c.alpha)}function Qy(c,i,a){const d=i-c;return c+a*(d>180||d<-180?d-360*Math.round(d/360):d)}const Af={forward:jE,reverse:Jy,interpolate:function(c,i,a){return{l:mr(c.l,i.l,a),a:mr(c.a,i.a,a),b:mr(c.b,i.b,a),alpha:mr(c.alpha,i.alpha,a)}}},Cm={forward:function(c){const{l:i,a,b:d}=jE(c),p=Math.atan2(d,a)*xR;return{h:p<0?p+360:p,c:Math.sqrt(a*a+d*d),l:i,alpha:c.a}},reverse:function(c){const i=c.h*vR,a=c.c;return Jy({l:c.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:c.alpha})},interpolate:function(c,i,a){return{h:Qy(c.h,i.h,a),c:mr(c.c,i.c,a),l:mr(c.l,i.l,a),alpha:mr(c.alpha,i.alpha,a)}}};var NE=Object.freeze({__proto__:null,hcl:Cm,lab:Af});class Ja{constructor(i,a,d,p,y){this.type=i,this.operator=a,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(const[_,b]of y)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(i,a,d,p){let y=0;if(i.name==="exponential")y=e_(a,i.base,d,p);else if(i.name==="linear")y=e_(a,1,d,p);else if(i.name==="cubic-bezier"){const _=i.controlPoints;y=new ms(_[0],_[1],_[2],_[3]).solve(e_(a,1,d,p))}return y}static parse(i,a){let[d,p,y,..._]=i;if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const I=p[1];if(typeof I!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const I=p.slice(1);if(I.length!==4||I.some(M=>typeof M!="number"||M<0||M>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length-1>3&&(i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,tr),!y)return null;const b=[];let E=null;d==="interpolate-hcl"||d==="interpolate-lab"?E=Ws:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType);for(let I=0;I<_.length;I+=2){const M=_[I],D=_[I+1],N=I+3,V=I+4;if(typeof M!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(b.length&&b[b.length-1][0]>=M)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const G=a.parse(D,V,E);if(!G)return null;E=E||G.type,b.push([M,G])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Ja(E,d,p,y,b):a.error(`Type ${Vi(E)} is not interpolatable.`)}evaluate(i){const a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(i);const p=this.input.evaluate(i);if(p<=a[0])return d[0].evaluate(i);const y=a.length;if(p>=a[y-1])return d[y-1].evaluate(i);const _=Yy(a,p),b=Ja.interpolationFactor(this.interpolation,p,a[_],a[_+1]),E=d[_].evaluate(i),I=d[_+1].evaluate(i);return this.operator==="interpolate"?eh[this.type.kind.toLowerCase()](E,I,b):this.operator==="interpolate-hcl"?Cm.reverse(Cm.interpolate(Cm.forward(E),Cm.forward(I),b)):Af.reverse(Af.interpolate(Af.forward(E),Af.forward(I),b))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,i,this.input.serialize()];for(let d=0;d<this.labels.length;d++)a.push(this.labels[d],this.outputs[d].serialize());return a}}function e_(c,i,a,d){const p=d-a,y=c-a;return p===0?0:i===1?y/p:(Math.pow(i,y)-1)/(Math.pow(i,p)-1)}class Im{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let d=null;const p=a.expectedType;p&&p.kind!=="value"&&(d=p);const y=[];for(const b of i.slice(1)){const E=a.parse(b,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!E)return null;d=d||E.type,y.push(E)}const _=p&&y.some(b=>_m(p,b.type));return new Im(_?Cn:d,y)}evaluate(i){let a,d=null,p=0;for(const y of this.args){if(p++,d=y.evaluate(i),d&&d instanceof fa&&!d.available&&(a||(a=d),d=null,p===this.args.length))return a;if(d!==null)break}return d}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class hu{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const d=[];for(let y=1;y<i.length-1;y+=2){const _=i[y];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const b=a.parse(i[y+1],y+1);if(!b)return null;d.push([_,b])}const p=a.parse(i[i.length-1],i.length-1,a.expectedType,d);return p?new hu(d,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,d]of this.bindings)i.push(a,d.serialize());return i.push(this.result.serialize()),i}}class t_{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,tr),p=a.parse(i[2],2,Os(a.expectedType||Cn));return d&&p?new t_(p.type.itemType,d,p):null}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new mo("Array index out of bounds: negative index");if(a>=d.length)throw new mo("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new mo("Array index must be an integer. Use at-interpolated for fractional indices");return d[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class r_{constructor(i,a,d){this.type=i,this.index=a,this.input=d}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,tr),p=a.parse(i[2],2,Os(a.expectedType||Cn));return d&&p?new r_(p.type.itemType,d,p):null}evaluate(i){const a=this.index.evaluate(i),d=this.input.evaluate(i);if(a<0)throw new mo(`Array index out of bounds: ${a} < 0.`);if(a>d.length-1)throw new mo(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a===Math.floor(a))return d[a];const p=Math.floor(a),y=Math.ceil(a),_=d[p],b=d[y];if(typeof _!="number"||typeof b!="number")throw new mo(`Cannot interpolate between non-number values at index ${a}.`);const E=a-p;return _*(1-E)+b*E}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ub{constructor(i,a){this.type=pn,this.needle=i,this.haystack=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Cn),p=a.parse(i[2],2,Cn);return d&&p?Bx(d.type,[pn,Sn,tr,da,Cn])?new ub(d,p):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(d.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(d==null)return!1;if(!vm(a,["boolean","string","number","null"]))throw new mo(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(Co(a))} instead.`);if(!vm(d,["string","array"]))throw new mo(`Expected second argument to be of type array or string, but found ${Vi(Co(d))} instead.`);return d.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Pf{constructor(i,a,d){this.type=tr,this.needle=i,this.haystack=a,this.fromIndex=d}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Cn),p=a.parse(i[2],2,Cn);if(!d||!p)return null;if(!Bx(d.type,[pn,Sn,tr,da,Cn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(d.type)} instead`);if(i.length===4){const y=a.parse(i[3],3,tr);return y?new Pf(d,p,y):null}return new Pf(d,p)}evaluate(i){const a=this.needle.evaluate(i),d=this.haystack.evaluate(i);if(!vm(a,["boolean","string","number","null"]))throw new mo(`Expected first argument to be of type boolean, string, number or null, but found ${Vi(Co(a))} instead.`);if(!vm(d,["string","array"]))throw new mo(`Expected second argument to be of type array or string, but found ${Vi(Co(d))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(i);return d.indexOf(a,p)}return d.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Om{constructor(i,a,d,p,y,_){this.inputType=i,this.type=a,this.input=d,this.cases=p,this.outputs=y,this.otherwise=_}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let d,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const y={},_=[];for(let I=2;I<i.length-1;I+=2){let M=i[I];const D=i[I+1];Array.isArray(M)||(M=[M]);const N=a.concat(I);if(M.length===0)return N.error("Expected at least one branch label.");for(const G of M){if(typeof G!="number"&&typeof G!="string")return N.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return N.error("Numeric branch labels must be integer values.");if(d){if(N.checkSubtype(d,Co(G)))return null}else d=Co(G);if(y[String(G)]!==void 0)return N.error("Branch labels must be unique.");y[String(G)]=_.length}const V=a.parse(D,I,p);if(!V)return null;p=p||V.type,_.push(V)}const b=a.parse(i[1],1,Cn);if(!b)return null;const E=a.parse(i[i.length-1],i.length-1,p);return E?b.type.kind!=="value"&&a.concat(1).checkSubtype(d,b.type)?null:new Om(d,p,b,y,_,E):null}evaluate(i){const a=this.input.evaluate(i);return(zy(Co(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),d=[],p={};for(const _ of a){const b=p[this.cases[_]];b===void 0?(p[this.cases[_]]=d.length,d.push([this.cases[_],[_]])):d[b][1].push(_)}const y=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,b]of d)i.push(b.length===1?y(b[0]):b.map(y)),i.push(this.outputs[_].serialize());return i.push(this.otherwise.serialize()),i}}class km{constructor(i,a,d){this.type=i,this.branches=a,this.otherwise=d}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const p=[];for(let _=1;_<i.length-1;_+=2){const b=a.parse(i[_],_,pn);if(!b)return null;const E=a.parse(i[_+1],_+1,d);if(!E)return null;p.push([b,E]),d=d||E.type}const y=a.parse(i[i.length-1],i.length-1,d);return y?new km(d,p,y):null}evaluate(i){for(const[a,d]of this.branches)if(a.evaluate(i))return d.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,d]of this.branches)i(a),i(d);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}class n_{constructor(i,a,d,p){this.type=i,this.input=a,this.beginIndex=d,this.endIndex=p}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Cn),p=a.parse(i[2],2,tr);if(!d||!p)return null;if(!Bx(d.type,[Os(Cn),Sn,Cn]))return a.error(`Expected first argument to be of type array or string, but found ${Vi(d.type)} instead`);if(i.length===4){const y=a.parse(i[3],3,tr);return y?new n_(d.type,d,p,y):null}return new n_(d.type,d,p)}evaluate(i){const a=this.input.evaluate(i),d=this.beginIndex.evaluate(i);if(!vm(a,["string","array"]))throw new mo(`Expected first argument to be of type array or string, but found ${Vi(Co(a))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(i);return a.slice(d,p)}return a.slice(d)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class db{constructor(i,a){this.type=Os(Sn),this.str=i,this.delimiter=a}static parse(i,a){if(i.length!==3)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const d=a.parse(i[1],1,Sn),p=a.parse(i[2],2,Sn);return d&&p?new db(d,p):void 0}evaluate(i){const a=this.str.evaluate(i),d=this.delimiter.evaluate(i);return a.split(d)}eachChild(i){i(this.str),i(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function hb(c,i){return c==="=="||c==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function fb(c,i,a,d){return d.compare(i,a)===0}function Cf(c,i,a){const d=c!=="=="&&c!=="!=";return class jne{constructor(y,_,b){this.type=pn,this.lhs=y,this.rhs=_,this.collator=b,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");const b=y[0];let E=_.parse(y[1],1,Cn);if(!E)return null;if(!hb(b,E.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${Vi(E.type)}'.`);let I=_.parse(y[2],2,Cn);if(!I)return null;if(!hb(b,I.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${Vi(I.type)}'.`);if(E.type.kind!==I.type.kind&&E.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${Vi(E.type)}' and '${Vi(I.type)}'.`);d&&(E.type.kind==="value"&&I.type.kind!=="value"?E=new Er(I.type,[E]):E.type.kind!=="value"&&I.type.kind==="value"&&(I=new Er(E.type,[I])));let M=null;if(y.length===4){if(E.type.kind!=="string"&&I.type.kind!=="string"&&E.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(y[3],3,Ny),!M)return null}return new jne(E,I,M)}evaluate(y){const _=this.lhs.evaluate(y),b=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){const E=Co(_),I=Co(b);if(E.kind!==I.kind||E.kind!=="string"&&E.kind!=="number")throw new mo(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${E.kind}, ${I.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const E=Co(_),I=Co(b);if(E.kind!=="string"||I.kind!=="string")return i(y,_,b)}return this.collator?a(y,_,b,this.collator.evaluate(y)):i(y,_,b)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[c];return this.eachChild(_=>{y.push(_.serialize())}),y}}}const bR=Cf("==",function(c,i,a){return i===a},fb),wR=Cf("!=",function(c,i,a){return i!==a},function(c,i,a,d){return!fb(0,i,a,d)}),zE=Cf("<",function(c,i,a){return i<a},function(c,i,a,d){return d.compare(i,a)<0}),FE=Cf(">",function(c,i,a){return i>a},function(c,i,a,d){return d.compare(i,a)>0}),i_=Cf("<=",function(c,i,a){return i<=a},function(c,i,a,d){return d.compare(i,a)<=0}),SR=Cf(">=",function(c,i,a){return i>=a},function(c,i,a,d){return d.compare(i,a)>=0});class o_{constructor(i,a,d,p,y,_){this.type=Sn,this.number=i,this.locale=a,this.currency=d,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=_}static parse(i,a){if(i.length!==3)return a.error("Expected two arguments.");const d=a.parse(i[1],1,tr);if(!d)return null;const p=i[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=a.parseObjectValue(p.locale,2,"locale",Sn),!y))return null;let _=null;if(p.currency&&(_=a.parseObjectValue(p.currency,2,"currency",Sn),!_))return null;let b=null;if(p.unit&&(b=a.parseObjectValue(p.unit,2,"unit",Sn),!b))return null;let E=null;if(p["min-fraction-digits"]&&(E=a.parseObjectValue(p["min-fraction-digits"],2,"min-fraction-digits",tr),!E))return null;let I=null;return p["max-fraction-digits"]&&(I=a.parseObjectValue(p["max-fraction-digits"],2,"max-fraction-digits",tr),!I)?null:new o_(d,y,_,b,E,I)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class pb{constructor(i){this.type=tr,this.input=i}static parse(i,a){if(i.length!==2)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const d=a.parse(i[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Vi(d.type)} instead.`):new pb(d):null}evaluate(i){const a=this.input.evaluate(i);if(typeof a=="string"||Array.isArray(a))return a.length;throw new mo(`Expected value to be of type string or array, but found ${Vi(Co(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}function BE(c){return function(){c=1831565813+(c|=0)|0;let i=Math.imul(c^c>>>15,1|c);return i=i+Math.imul(i^i>>>7,61|i)^i,((i^i>>>14)>>>0)/4294967296}}const oh={"==":bR,"!=":wR,">":FE,"<":zE,">=":SR,"<=":i_,array:Er,at:t_,"at-interpolated":r_,boolean:Er,case:km,coalesce:Im,collator:bc,format:Qt,image:_f,in:ub,"index-of":Pf,interpolate:Ja,"interpolate-hcl":Ja,"interpolate-lab":Ja,length:pb,let:hu,literal:uu,match:Om,number:Er,"number-format":o_,object:Er,slice:n_,step:Pm,string:Er,"to-boolean":xc,"to-color":xc,"to-number":xc,"to-string":xc,var:Xy,within:nd,distance:ih,config:Tf,split:db};function mb(c,[i,a,d,p]){i=i.evaluate(c),a=a.evaluate(c),d=d.evaluate(c);const y=p?p.evaluate(c):1,_=Vx(i,a,d,y);if(_)throw new mo(_);return new En(i/255,a/255,d/255,y)}function $E(c,[i,a,d,p]){i=i.evaluate(c),a=a.evaluate(c),d=d.evaluate(c);const y=p?p.evaluate(c):1,_=function(I,M,D,N){return typeof I=="number"&&I>=0&&I<=360?typeof M=="number"&&M>=0&&M<=100&&typeof D=="number"&&D>=0&&D<=100?N===void 0||typeof N=="number"&&N>=0&&N<=1?null:`Invalid hsla value [${[I,M,D,N].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof N=="number"?[I,M,D,N]:[I,M,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof N=="number"?[I,M,D,N]:[I,M,D]).join(", ")}]: 'h' must be between 0 and 360.`}(i,a,d,y);if(_)throw new mo(_);const b=`hsla(${i}, ${a}%, ${d}%, ${y})`,E=En.parse(b);if(!E)throw new mo(`Failed to parse HSLA color: ${b}`);return E}function VE(c,i){return c in i}function gb(c,i){const a=i[c];return a===void 0?null:a}function sd(c){return{type:c}}function sh(c){if(c instanceof Tf)return new Set([c.key]);let i=new Set;return c.eachChild(a=>{i=new Set([...i,...sh(a)])}),i}function s_(c){if(c instanceof pa&&c.name==="is-active-floor")return!0;let i=!1;return c.eachChild(a=>{!i&&s_(a)&&(i=!0)}),i}function UE(c){return{result:"success",value:c}}function ad(c){return{result:"error",value:c}}function yb(c,i){return!!c&&!!c.parameters&&c.parameters.indexOf(i)>-1}function a_(c){return c["property-type"]==="data-driven"}function _b(c){return yb(c.expression,"measure-light")}function GE(c){return yb(c.expression,"zoom")}function vb(c){return!!c.expression&&c.expression.interpolated}function l_(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function qE(c){return c}function xb(c,i){const a=i.type==="color",d=c.stops&&typeof c.stops[0][0]=="object",p=d||!(d||c.property!==void 0),y=c.type||(vb(i)?"exponential":"interval");if(a&&((c=Object.assign({},c)).stops&&(c.stops=c.stops.map(I=>[I[0],En.parse(I[1])])),c.default=En.parse(c.default?c.default:i.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!NE[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let _,b,E;if(y==="exponential")_=HE;else if(y==="interval")_=TR;else if(y==="categorical"){_=If,b=Object.create(null);for(const I of c.stops)b[I[0]]=I[1];E=typeof c.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);_=ER}if(d){const I={},M=[];for(let V=0;V<c.stops.length;V++){const G=c.stops[V],Y=G[0].zoom;I[Y]===void 0&&(I[Y]={zoom:Y,type:c.type,property:c.property,default:c.default,stops:[]},M.push(Y)),I[Y].stops.push([G[0].value,G[1]])}const D=[];for(const V of M)D.push([I[V].zoom,xb(I[V],i)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Ja.interpolationFactor.bind(void 0,N),zoomStops:D.map(V=>V[0]),evaluate:({zoom:V},G)=>HE({stops:D,base:c.base},i,V).evaluate(V,G)}}if(p){const I=y==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:Ja.interpolationFactor.bind(void 0,I),zoomStops:c.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(c,i,M,b,E)}}return{kind:"source",evaluate(I,M){const D=M&&M.properties?M.properties[c.property]:void 0;return D===void 0?Rm(c.default,i.default):_(c,i,D,b,E)}}}function Rm(c,i,a){return c!==void 0?c:i!==void 0?i:a!==void 0?a:void 0}function If(c,i,a,d,p){return Rm(typeof a===p?d[a]:void 0,c.default,i.default)}function TR(c,i,a){if(!gr(a))return Rm(c.default,i.default);const d=c.stops.length;if(d===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[d-1][0])return c.stops[d-1][1];const p=Yy(c.stops.map(y=>y[0]),a);return c.stops[p][1]}function HE(c,i,a){const d=c.base!==void 0?c.base:1;if(!gr(a))return Rm(c.default,i.default);const p=c.stops.length;if(p===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[p-1][0])return c.stops[p-1][1];const y=Yy(c.stops.map(M=>M[0]),a),_=function(M,D,N,V){const G=V-N,Y=M-N;return G===0?0:D===1?Y/G:(Math.pow(D,Y)-1)/(Math.pow(D,G)-1)}(a,d,c.stops[y][0],c.stops[y+1][0]),b=c.stops[y][1],E=c.stops[y+1][1];let I=eh[i.type]||qE;if(c.colorSpace&&c.colorSpace!=="rgb"){const M=NE[c.colorSpace];I=(D,N)=>M.reverse(M.interpolate(M.forward(D),M.forward(N),_))}return typeof b.evaluate=="function"?{evaluate(...M){const D=b.evaluate.apply(void 0,M),N=E.evaluate.apply(void 0,M);if(D!==void 0&&N!==void 0)return I(D,N,_)}}:I(b,E,_)}function ER(c,i,a){return i.type==="color"?a=En.parse(a):i.type==="formatted"?a=ks.fromString(a.toString()):i.type==="resolvedImage"?a=fa.build(a.toString()):xr(a)===i.type||i.type==="enum"&&i.values[a]||(a=void 0),Rm(a,c.default,i.default)}pa.register(oh,{error:[{kind:"error"},[Sn],(c,[i])=>{throw new mo(i.evaluate(c))}],typeof:[Sn,[Cn],(c,[i])=>Vi(Co(i.evaluate(c)))],"to-rgba":[Os(tr,4),[Ws],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Os(tr,4),[Ws],(c,[i])=>i.evaluate(c).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ws,[tr,tr,tr],mb],rgba:[Ws,[tr,tr,tr,tr],mb],hsl:[Ws,[tr,tr,tr],$E],hsla:[Ws,[tr,tr,tr,tr],$E],has:{type:pn,overloads:[[[Sn],(c,[i])=>VE(i.evaluate(c),c.properties())],[[Sn,gf],(c,[i,a])=>VE(i.evaluate(c),a.evaluate(c))]]},get:{type:Cn,overloads:[[[Sn],(c,[i])=>gb(i.evaluate(c),c.properties())],[[Sn,gf],(c,[i,a])=>gb(i.evaluate(c),a.evaluate(c))]]},"feature-state":[Cn,[Sn],(c,[i])=>gb(i.evaluate(c),c.featureState||{})],properties:[gf,[],c=>c.properties()],"geometry-type":[Sn,[],c=>c.geometryType()],worldview:[Sn,[],c=>c.globals.worldview||""],"is-active-floor":[pn,sd(Sn),(c,i)=>{if(!(c.globals.activeFloors&&c.globals.activeFloors.size>0))return!1;const a=c.globals.activeFloors;return i.some(d=>{const p=d.evaluate(c);return a.has(p)})}],id:[Cn,[],c=>c.id()],zoom:[tr,[],c=>c.globals.zoom],pitch:[tr,[],c=>c.globals.pitch||0],"distance-from-center":[tr,[],c=>c.distanceFromCenter()],"measure-light":[tr,[Sn],(c,[i])=>c.measureLight(i.evaluate(c))],"heatmap-density":[tr,[],c=>c.globals.heatmapDensity||0],"line-progress":[tr,[],c=>c.globals.lineProgress||0],"raster-value":[tr,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[tr,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[tr,[],c=>c.globals.skyRadialProgress||0],accumulated:[Cn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[tr,sd(tr),(c,i)=>{let a=0;for(const d of i)a+=d.evaluate(c);return a}],"*":[tr,sd(tr),(c,i)=>{let a=1;for(const d of i)a*=d.evaluate(c);return a}],"-":{type:tr,overloads:[[[tr,tr],(c,[i,a])=>i.evaluate(c)-a.evaluate(c)],[[tr],(c,[i])=>-i.evaluate(c)]]},"/":[tr,[tr,tr],(c,[i,a])=>i.evaluate(c)/a.evaluate(c)],"%":[tr,[tr,tr],(c,[i,a])=>i.evaluate(c)%a.evaluate(c)],ln2:[tr,[],()=>Math.LN2],pi:[tr,[],()=>Math.PI],e:[tr,[],()=>Math.E],"^":[tr,[tr,tr],(c,[i,a])=>Math.pow(i.evaluate(c),a.evaluate(c))],sqrt:[tr,[tr],(c,[i])=>Math.sqrt(i.evaluate(c))],log10:[tr,[tr],(c,[i])=>Math.log(i.evaluate(c))/Math.LN10],ln:[tr,[tr],(c,[i])=>Math.log(i.evaluate(c))],log2:[tr,[tr],(c,[i])=>Math.log2(i.evaluate(c))],sin:[tr,[tr],(c,[i])=>Math.sin(i.evaluate(c))],cos:[tr,[tr],(c,[i])=>Math.cos(i.evaluate(c))],tan:[tr,[tr],(c,[i])=>Math.tan(i.evaluate(c))],asin:[tr,[tr],(c,[i])=>Math.asin(i.evaluate(c))],acos:[tr,[tr],(c,[i])=>Math.acos(i.evaluate(c))],atan:[tr,[tr],(c,[i])=>Math.atan(i.evaluate(c))],min:[tr,sd(tr),(c,i)=>Math.min(...i.map(a=>a.evaluate(c)))],max:[tr,sd(tr),(c,i)=>Math.max(...i.map(a=>a.evaluate(c)))],abs:[tr,[tr],(c,[i])=>Math.abs(i.evaluate(c))],round:[tr,[tr],(c,[i])=>{const a=i.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[tr,[tr],(c,[i])=>Math.floor(i.evaluate(c))],ceil:[tr,[tr],(c,[i])=>Math.ceil(i.evaluate(c))],"filter-==":[pn,[Sn,Cn],(c,[i,a])=>c.properties()[i.value]===a.value],"filter-id-==":[pn,[Cn],(c,[i])=>c.id()===i.value],"filter-type-==":[pn,[Sn],(c,[i])=>c.geometryType()===i.value],"filter-<":[pn,[Sn,Cn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d<p}],"filter-id-<":[pn,[Cn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a<d}],"filter->":[pn,[Sn,Cn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d>p}],"filter-id->":[pn,[Cn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a>d}],"filter-<=":[pn,[Sn,Cn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[pn,[Cn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a<=d}],"filter->=":[pn,[Sn,Cn],(c,[i,a])=>{const d=c.properties()[i.value],p=a.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[pn,[Cn],(c,[i])=>{const a=c.id(),d=i.value;return typeof a==typeof d&&a>=d}],"filter-has":[pn,[Cn],(c,[i])=>i.value in c.properties()],"filter-has-id":[pn,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[pn,[Os(Sn)],(c,[i])=>i.value.indexOf(c.geometryType())>=0],"filter-id-in":[pn,[Os(Cn)],(c,[i])=>i.value.indexOf(c.id())>=0],"filter-in-small":[pn,[Sn,Os(Cn)],(c,[i,a])=>a.value.indexOf(c.properties()[i.value])>=0],"filter-in-large":[pn,[Sn,Os(Cn)],(c,[i,a])=>function(d,p,y,_){for(;y<=_;){const b=y+_>>1;if(p[b]===d)return!0;p[b]>d?_=b-1:y=b+1}return!1}(c.properties()[i.value],a.value,0,a.value.length-1)],all:{type:pn,overloads:[[[pn,pn],(c,[i,a])=>i.evaluate(c)&&a.evaluate(c)],[sd(pn),(c,i)=>{for(const a of i)if(!a.evaluate(c))return!1;return!0}]]},any:{type:pn,overloads:[[[pn,pn],(c,[i,a])=>i.evaluate(c)||a.evaluate(c)],[sd(pn),(c,i)=>{for(const a of i)if(a.evaluate(c))return!0;return!1}]]},"!":[pn,[pn],(c,[i])=>!i.evaluate(c)],"is-supported-script":[pn,[Sn],(c,[i])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(i.evaluate(c))}],upcase:[Sn,[Sn],(c,[i])=>i.evaluate(c).toUpperCase()],downcase:[Sn,[Sn],(c,[i])=>i.evaluate(c).toLowerCase()],concat:[Sn,sd(Cn),(c,i)=>i.map(a=>vc(a.evaluate(c))).join("")],"resolved-locale":[Sn,[Ny],(c,[i])=>i.evaluate(c).resolvedLocale()],random:[tr,[tr,tr,Cn],(c,i)=>{const[a,d,p]=i.map(_=>_.evaluate(c));if(a>d||a===d)return a;let y;if(typeof p=="string")y=function(_){let b=0;if(_.length===0)return b;for(let E=0;E<_.length;E++)b=(b<<5)-b+_.charCodeAt(E),b&=b;return b}(p);else{if(typeof p!="number")throw new mo(`Invalid seed input: ${p}`);y=p}return a+BE(y)()*(d-a)}]});class c_{constructor(i,a,d,p,y){this.expression=i,this._warningHistory={},this._scope=d,this._options=p,this._iconImageUseTheme=y,this._evaluator=new vf(d,p,y),this._defaultValue=a?function(_){return _.type==="color"&&(l_(_.default)||Array.isArray(_.default))?new En(0,0,0,0):_.type==="color"?En.parse(_.default)||null:_.default===void 0?null:_.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=sh(i),this.isIndoorDependent=s_(i)}evaluateWithoutErrorHandling(i,a,d,p,y,_,b,E){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,d,p,y,_,b,E,I){this._evaluator||(this._evaluator=new vf(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=I||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new mo(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){const D=M;return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${D.message}`)),this._defaultValue}}}function Mm(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in oh}function ld(c,i,a,d,p){const y=new Ky(oh,[],i?function(b){const E={color:Ws,string:Sn,number:tr,enum:Sn,boolean:pn,formatted:yf,resolvedImage:th};return b.type==="array"?Os(E[b.value]||Cn,b.length):E[b.type]}(i):void 0,void 0,void 0,a,d,p),_=y.parse(c,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?UE(new c_(_,i,a,d,p)):ad(y.errors)}class Dm{constructor(i,a,d,p){this.kind=i,this._styleExpression=a,this.isLightConstant=d,this.isLineProgressConstant=p,this.isStateDependent=i!=="constant"&&!Am(a.expression),this.configDependencies=sh(a.expression),this.isIndoorDependent=s_(a.expression)}evaluateWithoutErrorHandling(i,a,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,p,y,_)}evaluate(i,a,d,p,y,_,b){return this._styleExpression.evaluate(i,a,d,p,y,_,void 0,void 0,b)}}class ah{constructor(i,a,d,p,y,_){this.kind=i,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=i!=="camera"&&!Am(a.expression),this.isIndoorDependent=s_(a.expression),this.isLightConstant=y,this.isLineProgressConstant=_,this.configDependencies=sh(a.expression),this.interpolationType=p}evaluateWithoutErrorHandling(i,a,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(i,a,d,p,y,_)}evaluate(i,a,d,p,y,_){return this._styleExpression.evaluate(i,a,d,p,y,_)}interpolationFactor(i,a,d){return this.interpolationType?Ja.interpolationFactor(this.interpolationType,i,a,d):0}}function u_(c,i,a,d,p){if((c=ld(c,i,a,d,p)).result==="error")return c;const y=c.value.expression,_=wf(y);if(!_&&!a_(i))return ad([new Hs("","data expressions not supported")]);const b=Sf(y,["zoom","pitch","distance-from-center"]);if(!b&&!GE(i))return ad([new Hs("","zoom expressions not supported")]);const E=Sf(y,["measure-light"]);if(!E&&!_b(i))return ad([new Hs("","measure-light expression not supported")]);const I=Sf(y,["line-progress"]);if(!I&&!function(N){return yb(N.expression,"line-progress")}(i))return ad([new Hs("","line-progress expression not supported")]);const M=i.expression&&i.expression.relaxZoomRestriction,D=d_(y);return D||b||M?D instanceof Hs?ad([D]):D instanceof Ja&&!vb(i)?ad([new Hs("",'"interpolate" expressions cannot be used with this property')]):UE(D?new ah(_&&I?"camera":"composite",c.value,D.labels,D instanceof Ja?D.interpolation:void 0,E,I):new Dm(_&&I?"constant":"source",c.value,E,I)):ad([new Hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Lm{constructor(i,a){this._parameters=i,this._specification=a,Object.assign(this,xb(this._parameters,this._specification))}static deserialize(i){return new Lm(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function d_(c){let i=null;if(c instanceof hu)i=d_(c.result);else if(c instanceof Im){for(const a of c.args)if(i=d_(a),i)break}else(c instanceof Pm||c instanceof Ja)&&c.input instanceof pa&&c.input.name==="zoom"&&(i=c);return i instanceof Hs||c.eachChild(a=>{const d=d_(a);d instanceof Hs?i=d:i&&d&&i!==d&&(i=new Hs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}var Sc,WE,AR=function(){if(WE)return Sc;WE=1,Sc=i;var c=3;function i(a,d,p){var y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var _=new Int32Array(this.arrayBuffer);a=_[0],this.d=(d=_[1])+2*(p=_[2]);for(var b=0;b<this.d*this.d;b++){var E=_[c+b],I=_[c+b+1];y.push(E===I?null:_.subarray(E,I))}var M=_[c+y.length+1];this.keys=_.subarray(_[c+y.length],M),this.bboxes=_.subarray(M),this.insert=this._insertReadonly}else{this.d=d+2*p;for(var D=0;D<this.d*this.d;D++)y.push([]);this.keys=[],this.bboxes=[]}this.n=d,this.extent=a,this.padding=p,this.scale=d/a,this.uid=0;var N=p/d*a;this.min=-N,this.max=a+N}return i.prototype.insert=function(a,d,p,y,_){this._forEachCell(d,p,y,_,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(_)},i.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},i.prototype._insertCell=function(a,d,p,y,_,b){this.cells[_].push(b)},i.prototype.query=function(a,d,p,y,_){var b=this.min,E=this.max;if(a<=b&&d<=b&&E<=p&&E<=y&&!_)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(a,d,p,y,this._queryCell,I,{},_),I},i.prototype._queryCell=function(a,d,p,y,_,b,E,I){var M=this.cells[_];if(M!==null)for(var D=this.keys,N=this.bboxes,V=0;V<M.length;V++){var G=M[V];if(E[G]===void 0){var Y=4*G;(I?I(N[Y+0],N[Y+1],N[Y+2],N[Y+3]):a<=N[Y+2]&&d<=N[Y+3]&&p>=N[Y+0]&&y>=N[Y+1])?(E[G]=!0,b.push(D[G])):E[G]=!1}}},i.prototype._forEachCell=function(a,d,p,y,_,b,E,I){for(var M=this._convertToCellCoord(a),D=this._convertToCellCoord(d),N=this._convertToCellCoord(p),V=this._convertToCellCoord(y),G=M;G<=N;G++)for(var Y=D;Y<=V;Y++){var re=this.d*Y+G;if((!I||I(this._convertFromCellCoord(G),this._convertFromCellCoord(Y),this._convertFromCellCoord(G+1),this._convertFromCellCoord(Y+1)))&&_.call(this,a,d,p,y,re,b,E,I))return}},i.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},i.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},i.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,d=c+this.cells.length+1+1,p=0,y=0;y<this.cells.length;y++)p+=this.cells[y].length;var _=new Int32Array(d+p+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var b=d,E=0;E<a.length;E++){var I=a[E];_[c+E]=b,_.set(I,b),b+=I.length}return _[c+a.length]=b,_.set(this.keys,b),_[c+a.length+1]=b+=this.keys.length,_.set(this.bboxes,b),b+=this.bboxes.length,_.buffer},Sc}(),lh=Wn(AR);const h_={};function Wt(c,i,a={}){Object.defineProperty(c,"_classRegistryKey",{value:i,writable:!1}),h_[i]={klass:c,omit:a.omit||[]}}Wt(Object,"Object"),lh.serialize=function(c,i){const a=c.toArrayBuffer();return i&&i.add(a),{buffer:a}},lh.deserialize=function(c){return new lh(c.buffer)},Object.defineProperty(lh,"name",{value:"Grid"}),Wt(lh,"Grid"),delete wt.prototype.constructor,Wt(En,"Color"),Wt(Error,"Error"),Wt(ks,"Formatted"),Wt(Fy,"FormattedSection"),Wt(hm,"AJAXError"),Wt(fa,"ResolvedImage"),Wt(Lm,"StylePropertyFunction"),Wt(c_,"StyleExpression",{omit:["_evaluator"]}),Wt(ua,"ImageId"),Wt(ha,"ImageVariant"),Wt(ah,"ZoomDependentExpression"),Wt(Dm,"ZoomConstantExpression"),Wt(pa,"CompoundExpression",{omit:["_evaluate"]});for(const c in oh)h_[oh[c]._classRegistryKey]||Wt(oh[c],`Expression${c}`);function bb(c){return c&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ql(c,i){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(bb(c)||c instanceof ImageBitmap)return i&&i.add(c),c;if(ArrayBuffer.isView(c))return i&&i.add(c.buffer),c;if(c instanceof ImageData)return i&&i.add(c.data.buffer),c;if(Array.isArray(c)){const a=[];for(const d of c)a.push(ql(d,i));return a}if(c instanceof Map){const a={$name:"Map",entries:[]};for(const[d,p]of c.entries())a.entries.push(ql(d),ql(p,i));return a}if(c instanceof Set){const a={$name:"Set"};let d=0;for(const p of c.values())a[++d]=ql(p);return a}if(typeof c=="bigint")return{$name:"BigInt",value:c.toString()};if(typeof c=="object"){const a=c.constructor,d=a._classRegistryKey;if(!d)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const p=a.serialize?a.serialize(c,i):{};if(!a.serialize){for(const y in c)c.hasOwnProperty(y)&&(h_[d].omit.indexOf(y)>=0||(p[y]=ql(c[y],i)));c instanceof Error&&(p.message=c.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(p.$name=d),p}throw new Error("can't serialize object of type "+typeof c)}function fu(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||bb(c)||c instanceof ImageBitmap||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(fu);if(typeof c=="object"){const i=c.$name||"Object";if(i==="Map"){const p=c.entries||[],y=new Map;for(let _=0;_<p.length;_+=2)y.set(fu(p[_]),fu(p[_+1]));return y}if(i==="Set"){const p=new Set;for(const y of Object.keys(c))y!=="$name"&&p.add(fu(c[y]));return p}if(i==="BigInt")return BigInt(c.value);const{klass:a}=h_[i];if(!a)throw new Error(`Can't deserialize unregistered class "${i}".`);if(a.deserialize)return a.deserialize(c);const d=Object.create(a.prototype);for(const p of Object.keys(c))p!=="$name"&&(d[p]=fu(c[p]));return d}throw new Error("can't deserialize object of type "+typeof c)}const ZE=c=>c>=1536&&c<=1791,XE=c=>c>=1872&&c<=1919,f_=c=>c>=2208&&c<=2303,p_=c=>c>=11904&&c<=12031,wb=c=>c>=12032&&c<=12255,Sb=c=>c>=12272&&c<=12287,Of=c=>c>=12288&&c<=12351,kf=c=>c>=12352&&c<=12447,jm=c=>c>=12448&&c<=12543,Tc=c=>c>=12544&&c<=12591,KE=c=>c>=12704&&c<=12735,YE=c=>c>=12736&&c<=12783,JE=c=>c>=12784&&c<=12799,QE=c=>c>=12800&&c<=13055,Tb=c=>c>=13056&&c<=13311,Rf=c=>c>=13312&&c<=19903,m_=c=>c>=19968&&c<=40959,Eb=c=>c>=40960&&c<=42127,g_=c=>c>=42128&&c<=42191,eA=c=>c>=44032&&c<=55215,tA=c=>c>=63744&&c<=64255,Ab=c=>c>=64336&&c<=65023,rA=c=>c>=65040&&c<=65055,Pb=c=>c>=65072&&c<=65103,nA=c=>c>=65104&&c<=65135,Cb=c=>c>=65136&&c<=65279,Ib=c=>c>=65280&&c<=65519;function Ob(c){for(const i of c)if(cd(i.charCodeAt(0)))return!0;return!1}function PR(c){for(const i of c)if(!CR(i.charCodeAt(0)))return!1;return!0}function CR(c){return!(ZE(c)||XE(c)||f_(c)||Ab(c)||Cb(c))}function iA(c){return!(c<11904||!(KE(c)||Tc(c)||Pb(c)||tA(c)||Tb(c)||p_(c)||YE(c)||Of(c)||Rf(c)||m_(c)||QE(c)||Ib(c)||kf(c)||Sb(c)||wb(c)||JE(c)||jm(c)||rA(c)||g_(c)||Eb(c)))}function cd(c){return!(c!==746&&c!==747&&(c<4352||!(KE(c)||Tc(c)||Pb(c)&&!(c>=65097&&c<=65103)||tA(c)||Tb(c)||p_(c)||YE(c)||!(!Of(c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Rf(c)||m_(c)||QE(c)||(i=>i>=12592&&i<=12687)(c)||(i=>i>=43360&&i<=43391)(c)||(i=>i>=55216&&i<=55295)(c)||(i=>i>=4352&&i<=4607)(c)||eA(c)||kf(c)||Sb(c)||(i=>i>=12688&&i<=12703)(c)||wb(c)||JE(c)||jm(c)&&c!==12540||!(!Ib(c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!nA(c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||(i=>i>=5120&&i<=5759)(c)||(i=>i>=6320&&i<=6399)(c)||rA(c)||(i=>i>=19904&&i<=19967)(c)||Eb(c)||g_(c))))}function oA(c){return c===12312||c===12313||c===12316||c===12540||c===12448}function kb(c){return!(cd(c)||function(i){return!!((a=>a>=128&&a<=255)(i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||(a=>a>=8192&&a<=8303)(i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||(a=>a>=8448&&a<=8527)(i)||(a=>a>=8528&&a<=8591)(i)||(a=>a>=8960&&a<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||(a=>a>=9216&&a<=9279)(i)&&i!==9251||(a=>a>=9280&&a<=9311)(i)||(a=>a>=9312&&a<=9471)(i)||(a=>a>=9632&&a<=9727)(i)||(a=>a>=9728&&a<=9983)(i)&&!(i>=9754&&i<=9759)||(a=>a>=11008&&a<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Of(i)||jm(i)||(a=>a>=57344&&a<=63743)(i)||Pb(i)||nA(i)||Ib(i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(c))}function y_(c){return ZE(c)||XE(c)||f_(c)||Ab(c)||Cb(c)}function sA(c){return c>=1424&&c<=2303||Ab(c)||Cb(c)}function IR(c,i){return!(!i&&sA(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||(a=>a>=6016&&a<=6143)(c))}function ud(c){for(const i of c)if(sA(i.charCodeAt(0)))return!0;return!1}const ma={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let dd=null,Zs=ma.unavailable,hd=null;const aA=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Zs=ma.error),dd&&dd(c)};function Rb(){Mb.fire(new lu("pluginStateChange",{pluginStatus:Zs,pluginURL:hd}))}const Mb=new cu,Db=function(){return Zs},Lb=function(){if(Zs!==ma.deferred||!hd)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Zs=ma.loading,Rb(),hd&&pm({url:hd},c=>{c?aA(c):(Zs=ma.loaded,Rb())})},Hl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Zs===ma.loaded||Hl.applyArabicShaping!=null,isLoading:()=>Zs===ma.loading,setState(c){Zs=c.pluginStatus,hd=c.pluginURL},isParsing:()=>Zs===ma.parsing,isParsed:()=>Zs===ma.parsed,getPluginURL:()=>hd};class Dn{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(i){return function(a,d){for(const p of a)if(!IR(p.charCodeAt(0),d))return!1;return!0}(i,Hl.isLoaded())}}class Nm{constructor(i,a,d,p,y){this.property=i,this.value=a,this.expression=function(_,b,E,I,M){if(l_(_))return new Lm(_,b);if(Mm(_)||Array.isArray(_)&&_.length>0){const D=u_(_,b,E,I,M);if(D.result==="error")throw new Error(D.value.map(N=>`${N.key}: ${N.message}`).join(", "));return D.value}{let D=_;return typeof _=="string"&&b.type==="color"&&(D=En.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>D}}}(a===void 0?i.specification.default:a,i.specification,d,p,y)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,a,d,p){return this.property.possiblyEvaluate(this,i,a,d,p)}}class zm{constructor(i,a,d,p){this.property=i,this.value=new Nm(i,void 0,a,d,p)}transitioned(i,a){return new lA(this.property,this.value,a,Object.assign({},i.transition,this.transition),i.now)}untransitioned(){return new lA(this.property,this.value,null,{},0)}}class Mf{constructor(i,a,d,p){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._scope=a,this._options=d,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return Or(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new zm(this._values[i].property,this._scope,this._options,this._iconImageUseTheme)),this._values[i].value=new Nm(this._values[i].property,a===null?void 0:Or(a),this._scope,this._options,this._iconImageUseTheme),this._values[i].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].value.isIndoorDependent())}setTransitionOrValue(i,a){a&&(this._options=a);const d=this._properties.properties;if(i)for(const p in i){const y=i[p];if(p.endsWith("-transition")){const _=p.slice(0,-11);d[_]&&this.setTransition(_,y)}else d.hasOwnProperty(p)&&this.setValue(p,y)}}getTransition(i){return Or(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new zm(this._values[i].property)),this._values[i].transition=Or(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(i[a]=d);const p=this.getTransition(a);p!==void 0&&(i[`${a}-transition`]=p)}return i}transitioned(i,a){const d=new cA(this._properties);for(const p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(i,a._values[p]);return d}untransitioned(){const i=new cA(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}isIndoorDependent(){return this._isIndoorDependent}}class lA{constructor(i,a,d,p,y){const _=p.delay||0,b=p.duration||0;y=y||0,this.property=i,this.value=a,this.begin=y+_,this.end=this.begin+b,i.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(i,a,d){const p=i.now||0,y=this.value.possiblyEvaluate(i,a,d),_=this.prior;if(_){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return _.possiblyEvaluate(i,a,d);{const b=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(i,a,d),y,he(b))}}return y}}class cA{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,d){const p=new Xs(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(i,a,d);return p}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class jb{constructor(i,a,d,p){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._scope=a,this._options=d,this._iconImageUseTheme=p,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(i){return Or(this._values[i].value)}setValue(i,a){this._values[i]=new Nm(this._values[i].property,a===null?void 0:Or(a),this._scope,this._options,this._iconImageUseTheme),this._values[i].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[i].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[i].isIndoorDependent())}serialize(){const i={};for(const a of Object.keys(this._values)){const d=this.getValue(a);d!==void 0&&(i[a]=d)}return i}possiblyEvaluate(i,a,d,p){const y=new Xs(this._properties);for(const _ of Object.keys(this._values))y._values[_]=this._values[_].possiblyEvaluate(i,a,d,p);return y}isIndoorDependent(){return this._isIndoorDependent}}class ch{constructor(i,a,d,p){this.property=i,this.value=a,this.parameters=d,this.iconImageUseTheme=p}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,a,d,p){return this.property.evaluate(this.value,this.parameters,i,a,d,p,this.iconImageUseTheme)}}class Xs{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ct{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,d){const p=eh[this.specification.type];return p?p(i,a,d):i}}class zt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,d,p,y){return i.expression.kind==="constant"||i.expression.kind==="camera"?new ch(this,{kind:"constant",value:i.expression.evaluate(a,null,{},d,p,void 0,y)},a):new ch(this,i.expression,a,y)}interpolate(i,a,d){if(i.value.kind!=="constant"||a.value.kind!=="constant")return i;if(i.value.value===void 0||a.value.value===void 0)return new ch(this,{kind:"constant",value:void 0},i.parameters);const p=eh[this.specification.type];return p?new ch(this,{kind:"constant",value:p(i.value.value,a.value.value,d)},i.parameters):i}evaluate(i,a,d,p,y,_,b){return i.kind==="constant"?i.value:i.evaluate(a,d,p,y,_,void 0,b)}}class Df{constructor(i){this.specification=i}possiblyEvaluate(i,a,d,p){return!!i.expression.evaluate(a,null,{},d,p)}interpolate(){return!1}}class bi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Dn(0,{});for(const d in i){const p=i[d];p.specification.overridable&&this.overridableProperties.push(d);const y=this.defaultPropertyValues[d]=new Nm(p,void 0),_=this.defaultTransitionablePropertyValues[d]=new zm(p);this.defaultTransitioningPropertyValues[d]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[d]=y.possiblyEvaluate(a)}}}Wt(zt,"DataDrivenProperty"),Wt(Ct,"DataConstantProperty"),Wt(Df,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function uA(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function __(c){if(Array.isArray(c))return c.map(__);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const i={};for(const a in c)i[a]=__(c[a]);return i}return uA(c)}function Nb(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const i of c.slice(1))if(!Nb(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}function zb(c,i="",a=null,d="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nb(c)||(c=Fm(c));const p=c;let y=!0;try{y=function(M){if(!Lf(M))return M;let D=__(M);return Fb(D),D=dA(D),D}(p)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(p,null,2)}
        `)}let _=null,b=null;if(d!=="background"&&d!=="sky"&&d!=="slot"){b=Ue[`filter_${d}`];const M=ld(y,b,i,a);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,N,V)=>M.value.evaluate(D,N,{},V)}let E=null,I=null;if(y!==p){const M=ld(p,b,i,a);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));E=(D,N,V,G,Y)=>M.value.evaluate(D,N,{},V,void 0,void 0,G,Y),I=!wf(M.value.expression)}return{filter:_,dynamicFilter:E||void 0,needGeometry:Bb(y),needFeature:!!I}}function dA(c){if(!Array.isArray(c))return c;const i=function(a){if(OR.has(a[0])){for(let d=1;d<a.length;d++)if(Lf(a[d]))return!0}return a}(c);return i===!0?i:i.map(a=>dA(a))}function Fb(c){let i=!1;const a=[];if(c[0]==="case"){for(let d=1;d<c.length-1;d+=2)i=i||Lf(c[d]),a.push(c[d+1]);a.push(c[c.length-1])}else if(c[0]==="match"){i=i||Lf(c[1]);for(let d=2;d<c.length-1;d+=2)a.push(c[d+1]);a.push(c[c.length-1])}else if(c[0]==="step"){i=i||Lf(c[1]);for(let d=1;d<c.length-1;d+=2)a.push(c[d+1])}i&&(c.length=0,c.push("any",...a));for(let d=1;d<c.length;d++)Fb(c[d])}function Lf(c){if(!Array.isArray(c))return!1;if((i=c[0])==="pitch"||i==="distance-from-center")return!0;var i;for(let a=1;a<c.length;a++)if(Lf(c[a]))return!0;return!1}const OR=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function kR(c,i){return c<i?-1:c>i?1:0}function Bb(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let i=1;i<c.length;i++)if(Bb(c[i]))return!0;return!1}function Fm(c){if(!c)return!0;const i=c[0];return c.length<=1?i!=="any":i==="=="?Ec(c[1],c[2],"=="):i==="!="?v_(Ec(c[1],c[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Ec(c[1],c[2],i):i==="any"?(a=c.slice(1),["any"].concat(a.map(Fm))):i==="all"?["all"].concat(c.slice(1).map(Fm)):i==="none"?["all"].concat(c.slice(1).map(Fm).map(v_)):i==="in"?$b(c[1],c.slice(2)):i==="!in"?v_($b(c[1],c.slice(2))):i==="has"?hA(c[1]):i!=="!has"||v_(hA(c[1]));var a}function Ec(c,i,a){switch(c){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,c,i]}}function $b(c,i){if(i.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",c,["literal",i.sort(kR)]]:["filter-in-small",c,["literal",i]]}}function hA(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function v_(c){return["!",c]}const Bm="";function uh(c,i){return i?`${c}${Bm}${i}`:c}let Vb;const Ub=()=>Vb||(Vb=new bi({"icon-size":new zt(Ue.layout_symbol["icon-size"]),"icon-image":new zt(Ue.layout_symbol["icon-image"]),"icon-rotate":new zt(Ue.layout_symbol["icon-rotate"]),"icon-offset":new zt(Ue.layout_symbol["icon-offset"]),"text-size":new zt(Ue.layout_symbol["text-size"]),"text-rotate":new zt(Ue.layout_symbol["text-rotate"]),"text-offset":new zt(Ue.layout_symbol["text-offset"])}));class fA{constructor(i,a,d,p,y,_){const b=ld(i,Ue.appearance.condition);if(b.result==="success"&&(this.condition=b.value),this.name=a,d){this.properties=new Xs(Ub()),this.unevaluatedLayout=new jb(Ub(),p,y,_);for(const E in d)this.unevaluatedLayout.setValue(E,d[E])}}isActive(i){return!(this.condition||!i.isHidden||this.name!=="hidden")||this.condition.evaluate(i.globals,i.feature,i.featureState,i.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(i){return this.properties.get(i)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(i){return this.unevaluatedLayout._values[i]}recalculate(i,a,d){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(i,void 0,a,d))}serialize(){const i={};return i.condition=this.condition.expression.serialize(),this.name&&(i.name=this.name),this.unevaluatedLayout&&(i.properties=this.unevaluatedLayout.serialize()),i}hasIconProperties(){const i=this.hasProperty("icon-image"),a=this.hasProperty("icon-size"),d=this.hasProperty("icon-offset"),p=this.hasProperty("icon-rotate");return i||a||d||p}hasTextProperties(){const i=this.hasProperty("text-size"),a=this.hasProperty("text-offset"),d=this.hasProperty("text-rotate");return i||a||d}hasProperty(i){return this.getUnevaluatedProperty(i).value!==void 0}}const pA="-transition",mA=new Set(["fill","line","background","hillshade","raster"]);class Ks extends cu{constructor(i,a,d,p,y,_){if(super(),this.id=i.id,this.fqid=uh(this.id,d),this.type=i.type,this.scope=d,this.lut=p,this.options=y,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},i.type!=="custom"){if(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type&&i.type!=="background"&&i.type!=="sky"&&i.type!=="slot"){this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter;const b=ld(this.filter,Ue[`filter_${i.type}`]);b.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.value.isIndoorDependent)}if(i.slot&&(this.slot=i.slot),i.appearances&&this.setAppearances(i.appearances),a.layout&&(this._unevaluatedLayout=new jb(a.layout,this.scope,y,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new Mf(a.paint,this.scope,y);for(const b in i.paint)this.setPaintProperty(b,i.paint[b]);for(const b in i.layout)this.setLayoutProperty(b,i.layout[b]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Xs(a.paint)}}}onAdd(i){}onRemove(i){}isDraped(i){return!this.is3D(!0)&&mA.has(this.type)}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a){if(this.type==="custom"&&i==="visibility")return void(this.visibility=a);const d=this._unevaluatedLayout;d._properties.properties[i]&&(d.setValue(i,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...d.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||d.isIndoorDependent(),i==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(i){this.appearances=[],i.forEach(a=>{this.appearances.push(new fA(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(i){return i.endsWith(pA)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}isPaintProperty(i){return!!this._transitionablePaint._properties.properties[i]}setPaintProperty(i,a){const d=this._transitionablePaint,p=d._properties.properties;if(i.endsWith(pA)){const D=i.slice(0,-11);return p[D]&&d.setTransition(D,a||void 0),!1}if(!p[i])return!1;const y=d._values[i],_=y.value.isDataDriven(),b=y.value;d.setValue(i,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...d.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||d.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(i);const E=d._values[i].value,I=E.isDataDriven(),M=i.endsWith("pattern")||i==="line-dasharray";return I||_||M||this._handleOverridablePaintPropertyUpdate(i,b,E)}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getDefaultProgramParams(i,a,d){return null}_handleOverridablePaintPropertyUpdate(i,a,d){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(i.appearances=this.appearances.map(a=>a.serialize())),pr(i,(a,d)=>!(a===void 0||d==="layout"&&!Object.keys(a).length||d==="paint"&&!Object.keys(a).length))}is3D(i){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof ch&&a_(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const i of this.appearances)if(!Am(i.condition.expression))return!0;return!1}compileFilter(i){this._filterCompiled||(this._featureFilter=zb(this.filter,this.scope,i),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(i){this._stats&&(i.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(i,a,d){return{}}queryRadius(i){}queryIntersectsFeature(i,a,d,p,y,_,b,E,I,M){}}const gA={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class fd{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const RR=new ArrayBuffer(0);class ti{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(i,a){return i._trim(),a&&i.arrayBuffer&&a.add(i.arrayBuffer),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,i.arrayBuffer?a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement:(a.capacity=0,a.arrayBuffer=RR),a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this._reallocCount++,this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}reserveForAdditional(i){this.reserve(this.length+i)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...i){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...i){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Zr(c,i=1){let a=0,d=0;return{members:c.map(p=>{const y=gA[p.type].BYTES_PER_ELEMENT,_=a=yA(a,Math.max(i,y)),b=p.components||1;return d=Math.max(d,y),a+=y*b,{name:p.name,type:p.type,components:b,offset:_}}),size:yA(a,Math.max(d,i)),alignment:i}}function yA(c,i){return Math.ceil(c/i)*i}class pd extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const p=2*i;return this.int16[p+0]=a,this.int16[p+1]=d,i}}pd.prototype.bytesPerElement=4,Wt(pd,"StructArrayLayout2i4");class pu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=3*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=p,i}}pu.prototype.bytesPerElement=6,Wt(pu,"StructArrayLayout3i6");class mu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=4*i;return this.int16[_+0]=a,this.int16[_+1]=d,this.int16[_+2]=p,this.int16[_+3]=y,i}}mu.prototype.bytesPerElement=8,Wt(mu,"StructArrayLayout4i8");class Ko extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}Ko.prototype.bytesPerElement=4,Wt(Ko,"StructArrayLayout1f4");class jf extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=4*i,_=2*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.float32[_+1]=p,i}}jf.prototype.bytesPerElement=8,Wt(jf,"StructArrayLayout2i1f8");class Gb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=4*i;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=p,i}}Gb.prototype.bytesPerElement=8,Wt(Gb,"StructArrayLayout3i8");class qb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const b=5*i;return this.int16[b+0]=a,this.int16[b+1]=d,this.int16[b+2]=p,this.int16[b+3]=y,this.int16[b+4]=_,i}}qb.prototype.bytesPerElement=10,Wt(qb,"StructArrayLayout5i10");class Hb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,d,p,y,_,b)}emplace(i,a,d,p,y,_,b,E){const I=6*i,M=12*i,D=3*i;return this.int16[I+0]=a,this.int16[I+1]=d,this.uint8[M+4]=p,this.uint8[M+5]=y,this.uint8[M+6]=_,this.uint8[M+7]=b,this.float32[D+2]=E,i}}Hb.prototype.bytesPerElement=12,Wt(Hb,"StructArrayLayout2i4ub1f12");class Il extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=3*i;return this.float32[y+0]=a,this.float32[y+1]=d,this.float32[y+2]=p,i}}Il.prototype.bytesPerElement=12,Wt(Il,"StructArrayLayout3f12");class Ac extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const b=6*i,E=3*i;return this.uint16[b+0]=a,this.uint16[b+1]=d,this.uint16[b+2]=p,this.uint16[b+3]=y,this.float32[E+2]=_,i}}Ac.prototype.bytesPerElement=12,Wt(Ac,"StructArrayLayout4ui1f12");class Nf extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=4*i;return this.uint16[_+0]=a,this.uint16[_+1]=d,this.uint16[_+2]=p,this.uint16[_+3]=y,i}}Nf.prototype.bytesPerElement=8,Wt(Nf,"StructArrayLayout4ui8");class zf extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,b){const E=6*i;return this.int16[E+0]=a,this.int16[E+1]=d,this.int16[E+2]=p,this.int16[E+3]=y,this.int16[E+4]=_,this.int16[E+5]=b,i}}zf.prototype.bytesPerElement=12,Wt(zf,"StructArrayLayout6i12");class Wb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I,M,D,N){const V=this.length;return this.resize(V+1),this.emplace(V,i,a,d,p,y,_,b,E,I,M,D,N)}emplace(i,a,d,p,y,_,b,E,I,M,D,N,V){const G=12*i;return this.int16[G+0]=a,this.int16[G+1]=d,this.int16[G+2]=p,this.int16[G+3]=y,this.uint16[G+4]=_,this.uint16[G+5]=b,this.uint16[G+6]=E,this.uint16[G+7]=I,this.int16[G+8]=M,this.int16[G+9]=D,this.int16[G+10]=N,this.int16[G+11]=V,i}}Wb.prototype.bytesPerElement=24,Wt(Wb,"StructArrayLayout4i4ui4i24");class Zb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,b){const E=10*i,I=5*i;return this.int16[E+0]=a,this.int16[E+1]=d,this.int16[E+2]=p,this.float32[I+2]=y,this.float32[I+3]=_,this.float32[I+4]=b,i}}Zb.prototype.bytesPerElement=20,Wt(Zb,"StructArrayLayout3i3f20");class md extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=4*i;return this.float32[_+0]=a,this.float32[_+1]=d,this.float32[_+2]=p,this.float32[_+3]=y,i}}md.prototype.bytesPerElement=16,Wt(md,"StructArrayLayout4f16");class Xb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}Xb.prototype.bytesPerElement=4,Wt(Xb,"StructArrayLayout1ul4");class Qa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const p=2*i;return this.uint16[p+0]=a,this.uint16[p+1]=d,i}}Qa.prototype.bytesPerElement=4,Wt(Qa,"StructArrayLayout2ui4");class $m extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I,M,D,N,V){const G=this.length;return this.resize(G+1),this.emplace(G,i,a,d,p,y,_,b,E,I,M,D,N,V)}emplace(i,a,d,p,y,_,b,E,I,M,D,N,V,G){const Y=20*i,re=10*i;return this.int16[Y+0]=a,this.int16[Y+1]=d,this.int16[Y+2]=p,this.int16[Y+3]=y,this.int16[Y+4]=_,this.float32[re+3]=b,this.float32[re+4]=E,this.float32[re+5]=I,this.float32[re+6]=M,this.int16[Y+14]=D,this.uint32[re+8]=N,this.uint16[Y+18]=V,this.uint16[Y+19]=G,i}}$m.prototype.bytesPerElement=40,Wt($m,"StructArrayLayout5i4f1i1ul2ui40");class x_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,d,p,y,_,b)}emplace(i,a,d,p,y,_,b,E){const I=8*i;return this.int16[I+0]=a,this.int16[I+1]=d,this.int16[I+2]=p,this.int16[I+4]=y,this.int16[I+5]=_,this.int16[I+6]=b,this.int16[I+7]=E,i}}x_.prototype.bytesPerElement=16,Wt(x_,"StructArrayLayout3i2i2i16");class b_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const b=4*i,E=8*i;return this.float32[b+0]=a,this.float32[b+1]=d,this.float32[b+2]=p,this.int16[E+6]=y,this.int16[E+7]=_,i}}b_.prototype.bytesPerElement=16,Wt(b_,"StructArrayLayout2f1f2i16");class w_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,b){const E=20*i,I=5*i;return this.uint8[E+0]=a,this.uint8[E+1]=d,this.float32[I+1]=p,this.float32[I+2]=y,this.float32[I+3]=_,this.float32[I+4]=b,i}}w_.prototype.bytesPerElement=20,Wt(w_,"StructArrayLayout2ub4f20");class go extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d){const p=this.length;return this.resize(p+1),this.emplace(p,i,a,d)}emplace(i,a,d,p){const y=3*i;return this.uint16[y+0]=a,this.uint16[y+1]=d,this.uint16[y+2]=p,i}}go.prototype.bytesPerElement=6,Wt(go,"StructArrayLayout3ui6");class Vm extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e){const ye=this.length;return this.resize(ye+1),this.emplace(ye,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e)}emplace(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e,ye){const Te=30*i,Ae=15*i,Se=60*i;return this.int16[Te+0]=a,this.int16[Te+1]=d,this.int16[Te+2]=p,this.float32[Ae+2]=y,this.float32[Ae+3]=_,this.uint16[Te+8]=b,this.uint16[Te+9]=E,this.uint32[Ae+5]=I,this.uint32[Ae+6]=M,this.uint32[Ae+7]=D,this.uint16[Te+16]=N,this.uint16[Te+17]=V,this.uint16[Te+18]=G,this.float32[Ae+10]=Y,this.float32[Ae+11]=re,this.uint8[Se+48]=J,this.uint8[Se+49]=oe,this.uint8[Se+50]=le,this.uint32[Ae+13]=de,this.int16[Te+28]=_e,this.uint8[Se+58]=ye,i}}Vm.prototype.bytesPerElement=60,Wt(Vm,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ff extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e,ye,Te,Ae,Se,Oe,Me,st,et,it,mt,ft,pt){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e,ye,Te,Ae,Se,Oe,Me,st,et,it,mt,ft,pt)}emplace(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e,ye,Te,Ae,Se,Oe,Me,st,et,it,mt,ft,pt,Ke){const yt=20*i,ut=40*i,_t=80*i;return this.float32[yt+0]=a,this.float32[yt+1]=d,this.int16[ut+4]=p,this.int16[ut+5]=y,this.int16[ut+6]=_,this.int16[ut+7]=b,this.int16[ut+8]=E,this.int16[ut+9]=I,this.int16[ut+10]=M,this.int16[ut+11]=D,this.int16[ut+12]=N,this.uint16[ut+13]=V,this.uint16[ut+14]=G,this.uint16[ut+15]=Y,this.uint16[ut+16]=re,this.uint16[ut+17]=J,this.uint16[ut+18]=oe,this.uint16[ut+19]=le,this.uint16[ut+20]=de,this.uint16[ut+21]=_e,this.uint16[ut+22]=ye,this.uint16[ut+23]=Te,this.uint16[ut+24]=Ae,this.uint16[ut+25]=Se,this.uint16[ut+26]=Oe,this.uint16[ut+27]=Me,this.uint32[yt+14]=st,this.float32[yt+15]=et,this.float32[yt+16]=it,this.float32[yt+17]=mt,this.float32[yt+18]=ft,this.uint8[_t+76]=pt,this.uint16[ut+39]=Ke,i}}Ff.prototype.bytesPerElement=80,Wt(Ff,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class S_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_){const b=this.length;return this.resize(b+1),this.emplace(b,i,a,d,p,y,_)}emplace(i,a,d,p,y,_,b){const E=6*i;return this.float32[E+0]=a,this.float32[E+1]=d,this.float32[E+2]=p,this.float32[E+3]=y,this.float32[E+4]=_,this.float32[E+5]=b,i}}S_.prototype.bytesPerElement=24,Wt(S_,"StructArrayLayout6f24");class dh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y){const _=this.length;return this.resize(_+1),this.emplace(_,i,a,d,p,y)}emplace(i,a,d,p,y,_){const b=5*i;return this.float32[b+0]=a,this.float32[b+1]=d,this.float32[b+2]=p,this.float32[b+3]=y,this.float32[b+4]=_,i}}dh.prototype.bytesPerElement=20,Wt(dh,"StructArrayLayout5f20");class T_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,d,p,y,_,b)}emplace(i,a,d,p,y,_,b,E){const I=7*i;return this.float32[I+0]=a,this.float32[I+1]=d,this.float32[I+2]=p,this.float32[I+3]=y,this.float32[I+4]=_,this.float32[I+5]=b,this.float32[I+6]=E,i}}T_.prototype.bytesPerElement=28,Wt(T_,"StructArrayLayout7f28");class Kb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I,M,D){const N=this.length;return this.resize(N+1),this.emplace(N,i,a,d,p,y,_,b,E,I,M,D)}emplace(i,a,d,p,y,_,b,E,I,M,D,N){const V=11*i;return this.float32[V+0]=a,this.float32[V+1]=d,this.float32[V+2]=p,this.float32[V+3]=y,this.float32[V+4]=_,this.float32[V+5]=b,this.float32[V+6]=E,this.float32[V+7]=I,this.float32[V+8]=M,this.float32[V+9]=D,this.float32[V+10]=N,i}}Kb.prototype.bytesPerElement=44,Wt(Kb,"StructArrayLayout11f44");class Um extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I){const M=this.length;return this.resize(M+1),this.emplace(M,i,a,d,p,y,_,b,E,I)}emplace(i,a,d,p,y,_,b,E,I,M){const D=9*i;return this.float32[D+0]=a,this.float32[D+1]=d,this.float32[D+2]=p,this.float32[D+3]=y,this.float32[D+4]=_,this.float32[D+5]=b,this.float32[D+6]=E,this.float32[D+7]=I,this.float32[D+8]=M,i}}Um.prototype.bytesPerElement=36,Wt(Um,"StructArrayLayout9f36");class hh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const d=this.length;return this.resize(d+1),this.emplace(d,i,a)}emplace(i,a,d){const p=2*i;return this.float32[p+0]=a,this.float32[p+1]=d,i}}hh.prototype.bytesPerElement=8,Wt(hh,"StructArrayLayout2f8");class Yb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,d,p){const y=this.length;return this.resize(y+1),this.emplace(y,i,a,d,p)}emplace(i,a,d,p,y){const _=6*i;return this.uint32[3*i+0]=a,this.uint16[_+2]=d,this.uint16[_+3]=p,this.uint16[_+4]=y,i}}Yb.prototype.bytesPerElement=12,Wt(Yb,"StructArrayLayout1ul3ui12");class Gm extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}Gm.prototype.bytesPerElement=2,Wt(Gm,"StructArrayLayout1ui2");class Jb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re){const J=this.length;return this.resize(J+1),this.emplace(J,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re)}emplace(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J){const oe=16*i;return this.float32[oe+0]=a,this.float32[oe+1]=d,this.float32[oe+2]=p,this.float32[oe+3]=y,this.float32[oe+4]=_,this.float32[oe+5]=b,this.float32[oe+6]=E,this.float32[oe+7]=I,this.float32[oe+8]=M,this.float32[oe+9]=D,this.float32[oe+10]=N,this.float32[oe+11]=V,this.float32[oe+12]=G,this.float32[oe+13]=Y,this.float32[oe+14]=re,this.float32[oe+15]=J,i}}Jb.prototype.bytesPerElement=64,Wt(Jb,"StructArrayLayout16f64");class qm extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,d,p,y,_,b){const E=this.length;return this.resize(E+1),this.emplace(E,i,a,d,p,y,_,b)}emplace(i,a,d,p,y,_,b,E){const I=10*i,M=5*i;return this.uint16[I+0]=a,this.uint16[I+1]=d,this.uint16[I+2]=p,this.uint16[I+3]=y,this.float32[M+2]=_,this.float32[M+3]=b,this.float32[M+4]=E,i}}qm.prototype.bytesPerElement=20,Wt(qm,"StructArrayLayout4ui3f20");class Qb extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.int16[1*i+0]=a,i}}Qb.prototype.bytesPerElement=2,Wt(Qb,"StructArrayLayout1i2");class E_ extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint8[1*i+0]=a,i}}E_.prototype.bytesPerElement=1,Wt(E_,"StructArrayLayout1ub1");class _A extends fd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_A.prototype.size=40;class vA extends $m{get(i){return new _A(this,i)}}Wt(vA,"CollisionBoxArray");class xA extends fd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}xA.prototype.size=60;class bA extends Vm{get(i){return new xA(this,i)}}Wt(bA,"PlacedSymbolArray");class wA extends fd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(i){this._structArray.uint32[this._pos4+14]=i}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(i){this._structArray.float32[this._pos4+18]=i}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}wA.prototype.size=80;class SA extends Ff{get(i){return new wA(this,i)}}Wt(SA,"SymbolInstanceArray");class Hm extends Ko{getoffsetX(i){return this.float32[1*i+0]}}Wt(Hm,"GlyphOffsetArray");class TA extends pd{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Wt(TA,"SymbolLineVertexArray");class EA extends fd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}EA.prototype.size=12;class Wm extends Yb{get(i){return new EA(this,i)}}Wt(Wm,"FeatureIndexArray");class AA extends Qa{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Wt(AA,"FillExtrusionCentroidArray");class ew extends fd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ew.prototype.size=6;class PA extends pu{get(i){return new ew(this,i)}}Wt(PA,"FillExtrusionWallArray");const CA=Zr([{name:"a_pos",components:2,type:"Int16"}],4),IA=Zr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),OA=Zr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class di{constructor(i=[]){this.segments=i}_prepareSegment(i,a,d,p){let y=this.segments[this.segments.length-1];return i>di.MAX_VERTEX_ARRAY_LENGTH&&vr(`Max vertices per segment is ${di.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!y||y.vertexLength+i>di.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:a,primitiveOffset:d,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}prepareSegment(i,a,d,p){return this._prepareSegment(i,a.length,d.length,p)}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,d,p){return new di([{vertexOffset:i,primitiveOffset:a,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}function kA(c,i){return 256*(c=we(Math.floor(c),0,255))+we(Math.floor(i),0,255)}di.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Wt(di,"SegmentVector");const RA=Zr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),MR=Zr([{name:"a_pattern_b",components:4,type:"Uint16"}]),DR=Zr([{name:"a_dash",components:4,type:"Uint16"}]);class Zm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(i,a,d,p){this.ids.push(MA(i)),this.positions.push(a,d,p)}eachPosition(i,a){const d=MA(i);let p=0,y=this.ids.length-1;for(;p<y;){const _=p+y>>1;this.ids[_]>=d?y=_:p=_+1}for(;this.ids[p]===d;)a(this.positions[3*p],this.positions[3*p+1],this.positions[3*p+2]),p++}static serialize(i,a){const d=new Float64Array(i.ids),p=new Uint32Array(i.positions);return tw(d,p,0,d.length-1),a&&(a.add(d.buffer),a.add(p.buffer)),{ids:d,positions:p}}static deserialize(i){const a=new Zm;let d;a.ids=i.ids,a.positions=i.positions;for(const p of a.ids)p!==d&&a.uniqueIds.push(p),d=p;return a.indexed=!0,a}}function MA(c){const i=+c;return Number.isSafeInteger(i)?i:mf(String(c))}function tw(c,i,a,d){for(;a<d;){const p=c[a+d>>1];let y=a-1,_=d+1;for(;;){do y++;while(c[y]<p);do _--;while(c[_]>p);if(y>=_)break;Xm(c,y,_),Xm(i,3*y,3*_),Xm(i,3*y+1,3*_+1),Xm(i,3*y+2,3*_+2)}_-a<d-_?(tw(c,i,a,_),a=_+1):(tw(c,i,_+1,d),d=_)}}function Xm(c,i,a){const d=c[i];c[i]=c[a],c[a]=d}Wt(Zm,"FeaturePositionMap");class Wl{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}set(i,a,d){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class el extends Wl{constructor(i){super(i),this.current=0}set(i,a,d){this.fetchUniformLocation(i,a)&&this.current!==d&&(this.current=d,this.gl.uniform1i(this.location,d))}}class Qi extends Wl{constructor(i){super(i),this.current=0}set(i,a,d){this.fetchUniformLocation(i,a)&&this.current!==d&&(this.current=d,this.gl.uniform1f(this.location,d))}}class tl extends Wl{constructor(i){super(i),this.current=[0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]||(this.current=d,this.gl.uniform2f(this.location,d[0],d[1])))}}class Km extends Wl{constructor(i){super(i),this.current=[0,0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]||(this.current=d,this.gl.uniform3f(this.location,d[0],d[1],d[2])))}}class A_ extends Wl{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,d){this.fetchUniformLocation(i,a)&&(d[0]===this.current[0]&&d[1]===this.current[1]&&d[2]===this.current[2]&&d[3]===this.current[3]||(this.current=d,this.gl.uniform4f(this.location,d[0],d[1],d[2],d[3])))}}class DA extends Wl{constructor(i){super(i),this.current=En.transparent.toPremultipliedRenderColor(null)}set(i,a,d){this.fetchUniformLocation(i,a)&&(d.r===this.current.r&&d.g===this.current.g&&d.b===this.current.b&&d.a===this.current.a||(this.current=d,this.gl.uniform4f(this.location,d.r,d.g,d.b,d.a)))}}const LR=new Float32Array(16);class Bf extends Wl{constructor(i){super(i),this.current=LR}set(i,a,d){if(this.fetchUniformLocation(i,a)){if(d[12]!==this.current[12]||d[0]!==this.current[0])return this.current=d,void this.gl.uniformMatrix4fv(this.location,!1,d);for(let p=1;p<16;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix4fv(this.location,!1,d);break}}}}const q4=new Float32Array(9),m=new Float32Array(4);class s extends Wl{constructor(i){super(i),this.current=m}set(i,a,d){if(this.fetchUniformLocation(i,a)){for(let p=0;p<4;p++)if(d[p]!==this.current[p]){this.current=d,this.gl.uniformMatrix2fv(this.location,!1,d);break}}}}function h(c){return[kA(255*c.r,255*c.g),kA(255*c.b,255*c.a)]}function g(c,i,a,d,p,y,_,b){return!!c&&(c.kind==="composite"||c.kind==="source"?c.evaluate(new Dn(0,{brightness:y,worldview:b}),i,a,p,d,_)==="none":c.value==="none")}class x{constructor(i,a,d,p){this.value=i,this.uniformNames=a.map(y=>`u_${y}`),this.type=d,this.context=p}setUniform(i,a,d,p,y){const _=p.constantOr(this.value);a.set(i,y,_ instanceof En?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(i,a){return this.type==="color"?new DA(i):new Qi(i)}}class S{constructor(i,a){this.uniformNames=a.map(d=>`u_${d}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(i,a){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(i,a,d,p,y){let _=null;y!=="u_pattern"&&y!=="u_dash"||(_=this.pattern),y==="u_pattern_b"&&(_=this.patternTransition),y==="u_pixel_ratio"&&(_=this.pixelRatio),_&&a.set(i,y,_)}getBinding(i,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new A_(i):new Qi(i)}}class T{constructor(i,a,d,p){this.expression=i,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(i,a,d,p,y,_,b,E){const I=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Dn(0,{brightness:_,worldview:E}),a,{},y,p,b):this.expression.kind==="constant"&&this.expression.value,D=g(this.lutExpression,a,{},p,y,_,b,E);this.paintVertexArray.resize(i),this._setPaintValue(I,i,M,D?null:this.context.lut)}updatePaintArray(i,a,d,p,y,_,b,E){const I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:E},d,p,void 0,y):this.expression.kind==="constant"&&this.expression.value,M=g(this.lutExpression,d,p,y,void 0,b,void 0,E);this._setPaintValue(i,a,I,M?null:this.context.lut)}_setPaintValue(i,a,d,p){if(this.type==="color"){const y=h(d.toPremultipliedRenderColor(p));for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,y[0],y[1])}else{for(let y=i;y<a;y++)this.paintVertexArray.emplace(y,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class O{constructor(i,a,d,p,y,_){this.expression=i,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=d,this.useIntegerZoom=p,this.context=y,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(i,a,d,p,y,_,b,E){const I=this.expression.evaluate(new Dn(this.context.zoom,{brightness:_,worldview:E}),a,{},y,p,b),M=this.expression.evaluate(new Dn(this.context.zoom+1,{brightness:_,worldview:E}),a,{},y,p,b),D=g(this.lutExpression,a,{},p,y,_,b,E),N=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(N,i,I,M,D?null:this.context.lut)}updatePaintArray(i,a,d,p,y,_,b,E){const I=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:E},d,p,void 0,y),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:E},d,p,void 0,y),D=g(this.lutExpression,d,p,y,void 0,b,void 0,E);this._setPaintValue(i,a,I,M,D?null:this.context.lut)}_setPaintValue(i,a,d,p,y){if(this.type==="color"){const _=h(d.toPremultipliedRenderColor(y)),b=h(p.toPremultipliedRenderColor(y));for(let E=i;E<a;E++)this.paintVertexArray.emplace(E,_[0],_[1],b[0],b[1])}else{for(let _=i;_<a;_++)this.paintVertexArray.emplace(_,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,d,p,y){const _=this.useIntegerZoom?Math.floor(d.zoom):d.zoom,b=we(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);a.set(i,y,b)}getBinding(i,a){return new Qi(i)}}class R{constructor(i,a,d,p,y){this.expression=i,this.layerId=y,this.paintVertexAttributes=(d==="array"?DR:RA).members;for(let _=0;_<a.length;++_);this.paintVertexArray=new p,this.paintTransitionVertexArray=new Nf}populatePaintArray(i,a,d,p){const y=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(y,i,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(i,a,d,p,y,_,b){this._setPaintValues(i,a,d.patterns&&d.patterns[this.layerId],_)}_setPaintValues(i,a,d,p){if(!p||!d)return;const y=p[d[0]],_=p[d[1]];if(y){if(y){const{tl:b,br:E,pixelRatio:I}=y;for(let M=i;M<a;M++)this.paintVertexArray.emplace(M,b[0],b[1],E[0],E[1],I)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:E}=_;for(let I=i;I<a;I++)this.paintTransitionVertexArray.emplace(I,b[0],b[1],E[0],E[1])}}}upload(i){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=i.createVertexBuffer(this.paintTransitionVertexArray,MR.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class z{constructor(i,a,d=()=>!0){this.binders={},this._buffers=[],this.context=a;const p=[];for(const y in i.paint._values){const _=i.paint.get(y);if(y.endsWith("-use-theme")||!d(y)||!(_ instanceof ch&&a_(_.property.specification)))continue;const b=W(y,i.type),E=_.value,I=_.property.specification.type,M=!!_.property.useIntegerZoom,D=y==="line-dasharray"||y.endsWith("pattern"),N=i.paint.get(`${y}-use-theme`),V=y==="line-dasharray"&&i.layout.get("line-cap").value.kind!=="constant"||N&&N.value.kind!=="constant";if(E.kind!=="constant"||V)if(E.kind==="source"||V||D){const G=ee(y,I,"source");this.binders[y]=D?new R(E,b,I,G,i.id):new T(E,b,I,G),p.push(`/a_${y}`)}else{const G=ee(y,I,"composite");this.binders[y]=new O(E,b,I,M,a,G),p.push(`/z_${y}`)}else this.binders[y]=D?new S(E.value,b):new x(E.value,b,I,a),p.push(`/u_${y}`);N&&(this.binders[y].lutExpression=N.value)}this.cacheKey=p.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof T||a instanceof O?a.maxValue:0}populatePaintArrays(i,a,d,p,y,_,b,E){for(const I in this.binders){const M=this.binders[I];M.context=this.context,(M instanceof T||M instanceof O||M instanceof R)&&M.populatePaintArray(i,a,d,p,y,_,b,E)}}setConstantPatternPositions(i,a){for(const d in this.binders){const p=this.binders[d];p instanceof S&&p.setConstantPatternPositions(i,a)}}getPatternTransitionVertexBuffer(i){const a=this.binders[i];return a instanceof R?a.paintTransitionVertexBuffer:null}updatePaintArrays(i,a,d,p,y,_,b,E,I,M){let D=!1;const N=Object.keys(i),V=N.length!==0&&!E,G=V?N:a.uniqueIds;this.context.lut=y.lut;for(const Y in this.binders){const re=this.binders[Y];if(re.context=this.context,(re instanceof T||re instanceof O||re instanceof R)&&re.expression&&re.expression.kind&&re.expression.kind!=="constant"&&(re.expression.isStateDependent===!0||re.expression.isLightConstant===!1)){const J=y.paint.get(Y);re.expression=J.value;for(const oe of G){const le=i[oe.toString()];a.eachPosition(oe,(de,_e,ye)=>{const Te=p.feature(de);re.updatePaintArray(_e,ye,Te,le,_,b,I,M)})}if(!V)for(const oe of d.uniqueIds){const le=i[oe.toString()];d.eachPosition(oe,(de,_e,ye)=>{const Te=p.feature(de);re.updatePaintArray(_e,ye,Te,le,_,b,I,M)})}D=!0}}return D}defines(){const i=[];for(const a in this.binders){const d=this.binders[a];(d instanceof x||d instanceof S)&&i.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const d in this.binders){const p=this.binders[d];if(p instanceof x||p instanceof S||p instanceof O)for(const y of p.uniformNames)a.push({name:y,property:d,binding:p.getBinding(i,y)})}return a}setUniforms(i,a,d,p,y){for(const{name:_,property:b,binding:E}of d)this.binders[b].setUniform(i,E,y,p.get(b),_)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const a=this.binders[i];(a instanceof T||a instanceof O||a instanceof R)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof R&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(i){for(const a in this.binders){const d=this.binders[a];(d instanceof T||d instanceof O||d instanceof R)&&d.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof T||a instanceof O||a instanceof R)&&a.destroy()}}}class F{constructor(i,a,d=()=>!0){this.programConfigurations={};for(const p of i)this.programConfigurations[p.id]=new z(p,a,d);this.needsUpload=!1,this._featureMap=new Zm,this._featureMapWithoutIds=new Zm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(i,a,d,p,y,_,b,E,I){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(i,a,p,y,_,b,E,I);a.id!==void 0?this._featureMap.add(a.id,d,this._bufferOffset,i):(this._featureMapWithoutIds.add(this._idlessCounter,d,this._bufferOffset,i),this._idlessCounter+=1),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,d,p,y,_,b,E){for(const I of d)this.needsUpload=this.programConfigurations[I.id].updatePaintArrays(i,this._featureMap,this._featureMapWithoutIds,a,I,p,y,_,b||0,E)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const Z={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function W(c,i){return Z[c]||[c.replace(`${i}-`,"").replace(/-/g,"_")]}const K={"line-pattern":{source:Ac,composite:Ac},"fill-pattern":{source:Ac,composite:Ac},"fill-extrusion-pattern":{source:Ac,composite:Ac},"line-dasharray":{source:Nf,composite:Nf}},ne={color:{source:hh,composite:md},number:{source:Ko,composite:hh}};function ee(c,i,a){const d=K[c];return d&&d[a]||ne[i][a]}Wt(x,"ConstantBinder"),Wt(S,"PatternConstantBinder"),Wt(T,"SourceExpressionBinder"),Wt(R,"PatternCompositeBinder"),Wt(O,"CompositeExpressionBinder"),Wt(z,"ProgramConfiguration",{omit:["_buffers"]}),Wt(F,"ProgramConfigurationSet");const ie=Mt/Math.PI/2,ce=64,ge=[ce,32,16],pe=-ie,fe=ie;function Ie(c,i,a,d=ie){return a=an(a),[c*Math.sin(a)*d,-i*d,c*Math.cos(a)*d]}function Ee(c,i,a){return Ie(Math.cos(an(c)),Math.sin(an(c)),i,a)}const Pe=63710088e-1,be=2*Math.PI*Pe;class ve{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ve(Ye(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,d=this.lat*a,p=i.lat*a,y=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((i.lng-this.lng)*a);return Pe*Math.acos(Math.min(y,1))}toBounds(i=0){const a=360*i/40075017,d=a/Math.cos(Math.PI/180*this.lat);return new ke({lng:this.lng-d,lat:this.lat-a},{lng:this.lng+d,lat:this.lat+a})}toEcef(i){return Ee(this.lat,this.lng,ie+i*ie/Pe)}static convert(i){if(i instanceof ve)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new ve(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new ve(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ke{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):Array.isArray(i)&&i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof ve?new ve(i.lng,i.lat):ve.convert(i),this}setSouthWest(i){return this._sw=i instanceof ve?new ve(i.lng,i.lat):ve.convert(i),this}extend(i){const a=this._sw,d=this._ne;let p,y;if(i instanceof ve)p=i,y=i;else{if(!(i instanceof ke))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ke.convert(i)):this.extend(ve.convert(i)):typeof i=="object"&&i!==null&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(ve.convert(i)):this;if(p=i._sw,y=i._ne,!p||!y)return this}return a||d?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),d.lng=Math.max(y.lng,d.lng),d.lat=Math.max(y.lat,d.lat)):(this._sw=new ve(p.lng,p.lat),this._ne=new ve(y.lng,y.lat)),this}getCenter(){return new ve((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ve(this.getWest(),this.getNorth())}getSouthEast(){return new ve(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:d}=ve.convert(i);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&p}static convert(i){if(i)return i instanceof ke?i:new ke(i)}}function Ne(c){return be*Math.cos(c*Math.PI/180)}function $e(c){return(180+c)/360}function Je(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function Xe(c,i){return c/Ne(i)}function ht(c){return 360*c-180}function vt(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function We(c,i){return c*Ne(vt(i))}const Re=85.051129;function lt(c){return Math.cos(an(we(c,-85.051129,Re)))}function Qe(c,i){const a=we(i,0,25.5),d=Math.pow(2,a);return lt(c)*be/(512*d)}function bt(c){return 1/Math.cos(c*Math.PI/180)}function At(c,i=0){const a=Math.exp(Math.PI*(1-(c.y+i/Mt)/(1<<c.z)*2));return 80150034*a/(a*a+1)/Mt/(1<<c.z)}class Lt{constructor(i,a,d=0){this.x=+i,this.y=+a,this.z=+d}static fromLngLat(i,a=0){const d=ve.convert(i);return new Lt($e(d.lng),Je(d.lat),Xe(a,d.lat))}toLngLat(){return new ve(ht(this.x),vt(this.y))}toAltitude(){return We(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/be*bt(vt(this.y))}}function Pt(c,i,a,d,p,y,_,b,E){const I=(i+d)/2,M=(a+p)/2,D=new wt(I,M);b(D),function(N,V,G,Y,re,J){const oe=G-re,le=Y-J;return Math.abs((Y-V)*oe-(G-N)*le)/Math.hypot(oe,le)}(D.x,D.y,y.x,y.y,_.x,_.y)>=E?(Pt(c,i,a,I,M,y,D,b,E),Pt(c,I,M,d,p,D,_,b,E)):c.push(_)}function It(c,i,a){let d=c[0],p=d.x,y=d.y;i(d);const _=[d];for(let b=1;b<c.length;b++){const E=c[b],{x:I,y:M}=E;i(E),Pt(_,p,y,I,M,d,E,i,a),p=I,y=M,d=E}return _}function Kt(c,i,a,d){if(d(i,a)){const p=i.add(a)._mult(.5);Kt(c,i,p,d),Kt(c,p,a,d)}else c.push(a)}function Xt(c,i){let a=c[0];const d=[a];for(let p=1;p<c.length;p++){const y=c[p];Kt(d,a,y,i),a=y}return d}const Bt=Math.pow(2,14)-1,Zt=-Bt-1;function or(c,i){const a=Math.round(c.x*i),d=Math.round(c.y*i);return c.x=we(a,Zt,Bt),c.y=we(d,Zt,Bt),(a<c.x||a>c.x+1||d<c.y||d>c.y+1)&&vr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function yr(c,i,a){const d=c.loadGeometry(),p=c.extent,y=Mt/p;if(i&&a&&a.projection.isReprojectedInTileSpace){const _=1<<i.z,{scale:b,x:E,y:I,projection:M}=a,D=N=>{const V=ht((i.x+N.x/p)/_),G=vt((i.y+N.y/p)/_),Y=M.project(V,G);N.x=(Y.x*b-E)*p,N.y=(Y.y*b-I)*p};for(let N=0;N<d.length;N++)if(c.type!==1)d[N]=It(d[N],D,1);else{const V=[];for(const G of d[N])G.x<0||G.x>=p||G.y<0||G.y>=p||(D(G),V.push(G));d[N]=V}}for(const _ of d)for(const b of _)or(b,y);return d}function Lr(c,i){return{type:c.type,id:c.id,properties:c.properties,geometry:i?yr(c):[]}}class Jr{constructor(i,a,d,p,y){this.properties={},this.extent=d,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=p,this._values=y,i.readFields(Tr,this,a)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos,d=[];let p,y=1,_=0,b=0,E=0;for(;i.pos<a;){if(_<=0){const I=i.readVarint();y=7&I,_=I>>3}if(_--,y===1||y===2)b+=i.readSVarint(),E+=i.readSVarint(),y===1&&(p&&d.push(p),p=[]),p&&p.push(new wt(b,E));else{if(y!==7)throw new Error(`unknown command ${y}`);p&&p.push(p[0].clone())}}return p&&d.push(p),d}bbox(){const i=this._pbf;i.pos=this._geometry;const a=i.readVarint()+i.pos;let d=1,p=0,y=0,_=0,b=1/0,E=-1/0,I=1/0,M=-1/0;for(;i.pos<a;){if(p<=0){const D=i.readVarint();d=7&D,p=D>>3}if(p--,d===1||d===2)y+=i.readSVarint(),_+=i.readSVarint(),y<b&&(b=y),y>E&&(E=y),_<I&&(I=_),_>M&&(M=_);else if(d!==7)throw new Error(`unknown command ${d}`)}return[b,I,E,M]}toGeoJSON(i,a,d){const p=this.extent*Math.pow(2,d),y=this.extent*i,_=this.extent*a,b=this.loadGeometry();function E(N){return[360*(N.x+y)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(N.y+_)/p)*Math.PI))-90]}function I(N){return N.map(E)}let M;if(this.type===1){const N=[];for(const G of b)N.push(G[0]);const V=I(N);M=N.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const N=b.map(I);M=N.length===1?{type:"LineString",coordinates:N[0]}:{type:"MultiLineString",coordinates:N}}else{if(this.type!==3)throw new Error("unknown feature type");{const N=function(G){const Y=G.length;if(Y<=1)return[G];const re=[];let J,oe;for(let le=0;le<Y;le++){const de=ln(G[le]);de!==0&&(oe===void 0&&(oe=de<0),oe===de<0?(J&&re.push(J),J=[G[le]]):J&&J.push(G[le]))}return J&&re.push(J),re}(b),V=[];for(const G of N)V.push(G.map(I));M=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const D={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function Tr(c,i,a){c===1?i.id=a.readVarint():c===2?function(d,p){const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=p._keys[d.readVarint()],b=p._values[d.readVarint()];p.properties[_]=b}}(a,i):c===3?i.type=a.readVarint():c===4&&(i._geometry=a.pos)}function ln(c){let i=0;for(let a,d,p=0,y=c.length,_=y-1;p<y;_=p++)a=c[p],d=c[_],i+=(d.x-a.x)*(a.y+d.y);return i}Jr.types=["Unknown","Point","LineString","Polygon"];class Cr{constructor(i,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(In,this,a),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const a=this._pbf.readVarint()+this._pbf.pos;return new Jr(this._pbf,a,this.extent,this._keys,this._values)}}function In(c,i,a){c===15?i.version=a.readVarint():c===1?i.name=a.readString():c===5?i.extent=a.readVarint():c===2?i._features.push(a.pos):c===3?i._keys.push(a.readString()):c===4&&i._values.push(function(d){let p=null;const y=d.readVarint()+d.pos;for(;d.pos<y;){const _=d.readVarint()>>3;p=_===1?d.readString():_===2?d.readFloat():_===3?d.readDouble():_===4?d.readVarint64():_===5?d.readVarint():_===6?d.readSVarint():_===7?d.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p}(a))}class An{constructor(i,a){this.layers=i.readFields(kn,{},a)}}function kn(c,i,a){if(c===3){const d=new Cr(a,a.readVarint()+a.pos);d.length&&(i[d.name]=d)}}const en="3d_elevation_id",kr="level";class yn{constructor(){this._valid=!1}reset(i){return this.feature=i,this._valid=!0,this._geometry=i.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(i,a){return this._valid&&i(a(this._geometry)),this}require(i,a,d){return this.get(i,!0,a,d)}optional(i,a,d){return this.get(i,!1,a,d)}success(){return this._valid}get(i,a,d,p){const y=this.feature.properties.hasOwnProperty(i)?+this.feature.properties[i]:void 0;return this._valid&&y!==void 0&&!Number.isNaN(y)?d(p?p(y):y):a&&(this._valid=!1),this}}class hi{constructor(i,a){this.featureFunc=i,this.vertexFunc=a}parseFeature(i,a,d){return this.featureFunc(i,a,d)}parseVertex(i,a,d){return this.vertexFunc(i,a,d)}}const fi=new hi((c,i,a)=>c.reset(i).require(en,d=>{a.id=d}).optional("fixed_height_relative",d=>{a.constantHeight=d},qr.decodeRelativeHeight).geometry(d=>{a.bounds=d},Sm).success(),(c,i,a)=>c.reset(i).require(en,d=>{a.id=d}).require("elevation_idx",d=>{a.idx=d}).require("extent",d=>{a.extent=d}).require("height_relative",d=>{a.height=d},qr.decodeRelativeHeight).geometry(d=>{a.position=d},qr.getPoint).success()),_n=new hi((c,i,a)=>c.reset(i).require(en,d=>{a.id=d}).optional("fixed_height",d=>{a.constantHeight=d},qr.decodeMetricHeight).geometry(d=>{a.bounds=d},Sm).success(),(c,i,a)=>c.reset(i).require(en,d=>{a.id=d}).require("elevation_idx",d=>{a.idx=d}).require("extent",d=>{a.extent=d}).require("height",d=>{a.height=d},qr.decodeMetricHeight).geometry(d=>{a.position=d},qr.getPoint).success());class qr{static getPoint(i){return as(i[0][0].x,i[0][0].y)}static decodeRelativeHeight(i){return 1e-4*i*5}static decodeMetricHeight(i){return 1e-4*i}static getVersionSchema(i){return i?i==="1.0.1"?_n:void 0:fi}static parse(i){const a=[],d=[],p=i.length,y=new yn;for(let _=0;_<p;_++){const b=i.feature(_),E=b.properties.version,I=qr.getVersionSchema(E);if(I===void 0){vr(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const M=b.properties.type;if(!M)continue;const D=Jr.types[b.type];if(D==="Point"&&M==="curve_point"){const N={};I.parseVertex(y,b,N)&&a.push(N)}else if(D==="Polygon"&&M==="curve_meta"){const N={};I.parseFeature(y,b,N)&&d.push(N)}}return{vertices:a,features:d}}}class Rr{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,d){const p=Mn(a,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,!0}}class Zn{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,d){const p=Yt(a,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/p;return d[0]=this.pos[0]+this.dir[0]*y,d[1]=this.pos[1]+this.dir[1]*y,d[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(i,a,d){if(function(V,G){var Y=V[0],re=V[1],J=V[2],oe=G[0],le=G[1],de=G[2];return Math.abs(Y-oe)<=v*Math.max(1,Math.abs(Y),Math.abs(oe))&&Math.abs(re-le)<=v*Math.max(1,Math.abs(re),Math.abs(le))&&Math.abs(J-de)<=v*Math.max(1,Math.abs(J),Math.abs(de))}(this.pos,i)||a===0)return d[0]=d[1]=d[2]=0,!1;const[p,y,_]=this.dir,b=this.pos[0]-i[0],E=this.pos[1]-i[1],I=this.pos[2]-i[2],M=p*p+y*y+_*_,D=2*(b*p+E*y+I*_),N=D*D-4*M*(b*b+E*E+I*I-a*a);if(N<0){const V=Math.max(-D/2,0),G=b+p*V,Y=E+y*V,re=I+_*V,J=Math.hypot(G,Y,re);return d[0]=G*a/J,d[1]=Y*a/J,d[2]=re*a/J,!1}{const V=(-D-Math.sqrt(N))/(2*M);if(V<0){const G=Math.hypot(b,E,I);return d[0]=b*a/G,d[1]=E*a/G,d[2]=I*a/G,!1}return d[0]=b+p*V,d[1]=E+y*V,d[2]=I+_*V,!0}}}class wi{constructor(i,a,d,p,y){this.TL=i,this.TR=a,this.BR=d,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(i,a,d){const p=[-1,1,1],y=[1,1,1],_=[1,-1,1],b=[-1,-1,1],E=Ir(p,p,i),I=Ir(y,y,i),M=Ir(_,_,i),D=Ir(b,b,i);return new wi(E,I,M,D,a/d)}}function Jn(c,i,a){let d=1/0,p=-1/0;const y=[];for(const _ of c){Nn(y,_,i);const b=Yt(y,a);d=Math.min(d,b),p=Math.max(p,b)}return[d,p]}function ri(c,i){let a=!0;for(let d=0;d<c.planes.length;d++){const p=c.planes[d];let y=0;for(let _=0;_<i.length;_++)y+=+(Yt(p,i[_])+p[3]>=0);if(y===0)return 0;y!==i.length&&(a=!1)}return a?2:1}function Ys(c,i){for(const a of c.projections){const d=Jn(i,c.points[0],a.axis);if(a.projection[1]<d[0]||a.projection[0]>d[1])return 0}return 1}function ga(c,i){let a=0;const d=[0,0,0,0];for(let p=0;p<c.length;p++)d[0]=c[p][0],d[1]=c[p][1],d[2]=c[p][2],d[3]=1,nr(d,i)>=0&&a++;return a}class Do{constructor(i,a){this.points=i||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=vn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Nn([],this.points[2],this.points[3]),Nn([],this.points[0],this.points[3]),Nn([],this.points[4],this.points[0]),Nn([],this.points[5],this.points[1]),Nn([],this.points[6],this.points[2]),Nn([],this.points[7],this.points[3])];for(const d of this.frustumEdges){const p=[0,-d[2],d[1]],y=[d[2],0,-d[0]];this.projections.push({axis:p,projection:Jn(this.points,this.points[0],p)}),this.projections.push({axis:y,projection:Jn(this.points,this.points[0],y)})}}static fromInvProjectionMatrix(i,a,d,p){const y=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const M=er([],I,i),D=1/M[3]/a*y;return(N=M)[0]=(V=M)[0]*(G=[D,D,p?1/M[3]:D,D])[0],N[1]=V[1]*G[1],N[2]=V[2]*G[2],N[3]=V[3]*G[3],N;var N,V,G}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const M=Rt([],ir([],Nn([],_[I[0]],_[I[1]]),Nn([],_[I[2]],_[I[1]]))),D=-Yt(M,_[I[1]]);return M.concat(D)}),E=[];for(let I=0;I<_.length;I++)E.push([_[I][0],_[I][1],_[I][2]]);return new Do(E,b)}intersectsPrecise(i,a,d){for(let p=0;p<a.length;p++)if(!ga(i,a[p]))return 0;for(let p=0;p<this.planes.length;p++)if(!ga(i,this.planes[p]))return 0;for(const p of d)for(const y of this.frustumEdges){const _=ir([],p,y),b=dt(_);if(b===0)continue;$t(_,_,1/b);const E=Jn(this.points,this.points[0],_),I=Jn(i,this.points[0],_);if(E[0]>I[1]||I[0]>E[1])return 0}return 1}containsPoint(i){for(const a of this.planes){const d=a[3];if(Yt([a[0],a[1],a[2]],i)+d<0)return!1}return!0}}class vn{static fromPoints(i){const a=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];for(const p of i)Gt(a,a,p),Ot(d,d,p);return new vn(a,d)}static fromTileIdAndHeight(i,a,d){const p=1<<i.canonical.z,y=i.canonical.x,_=i.canonical.y;return new vn([y/p,_/p,a],[(y+1)/p,(_+1)/p,d])}static applyTransform(i,a){const d=i.getCorners();for(let p=0;p<d.length;++p)Ir(d[p],d[p],a);return vn.fromPoints(d)}static applyTransformFast(i,a){const d=[a[12],a[13],a[14]],p=[...d];for(let y=0;y<3;y++)for(let _=0;_<3;_++){const b=a[4*_+y],E=b*i.min[_],I=b*i.max[_];d[y]+=Math.min(E,I),p[y]+=Math.max(E,I)}return new vn(d,p)}static projectAabbCorners(i,a){const d=i.getCorners();for(let p=0;p<d.length;++p)Ir(d[p],d[p],a);return d}constructor(i,a){this.min=i,this.max=a,this.center=$t([],qe([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],d=nt(this.min),p=nt(this.max);for(let y=0;y<a.length;y++)d[y]=a[y]?this.min[y]:this.center[y],p[y]=a[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new vn(d,p)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){return this.intersectsAabb(i.bounds)?ri(i,this.getCorners()):0}intersectsFlat(i){return this.intersectsAabb(i.bounds)?ri(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(i,a){return a||this.intersects(i)?Ys(i,this.getCorners()):0}intersectsPreciseFlat(i,a){return a||this.intersectsFlat(i)?Ys(i,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(i){for(let a=0;a<3;++a)if(this.min[a]>i.max[a]||i.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(i){return!(this.min[0]>i.max[0]||i.min[0]>this.max[0]||this.min[1]>i.max[1]||i.min[1]>this.max[1])}encapsulate(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i.min[a]),this.max[a]=Math.max(this.max[a],i.max[a])}encapsulatePoint(i){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],i[a]),this.max[a]=Math.max(this.max[a],i[a])}closestPoint(i){return[Math.max(Math.min(this.max[0],i[0]),this.min[0]),Math.max(Math.min(this.max[1],i[1]),this.min[1]),Math.max(Math.min(this.max[2],i[2]),this.min[2])]}}Wt(vn,"Aabb");class Oa{constructor(i,a){this.feature=i,this.metersToTile=a,this.index=0}get(){const i=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,d=a[1],p=-a[0],y=(i.extent+1)*this.metersToTile;return[new wt(Math.trunc(i.position[0]+d*y),Math.trunc(i.position[1]+p*y)),new wt(Math.trunc(i.position[0]-d*y),Math.trunc(i.position[1]-p*y))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class cs{constructor(i,a,d,p,y,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[fo(),fo(),fo(),fo(),fo(),fo(),fo()],this.id=i,this.heightRange={min:d,max:d},this.safeArea=a,this.constantHeight=d,this.constantHeight==null&&(this.constantHeight!=null||p.length!==0)){this.vertices=p,this.edges=y,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((E=this.vertices[b.a].position)[0]===(I=this.vertices[b.b].position)[0]&&E[1]===I[1]);var E,I}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:as(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const E=this.vertices[b.a].position,I=this.vertices[b.b].position,M=Tl(fo(),I,E),D=gc(M),N=Ul(fo(),M,1/D);this.edgeProps.push({vec:M,dir:N,len:D});const V=this.vertexProps[b.a].dir,G=this.vertexProps[b.b].dir;Wa(V,V,N),Wa(G,G,N)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||yc(b.dir,b.dir);this.tessellate(_)}}pointElevation(i){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(i);if(a==null)return 0;const[d,p]=a;return mr(this.vertices[this.edges[d].a].height,this.vertices[this.edges[d].b].height,p)}computeSlopeNormal(i,a){const d=this.getClosestEdge(i);if(!d)return rt(0,0,1);const p=d[0],y=this.edges[p],_=this.edgeProps[p].vec,b=rt(_[0],_[1],(this.vertices[y.b].height-this.vertices[y.a].height)*a),E=rt(b[1],-b[0],0);ir(E,E,b);const I=dt(E);return I>0?$t(E,E,1/I):at(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(i){if(this.edges.length===0)return;let a=0,d=Number.POSITIVE_INFINITY,p=0;const[y,_,b,E,I,M,D]=this._tmpVec2;Ha(D,i.x,i.y);const N=new Rr(D,null);for(let V=0;V<this.edges.length;V++){const G=this.edges[V],Y=this.edgeProps[V].dir;N.dir=Y;const re=this.vertices[G.a].position,J=this.vertices[G.b].position,oe=N.intersectsPlane(re,this.vertexProps[G.a].dir,y),le=N.intersectsPlane(J,this.vertexProps[G.b].dir,_);if(!oe||!le)continue;Tl(b,_,y),Tl(E,D,y);const de=Mn(b,b),_e=de>0?Mn(E,b)/de:0,ye=we(_e,0,1),Te=Math.abs((_e-ye)*this.edgeProps[V].len);Tl(I,D,re),Ha(M,Y[1],-Y[0]);const Ae=Te+Math.abs(Mn(I,M));Ae<d&&(a=V,d=Ae,p=ye)}return[a,p]}tessellate(i){const a=Ze(),d=Ze(),p=Ze(),y=Ze();for(let _=this.edges.length-1;_>=0;--_){const b=this.edges[_].a,E=this.edges[_].b,{position:I,height:M,extent:D}=this.vertices[b],{position:N,height:V,extent:G}=this.vertices[E],Y=this.vertexProps[b].dir,re=this.vertexProps[E].dir;if(at(a,I[0]/i,I[1]/i,M),at(d,N[0]/i,N[1]/i,V),at(p,Y[1],-Y[0],0),$t(p,p,D),at(y,re[1],-re[0],0),$t(y,y,G),this.distSqLines(rt(a[0]+.5*p[0],a[1]+.5*p[1],a[2]+.5*p[2]),rt(d[0]-.5*y[0],d[1]-.5*y[1],d[2]-.5*y[2]),rt(a[0]-.5*p[0],a[1]-.5*p[1],a[2]-.5*p[2]),rt(d[0]+.5*y[0],d[1]+.5*y[1],d[2]+.5*y[2]))<=.0025000000000000005)continue;const J=this.vertices.length,oe=Wa(fo(),I,N);this.vertices.push({position:Ul(oe,oe,.5),height:.5*(M+V),extent:.5*(D+G)});const le=Wa(fo(),Y,re);this.vertexProps.push({dir:yc(le,le)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:b,b:J}),this.edges.push({a:J,b:E});const de=Tl(fo(),this.vertices[J].position,I),_e=gc(de),ye={vec:de,dir:Ul(fo(),de,1/_e),len:_e};this.edgeProps.push(ye),this.edgeProps.push(ye)}}distSqLines(i,a,d,p){const y=He(Ze(),a,i),_=He(Ze(),p,d),b=He(Ze(),i,d),E=Yt(y,y),I=Yt(y,_),M=Yt(y,b),D=Yt(_,_),N=Yt(_,b),V=E*D-I*I;if(V===0)return hn(jt(y,d,p,Yt(b,_)/Yt(_,_)),i);const G=(E*N-I*M)/V;return hn(jt(y,i,a,(I*N-M*D)/V),jt(_,d,p,G))}}class ya{static parseFrom(i,a){const d=qr.parse(i);if(!d)return[];let{vertices:p,features:y}=d;const _=1/At(a);y.sort((M,D)=>M.id-D.id),p.sort((M,D)=>M.id-D.id||M.idx-D.idx),p=p.filter((M,D,N)=>D===N.findIndex(V=>V.id===M.id&&V.idx===M.idx));const b=new Array;let E=0;const I=p.length;for(const M of y){if(M.constantHeight){b.push(new cs(M.id,M.bounds,M.constantHeight));continue}for(;E!==I&&p[E].id<M.id;)E++;if(E===I||p[E].id!==M.id)continue;const D=new Array,N=new Array,V=E;for(;E!==I&&p[E].id===M.id;){const G=p[E];if(D.push({position:G.position,height:G.height,extent:G.extent}),E!==V&&p[E-1].idx===G.idx-1){const Y=E-V;N.push({a:Y-1,b:Y})}E++}b.push(new cs(M.id,M.bounds,void 0,D,N,_))}return b}static getElevationFeature(i,a){if(!a)return;const d=+i.properties[en];return Number.isNaN(d)?void 0:a.find(p=>p.id===d)}}class Ol{constructor(i,a){this.zScale=1,this.xOffset=0,this.yOffset=0,i.equals(a)||(this.zScale=Math.pow(2,a.z-i.z),this.xOffset=(i.x*this.zScale-a.x)*Mt,this.yOffset=(i.y*this.zScale-a.y)*Mt)}constantElevation(i,a){if(i.constantHeight!=null)return this.computeBiasedHeight(i.constantHeight,a)}pointElevation(i,a,d){const p=this.constantElevation(a,d);return p??(i.x=i.x*this.zScale+this.xOffset,i.y=i.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(i),d))}computeBiasedHeight(i,a){return a<=0?i:i+a*je(0,a,i>=0?i:Math.abs(.5*i))}}Wt(cs,"ElevationFeature");class Js{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new pd,this.indexArray=new go,this.segments=new di,this.programConfigurations=new F(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ko),this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,d,p){}populate(i,a,d,p){const y=this.layers[0],_=[];let b=null;y.type==="circle"&&(b=y.layout.get("circle-sort-key"));for(const{feature:I,id:M,index:D,sourceLayerIndex:N}of i){const V=this.layers[0]._featureFilter.needGeometry,G=Lr(I,V);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),G,d))continue;const Y=b?b.evaluate(G,{},d):void 0,re={id:M,properties:I.properties,type:I.type,sourceLayerIndex:N,index:D,geometry:V?G.geometry:yr(I,d,p),patterns:{},sortKey:Y};_.push(re)}b&&_.sort((I,M)=>I.sortKey-M.sortKey);let E=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new zf,E=p.projection);for(const I of _){const{geometry:M,index:D,sourceLayerIndex:N}=I,V=i[D].feature;this.addFeature(I,M,D,a.availableImages,d,E,a.brightness,a.elevationFeatures),a.featureIndex.insert(V,M,D,N,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(i,a,d,p,y,_,b){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,CA.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,OA.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,IA.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(i,a,d,p,y,_,b,E){let I;this.elevationMode!=="none"&&(I=ya.getElevationFeature(i,E));for(const M of a)for(const D of M){const N=D.x,V=D.y;if(N<0||N>=Mt||V<0||V>=Mt)continue;if(_){const re=_.projectTilePoint(N,V,y),J=_.upVector(y,N,V);this.addGlobeExtVertex(re,J),this.addGlobeExtVertex(re,J),this.addGlobeExtVertex(re,J),this.addGlobeExtVertex(re,J)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),Y=G.vertexLength;if(this.addCircleVertex(N,V,-1,-1),this.addCircleVertex(N,V,1,-1),this.addCircleVertex(N,V,1,1),this.addCircleVertex(N,V,-1,1),this.elevationMode!=="none"){const re=I?I.pointElevation(new wt(N,V)):0;this.hasElevation=this.hasElevation||re!==0;for(let J=0;J<4;J++)this.elevatedLayoutVertexArray.emplaceBack(re)}this.indexArray.emplaceBack(Y,Y+1,Y+2),this.indexArray.emplaceBack(Y,Y+2,Y+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,{},p,y,b,void 0,this.worldview)}addCircleVertex(i,a,d,p){this.layoutVertexArray.emplaceBack(2*i+(d+1)/2,2*a+(p+1)/2)}addGlobeExtVertex(i,a){this.globeExtVertexArray.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function mi(c,i){for(let a=0;a<c.length;a++)if(Ra(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(Ra(c,i[a]))return!0;return!!gs(c,i)}function Fi(c,i,a){return!!Ra(c,i)||!!Pc(i,c,a)}function Qn(c,i){if(c.length===1)return Vf(i,c[0]);for(let a=0;a<i.length;a++){const d=i[a];for(let p=0;p<d.length;p++)if(Ra(c,d[p]))return!0}for(let a=0;a<c.length;a++)if(Vf(i,c[a]))return!0;for(let a=0;a<i.length;a++)if(gs(c,i[a]))return!0;return!1}function eo(c,i,a){if(c.length>1){if(gs(c,i))return!0;for(let d=0;d<i.length;d++)if(Pc(i[d],c,a))return!0}for(let d=0;d<c.length;d++)if(Pc(c[d],i,a))return!0;return!1}function gs(c,i){if(c.length===0||i.length===0)return!1;for(let a=0;a<c.length-1;a++){const d=c[a],p=c[a+1];for(let y=0;y<i.length-1;y++)if(Mi(d,p,i[y],i[y+1]))return!0}return!1}function Mi(c,i,a,d){return Yn(c,a,d)!==Yn(i,a,d)&&Yn(c,i,a)!==Yn(c,i,d)}function ka(c,i,a){return(c.x-a.x)*(i.y-a.y)-(c.y-a.y)*(i.x-a.x)}function Ym(c,i,a,d){const p=ka(c,i,d),y=ka(c,i,a);if(Math.sign(p)===Math.sign(y))return;const _=ka(a,d,c),b=_+y-p;return Math.sign(_)!==Math.sign(b)?[_/(_-b),y/(y-p)]:void 0}function Pc(c,i,a){const d=a*a;if(i.length===1)return c.distSqr(i[0])<d;for(let p=1;p<i.length;p++)if($f(c,i[p-1],i[p])<d)return!0;return!1}function $f(c,i,a){const d=i.distSqr(a);if(d===0)return c.distSqr(i);const p=((c.x-i.x)*(a.x-i.x)+(c.y-i.y)*(a.y-i.y))/d;return c.distSqr(p<0?i:p>1?a:a.sub(i)._mult(p)._add(i))}function Vf(c,i){let a,d,p,y=!1;for(let _=0;_<c.length;_++){a=c[_];for(let b=0,E=a.length-1;b<a.length;E=b++)d=a[b],p=a[E],d.y>i.y!=p.y>i.y&&i.x<(p.x-d.x)*(i.y-d.y)/(p.y-d.y)+d.x&&(y=!y)}return y}function Ra(c,i){let a=!1;for(let d=0,p=c.length-1;d<c.length;p=d++){const y=c[d],_=c[p];y.y>i.y!=_.y>i.y&&i.x<(_.x-y.x)*(i.y-y.y)/(_.y-y.y)+y.x&&(a=!a)}return a}function Cc(c,i,a,d,p){for(const _ of c)if(i<=_.x&&a<=_.y&&d>=_.x&&p>=_.y)return!0;const y=[new wt(i,a),new wt(i,p),new wt(d,p),new wt(d,a)];if(c.length>2){for(const _ of y)if(Ra(c,_))return!0}for(let _=0;_<c.length-1;_++)if(Ic(c[_],c[_+1],y))return!0;return!1}function Ic(c,i,a){const d=a[0],p=a[2];if(c.x<d.x&&i.x<d.x||c.x>p.x&&i.x>p.x||c.y<d.y&&i.y<d.y||c.y>p.y&&i.y>p.y)return!1;const y=Yn(c,i,a[0]);return y!==Yn(c,i,a[1])||y!==Yn(c,i,a[2])||y!==Yn(c,i,a[3])}function rl(c,i,a,d,p,y){let _=i.y-c.y,b=c.x-i.x;if(y=y||0){const E=_*_+b*b;if(E===0)return!0;const I=Math.sqrt(E);_/=I,b/=I}return!((a.x-c.x)*_+(a.y-c.y)*b-y<0||(d.x-c.x)*_+(d.y-c.y)*b-y<0||(p.x-c.x)*_+(p.y-c.y)*b-y<0)}function gu(c,i,a,d,p,y,_){return!(rl(c,i,d,p,y,_)||rl(i,a,d,p,y,_)||rl(a,c,d,p,y,_)||rl(d,p,c,i,a,_)||rl(p,y,c,i,a,_)||rl(y,d,c,i,a,_))}function fh(c,i,a){const d=i.paint.get(c).value;return d.kind==="constant"?d.value:a.programConfigurations.get(i.id).getMaxValue(c)}function P_(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function H4(c,i,a,d,p){if(!i[0]&&!i[1])return c;const y=wt.convert(i)._mult(p);a==="viewport"&&y._rotate(-d);const _=[];for(let b=0;b<c.length;b++)_.push(c[b].sub(y));return _}function W4(c,i,a,d){const p=wt.convert(c)._mult(d);return i==="viewport"&&p._rotate(-a),p}let Z4,X4;function K4(c,i,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[c*d-2*Math.PI*6378137/2,i*d-2*Math.PI*6378137/2]}Wt(Js,"CircleBucket",{omit:["layers"]});class Jm{constructor(i,a,d){this.z=i,this.x=a,this.y=d,this.key=C_(0,i,i,a,d)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}isChildOf(i){const a=this.z-i.z;return i.z===0||i.z<this.z&&i.x===this.x>>a&&i.y===this.y>>a}url(i,a){const d=function(y,_,b){var E=K4(256*y,256*(_=Math.pow(2,b)-_-1),b),I=K4(256*(y+1),256*(_+1),b);return E[0]+","+E[1]+","+I[0]+","+I[1]}(this.x,this.y,this.z),p=function(y,_,b){let E,I="";for(let M=y;M>0;M--)E=1<<M-1,I+=(_&E?1:0)+(b&E?2:0);return I}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",d)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Y4{constructor(i,a){this.wrap=i,this.canonical=a,this.key=C_(i,a.z,a.z,a.x,a.y)}}class Qs{constructor(i,a,d,p,y){this.overscaledZ=i,this.wrap=a,this.canonical=new Jm(d,+p,+y),this.key=a===0&&i===d?this.canonical.key:C_(a,i,d,p,y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new Qs(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qs(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return C_(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const d=this.canonical.z-i;return C_(this.wrap*+a,i,i,this.canonical.x>>d,this.canonical.y>>d)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.z<this.canonical.z&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new Qs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new Qs(a,this.wrap,a,d,p),new Qs(a,this.wrap,a,d+1,p),new Qs(a,this.wrap,a,d,p+1),new Qs(a,this.wrap,a,d+1,p+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Qs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Qs(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Y4(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function C_(c,i,a,d,p){const y=1<<Math.min(a,22);let _=y*(p%y)+d%y;return c&&a<22&&(_+=y*y*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*_+a)+(i-a)}const qce=[c=>{let i=c.canonical.x-1,a=c.wrap;return i<0&&(i=(1<<c.canonical.z)-1,a--),new Qs(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>{let i=c.canonical.x+1,a=c.wrap;return i===1<<c.canonical.z&&(i=0,a++),new Qs(c.overscaledZ,a,c.canonical.z,i,c.canonical.y)},c=>new Qs(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new Qs(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];Wt(Jm,"CanonicalTileID"),Wt(Qs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Hce=Zr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:LA}=Hce,Wce=Zr([{name:"a_pos_3",components:3,type:"Int16"}]);var J4=Zr([{name:"a_pos",type:"Int16",components:2}]);function jA(c){return c*ie/Pe}const Zce=[new vn([pe,pe,pe],[fe,fe,fe]),new vn([pe,pe,pe],[0,0,fe]),new vn([0,pe,pe],[fe,0,fe]),new vn([pe,0,pe],[0,fe,fe]),new vn([0,0,pe],[fe,fe,fe])];function Q4(c,i,a,d=!0){const p=$t([],c._camera.position,c.worldSize),y=[i,a,1,1];er(y,y,c.pixelMatrixInverse),Nt(y,y,1/y[3]);const _=Rt([],Nn([],y,p)),b=c.globeMatrix,E=[b[12],b[13],b[14]],I=Nn([],E,p),M=dt(I),D=Rt([],I),N=c.worldSize/(2*Math.PI),V=Yt(D,_),G=Math.asin(N/M);if(G<Math.acos(V)){if(!d)return null;const Oe=[],Me=[];$t(Oe,_,M/V),Rt(Me,Nn(Me,Oe,I)),Rt(_,qe(_,I,$t(_,Me,Math.tan(G)*M)))}const Y=[];new Zn(p,_).closestPointOnSphere(E,N,Y);const re=Rt([],pi(b,0)),J=Rt([],pi(b,1)),oe=Rt([],pi(b,2)),le=Yt(re,Y),de=Yt(J,Y),_e=Yt(oe,Y),ye=Be(Math.asin(-de/N));let Te=Be(Math.atan2(le,_e));Te=c.center.lng+function(Oe,Me){const st=(Me-Oe+180)%360-180;return st<-180?st+360:st}(c.center.lng,Te);const Ae=$e(Te),Se=we(Je(ye),0,1);return new Lt(Ae,Se)}class Xce{constructor(i,a,d){this.a=Nn([],i,d),this.b=Nn([],a,d),this.center=d;const p=Rt([],this.a),y=Rt([],this.b);this.angle=Math.acos(Yt(p,y))}}function jR(c,i){if(c.angle===0)return null;let a;return a=c.a[i]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[i]/c.a[i]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:function(d,p,y,_){const b=Math.sin(y);return d*(Math.sin((1-_)*y)/b)+p*(Math.sin(_*y)/b)}(c.a[i],c.b[i],c.angle,we(a,0,1))+c.center[i]}function gd(c){if(c.z<=1)return Zce[c.z+2*c.y+c.x];const i=NR(NA(c));return vn.fromPoints(i)}function ph(c,i,a){return $t(c,c,1-a),ur(c,c,i,a)}function e$(c,i,a){for(const d of c)Ir(d,d,i),$t(d,d,a)}function t$(c,i,a,d){const p=i/c.worldSize,y=c.globeMatrix;if(a.z<=1){const Se=gd(a).getCorners();return e$(Se,y,p),vn.fromPoints(Se)}const _=NA(a,d),b=NR(_,ie+jA(c._tileCoverLift));e$(b,y,p);const E=Number.MAX_VALUE,I=[-E,-E,-E],M=[E,E,E];if(_.contains(c.center)){for(const Me of b)Gt(M,M,Me),Ot(I,I,Me);I[2]=0;const Se=c.point,Oe=[Se.x*p,Se.y*p,0];return Gt(M,M,Oe),Ot(I,I,Oe),new vn(M,I)}if(c._tileCoverLift>0){for(const Se of b)Gt(M,M,Se),Ot(I,I,Se);return new vn(M,I)}const D=[y[12]*p,y[13]*p,y[14]*p],N=_.getCenter(),V=we(c.center.lat,-85.051129,Re),G=we(N.lat,-85.051129,Re),Y=$e(c.center.lng),re=Je(V);let J=Y-$e(N.lng);const oe=re-Je(G);J>.5?J-=1:J<-.5&&(J+=1);let le=0;Math.abs(J)>Math.abs(oe)?le=J>=0?1:3:(le=oe>=0?0:2,ur(D,D,[y[4]*p,y[5]*p,y[6]*p],-Math.sin(an(oe>=0?_.getSouth():_.getNorth()))*ie));const de=b[le],_e=b[(le+1)%4],ye=new Xce(de,_e,D),Te=[jR(ye,0)||de[0],jR(ye,1)||de[1],jR(ye,2)||de[2]],Ae=Uf(c.zoom);if(Ae>0){const Se=function({x:Me,y:st,z:et},it,mt,ft,pt){const Ke=1/(1<<et);let yt=Me*Ke,ut=yt+Ke,_t=st*Ke,gt=_t+Ke,Vt=0;const Ut=(yt+ut)/2-ft;return Ut>.5?Vt=-1:Ut<-.5&&(Vt=1),yt=((yt+Vt)*it-(ft*=it))*mt+ft,ut=((ut+Vt)*it-ft)*mt+ft,_t=(_t*it-(pt*=it))*mt+pt,gt=(gt*it-pt)*mt+pt,[[yt,gt,0],[ut,gt,0],[ut,_t,0],[yt,_t,0]]}(a,i,c._pixelsPerMercatorPixel,Y,re);for(let Me=0;Me<b.length;Me++)ph(b[Me],Se[Me],Ae);const Oe=qe([],Se[le],Se[(le+1)%4]);$t(Oe,Oe,.5),ph(Te,Oe,Ae)}for(const Se of b)Gt(M,M,Se),Ot(I,I,Se);return M[2]=Math.min(de[2],_e[2]),Gt(M,M,Te),Ot(I,I,Te),new vn(M,I)}function NA({x:c,y:i,z:a},d=!1){const p=1/(1<<a),y=new ve(ht(c*p),i===(1<<a)-1&&d?-90:vt((i+1)*p)),_=new ve(ht((c+1)*p),i===0&&d?90:vt(i*p));return new ke(y,_)}function NR(c,i=ie){const a=an(c.getNorth()),d=an(c.getSouth()),p=Math.cos(a),y=Math.cos(d),_=Math.sin(a),b=Math.sin(d),E=c.getWest(),I=c.getEast();return[Ie(y,b,E,i),Ie(y,b,I,i),Ie(p,_,I,i),Ie(p,_,E,i)]}function rw(c,i,a,d){const p=1<<a.z,y=(c/Mt+a.x)/p;return Ee(vt((i/Mt+a.y)/p),ht(y),d)}function zA({min:c,max:i}){return 16383/Math.max(i[0]-c[0],i[1]-c[1],i[2]-c[2])}const r$=new Float64Array(16);function FA(c){const i=zA(c),a=me(r$,[i,i,i]);return H(a,a,Wr([],c.min))}function zR(c){const i=function(d,p){return d[0]=1,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=1,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=1,d[11]=0,d[12]=p[0],d[13]=p[1],d[14]=p[2],d[15]=1,d}(r$,c.min),a=1/zA(c);return te(i,i,[a,a,a])}function FR(c){const i=Mt/(2*Math.PI);return c/(2*Math.PI)/i}function n$(c,i){return Mt/(512*Math.pow(2,c))*zA(gd(i))}function i$(c,i,a,d,p){const y=FR(a),_=[c,i,-a/(2*Math.PI)],b=B(new Float64Array(16));return H(b,b,_),te(b,b,[y,y,y]),Q(b,b,an(-p)),ae(b,b,an(-d)),b}function Uf(c){return je(5,6,c)}function o$(c,i){const a=Ee(i.lat,i.lng),d=function(G){const Y=Ee(G._center.lat,G._center.lng);let re=ir([],rt(0,1,0),Y);const J=Ce([],-G.angle,Y);re=Ir(re,re,J),Ce(J,-G._pitch,re);const oe=Rt([],Y);return $t(oe,oe,jA(G.cameraToCenterDistance/G.pixelsPerMeter)),Ir(oe,oe,J),qe([],Y,oe)}(c);return _=(p=He([],d,a))[0],b=p[1],E=p[2],I=(y=a)[0],M=y[1],D=y[2],V=(N=Math.sqrt((_*_+b*b+E*E)*(I*I+M*M+D*D)))&&Yt(p,y)/N,Math.acos(Math.min(Math.max(V,-1),1));var p,y,_,b,E,I,M,D,N,V}function BR(c,i){return o$(c,i)>Math.PI/2*1.01}const s$=an(85),Kce=Math.cos(s$),Yce=Math.sin(s$),Jce=$(),a$=c=>{const i=[];return c.paint.get("circle-pitch-alignment")==="map"&&i.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&i.push("SCALE_WITH_MAP"),i};function l$(c,i,a,d,p,y,_,b,E){if(y&&c.queryGeometry.isAboveHorizon)return!1;y&&(E*=c.pixelToTileUnitsFactor);const I=c.tileID.canonical,M=a.projection.upVectorScale(I,a.center.lat,a.worldSize).metersToTile;for(const D of i)for(const N of D){const V=N.add(b),G=p&&a.elevation?a.elevation.exaggeration()*p.getElevationAt(V.x,V.y,!0):0,Y=a.projection.projectTilePoint(V.x,V.y,I);if(G>0){const le=a.projection.upVector(I,V.x,V.y);Y.x+=le[0]*M*G,Y.y+=le[1]*M*G,Y.z+=le[2]*M*G}const re=y?V:Qce(Y.x,Y.y,Y.z,d),J=y?c.tilespaceRays.map(le=>tue(le,G)):c.queryGeometry.screenGeometry,oe=er([],[Y.x,Y.y,Y.z,1],d);if(!_&&y?E*=oe[3]/a.cameraToCenterDistance:_&&!y&&(E*=a.cameraToCenterDistance/oe[3]),y){const le=vt((N.y/Mt+I.y)/(1<<I.z));E/=a.projection.pixelsPerMeter(le,1)/Xe(1,le)}if(Fi(J,re,E))return!0}return!1}function Qce(c,i,a,d){const p=er([],[c,i,a,1],d);return new wt(p[0]/p[3],p[1]/p[3])}const c$=rt(0,0,0),eue=rt(0,0,1);function tue(c,i){const a=Ze();return c$[2]=i,c.intersectsPlane(c$,eue,a),new wt(a[0],a[1])}class u$ extends Js{}let d$,h$,f$,p$;function m$(c,{width:i,height:a},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==i*a*d)throw new RangeError("mismatched image size")}else p=new Uint8Array(i*a*d);return c.width=i,c.height=a,c.data=p,c}function g$(c,i,a){const{width:d,height:p}=i;d===c.width&&p===c.height||($R(c,i,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,d),height:Math.min(c.height,p)},a,null),c.width=d,c.height=p,c.data=i.data)}function $R(c,i,a,d,p,y,_,b){if(p.width===0||p.height===0)return i;if(p.width>c.width||p.height>c.height||a.x>c.width-p.width||a.y>c.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>i.width||p.height>i.height||d.x>i.width-p.width||d.y>i.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const E=c.data,I=i.data,M=y===4&&b;for(let D=0;D<p.height;D++){const N=((a.y+D)*c.width+a.x)*y,V=((d.y+D)*i.width+d.x)*y;if(M)for(let G=0;G<p.width;G++){const Y=N+G*y+3,re=V+G*y;I[re+0]=255,I[re+1]=255,I[re+2]=255,I[re+3]=E[Y]}else if(_)for(let G=0;G<p.width;G++){const Y=N+G*y,re=V+G*y,J=new En(E[Y+0]/255,E[Y+1]/255,E[Y+2]/255,E[Y+3]).toNonPremultipliedRenderColor(_).toArray();I[re+0]=J[0],I[re+1]=J[1],I[re+2]=J[2],I[re+3]=J[3]}else for(let G=0;G<p.width*y;G++)I[V+G]=E[N+G]}return i}Wt(u$,"HeatmapBucket",{omit:["layers"]});class Gf{constructor(i,a){m$(this,i,1,a)}resize(i){g$(this,new Gf(i),1)}clone(){return new Gf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,d,p,y){$R(i,a,d,p,y,1,null)}}class ys{constructor(i,a){m$(this,i,4,a)}resize(i){g$(this,new ys(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ys({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,d,p,y,_,b){$R(i,a,d,p,y,4,_,b)}}class y${constructor(i,a){this.width=i.width,this.height=i.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function nw(c){const i={},a=c.resolution||256,d=c.clips?c.clips.length:1,p=c.image||new ys({width:a,height:d}),y=(_,b,E)=>{i[c.evaluationKey]=E;const I=c.expression.evaluate(i),M=I?I.toNonPremultipliedRenderColor(null):null;M&&(p.data[_+b+0]=Math.floor(255*M.r),p.data[_+b+1]=Math.floor(255*M.g),p.data[_+b+2]=Math.floor(255*M.b),p.data[_+b+3]=Math.floor(255*M.a))};if(c.clips)for(let _=0,b=0;_<d;++_,b+=4*a)for(let E=0,I=0;E<a;E++,I+=4){const M=E/(a-1),{start:D,end:N}=c.clips[_];y(b,I,D*(1-M)+N*M)}else for(let _=0,b=0;_<a;_++,b+=4)y(0,b,_/(a-1));return p}Wt(Gf,"AlphaImage"),Wt(ys,"RGBAImage");const rue=Zr([{name:"a_pos",components:2,type:"Int16"}],4),nue=Zr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),iue=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),oue=Zr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function I_(c,i,a=2){const d=i&&i.length,p=d?i[0]*a:c.length;let y=_$(c,0,p,a,!0);const _=[];if(!y||y.next===y.prev)return _;let b,E,I;if(d&&(y=function(M,D,N,V){const G=[];for(let Y=0,re=D.length;Y<re;Y++){const J=_$(M,D[Y]*V,Y<re-1?D[Y+1]*V:M.length,V,!1);J===J.next&&(J.steiner=!0),G.push(fue(J))}G.sort(uue);for(let Y=0;Y<G.length;Y++)N=due(G[Y],N);return N}(c,i,y,a)),c.length>80*a){b=c[0],E=c[1];let M=b,D=E;for(let N=a;N<p;N+=a){const V=c[N],G=c[N+1];V<b&&(b=V),G<E&&(E=G),V>M&&(M=V),G>D&&(D=G)}I=Math.max(M-b,D-E),I=I!==0?32767/I:0}return iw(y,_,a,b,E,I,0),_}function _$(c,i,a,d,p){let y;if(p===function(_,b,E,I){let M=0;for(let D=b,N=E-I;D<E;D+=I)M+=(_[N]-_[D])*(_[D+1]+_[N+1]),N=D;return M}(c,i,a,d)>0)for(let _=i;_<a;_+=d)y=w$(_/d|0,c[_],c[_+1],y);else for(let _=a-d;_>=i;_-=d)y=w$(_/d|0,c[_],c[_+1],y);return y&&O_(y,y.next)&&(aw(y),y=y.next),y}function Qm(c,i){if(!c)return c;i||(i=c);let a,d=c;do if(a=!1,d.steiner||!O_(d,d.next)&&Lo(d.prev,d,d.next)!==0)d=d.next;else{if(aw(d),d=i=d.prev,d===d.next)break;a=!0}while(a||d!==i);return i}function iw(c,i,a,d,p,y,_){if(!c)return;!_&&y&&function(E,I,M,D){let N=E;do N.z===0&&(N.z=VR(N.x,N.y,I,M,D)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next;while(N!==E);N.prevZ.nextZ=null,N.prevZ=null,function(V){let G,Y=1;do{let re,J=V;V=null;let oe=null;for(G=0;J;){G++;let le=J,de=0;for(let ye=0;ye<Y&&(de++,le=le.nextZ,le);ye++);let _e=Y;for(;de>0||_e>0&&le;)de!==0&&(_e===0||!le||J.z<=le.z)?(re=J,J=J.nextZ,de--):(re=le,le=le.nextZ,_e--),oe?oe.nextZ=re:V=re,re.prevZ=oe,oe=re;J=le}oe.nextZ=null,Y*=2}while(G>1)}(N)}(c,d,p,y);let b=c;for(;c.prev!==c.next;){const E=c.prev,I=c.next;if(y?aue(c,d,p,y):sue(c))i.push(E.i,c.i,I.i),aw(c),c=I.next,b=I.next;else if((c=I)===b){_?_===1?iw(c=lue(Qm(c),i),i,a,d,p,y,2):_===2&&cue(c,i,a,d,p,y):iw(Qm(c),i,a,d,p,y,1);break}}}function sue(c){const i=c.prev,a=c,d=c.next;if(Lo(i,a,d)>=0)return!1;const p=i.x,y=a.x,_=d.x,b=i.y,E=a.y,I=d.y,M=Math.min(p,y,_),D=Math.min(b,E,I),N=Math.max(p,y,_),V=Math.max(b,E,I);let G=d.next;for(;G!==i;){if(G.x>=M&&G.x<=N&&G.y>=D&&G.y<=V&&ow(p,b,y,E,_,I,G.x,G.y)&&Lo(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function aue(c,i,a,d){const p=c.prev,y=c,_=c.next;if(Lo(p,y,_)>=0)return!1;const b=p.x,E=y.x,I=_.x,M=p.y,D=y.y,N=_.y,V=Math.min(b,E,I),G=Math.min(M,D,N),Y=Math.max(b,E,I),re=Math.max(M,D,N),J=VR(V,G,i,a,d),oe=VR(Y,re,i,a,d);let le=c.prevZ,de=c.nextZ;for(;le&&le.z>=J&&de&&de.z<=oe;){if(le.x>=V&&le.x<=Y&&le.y>=G&&le.y<=re&&le!==p&&le!==_&&ow(b,M,E,D,I,N,le.x,le.y)&&Lo(le.prev,le,le.next)>=0||(le=le.prevZ,de.x>=V&&de.x<=Y&&de.y>=G&&de.y<=re&&de!==p&&de!==_&&ow(b,M,E,D,I,N,de.x,de.y)&&Lo(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;le&&le.z>=J;){if(le.x>=V&&le.x<=Y&&le.y>=G&&le.y<=re&&le!==p&&le!==_&&ow(b,M,E,D,I,N,le.x,le.y)&&Lo(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;de&&de.z<=oe;){if(de.x>=V&&de.x<=Y&&de.y>=G&&de.y<=re&&de!==p&&de!==_&&ow(b,M,E,D,I,N,de.x,de.y)&&Lo(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function lue(c,i){let a=c;do{const d=a.prev,p=a.next.next;!O_(d,p)&&x$(d,a,a.next,p)&&sw(d,p)&&sw(p,d)&&(i.push(d.i,a.i,p.i),aw(a),aw(a.next),a=c=p),a=a.next}while(a!==c);return Qm(a)}function cue(c,i,a,d,p,y){let _=c;do{let b=_.next.next;for(;b!==_.prev;){if(_.i!==b.i&&pue(_,b)){let E=b$(_,b);return _=Qm(_,_.next),E=Qm(E,E.next),iw(_,i,a,d,p,y,0),void iw(E,i,a,d,p,y,0)}b=b.next}_=_.next}while(_!==c)}function uue(c,i){let a=c.x-i.x;return a===0&&(a=c.y-i.y,a===0)&&(a=(c.next.y-c.y)/(c.next.x-c.x)-(i.next.y-i.y)/(i.next.x-i.x)),a}function due(c,i){const a=function(p,y){let _=y;const b=p.x,E=p.y;let I,M=-1/0;if(O_(p,_))return _;do{if(O_(p,_.next))return _.next;if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){const Y=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(Y<=b&&Y>M&&(M=Y,I=_.x<_.next.x?_:_.next,Y===b))return I}_=_.next}while(_!==y);if(!I)return null;const D=I,N=I.x,V=I.y;let G=1/0;_=I;do{if(b>=_.x&&_.x>=N&&b!==_.x&&v$(E<V?b:M,E,N,V,E<V?M:b,E,_.x,_.y)){const Y=Math.abs(E-_.y)/(b-_.x);sw(_,p)&&(Y<G||Y===G&&(_.x>I.x||_.x===I.x&&hue(I,_)))&&(I=_,G=Y)}_=_.next}while(_!==D);return I}(c,i);if(!a)return i;const d=b$(a,c);return Qm(d,d.next),Qm(a,a.next)}function hue(c,i){return Lo(c.prev,c,i.prev)<0&&Lo(i.next,c,c.next)<0}function VR(c,i,a,d,p){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*p|0)|c<<8))|c<<4))|c<<2))|c<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-d)*p|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function fue(c){let i=c,a=c;do(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next;while(i!==c);return a}function v$(c,i,a,d,p,y,_,b){return(p-_)*(i-b)>=(c-_)*(y-b)&&(c-_)*(d-b)>=(a-_)*(i-b)&&(a-_)*(y-b)>=(p-_)*(d-b)}function ow(c,i,a,d,p,y,_,b){return!(c===_&&i===b)&&v$(c,i,a,d,p,y,_,b)}function pue(c,i){return c.next.i!==i.i&&c.prev.i!==i.i&&!function(a,d){let p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==d.i&&p.next.i!==d.i&&x$(p,p.next,a,d))return!0;p=p.next}while(p!==a);return!1}(c,i)&&(sw(c,i)&&sw(i,c)&&function(a,d){let p=a,y=!1;const _=(a.x+d.x)/2,b=(a.y+d.y)/2;do p.y>b!=p.next.y>b&&p.next.y!==p.y&&_<(p.next.x-p.x)*(b-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==a);return y}(c,i)&&(Lo(c.prev,c,i.prev)||Lo(c,i.prev,i))||O_(c,i)&&Lo(c.prev,c,c.next)>0&&Lo(i.prev,i,i.next)>0)}function Lo(c,i,a){return(i.y-c.y)*(a.x-i.x)-(i.x-c.x)*(a.y-i.y)}function O_(c,i){return c.x===i.x&&c.y===i.y}function x$(c,i,a,d){const p=$A(Lo(c,i,a)),y=$A(Lo(c,i,d)),_=$A(Lo(a,d,c)),b=$A(Lo(a,d,i));return p!==y&&_!==b||!(p!==0||!BA(c,a,i))||!(y!==0||!BA(c,d,i))||!(_!==0||!BA(a,c,d))||!(b!==0||!BA(a,i,d))}function BA(c,i,a){return i.x<=Math.max(c.x,a.x)&&i.x>=Math.min(c.x,a.x)&&i.y<=Math.max(c.y,a.y)&&i.y>=Math.min(c.y,a.y)}function $A(c){return c>0?1:c<0?-1:0}function sw(c,i){return Lo(c.prev,c,c.next)<0?Lo(c,i,c.next)>=0&&Lo(c,c.prev,i)>=0:Lo(c,i,c.prev)<0||Lo(c,c.next,i)<0}function b$(c,i){const a=UR(c.i,c.x,c.y),d=UR(i.i,i.x,i.y),p=c.next,y=i.prev;return c.next=i,i.prev=c,a.next=p,p.prev=a,d.next=a,a.prev=d,y.next=d,d.prev=y,d}function w$(c,i,a,d){const p=UR(c,i,a);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function aw(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function UR(c,i,a){return{i:c,x:i,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function lw(c,i){const a=c.length;if(a<=1)return[c];const d=[];let p,y;for(let _=0;_<a;_++){const b=no(c[_]);b!==0&&(c[_].area=Math.abs(b),y===void 0&&(y=b<0),y===b<0?(p&&d.push(p),p=[c[_]]):p.push(c[_]))}if(p&&d.push(p),i>1)for(let _=0;_<d.length;_++)d[_].length<=i||($y(d[_],i,1,d[_].length-1,mue),d[_]=d[_].slice(0,i));return d}function mue(c,i){return i.area-c.area}function S$(c,i,a=1){if(!c)return null;const d=typeof c=="string"?fa.from(c).getPrimary():c.getPrimary(),p=typeof c=="string"?null:c.getSecondary();for(const y of[d,p]){if(!y)continue;const _=y.id.toString();i.has(_)||i.set(_,[]),y.scaleSelf(a),i.get(_).push(y)}return{primary:d.toString(),secondary:p?p.toString():null}}function GR(c,i,a,d){const p=d.patternDependencies;let y=!1;for(const _ of i){const b=_.paint.get(`${c}-pattern`);b.isConstant()||(y=!0),S$(b.constantOr(null),p,a)&&(y=!0)}return y}function qR(c,i,a,d,p,y){const _=y.patternDependencies;for(const b of i){const E=b.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let I=E.evaluate({zoom:d},a,{},y.availableImages);I=I&&I.name?I.name:I;const M=S$(I,_,p);if(!M)continue;const{primary:D,secondary:N}=M;D&&(a.patterns[b.id]=[D,N].filter(Boolean))}}return a}class mh{constructor(){this.portals=[]}static isOnBorder(i,a){return i<=0&&a<=0||i>=Mt&&a>=Mt}static evaluate(i){if(i.length===0)return new mh;let a=[];for(const E of i)a.push(...E.portals);if(a.length===0)return new mh;for(const E of a){const I=E.va,M=E.vb;(mh.isOnBorder(I.x,M.x)||mh.isOnBorder(I.y,M.y))&&(E.type="border")}const d=a.filter(E=>E.type!=="unevaluated"),p=a.filter(E=>E.type==="unevaluated");if(p.length===0)return new mh;p.sort((E,I)=>E.hash===I.hash?E.isTunnel===I.isTunnel?0:E.isTunnel?-1:1:E.hash<I.hash?1:-1),a=d.concat(p);let y=d.length,_=y,b=y;do if(_++,_===a.length||a[y].hash!==a[_].hash){if(_-y===2){b<y&&(a[b]=a[y],a[y]=null);const E=a[b],I=a[_-1];E.type=E.isTunnel!==I.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:I.connection.a},b++}y=_}while(y!==a.length);return a.splice(b),a.sort((E,I)=>E.hash<I.hash?1:-1),{portals:a}}}Wt(mh,"ElevationPortalGraph");class gue{constructor(i,a,d){this.outPositions=i,this.outNormals=a,this.outIndices=d,this.vertexLookup=new Map}addVertex(i,a,d){let p=i[2];d!=null&&(p*=d);const y=`${i[0]},${i[1]},${i[2]},${a[0]},${a[1]},${a[2]}`,_=this.vertexLookup.get(y);if(_!=null)return _;const b=this.outPositions.length;this.vertexLookup.set(y,b);const E=Math.trunc(16384*a[0]),I=Math.trunc(16384*a[1]),M=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(i[0],i[1],p),this.outNormals.emplaceBack(E,I,M),b}addTriangle(i,a,d){this.outIndices.emplaceBack(i,a,d)}addTriangles(i,a,d){if(i.length===0)return;const p=d.length===1,y=Ze(),_=Ze();for(let b=0;b<i.length;b+=3){const E=a[i[b+0]],I=a[i[b+1]],M=a[i[b+2]],D=p?d[0]:d[i[b+1]],N=p?d[0]:d[i[b+2]];at(y,E.x,E.y,p?d[0]:d[i[b+0]]);const V=this.addVertex(y,_);at(y,I.x,I.y,D);const G=this.addVertex(y,_);at(y,M.x,M.y,N);const Y=this.addVertex(y,_);this.outIndices.emplaceBack(V,G,Y)}}addQuad(i,a,d,p,y,_){const b=this.addVertex(i,y,_),E=this.addVertex(a,y,_),I=this.addVertex(d,y,_),M=this.addVertex(p,y,_);this.addTriangle(b,E,I),this.addTriangle(I,M,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class nl{constructor(i,a,d,p){this.unevaluatedPortals=new mh,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new jf,this.vertexNormals=new Gb,this.indexArray=new go,this.tileToMeters=At(i),this.bridgeProgramConfigurations=new F(a,{zoom:d,lut:p},y=>y!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new F(a,{zoom:d,lut:p},y=>y!=="fill-bridge-guard-rail-color")}addVertices(i,a){const d=this.unevalVertices.length;for(let p=0;p<i.length;p++)this.unevalVertices.push(i[p]),this.unevalHeights.push(a[p]);return d}addTriangles(i,a,d){const p=d?this.unevalTunnelTriangles:this.unevalTriangles;for(const y of i)p.push(y+a)}addRenderableRing(i,a,d,p,y,_){const b=[new wt(y.min.x,y.min.y),new wt(y.max.x,y.min.y),new wt(y.max.x,y.max.y),new wt(y.min.x,y.max.y)];for(let E=0;E<d-1;E++){const I=a+E,M=I+1,D=this.unevalVertices[I],N=this.unevalVertices[M];if(!(D.x>=y.min.x&&D.x<=y.max.x&&D.y>=y.min.y&&D.y<=y.max.y||N.x>=y.min.x&&N.x<=y.max.x&&N.y>=y.min.y&&N.y<=y.max.y||Ic(D,N,b))||this.isOnBorder(D.x,N.x)||this.isOnBorder(D.y,N.y))continue;const V=nl.computeEdgeHash(this.unevalVertices[I],this.unevalVertices[M]);let G,Y=this.vertexHashLookup.get(nl.computePosHash(D));Y!=null?G=Y.next:(Y=this.vertexHashLookup.get(nl.computePosHash(N)),G=Y!=null?Y.prev:V),this.unevalEdges.push({polygonIdx:i,a:I,b:M,hash:V,portalHash:G,isTunnel:p,type:"unevaluated",featureInfo:_})}}addPortalCandidates(i,a,d,p,y){if(a.length!==0){this.vertexHashLookup.clear();for(const _ of a){if(_.length===0)continue;const b=_[0];let E=nl.computeEdgeHash(b[b.length-2],b[b.length-1]);for(let I=0;I<b.length-1;I++){const M=b[I+0],D=b[I+1],N=as(D.x-M.x,D.y-M.y),V=gc(N);if(V===0)continue;let G="unevaluated";const Y=p.pointElevation(M),re=p.pointElevation(D);Math.abs(Y)<.01&&Math.abs(re)<.01?G="entrance":(this.isOnBorder(M.x,D.x)||this.isOnBorder(M.y,D.y))&&(G="border");const J=nl.computeEdgeHash(M,D);this.unevaluatedPortals.portals.push({connection:{a:i,b:void 0},va:M,vb:D,vab:N,length:V,hash:J,isTunnel:d,type:G});const oe=nl.computePosHash(M);this.vertexHashLookup.set(oe,{prev:E,next:J}),E=J}}}}construct(i){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),d=N=>{N.primitiveLength=this.indexArray.length-N.primitiveOffset},p=new gue(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(i.portals,this.unevalEdges);const y=a(),_=a(),b=a(),E=(N,V)=>{N.sort((Y,re)=>Y.type===V&&re.type!==V?-1:Y.type!==V&&re.type===V?1:0);const G=N.findIndex(Y=>Y.type!==V);return G>=0?G:N.length};let I=0;this.unevalEdges.length>0&&(I=E(this.unevalEdges,"none"),this.constructBridgeStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},this.tileToMeters)),d(b);const M=a(),D=a();if(this.unevalEdges.length>0){const N=this.unevalEdges.splice(I),V=E(N,"tunnel")+I;this.unevalEdges.push(...N),this.constructTunnelStructures(p,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:I},{min:I,max:V})}d(M),p.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),d(D),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),d(_),p.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),d(y),this.maskSegments=di.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=di.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=di.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=di.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=di.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength)}update(i,a,d,p,y,_,b,E){this.bridgeProgramConfigurations.updatePaintArrays(i,a,y,d,p,_,b,E),this.tunnelProgramConfigurations.updatePaintArrays(i,a,y,d,p,_,b,E)}upload(i){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=i.createVertexBuffer(this.vertexPositions,iue.members),this.vertexBufferNormal=i.createVertexBuffer(this.vertexNormals,oue.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(i),this.tunnelProgramConfigurations.upload(i))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(i,a,d,p,y){const _=(b,E)=>{for(let I=0;I<E.length-1;I++){const M=E[I].featureIndex,D=E[I+1].vertexStart,N=i.feature(M);b.populatePaintArrays(D,N,M,{},d,a,p,void 0,y)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(i,a,d,p,y){const _=new Map;for(let b=p;b<y;b++){const E=d[b],I=E.a,M=E.b,D=nl.computePosHash(i[I]),N=nl.computePosHash(i[M]);let V=_.get(D);V||(V={},_.set(D,V));let G=_.get(N);G||(G={},_.set(N,G)),a[I]<=0&&a[M]<=0||(V.to=M,G.from=I)}return _}isTerminalVertex(i,a){const d=nl.computePosHash(this.unevalVertices[i]),p=a.get(d);return!p||!p.from||!p.to}constructBridgeStructures(i,a,d,p,y,_){i.clearVertexLookup();const b=this.computeVertexConnections(a,d,p,y.min,y.max),E=1/_,I=.5*E,M=(mt,ft)=>at(mt,a[ft].x,a[ft].y,d[ft]*E),D=Ze(),N=Ze(),V=Ze(),G=Ze(),Y=Ze(),re=(mt,ft)=>{const pt=b.get(nl.computePosHash(a[ft])),Ke=pt.from,yt=pt.to;if(!Ke||!yt)return;M(D,Ke),M(N,ft),M(V,yt),Hn(G),ei(D,N)||(Nn(Y,N,D),Rt(G,Y)),ei(V,N)||(Nn(Y,V,N),qe(G,G,Rt(Y,Y)));const ut=ot(G);return ut>0?$t(mt,G,1/ut):void 0};let J=Number.POSITIVE_INFINITY;this.sortSubarray(p,y.min,y.max,(mt,ft)=>mt.featureInfo.featureIndex-ft.featureInfo.featureIndex);const oe=Ze(),le=Ze(),de=Ze(),_e=Ze(),ye=Ze(),Te=Ze(),Ae=Ze(),Se=Ze(),Oe=Ze(),Me=[Ze(),Ze(),Ze(),Ze()],st=[Ze(),Ze(),Ze(),Ze()],et=[{coord:new wt(0,0),height:0},{coord:new wt(0,0),height:0}],it=(mt,ft)=>mt>ft;for(let mt=y.min;mt<y.max;mt++){const ft=p[mt];if(!ft.featureInfo.guardRailEnabled||!this.prepareEdgePoints(et,a,d,ft,it))continue;const[pt,Ke]=et;if(at(oe,pt.coord.x,pt.coord.y,E*pt.height),at(le,Ke.coord.x,Ke.coord.y,E*Ke.height),ei(oe,le))continue;Nn(de,le,oe),Rt(de,de);const yt=re(Se,ft.a)||de,ut=re(Oe,ft.b)||de;at(_e,yt[1],-yt[0],0),Rt(_e,_e),at(ye,ut[1],-ut[0],0),Rt(ye,ye),ir(Se,_e,yt),Rt(Te,Se),ir(Se,ye,ut),Rt(Ae,Se),qe(Me[0],oe,$t(Se,Nn(Se,_e,Te),I)),qe(Me[1],oe,$t(Se,qe(Se,_e,Te),I)),qe(Me[2],oe,$t(Se,Te,I)),Me[3]=oe,qe(st[0],le,$t(Se,Nn(Se,ye,Ae),I)),qe(st[1],le,$t(Se,qe(Se,ye,Ae),I)),qe(st[2],le,$t(Se,Ae,I)),st[3]=le,J=this.addFeatureSection(ft.featureInfo.featureIndex,J,this.bridgeFeatureSections,i);const _t=i.addVertex(Me[0],_e,_),gt=i.addVertex(Me[1],_e,_),Vt=i.addVertex(st[0],ye,_),Ut=i.addVertex(st[1],ye,_);i.addTriangle(_t,gt,Vt),i.addTriangle(gt,Ut,Vt);const kt=i.addVertex(Me[1],Te,_),Dt=i.addVertex(Me[2],Te,_),lr=i.addVertex(st[1],Ae,_),Jt=i.addVertex(st[2],Ae,_);i.addTriangle(kt,Dt,lr),i.addTriangle(Dt,Jt,lr),Wr(_e,_e),Wr(ye,ye);const Ft=i.addVertex(Me[2],_e,_),br=i.addVertex(Me[3],_e,_),Gr=i.addVertex(st[2],ye,_),mn=i.addVertex(st[3],ye,_);i.addTriangle(Ft,br,Gr),i.addTriangle(br,mn,Gr);const $r=this.isTerminalVertex(ft.a,b),Ln=this.isTerminalVertex(ft.b,b);pt.height<.01&&$r&&i.addQuad(Me[3],Me[2],Me[1],Me[0],Wr(yt,yt),_),Ke.height<.01&&Ln&&i.addQuad(st[0],st[1],st[2],st[3],ut,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}constructTunnelStructures(i,a,d,p,y,_){i.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const E=(J,oe)=>J.featureInfo.featureIndex-oe.featureInfo.featureIndex;this.sortSubarray(p,y.min,y.max,E),this.sortSubarray(p,_.min,_.max,E);const I=J=>Rt(J,J),M=[{coord:new wt(0,0),height:0},{coord:new wt(0,0),height:0}],D=(J,oe)=>J<oe,N=Ze(),V=Ze(),G=Ze(),Y=Ze(),re=Ze();for(let J=y.min;J<y.max;J++){if(!this.prepareEdgePoints(M,a,d,p[J],D))continue;const[oe,le]=M,de=I(at(re,-(le.coord.y-oe.coord.y),le.coord.x-oe.coord.x,0));b=this.addFeatureSection(p[J].featureInfo.featureIndex,b,this.tunnelFeatureSections,i),i.addQuad(at(N,oe.coord.x,oe.coord.y,oe.height),at(V,le.coord.x,le.coord.y,le.height),at(G,le.coord.x,le.coord.y,p[J].isTunnel?-.1:0),at(Y,oe.coord.x,oe.coord.y,p[J].isTunnel?-.1:0),de)}for(let J=_.min;J<_.max;J++){const oe=p[J];oe.isTunnel&&([oe.a,oe.b]=[oe.b,oe.a]);const le=a[oe.a],de=a[oe.b],_e=I(at(re,-(de.y-le.y),de.x-le.x,0));b=this.addFeatureSection(oe.featureInfo.featureIndex,b,this.tunnelFeatureSections,i),i.addQuad(at(N,de.x,de.y,0),at(V,le.x,le.y,0),at(G,le.x,le.y,d[oe.a]+4),at(Y,de.x,de.y,d[oe.b]+4),_e),i.addQuad(at(N,le.x,le.y,0),at(V,de.x,de.y,0),at(G,de.x,de.y,d[oe.b]+4),at(Y,le.x,le.y,d[oe.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:i.getVertexCount()})}setElevatedPoint(i,a,d,p){i.coord.x=a,i.coord.y=d,i.height=p}prepareEdgePoints(i,a,d,p,y){let _=a[p.a].x,b=a[p.a].y,E=a[p.b].x,I=a[p.b].y,M=d[p.a],D=d[p.b];const N=y(M,0),V=y(D,0);if(N&&V)return this.setElevatedPoint(i[0],_,b,M),this.setElevatedPoint(i[1],E,I,D),!0;if(!N&&!V)return!1;if(N){if(!V){const G=D/(D-M);E=mr(E,_,G),I=mr(I,b,G),D=mr(D,M,G)}}else{const G=M/(M-D);_=mr(_,E,G),b=mr(b,I,G),M=mr(M,D,G)}return this.setElevatedPoint(i[0],_,b,M),this.setElevatedPoint(i[1],E,I,D),!0}prepareEdges(i,a){if(a.length===0)return;a.sort((b,E)=>b.hash===E.hash?E.polygonIdx-b.polygonIdx:E.hash>b.hash?1:-1);let d=0,p=0,y=0,_=a[d].polygonIdx;do p++,(p===a.length||a[d].hash!==a[p].hash)&&((p-d===1||a[p-1].polygonIdx!==_)&&(y<d&&(a[y]=a[d],a[d]=null),a[y].type="none",y++),d=p,d!==a.length&&(_=a[d].polygonIdx));while(d!==a.length);if(a.splice(y),a.length!==0&&i.length!==0){a.sort((I,M)=>I.portalHash<M.portalHash?1:-1);let b=0,E=0;for(;b!==a.length&&E!==i.length;){const I=a[b],M=i[E];I.portalHash>M.hash?b++:M.hash>I.portalHash?E++:(I.type=M.type,b++)}}}isOnBorder(i,a){return i<=0&&a<=0||i>=Mt&&a>=Mt}addFeatureSection(i,a,d,p){return i!==a&&(a=i,d.push({featureIndex:i,vertexStart:p.getVertexCount()}),p.clearVertexLookup()),a}sortSubarray(i,a,d,p){const y=i.slice(a,d);y.sort(p),i.splice(a,y.length,...y)}static computeEdgeHash(i,a){return(i.y===a.y&&i.x>a.x||i.y>a.y)&&([i,a]=[a,i]),BigInt(nl.computePosHash(i))<<32n|BigInt(nl.computePosHash(a))}static computePosHash(i){return((65535&i.x)<<16|65535&i.y)>>>0}}function yue(c,i){return c>i?1:c<i?-1:0}class HR{constructor(i=yue,a=!1){this._compare=i,this._root=null,this._size=0,this._noDuplicates=!!a}rotateLeft(i){var a=i.right;a&&(i.right=a.left,a.left&&(a.left.parent=i),a.parent=i.parent),i.parent?i===i.parent.left?i.parent.left=a:i.parent.right=a:this._root=a,a&&(a.left=i),i.parent=a}rotateRight(i){var a=i.left;a&&(i.left=a.right,a.right&&(a.right.parent=i),a.parent=i.parent),i.parent?i===i.parent.left?i.parent.left=a:i.parent.right=a:this._root=a,a&&(a.right=i),i.parent=a}_splay(i){for(;i.parent;){var a=i.parent;a.parent?a.left===i&&a.parent.left===a?(this.rotateRight(a.parent),this.rotateRight(a)):a.right===i&&a.parent.right===a?(this.rotateLeft(a.parent),this.rotateLeft(a)):a.left===i&&a.parent.right===a?(this.rotateRight(a),this.rotateLeft(a)):(this.rotateLeft(a),this.rotateRight(a)):a.left===i?this.rotateRight(a):this.rotateLeft(a)}}splay(i){for(var a,d,p,y,_;i.parent;)(d=(a=i.parent).parent)&&d.parent?((p=d.parent).left===d?p.left=i:p.right=i,i.parent=p):(i.parent=null,this._root=i),y=i.left,_=i.right,i===a.left?(d&&(d.left===a?(a.right?(d.left=a.right,d.left.parent=d):d.left=null,a.right=d,d.parent=a):(y?(d.right=y,y.parent=d):d.right=null,i.left=d,d.parent=i)),_?(a.left=_,_.parent=a):a.left=null,i.right=a,a.parent=i):(d&&(d.right===a?(a.left?(d.right=a.left,d.right.parent=d):d.right=null,a.left=d,d.parent=a):(_?(d.left=_,_.parent=d):d.left=null,i.right=d,d.parent=i)),y?(a.right=y,y.parent=a):a.right=null,i.left=a,a.parent=i)}replace(i,a){i.parent?i===i.parent.left?i.parent.left=a:i.parent.right=a:this._root=a,a&&(a.parent=i.parent)}minNode(i=this._root){if(i)for(;i.left;)i=i.left;return i}maxNode(i=this._root){if(i)for(;i.right;)i=i.right;return i}insert(i,a){var d=this._root,p=null,y=this._compare;if(this._noDuplicates)for(;d;){if(p=d,y(d.key,i)===0)return;d=y(d.key,i)<0?d.right:d.left}else for(;d;)p=d,d=y(d.key,i)<0?d.right:d.left;return d={key:i,data:a,left:null,right:null,parent:p},p?y(p.key,d.key)<0?p.right=d:p.left=d:this._root=d,this.splay(d),this._size++,d}find(i){for(var a=this._root,d=this._compare;a;){var p=d(a.key,i);if(p<0)a=a.right;else{if(!(p>0))return a;a=a.left}}return null}contains(i){for(var a=this._root,d=this._compare;a;){var p=d(i,a.key);if(p===0)return!0;a=p<0?a.left:a.right}return!1}remove(i){var a=this.find(i);if(!a)return!1;if(this.splay(a),a.left)if(a.right){var d=this.minNode(a.right);d.parent!==a&&(this.replace(d,d.right),d.right=a.right,d.right.parent=d),this.replace(a,d),d.left=a.left,d.left.parent=d}else this.replace(a,a.left);else this.replace(a,a.right);return this._size--,!0}removeNode(i){if(!i)return!1;if(this.splay(i),i.left)if(i.right){var a=this.minNode(i.right);a.parent!==i&&(this.replace(a,a.right),a.right=i.right,a.right.parent=a),this.replace(i,a),a.left=i.left,a.left.parent=a}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0}erase(i){var a=this.find(i);if(a){this.splay(a);var d=a.left,p=a.right,y=null;d&&(d.parent=null,y=this.maxNode(d),this.splay(y),this._root=y),p&&(d?y.right=p:this._root=p,p.parent=y),this._size--}}pop(){var i=this._root,a=null;if(i){for(;i.left;)i=i.left;a={key:i.key,data:i.data},this.remove(i.key)}return a}next(i){var a=i;if(a)if(a.right)for(a=a.right;a&&a.left;)a=a.left;else for(a=i.parent;a&&a.right===i;)i=a,a=a.parent;return a}prev(i){var a=i;if(a)if(a.left)for(a=a.left;a&&a.right;)a=a.right;else for(a=i.parent;a&&a.left===i;)i=a,a=a.parent;return a}forEach(i){for(var a=this._root,d=[],p=!1,y=0;!p;)a?(d.push(a),a=a.left):d.length>0?(i(a=d.pop(),y++),a=a.right):p=!0;return this}range(i,a,d,p){const y=[],_=this._compare;let b,E=this._root;for(;y.length!==0||E;)if(E)y.push(E),E=E.left;else{if(E=y.pop(),b=_(E.key,a),b>0)break;if(_(E.key,i)>=0&&d.call(p,E))return this;E=E.right}return this}keys(){for(var i=this._root,a=[],d=[],p=!1;!p;)i?(a.push(i),i=i.left):a.length>0?(i=a.pop(),d.push(i.key),i=i.right):p=!0;return d}values(){for(var i=this._root,a=[],d=[],p=!1;!p;)i?(a.push(i),i=i.left):a.length>0?(i=a.pop(),d.push(i.data),i=i.right):p=!0;return d}at(i){for(var a=this._root,d=[],p=!1,y=0;!p;)if(a)d.push(a),a=a.left;else if(d.length>0){if(a=d.pop(),y===i)return a;y++,a=a.right}else p=!0;return null}load(i=[],a=[],d=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const p=i.length;return d&&ZR(i,a,0,p-1,this._compare),this._root=WR(null,i,a,0,p),this._size=p,this}min(){var i=this.minNode(this._root);return i?i.key:null}max(){var i=this.maxNode(this._root);return i?i.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(i,a,d,p,y){return new HR(d,y).load(i,a,p)}}function WR(c,i,a,d,p){const y=p-d;if(y>0){const _=d+Math.floor(y/2),b={key:i[_],data:a[_],parent:c};return b.left=WR(b,i,a,d,_),b.right=WR(b,i,a,_+1,p),b}return null}function ZR(c,i,a,d,p){if(a>=d)return;const y=c[a+d>>1];let _=a-1,b=d+1;for(;;){do _++;while(p(c[_],y)<0);do b--;while(p(c[b],y)>0);if(_>=b)break;let E=c[_];c[_]=c[b],c[b]=E,E=i[_],i[_]=i[b],i[b]=E}ZR(c,i,a,b,p),ZR(c,i,b+1,d,p)}const T$=11102230246251565e-32,Ma=134217729,_ue=(3+8*T$)*T$;function XR(c,i,a,d,p){let y,_,b,E,I=i[0],M=d[0],D=0,N=0;M>I==M>-I?(y=I,I=i[++D]):(y=M,M=d[++N]);let V=0;if(D<c&&N<a)for(M>I==M>-I?(_=I+y,b=y-(_-I),I=i[++D]):(_=M+y,b=y-(_-M),M=d[++N]),y=_,b!==0&&(p[V++]=b);D<c&&N<a;)M>I==M>-I?(_=y+I,E=_-y,b=y-(_-E)+(I-E),I=i[++D]):(_=y+M,E=_-y,b=y-(_-E)+(M-E),M=d[++N]),y=_,b!==0&&(p[V++]=b);for(;D<c;)_=y+I,E=_-y,b=y-(_-E)+(I-E),I=i[++D],y=_,b!==0&&(p[V++]=b);for(;N<a;)_=y+M,E=_-y,b=y-(_-E)+(M-E),M=d[++N],y=_,b!==0&&(p[V++]=b);return y===0&&V!==0||(p[V++]=y),V}function cw(c){return new Float64Array(c)}const k_=cw(4),E$=cw(8),A$=cw(12),P$=cw(16),il=cw(4);function uw(c,i,a){i===null?(c.inOut=!1,c.otherInOut=!0):(c.isSubject===i.isSubject?(c.inOut=!i.inOut,c.otherInOut=i.otherInOut):(c.inOut=!i.otherInOut,c.otherInOut=i.isVertical()?!i.inOut:i.inOut),i&&(c.prevInResult=!C$(i,a)||i.isVertical()?i.prevInResult:i)),c.resultTransition=C$(c,a)?function(d,p){let y,_=!d.inOut,b=!d.otherInOut;switch(p){case 0:y=_&&b;break;case 1:y=_||b;break;case 3:y=_!==b;break;case 2:y=d.isSubject?_&&!b:b&&!_}return y?1:-1}(c,a):0}function C$(c,i){switch(c.type){case 0:switch(i){case 0:return!c.otherInOut;case 1:return c.otherInOut;case 2:return c.isSubject&&c.otherInOut||!c.isSubject&&!c.otherInOut;case 3:return!0}break;case 2:return i===0||i===1;case 3:return i===2;case 1:return!1}return!1}class R_{constructor(i,a,d,p,y){this.left=a,this.point=i,this.otherEvent=d,this.isSubject=p??!1,this.type=y||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(i){const a=this.point,d=this.otherEvent.point;return this.left?(a[0]-i[0])*(d[1]-i[1])-(d[0]-i[0])*(a[1]-i[1])>0:(d[0]-i[0])*(a[1]-i[1])-(a[0]-i[0])*(d[1]-i[1])>0}isAbove(i){return!this.isBelow(i)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const i=new R_(this.point,this.left,this.otherEvent,this.isSubject,this.type);return i.contourId=this.contourId,i.resultTransition=this.resultTransition,i.prevInResult=this.prevInResult,i.isExteriorRing=this.isExteriorRing,i.inOut=this.inOut,i.otherInOut=this.otherInOut,i}}function yd(c,i){return c[0]===i[0]&&c[1]===i[1]}function KR(c,i,a){const d=function(p,y,_,b,E,I){const M=(y-I)*(_-E),D=(p-E)*(b-I),N=M-D;if(M===0||D===0||M>0!=D>0)return N;const V=Math.abs(M+D);return Math.abs(N)>=33306690738754716e-32*V?N:-function(G,Y,re,J,oe,le,de){let _e,ye,Te,Ae,Se,Oe,Me,st,et,it,mt,ft,pt,Ke,yt,ut,_t,gt;const Vt=G-oe,Ut=re-oe,kt=Y-le,Dt=J-le;Ke=Vt*Dt,Oe=Ma*Vt,Me=Oe-(Oe-Vt),st=Vt-Me,Oe=Ma*Dt,et=Oe-(Oe-Dt),it=Dt-et,yt=st*it-(Ke-Me*et-st*et-Me*it),ut=kt*Ut,Oe=Ma*kt,Me=Oe-(Oe-kt),st=kt-Me,Oe=Ma*Ut,et=Oe-(Oe-Ut),it=Ut-et,_t=st*it-(ut-Me*et-st*et-Me*it),mt=yt-_t,Se=yt-mt,k_[0]=yt-(mt+Se)+(Se-_t),ft=Ke+mt,Se=ft-Ke,pt=Ke-(ft-Se)+(mt-Se),mt=pt-ut,Se=pt-mt,k_[1]=pt-(mt+Se)+(Se-ut),gt=ft+mt,Se=gt-ft,k_[2]=ft-(gt-Se)+(mt-Se),k_[3]=gt;let lr=function(mn,$r){let Ln=$r[0];for(let sn=1;sn<4;sn++)Ln+=$r[sn];return Ln}(0,k_),Jt=22204460492503146e-32*de;if(lr>=Jt||-lr>=Jt||(Se=G-Vt,_e=G-(Vt+Se)+(Se-oe),Se=re-Ut,Te=re-(Ut+Se)+(Se-oe),Se=Y-kt,ye=Y-(kt+Se)+(Se-le),Se=J-Dt,Ae=J-(Dt+Se)+(Se-le),_e===0&&ye===0&&Te===0&&Ae===0)||(Jt=11093356479670487e-47*de+_ue*Math.abs(lr),lr+=Vt*Ae+Dt*_e-(kt*Te+Ut*ye),lr>=Jt||-lr>=Jt))return lr;Ke=_e*Dt,Oe=Ma*_e,Me=Oe-(Oe-_e),st=_e-Me,Oe=Ma*Dt,et=Oe-(Oe-Dt),it=Dt-et,yt=st*it-(Ke-Me*et-st*et-Me*it),ut=ye*Ut,Oe=Ma*ye,Me=Oe-(Oe-ye),st=ye-Me,Oe=Ma*Ut,et=Oe-(Oe-Ut),it=Ut-et,_t=st*it-(ut-Me*et-st*et-Me*it),mt=yt-_t,Se=yt-mt,il[0]=yt-(mt+Se)+(Se-_t),ft=Ke+mt,Se=ft-Ke,pt=Ke-(ft-Se)+(mt-Se),mt=pt-ut,Se=pt-mt,il[1]=pt-(mt+Se)+(Se-ut),gt=ft+mt,Se=gt-ft,il[2]=ft-(gt-Se)+(mt-Se),il[3]=gt;const Ft=XR(4,k_,4,il,E$);Ke=Vt*Ae,Oe=Ma*Vt,Me=Oe-(Oe-Vt),st=Vt-Me,Oe=Ma*Ae,et=Oe-(Oe-Ae),it=Ae-et,yt=st*it-(Ke-Me*et-st*et-Me*it),ut=kt*Te,Oe=Ma*kt,Me=Oe-(Oe-kt),st=kt-Me,Oe=Ma*Te,et=Oe-(Oe-Te),it=Te-et,_t=st*it-(ut-Me*et-st*et-Me*it),mt=yt-_t,Se=yt-mt,il[0]=yt-(mt+Se)+(Se-_t),ft=Ke+mt,Se=ft-Ke,pt=Ke-(ft-Se)+(mt-Se),mt=pt-ut,Se=pt-mt,il[1]=pt-(mt+Se)+(Se-ut),gt=ft+mt,Se=gt-ft,il[2]=ft-(gt-Se)+(mt-Se),il[3]=gt;const br=XR(Ft,E$,4,il,A$);Ke=_e*Ae,Oe=Ma*_e,Me=Oe-(Oe-_e),st=_e-Me,Oe=Ma*Ae,et=Oe-(Oe-Ae),it=Ae-et,yt=st*it-(Ke-Me*et-st*et-Me*it),ut=ye*Te,Oe=Ma*ye,Me=Oe-(Oe-ye),st=ye-Me,Oe=Ma*Te,et=Oe-(Oe-Te),it=Te-et,_t=st*it-(ut-Me*et-st*et-Me*it),mt=yt-_t,Se=yt-mt,il[0]=yt-(mt+Se)+(Se-_t),ft=Ke+mt,Se=ft-Ke,pt=Ke-(ft-Se)+(mt-Se),mt=pt-ut,Se=pt-mt,il[1]=pt-(mt+Se)+(Se-ut),gt=ft+mt,Se=gt-ft,il[2]=ft-(gt-Se)+(mt-Se),il[3]=gt;const Gr=XR(br,A$,4,il,P$);return P$[Gr-1]}(p,y,_,b,E,I,V)}(c[0],c[1],i[0],i[1],a[0],a[1]);return d>0?-1:d<0?1:0}function qf(c,i){const a=c.point,d=i.point;return a[0]>d[0]?1:a[0]<d[0]?-1:a[1]!==d[1]?a[1]>d[1]?1:-1:function(p,y,_){return p.left!==y.left?p.left?1:-1:KR(_,p.otherEvent.point,y.otherEvent.point)!==0?p.isBelow(y.otherEvent.point)?-1:1:!p.isSubject&&y.isSubject?1:-1}(c,i,a)}function Hf(c,i,a){const d=new R_(i,!1,c,c.isSubject),p=new R_(i,!0,c.otherEvent,c.isSubject);return yd(c.point,c.otherEvent.point)&&console.warn("what is that, a collapsed segment?",c),d.contourId=p.contourId=c.contourId,qf(p,c.otherEvent)>0&&(c.otherEvent.left=!0,p.left=!1),c.otherEvent.otherEvent=p,c.otherEvent=d,a.push(p),a.push(d),a}function VA(c,i){return c[0]*i[1]-c[1]*i[0]}function YR(c,i){return c[0]*i[0]+c[1]*i[1]}function JR(c,i,a){const d=function(E,I,M,D){const N=[I[0]-E[0],I[1]-E[1]],V=[D[0]-M[0],D[1]-M[1]];function G(Te,Ae,Se){return[Te[0]+Ae*Se[0],Te[1]+Ae*Se[1]]}const Y=[M[0]-E[0],M[1]-E[1]];let re=VA(N,V),J=re*re;const oe=YR(N,N);if(J>0){const Te=VA(Y,V)/re;if(Te<0||Te>1)return null;const Ae=VA(Y,N)/re;return Ae<0||Ae>1?null:Te===0||Te===1?[G(E,Te,N)]:Ae===0||Ae===1?[G(M,Ae,V)]:[G(E,Te,N)]}if(re=VA(Y,N),J=re*re,J>0)return null;const le=YR(N,Y)/oe,de=le+YR(N,V)/oe,_e=Math.min(le,de),ye=Math.max(le,de);return _e<=1&&ye>=0?_e===1?[G(E,_e>0?_e:0,N)]:ye===0?[G(E,ye<1?ye:1,N)]:[G(E,_e>0?_e:0,N),G(E,ye<1?ye:1,N)]:null}(c.point,c.otherEvent.point,i.point,i.otherEvent.point),p=d?d.length:0;if(p===0||p===1&&(yd(c.point,i.point)||yd(c.otherEvent.point,i.otherEvent.point))||p===2&&c.isSubject===i.isSubject)return 0;if(p===1)return!yd(c.point,d[0])&&!yd(c.otherEvent.point,d[0])&&Hf(c,d[0],a),!yd(i.point,d[0])&&!yd(i.otherEvent.point,d[0])&&Hf(i,d[0],a),1;const y=[];let _=!1,b=!1;return yd(c.point,i.point)?_=!0:qf(c,i)===1?y.push(i,c):y.push(c,i),yd(c.otherEvent.point,i.otherEvent.point)?b=!0:qf(c.otherEvent,i.otherEvent)===1?y.push(i.otherEvent,c.otherEvent):y.push(c.otherEvent,i.otherEvent),_&&b||_?(i.type=1,c.type=i.inOut===c.inOut?2:3,_&&!b&&Hf(y[1].otherEvent,y[0].point,a),2):b?(Hf(y[0],y[1].point,a),3):y[0]!==y[3].otherEvent?(Hf(y[0],y[1].point,a),Hf(y[1],y[2].point,a),3):(Hf(y[0],y[1].point,a),Hf(y[3].otherEvent,y[2].point,a),3)}function vue(c,i){if(c===i)return 0;if(KR(c.point,c.otherEvent.point,i.point)!==0||KR(c.point,c.otherEvent.point,i.otherEvent.point)!==0)return yd(c.point,i.point)?c.isBelow(i.otherEvent.point)?-1:1:c.point[0]===i.point[0]?c.point[1]<i.point[1]?-1:1:qf(c,i)===1?i.isAbove(c.point)?-1:1:c.isBelow(i.point)?-1:1;if(c.isSubject!==i.isSubject)return c.isSubject?-1:1;{let a=c.point,d=i.point;if(a[0]===d[0]&&a[1]===d[1])return a=c.otherEvent.point,d=i.otherEvent.point,a[0]===d[0]&&a[1]===d[1]?0:(c.contourId??0)>(i.contourId??0)?1:-1}return qf(c,i)===1?1:-1}class xue{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function bue(c,i,a,d){let p,y=c+1,_=i[c].point;const b=i.length;for(y<b&&(p=i[y].point);y<b&&p[0]===_[0]&&p[1]===_[1];){if(!a[y])return y;y++,y<b&&(p=i[y].point)}for(y=c-1;a[y]&&y>d;)y--;return y}function wue(c,i,a){const d=new xue;if(c.prevInResult!=null){const p=c.prevInResult,y=p.outputContourId;if(p.resultTransition>0){const _=i[y];if(_.holeOf!=null){const b=_.holeOf;i[b].holeIds.push(a),d.holeOf=b,d.depth=i[y].depth}else i[y].holeIds.push(a),d.holeOf=y,d.depth=i[y].depth+1}else d.holeOf=null,d.depth=i[y].depth}else d.holeOf=null,d.depth=0;return d}const I$=Math.max,O$=Math.min;let UA=0;function k$(c,i,a,d,p,y){let _,b,E,I,M,D;for(_=0,b=c.length-1;_<b;_++){if(E=c[_],I=c[_+1],M=new R_(E,!1,void 0,i),D=new R_(I,!1,M,i),M.otherEvent=D,E[0]===I[0]&&E[1]===I[1])continue;M.contourId=D.contourId=a,y||(M.isExteriorRing=!1,D.isExteriorRing=!1),qf(M,D)>0?D.left=!0:M.left=!0;const N=E[0],V=E[1];p[0]=O$(p[0],N),p[1]=O$(p[1],V),p[2]=I$(p[2],N),p[3]=I$(p[3],V),d.push(M),d.push(D)}}const GA=[];function R$(c,i,a){let d=c,p=i;typeof c[0][0][0]=="number"&&(d=[c]),typeof i[0][0][0]=="number"&&(p=[i]);let y=function(N,V,G){let Y=null;return N.length*V.length===0&&(G===0?Y=GA:G===2?Y=N:(G===1||G===3)&&(Y=N.length===0?V:N)),Y}(d,p,a);if(y)return y===GA?null:y;const _=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=function(N,V,G,Y,re){const J=new Tm(void 0,qf);let oe,le,de,_e,ye,Te;for(de=0,_e=N.length;de<_e;de++)for(oe=N[de],ye=0,Te=oe.length;ye<Te;ye++)le=ye===0,le&&UA++,k$(oe[ye],!0,UA,J,G,le);for(de=0,_e=V.length;de<_e;de++)for(oe=V[de],ye=0,Te=oe.length;ye<Te;ye++)le=ye===0,re===2&&(le=!1),le&&UA++,k$(oe[ye],!1,UA,J,Y,le);return J}(d,p,_,b,a);if(y=function(N,V,G,Y,re){let J=null;return(G[0]>Y[2]||Y[0]>G[2]||G[1]>Y[3]||Y[1]>G[3])&&(re===0?J=GA:re===2?J=N:(re===1||re===3)&&(J=N.concat(V))),J}(d,p,_,b,a),y)return y===GA?null:y;const I=function(N,V,G,Y,re,J){const oe=new HR(vue),le=[],de=Math.min(Y[2],re[2]);let _e,ye,Te;for(;N.length!==0;){let Ae=N.pop();if(le.push(Ae),J===0&&Ae.point[0]>de||J===2&&Ae.point[0]>Y[2])break;if(Ae.left){ye=_e=oe.insert(Ae),Te=oe.minNode(),_e=_e!==Te?oe.prev(_e):null,ye=oe.next(ye);const Se=_e?_e.key:null;let Oe;if(uw(Ae,Se,J),ye&&JR(Ae,ye.key,N)===2&&(uw(Ae,Se,J),uw(ye.key,Ae,J)),_e&&JR(_e.key,Ae,N)===2){let Me=_e;Me=Me!==Te?oe.prev(Me):null,Oe=Me?Me.key:null,uw(Se,Oe,J),uw(Ae,Se,J)}}else Ae=Ae.otherEvent,ye=_e=oe.find(Ae),_e&&ye&&(_e=_e!==Te?oe.prev(_e):null,ye=oe.next(ye),oe.remove(Ae),ye&&_e&&JR(_e.key,ye.key,N))}return le}(E,0,0,_,b,a),M=function(N){let V,G;const Y=function(oe){let le,de,_e,ye,Te;const Ae=[];for(de=0,_e=oe.length;de<_e;de++)le=oe[de],(le.left&&le.inResult||!le.left&&le.otherEvent.inResult)&&Ae.push(le);let Se=!1;for(;!Se;)for(Se=!0,de=0,_e=Ae.length;de<_e;de++)de+1<_e&&qf(Ae[de],Ae[de+1])===1&&(ye=Ae[de],Ae[de]=Ae[de+1],Ae[de+1]=ye,Se=!1);for(de=0,_e=Ae.length;de<_e;de++)le=Ae[de],le.otherPos=de;for(de=0,_e=Ae.length;de<_e;de++)le=Ae[de],le.left||(Te=le.otherPos,le.otherPos=le.otherEvent.otherPos,le.otherEvent.otherPos=Te);return Ae}(N),re={},J=[];for(V=0,G=Y.length;V<G;V++){if(re[V])continue;const oe=J.length,le=wue(Y[V],J,oe),de=Te=>{re[Te]=!0,Te<Y.length&&Y[Te]&&(Y[Te].outputContourId=oe)};let _e=V,ye=V;for(le.points.push(Y[V].point);de(_e),_e=Y[_e].otherPos,de(_e),le.points.push(Y[_e].point),_e=bue(_e,Y,re,ye),!(_e==ye||_e>=Y.length)&&Y[_e];);J.push(le)}return J}(I),D=[];for(let N=0;N<M.length;N++){let V=M[N];if(V.isExterior()){let G=[V.points];for(let Y=0;Y<V.holeIds.length;Y++)G.push(M[V.holeIds[Y]].points);D.push(G)}}return D}function qA(c,i,a,d){const p=[],y=d===0?(_,b,E,I,M,D)=>{_.push(new wt(D,E+(D-b)/(I-b)*(M-E)))}:(_,b,E,I,M,D)=>{_.push(new wt(b+(D-E)/(M-E)*(I-b),D))};for(const _ of c){const b=[];for(const E of _){if(E.length<=2)continue;const I=[];for(let N=0;N<E.length-1;N++){const V=E[N].x,G=E[N].y,Y=E[N+1].x,re=E[N+1].y,J=d===0?V:G,oe=d===0?Y:re;J<i?oe>i&&y(I,V,G,Y,re,i):J>a?oe<a&&y(I,V,G,Y,re,a):I.push(E[N]),oe<i&&J>=i&&y(I,V,G,Y,re,i),oe>a&&J<=a&&y(I,V,G,Y,re,a)}let M=E[E.length-1];const D=d===0?M.x:M.y;D>=i&&D<=a&&I.push(M),I.length&&(M=I[I.length-1],I[0].x===M.x&&I[0].y===M.y||I.push(I[0]),b.push(I))}b.length&&p.push(b)}return p}function Sue(c,i){const a=R$(QR(c),QR([i]),0);return a==null?[]:M$(a)}function Tue(c,i){let d=QR(c,65536);const p=[];for(;i.valid();i.next()){const[y,_]=i.get(),b=y.x*65536,E=y.y*65536,I=_.x*65536,M=_.y*65536,D=I-b,N=M-E,V=Math.hypot(D,N);if(V===0)continue;const G=Math.trunc(N/V*3),Y=-Math.trunc(D/V*3);p.push([[[b,E],[I,M],[I+G,M+Y],[b+G,E+Y],[b,E]]])}return p.length>0&&(d=R$(d,p,2)),M$(d,1/65536,128)}function QR(c,i=1){return[c.map(a=>a.map(d=>[d.x*i,d.y*i]))]}function M$(c,i=1,a){return c.map(d=>d.map((p,y)=>{const _=p.map(b=>{let E=b[0],I=b[1];return a&&(E=Math.round(E/a)*a,I=Math.round(I/a)*a),new wt(E*i,I*i)._round()});return y>0&&_.reverse(),_}))}class eM{constructor(i,a){this.layoutVertexArray=new pd,this.indexArray=new go,this.lineIndexArray=new Qa,this.triangleSegments=new di,this.lineSegments=new di,this.programConfigurations=new F(i.layers,{zoom:i.zoom,lut:i.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Ko)}update(i,a,d,p,y,_,b,E){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,rue.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.lineIndexBuffer=i.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=i.createVertexBuffer(this.elevatedLayoutVertexArray,nue.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(i,a,d,p,y,_,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,d,p,y,_,void 0,b)}}class tM{constructor(i){this.zoom=i.zoom,this.pixelRatio=i.pixelRatio,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=i.lut,this.bufferData=new eM(i,!1),this.elevationBufferData=new eM(i,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=i.sourceLayerIndex,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,d,p){}populate(i,a,d,p){this.hasPattern=GR("fill",this.layers,this.pixelRatio,a);const y=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:b,id:E,index:I,sourceLayerIndex:M}of i){const D=this.layers[0]._featureFilter.needGeometry,N=Lr(b,D);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),N,d))continue;const V=y?y.evaluate(N,{},d,a.availableImages):void 0,G={id:E,properties:b.properties,type:b.type,sourceLayerIndex:M,index:I,geometry:D?N.geometry:yr(b,d,p),patterns:{},sortKey:V};_.push(G)}y&&_.sort((b,E)=>b.sortKey-E.sortKey);for(const b of _){const{geometry:E,index:I,sourceLayerIndex:M}=b;if(this.hasPattern){const D=qR("fill",this.layers,b,this.zoom,this.pixelRatio,a);this.patternFeatures.push(D)}else this.addFeature(b,E,I,d,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(i[I].feature,E,I,M,this.index)}}update(i,a,d,p,y,_,b){this.bufferData.update(i,a,d,p,y,_,b,this.worldview),this.elevationBufferData.update(i,a,d,p,y,_,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(i,a,d,p,y,_,b,this.worldview)}addFeatures(i,a,d,p,y,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,d,p,_,i.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(i){this.bufferData.upload(i),this.elevationBufferData.upload(i),this.elevatedStructures&&this.elevatedStructures.upload(i)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(i,a,d,p,y,_=[],b,E){const I=lw(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(i,I,p,d,E):this.addGeometry(I,this.bufferData),this.bufferData.populatePaintArrays(i,d,y,_,p,b,this.worldview),this.elevationBufferData.populatePaintArrays(i,d,y,_,p,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(i,a,d,p,y){this.elevatedStructures&&(this.elevatedStructures.construct(i),this.elevatedStructures.populatePaintArrays(a,d,p,y,this.worldview))}addElevatedRoadFeature(i,a,d,p,y){const _=new Array,b=ya.getElevationFeature(i,y);if(!b)return void this.addGeometry(a,this.bufferData);{const I=this.clipPolygonsToTile(a,1);I.length>0&&_.push({polygons:I,elevationFeature:b,elevationTileID:d})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(i,{},d),featureIndex:p};for(const I of _)if(I.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new nl(I.elevationTileID,this.layers,this.zoom,this.lut));const D=I.elevationFeature.isTunnel();let N=0;i.properties.hasOwnProperty(kr)&&(N=+i.properties[kr]),this.elevatedStructures.addPortalCandidates(I.elevationFeature.id,I.polygons,D,I.elevationFeature,N)}I.elevationFeature.constantHeight==null&&(I.polygons=this.prepareElevatedPolygons(I.polygons,I.elevationFeature,I.elevationTileID));const M=new Ol(d,I.elevationTileID);this.addElevatedGeometry(I.polygons,M,I.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,p,E)}}addElevatedGeometry(i,a,d,p,y,_){const b={elevation:d,elevationSampler:a,bias:p,index:y,featureInfo:_},[E,I]=this.addGeometry(i,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:I}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,I))}addGeometry(i,a,d){let p=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=null;d&&(_=d.elevationSampler.constantElevation(d.elevation,d.bias),_!=null&&(p=_,y=_));const b=(E,I,M)=>{if(d!=null)if(I.push(E),_!=null)a.elevatedLayoutVertexArray.emplaceBack(_),M.push(_);else{const D=d.elevationSampler.pointElevation(E,d.elevation,d.bias);a.elevatedLayoutVertexArray.emplaceBack(D),M.push(D),p=Math.min(p,D),y=Math.max(y,D)}};for(const E of i){let I=0;for(const le of E)I+=le.length;const M=a.triangleSegments.prepareSegment(I,a.layoutVertexArray,a.indexArray),D=M.vertexLength,N=[],V=[],G=[],Y=[],re=[],J=a.layoutVertexArray.length;for(const le of E){if(le.length===0)continue;le!==E[0]&&V.push(N.length/2);const de=a.lineSegments.prepareSegment(le.length,a.layoutVertexArray,a.lineIndexArray),_e=de.vertexLength;d&&re.push(a.layoutVertexArray.length-J),b(le[0],G,Y),a.layoutVertexArray.emplaceBack(le[0].x,le[0].y),a.lineIndexArray.emplaceBack(_e+le.length-1,_e),N.push(le[0].x),N.push(le[0].y);for(let ye=1;ye<le.length;ye++)b(le[ye],G,Y),a.layoutVertexArray.emplaceBack(le[ye].x,le[ye].y),a.lineIndexArray.emplaceBack(_e+ye-1,_e+ye),N.push(le[ye].x),N.push(le[ye].y);de.vertexLength+=le.length,de.primitiveLength+=le.length}const oe=I_(N,V);for(let le=0;le<oe.length;le+=3)a.indexArray.emplaceBack(D+oe[le],D+oe[le+1],D+oe[le+2]);if(oe.length>0&&d&&this.elevationMode==="hd-road-base"){const le=d.elevation.isTunnel(),de=d.elevation.safeArea,_e=this.elevatedStructures.addVertices(G,Y);this.elevatedStructures.addTriangles(oe,_e,le);const ye=re.length;if(ye>0){for(let Te=0;Te<ye-1;Te++)this.elevatedStructures.addRenderableRing(d.index,re[Te]+_e,re[Te+1]-re[Te],le,de,d.featureInfo);this.elevatedStructures.addRenderableRing(d.index,re[ye-1]+_e,G.length-re[ye-1],le,de,d.featureInfo)}}M.vertexLength+=I,M.primitiveLength+=oe.length/3}return[p,y]}prepareElevatedPolygons(i,a,d){const p=1/At(d),y=[];for(const _ of i){const b=Tue(_,new Oa(a,p));y.push(...b)}return y}clipPolygonsToTile(i,a){const d=-a,p=-a,y=Mt+a,_=Mt+a;let b=0;const E=[],I=[];for(;b<i.length;b++){const N=i[b],V=Sm(N);(V.min.x>=d&&V.max.x<=y&&V.min.y>=p&&V.max.y<=_?E:I).push(N)}if(E.length===i.length)return i;const M=[new wt(d,p),new wt(y,p),new wt(y,_),new wt(d,_),new wt(d,p)],D=E;for(const N of I)D.push(...Sue(N,M));return D}}let D$,L$,j$,N$;Wt(tM,"FillBucket",{omit:["layers","patternFeatures"]}),Wt(eM,"FillBufferData"),Wt(nl,"ElevatedStructures");class HA{constructor(i,a,d,p){if(this.triangleCount=a.length/3,this.min=new wt(0,0),this.max=new wt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||i.length===0)return;const[y,_]=[i[0].clone(),i[0].clone()];for(let D=1;D<i.length;++D){const N=i[D];y.x=Math.min(y.x,N.x),y.y=Math.min(y.y,N.y),_.x=Math.max(_.x,N.x),_.y=Math.max(_.y,N.y)}if(p){const D=Math.ceil(Math.max(_.x-y.x,_.y-y.y)/p);d=Math.max(d,D)}if(d===0)return;this.min=y,this.max=_;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const E=Math.max(b.x,b.y)/d;this.cellsX=Math.max(1,Math.ceil(b.x/E)),this.cellsY=Math.max(1,Math.ceil(b.y/E)),this.xScale=1/E,this.yScale=1/E;const I=[];for(let D=0;D<this.triangleCount;D++){const N=i[a[3*D+0]].sub(this.min),V=i[a[3*D+1]].sub(this.min),G=i[a[3*D+2]].sub(this.min),Y=_d(Math.floor(Math.min(N.x,V.x,G.x)),this.xScale,this.cellsX),re=_d(Math.floor(Math.max(N.x,V.x,G.x)),this.xScale,this.cellsX),J=_d(Math.floor(Math.min(N.y,V.y,G.y)),this.yScale,this.cellsY),oe=_d(Math.floor(Math.max(N.y,V.y,G.y)),this.yScale,this.cellsY),le=new wt(0,0),de=new wt(0,0),_e=new wt(0,0),ye=new wt(0,0);for(let Te=J;Te<=oe;++Te){le.y=de.y=Te*E,_e.y=ye.y=(Te+1)*E;for(let Ae=Y;Ae<=re;++Ae)le.x=_e.x=Ae*E,de.x=ye.x=(Ae+1)*E,(gu(N,V,G,le,de,ye)||gu(N,V,G,le,ye,_e))&&I.push({cellIdx:Te*this.cellsX+Ae,triIdx:D})}}if(I.length===0)return;I.sort((D,N)=>D.cellIdx-N.cellIdx||D.triIdx-N.triIdx);let M=0;for(;M<I.length;){const D=I[M].cellIdx,N={start:this.payload.length,len:0};for(;M<I.length&&I[M].cellIdx===D;)++N.len,this.payload.push(I[M++].triIdx);this.cells[D]=N}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(i,a){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>i.x||i.y>this.max.y||this.min.y>i.y)return;const d=_d(i.x-this.min.x,this.xScale,this.cellsX),p=_d(i.y-this.min.y,this.yScale,this.cellsY),y=this.cells[p*this.cellsX+d];if(y){this._lazyInitLookup();for(let _=0;_<y.len;_++){const b=this.payload[y.start+_],E=Math.floor(b/8),I=1<<b%8;if(!(this.lookup[E]&I)&&(this.lookup[E]|=I,a.push(b),a.length===this.triangleCount))return}}}query(i,a,d){if(this.triangleCount===0||this.cells.length===0||i.x>this.max.x||this.min.x>a.x||i.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const p=_d(i.x-this.min.x,this.xScale,this.cellsX),y=_d(a.x-this.min.x,this.xScale,this.cellsX),_=_d(i.y-this.min.y,this.yScale,this.cellsY),b=_d(a.y-this.min.y,this.yScale,this.cellsY);for(let E=_;E<=b;E++)for(let I=p;I<=y;I++){const M=this.cells[E*this.cellsX+I];if(M)for(let D=0;D<M.len;D++){const N=this.payload[M.start+D],V=Math.floor(N/8),G=1<<N%8;if(!(this.lookup[V]&G)&&(this.lookup[V]|=G,d.push(N),d.length===this.triangleCount))return}}}}function _d(c,i,a){return Math.max(0,Math.min(a-1,Math.floor(c*i)))}Wt(HA,"TriangleGridIndex");class z${constructor(i){this.zoom=i.zoom,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){for(const d of this.footprints)a.push({footprint:d,id:i})}updateAppearances(i,a,d,p){}populate(i,a,d,p){const y=[];for(const{feature:_,id:b,index:E,sourceLayerIndex:I}of i){const M=this.layers[0]._featureFilter.needGeometry,D=Lr(_,M);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),D,d))continue;const N={id:b,properties:_.properties,type:_.type,sourceLayerIndex:I,index:E,geometry:M?D.geometry:yr(_,d,p),patterns:{}};y.push(N)}for(const _ of y){const{geometry:b,index:E,sourceLayerIndex:I}=_;this.addFeature(_,b,E,d,{},a.availableImages,a.brightness),a.featureIndex.insert(i[E].feature,b,E,I,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(i){}update(i,a,d,p,y,_,b){}destroy(){}addFeature(i,a,d,p,y,_=[],b){for(const E of lw(a,2)){const I=[],M=[],D=[],N=new wt(1/0,1/0),V=new wt(-1/0,-1/0);for(const re of E)if(re.length!==0){re!==E[0]&&D.push(M.length/2);for(let J=0;J<re.length;J++)M.push(re[J].x),M.push(re[J].y),I.push(re[J]),N.x=Math.min(N.x,re[J].x),N.y=Math.min(N.y,re[J].y),V.x=Math.max(V.x,re[J].x),V.y=Math.max(V.y,re[J].y)}const G=I_(M,D),Y=new HA(I,G,8,256);this.footprints.push({vertices:I,indices:G,grid:Y,min:N,max:V})}}}Wt(z$,"ClipBucket",{omit:["layers"]});const Eue=Zr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Aue=Zr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Pue=Zr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Cue=Zr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Iue=Zr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Oue=Zr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),kue=Zr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rue}=Eue,dw=Number.MAX_SAFE_INTEGER,Mue=dw-1;function F$(c,i,a,d){return c.order<i||c.order===dw||!(c.clipMask&a)||function(p,y){return y.length!==0&&y.find(_=>_===p)===void 0}(d,c.clipScope)}function WA(c,i){return c.x-i.x||c.y-i.y}function B$(c,i){return WA(c.min,i.min)===0&&WA(c.max,i.max)===0}function rM(c,i){return!(c.min.x>i.max.x||c.max.x<i.min.x||c.min.y>i.max.y||c.max.y<i.min.y)}function ZA(c,i){if(c.length!==i.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==i[a].sourceId||!B$(c[a],i[a])||c[a].order!==i[a].order||c[a].clipMask!==i[a].clipMask||!Cs(c[a].clipScope,i[a].clipScope))return!1;return!0}function $$(c,i,a){const d=1/Mt,p=1/(1<<a.canonical.z),y=(i.x*d+a.canonical.x)*p+a.wrap,_=(i.y*d+a.canonical.y)*p;return{min:new wt((c.x*d+a.canonical.x)*p+a.wrap,(c.y*d+a.canonical.y)*p),max:new wt(y,_)}}function Due(c,i,a){const d=1<<a.canonical.z,p=((i.x-a.wrap)*d-a.canonical.x)*Mt,y=(i.y*d-a.canonical.y)*Mt;return{min:new wt(((c.x-a.wrap)*d-a.canonical.x)*Mt,(c.y*d-a.canonical.y)*Mt),max:new wt(p,y)}}function nM(c,i,a,d,p,y,_){const b=c.indices,E=c.vertices,I=[];for(let M=d;M<d+p;M+=3){const D=i[a[M+0]+y],N=i[a[M+1]+y],V=i[a[M+2]+y],G=Math.min(D.x,N.x,V.x),Y=Math.max(D.x,N.x,V.x),re=Math.min(D.y,N.y,V.y),J=Math.max(D.y,N.y,V.y);I.length=0,c.grid.query(new wt(G,re),new wt(Y,J),I);for(let oe=0;oe<I.length;oe++){const le=I[oe];if(gu(E[b[3*le+0]],E[b[3*le+1]],E[b[3*le+2]],D,N,V,_))return!0}}return!1}function V$(c,i,a,d){if(!c||!a)return!1;let p=c.vertices;if(!i.canonical.equals(d.canonical)||i.wrap!==d.wrap){if(a.vertices.length<c.vertices.length)return V$(a,d,c,i);const y=i.canonical,_=d.canonical,b=Math.pow(2,_.z-y.z);p=c.vertices.map(E=>new wt((E.x+y.x*Mt)*b-_.x*Mt,(E.y+y.y*Mt)*b-_.y*Mt))}return nM(a,p,c.indices,0,c.indices.length,0,0)}function U$(c,i,a,d){const p=Math.pow(2,d.z-a.z);return new wt((c+a.x*Mt)*p-d.x*Mt,(i+a.y*Mt)*p-d.y*Mt)}function G$(c,i){const a=[];i.grid.queryPoint(c,a);const d=i.indices,p=i.vertices;for(let y=0;y<a.length;y++){const _=a[y];if(Ra([p[d[3*_+0]],p[d[3*_+1]],p[d[3*_+2]]],c))return!0}return!1}const iM=[new wt(0,0),new wt(Mt,0),new wt(Mt,Mt),new wt(0,Mt)];function q$(c,i){const a=[];let d=[];if(!i||c.length<2)return[c];if(c.length===2)return Ic(c[0],c[1],iM)?[c]:[];for(let p=0;p<c.length+2;p++){const y=c[p%c.length],_=c[(p+1)%c.length],b=Ic(p===0?c[c.length-1]:c[(p-1)%c.length],y,iM),E=Ic(y,_,iM),I=b||E;I&&d.push(y),I&&E||d.length>0&&(d.length>1&&a.push(d),d=[])}return d.length>1&&a.push(d),a}const oM=Jr.types,Lue=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],jue=["fill-extrusion-flood-light-ground-radius"],Nue=Math.pow(2,13),zue=Math.pow(2,15)-1,H$=new wt(0,1),gh=2147483648;function hw(c,i,a,d,p,y,_,b){c.emplaceBack((i<<1)+_,(a<<1)+y,(Math.floor(d*Nue)<<1)+p,Math.round(b))}function fw(c,i,a){c.emplaceBack(i.x*Mt,i.y*Mt,a?1:0)}function XA(c,i,a,d,p,y){c.emplaceBack(i.x,i.y,(a.x<<1)+d,(a.y<<1)+p,y)}function pw(c,i,a){c.emplaceBack(i.x,i.y,i.z,a[0]*16384,a[1]*16384,a[2]*16384)}class W${constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Z${constructor(){this.centroidXY=new wt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new wt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new wt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new wt(this.max.x-this.min.x,this.max.y-this.min.y)}}class X${constructor(){this.acc=new wt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(i,a){i.min.x===Number.MAX_VALUE&&(i.min.x=i.max.x=a.x,i.min.y=i.max.y=a.y)}appendEdge(i,a,d){this.accCount++,this.acc._add(a);let p=!!this.borders;a.x<i.min.x?(i.min.x=a.x,p=!0):a.x>i.max.x&&(i.max.x=a.x,p=!0),a.y<i.min.y?(i.min.y=a.y,p=!0):a.y>i.max.y&&(i.max.y=a.y,p=!0),((a.x===0||a.x===Mt)&&a.x===d.x)!=((a.y===0||a.y===Mt)&&a.y===d.y)&&this.processBorderOverlap(a,d),p&&this.checkBorderIntersection(a,d)}checkBorderIntersection(i,a){a.x<0!=i.x<0&&this.addBorderIntersection(0,mr(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>Mt!=i.x>Mt&&this.addBorderIntersection(1,mr(a.y,i.y,(Mt-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,mr(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>Mt!=i.y>Mt&&this.addBorderIntersection(3,mr(a.x,i.x,(Mt-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const d=this.borders[i];a<d[0]&&(d[0]=a),a>d[1]&&(d[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const d=i.x===0?0:1;this.addBorderIntersection(d,a.y),this.addBorderIntersection(d,i.y)}else{const d=i.y===0?2:3;this.addBorderIntersection(d,a.x),this.addBorderIntersection(d,i.x)}}centroid(){return this.accCount===0?new wt(0,0):new wt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0):0}}function K$(c,i){const a=c.add(i)._unit(),d=we(c.x*a.x+c.y*a.y,-1,1);var p,y,_;return _=Math.acos(d),Math.min(4,Math.max(-4,Math.tan(_)))/4*zue*((p=c).x*(y=i).y-p.y*y.x<0?-1:1)}const Fue=[c=>c.x<0,c=>c.x>Mt,c=>c.y<0,c=>c.y>Mt];function Bue(c,i,a,d){const p=[4];if(d===0)return p;a._mult(d);const y=c.sub(a),_=i.sub(a),b=[c,i,y,_];for(let E=0;E<4;E++)for(const I of b)if(Fue[E](I)){p.push(E);break}return p}class sM{constructor(i){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new qb,this.indexArray=new go,this.programConfigurations=new F(i.layers,{zoom:i.zoom,lut:i.lut},a=>jue.includes(a)),this._segments=new di,this.hiddenByLandmarkVertexArray=new E_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new di}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(i,a,d,p=!1){const y=i.length;if(y>2){let _=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*y,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let E;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const I=i[0],M=i[1];E=K$(I.sub(i[y-1])._perp()._unit(),M.sub(I)._perp()._unit())}for(let I=0;I<y;I++){const M=I===y-1?0:I+1,D=i[I],N=i[M],V=i[M===y-1?0:M+1],G=N.sub(D)._perp()._unit(),Y=K$(G,V.sub(N)._perp()._unit()),re=E,J=Y;if(aM(D,N,a)||p&&Q$(D,a)&&Q$(N,a)){E=Y;continue}const oe=b.vertexLength;XA(this.vertexArray,D,N,1,1,re),XA(this.vertexArray,D,N,1,0,re),XA(this.vertexArray,D,N,0,1,J),XA(this.vertexArray,D,N,0,0,J),b.vertexLength+=4;const le=Bue(D,N,G,d);for(const de of le)this._segmentToGroundQuads[_].push({id:oe,region:de}),this._segmentToRegionTriCounts[_][de]+=2,b.primitiveLength+=2;E=Y}}}prepareBorderSegments(){if(!this.hasData())return;const i=this._segments.get(),a=i.length;for(let d=0;d<a;d++)this._segmentToGroundQuads[d].sort((p,y)=>p.region-y.region);for(let d=0;d<a;d++){const p=this._segmentToGroundQuads[d],y=i[d],_=this._segmentToRegionTriCounts[d];_.reduce((E,I)=>E+I,0);let b=0;for(let E=0;E<=4;E++){const I=_[E];if(I!==0){let M=this.regionSegments[E];M||(M=this.regionSegments[E]=new di);const D={vertexOffset:y.vertexOffset,primitiveOffset:y.primitiveOffset+b,vertexLength:y.vertexLength,primitiveLength:I};M.get().push(D)}b+=I}for(let E=0;E<p.length;E++){const I=p[E].id;this.indexArray.emplaceBack(I,I+1,I+3),this.indexArray.emplaceBack(I,I+3,I+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(i,a,d,p,y,_,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,i,a,d,p,y,_,void 0,b)}upload(i){this.hasData()&&(this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Aue.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=i.createVertexBuffer(this.groundRadiusArray,Pue.members)))}uploadPaintProperties(i){this.hasData()&&this.programConfigurations.upload(i)}update(i,a,d,p,y,_,b,E){this.hasData()&&this.programConfigurations.updatePaintArrays(i,a,d,p,y,_,b,E)}updateHiddenByLandmark(i){this.updateHiddenByLandmarkRange(i.groundVertexArrayOffset,i.groundVertexCount,!!(i.flags&gh))}updateHiddenByLandmarkRange(i,a,d){if(!this.hasData())return;const p=a+i;if(a!==0){for(let y=i;y<p;++y)this.hiddenByLandmarkVertexArray.emplace(y,d?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(i){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=i.createVertexBuffer(this.hiddenByLandmarkVertexArray,Oue.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let i=0;i<=4;i++){const a=this.regionSegments[i];a&&a.destroy()}}}}class KA{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.pixelRatio=i.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new go,this.footprintVertices=new pd,this.footprintSegments=[],this.layoutVertexArray=new mu,this.centroidVertexArray=new AA,this.wallVertexArray=new PA,this.indexArray=new go,this.programConfigurations=new F(i.layers,{zoom:i.zoom,lut:i.lut},a=>Lue.includes(a)),this.segments=new di,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new sM(i),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,d,p){}populate(i,a,d,p){this.features=[],this.hasPattern=GR("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=At(d),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:y,id:_,index:b,sourceLayerIndex:E}of i){const I=this.layers[0]._featureFilter.needGeometry,M=Lr(y,I);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),M,d))continue;const D={id:_,sourceLayerIndex:E,index:b,geometry:I?M.geometry:yr(y,d,p),properties:y.properties,type:y.type,patterns:{}},N=this.layoutVertexArray.length,V=oM[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:y.id,feature:qR("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const G of D.geometry)for(const Y of q$(G,V))this.addFeature(y.id,D,[Y],b,d,{},a.availableImages,p,a.brightness);else this.addFeature(y.id,D,D.geometry,b,d,{},a.availableImages,p,a.brightness);a.featureIndex.insert(y,D.geometry,b,E,this.index,N)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(i,a,d,p,y,_){for(const{featureId:b,feature:E}of this.features){const I=oM[E.type]==="Polygon",{geometry:M}=E;if(this.wallMode)for(const D of M)for(const N of q$(D,I))this.addFeature(b,E,[N],E.index,a,d,p,y,_);else this.addFeature(b,E,M,E.index,a,d,p,y,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(i,a,d,p,y,_,b){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b,this.worldview),this.groundEffect.update(i,a,y,d,p,_,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Rue),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.wallVertexBuffer=i.createVertexBuffer(this.wallVertexArray,Iue.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,kue.members,!0)),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){this.groundEffect.uploadHiddenByLandmark(i),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,Cue.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,d,p,y,_,b,E,I){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,D=[new wt(0,0),new wt(Mt,Mt)],N=E.projection,V=N.name==="globe",G=this.wallMode||oM[a.type]==="Polygon",Y=new X$;Y.centroidDataIndex=this.centroidData.length;const re=new Z$;re.buildingId=i,a.properties&&a.properties.hasOwnProperty("building_id")&&(re.buildingId=Number(a.properties.building_id));const J=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},y)<=0,oe=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},y);let le;if(re.height=oe,re.vertexArrayOffset=this.layoutVertexArray.length,re.groundVertexArrayOffset=this.groundEffect.vertexArray.length,V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new zf),this.wallMode){if(V)return void vr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(d.length!==1)return;le=function(Oe){const Me=Oe[0].x===Oe[Oe.length-1].x&&Oe[0].y===Oe[Oe.length-1].y;(function(kt){let Dt=0;const lr=kt.length;for(let Jt=0;Jt<lr;Jt++)Dt+=(kt[(Jt+1)%lr].x-kt[Jt].x)*(kt[(Jt+1)%lr].y+kt[Jt].y);return Dt>=0})(Oe)||(Oe=Oe.reverse());const et={geometry:[],joinNormals:[],indices:[]},it=[],mt=[],ft=[];let pt=Oe.length;for(;pt>=2&&Oe[pt-1].equals(Oe[pt-2]);)pt--;if(pt<(Me?3:2))return et;let Ke,yt,ut,_t,gt,Vt=0;for(;Vt<pt-1&&Oe[Vt].equals(Oe[Vt+1]);)Vt++;Me&&(Ke=Oe[pt-2],gt=Oe[Vt].sub(Ke)._unit()._perp());for(let kt=Vt;kt<pt;kt++){if(ut=kt===pt-1?Me?Oe[Vt+1]:void 0:Oe[kt+1],ut&&Oe[kt].equals(ut))continue;gt&&(_t=gt),Ke&&(yt=Ke),Ke=Oe[kt],gt=ut?ut.sub(Ke)._unit()._perp():_t,_t=_t||gt;let Dt=_t.add(gt);Dt.x===0&&Dt.y===0||Dt._unit();const lr=Dt.x*gt.x+Dt.y*gt.y,Jt=lr!==0?1/lr:1/0,Ft=_t.x*gt.y-_t.y*gt.x>0;let br="miter";const Gr=2;br==="miter"&&Jt>Gr&&(br="bevel"),br==="bevel"&&(Jt>100&&(br="flipbevel"),Jt<Gr&&(br="miter"));const mn=($r,Ln,sn,Di)=>{const un=new wt($r.x,$r.y),On=new wt($r.x,$r.y);un.x+=Ln.x*Di,un.y+=Ln.y*Di,On.x-=Ln.x*Math.max(sn,1),On.y-=Ln.y*Math.max(sn,1),ft.push(Ln),it.push(un),mt.push(On)};if(br==="miter")Dt._mult(Jt),mn(Ke,Dt,0,0);else if(br==="flipbevel")Dt=gt.mult(-1),mn(Ke,Dt,0,0),mn(Ke,Dt.mult(-1),0,0);else{const $r=-Math.sqrt(Jt*Jt-1),Ln=Ft?$r:0,sn=Ft?0:$r;yt&&mn(Ke,_t,Ln,sn),ut&&mn(Ke,gt,Ln,sn)}}et.geometry=[...it,...mt.reverse(),it[0]],et.joinNormals=[...ft,...ft.reverse(),ft[ft.length-1]];const Ut=et.geometry.length-1;for(let kt=0;kt<Ut/2;kt++)if(kt+1<Ut/2){let Dt=kt,lr=kt+1,Jt=Ut-1-kt,Ft=Ut-2-kt;Dt=Dt===0?Ut-1:Dt-1,lr=lr===0?Ut-1:lr-1,Jt=Jt===0?Ut-1:Jt-1,Ft=Ft===0?Ut-1:Ft-1,et.indices.push(Jt),et.indices.push(lr),et.indices.push(Dt),et.indices.push(Jt),et.indices.push(Ft),et.indices.push(lr)}return et}(d[0]),d=[le.geometry]}const de=(Oe,Me)=>Oe<(Me.length-1)/2||Oe===Me.length-1,_e=this.wallMode?[d]:lw(d,500);for(let Oe=_e.length-1;Oe>=0;Oe--){const Me=_e[Oe];(Me.length===0||Vue(Me[0]))&&_e.splice(Oe,1)}let ye;if(V)ye=nV(_e,D,y);else{ye=[];for(const Oe of _e)ye.push({polygon:Oe,bounds:D})}const Te=G?this.edgeRadius:0,Ae=Te>0&&this.zoom<17,Se=(Oe,Me)=>{if(Oe.length===0)return!1;const st=Oe[Oe.length-1];return Me.x===st.x&&Me.y===st.y};for(const{polygon:Oe,bounds:Me}of ye){let st=0,et=0;for(const pt of Oe)G&&!pt[0].equals(pt[pt.length-1])&&pt.push(pt[0]),et+=G?pt.length-1:pt.length;const it=this.segments.prepareSegment((G?5:4)*et,this.layoutVertexArray,this.indexArray);re.footprintSegIdx<0&&(re.footprintSegIdx=this.footprintSegments.length),re.polygonSegIdx<0&&(re.polygonSegIdx=this.polygonSegments.length);const mt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ft=new W$;if(ft.vertexOffset=this.footprintVertices.length,ft.indexOffset=3*this.footprintIndices.length,ft.ringIndices=[],G){const pt=[],Ke=[];st=it.vertexLength;for(let ut=0;ut<Oe.length;ut++){const _t=Oe[ut];_t.length&&ut!==0&&Ke.push(pt.length/2);const gt=[];let Vt,Ut;Vt=_t[1].sub(_t[0])._perp()._unit(),ft.ringIndices.push(_t.length-1);for(let kt=1;kt<_t.length;kt++){const Dt=_t[kt],lr=_t[kt===_t.length-1?1:kt+1],Jt=Dt.clone();if(Te){Ut=lr.sub(Dt)._perp()._unit();const Ft=Vt.add(Ut)._unit(),br=Te*Math.min(4,1/(Vt.x*Ft.x+Vt.y*Ft.y));Jt.x+=br*Ft.x,Jt.y+=br*Ft.y,Jt.x=Math.round(Jt.x),Jt.y=Math.round(Jt.y),Vt=Ut}if(!J||Te!==0&&!Ae||Se(gt,Jt)||gt.push(Jt),hw(this.layoutVertexArray,Jt.x,Jt.y,0,0,1,1,0),this.wallMode){const Ft=de(kt,_t);fw(this.wallVertexArray,le.joinNormals[kt],!Ft)}it.vertexLength++,this.footprintVertices.emplaceBack(Dt.x,Dt.y),pt.push(Dt.x,Dt.y),V&&pw(this.layoutVertexExtArray,N.projectTilePoint(Jt.x,Jt.y,y),N.upVector(y,Jt.x,Jt.y))}J&&(Te===0||Ae)&&(gt.length!==0&&Se(gt,gt[0])&&gt.pop(),this.groundEffect.addData(gt,Me,M))}const yt=this.wallMode?le.indices:I_(pt,Ke);for(let ut=0;ut<yt.length;ut+=3)this.footprintIndices.emplaceBack(ft.vertexOffset+yt[ut+0],ft.vertexOffset+yt[ut+1],ft.vertexOffset+yt[ut+2]),this.indexArray.emplaceBack(st+yt[ut],st+yt[ut+2],st+yt[ut+1]),it.primitiveLength++;ft.indexCount+=yt.length,ft.vertexCount+=this.footprintVertices.length-ft.vertexOffset}for(let pt=0;pt<Oe.length;pt++){const Ke=Oe[pt];Y.startRing(re,Ke[0]);let yt=Ke.length>4&&eV(Ke[Ke.length-2],Ke[0],Ke[1]),ut=Te?$ue(Ke[Ke.length-2],Ke[0],Ke[1],Te):0;const _t=[];let gt,Vt,Ut;Vt=Ke[1].sub(Ke[0])._perp()._unit();let kt=!0;for(let Dt=1,lr=0;Dt<Ke.length;Dt++){let Jt=Ke[Dt-1],Ft=Ke[Dt];const br=Ke[Dt===Ke.length-1?1:Dt+1];if(Y.appendEdge(re,Ft,Jt),aM(Ft,Jt,Me)){Te&&(Vt=br.sub(Ft)._perp()._unit(),kt=!kt);continue}const Gr=Ft.sub(Jt)._perp(),mn=Gr.x/(Math.abs(Gr.x)+Math.abs(Gr.y)),$r=Gr.y>0?1:0,Ln=Jt.dist(Ft);if(lr+Ln>32768&&(lr=0),Te){Ut=br.sub(Ft)._perp()._unit();let On=J$(Jt,Ft,br,Y$(Vt,Ut),Te);isNaN(On)&&(On=0);const li=Ft.sub(Jt)._unit();Jt=Jt.add(li.mult(ut))._round(),Ft=Ft.add(li.mult(-On))._round(),ut=On,Vt=Ut,J&&this.zoom>=17&&(Se(_t,Jt)||_t.push(Jt),Se(_t,Ft)||_t.push(Ft))}const sn=it.vertexLength,Di=Ke.length>4&&eV(Jt,Ft,br);let un=tV(lr,yt,kt);if(hw(this.layoutVertexArray,Jt.x,Jt.y,mn,$r,0,0,un),hw(this.layoutVertexArray,Jt.x,Jt.y,mn,$r,0,1,un),this.wallMode){const On=de(Dt-1,Ke),li=le.joinNormals[Dt-1];fw(this.wallVertexArray,li,On),fw(this.wallVertexArray,li,On)}if(lr+=Ln,un=tV(lr,Di,!kt),yt=Di,hw(this.layoutVertexArray,Ft.x,Ft.y,mn,$r,0,0,un),hw(this.layoutVertexArray,Ft.x,Ft.y,mn,$r,0,1,un),this.wallMode){const On=de(Dt,Ke),li=le.joinNormals[Dt];fw(this.wallVertexArray,li,On),fw(this.wallVertexArray,li,On)}if(it.vertexLength+=4,this.indexArray.emplaceBack(sn+0,sn+1,sn+2),this.indexArray.emplaceBack(sn+1,sn+3,sn+2),it.primitiveLength+=2,Te){const On=st+(Dt===1?Ke.length-2:Dt-2),li=Dt===1?st:On+1;if(this.indexArray.emplaceBack(sn+1,On,sn+3),this.indexArray.emplaceBack(On,li,sn+3),it.primitiveLength+=2,gt===void 0&&(gt=sn),!aM(br,Ke[Dt],Me)){const gi=Dt===Ke.length-1?gt:it.vertexLength;this.indexArray.emplaceBack(sn+2,sn+3,gi),this.indexArray.emplaceBack(sn+3,gi+1,gi),this.indexArray.emplaceBack(sn+3,li,gi+1),it.primitiveLength+=3}kt=!kt}if(V){const On=this.layoutVertexExtArray,li=N.projectTilePoint(Jt.x,Jt.y,y),gi=N.projectTilePoint(Ft.x,Ft.y,y),yi=N.upVector(y,Jt.x,Jt.y),Li=N.upVector(y,Ft.x,Ft.y);pw(On,li,yi),pw(On,li,yi),pw(On,gi,Li),pw(On,gi,Li)}}G&&(st+=Ke.length-1),J&&Te&&this.zoom>=17&&(_t.length!==0&&Se(_t,_t[0])&&_t.pop(),this.groundEffect.addData(_t,Me,M,Te>0))}this.footprintSegments.push(ft),mt.triangleCount=this.indexArray.length-mt.triangleArrayOffset,this.polygonSegments.push(mt),++re.footprintSegLen,++re.polygonSegLen}if(re.vertexCount=this.layoutVertexArray.length-re.vertexArrayOffset,re.groundVertexCount=this.groundEffect.vertexArray.length-re.groundVertexArrayOffset,re.vertexCount!==0){if(re.centroidXY=Y.borders?H$:this.encodeCentroid(Y,re),this.centroidData.push(re),Y.borders){this.featuresOnBorder.push(Y);const Oe=this.featuresOnBorder.length-1;for(let Me=0;Me<Y.borders.length;Me++)Y.borders[Me][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Me].push(Oe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,p,_,b,y,I,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,p,_,b,y,I,this.worldview),this.maxHeight=Math.max(this.maxHeight,oe)}}sortBorders(){for(let i=0;i<this.borderFeatureIndices.length;i++)this.borderFeatureIndices[i].sort((a,d)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[d].borders[i][0])}splitToSubtiles(){const i=[];for(let b=0;b<this.centroidData.length;b++){const E=this.centroidData[b],I=+(E.min.y+E.max.y>Mt),M=2*I+(+(E.min.x+E.max.x>Mt)^I);for(let D=0;D<E.polygonSegLen;D++){const N=E.polygonSegIdx+D;i.push({centroidIdx:b,subtile:M,polygonSegmentIdx:N,triangleSegmentIdx:this.polygonSegments[N].triangleSegIdx})}}const a=new go;i.sort((b,E)=>b.triangleSegmentIdx===E.triangleSegmentIdx?b.subtile-E.subtile:b.triangleSegmentIdx-E.triangleSegmentIdx);let d=0,p=0,y=0;for(const b of i){if(b.triangleSegmentIdx!==d)break;y++}const _=i.length;for(;p!==i.length;){d=i[p].triangleSegmentIdx;let b=0,E=p,I=p;for(let M=E;M<y&&i[M].subtile===b;M++)I++;for(;E!==y;){const M=i[E];b=M.subtile;const D=this.centroidData[M.centroidIdx].min.clone(),N=this.centroidData[M.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[d].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[d].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let G=E;G<I;G++){const Y=i[G],re=this.polygonSegments[Y.polygonSegmentIdx],J=this.centroidData[Y.centroidIdx].min,oe=this.centroidData[Y.centroidIdx].max,le=this.indexArray.uint16;for(let de=re.triangleArrayOffset;de<re.triangleArrayOffset+re.triangleCount;de++)a.emplaceBack(le[3*de],le[3*de+1],le[3*de+2]);V.primitiveLength+=re.triangleCount,D.x=Math.min(D.x,J.x),D.y=Math.min(D.y,J.y),N.x=Math.max(N.x,oe.x),N.y=Math.max(N.y,oe.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:D,max:N}),E=I;for(let G=E;G<y&&i[G].subtile===i[E].subtile;G++)I++}p=y;for(let M=p;M<_&&i[M].triangleSegmentIdx===i[p].triangleSegmentIdx;M++)y++}a._trim(),this.indexArray=a}getVisibleSegments(i,a,d){const p=new di;if(this.wallMode){for(const Y of this.triangleSubSegments)p.segments.push(Y.segment);return p}let y=0,_=0;const b=1<<i.canonical.z;if(a){const Y=a.getMinMaxForTile(i);Y&&(y=Y.min,_=Y.max)}_+=this.maxHeight;const E=i.toUnwrapped();let I;const M=[E.canonical.x/b+E.wrap,E.canonical.y/b],D=[(E.canonical.x+1)/b+E.wrap,(E.canonical.y+1)/b],N=(Y,re,J)=>[Y[0]*(1-J[0])+re[0]*J[0],Y[1]*(1-J[1])+re[1]*J[1]],V=[],G=[];for(const Y of this.triangleSubSegments){V[0]=Y.min.x/Mt,V[1]=Y.min.y/Mt,G[0]=Y.max.x/Mt,G[1]=Y.max.y/Mt;const re=N(M,D,V),J=N(M,D,G);if(new vn([re[0],re[1],y],[J[0],J[1],_]).intersectsPrecise(d)===0){I&&(p.segments.push(I),I=void 0);continue}const oe=Y.segment;I&&I.vertexOffset!==oe.vertexOffset&&(p.segments.push(I),I=void 0),I?(I.vertexLength+=oe.vertexLength,I.primitiveLength+=oe.primitiveLength):I={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return I&&p.segments.push(I),p}encodeCentroid(i,a){const d=i.centroid(),p=a.span(),y=Math.min(7,Math.round(p.x*this.tileToMeter/10)),_=Math.min(7,Math.round(p.y*this.tileToMeter/10));return new wt(we(d.x,1,8191)<<3|y,we(d.y,1,8191)<<3|_)}encodeBorderCentroid(i){if(!i.borders)return new wt(0,0);const a=i.borders,d=Number.MAX_VALUE;if(a[0][0]!==d||a[1][0]!==d){const p=a[0][0]!==d?0:1;return new wt(6|(a[0][0]!==d?0:65528),(a[p][0]+a[p][1])/2<<3|6)}{const p=a[2][0]!==d?2:3;return new wt((a[p][0]+a[p][1])/2<<3|6,6|(a[2][0]!==d?0:65528))}}showCentroid(i){const a=this.centroidData[i.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(i){this.groundEffect.updateHiddenByLandmark(i);const a=i.vertexArrayOffset,d=i.vertexCount+i.vertexArrayOffset,p=i.flags&gh?H$:i.centroidXY,y=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==p.y||y!==p.x){for(let _=a;_<d;++_)this.centroidVertexArray.emplace(_,p.x,p.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const i of this.centroidData)this.writeCentroidToBuffer(i)}updateReplacement(i,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const p=a.getReplacementRegionsForTile(i.toUnwrapped());if(ZA(this.activeReplacements,p))return;if(this.activeReplacements=p,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const b=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));if(_.footprint.buildingIds)for(const E of this.centroidData)E.flags&gh||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y||_.footprint.buildingIds.has(E.buildingId)&&(E.flags|=gh);else for(const E of this.centroidData)if(!(E.flags&gh||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y))for(let I=0;I<E.footprintSegLen;I++){const M=this.footprintSegments[E.footprintSegIdx+I];if(y.length=0,Uue(this.footprintVertices,M.vertexOffset,M.vertexCount,_.footprintTileId.canonical,i.canonical,y),nM(_.footprint,y,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){E.flags|=gh;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(i,a,d){let p=!1;for(let y=0;y<d.footprintSegLen;y++){const _=this.footprintSegments[d.footprintSegIdx+y];let b=0;for(const E of _.ringIndices){for(let I=b,M=E+b-1;I<E+b;M=I++){const D=this.footprintVertices.int16[2*(I+_.vertexOffset)+0],N=this.footprintVertices.int16[2*(I+_.vertexOffset)+1],V=this.footprintVertices.int16[2*(M+_.vertexOffset)+1];N>a!=V>a&&i<(this.footprintVertices.int16[2*(M+_.vertexOffset)+0]-D)*(a-N)/(V-N)+D&&(p=!p)}b=E}}return p}getHeightAtTileCoord(i,a){let d=Number.NEGATIVE_INFINITY,p=!0;const y=4*(i+Mt)*Mt+(a+Mt);if(this.partLookup.hasOwnProperty(y)){const _=this.partLookup[y];return _?{height:_.height,hidden:!!(_.flags&gh)}:void 0}for(const _ of this.centroidData)i>_.max.x||_.min.x>i||a>_.max.y||_.min.y>a||_.height<=d||this.footprintContainsPoint(i,a,_)&&(d=_.height,this.partLookup[y]=_,p=!!(_.flags&gh));if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.partLookup[y]=void 0}}function Y$(c,i){const a=c.add(i)._unit();return c.x*a.x+c.y*a.y}function $ue(c,i,a,d){const p=i.sub(c)._perp()._unit(),y=a.sub(i)._perp()._unit();return J$(c,i,a,Y$(p,y),d)}function J$(c,i,a,d,p){const y=Math.sqrt(1-d*d);return Math.min(c.dist(i)/3,i.dist(a)/3,p*y/d)}function aM(c,i,a){return c.x<a[0].x&&i.x<a[0].x||c.x>a[1].x&&i.x>a[1].x||c.y<a[0].y&&i.y<a[0].y||c.y>a[1].y&&i.y>a[1].y}function Q$(c,i){return c.x<i[0].x||c.x>i[1].x||c.y<i[0].y||c.y>i[1].y}function Vue(c){return c.every(i=>i.x<=0)||c.every(i=>i.x>=Mt)||c.every(i=>i.y<=0)||c.every(i=>i.y>=Mt)}function eV(c,i,a){if(c.x<0||c.x>=Mt||i.x<0||i.x>=Mt||a.x<0||a.x>=Mt)return!1;const d=a.sub(i),p=d.perp(),y=c.sub(i);return(d.x*y.x+d.y*y.y)/Math.sqrt((d.x*d.x+d.y*d.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function tV(c,i,a){const d=i?2|c:-3&c;return a?1|d:-2&d}function rV(){const c=Math.PI/32,i=Math.tan(c),a=Pe;return a*Math.sqrt(1+2*i*i)-a}function nV(c,i,a){const d=1<<a.z,p=ht(a.x/d),y=ht((a.x+1)/d),_=vt(a.y/d),b=vt((a.y+1)/d);return function(E,I,M,D,N=0,V){const G=[];if(!E.length||!M||!D)return G;const Y=(ye,Te)=>{for(const Ae of ye)G.push({polygon:Ae,bounds:Te})},re=Math.ceil(Math.log2(M)),J=Math.ceil(Math.log2(D)),oe=re-J,le=[];for(let ye=0;ye<Math.abs(oe);ye++)le.push(oe>0?0:1);for(let ye=0;ye<Math.min(re,J);ye++)le.push(0),le.push(1);let de=E;if(de=qA(de,I[0].y-N,I[1].y+N,1),de=qA(de,I[0].x-N,I[1].x+N,0),!de.length)return G;const _e=[];for(le.length?_e.push({polygons:de,bounds:I,depth:0}):Y(de,I);_e.length;){const ye=_e.pop(),Te=ye.depth,Ae=le[Te],Se=ye.bounds[0],Oe=ye.bounds[1],Me=Ae===0?Se.x:Se.y,st=Ae===0?Oe.x:Oe.y,et=V?V(Ae,Me,st):.5*(Me+st),it=qA(ye.polygons,Me-N,et+N,Ae),mt=qA(ye.polygons,et-N,st+N,Ae);if(it.length){const ft=[Se,new wt(Ae===0?et:Oe.x,Ae===1?et:Oe.y)];le.length>Te+1?_e.push({polygons:it,bounds:ft,depth:Te+1}):Y(it,ft)}if(mt.length){const ft=[new wt(Ae===0?et:Se.x,Ae===1?et:Se.y),Oe];le.length>Te+1?_e.push({polygons:mt,bounds:ft,depth:Te+1}):Y(mt,ft)}}return G}(c,i,Math.ceil((y-p)/11.25),Math.ceil((_-b)/11.25),1,(E,I,M)=>{if(E===0)return .5*(I+M);{const D=vt((a.y+I/Mt)/d);return(Je(.5*(vt((a.y+M/Mt)/d)+D))*d-a.y)*Mt}})}function Uue(c,i,a,d,p,y){const _=Math.pow(2,d.z-p.z);for(let b=0;b<a;b++){let E=c.int16[2*(b+i)+0],I=c.int16[2*(b+i)+1];E=(E+p.x*Mt)*_-d.x*Mt,I=(I+p.y*Mt)*_-d.y*Mt,y.push(new wt(E,I))}}let iV,oV;Wt(KA,"FillExtrusionBucket",{omit:["layers","features"]}),Wt(Z$,"PartData"),Wt(W$,"FootprintSegment"),Wt(X$,"BorderCentroidData"),Wt(sM,"GroundEffect");class eg extends wt{constructor(i,a,d){super(i,a),this.z=d}}class sV extends eg{constructor(i,a,d,p){super(i,a,d),this.w=p}}function aV(c,i,a,d){const p=a==="x"?"y":"x",y=(d-c[a])/(i[a]-c[a]);c[p]=Math.round(c[p]+(i[p]-c[p])*y),c[a]=d,c.hasOwnProperty("z")&&(c.z=mr(c.z,i.z,y)),c.hasOwnProperty("w")&&(c.w=mr(c.w,i.w,y))}function lV(c,i,a,d){const p=a,y=d;for(const _ of["x","y"]){let b=c,E=i;b[_]>=E[_]&&(b=i,E=c),b[_]<p&&E[_]>p&&aV(b,E,_,p),b[_]<y&&E[_]>y&&aV(E,b,_,y)}}function YA(c,i,a,d,p,y){const _=[];for(let b=0;b<c.length;b++){const E=c[b];let I;const M=_.length;let D=0;for(let N=0;N<E.length-1;N++){let V=E[N],G=E[N+1],Y=0;const re=D;let J,oe;y&&(Y=Math.hypot(G.x-V.x,G.y-V.y),D+=Y,J=V,oe=G),V.x<i&&G.x<i||(V.x<i?V=new wt(i,V.y+(i-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x<i&&(G=new wt(i,V.y+(i-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y<a&&G.y<a||(V.y<a?V=new wt(V.x+(a-V.y)/(G.y-V.y)*(G.x-V.x),a)._round():G.y<a&&(G=new wt(V.x+(a-V.y)/(G.y-V.y)*(G.x-V.x),a)._round()),V.x>=d&&G.x>=d||(V.x>=d?V=new wt(d,V.y+(d-V.x)/(G.x-V.x)*(G.y-V.y))._round():G.x>=d&&(G=new wt(d,V.y+(d-V.x)/(G.x-V.x)*(G.y-V.y))._round()),V.y>=p&&G.y>=p||(V.y>=p?V=new wt(V.x+(p-V.y)/(G.y-V.y)*(G.x-V.x),p)._round():G.y>=p&&(G=new wt(V.x+(p-V.y)/(G.y-V.y)*(G.x-V.x),p)._round()),I&&V.equals(I[I.length-1])||(I=[V],_.push(I),y&&y.push({progress:{min:re+cV(J,oe,V)*Y,max:1},parentIndex:b,prevPoint:J,nextPoint:oe})),I.push(G),y&&(y[y.length-1].progress.max=re+cV(J,oe,G)*Y,y[y.length-1].nextPoint=oe)))))}if(y&&D>0)for(let N=M;N<_.length;N++)y[N].progress.min/=D,y[N].progress.max/=D}return _}function Gue(c,i,a,d,p){if(c.length<2)return void d.push(c);const y=[];for(;i.valid();){const[I,M]=i.get();for(let D=0;D<c.length-1;D++){const N=c[D],V=c[D+1],G=Ym(N,V,I,M);if(G){const[Y]=G,re=new wt(mr(N.x,V.x,Y),mr(N.y,V.y,Y));y.push({t:D+Y,distance:0,point:re})}}i.next()}if(y.length===0)return void d.push(c);y.sort((I,M)=>I.t-M.t);let _=0,b=0,E=[];for(d.push(E);_!==c.length;){if(b===y.length){for(;_!==c.length;)E.length!==0&&E[E.length-1].equals(c[_])||E.push(c[_]),_++;break}y[b].t<=_?(E.length!==0&&E[E.length-1].equals(y[b].point)||E.push(y[b].point),Math.trunc(y[b].t),b++):(E.length!==0&&E[E.length-1].equals(c[_])||E.push(c[_]),_++)}}function cV(c,i,a){return c.x!==i.x?(a.x-c.x)/(i.x-c.x):c.y!==i.y?(a.y-c.y)/(i.y-c.y):0}function mw(c,i){return c.x*i.x+c.y*i.y}function uV(c,i){if(c.length===1){let a=0;const d=i[a++];let p;for(;!p||d.equals(p);)if(p=i[a++],!p)return 1/0;for(;a<i.length;a++){const y=i[a],_=c[0],b=p.sub(d),E=y.sub(d),I=_.sub(d),M=mw(b,b),D=mw(b,E),N=mw(E,E),V=mw(I,b),G=mw(I,E),Y=M*N-D*D,re=(N*V-D*G)/Y,J=(M*G-D*V)/Y,oe=d.z*(1-re-J)+p.z*re+y.z*J;if(isFinite(oe))return oe}return 1/0}{let a=1/0;for(const d of i)a=Math.min(a,d.z);return a}}function dV(c,i,a){let d=1/0;Qn(a,i)&&(d=uV(a,i[0]));for(let p=0;p<i.length;p++){const y=i[p],_=c[p];for(let b=0;b<y.length-1;b++){const E=y[b],I=[E,y[b+1],_[b+1],_[b],E];mi(a,I)&&(d=Math.min(d,uV(a,I)))}}return d!==1/0&&d}function hV(c,i,a,d,p,y,_,b,E,I,M){return c.projection.name==="globe"?function(D,N,V,G,Y,re,J,oe,le,de,_e){const ye=[],Te=[],Ae=D.projection.upVectorScale(_e,D.center.lat,D.worldSize).metersToTile,Se=[0,0,0,1],Oe=[0,0,0,1],Me=(et,it,mt,ft)=>{et[0]=it,et[1]=mt,et[2]=ft,et[3]=1},st=rV();V>0&&(V+=st),G+=st;for(const et of N){const it=[],mt=[];for(const ft of et){const pt=ft.x+Y.x,Ke=ft.y+Y.y,yt=D.projection.projectTilePoint(pt,Ke,_e),ut=D.projection.upVector(_e,ft.x,ft.y);let _t=V,gt=G;if(J){const Vt=fV(pt,Ke,V,G,J,oe,le,de);_t+=Vt.base,gt+=Vt.top}V!==0?Me(Se,yt.x+ut[0]*Ae*_t,yt.y+ut[1]*Ae*_t,yt.z+ut[2]*Ae*_t):Me(Se,yt.x,yt.y,yt.z),Me(Oe,yt.x+ut[0]*Ae*gt,yt.y+ut[1]*Ae*gt,yt.z+ut[2]*Ae*gt),Ir(Se,Se,re),Ir(Oe,Oe,re),it.push(new eg(Se[0],Se[1],Se[2])),mt.push(new eg(Oe[0],Oe[1],Oe[2]))}ye.push(it),Te.push(mt)}return[ye,Te]}(c,i,a,d,p,y,_,b,E,I,M):_?function(D,N,V,G,Y,re,J,oe,le){const de=[],_e=[],ye=[0,0,0,1];for(const Te of D){const Ae=[],Se=[];for(const Oe of Te){const Me=Oe.x+G.x,st=Oe.y+G.y,et=fV(Me,st,N,V,re,J,oe,le);ye[0]=Me,ye[1]=st,ye[2]=et.base,ye[3]=1,er(ye,ye,Y),ye[3]=Math.max(ye[3],1e-5);const it=new eg(ye[0]/ye[3],ye[1]/ye[3],ye[2]/ye[3]);ye[0]=Me,ye[1]=st,ye[2]=et.top,ye[3]=1,er(ye,ye,Y),ye[3]=Math.max(ye[3],1e-5);const mt=new eg(ye[0]/ye[3],ye[1]/ye[3],ye[2]/ye[3]);Ae.push(it),Se.push(mt)}de.push(Ae),_e.push(Se)}return[de,_e]}(i,a,d,p,y,_,b,E,I):function(D,N,V,G,Y){const re=[],J=[],oe=Y[8]*N,le=Y[9]*N,de=Y[10]*N,_e=Y[11]*N,ye=Y[8]*V,Te=Y[9]*V,Ae=Y[10]*V,Se=Y[11]*V;for(const Oe of D){const Me=[],st=[];for(const et of Oe){const it=et.x+G.x,mt=et.y+G.y,ft=Y[0]*it+Y[4]*mt+Y[12],pt=Y[1]*it+Y[5]*mt+Y[13],Ke=Y[2]*it+Y[6]*mt+Y[14],yt=Y[3]*it+Y[7]*mt+Y[15],ut=ft+oe,_t=pt+le,gt=Ke+de,Vt=Math.max(yt+_e,1e-5),Ut=ft+ye,kt=pt+Te,Dt=Ke+Ae,lr=Math.max(yt+Se,1e-5);Me.push(new eg(ut/Vt,_t/Vt,gt/Vt)),st.push(new eg(Ut/lr,kt/lr,Dt/lr))}re.push(Me),J.push(st)}return[re,J]}(i,a,d,p,y)}function fV(c,i,a,d,p,y,_,b){const E=_*p.getElevationAt(c,i,!0,!0),I=y[0]!==0,M=I?y[1]===0?_*(y[0]/7-450):_*function(D,N,V){const G=Math.floor(N[0]/8),Y=Math.floor(N[1]/8),re=10*(N[0]-8*G),J=10*(N[1]-8*Y),oe=D.getElevationAt(G,Y,!0,!0),le=D.getMeterToDEM(V),de=Math.floor(.5*(re*le-1)),_e=Math.floor(.5*(J*le-1)),ye=D.tileCoordToPixel(G,Y),Te=2*de+1,Ae=2*_e+1,Se=function(mt,ft,pt,Ke,yt){return[mt.getElevationAtPixel(ft,pt,!0),mt.getElevationAtPixel(ft+yt,pt,!0),mt.getElevationAtPixel(ft,pt+yt,!0),mt.getElevationAtPixel(ft+Ke,pt+yt,!0)]}(D,ye.x-de,ye.y-_e,Te,Ae),Oe=Math.abs(Se[0]-Se[1]),Me=Math.abs(Se[2]-Se[3]),st=Math.abs(Se[0]-Se[2])+Math.abs(Se[1]-Se[3]),et=Math.min(.25,.5*le*(Oe+Me)/Te),it=Math.min(.25,.5*le*st/Ae);return oe+Math.max(et*re,it*J)}(p,y,b):E;return{base:E+(a===0?-1:a),top:I?Math.max(M+d,E+a+2):E+d}}class que{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Hue{constructor(){this.tasks={},this.taskQueue=[],qt(["process"],this),this.invoker=new que(this.process),this.nextId=0}add(i,a){const d=this.nextId++,p=function({type:y,isSymbolTile:_,zoom:b}){return b=b||0,y==="message"?0:y!=="maybePrepare"||_?y!=="parseTile"||_?y==="parseTile"&&_?300-b:y==="maybePrepare"&&_?400-b:500:200-b:100-b}(a);if(p===0){try{i()}finally{}return null}return this.tasks[d]={fn:i,metadata:a,priority:p,id:d},this.taskQueue.push(d),this.invoker.trigger(),{cancel:()=>{delete this.tasks[d]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(d=>!!this.tasks[d]),!this.taskQueue.length)return;const i=this.pick();if(i===null)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<a&&(a=y.priority,i=p)}if(i===null)return null;const d=this.taskQueue[i];return this.taskQueue.splice(i,1),d}remove(){this.invoker.remove()}}class pV{constructor(i,a,d){this.target=i,this.parent=a,this.mapId=d,this.callbacks={},this.cancelCallbacks={},qt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Hue}send(i,a,d,p,y=!1,_){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);d&&(d.metadata=_,this.callbacks[b]=d);const E=new Set;return this.target.postMessage({id:b,type:i,hasCallback:!!d,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:ql(a,E)},E),{cancel:()=>{d&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(i){const a=i.data;if(!a)return;const d=a.id;if(d&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const p=this.cancelCallbacks[d];delete this.cancelCallbacks[d],p&&p.cancel()}else if(a.mustQueue||Ri(self)){const p=this.callbacks[d],y=this.scheduler.add(()=>this.processTask(d,a),p&&p.metadata||{type:"message"});y&&(this.cancelCallbacks[d]=y)}else this.processTask(d,a)}processTask(i,a){if(delete this.cancelCallbacks[i],a.type==="<response>"){const d=this.callbacks[i];delete this.callbacks[i],d&&(a.error?d(fu(a.error)):d(null,fu(a.data)))}else{const d=new Set,p=a.hasCallback?(_,b)=>{this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:_?ql(_):null,data:ql(b,d)},d)}:()=>{},y=fu(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,y,p);else if(this.parent.getWorkerSource){const _=a.type.split("."),{source:b,scope:E}=y;this.parent.getWorkerSource(a.sourceMapId,_[0],b,E)[_[1]](y,p)}else p(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var gw={workerUrl:"",workerClass:null,workerParams:void 0};function Wue(c){return gw.workerClass!=null?new gw.workerClass:new self.Worker(gw.workerUrl,Object.assign({name:c},gw.workerParams))}const lM="mapboxgl_preloaded_worker_pool";class tg{constructor(i){this.active={},this.name=i}acquire(i,a=tg.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;){const d=Wue(`${this.name||""}WorkerPool: ${i}-${this.workers.length}`);this.workers.push(d)}return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[lM]}numActive(){return Object.keys(this.active).length}}tg.workerCount=2;class M_{constructor(i,a,d="Worker",p=tg.workerCount){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Tt();const y=this.workerPool.acquire(this.id,p);for(let _=0;_<y.length;_++){const b=new M_.Actor(y[_],a,this.id);b.name=`${d} ${_}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,a,d){ze(this.actors,(p,y)=>{p.send(i,a,y)},d=d||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}let yw,cM;function JA(){return yw||(yw=new tg),yw}M_.Actor=pV;const uM=4096;class Zue{constructor(i){this.module=i,this.memoryStack=this.module.malloc(uM),this.memoryStackNextFree=this.memoryStack}createIntArray(i){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=i.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>uM?-1:(new Int32Array(this.module.heap32.buffer,a,i.length).set(i),a)}createFloatArray(i){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=i.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>uM?-1:(new Float32Array(this.module.heapF32.buffer,a,i.length).set(i),a)}readStringBuffer(i){let a="";for(;this.module.heapU8[i]!==0;)a+=String.fromCharCode(this.module.heapU8[i]),++i;return a}setStyle(i){const a=i.normalScale;this.module.setStyle(a[0],a[1],a[2],i.tileToMeters)}setAOOptions(i,a){this.module.setAOOptions(i?1:0,a)}setMetricOptions(i,a){this.module.setMetricOptions(i?1:0,a)}setStructuralOptions(i){this.module.setStructuralOptions(i?1:0)}setFacadeOptions(i,a){this.module.setFacadeOptions(i,a?1:0)}setFauxFacadeOptions(i,a,d){this.module.setFauxFacadeOptions(i?1:0,a?1:0,d)}setFacadeClassifierOptions(i){this.module.setFacadeClassifierOptions(i)}generateMesh(i,a){this.memoryStackNextFree=this.memoryStack;for(const b of i){const E=this.createIntArray(b.ringIndices),I=this.createFloatArray(b.coordinates);if(E===-1||I===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,b.roofType,I,E,b.ringIndices.length-1)}for(const b of a){let E;E=b.entrances?JSON.parse(b.entrances):[];const I=this.createFloatArray(E),M=this.createFloatArray(b.coordinates);if(I===-1||M===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,I,E.length,M,b.coordinates.length)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const d=this.module.getMeshCount(),p=new Array(d);for(let b=0;b<d;b++){const E=this.module.getPositionsPtr(b),I=this.module.getPositionsLength(b),M=new Float32Array(this.module.heapF32.buffer,E,I),D=this.module.getNormalsPtr(b),N=this.module.getNormalsLength(b),V=new Float32Array(this.module.heapF32.buffer,D,N),G=this.module.getAOPtr(b),Y=this.module.getAOLength(b),re=new Float32Array(this.module.heapF32.buffer,G,Y),J=this.module.getUVPtr(b),oe=this.module.getUVLength(b),le=new Float32Array(this.module.heapF32.buffer,J,oe),de=this.module.getFauxFacadePtr(b),_e=this.module.getFauxFacadeLength(b),ye=new Uint8Array(this.module.heapU8.buffer,de,_e),Te=this.module.getIndicesPtr(b),Ae=this.module.getIndicesLength(b),Se=new Int16Array(this.module.heap16.buffer,Te,Ae),Oe=this.module.getBuildingPart(b);p[b]={positions:M,normals:V,ao:re,uv:le,isFauxFacade:ye,indices:Se,buildingPart:Oe}}const y=this.module.getRingCount(),_=[];for(let b=0;b<y;b++){const E=this.module.getRingPtr(b),I=this.module.getRingLength(b),M=new Float32Array(this.module.heapF32.buffer,E,I);_.push(M)}return{meshes:p,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let _w,dM,yu,D_,hM,L_=null,j_=null,mV=null,QA=null;function gV(){return Ri(self)&&self.worker.dracoUrl?self.worker.dracoUrl:dM||po.DRACO_URL}function yV(){if(Ri(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(D_)return D_;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return D_=WebAssembly.validate(c)?po.MESHOPT_SIMD_URL:po.MESHOPT_URL,D_}function Xue(){return QA}const _V=5120,vV=5121,xV=5122,bV=5123,wV=5125,SV=5126,e2={[_V]:Int8Array,[vV]:Uint8Array,[xV]:Int16Array,[bV]:Uint16Array,[wV]:Uint32Array,[SV]:Float32Array},Kue={[_V]:"DT_INT8",[vV]:"DT_UINT8",[xV]:"DT_INT16",[bV]:"DT_UINT16",[wV]:"DT_UINT32",[SV]:"DT_FLOAT32"},vw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function TV(c,i,a){const d=a.json.bufferViews.length,p=a.buffers.length;i.bufferView=d,a.json.bufferViews[d]={buffer:p,byteLength:c.byteLength},a.buffers[p]=c}const fM="KHR_draco_mesh_compression";function Yue(c,i){const a=c.extensions&&c.extensions[fM];if(!a)return;const d=new yu.Decoder,p=CV(i,a.bufferView),y=new yu.Mesh;if(!d.DecodeArrayToMesh(p,p.byteLength,y))throw new Error("Failed to decode Draco mesh");const _=i.json.accessors[c.indices],b=e2[_.componentType],E=_.count*b.BYTES_PER_ELEMENT,I=yu._malloc(E);b===Uint16Array?d.GetTrianglesUInt16Array(y,E,I):d.GetTrianglesUInt32Array(y,E,I),TV(yu.memory.buffer.slice(I,I+E),_,i),yu._free(I);for(const M of Object.keys(a.attributes)){const D=d.GetAttributeByUniqueId(y,a.attributes[M]),N=i.json.accessors[c.attributes[M]],V=Kue[N.componentType],G=N.count*vw[N.type]*e2[N.componentType].BYTES_PER_ELEMENT,Y=yu._malloc(G);d.GetAttributeDataArrayForAllPoints(y,D,yu[V],G,Y),TV(yu.memory.buffer.slice(Y,Y+G),N,i),yu._free(Y)}d.destroy(),y.destroy(),delete c.extensions[fM]}const t2="EXT_meshopt_compression";function Jue(c,i){if(!c.extensions||!c.extensions[t2])return;const a=c.extensions[t2],d=new Uint8Array(i.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),p=new Uint8Array(a.count*a.byteStride);hM.decodeGltfBuffer(p,a.count,a.byteStride,d,a.mode,a.filter),c.buffer=i.buffers.length,c.byteOffset=0,i.buffers[c.buffer]=p.buffer,delete c.extensions[t2]}const EV=1179937895,AV=new TextDecoder("utf8");function PV(c,i){return new URL(c,i).href}function Que(c,i,a,d){return fetch(PV(c.uri,d)).then(p=>p.arrayBuffer()).then(p=>{i.buffers[a]=p})}function CV(c,i){const a=c.json.bufferViews[i];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function ede(c,i,a,d){if(c.uri){const p=PV(c.uri,d);return fetch(p).then(y=>y.blob()).then(y=>createImageBitmap(y)).then(y=>{i.images[a]=y})}if(c.bufferView!==void 0){const p=CV(i,c.bufferView),y=new Blob([p],{type:c.mimeType});return createImageBitmap(y).then(_=>{i.images[a]=_})}}function IV(c,i=0,a){const d={json:null,images:[],buffers:[]};if(new Uint32Array(c,i,1)[0]===EV){const M=new Uint32Array(c,i);let D=2;const N=(M[D++]>>2)-3,V=M[D++]>>2;if(D++,d.json=JSON.parse(AV.decode(M.subarray(D,D+V))),D+=V,D<N){const G=M[D++];D++;const Y=i+(D<<2);d.buffers[0]=c.slice(Y,Y+G)}}else d.json=JSON.parse(AV.decode(new Uint8Array(c,i)));const{buffers:p,images:y,meshes:_,extensionsUsed:b,bufferViews:E}=d.json;let I=Promise.resolve();if(p){const M=[];for(let D=0;D<p.length;D++){const N=p[D];N.uri?M.push(Que(N,d,D,a)):d.buffers[D]||(d.buffers[D]=null)}I=Promise.all(M)}return I.then(()=>{const M=[],D=b&&b.includes(fM),N=b&&b.includes(t2);if(D&&M.push(function(){if(!yu)return _w??(_w=function(V){let G,Y=null;function re(){G=new Uint8Array(Y.buffer)}function J(){throw new Error("Unexpected Draco error.")}const oe={a:{a:J,d:function(le,de,_e){return G.copyWithin(le,de,de+_e)},c:function(le){const de=G.length,_e=Math.max(le>>>0,Math.ceil(1.2*de)),ye=Math.ceil((_e-de)/65536);try{return Y.grow(ye),re(),!0}catch{return!1}},b:J}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,oe):V.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,oe))).then(le=>{const{Rb:de,Qb:_e,P:ye,T:Te,X:Ae,Ja:Se,La:Oe,Qa:Me,Va:st,Wa:et,eb:it,jb:mt,f:ft,e:pt,yb:Ke,zb:yt,Ab:ut,Bb:_t,Db:gt,Gb:Vt}=le.instance.exports;Y=pt;const Ut=(()=>{let kt=0,Dt=0,lr=0,Jt=0;return Ft=>{lr&&(de(Jt),de(kt),Dt+=lr,lr=kt=0),kt||(Dt+=128,kt=_e(Dt));const br=Ft.length+7&-8;let Gr=kt;br>=Dt&&(lr=br,Gr=Jt=_e(br));for(let mn=0;mn<Ft.length;mn++)G[Gr+mn]=Ft[mn];return Gr}})();return re(),ft(),{memory:pt,_free:de,_malloc:_e,Mesh:class{constructor(){this.ptr=ye()}destroy(){Te(this.ptr)}},Decoder:class{constructor(){this.ptr=Se()}destroy(){mt(this.ptr)}DecodeArrayToMesh(kt,Dt,lr){const Jt=Ut(kt),Ft=Oe(this.ptr,Jt,Dt,lr.ptr);return!!Ae(Ft)}GetAttributeByUniqueId(kt,Dt){return{ptr:Me(this.ptr,kt.ptr,Dt)}}GetTrianglesUInt16Array(kt,Dt,lr){st(this.ptr,kt.ptr,Dt,lr)}GetTrianglesUInt32Array(kt,Dt,lr){et(this.ptr,kt.ptr,Dt,lr)}GetAttributeDataArrayForAllPoints(kt,Dt,lr,Jt,Ft){it(this.ptr,kt.ptr,Dt.ptr,lr,Jt,Ft)}},DT_INT8:Ke(),DT_UINT8:yt(),DT_INT16:ut(),DT_UINT16:_t(),DT_UINT32:gt(),DT_FLOAT32:Vt()}})}(fetch(gV())),_w.then(V=>{yu=V,_w=void 0}))}()),N&&M.push(function(){if(hM)return;const V=function(G){let Y;const re=WebAssembly.instantiateStreaming(G,{}).then(le=>{Y=le.instance,Y.exports.__wasm_call_ctors()}),J={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:re,supported:!0,decodeGltfBuffer(le,de,_e,ye,Te,Ae){(function(Se,Oe,Me,st,et,it,mt){const ft=Se.exports.sbrk,pt=st+3&-4,Ke=ft(pt*et),yt=ft(it.length),ut=new Uint8Array(Se.exports.memory.buffer);ut.set(it,yt);const _t=Oe(Ke,st,et,yt,it.length);if(_t===0&&mt&&mt(Ke,pt,et),Me.set(ut.subarray(Ke,Ke+st*et)),ft(Ke-ft(0)),_t!==0)throw new Error(`Malformed buffer data: ${_t}`)})(Y,Y.exports[oe[Te]],le,de,_e,ye,Y.exports[J[Ae]])}}}(fetch(yV()));return V.ready.then(()=>{hM=V})}()),y)for(let V=0;V<y.length;V++)M.push(ede(y[V],d,V,a));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(D&&_)for(const{primitives:V}of _)for(const G of V)Yue(G,d);if(N&&_&&E)for(const V of E)Jue(V,d);return d})})}function OV(c){return fetch(c).then(i=>i.arrayBuffer()).then(i=>IV(i,0,c))}function pM(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function mM(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class gM{constructor(i,a,d,p){this.context=i,this.format=d,this.useMipmap=p&&p.useMipmap,this.texture=i.gl.createTexture(),this.update(a,{premultiply:p&&p.premultiply})}update(i,a){const d=i&&i instanceof HTMLVideoElement&&i.width===0?i.videoWidth:i.width,p=i&&i instanceof HTMLVideoElement&&i.height===0?i.videoHeight:i.height,{context:y}=this,{gl:_}=y,{x:b,y:E}=a&&a.position?a.position:{x:0,y:0},I=b+d,M=E+p;!this.size||this.size[0]===I&&this.size[1]===M||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!a||a.premultiply!==!1));const D=i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||ImageBitmap&&i instanceof ImageBitmap;if(!this.size&&I>0&&M>0){const N=this.useMipmap?Math.floor(Math.log2(Math.max(I,M)))+1:1;_.texStorage2D(_.TEXTURE_2D,N,this.format,I,M),this.size=[I,M]}this.size&&(D?_.texSubImage2D(_.TEXTURE_2D,0,b,E,pM(this.format),mM(this.format),i):"data"in i&&i.data&&_.texSubImage2D(_.TEXTURE_2D,0,b,E,d,p,pM(this.format),mM(this.format),i.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(i,a,d=!1){const{context:p}=this,{gl:y}=p;y.bindTexture(y.TEXTURE_2D,this.texture),i!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,i),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap&&!d?i===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),a!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,a),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(i,a,d,p,y){const{context:_}=this,{gl:b}=_;b.bindTexture(b.TEXTURE_2D,this.texture),a!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),this.magFilter=a),i!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?i===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:i),this.minFilter=i),d!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d),this.wrapS=d),p!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,p),this.wrapT=p),y!==this.compareMode&&(y?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,y)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=y)}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class xw{constructor(i,a){this.context=i,this.texture=a}bind(i,a){const{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,i),this.minFilter=i),a!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrapS=a)}}const tde=Zr([{name:"a_pos_3f",components:3,type:"Float32"}]),rde=Zr([{name:"a_color_3f",components:3,type:"Float32"}]),nde=Zr([{name:"a_color_4f",components:4,type:"Float32"}]),ide=Zr([{name:"a_uv_2f",components:2,type:"Float32"}]),ode=Zr([{name:"a_normal_3f",components:3,type:"Float32"}]),sde=Zr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),ade=Zr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function kV(c,i){const a=r2(c.projection,c.zoom,c.width,c.height),d=function(y,_,b,E,I){const M=new ve(b.lng-180*Wf,b.lat),D=new ve(b.lng+180*Wf,b.lat),N=y.project(M.lng,M.lat),V=y.project(D.lng,D.lat),G=-Math.atan2(V.y-N.y,V.x-N.x),Y=Lt.fromLngLat(b);Y.y=we(Y.y,-1+Wf,1-Wf);const re=Y.toLngLat(),J=y.project(re.lng,re.lat),oe=Lt.fromLngLat(re);oe.x+=Wf;const le=oe.toLngLat(),de=y.project(le.lng,le.lat),_e=MV(de.x-J.x,de.y-J.y,G),ye=Lt.fromLngLat(re);ye.y+=Wf;const Te=ye.toLngLat(),Ae=y.project(Te.lng,Te.lat),Se=MV(Ae.x-J.x,Ae.y-J.y,G),Oe=Math.abs(_e.x)/Math.abs(Se.y),Me=B([]);ue(Me,Me,-G*(1-(I?0:E)));const st=B([]);return te(st,st,[1,1-(1-Oe)*E,1]),st[4]=-Se.x/Se.y*E,ue(st,st,G),q(st,Me,st),st}(c.projection,0,c.center,a,i),p=RV(c);return te(d,d,[p,p,1]),d}function RV(c){const i=c.projection,a=r2(c.projection,c.zoom,c.width,c.height),d=yM(i,c.center),p=yM(i,ve.convert(i.center));return Math.pow(2,d*a+(1-a)*p)}function r2(c,i,a,d,p=1/0){const y=c.range;if(!y)return 0;const _=Math.min(p,Math.max(a,d)),b=Math.log2(_/1024);return je(y[0]+b,y[1]+b,i)}const Wf=1/4e4;function yM(c,i){const a=we(i.lat,-85.051129,Re),d=new ve(i.lng-180*Wf,a),p=new ve(i.lng+180*Wf,a),y=c.project(d.lng,a),_=c.project(p.lng,a),b=Lt.fromLngLat(d),E=Lt.fromLngLat(p),I=_.x-y.x,M=_.y-y.y,D=E.x-b.x,N=E.y-b.y,V=Math.sqrt((D*D+N*N)/(I*I+M*M));return Math.log2(V)}function MV(c,i,a){const d=Math.cos(a),p=Math.sin(a);return{x:c*d-i*p,y:c*p+i*d}}function DV(c,i,a){B(c),ue(c,c,an(i[2])),Q(c,c,an(i[0])),ae(c,c,an(i[1])),te(c,c,a),q(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function n2(c,i,a,d,p,y,_,b){const E=[a[0]-i[0],a[1]-i[1],0],I=[d[0]-i[0],d[1]-i[1],0];if(dt(E)<1e-12||dt(I)<1e-12)return Tn(c);const M=ir([],E,I);Rt(M,M),He(I,d,i),E[2]=(y-p)*b,I[2]=(_-p)*b;const D=E;return ir(D,E,I),Rt(D,D),Wo(c,M,D)}function i2(c,i,a=!1){const d=Uf(i.zoom),p=function(y,_,b){const E=_.worldSize,I=[y[12],y[13],y[14]],M=vt(I[1]/E),D=ht(I[0]/E),N=B([]),V=Xe(1,M)*E,G=Xe(1,0)*E*Qe(M,_.zoom),Y=1/FR(E);let re=G*Y;if(b){const de=r2(_.projection,_.zoom,_.width,_.height,1024);re=Y*_.projection.pixelSpaceConversion(_.center.lat,E,de)}const J=Ee(M,D);qe(J,J,$t([],Rt([],J),V*re*I[2]));const oe=function(de){const _e=[de[0],de[1],de[2]];let ye=[0,1,0];const Te=ir([],ye,_e);return ir(ye,_e,Te),rr(ye)===0&&(ye=[0,1,0],ir(Te,_e,ye)),Rt(Te,Te),Rt(ye,ye),Rt(_e,_e),[Te[0],Te[1],Te[2],0,ye[0],ye[1],ye[2],0,_e[0],_e[1],_e[2],0,de[0],de[1],de[2],1]}(J);te(N,N,[re,re,re*V]),H(N,N,[-I[0],-I[1],-I[2]]);const le=q([],_.globeMatrix,oe);return q(le,le,N),q(le,le,y),le}(c,i,a);if(d>0){const y=function(_,b){const E=b.worldSize,I=Xe(1,0)*E*Qe(b.center.lat,b.zoom)/FR(E),M=Xe(1,b.center.lat)*E,D=B([]);ae(D,D,an(b.center.lng)),Q(D,D,an(b.center.lat)),H(D,D,[0,0,ie]),te(D,D,[I,I,I*M]);const N=b.point;return H(D,D,[-N.x,-N.y,0]),q(D,D,_),q(D,b.globeMatrix,D)}(c,i);return function(_,b,E){const I=(G,Y,re)=>{const J=dt(G),oe=dt(Y),le=ph(G,Y,re);return $t(le,le,1/dt(le)*mr(J,oe,re))},M=I([_[0],_[1],_[2]],[b[0],b[1],b[2]],E),D=I([_[4],_[5],_[6]],[b[4],b[5],b[6]],E),N=I([_[8],_[9],_[10]],[b[8],b[9],b[10]],E),V=ph([_[12],_[13],_[14]],[b[12],b[13],b[14]],E);return[M[0],M[1],M[2],0,D[0],D[1],D[2],0,N[0],N[1],N[2],0,V[0],V[1],V[2],1]}(p,y,d)}return p}function _M(c,i,a,d){const p=vn.projectAabbCorners(d,a);let y=Number.MAX_VALUE;for(let b=0;b<p.length;++b){const E=p[b];E[0]=(.5*E[0]+.5)*i.width,E[1]=(.5-.5*E[1])*i.height,E[2]<y&&(y=E[2])}const _=function(b){const E=[];let I=0;for(let V=1;V<b.length;V++)(b[V][0]<b[I][0]||b[V][0]===b[I][0]&&b[V][1]<b[I][1])&&(I=V);let M,D=I;const N=new Uint8Array(b.length);do{if(N[D])break;E.push(new wt(b[D][0],b[D][1])),N[D]=1,M=(D+1)%b.length;for(let V=0;V<b.length;V++){if(b[V][0]===b[M][0]&&b[V][1]===b[M][1]||b[V][0]===b[D][0]&&b[V][1]===b[D][1])continue;const G=[b[V][0]-b[D][0],b[V][1]-b[D][1]],Y=[b[M][0]-b[D][0],b[M][1]-b[D][1]],re=G[0]*Y[1]-G[1]*Y[0];(re>0||re===0&&G[0]*Y[0]+G[1]*Y[1]>=0&&G[0]*G[0]+G[1]*G[1]>Y[0]*Y[0]+Y[1]*Y[1])&&(M=V)}D=M}while(D!==I);return E.length>0&&E.push(E[0]),E}(p);if(mi(c,_))return y}const rg=64,N_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function o2(c,i,a,d,p,y,_,b,E,I=!1){const M=a.zoom,D=a.project(d),N=Qe(d.lat,M),V=1/N;B(c),H(c,c,[D.x+_[0]*V,D.y+_[1]*V,_[2]]);let G=1,Y=1;const re=a.worldSize;if(I){if(a.projection.name==="mercator"){let de=0;a.elevation&&(de=a.elevation.getAtPointOrZero(new Lt(D.x/re,D.y/re),0));const _e=er([],[D.x,D.y,de,1],a.projMatrix)[3]/a.cameraToCenterDistance;G=_e,Y=_e*Qe(a.center.lat,M)}else if(a.projection.name==="globe"){const de=i2(c,a),_e=[0,0,0,1];er(_e,_e,q([],a.projMatrix,de));const ye=_e[3]/a.cameraToCenterDistance,Te=Uf(M),Ae=a.projection.pixelsPerMeter(d.lat,re)*Qe(d.lat,M),Se=a.projection.pixelsPerMeter(a.center.lat,re)*Qe(a.center.lat,M);G=ye/mr(Ae,lt(a.center.lat),Te),Y=ye*N/Ae,G*=Se,Y*=Se}}else G=V;te(c,c,[G,G,Y]);const J=[...c],oe=i.orientation,le=[];if(DV(le,[oe[0]+(p?p[0]:0),oe[1]+(p?p[1]:0),oe[2]+(p?p[2]:0)],y),q(c,J,le),b&&a.elevation){let de=0;const _e=[];if(E&&a.elevation){de=function(Te,Ae,Se,Oe,Me){const st=Ae.elevation;if(!st)return 0;const et=vn.projectAabbCorners(Se,Oe),it=Xe(1,Me.lat)*Ae.worldSize,mt=function(Dt,lr){const Jt=[0,0,1],Ft=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const br of Ft){const Gr=Dt[br.corners[0]],mn=Dt[br.corners[1]],$r=Dt[br.corners[2]],Ln=[mn[0]-Gr[0],mn[1]-Gr[1],lr*(mn[2]-Gr[2])],sn=ir(Ln,Ln,[$r[0]-Gr[0],$r[1]-Gr[1],lr*($r[2]-Gr[2])]);Rt(sn,sn),br.dotProductWithUp=Yt(sn,Jt)}return Ft.sort((br,Gr)=>br.dotProductWithUp-Gr.dotProductWithUp),Ft[0].corners}(et,it),ft=et[mt[0]],pt=et[mt[1]],Ke=et[mt[2]],yt=et[mt[3]],ut=st.getAtPointOrZero(new Lt(ft[0]/Ae.worldSize,ft[1]/Ae.worldSize),0),_t=st.getAtPointOrZero(new Lt(pt[0]/Ae.worldSize,pt[1]/Ae.worldSize),0),gt=st.getAtPointOrZero(new Lt(Ke[0]/Ae.worldSize,Ke[1]/Ae.worldSize),0),Vt=st.getAtPointOrZero(new Lt(yt[0]/Ae.worldSize,yt[1]/Ae.worldSize),0),Ut=(ut+Vt)/2,kt=(_t+gt)/2;return Ut>kt?_t<gt?n2(Te,pt,yt,ft,_t,Vt,ut,it):n2(Te,Ke,ft,yt,gt,ut,Vt,it):ut<Vt?n2(Te,ft,pt,Ke,ut,_t,gt,it):n2(Te,yt,Ke,pt,Vt,gt,_t,it),Math.max(Ut,kt)}(_e,a,i.aabb,c,d);const ye=q([],Ge([],_e),le);q(c,J,ye)}else de=a.elevation.getAtPointOrZero(new Lt(D.x/re,D.y/re),0);de!==0&&(c[14]+=de)}}class LV{constructor(i,a,d,p,y){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=i,this.uri=a,this.position=d!=null?new ve(d[0],d[1]):new ve(0,0),this.orientation=p??[0,0,0],this.nodes=y,this.uploaded=!1,this.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(i,a){q(i.globalMatrix,a,i.localMatrix);const d=this.nodeOverrides.get(i.name);if(d!==void 0){const _=[];y=d.orientation,B(p=_),ae(p,p,an(y[1])),ue(p,p,an(y[2])),Q(p,p,an(y[0])),q(i.globalMatrix,i.globalMatrix,_)}var p,y;if(i.meshes)for(const _ of i.meshes){const b=vn.applyTransformFast(_.aabb,i.globalMatrix);this.aabb.encapsulate(b)}if(i.children)for(const _ of i.children)this._applyTransformations(_,i.globalMatrix)}computeBoundsAndApplyParent(){const i=B([]);this.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,i)}computeModelMatrix(i,a,d,p,y,_,b=!1){o2(this.matrix,this,i.transform,this.position,a,d,p,y,_,b)}upload(i){if(!this.uploaded){for(const a of this.nodes)vM(a,i);for(const a of this.nodes)s2(a);this.uploaded=!0}}destroy(){for(const i of this.nodes)xM(i)}}function bw(c,i,a=!1){c.uploaded||(c.gfxTexture=new gM(i,c.image,a?i.gl.R8:i.gl.RGBA8,{useMipmap:c.sampler.minFilter>=i.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function lde(c,i,a){c.indexBuffer=i.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=i.createVertexBuffer(c.vertexArray,tde.members,!1,!0),c.normalArray&&(c.normalBuffer=i.createVertexBuffer(c.normalArray,ode.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=i.createVertexBuffer(c.texcoordArray,ide.members,!1,!0)),c.colorArray&&(c.colorBuffer=i.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?rde:nde).members,!1,!0)),c.featureArray&&(c.pbrBuffer=i.createVertexBuffer(c.featureArray,ade.members,!0)),c.segments=di.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const d=c.material;d.pbrMetallicRoughness.baseColorTexture&&bw(d.pbrMetallicRoughness.baseColorTexture,i),d.pbrMetallicRoughness.metallicRoughnessTexture&&bw(d.pbrMetallicRoughness.metallicRoughnessTexture,i),d.normalTexture&&bw(d.normalTexture,i),d.occlusionTexture&&bw(d.occlusionTexture,i,a),d.emissionTexture&&bw(d.emissionTexture,i)}function vM(c,i,a){if(c.meshes)for(const d of c.meshes)lde(d,i,a);if(c.children)for(const d of c.children)vM(d,i,a)}function s2(c){if(c.meshes)for(const i of c.meshes)i.indexArray.destroy(),i.vertexArray.destroy(),i.colorArray&&i.colorArray.destroy(),i.normalArray&&i.normalArray.destroy(),i.texcoordArray&&i.texcoordArray.destroy(),i.featureArray&&i.featureArray.destroy();if(c.children)for(const i of c.children)s2(i)}function cde(c){c.pbrMetallicRoughness.baseColorTexture&&c.pbrMetallicRoughness.baseColorTexture.gfxTexture&&c.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),c.pbrMetallicRoughness.metallicRoughnessTexture&&c.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&c.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),c.normalTexture&&c.normalTexture.gfxTexture&&c.normalTexture.gfxTexture.destroy(),c.emissionTexture&&c.emissionTexture.gfxTexture&&c.emissionTexture.gfxTexture.destroy(),c.occlusionTexture&&c.occlusionTexture.gfxTexture&&c.occlusionTexture.gfxTexture.destroy()}function xM(c){if(c.meshes)for(const i of c.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&cde(i.material));if(c.children)for(const i of c.children)xM(i)}function ng(c,i){const a=c.json.bufferViews[i.bufferView],d=e2[i.componentType];return new d(c.buffers[a.buffer],(i.byteOffset||0)+(a.byteOffset||0),i.count*(a.byteStride&&a.byteStride!==vw[i.type]*d.BYTES_PER_ELEMENT?a.byteStride/d.BYTES_PER_ELEMENT:vw[i.type]))}function bM(c,i,a,d){const p=e2[i.componentType],y=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(p),_=c.json.bufferViews[i.bufferView],b=_.byteStride?_.byteStride/p.BYTES_PER_ELEMENT:vw[i.type],E=a.float32,I=E.length/a.capacity;for(let M=0,D=0;M<i.count*b;M+=b,D+=I)for(let N=0;N<I;N++)E[D+N]=d[M+N]*y;a._trim()}function ude(c,i,a){const d=c.indices,p=c.attributes,y={};y.indexArray=new go;const _=i.json.accessors[d],b=_.count/3;y.indexArray.reserve(b);const E=ng(i,_);for(let N=0;N<b;N++)y.indexArray.emplaceBack(E[3*N],E[3*N+1],E[3*N+2]);y.indexArray._trim(),y.vertexArray=new Il;const I=i.json.accessors[p.POSITION];y.vertexArray.reserve(I.count);const M=ng(i,I);for(let N=0;N<I.count;N++)y.vertexArray.emplaceBack(M[3*N],M[3*N+1],M[3*N+2]);if(y.vertexArray._trim(),y.aabb=new vn(I.min,I.max),y.centroid=function(N,V){const G=[0,0,0],Y=N.length;if(Y>0){for(let re=0;re<Y;re++){const J=3*N[re];G[0]+=V[J],G[1]+=V[J+1],G[2]+=V[J+2]}G[0]/=Y,G[1]/=Y,G[2]/=Y}return G}(E,M),p.COLOR_0!==void 0){const N=i.json.accessors[p.COLOR_0],V=vw[N.type],G=ng(i,N);y.colorArray=V===3?new Il:new md,y.colorArray.resize(N.count),bM(i,N,y.colorArray,G)}if(p.NORMAL!==void 0){y.normalArray=new Il;const N=i.json.accessors[p.NORMAL];y.normalArray.resize(N.count);const V=ng(i,N);bM(i,N,y.normalArray,V)}if(p.TEXCOORD_0!==void 0&&a.length>0){y.texcoordArray=new hh;const N=i.json.accessors[p.TEXCOORD_0];y.texcoordArray.resize(N.count);const V=ng(i,N);bM(i,N,y.texcoordArray,V)}if(p._FEATURE_ID_RGBA4444!==void 0){const N=i.json.accessors[p._FEATURE_ID_RGBA4444];i.json.extensionsUsed&&i.json.extensionsUsed.includes("EXT_meshopt_compression")&&(y.featureData=ng(i,N))}p._FEATURE_RGBA4444!==void 0&&(y.featureData=new Uint32Array(ng(i,i.json.accessors[p._FEATURE_RGBA4444]).buffer));const D=c.material;return y.material=function(N,V){const{emissiveFactor:G=[0,0,0],alphaMode:Y="OPAQUE",alphaCutoff:re=.5,normalTexture:J,occlusionTexture:oe,emissiveTexture:le,doubleSided:de,name:_e}=N,{baseColorFactor:ye=[1,1,1,1],metallicFactor:Te=1,roughnessFactor:Ae=1,baseColorTexture:Se,metallicRoughnessTexture:Oe}=N.pbrMetallicRoughness||{},Me=oe?V[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&Me){const st=oe.extensions.KHR_texture_transform;Me.offsetScale=[st.offset[0],st.offset[1],st.scale[0],st.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new En(...ye),metallicFactor:Te,roughnessFactor:Ae,baseColorTexture:Se?V[Se.index]:void 0,metallicRoughnessTexture:Oe?V[Oe.index]:void 0},doubleSided:de,emissiveFactor:new En(...G),alphaMode:Y,alphaCutoff:re,normalTexture:J?V[J.index]:void 0,occlusionTexture:Me,emissionTexture:le?V[le.index]:void 0,defined:N.defined===void 0}}(D!==void 0?i.json.materials[D]:{defined:!1},a),y}function jV(c,i,a){const{matrix:d,rotation:p,translation:y,scale:_,mesh:b,extras:E,children:I,name:M}=c,D={};if(D.name=M,D.localMatrix=d||function(N,V,G,Y){var re=V[0],J=V[1],oe=V[2],le=V[3],de=re+re,_e=J+J,ye=oe+oe,Te=re*de,Ae=re*_e,Se=re*ye,Oe=J*_e,Me=J*ye,st=oe*ye,et=le*de,it=le*_e,mt=le*ye,ft=Y[0],pt=Y[1],Ke=Y[2];return N[0]=(1-(Oe+st))*ft,N[1]=(Ae+mt)*ft,N[2]=(Se-it)*ft,N[3]=0,N[4]=(Ae-mt)*pt,N[5]=(1-(Te+st))*pt,N[6]=(Me+et)*pt,N[7]=0,N[8]=(Se+it)*Ke,N[9]=(Me-et)*Ke,N[10]=(1-(Te+Oe))*Ke,N[11]=0,N[12]=G[0],N[13]=G[1],N[14]=G[2],N[15]=1,N}([],p||[0,0,0,1],y||[0,0,0],_||[1,1,1]),D.globalMatrix=j(D.localMatrix),b!==void 0){D.meshes=a[b];const N=D.anchor=[0,0];for(const V of D.meshes){const{min:G,max:Y}=V.aabb;N[0]+=G[0]+Y[0],N[1]+=G[1]+Y[1]}N[0]=Math.floor(N[0]/D.meshes.length/2),N[1]=Math.floor(N[1]/D.meshes.length/2)}if(E&&(E.id&&(D.id=E.id),E.lights&&(D.lights=function(N){if(!N.length)return[];const V=function(oe){const le=atob(oe),de=new Uint8Array(le.length);for(let _e=0;_e<le.length;_e++)de[_e]=le.codePointAt(_e);return de}(N),G=[],Y=V.length/24,re=new Uint16Array(V.buffer),J=new Float32Array(V.buffer);for(let oe=0;oe<Y;oe++){const le=re[2*oe*6]/30,de=re[2*oe*6+1]/30,_e=re[2*oe*6+10]/100,ye=J[6*oe+1],Te=J[6*oe+2],Ae=J[6*oe+3],Se=J[6*oe+4],Oe=Ae-ye,Me=Se-Te,st=Math.hypot(Oe,Me);G.push({pos:[ye+.5*Oe,Te+.5*Me,de],normal:[Me/st,-Oe/st,0],width:st,height:le,depth:_e,points:[ye,Te,Ae,Se]})}return G}(E.lights)),E.MAPBOX_geometry_bloom&&(D.isGeometryBloom=E.MAPBOX_geometry_bloom)),I){const N=[];for(const V of I)N.push(jV(i.json.nodes[V],i,a));D.children=N}return D}function dde(c){if(c.vertices.length===0||c.indices.length===0)return null;const i=new HA(c.vertices,c.indices,8,256),[a,d]=[i.min.clone(),i.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:i,min:a,max:d}}function hde(c){if(!c.extras||!c.extras.ground)return null;const i=c.extras.ground;if(!i||!Array.isArray(i)||i.length===0)return null;const a=i[0];if(!a||!Array.isArray(a)||a.length===0)return null;const d=[];for(const _ of a){if(!Array.isArray(_)||_.length!==2)continue;const b=_[0],E=_[1];typeof b=="number"&&typeof E=="number"&&d.push(new wt(b,E))}if(d.length<3)return null;d.length>1&&d[d.length-1].equals(d[0])&&d.pop();let p=0;for(let _=0;_<d.length;_++){const b=d[_],E=d[(_+1)%d.length],I=d[(_+2)%d.length];p+=(b.x-E.x)*(I.y-E.y)-(I.x-E.x)*(b.y-E.y)}p>0&&d.reverse();const y=I_(d.flatMap(_=>[_.x,_.y]),[]);return y.length===0?null:{vertices:d,indices:y}}function fde(c,i){const a=[],d=[];let p=0;const y=[];for(const _ of c){p=a.length;const b=_.vertexArray.float32,E=_.indexArray.uint16;for(let I=0;I<_.vertexArray.length;I++)y[0]=b[3*I+0],y[1]=b[3*I+1],y[2]=b[3*I+2],Ir(y,y,i),a.push(new wt(y[0],y[1]));for(let I=0;I<3*_.indexArray.length;I++)d.push(E[I]+p)}if(d.length%3!=0)return null;for(let _=0;_<d.length;_+=3){const b=a[d[_+0]],E=a[d[_+1]],I=a[d[_+2]];(b.x-E.x)*(I.y-E.y)-(I.x-E.x)*(b.y-E.y)>0&&([d[_+1],d[_+2]]=[d[_+2],d[_+1]])}return{vertices:a,indices:d}}function wM(c){const i=function(E,I){const M=[],D=WebGL2RenderingContext;if(E.json.textures)for(const N of E.json.textures){const V={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};N.sampler!==void 0&&Object.assign(V,E.json.samplers[N.sampler]),M.push({image:I[N.source],sampler:V,uploaded:!1})}return M}(c,c.images),a=function(E,I){const M=[];for(const D of E.json.meshes){const N=[];for(const V of D.primitives)N.push(ude(V,E,I));M.push(N)}return M}(c,i),{scenes:d,scene:p,nodes:y}=c.json,_=d?d[p||0].nodes:[...y.keys()],b=[];for(const E of _)b.push(jV(y[E],c,a));return function(E,I,M){const D={},N=new Set;for(let V=0;V<E.length;V++){const G=M[I[V]];if(!G.extras)continue;const Y=G.extras["mapbox:footprint:version"],re=G.extras["mapbox:footprint:id"];(Y||re)&&N.add(V),Y==="1.0.0"&&re&&(D[re]=V)}for(let V=0;V<E.length;V++){if(N.has(V))continue;const G=E[V],Y=M[I[V]];if(!Y.extras)continue;let re=null;G.id in D&&(re=fde(E[D[G.id]].meshes,G.localMatrix)),re||(re=hde(Y)),re&&(G.footprint=dde(re))}if(N.size>0){const V=Array.from(N.values()).sort((G,Y)=>G-Y);for(let G=V.length-1;G>=0;G--)E.splice(V[G],1)}}(b,_,c.json.nodes),b}function pde(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const i=c.vertexArray.float32,a=c.aabb.min[0]-1,d=c.aabb.min[1]-1,p=rg/(c.aabb.max[0]-a+2),y=rg/(c.aabb.max[1]-d+2);for(let _=0;_<i.length;_+=3){const b=i[_+2],E=(i[_+0]-a)*p|0,I=(i[_+1]-d)*y|0;b>c.heightmap[I*rg+E]&&(c.heightmap[I*rg+E]=b)}}function NV(c,i,a,d,p){a.reserve(a.length+4*c.length),d.reserve(d.length+10*c.length),p.reserve(p.length+10*c.length);let y=d.length;for(const _ of c){const b=Math.min(10,Math.max(4,1.3*_.height))*i,E=[-_.normal[1],_.normal[0],0],I=Math.min(.29,.1*_.width/_.depth),M=_.width-2*_.depth*i*(I+.01),D=ur([],_.pos,E,M/2),N=ur([],_.pos,E,-M/2),V=[D[0],D[1],D[2]+_.height],G=[N[0],N[1],N[2]+_.height],Y=ur([],_.normal,E,I);$t(Y,Y,b);const re=ur([],_.normal,E,-I);$t(re,re,b),qe(Y,D,Y),qe(re,N,re),D[2]+=.1,N[2]+=.1,d.emplaceBack(Y[0],Y[1],Y[2]),d.emplaceBack(re[0],re[1],re[2]),d.emplaceBack(D[0],D[1],D[2]),d.emplaceBack(N[0],N[1],N[2]),d.emplaceBack(V[0],V[1],V[2]),d.emplaceBack(G[0],G[1],G[2]),d.emplaceBack(D[0],D[1],D[2]),d.emplaceBack(N[0],N[1],N[2]),d.emplaceBack(Y[0],Y[1],Y[2]),d.emplaceBack(re[0],re[1],re[2]);const J=M/b/2;p.emplaceBack(-J-I,-1,J,.8),p.emplaceBack(J+I,-1,J,.8),p.emplaceBack(-J,0,J,1.3),p.emplaceBack(J,0,J,1.3),p.emplaceBack(J+I,-.8,J,.7),p.emplaceBack(J+I,-.8,J,.7),p.emplaceBack(0,0,J,1.3),p.emplaceBack(0,0,J,1.3),p.emplaceBack(J+I,-1.2,J,.8),p.emplaceBack(J+I,-1.2,J,.8),a.emplaceBack(6+y,4+y,8+y),a.emplaceBack(7+y,9+y,5+y),a.emplaceBack(0+y,1+y,2+y),a.emplaceBack(1+y,3+y,2+y),y+=10}}function mde(c,i){const a={};a.indexArray=new go,a.vertexArray=new Il,a.colorArray=new md,NV(c,i,a.indexArray,a.vertexArray,a.colorArray);const d={defined:!0};d.emissiveFactor=En.black;const p={};return p.baseColorFactor=En.white,d.pbrMetallicRoughness=p,a.material=d,a.aabb=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const zV=Zr([{name:"a_pos_3f",components:3,type:"Float32"}]),gde=Zr([{name:"a_normal_3",components:3,type:"Int16"}]),yde=Zr([{name:"a_centroid_3",components:3,type:"Int16"}]),FV=Zr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),_de=Zr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),vde=Zr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),xde=Zr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),bde=Zr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),wde=Zr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),BV=Jr.types,a2=32767;function Sde(c,i){const a=Mt+i;for(const d of c)for(const p of d)if(p.x<-i||p.x>a||p.y<-i||p.y>a)return!1;return!0}function Tde(c){switch(c){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${c}`)}}class SM{constructor(){this.layoutVertexArray=new Il,this.layoutAttenuationArray=new md,this.layoutColorArray=new Qa,this.indexArray=new go,this.indexArrayForConflation=new go,this.segmentsBucket=new di}}class TM{constructor(i){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new di,this.entranceBloom=new SM;const a=66560;this.layoutVertexArray=new Il,this.layoutVertexArray.reserve(a),this.layoutNormalArray=new pu,this.layoutNormalArray.reserve(a),this.layoutCentroidArray=new pu,this.layoutCentroidArray.reserve(a),this.layoutColorArray=new Qa,this.layoutColorArray.reserve(a),this.layoutFloodLightDataArray=new Gm,this.layoutFloodLightDataArray.reserve(a),this.layoutAOArray=new E_,this.layoutAOArray.reserve(a),this.indexArray=new go,this.indexArray.reserve(66560),this.indexArrayForConflation=new go,this.segmentsBucket=new di,this.entranceBloom=new SM,i&&(this.layoutFacadePaintArray=new Qa,this.layoutFacadeDataArray=new Nf,this.layoutFacadeVerticalRangeArray=new Qa)}reserve(i,a,d){this.layoutVertexArray.reserveForAdditional(i),this.layoutCentroidArray.reserveForAdditional(i),this.layoutFloodLightDataArray.reserveForAdditional(i),this.layoutNormalArray.reserveForAdditional(i),this.layoutAOArray.reserveForAdditional(i),this.layoutColorArray.reserveForAdditional(i),this.indexArray.reserveForAdditional(a),d&&(this.layoutFacadePaintArray.reserveForAdditional(i),this.layoutFacadeDataArray.reserveForAdditional(i),this.layoutFacadeVerticalRangeArray.reserveForAdditional(i))}}class $V{constructor(i){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new hh,this.footprintsIndices=new Gm,this.footprintsMin=new wt(1/0,1/0),this.footprintsMax=new wt(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new TM(!1),this.buildingWithFacade=new TM(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=i.zoom,this.canonical=i.canonical,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.hasPattern=!1,this.worldview=i.worldview,this.lut=i.lut,this.programConfigurations=new F(i.layers,{zoom:i.zoom,lut:i.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection,this.groundEffect=new sM(i),this.groundEffect.groundRadiusArray=new Ko,this.hasAppearances=null}updateFootprints(i,a){const d=new HA([],[],1),p={vertices:[],indices:new Uint32Array(0),grid:d,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};a.push({footprint:p,id:i})}updateAppearances(i,a,d,p){}prepare(){return function(){if(QA!=null||mV!=null)return null;if(j_!=null)return j_;const i=fetch(po.BUILDING_GEN_URL);return j_=function(a){let d,p,y,_,b;function E(){d=new Uint8Array(b.buffer),p=new Int16Array(b.buffer),y=new Int32Array(b.buffer),_=new Float32Array(b.buffer)}function I(){throw new Error("Unexpected BuildingGen error.")}const M=()=>{},D={a:{a:I,f:function(N){const V=d.length,G=Math.max(N>>>0,Math.ceil(1.2*V)),Y=Math.ceil((G-V)/65536);try{return b.grow(Y),E(),!0}catch{return!1}},g:I,b:M,c:M,d:M,e:M}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,D):a.then(N=>N.arrayBuffer()).then(N=>WebAssembly.instantiate(N,D))).then(N=>{const V=N.instance.exports;return(0,V.g)(),b=V.f,E(),new Zue({setStyle:V.h,setAOOptions:V.i,setMetricOptions:V.j,setStructuralOptions:V.k,setFacadeOptions:V.l,setFauxFacadeOptions:V.m,setFacadeClassifierOptions:V.n,addFeature:V.o,addFacade:V.p,generateMesh:V.q,getLastError:V.r,getOuterRingLength:V.s,getMeshCount:V.t,getPositionsPtr:V.u,getPositionsLength:V.v,getNormalsPtr:V.w,getNormalsLength:V.x,getAOPtr:V.y,getAOLength:V.z,getUVPtr:V.A,getUVLength:V.B,getFauxFacadePtr:V.C,getFauxFacadeLength:V.D,getIndicesPtr:V.E,getIndicesLength:V.F,getBuildingPart:V.G,getRingCount:V.H,getRingPtr:V.I,getRingLength:V.J,malloc:V.K,free:V.L,heapU8:d,heap16:p,heap32:y,heapF32:_})})}(i).then(a=>(j_=null,QA=a,QA)).catch(a=>{vr("Could not load building-gen"),j_=null,mV=a}),j_}()}populate(i,a,d,p){const y=Xue();if(!y)return;const _=At(d);this.tileToMeter=_,this.brightness=a.brightness,y.setStyle({normalScale:[1,-1,_],tileToMeters:_}),y.setAOOptions(!1,.3),y.setMetricOptions(!1,16),y.setStructuralOptions(!0),y.setFacadeClassifierOptions(3);const b=new Map,E=new Map;let I=0;for(const{feature:J}of i){if(BV[J.type]!=="LineString"){b.set(J.id,J.properties.source_id);continue}const oe=this.layers[0]._featureFilter.needGeometry;if(oe&&!this.layers[0]._featureFilter.filter(new Dn(this.zoom),J,d))continue;const le=Lr(J,oe);if(!oe&&!this.layers[0]._featureFilter.filter(new Dn(this.zoom),le,d))continue;const de=oe?le.geometry:yr(J,d,p),_e=[];for(const Se of de)for(const Oe of Se)_e.push(Oe.x),_e.push(Oe.y);const ye={coordinates:_e,crossPerc:J.properties.cross_perc,distanceToRoad:J.properties.distance_to_road,entrances:J.properties.entrances,sourceId:0},Te=J.properties.source_id;let Ae=E.get(Te);Ae||(Ae=[],E.set(Te,Ae)),Ae.push(ye),++I}this.maxHeight=0;const M=new Array,D=new Set,N=J=>{J!=null&&D.add(J)},V=(J,oe)=>{J!=null&&M.push({buildingId:J,footprintIndex:oe})},G=64*(i.length-I),Y=G/2;this.buildingWithFacade.reserve(G,Y,!0),this.buildingWithoutFacade.reserve(2*G,2*Y,!1),this.footprintsIndices.reserve(16*(i.length-I)),this.footprintsVertices.reserve(8*(i.length-I));for(const{feature:J,id:oe,index:le,sourceLayerIndex:de}of i){if(BV[J.type]==="LineString")continue;const _e=this.layers[0]._featureFilter.needGeometry;if(_e&&!this.layers[0]._featureFilter.filter(new Dn(this.zoom),J,d))continue;let ye=null;if(J.properties&&J.properties.hasOwnProperty("building_id")&&(ye=Number(J.properties.building_id),D.has(ye)))continue;const Te=Lr(J,_e);if(!_e&&!this.layers[0]._featureFilter.filter(new Dn(this.zoom),Te,d))continue;const Ae=_e?Te.geometry:yr(J,d,p),Se=lw(Ae,500);let Oe=!1;for(const Vr of Se)if(Vr.length!==1){Oe=!0;break}if(Oe){N(ye);continue}if(!Sde(Ae,163)){N(ye);continue}const Me=this.layers[0],st=Tde(Me.layout.get("building-roof-shape").evaluate(J,{},d)),et=Me.layout.get("building-base").evaluate(J,{},d),it=Me.layout.get("building-height").evaluate(J,{},d),mt=Me.layout.get("building-flood-light-ground-radius").evaluate(J,{},d),ft=Me.paint.get("building-ambient-occlusion-intensity"),pt=mt/this.tileToMeter;J.properties["building-part"]="roof";const Ke=Me.paint.get("building-color").evaluate(J,{},this.canonical).toPremultipliedRenderColor(this.lut),yt=Me.paint.get("building-emissive-strength").evaluate(J,{},this.canonical);J.properties["building-part"]="wall";const ut=Me.paint.get("building-color").evaluate(J,{},this.canonical).toPremultipliedRenderColor(this.lut),_t=Me.paint.get("building-emissive-strength").evaluate(J,{},this.canonical);J.properties["building-part"]="window";const gt=Me.paint.get("building-color").evaluate(J,{},this.canonical).toPremultipliedRenderColor(this.lut),Vt=Me.paint.get("building-emissive-strength").evaluate(J,{},this.canonical);J.properties["building-part"]="door";const Ut=Me.paint.get("building-color").evaluate(J,{},this.canonical).toPremultipliedRenderColor(this.lut),kt=Me.paint.get("building-emissive-strength").evaluate(J,{},this.canonical);let Dt=Me.layout.get("building-flood-light-wall-radius").evaluate(J,{},d);Dt=we(Dt,0,2048);const lr=Dt/2048*a2,Jt=b.get(oe),Ft=E.get(Jt)||[],br=Ft.length!==0&&Me.layout.get("building-facade").evaluate(J,{},d);y.setFacadeOptions(4,!0),y.setFauxFacadeOptions(br,!1,1);let Gr=0,mn=0,$r=0,Ln=0,sn=0,Di=0,un=0,On=0,li=0,gi=0,yi=0;if(br){let Vr=Math.round(Me.layout.get("building-facade-floors").evaluate(J,{},d));if(et===0){Vr=Math.max(1,Vr-(Ft.length>0?1:0));let ji=4;if(it>100){const vo=[10,13,15];ji=vo[J.id?J.id%vo.length:0]}else it<=10&&(ji=3);y.setFacadeOptions(ji,!0),sn=(it<15?1.3:1.61803)*ji/_}else sn=et/_;Di=it/_,sn=Math.min(sn,Di),$r=Me.layout.get("building-facade-unit-width").evaluate(J,{},d)/_,Ln=(Di-sn)/Vr,y.setFauxFacadeOptions(!0,!0,$r);const No=Me.layout.get("building-facade-window").evaluate(J,{},d);Gr=No[0],mn=No[1],un=Math.floor(65535*Math.min(1,sn/Mt)),On=Math.floor(65535*Math.min(1,Di/Mt)),li=Math.floor(255*Gr)<<8|Math.floor(255*mn),gi=Math.floor(65535*Math.min(1,$r/Mt)),yi=Math.floor(65535*Math.min(1,Ln/Mt))}const Li=Array(Se.length),Yo={x:1/0,y:1/0},_s={x:-1/0,y:-1/0},io={x:0,y:0};let _o=0;for(let Vr=0;Vr<Se.length;Vr++){const No=Se[Vr];if(No.length>0){const ji=[],vo=Array(No.length+1);vo[0]=0;for(let Kl=0;Kl<No.length;Kl++){const Da=No[Kl];for(let al=0;al<Da.length;al++){const zo=Da[Da.length-al-1];Yo.x=Math.min(Yo.x,zo.x),Yo.y=Math.min(Yo.y,zo.y),_s.x=Math.max(_s.x,zo.x),_s.y=Math.max(_s.y,zo.y),io.x+=zo.x,io.y+=zo.y,_o++,ji.push(zo.x),ji.push(zo.y)}vo[Kl+1]=ji.length}Li[Vr]={id:J.id?J.id:0,height:it,minHeight:et,sourceId:0,roofType:st,coordinates:ji,ringIndices:vo}}}io.x/=_o||1,io.y/=_o||1;const Io=y.generateMesh(Li,Ft);if(typeof Io=="string"){vr(`Unable to generate building ${J.id}: ${Io}`),N(ye);continue}if(Io.meshes.length===0||Io.modifiedPolygonRings.length===0){N(ye);continue}const jr=br?this.buildingWithFacade:this.buildingWithoutFacade;let _i=0;for(const Vr of Io.meshes)_i+=Vr.positions.length/3;const Si=jr.segmentsBucket.prepareSegment(_i,jr.layoutVertexArray,jr.indexArray),sl=[];let ea=null,Jo=0,ta=-1;const vd=jr.layoutVertexArray.length,Rs=vd+_i;jr.layoutVertexArray.resize(Rs),jr.layoutCentroidArray.resize(Rs),jr.layoutNormalArray.resize(Rs),jr.layoutAOArray.resize(Rs),jr.layoutColorArray.resize(Rs),jr.layoutFloodLightDataArray.resize(Rs),br&&(jr.layoutFacadePaintArray.resize(Rs),jr.layoutFacadeDataArray.resize(Rs),jr.layoutFacadeVerticalRangeArray.resize(Rs));const R2=jr.indexArray.length;let X_=0,_a=vd;for(const Vr of Io.meshes){let No,ji;if(Vr.buildingPart===1)No=Ke,ji=yt;else if(Vr.buildingPart===0)No=ut,ji=_t;else if(Vr.buildingPart===2)No=gt,ji=Vt;else{if(Vr.buildingPart!==3)continue;No=Ut,ji=kt}if(ji=we(ji,0,1),Vr.buildingPart===3){const oo=new Array;for(let Ds=0;Ds<Vr.positions.length;Ds+=12){const Jf=Vr.positions[Ds+0],es=Vr.positions[Ds+1],La=Vr.positions[Ds+3],Rc=Vr.positions[Ds+4],wd=Vr.positions[Ds+2],lD=Vr.positions[Ds+8]-wd,cD=1,qw=La-Jf,Y_=Rc-es,xu=Math.hypot(qw,Y_);oo.push({pos:[Jf+.5*qw,es+.5*Y_,wd],normal:[Y_/xu,-qw/xu,0],width:xu,height:lD,depth:cD,points:[Jf,es,La,Rc]})}const Qo=jr.entranceBloom.segmentsBucket.prepareSegment(10*oo.length,jr.entranceBloom.layoutVertexArray,jr.entranceBloom.indexArray),xo=jr.entranceBloom.layoutVertexArray.length;Jo=jr.entranceBloom.indexArray.length,NV(oo,.5/this.tileToMeter,jr.entranceBloom.indexArray,jr.entranceBloom.layoutVertexArray,jr.entranceBloom.layoutAttenuationArray);const Ms=jr.entranceBloom.layoutVertexArray.length-xo;ta=jr.entranceBloom.indexArray.length-Jo;for(let Ds=0;Ds<Ms;Ds++)jr.entranceBloom.layoutColorArray.emplaceBack(255*Ut.r<<8|255*Ut.g,255*Ut.b<<8|51*kt);Qo.vertexLength+=Ms,Qo.primitiveLength+=ta,ea={part:Vr.buildingPart,vertexOffset:xo,vertexLength:Ms}}jr.layoutVertexArray.float32.set(Vr.positions,3*_a);const vo=Vr.positions.length/3;for(let oo=0;oo<vo;++oo){const Qo=3*oo;X_=Math.max(X_,Vr.positions[Qo+2]);const xo=Vr.normals[Qo+1]*a2,Ms=Vr.normals[Qo+2]*a2,Ds=3*(_a+oo);jr.layoutNormalArray.int16[Ds]=Vr.normals[Qo]*a2,jr.layoutNormalArray.int16[Ds+1]=xo,jr.layoutNormalArray.int16[Ds+2]=Ms;const Jf=Vr.ao[oo];jr.layoutAOArray.uint8[_a+oo]=255*Jf;const es=1+(Jf-1)*ft,La=255*No.b*es<<8|255*ji;jr.layoutColorArray.uint16[2*(_a+oo)]=255*No.r*es<<8|255*No.g*es,jr.layoutColorArray.uint16[2*(_a+oo)+1]=La}const Kl=Math.floor(io.x),Da=Math.floor(io.y),al=Math.floor(it);for(let oo=0;oo<vo;++oo){const Qo=3*(_a+oo);jr.layoutCentroidArray.int16[Qo]=Kl,jr.layoutCentroidArray.int16[Qo+1]=Da,jr.layoutCentroidArray.int16[Qo+2]=al}if(jr.layoutFloodLightDataArray.uint16.fill(Vr.buildingPart===0?lr:0,_a,_a+vo),br){const oo=255*gt.r<<8|255*gt.g,Qo=255*gt.b<<8|255*Vt;for(let xo=0;xo<vo;++xo){const Ms=2*(_a+xo);jr.layoutFacadePaintArray.uint16[Ms]=oo,jr.layoutFacadePaintArray.uint16[Ms+1]=Qo}for(let xo=0;xo<vo;++xo)if(Vr.isFauxFacade[xo]){const Ms=Math.min(65535,Math.floor(Vr.uv[2*xo]*Io.outerRingLength));jr.layoutFacadeDataArray.emplace(_a+xo,1|Ms,li,gi,yi),jr.layoutFacadeVerticalRangeArray.emplace(_a+xo,un,On)}else jr.layoutFacadeDataArray.emplace(_a+xo,0,0,0,0),jr.layoutFacadeVerticalRangeArray.emplace(_a+xo,0,0)}const zo=Si.vertexLength,Gw=Vr.indices.length/3,bd=jr.indexArray.length;jr.indexArray.resize(bd+Gw);for(let oo=0;oo<Gw;++oo){const Qo=3*oo,xo=3*bd+Qo;jr.indexArray.uint16[xo]=zo+Vr.indices[Qo],jr.indexArray.uint16[xo+1]=zo+Vr.indices[Qo+1],jr.indexArray.uint16[xo+2]=zo+Vr.indices[Qo+2]}Vr.buildingPart!==1&&Vr.buildingPart!==0&&Vr.buildingPart!==2&&Vr.buildingPart!==3||sl.push({part:Vr.buildingPart,vertexOffset:_a,vertexLength:Vr.positions.length/3}),_a+=vo,Si.vertexLength+=vo,Si.primitiveLength+=Vr.indices.length/3}this.maxHeight=Math.max(this.maxHeight,X_);const M2=jr.indexArray.length-R2,xd=this.footprintsIndices.length,vh=this.footprintsVertices.length,Yf=[],Xl=new wt(1/0,1/0),kc=new wt(-1/0,-1/0),Uw=this.groundEffect.vertexArray.length;for(const Vr of Io.modifiedPolygonRings){const No=[],ji=new wt(1/0,1/0),vo=new wt(-1/0,-1/0);for(let Kl=0;Kl<Vr.length;Kl+=2){const Da=Vr.length-Kl-2;ji.x=Math.min(ji.x,Vr[Da]),ji.y=Math.min(ji.y,Vr[Da+1]),vo.x=Math.max(vo.x,Vr[Da]),vo.y=Math.max(vo.y,Vr[Da+1]);const al=new wt(Vr[Da],Vr[Da+1]);No.push(al),Yf.push(al.x,al.y),this.footprintsVertices.emplaceBack(al.x,al.y)}Xl.x=Math.min(Xl.x,ji.x),Xl.y=Math.min(Xl.y,ji.y),kc.x=Math.max(kc.x,vo.x),kc.y=Math.max(kc.y,vo.y),this.groundEffect.addData(No,[ji,vo],pt)}const K_=this.groundEffect.vertexArray.length-Uw;this.groundEffect.groundRadiusArray.reserveForAdditional(K_);for(let Vr=0;Vr<K_;Vr++)this.groundEffect.groundRadiusArray.emplaceBack(mt);(Yo.x<0||_s.x>Mt||Yo.y<0||_s.y>Mt)&&this.featuresOnBorder.push({featureId:J.id,footprintIndex:this.footprints.length});{const Vr=I_(Yf,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Vr.length),this.footprintsIndices.uint16.set(Vr,xd),this.buildingIds.add(ye??J.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Xl.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Xl.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,kc.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,kc.y);const No={footprintVertexOffset:vh,footprintVertexLength:this.footprintsVertices.length-vh,footprintIndexOffset:xd,footprintIndexLength:this.footprintsIndices.length-xd,min:Xl,max:kc,hiddenFlags:0,indicesOffset:R2,indicesLength:M2,bloomIndicesOffset:Jo,bloomIndicesLength:ta,groundEffectVertexOffset:Uw,groundEffectVertexLength:K_,hasFauxFacade:br,height:X_,promoteId:oe,feature:Te,parts:sl,buildingBloom:ea},ji=this.footprints.length;J.id!==void 0&&this.featureFootprintLookup.set(J.id,ji),V(ye,ji),this.footprints.push(No)}this.programConfigurations.populatePaintArrays(jr.layoutVertexArray.length,J,le,{},a.availableImages,d,a.brightness),this.groundEffect.addPaintPropertiesData(J,le,{},a.availableImages,d,a.brightness),a.featureIndex.insert(J,Ae,le,de,this.index,vd)}M.forEach(({buildingId:J,footprintIndex:oe})=>{D.has(J)&&(this.footprints[oe].hiddenFlags|=4)});const re=new Set;this.buildingIds.forEach((J,oe,le)=>{D.has(J)||re.add(J)}),this.buildingIds=re,this.groundEffect.prepareBorderSegments()}update(i,a,d,p,y,_,b){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b),this.groundEffect.update(i,a,y,d,p,_,b),this.evaluate(this.layers[0],i),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(i){const a=d=>{d.layoutVertexBuffer=i.createVertexBuffer(d.layoutVertexArray,zV.members),d.layoutNormalBuffer=i.createVertexBuffer(d.layoutNormalArray,gde.members),d.layoutCentroidBuffer=i.createVertexBuffer(d.layoutCentroidArray,yde.members),d.layoutFloodLightDataBuffer=i.createVertexBuffer(d.layoutFloodLightDataArray,wde.members),d.layoutFacadeDataArray&&d.layoutFacadeDataArray.length&&(d.layoutFacadeDataBuffer=i.createVertexBuffer(d.layoutFacadeDataArray,vde.members)),d.layoutFacadeVerticalRangeArray&&d.layoutFacadeVerticalRangeArray.length&&(d.layoutFacadeVerticalRangeBuffer=i.createVertexBuffer(d.layoutFacadeVerticalRangeArray,xde.members)),d.entranceBloom.layoutVertexArray.length&&(d.entranceBloom.layoutVertexBuffer=i.createVertexBuffer(d.entranceBloom.layoutVertexArray,zV.members),d.entranceBloom.layoutAttenuationBuffer=i.createVertexBuffer(d.entranceBloom.layoutAttenuationArray,bde.members)),this.uploadUpdatedColorBuffer(i),this.uploadUpdatedIndexBuffer(i)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(i)),this.groundEffect.uploadPaintProperties(i),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){const i=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(i,a,d=!0){let p=!1;const y=d?a:0,_=0|(d?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of i){const E=this.footprints[b],I=E.hiddenFlags&_|y;E.hiddenFlags!==I&&(E.hiddenFlags=I,p=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return p&&(this.indexArrayForConflationUploaded=!1),p}uploadUpdatedIndexBuffer(i){if(this.groundEffect.uploadHiddenByLandmark(i),this.indexArrayForConflationUploaded)return;const a=p=>{p.indexArray.length!==0&&(p.indexArrayForConflation.resize(p.indexArray.length),p.indexArrayForConflation.uint16.set(p.indexArray.uint16),p.entranceBloom.indexArrayForConflation.resize(p.entranceBloom.indexArray.length),p.entranceBloom.indexArrayForConflation.uint16.set(p.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const p of this.footprints){const y=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=p.indicesOffset+p.indicesLength;if(p.hiddenFlags!==0){for(let E=p.indicesOffset;E<_;E++)y.indexArrayForConflation.uint16[3*E+0]=0,y.indexArrayForConflation.uint16[3*E+1]=0,y.indexArrayForConflation.uint16[3*E+2]=0;const b=p.bloomIndicesOffset+p.bloomIndicesLength;for(let E=p.bloomIndicesOffset;E<b;E++)y.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,y.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,y.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const d=p=>{p.indexArray.length!==0&&(p.indexBuffer?p.indexBuffer.updateData(p.indexArrayForConflation):p.indexBuffer=i.createIndexBuffer(p.indexArrayForConflation,!0),p.entranceBloom.indexBuffer?p.entranceBloom.indexBuffer.updateData(p.entranceBloom.indexArrayForConflation):p.entranceBloom.indexBuffer=i.createIndexBuffer(p.entranceBloom.indexArrayForConflation,!0))};d(this.buildingWithoutFacade),d(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(i){const a=d=>{d.layoutColorBuffer?d.layoutColorBuffer.updateData(d.layoutColorArray):d.layoutColorBuffer=i.createVertexBuffer(d.layoutColorArray,FV.members,!0),d.layoutFacadePaintArray&&(d.layoutFacadePaintBuffer?d.layoutFacadePaintBuffer.updateData(d.layoutFacadePaintArray):d.layoutFacadePaintBuffer=i.createVertexBuffer(d.layoutFacadePaintArray,_de.members,!0)),d.entranceBloom.layoutColorBuffer?d.entranceBloom.layoutColorBuffer.updateData(d.entranceBloom.layoutColorArray):d.entranceBloom.layoutColorBuffer=i.createVertexBuffer(d.entranceBloom.layoutColorArray,FV.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(i,a){const d=i.paint.get("building-ambient-occlusion-intensity");for(const p of this.footprints){if(4&p.hiddenFlags)continue;const y=a[p.promoteId],_=p.feature;_.properties["building-part"]="roof";const b=i.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),E=i.paint.get("building-emissive-strength").evaluate(_,y,this.canonical);_.properties["building-part"]="wall";const I=i.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),M=i.paint.get("building-emissive-strength").evaluate(_,y,this.canonical);_.properties["building-part"]="window";const D=i.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),N=i.paint.get("building-emissive-strength").evaluate(_,y,this.canonical);_.properties["building-part"]="door";const V=i.paint.get("building-color").evaluate(_,y,this.canonical).toPremultipliedRenderColor(this.lut),G=i.paint.get("building-emissive-strength").evaluate(_,y,this.canonical),Y=p.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const J of p.parts){let oe,le=b;J.part===1?(le=b,oe=E):J.part===0?(le=I,oe=M):J.part===2?(le=D,oe=N):J.part===3&&(le=V,oe=G),oe=we(oe,0,1);for(let de=0;de<J.vertexLength;de++){const _e=J.vertexOffset+de,ye=1+(Y.layoutAOArray.uint8[_e]/255-1)*d;Y.layoutColorArray.emplace(_e,le.r*ye*255<<8|le.g*ye*255,le.b*ye*255<<8|255*oe),p.hasFauxFacade&&Y.layoutFacadePaintArray.emplace(_e,255*D.r<<8|255*D.g,255*D.b<<8|255*N)}}const re=p.buildingBloom;if(re)for(let J=0;J<re.vertexLength;J++)Y.entranceBloom.layoutColorArray.emplace(re.vertexOffset+J,255*V.r<<8|255*V.g,255*V.b<<8|51*G)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(i,a,d){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const p=a.getReplacementRegionsForTile(i.toUnwrapped());if(ZA(this.activeReplacements,p))return;this.activeReplacements=p;for(const _ of this.footprints)_.hiddenFlags&=-2;const y=[];for(const _ of this.activeReplacements){if(_.order<d)continue;const b=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-i.canonical.z));for(const E of this.footprints)E.min.x>_.max.x||E.max.x<_.min.x||E.min.y>_.max.y||E.max.y<_.min.y||(y.length=0,Ade(this.footprintsVertices,E.footprintVertexOffset,E.footprintVertexLength,_.footprintTileId.canonical,i.canonical,y),nM(_.footprint,y,this.footprintsIndices.uint16,E.footprintIndexOffset,E.footprintIndexLength,0,-b)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(i){if(i.id!==void 0){const a=this.featureFootprintLookup.get(i.id);return this.footprints[a]}return null}getHeightAtTileCoord(i,a){let d=Number.NEGATIVE_INFINITY,p=!0;const y=4*(i+Mt)*Mt+(a+Mt);if(this.footprintLookup.hasOwnProperty(y)){const b=this.footprintLookup[y];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const _=new wt(i,a);for(const b of this.footprints)i>b.max.x||b.min.x>i||a>b.max.y||b.min.y>a||b.height<=d||Ede(_,this.footprintsVertices.float32.subarray(2*b.footprintVertexOffset,2*(b.footprintVertexOffset+b.footprintVertexLength)),this.footprintsIndices.uint16.subarray(b.footprintIndexOffset,b.footprintIndexOffset+b.footprintIndexLength))&&(d=b.height,this.footprintLookup[y]=b,p=b.hiddenFlags!==0);if(d!==Number.NEGATIVE_INFINITY)return{height:d,hidden:p};this.footprintLookup[y]=void 0}}function Ede(c,i,a){for(let d=0;d<a.length;d+=3){const p=a[d],y=a[d+1],_=a[d+2],b=i[2*p+0],E=i[2*p+1],I=i[2*y+0],M=i[2*y+1],D=i[2*_+0],N=i[2*_+1],V=(b-D)*(c.y-N)-(E-N)*(c.x-D),G=(I-b)*(c.y-E)-(M-E)*(c.x-b);if(V<0!=G<0&&V!==0&&G!==0)continue;const Y=(D-I)*(c.y-M)-(N-M)*(c.x-I);if(Y===0||Y<0==V+G<=0)return!0}return!1}function Ade(c,i,a,d,p,y){const _=Math.pow(2,d.z-p.z);for(let b=0;b<a;b++){let E=c.float32[2*(b+i)+0],I=c.float32[2*(b+i)+1];E=(E+p.x*Mt)*_-d.x*Mt,I=(I+p.y*Mt)*_-d.y*Mt,y.push(new wt(E,I))}}let VV,UV;Wt($V,"BuildingBucket",{omit:["layers"]}),Wt(TM,"BuildingGeometry"),Wt(SM,"BuildingBloomGeometry");const Pde=Zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Cde=Zr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ide}=Pde,Ode=Zr([{name:"a_packed",components:3,type:"Float32"}]),{members:kde}=Ode,Rde=Zr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Mde}=Rde;class GV{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new Gf({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const d=this.getKey(i,a);return this.positions[d]}trim(){const i=this.width,a=this.height=xt(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,d){const p=[];let y=i.length%2==1?-i[i.length-1]*d:0,_=i[0]*d,b=!0;p.push({left:y,right:_,isDash:b,zeroLength:i[0]===0});let E=i[0];for(let I=1;I<i.length;I++){b=!b;const M=i[I];y=E*d,E+=M,_=E*d,p.push({left:y,right:_,isDash:b,zeroLength:M===0})}return p}addRoundDash(i,a,d){const p=a/2;for(let y=-d;y<=d;y++){const _=this.width*(this.nextRow+d+y);let b=0,E=i[b];for(let I=0;I<this.width;I++){I/E.right>1&&(E=i[++b]);const M=Math.abs(I-E.left),D=Math.abs(I-E.right),N=Math.min(M,D);let V;const G=y/d*(p+1);if(E.isDash){const Y=p-Math.abs(G);V=Math.sqrt(N*N+Y*Y)}else V=p-Math.sqrt(N*N+G*G);this.image.data[_+I]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(i,a){for(let E=i.length-1;E>=0;--E){const I=i[E],M=i[E+1];I.zeroLength?i.splice(E,1):M&&M.isDash===I.isDash&&(M.left=I.left,i.splice(E,1))}const d=i[0],p=i[i.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const y=this.width*this.nextRow;let _=0,b=i[_];for(let E=0;E<this.width;E++){E/b.right>1&&(b=i[++_]);const I=Math.abs(E-b.left),M=Math.abs(E-b.right),D=Math.min(I,M);this.image.data[y+E]=Math.max(0,Math.min(255,(b.isDash?D:-D)+a+128))}}addDash(i,a){const d=this.getKey(i,a);if(this.positions[d])return this.positions[d];const p=a==="round",y=p?7:0,_=2*y+1;if(this.nextRow+_>this.height)return vr("LineAtlas out of space"),null;i.length===0&&i.push(1);let b=0;for(let M=0;M<i.length;M++)i[M]<0&&(vr("Negative value is found in line dasharray, replacing values with 0"),i[M]=0),b+=i[M];if(b!==0){const M=this.width/b,D=this.getDashRanges(i,this.width,M);p?this.addRoundDash(D,M,y):this.addRegularDash(D,a==="square"?.5*M:0)}const E=this.nextRow+y;this.nextRow+=_;const I={tl:[E,y],br:[b,0]};return this.positions[d]=I,I}}Wt(GV,"LineAtlas");const Dde=Jr.types,Lde=Math.cos(Math.PI/180*37.5),jde=Math.cos(Math.PI/180*5);class EM{constructor(i){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=i.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=i.overscaling,this.pixelRatio=i.pixelRatio,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Hb,this.layoutVertexArray2=new Il,this.patternVertexArray=new Il,this.indexArray=new go,this.programConfigurations=new F(i.layers,{zoom:i.zoom,lut:i.lut}),this.segments=new di,this.maxLineLength=0,this.zOffsetVertexArray=new Il,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=i.tessellationStep?i.tessellationStep:128,this.worldview=i.worldview,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,d,p){}populate(i,a,d,p){this.hasPattern=GR("line",this.layers,this.pixelRatio,a);const y=this.layers[0].layout.get("line-sort-key");this.tileToMeter=At(d);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const N=this.layers[0].layout.get("line-z-offset"),V=N.isConstant()&&!N.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&_==="none"&&vr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const E=[];for(const{feature:N,id:V,index:G,sourceLayerIndex:Y}of i){const re=this.layers[0]._featureFilter.needGeometry,J=Lr(N,re);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),J,d))continue;const oe=y?y.evaluate(J,{},d):void 0,le={id:V,properties:N.properties,type:N.type,sourceLayerIndex:Y,index:G,geometry:re?J.geometry:yr(N,d,p),patterns:{},sortKey:oe};E.push(le)}y&&E.sort((N,V)=>N.sortKey-V.sortKey);const{lineAtlas:I,featureIndex:M}=a,D=this.addConstantDashes(I);for(const N of E){const{geometry:V,index:G,sourceLayerIndex:Y}=N;if(D&&this.addFeatureDashes(N,I),this.hasPattern){const re=qR("line",this.layers,N,this.zoom,this.pixelRatio,a);this.patternFeatures.push(re)}else this.addFeature(N,V,G,d,I.positions,a.availableImages,a.brightness,a.elevationFeatures);M.insert(i[G].feature,V,G,Y,this.index)}}addConstantDashes(i){let a=!1;for(const d of this.layers){const p=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if(p.kind!=="constant"||y.kind!=="constant")a=!0;else{const _=y.value,b=p.value;if(!b)continue;i.addDash(b,_)}}return a}addFeatureDashes(i,a){const d=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,_=p.layout.get("line-cap").value;if(y.kind==="constant"&&_.kind==="constant")continue;let b,E;if(y.kind==="constant"){if(b=y.value,!b)continue}else b=y.evaluate({zoom:d},i);E=_.kind==="constant"?_.value:_.evaluate({zoom:d},i),a.addDash(b,E),i.patterns[p.id]=[a.getKey(b,E)]}}update(i,a,d,p,y,_,b,E){this.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b,E)}addFeatures(i,a,d,p,y,_){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,d,p,_,i.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,kde)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=i.createVertexBuffer(this.patternVertexArray,Mde)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,Cde.members,!0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Ide),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i,a){let d,p;if(a&&a>0?(d=`mapbox_clip_start_${a}`,p=`mapbox_clip_end_${a}`):(d="mapbox_clip_start",p="mapbox_clip_end"),i.properties&&i.properties.hasOwnProperty(d)&&i.properties.hasOwnProperty(p))return{start:+i.properties[d],end:+i.properties[p]}}addFeature(i,a,d,p,y,_,b,E){const I=this.layers[0].layout,M=I.get("line-join").evaluate(i,{}),D=I.get("line-cap").evaluate(i,{}),N=I.get("line-miter-limit"),V=I.get("line-round-limit");this.lineClips=this.lineFeatureClips(i),this.lineFeature=i;const G=!(!i.properties||!i.properties.hasOwnProperty("mapbox_line_metrics"))&&i.properties.mapbox_line_metrics;this.zOffsetValue=I.get("line-z-offset").value;const Y=this.layers[0].paint.get("line-width").value;if(Y.kind!=="constant"&&Y.isLineProgressConstant===!1&&(this.variableWidthValue=Y),this.elevationType==="road"){const re=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(i,a,p,E,M,D,N,V)){const[J,oe]=this.clipRuntimeLinesToTile(a,1);for(let le=0;le<J.length;le++){const de=J[le],_e=oe[le],ye={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,de),prevDir:this.computeSegPrevDir(_e,de)};this.addLine(de,i,p,M,D,N,V,ye,G&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(re)}}else for(let re=0;re<a.length;re++)this.addLine(a[re],i,p,M,D,N,V,void 0,G&&re>0?re:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,d,y,_,p,b,void 0,this.worldview)}computeSegNextDir(i,a){return i.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(i,a){return a[1].sub(i.prevPoint).unit()}clipLinesToTile(i,a){return YA(i,-a,-a,Mt+a,Mt+a)}clipRuntimeLinesToTile(i,a){const d=[];return[YA(i,-a,-a,Mt+a,Mt+a,d),d]}addElevatedRoadFeature(i,a,d,p,y,_,b,E){const I=[],M=ya.getElevationFeature(i,p);if(M){const D=this.clipLinesToTile(a,1),N=this.prepareElevatedLines(D,M,d);for(const V of N)I.push({geometry:V,elevation:M,elevationTileID:d,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(I.length===0)return!1;for(const D of I){const N=this.layoutVertexArray.length;this.addLine(D.geometry,i,d,y,_,b,E);const V=new Ol(d,D.elevationTileID);if(D.elevation)for(let G=N;G<this.layoutVertexArray.length;G++){const Y=new wt(this.layoutVertexArray.int16[6*G]>>1,this.layoutVertexArray.int16[6*G+1]>>1),re=V.pointElevation(Y,D.elevation,.05);this.updateHeightRange(re),this.zOffsetVertexArray.emplaceBack(re,0,0)}else this.fillNonElevatedRoadSegment(N)}return!0}prepareElevatedLines(i,a,d){if(a.constantHeight!=null)return i;const p=[],y=1/At(d);for(const _ of i)Gue(_,new Oa(a,y),0,p);return p}fillNonElevatedRoadSegment(i){for(let a=i;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(i){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,i),this.heightRange.max=Math.max(this.heightRange.max,i)):this.heightRange={min:i,max:i}}addLine(i,a,d,p,y,_,b,E,I){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=I?this.lineFeatureClips(a,I):this.lineClips;const M=p==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const D=E&&E.progress.min>0,N=E&&E.progress.max<1;if(this.lineClips){let Se={min:this.lineClips.start,max:this.lineClips.end},Oe=1;if(E){const et=this.lineClips.end-this.lineClips.start;Se=function(it,mt,ft){return{min:Zo(it.min,mt,ft),max:Zo(it.max,mt,ft)}}(E.progress,{min:0,max:1},Se),et>0&&(Oe=(Se.max-Se.min)/et)}const Me=+a.properties.mapbox_clip_feature_len,st=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(Me)||Number.isNaN(st)){for(let it=0;it<i.length-1;it++)this.totalDistance+=i[it].dist(i[it+1]);const et=this.totalDistance/(Se.max-Se.min);this.totalFeatureLength=Number.isFinite(et)?et:0,this.lineClips.start=Se.min,this.lineClips.end=Se.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Me,this.distance=st*Oe,this.lineClips.start=Se.min,this.lineClips.end=Se.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const V=Dde[a.type]==="Polygon";let G=i.length;for(;G>=2&&i[G-1].equals(i[G-2]);)G--;let Y=0;for(;Y<G-1&&i[Y].equals(i[Y+1]);)Y++;if(G<(V?3:2))return;p==="bevel"&&(_=1.05);const re=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let J,oe,le,de,_e,ye,Te,Ae;E&&E.prevDir&&(ye=E.prevDir.perp()),E&&E.nextDir&&(Te=E.nextDir.perp()),this.e1=this.e2=-1,V&&(J=i[G-2],_e=i[Y].sub(J)._unit()._perp());for(let Se=Y;Se<G;Se++){if(le=Se===G-1?V?i[Y+1]:void 0:i[Se+1],le&&i[Se].equals(le))continue;_e&&(de=_e),J&&(oe=J),J=i[Se],Ae=this.evaluateLineProgressFeatures(oe?oe.dist(J):0),_e=le?le.sub(J)._unit()._perp():de,de=de||_e;const Oe=oe&&le;let Me=Oe?p:V||M?"butt":y;const st=de.x*_e.x+de.y*_e.y;if(M){const ut=function(_t){if(_t.patternJoinNone){const gt=_t.segmentPoints.length/2,Vt=_t.lineSoFar-_t.segmentStart;for(let Ut=0;Ut<gt;++Ut){const kt=_t.segmentPoints[2*Ut+1],Dt=Math.round(_t.segmentPoints[2*Ut])+.5+.25*kt;_t.patternVertexArray.emplaceBack(Dt,Vt,_t.segmentStart),_t.patternVertexArray.emplaceBack(Dt,Vt,_t.segmentStart)}_t.segmentPoints.length=0}_t.e1=_t.e2=-1};if(Oe&&st<jde){this.updateDistance(oe,J),this.addCurrentVertex(J,de,1,1,re,Ae),ut(this),this.addCurrentVertex(J,_e,-1,-1,re,Ae);continue}if(oe){if(!le){this.updateDistance(oe,J),this.addCurrentVertex(J,de,1,1,re,Ae),ut(this);continue}Me="miter"}}let et=de.add(_e);et.x===0&&et.y===0||et._unit();const it=et.x*_e.x+et.y*_e.y,mt=it!==0?1/it:1/0,ft=2*Math.sqrt(2-2*it),pt=it<Lde&&oe&&le,Ke=de.x*_e.y-de.y*_e.x>0,yt=this.overscaling<=16?122880/(512*this.overscaling):0;if(Oe&&Me==="round"){if(mt<b)Me="miter";else if(mt<=2){const ut=AM(J,-10,8202);Me=this.elevationType==="offset"&&(ut||this.hasCrossSlope)?"miter":"fakeround"}}if(Me==="miter"&&mt>_&&(Me="bevel"),Me==="bevel"&&(mt>2&&(Me="flipbevel"),mt<_&&(Me="miter")),oe&&!(Me==="miter"&&pt)&&this.updateDistance(oe,J),Me==="miter")if(pt){const ut=J.dist(oe);if(ut>2*yt){const gt=J.sub(J.sub(oe)._mult(yt/ut)._round());this.updateDistance(oe,gt),this.addCurrentVertex(gt,de,0,0,re,Ae),oe=gt}this.updateDistance(oe,J),et._mult(mt),this.addCurrentVertex(J,et,0,0,re,Ae);const _t=J.dist(le);if(_t>2*yt){const gt=J.add(le.sub(J)._mult(yt/_t)._round());this.updateDistance(J,gt),this.addCurrentVertex(gt,_e,0,0,re,Ae),J=gt}}else et._mult(mt),this.addCurrentVertex(J,et,0,0,re,Ae);else if(Me==="flipbevel"){if(mt>100)et=_e.mult(-1);else{const ut=mt*de.add(_e).mag()/de.sub(_e).mag();et._perp()._mult(ut*(Ke?-1:1))}this.addCurrentVertex(J,et,0,0,re,Ae),this.addCurrentVertex(J,et.mult(-1),0,0,re,Ae)}else if(Me==="bevel"||Me==="fakeround"){Ae!=null&&oe&&this.addCurrentVertex(J,Te||de,-1,-1,re,Ae);const ut=J.dist(oe)<=2*yt&&Me!=="bevel",_t=et.mult(Ke?1:-1);_t._mult(mt);const gt=_e.mult(Ke?-1:1),Vt=de.mult(Ke?-1:1),Ut=this.evaluateLineProgressFeatures(this.distance);if(Ae==null&&(this.addHalfVertex(J,_t.x,_t.y,!1,!Ke,0,re,Ut),ut||this.addHalfVertex(J,_t.x+2*Vt.x,_t.y+2*Vt.y,!1,Ke,0,re,Ut)),Me==="fakeround"){const kt=Math.round(180*ft/Math.PI/20);this.addHalfVertex(J,Vt.x,Vt.y,!1,Ke,0,re,Ut);for(let Dt=0;Dt<kt;Dt++){let lr=Dt/kt;if(lr!==.5){const Ft=lr-.5;lr+=lr*Ft*(lr-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*Ft*Ft+(.848013+st*(.215638*st-1.06021)))}const Jt=gt.sub(Vt)._mult(lr)._add(Vt)._unit();this.addHalfVertex(J,Jt.x,Jt.y,!1,Ke,0,re,Ut)}this.addHalfVertex(J,gt.x,gt.y,!1,Ke,0,re,Ut)}ut||Ae!=null||this.addHalfVertex(J,_t.x+2*gt.x,_t.y+2*gt.y,!1,Ke,0,re,Ut),Ae!=null&&le&&this.addCurrentVertex(J,ye||_e,1,1,re,Ae)}else if(Me==="butt")this.addCurrentVertex(J,et,0,0,re,Ae);else if(Me==="square"){if(!oe){const ut=D?0:-1;this.addCurrentVertex(J,et,ut,ut,re,Ae)}if(this.addCurrentVertex(J,et,0,0,re,Ae),oe){const ut=N?0:1;this.addCurrentVertex(J,et,ut,ut,re,Ae)}}else if(Me==="round"){if(oe){const ut=!Oe&&Te?Te:de;this.addCurrentVertex(J,ut,0,0,re,Ae),!Oe&&N||this.addCurrentVertex(J,ut,1,1,re,Ae,!0)}if(le){const ut=!Oe&&ye?ye:_e;!Oe&&D||this.addCurrentVertex(J,ut,-1,-1,re,Ae,!0),this.addCurrentVertex(J,ut,0,0,re,Ae)}}}}addVerticesTo(i,a,d,p,y,_,b,E,I,M){const D=(a.w-i.w)/this.tessellationStep|0;let N=0;const V=this.scaledDistance;if(D>1){this.lineSoFar=i.w;const Y=(a.x-i.x)/D,re=(a.y-i.y)/D,J=(a.z-i.z)/D,oe=(a.w-i.w)/D;for(let le=1;le<D;++le){i.x+=Y,i.y+=re,i.z+=J,this.lineSoFar+=oe,N+=oe;const de=this.evaluateLineProgressFeatures(this.prevDistance+N);this.scaledDistance=(this.prevDistance+N)/this.totalDistance,this.addHalfVertex(i,d,p,M,!1,b,I,de),this.addHalfVertex(i,y,_,M,!0,-E,I,de)}}this.lineSoFar=a.w,this.scaledDistance=V;const G=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,d,p,M,!1,b,I,G),this.addHalfVertex(a,y,_,M,!0,-E,I,G)}evaluateLineProgressFeatures(i){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+i)/this.totalFeatureLength):vr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(i,a,d,p,y,_,b=!1){const E=a.x+a.y*d,I=a.y-a.x*d,M=a.y*p-a.x,D=-a.y-a.x*p;if(_!=null){const N=this.elevationType==="offset",V=-10,G=8202,Y=_.zOffset,re=new sV(i.x,i.y,Y,this.lineSoFar),J=!!N&&AM(i,V,G),oe=this.lineSoFar,le=this.distance;if(this.currentVertex)if(J){const de=this.currentVertexIsOutside,_e=this.currentVertex,ye=new sV(i.x,i.y,Y,this.lineSoFar);if(lV(_e,ye,V,G),!AM(ye,V,G)){if(de){this.e1=this.e2=-1,this.distance-=_e.dist(re),this.lineSoFar=_e.w;const Te=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,E,I,b,!1,d,y,Te),this.addHalfVertex(_e,M,D,b,!0,-p,y,Te),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(ye),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,ye,E,I,M,D,d,p,y,b),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const de=this.currentVertex;if(this.currentVertexIsOutside){lV(de,re,V,G),this.e1=this.e2=-1,this.distance-=de.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=de.w;const _e=this.evaluateLineProgressFeatures(de.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(de,E,I,b,!1,d,y,_e),this.addHalfVertex(de,M,D,b,!0,-p,y,_e),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(de,re,E,I,M,D,d,p,y,b)}else J||(this.addHalfVertex(i,E,I,b,!1,d,y,_),this.addHalfVertex(i,M,D,b,!0,-p,y,_));this.currentVertex=re,this.currentVertexIsOutside=J,this.lineSoFar=oe}else this.addHalfVertex(i,E,I,b,!1,d,y,_),this.addHalfVertex(i,M,D,b,!0,-p,y,_)}addHalfVertex({x:i,y:a},d,p,y,_,b,E,I){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((i<<1)+(y?1:0),(a<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=mr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),_?this.e2=M:this.e1=M,I!=null&&this.zOffsetVertexArray.emplaceBack(I.zOffset,I.variableWidth,I.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(i,a){this.prevDistance=this.distance,this.distance+=i.dist(a),this.updateScaledDistance()}}function AM(c,i,a){return c.x<i||c.x>a||c.y<i||c.y>a}let qV,HV;function WV(c,i,a){return i*(Mt/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}Wt(EM,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const ZV=(c,i,a)=>(1-a)*c+a*i;function XV(c,i){return 1/WV(c,1,i.tileZoom)}function KV(c,i,a,d){return c.translatePosMatrix(d||i.tileID.projMatrix,i,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const YV=c=>{const i=[];JV(c)&&i.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT");const a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||i.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&i.push("RENDER_LINE_BORDER");const d=c.layout.get("line-join").constantOr("miter")==="none",p=!!c.paint.get("line-pattern").constantOr(1);return d&&p&&i.push("LINE_JOIN_NONE"),i};function JV(c){const i=c.paint.get("line-dasharray").value;return i.kind!=="constant"||i.value}let PM;const QV=()=>PM||(PM={layout:qV||(qV=new bi({"line-cap":new zt(Ue.layout_line["line-cap"]),"line-join":new zt(Ue.layout_line["line-join"]),"line-miter-limit":new Ct(Ue.layout_line["line-miter-limit"]),"line-round-limit":new Ct(Ue.layout_line["line-round-limit"]),"line-sort-key":new zt(Ue.layout_line["line-sort-key"]),"line-z-offset":new zt(Ue.layout_line["line-z-offset"]),"line-elevation-reference":new Ct(Ue.layout_line["line-elevation-reference"]),"line-cross-slope":new Ct(Ue.layout_line["line-cross-slope"]),visibility:new Ct(Ue.layout_line.visibility),"line-width-unit":new Ct(Ue.layout_line["line-width-unit"])})),paint:HV||(HV=new bi({"line-opacity":new zt(Ue.paint_line["line-opacity"]),"line-color":new zt(Ue.paint_line["line-color"]),"line-translate":new Ct(Ue.paint_line["line-translate"]),"line-translate-anchor":new Ct(Ue.paint_line["line-translate-anchor"]),"line-width":new zt(Ue.paint_line["line-width"]),"line-gap-width":new zt(Ue.paint_line["line-gap-width"]),"line-offset":new zt(Ue.paint_line["line-offset"]),"line-blur":new zt(Ue.paint_line["line-blur"]),"line-dasharray":new zt(Ue.paint_line["line-dasharray"]),"line-pattern":new zt(Ue.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ct(Ue.paint_line["line-pattern-cross-fade"]),"line-gradient":new Df(Ue.paint_line["line-gradient"]),"line-trim-offset":new Ct(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ct(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new Ct(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new zt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new zt(Ue.paint_line["line-border-width"]),"line-border-color":new zt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new Ct(Ue.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},PM);class Nde extends zt{possiblyEvaluate(i,a){return a=new Dn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(i,a)}evaluate(i,a,d,p){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(i,a,d,p)}}let ww;function eU(c,i){return i>0?i+2*c:c}const zde=Zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Fde=Zr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Bde=Zr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $de=Zr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),Vde=Zr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Ude=Zr([{name:"a_texb",components:2,type:"Uint16"}]),Gde=Zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),qde=Zr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Zr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tU=Zr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hde=Zr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zr([{name:"triangle",components:3,type:"Uint16"}]),Zr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Zr([{type:"Float32",name:"offsetX"}]),Zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var jo=24;function Wde(c,i,a){return c.sections.forEach(d=>{d.text=function(p,y,_){const b=y.layout.get("text-transform").evaluate(_,{});return b==="uppercase"?p=p.toLocaleUpperCase():b==="lowercase"&&(p=p.toLocaleLowerCase()),Hl.applyArabicShaping&&(p=Hl.applyArabicShaping(p)),p}(d.text,i,a)}),c}const Sw={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Zde(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}function Xde(c){return c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""||c===""}const CM=4294967296,rU=1/CM,nU=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let l2=class{constructor(c=new Uint8Array(16)){this.buf=ArrayBuffer.isView(c)?c:new Uint8Array(c),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(c,i,a=this.length){for(;this.pos<a;){const d=this.readVarint(),p=d>>3,y=this.pos;this.type=7&d,c(p,i,this),this.pos===y&&this.skip(d)}return i}readMessage(c,i){return this.readFields(c,i,this.readVarint()+this.pos)}readFixed32(){const c=this.dataView.getUint32(this.pos,!0);return this.pos+=4,c}readSFixed32(){const c=this.dataView.getInt32(this.pos,!0);return this.pos+=4,c}readFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*CM;return this.pos+=8,c}readSFixed64(){const c=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*CM;return this.pos+=8,c}readFloat(){const c=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,c}readDouble(){const c=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,c}readVarint(c){const i=this.buf;let a,d;return d=i[this.pos++],a=127&d,d<128?a:(d=i[this.pos++],a|=(127&d)<<7,d<128?a:(d=i[this.pos++],a|=(127&d)<<14,d<128?a:(d=i[this.pos++],a|=(127&d)<<21,d<128?a:(d=i[this.pos],a|=(15&d)<<28,function(p,y,_){const b=_.buf;let E,I;if(I=b[_.pos++],E=(112&I)>>4,I<128||(I=b[_.pos++],E|=(127&I)<<3,I<128)||(I=b[_.pos++],E|=(127&I)<<10,I<128)||(I=b[_.pos++],E|=(127&I)<<17,I<128)||(I=b[_.pos++],E|=(127&I)<<24,I<128)||(I=b[_.pos++],E|=(1&I)<<31,I<128))return z_(p,E,y);throw new Error("Expected varint not more than 10 bytes")}(a,c,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const c=this.readVarint();return c%2==1?(c+1)/-2:c/2}readBoolean(){return!!this.readVarint()}readString(){const c=this.readVarint()+this.pos,i=this.pos;return this.pos=c,c-i>=12&&nU?nU.decode(this.buf.subarray(i,c)):function(a,d,p){let y="",_=d;for(;_<p;){const b=a[_];let E,I,M,D=null,N=b>239?4:b>223?3:b>191?2:1;if(_+N>p)break;N===1?b<128&&(D=b):N===2?(E=a[_+1],(192&E)==128&&(D=(31&b)<<6|63&E,D<=127&&(D=null))):N===3?(E=a[_+1],I=a[_+2],(192&E)==128&&(192&I)==128&&(D=(15&b)<<12|(63&E)<<6|63&I,(D<=2047||D>=55296&&D<=57343)&&(D=null))):N===4&&(E=a[_+1],I=a[_+2],M=a[_+3],(192&E)==128&&(192&I)==128&&(192&M)==128&&(D=(15&b)<<18|(63&E)<<12|(63&I)<<6|63&M,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,N=1):D>65535&&(D-=65536,y+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),y+=String.fromCharCode(D),_+=N}return y}(this.buf,i,c)}readBytes(){const c=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,c);return this.pos=c,i}readPackedVarint(c=[],i){const a=this.readPackedEnd();for(;this.pos<a;)c.push(this.readVarint(i));return c}readPackedSVarint(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSVarint());return c}readPackedBoolean(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readBoolean());return c}readPackedFloat(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFloat());return c}readPackedDouble(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readDouble());return c}readPackedFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed32());return c}readPackedSFixed32(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed32());return c}readPackedFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readFixed64());return c}readPackedSFixed64(c=[]){const i=this.readPackedEnd();for(;this.pos<i;)c.push(this.readSFixed64());return c}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(c){const i=7&c;if(i===0)for(;this.buf[this.pos++]>127;);else if(i===2)this.pos=this.readVarint()+this.pos;else if(i===5)this.pos+=4;else{if(i!==1)throw new Error(`Unimplemented type: ${i}`);this.pos+=8}}writeTag(c,i){this.writeVarint(c<<3|i)}realloc(c){let i=this.length||16;for(;i<this.pos+c;)i*=2;if(i!==this.length){const a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=i}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeSFixed32(c){this.realloc(4),this.dataView.setInt32(this.pos,c,!0),this.pos+=4}writeFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*rU),!0),this.pos+=8}writeSFixed64(c){this.realloc(8),this.dataView.setInt32(this.pos,-1&c,!0),this.dataView.setInt32(this.pos+4,Math.floor(c*rU),!0),this.pos+=8}writeVarint(c){(c=+c||0)>268435455||c<0?function(i,a){let d,p;if(i>=0?(d=i%4294967296|0,p=i/4294967296|0):(d=~(-i%4294967296),p=~(-i/4294967296),4294967295^d?d=d+1|0:(d=0,p=p+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(y,_,b){b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,y>>>=7,b.buf[b.pos++]=127&y|128,b.buf[b.pos]=127&(y>>>=7)}(d,0,a),function(y,_){const b=(7&y)<<4;_.buf[_.pos++]|=b|((y>>>=3)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y|((y>>>=7)?128:0),y&&(_.buf[_.pos++]=127&y)))))}(p,a)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))}writeSVarint(c){this.writeVarint(c<0?2*-c-1:2*c)}writeBoolean(c){this.writeVarint(+c)}writeString(c){c=String(c),this.realloc(4*c.length),this.pos++;const i=this.pos;this.pos=function(d,p,y){for(let _,b,E=0;E<p.length;E++){if(_=p.charCodeAt(E),_>55295&&_<57344){if(!b){_>56319||E+1===p.length?(d[y++]=239,d[y++]=191,d[y++]=189):b=_;continue}if(_<56320){d[y++]=239,d[y++]=191,d[y++]=189,b=_;continue}_=b-55296<<10|_-56320|65536,b=null}else b&&(d[y++]=239,d[y++]=191,d[y++]=189,b=null);_<128?d[y++]=_:(_<2048?d[y++]=_>>6|192:(_<65536?d[y++]=_>>12|224:(d[y++]=_>>18|240,d[y++]=_>>12&63|128),d[y++]=_>>6&63|128),d[y++]=63&_|128)}return y}(this.buf,c,this.pos);const a=this.pos-i;a>=128&&iU(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeFloat(c){this.realloc(4),this.dataView.setFloat32(this.pos,c,!0),this.pos+=4}writeDouble(c){this.realloc(8),this.dataView.setFloat64(this.pos,c,!0),this.pos+=8}writeBytes(c){const i=c.length;this.writeVarint(i),this.realloc(i);for(let a=0;a<i;a++)this.buf[this.pos++]=c[a]}writeRawMessage(c,i){this.pos++;const a=this.pos;c(i,this);const d=this.pos-a;d>=128&&iU(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d}writeMessage(c,i,a){this.writeTag(c,2),this.writeRawMessage(i,a)}writePackedVarint(c,i){i.length&&this.writeMessage(c,Kde,i)}writePackedSVarint(c,i){i.length&&this.writeMessage(c,Yde,i)}writePackedBoolean(c,i){i.length&&this.writeMessage(c,ehe,i)}writePackedFloat(c,i){i.length&&this.writeMessage(c,Jde,i)}writePackedDouble(c,i){i.length&&this.writeMessage(c,Qde,i)}writePackedFixed32(c,i){i.length&&this.writeMessage(c,the,i)}writePackedSFixed32(c,i){i.length&&this.writeMessage(c,rhe,i)}writePackedFixed64(c,i){i.length&&this.writeMessage(c,nhe,i)}writePackedSFixed64(c,i){i.length&&this.writeMessage(c,ihe,i)}writeBytesField(c,i){this.writeTag(c,2),this.writeBytes(i)}writeFixed32Field(c,i){this.writeTag(c,5),this.writeFixed32(i)}writeSFixed32Field(c,i){this.writeTag(c,5),this.writeSFixed32(i)}writeFixed64Field(c,i){this.writeTag(c,1),this.writeFixed64(i)}writeSFixed64Field(c,i){this.writeTag(c,1),this.writeSFixed64(i)}writeVarintField(c,i){this.writeTag(c,0),this.writeVarint(i)}writeSVarintField(c,i){this.writeTag(c,0),this.writeSVarint(i)}writeStringField(c,i){this.writeTag(c,2),this.writeString(i)}writeFloatField(c,i){this.writeTag(c,5),this.writeFloat(i)}writeDoubleField(c,i){this.writeTag(c,1),this.writeDouble(i)}writeBooleanField(c,i){this.writeVarintField(c,+i)}};function z_(c,i,a){return a?4294967296*i+(c>>>0):4294967296*(i>>>0)+(c>>>0)}function iU(c,i,a){const d=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(d);for(let p=a.pos-1;p>=c;p--)a.buf[p+d]=a.buf[p]}function Kde(c,i){for(let a=0;a<c.length;a++)i.writeVarint(c[a])}function Yde(c,i){for(let a=0;a<c.length;a++)i.writeSVarint(c[a])}function Jde(c,i){for(let a=0;a<c.length;a++)i.writeFloat(c[a])}function Qde(c,i){for(let a=0;a<c.length;a++)i.writeDouble(c[a])}function ehe(c,i){for(let a=0;a<c.length;a++)i.writeBoolean(c[a])}function the(c,i){for(let a=0;a<c.length;a++)i.writeFixed32(c[a])}function rhe(c,i){for(let a=0;a<c.length;a++)i.writeSFixed32(c[a])}function nhe(c,i){for(let a=0;a<c.length;a++)i.writeFixed64(c[a])}function ihe(c,i){for(let a=0;a<c.length;a++)i.writeSFixed64(c[a])}function ohe(c,i,a){i.glyphs=[],c===1&&a.readMessage(she,i)}function she(c,i,a){if(c===3){const{id:d,bitmap:p,width:y,height:_,left:b,top:E,advance:I}=a.readMessage(ahe,{});i.glyphs.push({id:d,bitmap:new Gf({width:y+6,height:_+6},p),metrics:{width:y,height:_,left:b,top:E,advance:I}})}else c===4?i.ascender=a.readSVarint():c===5&&(i.descender=a.readSVarint())}function ahe(c,i,a){c===1?i.id=a.readVarint():c===2?i.bitmap=a.readBytes():c===3?i.width=a.readVarint():c===4?i.height=a.readVarint():c===5?i.left=a.readSVarint():c===6?i.top=a.readSVarint():c===7&&(i.advance=a.readVarint())}const ol={horizontal:1,vertical:2,horizontalOnly:3};class Tw{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(i,a){const d=new Tw;return d.scale=i||1,d.fontStack=a,d}static forImage(i){const a=new Tw;return a.image=i,a}}class F_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a,d){const p=new F_;for(let y=0;y<i.sections.length;y++){const _=i.sections[y];_.image?p.addImageSection(_,d):p.addTextSection(_,a)}return p}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCodePoint(i){return this.text.codePointAt(i)}verticalizePunctuation(i){this.text=function(a,d){let p="";for(let y=0;y<a.length;y++){const _=a.charCodeAt(y+1)||null,b=a.charCodeAt(y-1)||null;p+=!d&&(_&&kb(_)&&!Sw[a[y+1]]||b&&kb(b)&&!Sw[a[y-1]])||!Sw[a[y]]?a[y]:Sw[a[y]]}return p}(this.text,i)}trim(){let i=0;for(let d=0;d<this.text.length&&c2[this.text.charCodeAt(d)];d++)i++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=i&&c2[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const d=new F_;return d.text=this.text.substring(i,a),d.sectionIndex=this.sectionIndex.slice(i,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(Tw.forText(i.scale,i.fontStack||a));const d=this.sections.length-1;for(let p=0;p<i.text.length;++p)this.sectionIndex.push(d)}addImageSection(i,a){const d=i.image?i.image.getPrimary():null;if(!d)return void vr("Can't add FormattedSection with an empty image.");d.scaleSelf(a);const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCodePoint(p),this.sections.push(Tw.forImage(d)),this.sectionIndex.push(this.sections.length-1)):vr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function IM(c,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y=1){const re=F_.fromFeature(c,p,Y);D===ol.vertical&&re.verticalizePunctuation(N);let J=[];const oe=function(Te,Ae,Se,Oe,Me,st){if(!Te)return[];const et=[],it=function(pt,Ke,yt,ut,_t,gt){let Vt=0;for(let Ut=0;Ut<pt.length();Ut++){const kt=pt.getSection(Ut);Vt+=oU(pt.getCodePoint(Ut),kt,ut,_t,Ke,gt)}return Vt/Math.max(1,Math.ceil(Vt/yt))}(Te,Ae,Se,Oe,Me,st),mt=Te.text.indexOf("")>=0;let ft=0;for(let pt=0;pt<Te.length();pt++){const Ke=Te.getSection(pt),yt=Te.getCodePoint(pt);if(c2[yt]||(ft+=oU(yt,Ke,Oe,Me,Ae,st)),pt<Te.length()-1){const ut=iA(yt);(lhe[yt]||ut||Ke.image)&&et.push(aU(pt+1,ft,it,et,che(yt,Te.getCodePoint(pt+1),ut&&mt),!1))}}return lU(aU(Te.length(),ft,it,et,0,!0))}(re,I,y,i,d,V),{processBidirectionalText:le,processStyledBidirectionalText:de}=Hl;if(le&&re.sections.length===1){const Te=le(re.toString(),oe);for(const Ae of Te){const Se=new F_;Se.text=Ae,Se.sections=re.sections;for(let Oe=0;Oe<Ae.length;Oe++)Se.sectionIndex.push(0);J.push(Se)}}else if(de){const Te=de(re.text,re.sectionIndex,oe);for(const Ae of Te){const Se=new F_;Se.text=Ae[0],Se.sectionIndex=Ae[1],Se.sections=re.sections,J.push(Se)}}else J=function(Te,Ae){const Se=[],Oe=Te.text;let Me=0;for(const st of Ae)Se.push(Te.substring(Me,st)),Me=st;return Me<Oe.length&&Se.push(Te.substring(Me,Oe.length)),Se}(re,oe);const _e=[],ye={positionedLines:_e,text:re.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Te,Ae,Se,Oe,Me,st,et,it,mt,ft,pt,Ke){let yt=0,ut=0,_t=0;const gt=it==="right"?1:it==="left"?0:.5;let Vt=!1;for(const Jt of Me){const Ft=Jt.getSections();for(const br of Ft){if(br.image)continue;const Gr=Ae[br.fontStack];if(Gr&&(Vt=Gr.ascender!==void 0&&Gr.descender!==void 0,!Vt))break}if(!Vt)break}let Ut=0;for(const Jt of Me){Jt.trim();const Ft=Jt.getMaxScale(),br=(Ft-1)*jo,Gr={positionedGlyphs:[],lineOffset:0};Te.positionedLines[Ut]=Gr;const mn=Gr.positionedGlyphs;let $r=0;if(!Jt.length()){ut+=st,++Ut;continue}let Ln=0,sn=0;for(let un=0;un<Jt.length();un++){const On=Jt.getSection(un),li=Jt.getSectionIndex(un),gi=Jt.getCodePoint(un);let yi=On.scale,Li=null,Yo=null,_s=null,io=jo,_o=0,Io=mt;Io===ol.vertical&&oA(gi)&&(Io=ol.horizontal);const jr=!(Io===ol.horizontal||!pt&&!cd(gi)||pt&&(c2[gi]||y_(gi)));if(On.image){const _i=Oe.get(On.image.toString());if(!_i)continue;_s=On.image,Te.iconsInText=Te.iconsInText||!0,Yo=_i.paddedRect;const Si=_i.displaySize;yi=yi*jo/Ke,Li={width:Si[0],height:Si[1],left:0,top:-3,advance:jr?Si[1]:Si[0],localGlyph:!1},_o=Vt?-Li.height*yi:Ft*jo-17-Si[1]*yi,io=Li.advance;const sl=(jr?Si[0]:Si[1])*yi-jo*Ft;sl>0&&sl>$r&&($r=sl)}else{const _i=Se[On.fontStack];if(!_i)continue;_i[gi]&&(Yo=_i[gi]);const Si=Ae[On.fontStack];if(!Si)continue;const sl=Si.glyphs[gi];if(!sl)continue;if(Li=sl.metrics,io=gi!==8203?jo:0,Vt){const ea=Si.ascender!==void 0?Math.abs(Si.ascender):0,Jo=Si.descender!==void 0?Math.abs(Si.descender):0,ta=(ea+Jo)*yi;Ln<ta&&(Ln=ta,sn=(ea-Jo)/2*yi),_o=-ea*yi}else _o=(Ft-yi)*jo-17}jr?(Te.verticalizable=!0,mn.push({glyph:gi,image:_s,x:yt,y:ut+_o,vertical:jr,scale:yi,localGlyph:Li.localGlyph,fontStack:On.fontStack,sectionIndex:li,metrics:Li,rect:Yo}),yt+=io*yi+ft):(mn.push({glyph:gi,image:_s,x:yt,y:ut+_o,vertical:jr,scale:yi,localGlyph:Li.localGlyph,fontStack:On.fontStack,sectionIndex:li,metrics:Li,rect:Yo}),yt+=Li.advance*yi+ft)}mn.length!==0&&(_t=Math.max(yt-ft,_t),Vt?cU(mn,gt,$r,sn,st*Ft/2):cU(mn,gt,$r,0,st/2)),yt=0;const Di=st*Ft+$r;Gr.lineOffset=Math.max($r,br),ut+=Di,++Ut}const kt=ut,{horizontalAlign:Dt,verticalAlign:lr}=OM(et);(function(Jt,Ft,br,Gr,mn,$r){const Ln=(Ft-br)*mn,sn=-$r*Gr;for(const Di of Jt)for(const un of Di.positionedGlyphs)un.x+=Ln,un.y+=sn})(Te.positionedLines,gt,Dt,lr,_t,kt),Te.top+=-lr*kt,Te.bottom=Te.top+kt,Te.left+=-Dt*_t,Te.right=Te.left+_t,Te.hasBaseline=Vt}(ye,i,a,d,J,_,b,E,D,I,N,G),!function(Te){for(const Ae of Te)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(_e))return ye}const c2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lhe={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oU(c,i,a,d,p,y){if(i.image){const _=d.get(i.image.toString());return _?_.displaySize[0]*i.scale*jo/y+p:0}{const _=a[i.fontStack],b=_&&_.glyphs[c];return b?b.metrics.advance*i.scale+p:0}}function sU(c,i,a,d){const p=Math.pow(c-i,2);return d?c<i?p/2:2*p:p+Math.abs(a)*a}function che(c,i,a){let d=0;return c===10&&(d-=1e4),a&&(d+=150),c!==40&&c!==65288||(d+=50),i!==41&&i!==65289||(d+=50),d}function aU(c,i,a,d,p,y){let _=null,b=sU(i,a,p,y);for(const E of d){const I=sU(i-E.x,a,p,y)+E.badness;I<=b&&(_=E,b=I)}return{index:c,x:i,priorBreak:_,badness:b}}function lU(c){return c?lU(c.priorBreak).concat(c.index):[]}function OM(c){let i=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function cU(c,i,a,d,p){if(!(i||a||d||p))return;const y=c.length-1,_=c[y],b=(_.x+_.metrics.advance*_.scale)*i;for(let E=0;E<=y;E++)c[E].x-=b,c[E].y+=a+d+p}function kM(c){return c.imagePrimary!==void 0&&c.top!==void 0&&c.bottom!==void 0&&c.left!==void 0&&c.right!==void 0}function u2(c,i,a,d){const{horizontalAlign:p,verticalAlign:y}=OM(d),_=a[0]-c.displaySize[0]*p,b=a[1]-c.displaySize[1]*y;return{imagePrimary:c,imageSecondary:i,top:b,bottom:b+c.displaySize[1],left:_,right:_+c.displaySize[0]}}function RM(c,i,a,d,p,y){const _=c.imagePrimary;let b;if(_.content){const re=_.content,J=_.pixelRatio||1;b=[re[0]/J,re[1]/J,_.displaySize[0]-re[2]/J,_.displaySize[1]-re[3]/J]}const E=i.left*y,I=i.right*y;let M,D,N,V;a==="width"||a==="both"?(V=p[0]+E-d[3],D=p[0]+I+d[1]):(V=p[0]+(E+I-_.displaySize[0])/2,D=V+_.displaySize[0]);const G=i.top*y,Y=i.bottom*y;return a==="height"||a==="both"?(M=p[1]+G-d[0],N=p[1]+Y+d[2]):(M=p[1]+(G+Y-_.displaySize[1])/2,N=M+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:M,right:D,bottom:N,left:V,collisionPadding:b}}function uU(c){return!c.imagePrimary.stretchX}function dU(c){return!c.imagePrimary.stretchY}function hU(c){return{width:c.right-c.left,height:c.bottom-c.top}}const yh=128;function ig(c,i,a,d){const{expression:p}=i;if(p.kind==="constant")return{kind:"constant",layoutSize:p.evaluate(new Dn(c+1,{worldview:a}),void 0,void 0,void 0,d)};if(p.kind==="source")return{kind:"source"};{const{zoomStops:y,interpolationType:_}=p;let b=0;for(;b<y.length&&y[b]<=c;)b++;b=Math.max(0,b-1);let E=b;for(;E<y.length&&y[E]<c+1;)E++;E=Math.min(y.length-1,E);const I=y[b],M=y[E];return p.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:M,interpolationType:_}:{kind:"camera",minZoom:I,maxZoom:M,minSize:p.evaluate(new Dn(I,{worldview:a}),void 0,void 0,void 0,d),maxSize:p.evaluate(new Dn(M,{worldview:a}),void 0,void 0,void 0,d),interpolationType:_}}}function MM(c,{uSize:i,uSizeT:a},{lowerSize:d,upperSize:p}){return c.kind==="source"?d/yh:c.kind==="composite"?mr(d/yh,p/yh,a):i}function B_(c,i,a=1){let d=0,p=0;if(c.kind==="constant")p=c.layoutSize*a;else if(c.kind!=="source"){const{interpolationType:y,minZoom:_,maxZoom:b}=c,E=y?we(Ja.interpolationFactor(y,i,_,b),0,1):0;c.kind==="camera"?p=mr(c.minSize,c.maxSize,E)*a:d=E*a}return{uSizeT:d,uSize:p}}class _h extends wt{constructor(i,a,d,p,y){super(i,a),this.angle=p,this.z=d,y!==void 0&&(this.segment=y)}clone(){return new _h(this.x,this.y,this.z,this.angle,this.segment)}}function fU(c,i,a,d,p){if(i.segment===void 0)return!0;let y=i,_=i.segment+1,b=0;for(;b>-a/2;){if(_--,_<0)return!1;b-=c[_].dist(y),y=c[_]}b+=c[_].dist(c[_+1]),_++;const E=[];let I=0;for(;b<a/2;){const M=c[_],D=c[_+1];if(!D)return!1;let N=c[_-1].angleTo(M)-M.angleTo(D);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:N}),I+=N;b-E[0].distance>d;)I-=E.shift().angleDelta;if(I>p)return!1;_++,b+=M.dist(D)}return!0}function pU(c){let i=0;for(let a=0;a<c.length-1;a++)i+=c[a].dist(c[a+1]);return i}function mU(c,i,a){return c?.6*i*a:0}function gU(c,i){return Math.max(c?c.right-c.left:0,i?i.right-i.left:0)}function uhe(c,i,a,d,p,y){const _=mU(a,p,y),b=gU(a,d)*y;let E=0;const I=pU(c)/2;for(let M=0;M<c.length-1;M++){const D=c[M],N=c[M+1],V=D.dist(N);if(E+V>I){const G=(I-E)/V,Y=mr(D.x,N.x,G),re=mr(D.y,N.y,G),J=new _h(Y,re,0,N.angleTo(D),M);return!_||fU(c,J,b,_,i)?J:void 0}E+=V}}function dhe(c,i,a,d,p,y,_,b,E){const I=mU(d,y,_),M=gU(d,p),D=M*_,N=c[0].x===0||c[0].x===E||c[0].y===0||c[0].y===E;return i-D<i/4&&(i=D+i/4),yU(c,N?i/2*b%i:(M/2+2*y)*_*b%i,i,I,a,D,N,!1,E)}function yU(c,i,a,d,p,y,_,b,E){const I=y/2,M=pU(c);let D=0,N=i-a,V=[];for(let G=0;G<c.length-1;G++){const Y=c[G],re=c[G+1],J=Y.dist(re),oe=re.angleTo(Y);for(;N+a<D+J;){N+=a;const le=(N-D)/J,de=mr(Y.x,re.x,le),_e=mr(Y.y,re.y,le);if(de>=0&&de<E&&_e>=0&&_e<E&&N-I>=0&&N+I<=M){const ye=new _h(de,_e,0,oe,G);d&&!fU(c,ye,y,d,p)||V.push(ye)}}D+=J}return b||V.length||_||(V=yU(c,D/2,a,d,p,y,_,!0,E)),V}function _U(c){let i=0,a=0;for(const _ of c)i+=_.w*_.h,a=Math.max(a,_.w);c.sort((_,b)=>b.h-_.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let p=0,y=0;for(const _ of c)for(let b=d.length-1;b>=0;b--){const E=d[b];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,y=Math.max(y,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===E.w&&_.h===E.h){const I=d.pop();I&&b<d.length&&(d[b]=I)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(d.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:p,h:y,fill:i/(p*y)||0}}Wt(_h,"Anchor");class Ew{static getImagePositionScale(i,a,d){if(a&&i){const{sx:p,sy:y}=i;return{x:p,y}}return{x:d,y:d}}constructor(i,a,d,p){this.paddedRect=i;const{pixelRatio:y,version:_,stretchX:b,stretchY:E,content:I,sdf:M,usvg:D}=a;this.pixelRatio=y,this.stretchX=b,this.stretchY=E,this.content=I,this.version=_,this.padding=d,this.sdf=M,this.usvg=D,this.scale=Ew.getImagePositionScale(p,D,y)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function DM(c,i,a){const d=ha.parse(c),p=function(y,_,b=[1,1]){return{x:0,y:0,w:(y.data?y.data.width:y.width*b[0])+2*_,h:(y.data?y.data.height:y.height*b[1])+2*_}}(i,a,[d.sx,d.sy]);return{bin:p,imagePosition:new Ew(p,i,a,d),imageVariant:d}}class vU{constructor(i,a,d){const p=new Map,y=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(i,p,1,_),this.addImages(a,y,2,_);const{w:b,h:E}=_U(_),I=new ys({width:b||1,height:E||1});for(const[M,D]of i.entries()){const N=p.get(M).paddedRect;ys.copy(D.data,I,{x:0,y:0},{x:N.x+1,y:N.y+1},D.data,null,D.sdf)}for(const[M,D]of a.entries()){const N=y.get(M),V=N.paddedRect;let G=N.padding;const Y=V.x+G,re=V.y+G,J=D.data.width,oe=D.data.height;G=G>1?G-1:G,ys.copy(D.data,I,{x:0,y:0},{x:Y,y:re},D.data,d),ys.copy(D.data,I,{x:0,y:oe-G},{x:Y,y:re-G},{width:J,height:G},d),ys.copy(D.data,I,{x:0,y:0},{x:Y,y:re+oe},{width:J,height:G},d),ys.copy(D.data,I,{x:J-G,y:0},{x:Y-G,y:re},{width:G,height:oe},d),ys.copy(D.data,I,{x:0,y:0},{x:Y+J,y:re},{width:G,height:oe},d),ys.copy(D.data,I,{x:J-G,y:oe-G},{x:Y-G,y:re-G},{width:G,height:G},d),ys.copy(D.data,I,{x:0,y:oe-G},{x:Y+J,y:re-G},{width:G,height:G},d),ys.copy(D.data,I,{x:0,y:0},{x:Y+J,y:re+oe},{width:G,height:G},d),ys.copy(D.data,I,{x:J-G,y:0},{x:Y-G,y:re+oe},{width:G,height:G},d)}this.lut=d,this.image=I,this.iconPositions=p,this.patternPositions=y}addImages(i,a,d,p){for(const[y,_]of i.entries()){const{bin:b,imagePosition:E,imageVariant:I}=DM(y,_,d);a.set(y,E),p.push(b),_.hasRenderCallback&&this.haveRenderCallbacks.push(I.id)}}patchUpdatedImages(i,a,d){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(p=>i.hasImage(p,d)),i.dispatchRenderCallbacks(this.haveRenderCallbacks,d);for(const p of i.getUpdatedImages(d)){for(const y of this.iconPositions.keys()){const _=ha.parse(y);if(ua.isEqual(_.id,p)){const b=i.getImage(p,d);this.patchUpdatedImage(this.iconPositions.get(y),b,a,null)}}for(const y of this.patternPositions.keys()){const _=ha.parse(y);if(ua.isEqual(_.id,p)){const b=i.getImage(p,d);this.patchUpdatedImage(this.patternPositions.get(y),b,a,this.lut)}}}}patchUpdatedImage(i,a,d,p=null){if(!i||!a||i.version===a.version)return;i.version=a.version;const[y,_]=i.tl,b=i.sdf;if(this.lut||b){const E={width:a.data.width,height:a.data.height},I=new ys(E);ys.copy(a.data,I,{x:0,y:0},{x:0,y:0},E,p,b),d.update(I,{position:{x:y,y:_}})}else d.update(a.data,{position:{x:y,y:_}})}}Wt(Ew,"ImagePosition"),Wt(vU,"ImageAtlas");const Aw=1e20;function xU(c,i,a,d,p,y,_,b,E){for(let I=i;I<i+d;I++)bU(c,a*y+I,y,p,_,b,E);for(let I=a;I<a+p;I++)bU(c,I*y+i,1,d,_,b,E)}function bU(c,i,a,d,p,y,_){y[0]=0,_[0]=-Aw,_[1]=Aw,p[0]=c[i];for(let b=1,E=0,I=0;b<d;b++){p[b]=c[i+b*a];const M=b*b;do{const D=y[E];I=(p[b]-p[D]+M-D*D)/(b-D)/2}while(I<=_[E]&&--E>-1);E++,y[E]=b,_[E]=I,_[E+1]=Aw}for(let b=0,E=0;b<d;b++){for(;_[E+1]<b;)E++;const I=y[E],M=b-I;c[i+b*a]=p[I]+M*M}}const LM={none:0,ideographs:1,all:2};class $_{constructor(i,a,d){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=d,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const d=[],p=this.url||po.GLYPHS_URL;for(const y in i)for(const _ of i[y])d.push({stack:y,id:_});ze(d,({stack:y,id:_},b)=>{let E=this.entries[y];E||(E=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=E.glyphs[_];if(I!==void 0)return void b(null,{stack:y,id:_,glyph:I});if(I=this._tinySDF(E,y,_),I)return E.glyphs[_]=I,void b(null,{stack:y,id:_,glyph:I});const M=Math.floor(_/256);if(256*M>65535)return vr("glyphs > 65535 not supported"),void b(null,{stack:y,id:_,glyph:I});if(E.ranges[M])return void b(null,{stack:y,id:_,glyph:I});let D=E.requests[M];D||(D=E.requests[M]=[],$_.loadGlyphRange(y,M,p,this.requestManager,(N,V)=>{if(V){E.ascender=V.ascender,E.descender=V.descender;for(const G in V.glyphs)this._doesCharSupportLocalGlyph(+G)||(E.glyphs[+G]=V.glyphs[+G]);E.ranges[M]=!0}for(const G of D)G(N,V);delete E.requests[M]})),D.push((N,V)=>{N?b(N):V&&b(null,{stack:y,id:_,glyph:V.glyphs[_]||null})})},(y,_)=>{if(y)a(y);else if(_){const b={};for(const{stack:E,id:I,glyph:M}of _)b[E]===void 0&&(b[E]={}),b[E].glyphs===void 0&&(b[E].glyphs={}),b[E].glyphs[I]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;a(null,b)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==LM.none&&(this.localGlyphMode===LM.all?!!this.localFontFamily:!!this.localFontFamily&&(m_(i)||eA(i)||kf(i)||jm(i)||Of(i)||Rf(i)||(a=i)>=131072&&a<=173791||(d=>d>=66736&&d<=66815)(i)));var a}_tinySDF(i,a,d){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(d))return;let y=i.tinySDF;if(!y){let Y="400";/bold/i.test(a)?Y="900":/medium/i.test(a)?Y="500":/light/i.test(a)&&(Y="200"),y=i.tinySDF=new $_.TinySDF({fontFamily:p,fontWeight:Y,fontSize:48,buffer:6,radius:16}),y.fontWeight=Y}if(this.localGlyphs[y.fontWeight][d])return this.localGlyphs[y.fontWeight][d];const _=String.fromCodePoint(d),{data:b,width:E,height:I,glyphWidth:M,glyphHeight:D,glyphLeft:N,glyphTop:V,glyphAdvance:G}=y.draw(_);return this.localGlyphs[y.fontWeight][d]={id:d,bitmap:new Gf({width:E,height:I},b),metrics:{width:M/2,height:D/2,left:N/2,top:V/2-27,advance:G/2,localGlyph:!0}}}}function wU(c,i){return c+i[1]-i[0]}function jM(c,i,a,d,p=1){const y=[],_=c.imagePrimary,b=_.pixelRatio,E=_.paddedRect.w-2,I=_.paddedRect.h-2,M=(c.right-c.left)*p,D=(c.bottom-c.top)*p,N=_.stretchX||[[0,E]],V=_.stretchY||[[0,I]],G=N.reduce(wU,0),Y=V.reduce(wU,0),re=E-G,J=I-Y;let oe=0,le=G,de=0,_e=Y,ye=0,Te=re,Ae=0,Se=J;if(_.content&&d){const Me=_.content;oe=d2(N,0,Me[0]),de=d2(V,0,Me[1]),le=d2(N,Me[0],Me[2]),_e=d2(V,Me[1],Me[3]),ye=Me[0]-oe,Ae=Me[1]-de,Te=Me[2]-Me[0]-le,Se=Me[3]-Me[1]-_e}const Oe=(Me,st,et,it)=>{const mt=h2(Me.stretch-oe,le,M,c.left*p),ft=f2(Me.fixed-ye,Te,Me.stretch,G),pt=h2(st.stretch-de,_e,D,c.top*p),Ke=f2(st.fixed-Ae,Se,st.stretch,Y),yt=h2(et.stretch-oe,le,M,c.left*p),ut=f2(et.fixed-ye,Te,et.stretch,G),_t=h2(it.stretch-de,_e,D,c.top*p),gt=f2(it.fixed-Ae,Se,it.stretch,Y),Vt=new wt(mt,pt),Ut=new wt(yt,pt),kt=new wt(yt,_t),Dt=new wt(mt,_t),lr=new wt(ft/b,Ke/b),Jt=new wt(ut/b,gt/b),Ft=i*Math.PI/180;if(Ft){const sn=Math.sin(Ft),Di=Math.cos(Ft),un=[Di,-sn,sn,Di];Vt._matMult(un),Ut._matMult(un),Dt._matMult(un),kt._matMult(un)}const br=Me.stretch+Me.fixed,Gr=et.stretch+et.fixed,mn=st.stretch+st.fixed,$r=it.stretch+it.fixed,Ln=c.imageSecondary;return{tl:Vt,tr:Ut,bl:Dt,br:kt,texPrimary:{x:_.paddedRect.x+1+br,y:_.paddedRect.y+1+mn,w:Gr-br,h:$r-mn},texSecondary:Ln?{x:Ln.paddedRect.x+1+br,y:Ln.paddedRect.y+1+mn,w:Gr-br,h:$r-mn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:lr,pixelOffsetBR:Jt,minFontScaleX:Te/b/M,minFontScaleY:Se/b/D,isSDF:a}};if(_.stretchX||_.stretchY){const Me=SU(N,re,G),st=SU(V,J,Y);for(let et=0;et<Me.length-1;et++){const it=Me[et],mt=Me[et+1];for(let ft=0;ft<st.length-1;ft++)y.push(Oe(it,st[ft],mt,st[ft+1]))}}else y.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return y}function hhe(c,i){const a=c.stretchY||[[0,c.paddedRect.h-2]];return c.stretchX||c.stretchY?TU(c.stretchX||[[0,c.paddedRect.w-2]])*TU(a):1}function d2(c,i,a){let d=0;for(const p of c)d+=Math.max(i,Math.min(a,p[1]))-Math.max(i,Math.min(a,p[0]));return d}function SU(c,i,a){const d=[{fixed:-1,stretch:0}];for(const[p,y]of c){const _=d[d.length-1];d.push({fixed:p-_.stretch,stretch:_.stretch}),d.push({fixed:p-_.stretch,stretch:_.stretch+(y-p)})}return d.push({fixed:i+1,stretch:a}),d}function TU(c){return 2*c.length+1}function h2(c,i,a,d){return c/i*a+d}function f2(c,i,a,d){return c-i*a/d}function fhe(c,i,a,d){const p=i+c.positionedLines[d].lineOffset;return d===0?a+p/2:a+(p+(i+c.positionedLines[d-1].lineOffset))/2}function EU(c,i,a,d,p,y,_,b,E){const I=[];if(i.positionedLines.length===0)return I;const M=(E!==void 0?E:d.layout.get("text-rotate").evaluate(y,{}))*Math.PI/180,D=function(re){const J=re[0],oe=re[1],le=J*oe;return le>0?[J,-oe]:le<0?[-J,oe]:J===0?[oe,J]:[oe,-J]}(a);let N=Math.abs(i.top-i.bottom);for(const re of i.positionedLines)N-=re.lineOffset;const V=i.positionedLines.length,G=N/V;let Y=i.top-a[1];for(let re=0;re<V;++re){const J=i.positionedLines[re];Y=fhe(i,G,Y,re);for(const oe of J.positionedGlyphs){if(!oe.rect)continue;const le=oe.rect||{};let de=4,_e=!0,ye=1,Te=0;if(oe.image){const Ut=_.get(oe.image.toString());if(!Ut)continue;if(Ut.sdf){vr("SDF images are not supported in formatted text and will be ignored.");continue}_e=!1,ye=Ut.pixelRatio,de=1/ye}const Ae=(p||b)&&oe.vertical,Se=oe.metrics.advance*oe.scale/2,Oe=oe.metrics,Me=oe.rect;if(Me===null)continue;b&&i.verticalizable&&(Te=oe.image?Se-oe.metrics.width*oe.scale/2:0);const st=p?[oe.x+Se,oe.y]:[0,0];let et=[0,0],it=[0,0],mt=!1;p||(Ae?(it=[oe.x+Se+D[0],oe.y+D[1]-Te],mt=!0):et=[oe.x+Se+a[0],oe.y+a[1]-Te]);const ft=Me.w*oe.scale/(ye*(oe.localGlyph?2:1)),pt=Me.h*oe.scale/(ye*(oe.localGlyph?2:1));let Ke,yt,ut,_t;if(Ae){const Ut=oe.y-Y,kt=new wt(-Se,Se-Ut),Dt=-Math.PI/2,lr=new wt(...it);Ke=new wt(-Se+et[0],et[1]),Ke._rotateAround(Dt,kt)._add(lr),Ke.x+=-Ut+Se,Ke.y-=(Oe.left-de)*oe.scale;const Jt=oe.image?Oe.advance*oe.scale:jo*oe.scale,Ft=String.fromCodePoint(oe.glyph);Zde(Ft)?Ke.x+=(1-de)*oe.scale:Xde(Ft)?Ke.x+=Jt-Oe.height*oe.scale+(-de-1)*oe.scale:Ke.x+=oe.image||Oe.width+2*de===Me.w&&Oe.height+2*de===Me.h?(Jt-pt)/2:(Jt-(Oe.height+2*de)*oe.scale)/2,yt=new wt(Ke.x,Ke.y-ft),ut=new wt(Ke.x+pt,Ke.y),_t=new wt(Ke.x+pt,Ke.y-ft)}else{const Ut=(Oe.left-de)*oe.scale-Se+et[0],kt=(-Oe.top-de)*oe.scale+et[1],Dt=Ut+ft,lr=kt+pt;Ke=new wt(Ut,kt),yt=new wt(Dt,kt),ut=new wt(Ut,lr),_t=new wt(Dt,lr)}if(M){let Ut;Ut=p?new wt(0,0):mt?new wt(D[0],D[1]):new wt(a[0],a[1]),Ke._rotateAround(M,Ut),yt._rotateAround(M,Ut),ut._rotateAround(M,Ut),_t._rotateAround(M,Ut)}const gt=new wt(0,0),Vt=new wt(0,0);I.push({tl:Ke,tr:yt,bl:ut,br:_t,texPrimary:le,texSecondary:void 0,writingMode:i.writingMode,glyphOffset:st,sectionIndex:oe.sectionIndex,isSDF:_e,pixelOffsetTL:gt,pixelOffsetBR:Vt,minFontScaleX:0,minFontScaleY:0})}}return I}function phe(c,i=1,a=!1){let d=1/0,p=1/0,y=-1/0,_=-1/0;const b=c[0];for(let V=0;V<b.length;V++){const G=b[V];(!V||G.x<d)&&(d=G.x),(!V||G.y<p)&&(p=G.y),(!V||G.x>y)&&(y=G.x),(!V||G.y>_)&&(_=G.y)}const E=Math.min(y-d,_-p);let I=E/2;const M=new Tm([],mhe);if(E===0)return new wt(d,p);for(let V=d;V<y;V+=E)for(let G=p;G<_;G+=E)M.push(new V_(V+I,G+I,I,c));let D=function(V){let G=0,Y=0,re=0;const J=V[0];for(let oe=0,le=J.length,de=le-1;oe<le;de=oe++){const _e=J[oe],ye=J[de],Te=_e.x*ye.y-ye.x*_e.y;Y+=(_e.x+ye.x)*Te,re+=(_e.y+ye.y)*Te,G+=3*Te}return new V_(Y/G,re/G,0,V)}(c),N=M.length;for(;M.length;){const V=M.pop();(V.d>D.d||!D.d)&&(D=V,a&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,N)),V.max-D.d<=i||(I=V.h/2,M.push(new V_(V.p.x-I,V.p.y-I,I,c)),M.push(new V_(V.p.x+I,V.p.y-I,I,c)),M.push(new V_(V.p.x-I,V.p.y+I,I,c)),M.push(new V_(V.p.x+I,V.p.y+I,I,c)),N+=4)}return a&&(console.log(`num probes: ${N}`),console.log(`best distance: ${D.d}`)),D.p}function mhe(c,i){return i.max-c.max}$_.loadGlyphRange=function(c,i,a,d,p){const y=256*i,_=y+255,b=d.transformRequest(d.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${y}-${_}`),ca.Glyphs);pm(b,(E,I)=>{if(E)p(E);else if(I){const M={},D=function(N){return new l2(N).readFields(ohe,{})}(I);for(const N of D.glyphs)M[N.id]=N;p(null,{glyphs:M,ascender:D.ascender,descender:D.descender})}})},$_.TinySDF=class{constructor({fontSize:c=24,buffer:i=3,radius:a=8,cutoff:d=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:_="normal",lang:b=null}={}){this.buffer=i,this.cutoff=d,this.radius=a,this.lang=b;const E=this.size=c+4*i,I=this._createCanvas(E),M=this.ctx=I.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${y} ${c}px ${p}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(c){const i=document.createElement("canvas");return i.width=i.height=c,i}draw(c){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:d,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(c),_=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-p))),E=Math.min(this.size-this.buffer,_+Math.ceil(d)),I=b+2*this.buffer,M=E+2*this.buffer,D=Math.max(I*M,0),N=new Uint8ClampedArray(D),V={data:N,width:I,height:M,glyphWidth:b,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:i};if(b===0||E===0)return V;const{ctx:G,buffer:Y,gridInner:re,gridOuter:J}=this;this.lang&&(G.lang=this.lang),G.clearRect(Y,Y,b,E),G.fillText(c,Y,Y+_);const oe=G.getImageData(Y,Y,b,E);J.fill(Aw,0,D),re.fill(0,0,D);for(let le=0;le<E;le++)for(let de=0;de<b;de++){const _e=oe.data[4*(le*b+de)+3]/255;if(_e===0)continue;const ye=(le+Y)*I+de+Y;if(_e===1)J[ye]=0,re[ye]=Aw;else{const Te=.5-_e;J[ye]=Te>0?Te*Te:0,re[ye]=Te<0?Te*Te:0}}xU(J,0,0,I,M,I,this.f,this.v,this.z),xU(re,Y,Y,b,E,I,this.f,this.v,this.z);for(let le=0;le<D;le++){const de=Math.sqrt(J[le])-Math.sqrt(re[le]);N[le]=Math.round(255-255*(de/this.radius+this.cutoff))}return V}};class V_{constructor(i,a,d,p){this.p=new wt(i,a),this.h=d,this.d=function(y,_){let b=!1,E=1/0;for(let I=0;I<_.length;I++){const M=_[I];for(let D=0,N=M.length,V=N-1;D<N;V=D++){const G=M[D],Y=M[V];G.y>y.y!=Y.y>y.y&&y.x<(Y.x-G.x)*(y.y-G.y)/(Y.y-G.y)+G.x&&(b=!b),E=Math.min(E,$f(y,G,Y))}}return(b?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}}const ghe=Object.keys,NM=Number.POSITIVE_INFINITY,yhe=Math.sqrt(2);function Zf(c,i,a,d,p){const y=kM(c)&&c.collisionPadding?c.collisionPadding:[0,0,0,0],_={top:c.top-y[1],bottom:c.bottom+y[3],left:c.left-y[0],right:c.right+y[2],scaled:!1};return d!==void 0&&function(b,E){b.top*=E,b.bottom*=E,b.left*=E,b.right*=E,b.scaled=!0}(_,d),a&&function(b,E){if(!E)return;const I=an(E),M=new wt(b.left,b.top),D=new wt(b.right,b.top),N=new wt(b.left,b.bottom),V=new wt(b.right,b.bottom),G=new wt(0,0);M._rotateAround(I,G),D._rotateAround(I,G),N._rotateAround(I,G),V._rotateAround(I,G),b.left=Math.min(M.x,D.x,N.x,V.x),b.right=Math.max(M.x,D.x,N.x,V.x),b.top=Math.min(M.y,D.y,N.y,V.y),b.bottom=Math.max(M.y,D.y,N.y,V.y)}(_,a),p&&(_.left+=p[0],_.right+=p[0],_.top+=p[1],_.bottom+=p[1]),i?{top:Math.min(i.top,_.top),bottom:Math.max(i.bottom,_.bottom),left:Math.min(i.left,_.left),right:Math.max(i.right,_.right),scaled:i.scaled||_.scaled}:_}function AU(c,[i,a]){let d=0,p=0;if(a===NM){i<0&&(i=0);const y=i/yhe;switch(c){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-i;break;case"top":p=i-7}switch(c){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=i;break;case"right":d=-i}}else{switch(i=Math.abs(i),a=Math.abs(a),c){case"top-right":case"top-left":case"top":p=a-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-a}switch(c){case"top-right":case"bottom-right":case"right":d=-i;break;case"top-left":case"bottom-left":case"left":d=i}}return[d,p]}function _he(c,i,a,d,p,y,_,b,E,I,M,D,N,V,G){const Y=c.layers[0],re=Y.appearances;if(re.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const J={iconBBox:null,iconVerticalBBox:null},oe={textBBox:null,textVerticalBBox:null},{baseIconRotate:le,baseTextRotate:de,iconScaleFactor:_e}=function(Te,Ae,Se){const Oe=Te.get("icon-rotate").evaluate(Ae,{},Se),Me=Te.get("text-rotate").evaluate(Ae,{},Se),[st,et]=Te.get("icon-size-scale-range");return{baseIconRotate:Oe,baseTextRotate:Me,iconScaleFactor:we(1,st,et)}}(d,p,y);i&&(J.iconBBox=Zf(i,J.iconBBox,le,_),a)&&(J.iconVerticalBBox=Zf(a,J.iconVerticalBBox,le+90,_));const ye=m2(D.horizontal);ye&&(oe.textBBox=Zf(ye,oe.textBBox,de,1,V)),D.vertical&&(oe.textVerticalBBox=Zf(D.vertical,oe.textVerticalBBox,de+90,1,V));for(const Te of re)Te.hasIconProperties()&&vhe(J,c,Y,Te,p,y,b,le,_,E,i,I,_e,M,G),Te.hasTextProperties()&&xhe(oe,Y,Te,p,y,V,de,N,ye,D.vertical);return{iconBBox:J.iconBBox,iconVerticalBBox:J.iconVerticalBBox,textBBox:oe.textBBox,textVerticalBBox:oe.textVerticalBBox}}function vhe(c,i,a,d,p,y,_,b,E,I,M,D,N,V,G){const{appearanceIconOffset:Y,appearanceIconRotate:re,appearanceIconSize:J}=PU(d,a,p,y,_,b,E,I.iconScaleFactor);let oe=null,le=null,de=null;d.hasProperty("icon-image")?de=function(_e,ye,Te,Ae,Se,Oe,Me,st){let et=null;const it=ye.getAppearanceValueAndResolveTokens(Te,"icon-image",Ae,Se,st);if(it){const mt=_e.getResolvedImageFromTokens(it),ft=Te.getUnevaluatedProperty("icon-size"),pt=Pw(mt,ig(_e.zoom,ft,_e.worldview,st),ft,Se,_e.zoom,Ae,_e.pixelRatio,Me,_e.worldview,st);et=Oe.get(pt.iconPrimary.toString())}return et}(i,a,d,p,y,D,N,G):M&&(de=M.imagePrimary),de&&(oe=u2(de,null,Y,V),i.allowVerticalPlacement&&(le=u2(de,null,Y,V))),oe&&(c.iconBBox=Zf(oe,c.iconBBox,re,J)),le&&(c.iconVerticalBBox=Zf(le,c.iconVerticalBBox,re+90,J))}function PU(c,i,a,d,p,y,_,b){const E=c.hasProperty("icon-offset")?i.getAppearanceValueAndResolveTokens(c,"icon-offset",a,d,[]):null,I=E&&Array.isArray(E)?E:p,M=c.hasProperty("icon-rotate")?i.getAppearanceValueAndResolveTokens(c,"icon-rotate",a,d,[]):null,D=typeof M=="number"?M:y,N=c.hasProperty("icon-size")?i.getAppearanceValueAndResolveTokens(c,"icon-size",a,d,[]):null;return{appearanceIconOffset:I,appearanceIconRotate:D,appearanceIconSize:typeof N=="number"?N*b:_}}function xhe(c,i,a,d,p,y,_,b,E,I){const{appearanceTextOffset:M,appearanceTextRotate:D,appearanceTextSize:N}=CU(a,i,d,p,y,_,b),V=N/b;E&&(c.textBBox=Zf(E,c.textBBox,D,V,M)),I&&(c.textVerticalBBox=Zf(I,c.textVerticalBBox,D+90,V,M))}function CU(c,i,a,d,p,y,_){const b=c.hasProperty("text-offset")?i.getAppearanceValueAndResolveTokens(c,"text-offset",a,d,[]):null,E=b&&Array.isArray(b)?[b[0]*jo,b[1]*jo]:p,I=c.hasProperty("text-rotate")?i.getAppearanceValueAndResolveTokens(c,"text-rotate",a,d,[]):null,M=typeof I=="number"?I:y,D=c.hasProperty("text-size")?i.getAppearanceValueAndResolveTokens(c,"text-size",a,d,[]):null;return{appearanceTextOffset:E,appearanceTextRotate:M,appearanceTextSize:typeof D=="number"?D:_}}function p2(c,i,a,d,p,y,_,b,E){if(!i||!i.usvg)return;const I=hU(d),M=hU(p),D=y!=="both"&&y!=="width"||!uU(d)?1:M.width/I.width,N=y!=="both"&&y!=="height"||!dU(d)?1:M.height/I.height;a.scaleSelf(D,N);const V=a.toString();_.set(V,a),b.set(V,i);const{imagePosition:G}=DM(V,i,1);E.set(V,G)}function IU(c,i,a,d,p,y,_,b,E,I){if(!c)return;const M=function(D,N,V,G,Y,re,J){if(D.kind==="camera")return D.maxSize;if(D.kind==="composite"){const oe=N.possiblyEvaluate(new Dn(D.maxZoom,{worldview:re}),V,J).evaluate(Y,{},V,J),le=N.possiblyEvaluate(new Dn(D.minZoom,{worldview:re}),V,J).evaluate(Y,{},V,J);return Math.max(oe,le)}return N.possiblyEvaluate(new Dn(G,{worldview:re}),V,J).evaluate(Y,{},V,J)}(i,a,d,p,y,E,I);return c.scaleSelf(M*b*_)}function Pw(c,i,a,d,p,y,_,b,E,I){return{iconPrimary:IU(c.getPrimary(),i,a,d,p,y,_,b,E,I),iconSecondary:IU(c.getSecondary(),i,a,d,p,y,_,b,E,I)}}function bhe(c,i,a){if(!i)return;const d=a.get(c.toString()),p=a.get(i.toString());d&&p&&(d.paddedRect.w===p.paddedRect.w&&d.paddedRect.h===p.paddedRect.h||vr(`Mismatch in icon variant sizes: ${c.toString()} and ${i.toString()}`),d.usvg!==p.usvg&&vr(`Mismatch in icon variant image types: ${c.id} and ${i.id}`))}function OU(c,i,a,d){if(!c)return;const p=i.get(a.toString());if(c.imagePrimary=p,d){const y=i.get(d.toString());c.imageSecondary=y}}function whe(c,i){for(const a in c.horizontal)kU(c.horizontal[a],i);kU(c.vertical,i)}function kU(c,i){if(c){for(const a of c.positionedLines)for(const d of a.positionedGlyphs)if(d.image!==null){const p=d.image.toString();d.rect=i.get(p).paddedRect}}}function zM(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function She(c,i,a,d,p,y,_,b,E){const I=m2(y.horizontal)||y.vertical,M=a.get("icon-text-fit-padding").evaluate(d,{},p);let D,N=i;return i&&E!=="none"&&(c.allowVerticalPlacement&&y.vertical&&(D=RM(i,y.vertical,E,M,b,_)),I&&(N=RM(i,I,E,M,b,_))),{defaultShapedIcon:N,verticallyShapedIcon:D}}function RU(c,i){return c*i/24}function The(c,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe,le,de,_e,ye,Te){let Ae=_.textMaxSize.evaluate(i,{},N);Ae===void 0?Ae=b*_.textScaleFactor:Ae*=_.textScaleFactor;const Se=c.layers[0].layout,Oe=RU(b,_.textScaleFactor),Me=m2(a.horizontal)||a.vertical,st=c.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if((re!=="none"||st)&&c.appearanceFeatureData&&c.featureToAppearanceIndex[i.index]<c.appearanceFeatureData.length){const kt=c.appearanceFeatureData[c.featureToAppearanceIndex[i.index]];kt&&(kt.textShaping=Me,kt.iconTextFitPadding=Se.get("icon-text-fit-padding").evaluate(i,{},N),kt.fontScale=Oe,kt.textScaleFactor=_.textScaleFactor)}const et=V.name==="globe",it=c.tilePixelRatio*Ae/24,mt=(_t=c.overscaling,c.zoom>18&&_t>2&&(_t>>=1),Math.max(Mt/(512*_t),1)*Se.get("symbol-spacing")),ft=Se.get("text-padding")*c.tilePixelRatio,pt=Se.get("icon-padding")*c.tilePixelRatio,Ke=an(Se.get("text-max-angle")),yt=Se.get("icon-rotation-alignment")==="map"&&le!=="point",ut=mt/2;var _t;c.hasAnyIconTextFit===!1&&re!=="none"&&(c.hasAnyIconTextFit=!0);const gt=i.properties?+i.properties[en]:null,Vt=gt&&c.elevationFeatureIdToIndex?c.elevationFeatureIdToIndex.get(gt):65535,Ut=(kt,Dt,lr)=>{if(Dt.x<0||Dt.x>=Mt||Dt.y<0||Dt.y>=Mt)return;let Jt=null;if(et){const{x:Ft,y:br,z:Gr}=V.projectTilePoint(Dt.x,Dt.y,lr);Jt={anchor:new _h(Ft,br,Gr,0,void 0),up:V.upVector(lr,Dt.x,Dt.y)}}(function(Ft,br,Gr,mn,$r,Ln,sn,Di,un,On,li,gi,yi,Li,Yo,_s,io,_o,Io,jr,_i,Si,sl,ea,Jo,ta,vd,Rs,R2,X_,_a,M2){const xd=Ft.addToLineVertexArray(br,mn);let vh,Yf,Xl,kc,Uw,K_,Vr,No=0,ji=0,vo=0,Kl=0,Da=-1,al=-1;const zo={};let Gw=mf("");const bd=Gr?Gr.anchor:br,oo=Rs!=="none";let Qo=0,xo=0;if(un._unevaluatedLayout.getValue("text-radial-offset")===void 0){const es=un.layout.get("text-offset").evaluate(_i,{},Jo);Qo=es[0]*jo,xo=es[1]*jo}else Qo=un.layout.get("text-radial-offset").evaluate(_i,{},Jo)*jo,xo=NM;if(Ft.allowVerticalPlacement&&$r.vertical){const es=$r.vertical;if(Yo)K_=$M(es),Di&&(Vr=$M(Di));else{const La=un.layout.get("text-rotate").evaluate(_i,{},Jo)+90;Xl=g2(On,bd,br,li,gi,yi,es,Li,La,_s,M2),Di&&(kc=g2(On,bd,br,li,gi,yi,Di,_o,La,null,_a))}}if(Ln){const es=un.layout.get("icon-rotate").evaluate(_i,{},Jo),La=jM(Ln,es,sl,oo,Si.iconScaleFactor),Rc=Di?jM(Di,es,sl,oo,Si.iconScaleFactor):void 0;Yf=g2(On,bd,br,li,gi,yi,Ln,_o,es,null,X_);const wd=function(xu,jfe,K6,Nfe,Y6,J6,zfe,HQe,uD){const Q6=xu.layers[0],e8=Q6.appearances;let J_=jfe.length;if(K6&&(J_=Math.max(J_,K6.length)),e8.length===0)return J_;const[Ffe,Bfe]=Nfe.get("icon-size-scale-range"),$fe=we(1,Ffe,Bfe);for(const t8 of e8){const r8=t8.getUnevaluatedProperties();if(r8._values["icon-image"].value!==void 0){const n8=Q6.getAppearanceValueAndResolveTokens(t8,"icon-image",Y6,J6,uD);if(n8){const i8=xu.getResolvedImageFromTokens(n8);if(i8){const o8=r8._values["icon-size"],Vfe=Pw(i8,ig(xu.zoom,o8,xu.worldview,uD),o8,J6,xu.zoom,Y6,xu.pixelRatio,$fe,xu.worldview,uD),Ufe=zfe.get(Vfe.iconPrimary.toString());J_=Math.max(J_,hhe(Ufe))}}}}return J_}(Ft,La,Rc,un.layout,_i,Jo,Ft.iconAtlasPositions,0,ea);No=4*wd;const lD=un.layout.get("icon-size").evaluate(_i,{},Jo,ea),cD=Si.compositeIconSizes?Si.compositeIconSizes[0].evaluate(_i,{},Jo,ea):0,qw=Si.compositeIconSizes?Si.compositeIconSizes[1].evaluate(_i,{},Jo,ea):0,Y_=BM(Ft.layerIds[0],Ft.iconSizeData,lD,Si.iconScaleFactor,cD,qw);Ft.addSymbols(Ft.icon,La,Y_,jr,Io,_i,void 0,Gr,br,xd.lineStartIndex,xd.lineLength,-1,ea,Jo,ta,vd,Ft.symbolInstances.length,wd),Da=Ft.icon.placedSymbolArray.length-1,Rc&&(ji=4*wd,Ft.addSymbols(Ft.icon,Rc,Y_,jr,Io,_i,ol.vertical,Gr,br,xd.lineStartIndex,xd.lineLength,-1,ea,Jo,ta,vd,Ft.symbolInstances.length,wd),al=Ft.icon.placedSymbolArray.length-1)}for(const es in $r.horizontal){const La=es,Rc=$r.horizontal[La];vh||(Gw=mf(Rc.text),Yo?Uw=$M(Rc):vh=g2(On,bd,br,li,gi,yi,Rc,Li,un.layout.get("text-rotate").evaluate(_i,{},Jo),_s,M2));const wd=Rc.positionedLines.length===1;if(vo+=MU(Ft,Gr,br,Rc,sn,un,Yo,_i,_s,xd,$r.vertical?ol.horizontal:ol.horizontalOnly,wd?ghe($r.horizontal):[La],zo,Da,Si,ea,Jo,Ft.symbolInstances.length,ta),wd)break}$r.vertical&&(Kl+=MU(Ft,Gr,br,$r.vertical,sn,un,Yo,_i,_s,xd,ol.vertical,["vertical"],zo,al,Si,ea,Jo,Ft.symbolInstances.length,ta));let Ms=-1;const Ds=(es,La)=>es?Math.max(es,La):La;Ms=Ds(Uw,Ms),Ms=Ds(K_,Ms),Ms=Ds(Vr,Ms);const Jf=Ms>-1?1:0;Ft.glyphOffsetArray.length>=65535&&vr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_i.sortKey!==void 0&&Ft.addToSortKeyRanges(Ft.symbolInstances.length,_i.sortKey),Ft.symbolInstances.emplaceBack(br.x,br.y,bd.x,bd.y,bd.z,zo.right>=0?zo.right:-1,zo.center>=0?zo.center:-1,zo.left>=0?zo.left:-1,zo.vertical>=0?zo.vertical:-1,Da,al,Gw,vh!==void 0?vh:Ft.collisionBoxArray.length,vh!==void 0?vh+1:Ft.collisionBoxArray.length,Xl!==void 0?Xl:Ft.collisionBoxArray.length,Xl!==void 0?Xl+1:Ft.collisionBoxArray.length,Yf!==void 0?Yf:Ft.collisionBoxArray.length,Yf!==void 0?Yf+1:Ft.collisionBoxArray.length,kc||Ft.collisionBoxArray.length,kc?kc+1:Ft.collisionBoxArray.length,li,vo,Kl,No,ji,Jf,0,Qo,xo,Ms,0,oo?1:0,R2)})(c,Dt,Jt,kt,a,d,y,p,c.layers[0],c.collisionBoxArray,i.index,i.sourceLayerIndex,c.index,ft,oe,I,0,pt,yt,J,i,_,M,D,N,G,Y,re,Vt,de,_e,ye)};if(le==="line")for(const kt of YA(i.geometry,0,0,Mt,Mt)){const Dt=dhe(kt,mt,Ke,a.vertical||Me,d,24,it,c.overscaling,Mt);for(const lr of Dt)Me&&Ehe(c,Me.text,ut,lr)||Ut(kt,lr,N)}else if(le==="line-center"){for(const kt of i.geometry)if(kt.length>1){const Dt=uhe(kt,Ke,a.vertical||Me,d,24,it);Dt&&Ut(kt,Dt,N)}}else if(i.type==="Polygon")for(const kt of lw(i.geometry,0)){const Dt=phe(kt,16);Ut(kt[0],new _h(Dt.x,Dt.y,0,0,void 0),N)}else if(i.type==="LineString")for(const kt of i.geometry)Ut(kt,new _h(kt[0].x,kt[0].y,0,0,void 0),N);else if(i.type==="Point")for(const kt of i.geometry)for(const Dt of kt)Ut([Dt],new _h(Dt.x,Dt.y,0,0,void 0),N)}const FM=255,og=FM*yh;function MU(c,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe){const le=EU(0,d,E,y,_,b,p,c.allowVerticalPlacement,void 0),de=y.layout.get("text-size").evaluate(b,{},re),_e=G.compositeTextSizes?G.compositeTextSizes[0].evaluate(b,{},re):0,ye=G.compositeTextSizes?G.compositeTextSizes[1].evaluate(b,{},re):0,Te=BM(c.layerIds[0],c.textSizeData,de,G.textScaleFactor,_e,ye);c.addSymbols(c.text,le,Te,E,_,b,M,i,a,I.lineStartIndex,I.lineLength,V,Y,re,oe,!1,J,le.length);for(const Ae of D)N[Ae]=c.text.placedSymbolArray.length-1;return 4*le.length}function BM(c,i,a,d,p,y){const _=i;let b=null;return _.kind==="source"?(b=[yh*a*d],b[0]>og&&vr(`${c}: Value for "text-size" is >= ${FM}. Reduce your "text-size".`)):_.kind==="composite"&&(b=[yh*p*d,yh*y*d],(b[0]>og||b[1]>og)&&vr(`${c}: Value for "text-size" is >= ${FM}. Reduce your "text-size".`)),b}function m2(c){for(const i in c)return c[i];return null}function g2(c,i,a,d,p,y,_,b,E,I,M){let D,N,V,G;if(D=M?M.top:_.top,N=M?M.bottom:_.bottom,V=M?M.left:_.left,G=M?M.right:_.right,kM(_)&&_.collisionPadding){const Y=_.collisionPadding;V-=Y[0],D-=Y[1],G+=Y[2],N+=Y[3]}if(E){const Y=new wt(V,D),re=new wt(G,D),J=new wt(V,N),oe=new wt(G,N),le=an(E);let de=new wt(0,0);I&&(de=new wt(I[0],I[1])),Y._rotateAround(le,de),re._rotateAround(le,de),J._rotateAround(le,de),oe._rotateAround(le,de),V=Math.min(Y.x,re.x,J.x,oe.x),G=Math.max(Y.x,re.x,J.x,oe.x),D=Math.min(Y.y,re.y,J.y,oe.y),N=Math.max(Y.y,re.y,J.y,oe.y)}return c.emplaceBack(i.x,i.y,i.z,a.x,a.y,V,D,G,N,b,d,p,y),c.length-1}function $M(c){kM(c)&&c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const i=c.bottom-c.top;return i>0?Math.max(10,i):null}function Ehe(c,i,a,d){const p=c.compareText;if(i in p){const y=p[i];for(let _=y.length-1;_>=0;_--)if(d.dist(y[_])<a)return!0}else p[i]=[];return p[i].push(d),!1}function DU(c,i){const a=c.fovAboveCenter,d=c.elevation?c.elevation.getMinElevationBelowMSL()*i:0,p=(c._camera.position[2]*c.worldSize-d)/Math.cos(c._pitch),y=Math.sin(a)*p/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01));let _=Math.sin(c._pitch)*y+p;const b=p*(1/c._horizonShift);if(!c.elevation||c.elevation.exaggeration()===0){let E=Math.max(c.zoom-17,0);c.isOrthographic&&(E/=10),_*=1+E}return Math.min(1.01*_,b)}function Cw(c,i){if(!i.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:i};const a=Math.pow(2,-c.z),d=c.x*a,p=(c.x+1)*a,y=c.y*a,_=(c.y+1)*a,b=ht(d),E=ht(p),I=vt(y),M=vt(_),D=i.project(b,I),N=i.project(E,I),V=i.project(E,M),G=i.project(b,M);let Y=Math.min(D.x,N.x,V.x,G.x),re=Math.min(D.y,N.y,V.y,G.y),J=Math.max(D.x,N.x,V.x,G.x),oe=Math.max(D.y,N.y,V.y,G.y);const le=a/16;function de(ye,Te,Ae,Se,Oe,Me){const st=(Ae+Oe)/2,et=(Se+Me)/2,it=i.project(ht(st),vt(et)),mt=Math.max(0,Y-it.x,re-it.y,it.x-J,it.y-oe);Y=Math.min(Y,it.x),J=Math.max(J,it.x),re=Math.min(re,it.y),oe=Math.max(oe,it.y),mt>le&&(de(ye,it,Ae,Se,st,et),de(it,Te,st,et,Oe,Me))}de(D,N,d,y,p,y),de(N,V,p,y,p,_),de(V,G,p,_,d,_),de(G,D,d,_,d,y),Y-=le,re-=le,J+=le,oe+=le;const _e=1/Math.max(J-Y,oe-re);return{scale:_e,x:Y*_e,y:re*_e,x2:J*_e,y2:oe*_e,projection:i}}function LU(c,{x:i,y:a},d=0){return new wt(((i-d)*c.scale-c.x)*Mt,(a*c.scale-c.y)*Mt)}const Ahe=B(new Float32Array(16));class Xf{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new ve(0,0)}projectTilePoint(i,a,d){return{x:i,y:a,z:0}}locationPoint(i,a,d,p=!0){return i._coordinatePoint(i.locationCoordinate(a,d),p)}pixelsPerMeter(i,a){return Xe(1,i)*a}pixelSpaceConversion(i,a,d){return 1}farthestPixelDistance(i){return DU(i,i.pixelsPerMeter)}pointCoordinate(i,a,d,p){const y=i.horizonLineFromTop(!1),_=new wt(a,Math.max(y,d));return i.rayIntersectionCoordinate(i.pointRayIntersection(_,p))}pointCoordinate3D(i,a,d){const p=new wt(a,d);if(i.elevation)return i.elevation.pointCoordinate(p);{const y=this.pointCoordinate(i,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(i,a){if(i.elevation&&i.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(i,a.x,a.y);const d=i.horizonLineFromTop();return a.y<d}createInversionMatrix(i,a){return Ahe}createTileMatrix(i,a,d){let p,y,_;const b=d.canonical,E=B(new Float64Array(16));if(this.isReprojectedInTileSpace){const I=Cw(b,this);p=1,y=I.x+d.wrap*I.scale,_=I.y,te(E,E,[p/I.scale,p/I.scale,i.pixelsPerMeter/a])}else p=a/i.zoomScale(b.z),y=(b.x+Math.pow(2,b.z)*d.wrap)*p,_=b.y*p;return H(E,E,[y,_,0]),te(E,E,[p/Mt,p/Mt,1]),E}upVector(i,a,d){return[0,0,1]}upVectorScale(i,a,d){return{metersToTile:1}}}class Phe extends Xf{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,d]=this.parallels=i.parallels||[29.5,45.5],p=Math.sin(an(a));this.n=(p+Math.sin(an(d)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:d,c:p,r0:y}=this,_=an(i-this.center[0]),b=an(a),E=Math.sqrt(p-2*d*Math.sin(b))/d;return{x:E*Math.sin(_*d),y:E*Math.cos(_*d)-y,z:0}}unproject(i,a){const{n:d,c:p,r0:y}=this,_=y+a;let b=Math.atan2(i,Math.abs(_))*Math.sign(_);_*d<0&&(b-=Math.PI*Math.sign(i)*Math.sign(_));const E=an(this.center[0])*d;b=Ye(b,-Math.PI-E,Math.PI-E);const I=we(Be(b/d)+this.center[0],-180,180),M=Math.asin(we((p-(i*i+_*_)*d*d)/(2*d),-1,1)),D=we(Be(M),-85.051129,Re);return new ve(I,D)}}const Iw=1.340264,Ow=-.081106,kw=893e-6,Rw=.003796,y2=Math.sqrt(3)/2;class Che extends Xf{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const d=Math.asin(y2*Math.sin(a)),p=d*d,y=p*p*p;return{x:.5*(i*Math.cos(d)/(y2*(Iw+3*Ow*p+y*(7*kw+9*Rw*p)))/Math.PI+.5),y:1-.5*(d*(Iw+Ow*p+y*(kw+Rw*p))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,p=d*d,y=p*p*p;for(let M,D,N,V=0;V<12&&(D=d*(Iw+Ow*p+y*(kw+Rw*p))-a,N=Iw+3*Ow*p+y*(7*kw+9*Rw*p),M=D/N,d=we(d-M,-Math.PI/3,Math.PI/3),p=d*d,y=p*p*p,!(Math.abs(M)<1e-12));++V);const _=y2*i*(Iw+3*Ow*p+y*(7*kw+9*Rw*p))/Math.cos(d),b=Math.asin(Math.sin(d)/y2),E=we(180*_/Math.PI,-180,180),I=we(180*b/Math.PI,-85.051129,Re);return new ve(E,I)}}class Ihe extends Xf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const d=360*(i-.5),p=we(360*(.5-a),-85.051129,Re);return new ve(d,p)}}const U_=Math.PI/2;function _2(c){return Math.tan((U_+c)/2)}class Ohe extends Xf{constructor(i){super(i),this.center=i.center||[0,30];const[a,d]=this.parallels=i.parallels||[30,30];let p=an(a),y=an(d);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const _=Math.cos(p),b=_2(p);this.n=p===y?Math.sin(p):Math.log(_/Math.cos(y))/Math.log(_2(y)/b),this.f=_*Math.pow(_2(p),this.n)/this.n}project(i,a){a=an(a),this.southernCenter&&(a=-a),i=an(i-this.center[0]);const d=1e-6,{n:p,f:y}=this;y>0?a<-U_+d&&(a=-U_+d):a>U_-d&&(a=U_-d);const _=y/Math.pow(_2(a),p);let b=_*Math.sin(p*i),E=y-_*Math.cos(p*i);return b=.5*(b/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:b,y:this.southernCenter?E:1-E,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:d,f:p}=this,y=p-a,_=Math.sign(y),b=Math.sign(d)*Math.sqrt(i*i+y*y);let E=Math.atan2(i,Math.abs(y))*_;y*d<0&&(E-=Math.PI*Math.sign(i)*_);const I=we(Be(E/d)+this.center[0],-180,180),M=we(Be(2*Math.atan(Math.pow(p/b,1/d))-U_),-85.051129,Re);return new ve(I,this.southernCenter?-M:M)}}class jU extends Xf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:$e(i),y:Je(a),z:0}}unproject(i,a){const d=ht(i),p=vt(a);return new ve(d,p)}}const NU=an(Re);class khe extends Xf{project(i,a){const d=(a=an(a))*a,p=d*d;return{x:.5*((i=an(i))*(.8707-.131979*d+p*(p*(.003971*d-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+d*(.015085+p*(.028874*d-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let d=a=(2*(1-a)-1)*Math.PI,p=25,y=0,_=d*d;do{_=d*d;const I=_*_;y=(d*(1.007226+_*(.015085+I*(.028874*_-.044475-.005916*I)))-a)/(1.007226+_*(.045255+I*(.259866*_-.311325-.005916*11*I))),d=we(d-y,-NU,NU)}while(Math.abs(y)>1e-6&&--p>0);_=d*d;const b=we(Be(i/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=Be(d);return new ve(b,E)}}const zU=an(Re);class Rhe extends Xf{project(i,a){a=an(a),i=an(i);const d=Math.cos(a),p=2/Math.PI,y=Math.acos(d*Math.cos(i/2)),_=Math.sin(y)/y,b=.5*(i*p+2*d*Math.sin(i/2)/_)||0,E=.5*(a+Math.sin(a)/_)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(i,a){let d=i=(2*i-.5)*Math.PI,p=a=(2*(1-a)-1)*Math.PI,y=25;const _=1e-6;let b=0,E=0;do{const I=Math.cos(p),M=Math.sin(p),D=2*M*I,N=M*M,V=I*I,G=Math.cos(d/2),Y=Math.sin(d/2),re=2*G*Y,J=Y*Y,oe=1-V*G*G,le=oe?1/oe:0,de=oe?Math.acos(I*G)*Math.sqrt(1/oe):0,_e=.5*(2*de*I*Y+2*d/Math.PI)-i,ye=.5*(de*M+p)-a,Te=.5*le*(V*J+de*I*G*N)+1/Math.PI,Ae=le*(re*D/4-de*M*Y),Se=.125*le*(D*Y-de*M*V*re),Oe=.5*le*(N*G+de*J*I)+.5,Me=Ae*Se-Oe*Te;b=(ye*Ae-_e*Oe)/Me,E=(_e*Se-ye*Te)/Me,d=we(d-b,-Math.PI,Math.PI),p=we(p-E,-zU,zU)}while((Math.abs(b)>_||Math.abs(E)>_)&&--y>0);return new ve(Be(d),Be(p))}}class FU extends Xf{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(an(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:d,cosPhi:p}=this;return{x:an(i)*p*d+.5,y:-Math.sin(an(a))/p*d+.5,z:0}}unproject(i,a){const{scale:d,cosPhi:p}=this,y=-(a-.5)/d,_=we(Be((i-.5)/d)/p,-180,180),b=Math.asin(we(y*p,-1,1)),E=we(Be(b),-85.051129,Re);return new ve(_,E)}}class Mhe extends jU{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,a,d){const p=rw(i,a,d);return Ir(p,p,FA(gd(d))),{x:p[0],y:p[1],z:p[2]}}locationPoint(i,a,d){const p=Ee(a.lat,a.lng),y=Rt([],p),_=d?i._centerAltitude+d:i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;ur(p,p,y,Xe(1,0)*Mt*_);const b=B(new Float64Array(16));return q(b,i.pixelMatrix,i.globeMatrix),Ir(p,p,b),new wt(p[0],p[1])}pixelsPerMeter(i,a){return Xe(1,0)*a}pixelSpaceConversion(i,a,d){const p=Xe(1,i)*a,y=mr(Xe(1,45)*a,p,d);return this.pixelsPerMeter(i,a)/y}createTileMatrix(i,a,d){const p=zR(gd(d.canonical));return q(new Float64Array(16),i.globeMatrix,p)}createInversionMatrix(i,a){const{center:d}=i,p=FA(gd(a));return ae(p,p,an(d.lng)),Q(p,p,an(d.lat)),te(p,p,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(i,a,d,p){return Q4(i,a,d,!0)||new Lt(0,0)}pointCoordinate3D(i,a,d){const p=this.pointCoordinate(i,a,d,0);return[p.x,p.y,p.z]}isPointAboveHorizon(i,a){return!Q4(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(p,y){const _=p.cameraToCenterDistance,b=p._centerAltitude*y,E=p._camera,I=p._camera.forward(),M=qe([],$t([],I,-_),[0,0,b]),D=p.worldSize/(2*Math.PI),N=[0,0,-D],V=p.width/p.height,G=Math.tan(p.fovAboveCenter),Y=$t([],E.up(),G),re=$t([],E.right(),G*V),J=Rt([],qe([],qe([],I,Y),re)),oe=[];let le;if(new Zn(M,J).closestPointOnSphere(N,D,oe)){const de=qe([],oe,N),_e=Nn([],de,M);le=Math.cos(p.fovAboveCenter)*dt(_e)}else{const de=Nn([],M,N),_e=Nn([],N,M);Rt(_e,_e);const ye=dt(de)-D;le=Math.sqrt(ye*(ye+2*D));const Te=Math.acos(le/(D+ye))-Math.acos(Yt(I,_e));le*=Math.cos(Te)}return 1.01*le}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),d=Uf(i.zoom);if(d>0){const p=DU(i,Xe(1,i.center.lat)*i.worldSize),y=i.worldSize/(2*Math.PI),_=Math.max(i.width,i.height)/i.worldSize*Math.PI;return mr(a,p+y*(1-Math.cos(_)),Math.pow(d,10))}return a}upVector(i,a,d){return rw(a,d,i,1)}upVectorScale(i){return{metersToTile:jA(zA(gd(i)))}}}function BU(c){const i=c.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(c.name){case"mercator":return new jU(c);case"equirectangular":return new Ihe(c);case"naturalEarth":return new khe(c);case"equalEarth":return new Che(c);case"winkelTripel":return new Rhe(c);case"albers":return a?new FU(c):new Phe(c);case"lambertConformalConic":return a?new FU(c):new Ohe(c);case"globe":return new Mhe(c)}throw new Error(`Invalid projection name: ${c.name}`)}const Dhe=Jr.types,Lhe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Mw(c,i,a,d,p,y,_,b,E,I,M,D,N){const V=b?Math.min(og,Math.round(b[0])):0,G=b?Math.min(og,Math.round(b[1])):0;c.emplaceBack(i,a,Math.round(32*d),Math.round(32*p),y,_,(V<<1)+(E?1:0),0+(G<<1),16*I,16*M,256*D,256*N)}function Dw(c,i,a){c.emplaceBack(i,a)}function Lw(c,i,a,d,p,y,_){c.emplaceBack(i,a,d,p,y,_)}const v2=(c,i,a,d)=>{for(let p=0;p<i;p++)c.emplaceBack(a[0],a[1],a[2],d[0],d[1],d[2])};function G_(c,i,a,d,p){c.emplaceBack(i,a,d,p),c.emplaceBack(i,a,d,p),c.emplaceBack(i,a,d,p),c.emplaceBack(i,a,d,p)}function jhe(c){for(const i of c.sections)if(ud(i.text))return!0;return!1}class VM{constructor(i){this.layoutVertexArray=new Wb,this.indexArray=new go,this.programConfigurations=i,this.segments=new di,this.dynamicLayoutVertexArray=new md,this.opacityVertexArray=new Xb,this.placedSymbolArray=new bA,this.iconTransitioningVertexArray=new Qa,this.globeExtVertexArray=new Zb,this.zOffsetVertexArray=new Ko,this.orientationVertexArray=new S_,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(i,a){const d=[],p=this.layoutVertexArray.uint16;for(let y=0;y<a;++y){const _=12*(i+y);d.push(...p.slice(_,_+12))}return d}updateSymbolVertexData(i,a,d,p,y,_,b,E,I,M,D,N,V){const G=this.layoutVertexArray.uint16,Y=12*i;G[Y]=a,G[Y+1]=d,G[Y+2]=p,G[Y+3]=y,G[Y+4]=_,G[Y+5]=b,G[Y+6]=E,G[Y+7]=I,G[Y+8]=M,G[Y+9]=D,G[Y+10]=N,G[Y+11]=V}upload(i,a,d,p,y,_){this.isEmpty()||(d&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zde.members,!!_),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Bde.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Lhe,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=i.createVertexBuffer(this.iconTransitioningVertexArray,Ude.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Fde.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||y)&&(this.zOffsetVertexBuffer=i.createVertexBuffer(this.zOffsetVertexArray,$de.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=i.createVertexBuffer(this.orientationVertexArray,Vde.members,!0)),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Wt(VM,"SymbolBuffers");class UM{constructor(i,a,d){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new d,this.segments=new di,this.collisionVertexArray=new w_,this.collisionVertexArrayExt=new md}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Gde.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,qde.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Wt(UM,"CollisionBuffers");class x2{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=B([]),this.placementViewportMatrix=B([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=i.worldview,this.localizable=i.localizable,this.textSizeData=ig(this.zoom,a["text-size"],this.worldview,i.availableImages),this.iconSizeData=ig(this.zoom,a["icon-size"],this.worldview,i.availableImages);const d=this.layers[0].layout,p=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.lut=i.lut,this.canOverlap=d.get("text-allow-overlap")||d.get("icon-allow-overlap")||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=d.get("text-writing-mode").map(_=>ol[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=i.sourceID,this.projection=i.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(i){const a=this.layers[0].getAppearances();if(!a||a.length===0)return!1;const d=Array.isArray(i)?i:[i];return a.some(p=>d.some(y=>p.getProperty(y)!=null))}createArrays(){this.text=new VM(new F(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("text")||i.startsWith("symbol"))),this.icon=new VM(new F(this.layers,{zoom:this.zoom,lut:this.lut},i=>i.startsWith("icon")||i.startsWith("symbol"))),this.glyphOffsetArray=new Hm,this.lineVertexArray=new TA,this.symbolInstances=new SA}calculateGlyphDependencies(i,a,d,p,y){for(const _ of i){const b=_.codePointAt(0);if(b===void 0)break;if(a[b]=!0,p&&y&&b<=65535){const E=Sw[_];E&&(a[E.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(i,a,d,p,y,_,b){if(!i.hasProperty("icon-size"))return b*_;let E=1;const I=i.getUnevaluatedProperties()._values["icon-size"],M=ig(this.zoom,I,this.worldview,y),D=B_(M,a);if(M.kind!=="constant"&&M.kind!=="camera"||(E=D.uSize),M.kind==="composite"){const{minZoom:N,maxZoom:V}=M,G=I.possiblyEvaluate(new Dn(N,{worldview:this.worldview}),p),Y=I.possiblyEvaluate(new Dn(V,{worldview:this.worldview}),p),re=G.evaluate(d,{},p,y);E=re+(Y.evaluate(d,{},p,y)-re)*D.uSizeT}return M.kind==="source"&&(E=I.possiblyEvaluate(new Dn(this.zoom,{worldview:this.worldview}),p).evaluate(d,{},p,y)),E*_}updateFootprints(i,a){}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);return!ZA(this.activeReplacements,d)&&(this.activeReplacements=d,!0)}getResolvedImageFromTokens(i){return typeof i=="string"?fa.build(i):i}populate(i,a,d,p){const y=this.layers[0],_=y.layout,b=this.projection.name==="globe",E=_.get("text-font"),I=_.get("text-field"),M=_.get("icon-image"),[D,N]=_.get("icon-size-scale-range"),V=we(a.scaleFactor||1,D,N),G=(I.value.kind!=="constant"||I.value.value instanceof ks&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),Y=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,re=this.hasAnyAppearanceProperty("icon-image"),J=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!G&&!Y&&!re)return;const oe=a.iconDependencies,le=a.glyphDependencies,de=a.availableImages,_e=new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),ye=Te=>{const Ae=Te.id.toString();oe.has(Ae)?oe.get(Ae).push(Te):oe.set(Ae,[Te])};for(const Te of i){const{feature:Ae,id:Se,index:Oe,sourceLayerIndex:Me}=Te,st=y._featureFilter.needGeometry,et=Lr(Ae,st);if(!y._featureFilter.filter(_e,et,d))continue;if(st||(et.geometry=yr(Ae,d,p)),b&&Ae.type!==1&&d.z<=5){const _t=et.geometry,gt=.98078528056,Vt=(Ut,kt)=>Yt(rw(Ut.x,Ut.y,d,1),rw(kt.x,kt.y,d,1))<gt;for(let Ut=0;Ut<_t.length;Ut++)_t[Ut]=Xt(_t[Ut],Vt)}let it,mt;if(G){const _t=y.getValueAndResolveTokens("text-field",et,d,de),gt=ks.factory(_t);jhe(gt)&&(this.hasRTLText=!0),(!this.hasRTLText||Db()==="unavailable"||this.hasRTLText&&Hl.isParsed())&&(it=Wde(gt,y,et))}if(Y){const _t=y.getValueAndResolveTokens("icon-image",et,d,de);mt=this.getResolvedImageFromTokens(_t)}const ft=this.layers[0];let pt=!1;if(!mt&&re){const _t=ft.getAppearances();for(const gt of _t)if(gt.getProperty("icon-image")){const Vt=ft.getAppearanceValueAndResolveTokens(gt,"icon-image",et,d,de);if(Vt){mt=this.getResolvedImageFromTokens(Vt),pt=!0;break}}}if(!it&&!mt)continue;const Ke=this.sortFeaturesByKey?J.evaluate(et,{},d):void 0,yt={id:Se,text:it,icon:mt,index:Oe,sourceLayerIndex:Me,geometry:et.geometry,properties:Ae.properties,type:Dhe[Ae.type],sortKey:Ke};if(this.features.push(yt),this.featureToAppearanceIndex[Oe]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Se,properties:Ae.properties,usesAppearanceIconAsPlaceholder:pt,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),mt){const _t=ft._unevaluatedLayout._values,{iconPrimary:gt,iconSecondary:Vt}=Pw(mt,this.iconSizeData,_t["icon-size"],d,this.zoom,yt,this.pixelRatio,V,this.worldview,de);ye(gt),Vt&&(this.hasAnySecondaryIcon=!0,ye(Vt))}const ut=ft.getAppearances();if(ut.length!==0&&ut.forEach(_t=>{if(!_t.getProperty("icon-image"))return;const gt=this.getCombinedIconPrimary(_t,ft,et,d,de,yt,V);gt&&ye(gt)}),it){const _t=E.evaluate(et,{},d).join(","),gt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ol.vertical)>=0;for(const Vt of it.sections)if(Vt.image){const Ut=Vt.image.getPrimary().scaleSelf(this.pixelRatio),kt=Ut.id.toString(),Dt=oe.get(kt)||[];Dt.push(Ut),oe.set(kt,Dt)}else{const Ut=Ob(it.toString()),kt=Vt.fontStack||_t,Dt=le[kt]=le[kt]||{};this.calculateGlyphDependencies(Vt.text,Dt,gt,this.allowVerticalPlacement,Ut)}}}if(_.get("symbol-placement")==="line"&&(this.features=function(Te){const Ae={},Se={},Oe=[];let Me=0;function st(ft){Oe.push(Te[ft]),Me++}function et(ft,pt,Ke){const yt=Se[ft];return delete Se[ft],Se[pt]=yt,Oe[yt].geometry[0].pop(),Oe[yt].geometry[0]=Oe[yt].geometry[0].concat(Ke[0]),yt}function it(ft,pt,Ke){const yt=Ae[pt];return delete Ae[pt],Ae[ft]=yt,Oe[yt].geometry[0].shift(),Oe[yt].geometry[0]=Ke[0].concat(Oe[yt].geometry[0]),yt}function mt(ft,pt,Ke){const yt=Ke?pt[0][pt[0].length-1]:pt[0][0];return`${ft}:${yt.x}:${yt.y}`}for(let ft=0;ft<Te.length;ft++){const pt=Te[ft],Ke=pt.geometry,yt=pt.text?pt.text.toString():null;if(!yt){st(ft);continue}const ut=mt(yt,Ke),_t=mt(yt,Ke,!0);if(ut in Se&&_t in Ae&&Se[ut]!==Ae[_t]){const gt=it(ut,_t,Ke),Vt=et(ut,_t,Oe[gt].geometry);delete Ae[ut],delete Se[_t],Se[mt(yt,Oe[Vt].geometry,!0)]=Vt,Oe[gt].geometry=null}else ut in Se?et(ut,_t,Ke):_t in Ae?it(ut,_t,Ke):(st(ft),Ae[ut]=Me-1,Se[_t]=Me-1)}return Oe.filter(ft=>ft.geometry)}(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Te of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Te.id,this.elevationFeatures.length),this.elevationFeatures.push(Te)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Te,Ae)=>Te.sortKey-Ae.sortKey)}getCombinedIconPrimary(i,a,d,p,y,_,b){let E,I;const M=i.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const D=a.getAppearanceValueAndResolveTokens(i,"icon-image",d,p,y);E=this.getResolvedImageFromTokens(D)}else{const D=a.getValueAndResolveTokens("icon-image",d,p,y);E=this.getResolvedImageFromTokens(D)}if(E){const D=i.hasProperty("icon-size")?M._values["icon-size"]:a._unevaluatedLayout._values["icon-size"];I=Pw(E,ig(this.zoom,D,this.worldview,y),D,p,this.zoom,_,this.pixelRatio,b,this.worldview,y).iconPrimary}return I}updateSymbolInstanceIconVertices(i,a,d,p,y,_,b,E,I,M,D,N,V,G){if(i.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(a.activeAppearance===d)return{vertexOffsetDelta:i.numIconVertices,hasChanges:!1};if(d){const Y=this.getCombinedIconPrimary(d,I,p,_,b,{sortKey:void 0,text:void 0,icon:null,index:i.featureIndex,sourceLayerIndex:i.featureIndex,geometry:[],properties:a.properties,type:"Point",id:a.id},M);if(!Y)return{vertexOffsetDelta:0,hasChanges:!1};const re=Y.toString(),J=this.iconAtlasPositions&&this.iconAtlasPositions.get(re);if(J){const{appearanceIconOffset:oe,appearanceIconRotate:le}=PU(d,I,p,_,N,G,V,M);let de=u2(J,void 0,oe,I.layout.get("icon-anchor").evaluate(p,D,_));const _e=J.sdf,ye=I.layout.get("icon-text-fit").constantOr("none");ye!=="none"&&a.textShaping&&a.iconTextFitPadding&&a.fontScale&&(de=RM(de,a.textShaping,ye,a.iconTextFitPadding,oe,a.fontScale));const Te=this.calculateEffectiveAppearanceIconSize(d,E.zoom,p,_,b,M,V),Ae=0,Se=1+(Math.min(og,Math.round(Te*yh))<<1),Oe=jM(de,le,_e,ye!=="none",M);a.isUsingAppearanceIconVertexData||(a.isUsingAppearanceIconVertexData=!0,a.layoutBasedIconVertexData=this.icon.getSymbolVertexData(y,i.numIconVertices));let Me=y;for(let et=0;et<Oe.length;++et){const it=Oe[et],mt=a.layoutBasedIconVertexData[0]||i.tileAnchorX,ft=a.layoutBasedIconVertexData[1]||i.tileAnchorY,pt=16*it.pixelOffsetTL.x,Ke=16*it.pixelOffsetTL.y,yt=16*it.pixelOffsetBR.x,ut=16*it.pixelOffsetBR.y,_t=16*it.minFontScaleX,gt=16*it.minFontScaleY;this.icon.updateSymbolVertexData(Me,mt,ft,Math.round(32*it.tl.x),Math.round(32*it.tl.y),it.texPrimary.x,it.texPrimary.y,Ae,Se,pt,Ke,_t,gt),this.icon.updateSymbolVertexData(Me+1,mt,ft,Math.round(32*it.tr.x),Math.round(32*it.tr.y),it.texPrimary.x+it.texPrimary.w,it.texPrimary.y,Ae,Se,yt,Ke,_t,gt),this.icon.updateSymbolVertexData(Me+2,mt,ft,Math.round(32*it.bl.x),Math.round(32*it.bl.y),it.texPrimary.x,it.texPrimary.y+it.texPrimary.h,Ae,Se,pt,ut,_t,gt),this.icon.updateSymbolVertexData(Me+3,mt,ft,Math.round(32*it.br.x),Math.round(32*it.br.y),it.texPrimary.x+it.texPrimary.w,it.texPrimary.y+it.texPrimary.h,Ae,Se,yt,ut,_t,gt),Me+=4}const st=i.numIconVertices-4*Oe.length;for(let et=0;et<st;++et)this.icon.updateSymbolVertexData(Me+et,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:i.numIconVertices,hasChanges:!0}}}else if(a.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(y,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(y+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:i.numIconVertices,hasChanges:!0}}else if(a.isUsingAppearanceIconVertexData){const re=a.layoutBasedIconVertexData.length/12;for(let J=0;J<re;++J){const oe=J*12;this.icon.updateSymbolVertexData(y+J,a.layoutBasedIconVertexData[oe+0],a.layoutBasedIconVertexData[oe+1],a.layoutBasedIconVertexData[oe+2],a.layoutBasedIconVertexData[oe+3],a.layoutBasedIconVertexData[oe+4],a.layoutBasedIconVertexData[oe+5],a.layoutBasedIconVertexData[oe+6],a.layoutBasedIconVertexData[oe+7],a.layoutBasedIconVertexData[oe+8],a.layoutBasedIconVertexData[oe+9],a.layoutBasedIconVertexData[oe+10],a.layoutBasedIconVertexData[oe+11])}return a.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:re,hasChanges:!0}}return{vertexOffsetDelta:i.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe){const le=i.numHorizontalGlyphVertices>0||i.numVerticalGlyphVertices>0;if(!le)return{vertexOffsetDelta:le?i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices:0,hasChanges:!1};if(a.activeAppearance===d)return{vertexOffsetDelta:i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices,hasChanges:!1};if(d&&a.textShaping){const{appearanceTextOffset:de,appearanceTextRotate:_e,appearanceTextSize:ye}=CU(d,b,p,_,D,V,N);a.fontScale=RU(ye,a.textScaleFactor);const Te=d.getUnevaluatedProperty("text-size");let Ae=this.textSizeData,Se=re,Oe=J;d.hasProperty("text-size")&&(Ae=ig(this.zoom,Te,this.worldview,oe),Se=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Oe=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Me=a.textShaping.bottom-D[1],st=a.textShaping.left-D[0],et=a.textShaping.right-D[0];a.textShaping.top=de[1]+(a.textShaping.top-D[1]),a.textShaping.bottom=de[1]+Me,a.textShaping.left=de[0]+st,a.textShaping.right=de[0]+et;const it=EU(0,a.textShaping,de,b,!1,p,I,this.allowVerticalPlacement,_e),mt=ye&&Ae.kind==="composite"?Te.possiblyEvaluate(new Dn(Se,{}),_).evaluate(p,M,_):G,ft=ye&&Ae.kind==="composite"?Te.possiblyEvaluate(new Dn(Oe,{}),_).evaluate(p,M,_):Y,pt=BM(d.name,Ae,ye,E,mt,ft),Ke=Array.isArray(pt)?pt[1]:ye,yt=0,ut=1+(Math.min(og,Math.round(Ke*yh))<<1);a.isUsingAppearanceTextVertexData||(a.isUsingAppearanceTextVertexData=!0,a.layoutBasedTextVertexData=this.text.getSymbolVertexData(y,i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices));for(let _t=0;_t<it.length&&_t<(i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices)/4;++_t){const gt=it[_t],Vt=gt.glyphOffset[1],Ut=i.tileAnchorX,kt=i.tileAnchorY,Dt=y+4*_t;this.text.updateSymbolVertexData(Dt,Ut,kt,Math.round(32*gt.tl.x),Math.round(32*(Vt+gt.tl.y)),gt.texPrimary.x,gt.texPrimary.y,yt,ut,gt.pixelOffsetTL.x,gt.pixelOffsetTL.y,gt.minFontScaleX,gt.minFontScaleY),this.text.updateSymbolVertexData(Dt+1,Ut,kt,Math.round(32*gt.tr.x),Math.round(32*(Vt+gt.tr.y)),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y,yt,ut,gt.pixelOffsetBR.x,gt.pixelOffsetTL.y,gt.minFontScaleX,gt.minFontScaleY),this.text.updateSymbolVertexData(Dt+2,Ut,kt,Math.round(32*gt.bl.x),Math.round(32*(Vt+gt.bl.y)),gt.texPrimary.x,gt.texPrimary.y+gt.texPrimary.h,yt,ut,gt.pixelOffsetTL.x,gt.pixelOffsetBR.y,gt.minFontScaleX,gt.minFontScaleY),this.text.updateSymbolVertexData(Dt+3,Ut,kt,Math.round(32*gt.br.x),Math.round(32*(Vt+gt.br.y)),gt.texPrimary.x+gt.texPrimary.w,gt.texPrimary.y+gt.texPrimary.h,yt,ut,gt.pixelOffsetBR.x,gt.pixelOffsetBR.y,gt.minFontScaleX,gt.minFontScaleY)}return{vertexOffsetDelta:i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices,hasChanges:!0}}if(a.isUsingAppearanceTextVertexData){const _e=a.layoutBasedTextVertexData.length/12;for(let ye=0;ye<_e;++ye){const Te=ye*12;this.text.updateSymbolVertexData(y+ye,a.layoutBasedTextVertexData[Te+0],a.layoutBasedTextVertexData[Te+1],a.layoutBasedTextVertexData[Te+2],a.layoutBasedTextVertexData[Te+3],a.layoutBasedTextVertexData[Te+4],a.layoutBasedTextVertexData[Te+5],a.layoutBasedTextVertexData[Te+6],a.layoutBasedTextVertexData[Te+7],a.layoutBasedTextVertexData[Te+8],a.layoutBasedTextVertexData[Te+9],a.layoutBasedTextVertexData[Te+10],a.layoutBasedTextVertexData[Te+11])}return a.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:_e,hasChanges:!0}}return{vertexOffsetDelta:i.numHorizontalGlyphVertices+i.numVerticalGlyphVertices,hasChanges:!1}}update(i,a,d,p,y,_,b){this.text.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(i,a,y,d,p,_,b,this.worldview)}updateRoadElevation(i){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const d=At(i),p=1/d;let y=!1,_=!1;for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b),I=rt(1,0,0),M=rt(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:N,numIconVertices:V,numVerticalIconVertices:G}=E,Y=D>0||N>0,re=V>0,J=this.elevationFeatures[E.elevationFeatureIndex];if(J){const oe=new wt(E.tileAnchorX,E.tileAnchorY),le=.075+J.pointElevation(oe);E.zOffset!==le&&(a=!0,E.zOffset=le),le!==0&&(this.hasAnyZOffset=!0);const de=J.computeSlopeNormal(oe,p),_e=Wo(wr(),rt(0,0,1),de);Vn(I,I,_e),Vn(M,M,_e),I[2]*=d,M[2]*=d,I[0]===1&&I[1]===0&&I[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(y=y||Y,_=_||re)}if(Y&&(v2(this.text.orientationVertexArray,D,I,M),v2(this.text.orientationVertexArray,N,I,M)),re){const{placedIconSymbolIndex:oe,verticalPlacedIconSymbolIndex:le}=E;oe>=0&&v2(this.icon.orientationVertexArray,V,I,M),le>=0&&v2(this.icon.orientationVertexArray,G,I,M)}}y||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const i=(y,_,b)=>{d+=_,d>y.length&&y.resize(d);for(let E=-_;E<0;E++)y.emplace(E+d,b)},a=(y,_,b)=>{p+=_,p>y.length&&y.resize(p);for(let E=-_;E<0;E++)y.emplace(E+p,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let d=0,p=0;for(let y=0;y<this.symbolInstances.length;y++){const _=this.symbolInstances.get(y),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:E,numIconVertices:I}=_,M=_.zOffset,D=I>0;if((b>0||E>0)&&(i(this.text.zOffsetVertexArray,b,M),i(this.text.zOffsetVertexArray,E,M)),D){const{placedIconSymbolIndex:N,verticalPlacedIconSymbolIndex:V}=_;N>=0&&a(this.icon.zOffsetVertexArray,I,M),V>=0&&a(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i,a,d,p,y){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(_=>_.appearances&&_.appearances.length>0)),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(i,a,d,p,y){if(!(i&&a&&d&&this.appearanceFeatureData))return!1;const _=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,b=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!_&&!b)return!1;const E=this.layers[0],I=E.layout;let M=1,D=0,N=!1;if(_){const[J,oe]=I.get("icon-size-scale-range");M=we(1,J,oe)}let V=1,G=0,Y=!1;if(b){const[J,oe]=I.get("text-size-scale-range");V=we(1,J,oe)}const re=new Map;if(y&&d)for(const J of d){const oe=y.getImage(J,E.scope);if(oe){const le=new ha(J.toString());re.set(le.toString(),oe)}}for(let J=0;J<this.symbolInstances.length;J++){const oe=this.symbolInstances.get(J),le=this.featureToAppearanceIndex[oe.featureIndex],de=le!==void 0?this.appearanceFeatureData[le]:void 0;if(!de)continue;const _e=de.id,ye=a&&_e!==void 0?a[String(_e)]:void 0,Te={type:"Point",id:de.id,properties:de.properties,geometry:[]},Ae=E.appearances&&E.appearances.find(Se=>Se.isActive({globals:p,feature:Te,canonical:i,featureState:ye}));if(b){const Se=I.get("text-size"),Oe=I.get("text-offset").evaluate(Te,ye,i),Me=Se.evaluate(Te,ye,i),st=I.get("text-rotate").evaluate(Te,ye,i),et=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,it=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,mt=Se.evaluate(Te,{zoom:et},i),ft=Se.evaluate(Te,{zoom:it},i),pt=this.updateSymbolInstanceTextVertices(oe,de,Ae,Te,G,i,E,V,re,ye,Oe,Me,st,mt,ft,et,it,d);G+=pt.vertexOffsetDelta,Y=Y||pt.hasChanges}if(_){const Se=I.get("icon-offset").evaluate(Te,ye,i),Oe=I.get("icon-size").evaluate(Te,ye,i,d),Me=I.get("icon-rotate").evaluate(Te,ye,i),st=this.updateSymbolInstanceIconVertices(oe,de,Ae,Te,D,i,d,p,E,M,ye,Se,Oe,Me);D+=st.vertexOffsetDelta,N=N||st.hasChanges}de.activeAppearance=Ae}return N&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),Y&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),N||Y}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=BU(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const d=this.lineVertexArray.length;if(i.segment!==void 0)for(const{x:p,y}of a)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y,re,J,oe){const le=i.indexArray,de=i.layoutVertexArray,_e=i.globeExtVertexArray,ye=i.segments.prepareSegment(4*oe,de,le,this.canOverlap?_.sortKey:void 0),Te=this.glyphOffsetArray.length,Ae=ye.vertexLength,Se=this.allowVerticalPlacement&&b===ol.vertical?Math.PI/2:0,Oe=_.text&&_.text.sections;for(let et=0;et<a.length;et++){const{tl:it,tr:mt,bl:ft,br:pt,texPrimary:Ke,texSecondary:yt,pixelOffsetTL:ut,pixelOffsetBR:_t,minFontScaleX:gt,minFontScaleY:Vt,glyphOffset:Ut,isSDF:kt,sectionIndex:Dt}=a[et],lr=ye.vertexLength,Jt=Ut[1];if(Mw(de,I.x,I.y,it.x,Jt+it.y,Ke.x,Ke.y,d,kt,ut.x,ut.y,gt,Vt),Mw(de,I.x,I.y,mt.x,Jt+mt.y,Ke.x+Ke.w,Ke.y,d,kt,_t.x,ut.y,gt,Vt),Mw(de,I.x,I.y,ft.x,Jt+ft.y,Ke.x,Ke.y+Ke.h,d,kt,ut.x,_t.y,gt,Vt),Mw(de,I.x,I.y,pt.x,Jt+pt.y,Ke.x+Ke.w,Ke.y+Ke.h,d,kt,_t.x,_t.y,gt,Vt),E){const{x:Ft,y:br,z:Gr}=E.anchor,[mn,$r,Ln]=E.up;Lw(_e,Ft,br,Gr,mn,$r,Ln),Lw(_e,Ft,br,Gr,mn,$r,Ln),Lw(_e,Ft,br,Gr,mn,$r,Ln),Lw(_e,Ft,br,Gr,mn,$r,Ln),G_(i.dynamicLayoutVertexArray,Ft,br,Gr,Se)}else G_(i.dynamicLayoutVertexArray,I.x,I.y,I.z,Se);if(re){const Ft=yt||Ke;Dw(i.iconTransitioningVertexArray,Ft.x,Ft.y),Dw(i.iconTransitioningVertexArray,Ft.x+Ft.w,Ft.y),Dw(i.iconTransitioningVertexArray,Ft.x,Ft.y+Ft.h),Dw(i.iconTransitioningVertexArray,Ft.x+Ft.w,Ft.y+Ft.h)}le.emplaceBack(lr,lr+1,lr+2),le.emplaceBack(lr+1,lr+2,lr+3),ye.vertexLength+=4,ye.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),et!==a.length-1&&Dt===a[et+1].sectionIndex||i.programConfigurations.populatePaintArrays(de.length,_,_.index,{},V,G,Y,Oe&&Oe[Dt],this.worldview)}const Me=oe-a.length;Me!==0&&this._addNullVertices(Me,de,d,E,_e,i,re,ye,le);const st=E?E.anchor:I;i.placedSymbolArray.emplaceBack(st.x,st.y,st.z,I.x,I.y,Te,this.glyphOffsetArray.length-Te,Ae,M,D,I.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],b,0,0,0,N,0),i.symbolInstanceIndices.push(J)}_addNullVertices(i,a,d,p,y,_,b,E,I){for(let M=0;M<i;M++){for(let N=0;N<4;N++)Mw(a,0,0,0,0,0,0,d,!1,0,0,0,0),p&&Lw(y,0,0,0,0,0,0),G_(_.dynamicLayoutVertexArray,0,0,0,0),b&&Dw(_.iconTransitioningVertexArray,0,0);const D=E.vertexLength;I.emplaceBack(D,D+1,D+2),I.emplaceBack(D+1,D+2,D+3),E.vertexLength+=4,E.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(i,a,d,p,y,_,b){i.emplaceBack(a,d,p,y,_,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(i,a,d,p,y,_,b){const E=d.segments.prepareSegment(4,d.layoutVertexArray,d.indexArray),I=E.vertexLength,M=b.tileAnchorX,D=b.tileAnchorY;for(let V=0;V<4;V++)d.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(d.collisionVertexArrayExt,a,i.padding,b.zOffset),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,M,D,new wt(i.x1,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,M,D,new wt(i.x2,i.y1)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,M,D,new wt(i.x2,i.y2)),this._commitLayoutVertex(d.layoutVertexArray,p,y,_,M,D,new wt(i.x1,i.y2)),E.vertexLength+=4;const N=d.indexArray;N.emplaceBack(I,I+1),N.emplaceBack(I+1,I+2),N.emplaceBack(I+2,I+3),N.emplaceBack(I+3,I),E.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,d,p,y,_){for(let b=p;b<y;b++){const E=d.get(b),I=this.getSymbolInstanceTextSize(i,_,a,b);this._addCollisionDebugVertices(E,I,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(i,a,d,p,y,_){for(let b=p;b<y;b++){const E=d.get(b),I=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,I,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(i,a,d){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new UM(x_,tU.members,Qa),this.iconCollisionBox=new UM(x_,tU.members,Qa);const p=B_(this.iconSizeData,i),y=B_(this.textSizeData,i,d);for(let _=0;_<this.symbolInstances.length;_++){const b=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(y,i,a,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(y,i,a,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(p,i,a,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(p,i,a,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(i,a,d,p){const y=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:p),_=MM(this.textSizeData,i,y)/jo;return this.tilePixelRatio*_}getSymbolInstanceIconSize(i,a,d){const p=this.icon.placedSymbolArray.get(d),y=MM(this.iconSizeData,i,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(i,a,d,p){i.emplaceBack(a,-d,-d,p),i.emplaceBack(a,d,-d,p),i.emplaceBack(a,d,d,p),i.emplaceBack(a,-d,d,p)}_updateTextDebugCollisionBoxes(i,a,d,p,y,_,b){for(let E=p;E<y;E++){const I=d.get(E),M=this.getSymbolInstanceTextSize(i,_,a,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,I.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(i,a,d,p,y,_,b){for(let E=p;E<y;E++){const I=d.get(E),M=this.getSymbolInstanceIconSize(i,a,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,I.padding,_.zOffset)}}updateCollisionDebugBuffers(i,a,d,p){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const y=B_(this.iconSizeData,i,p),_=B_(this.textSizeData,i,d);for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(_,i,a,E.textBoxStartIndex,E.textBoxEndIndex,E,d),this._updateTextDebugCollisionBoxes(_,i,a,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,d),this._updateIconDebugCollisionBoxes(y,i,a,E.iconBoxStartIndex,E.iconBoxEndIndex,E,p),this._updateIconDebugCollisionBoxes(y,i,a,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,d,p,y,_,b,E,I){const M={};if(a<d){const{x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:_e}=i.get(a);M.textBox={x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},M.textFeatureIndex=_e}if(p<y){const{x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:_e}=i.get(p);M.verticalTextBox={x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},M.verticalTextFeatureIndex=_e}if(_<b){const{x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:_e}=i.get(_);M.iconBox={x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},M.iconFeatureIndex=_e}if(E<I){const{x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de,featureIndex:_e}=i.get(E);M.verticalIconBox={x1:D,y1:N,x2:V,y2:G,padding:Y,projectedAnchorX:re,projectedAnchorY:J,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:de},M.verticalIconFeatureIndex=_e}return M}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(i,a){const d=i.placedSymbolArray.get(a),p=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<p;y+=4)i.indexArray.emplaceBack(y,y+1,y+2),i.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(i),d=Math.cos(i),p=[],y=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);const E=this.symbolInstances.get(b);p.push(0|Math.round(a*E.tileAnchorX+d*E.tileAnchorY)),y.push(E.featureIndex)}return _.sort((b,E)=>p[b]-p[E]||y[E]-y[b]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let i=0;i<this.symbolInstances.length;++i)this.symbolInstanceIndexesSortedZOffset.push(i)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((i,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(i).zOffset)}addToSortKeyRanges(i,a){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:I}=d;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),_>=0&&_!==y&&_!==p&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(i){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[i]).elevationFeatureIndex;let d;return this.elevationFeatures&&a<this.elevationFeatures.length&&(d=this.elevationFeatures[a]),d}}function $U(c,i){return i.replace(/{([^{}]+)}/g,(a,d)=>d in c?String(c[d]):"")}let VU,UU,GM;Wt(x2,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),x2.addDynamicAttributes=G_;class GU{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:da,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Wt(GU,"FormatSectionOverride",{omit:["defaultValue"]});const qM=()=>GM||(GM={layout:VU||(VU=new bi({"symbol-placement":new Ct(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ct(Ue.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ct(Ue.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ct(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ct(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(Ue.layout_symbol["icon-size"]),"icon-size-scale-range":new Ct(Ue.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new zt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(Ue.layout_symbol["icon-image"]),"icon-image-use-theme":new Ct({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new zt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new Ct(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new zt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new zt(Ue.layout_symbol["text-field"]),"text-font":new zt(Ue.layout_symbol["text-font"]),"text-size":new zt(Ue.layout_symbol["text-size"]),"text-size-scale-range":new Ct(Ue.layout_symbol["text-size-scale-range"]),"text-max-width":new zt(Ue.layout_symbol["text-max-width"]),"text-line-height":new zt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new zt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new zt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new zt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new Ct(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new zt(Ue.layout_symbol["text-rotate"]),"text-padding":new Ct(Ue.layout_symbol["text-padding"]),"text-keep-upright":new Ct(Ue.layout_symbol["text-keep-upright"]),"text-transform":new zt(Ue.layout_symbol["text-transform"]),"text-offset":new zt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ct(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(Ue.layout_symbol["text-optional"]),visibility:new Ct(Ue.layout_symbol.visibility)})),paint:UU||(UU=new bi({"icon-opacity":new zt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new zt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new zt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new zt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new zt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new zt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ct(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new zt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new zt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new zt(Ue.paint_symbol["text-color"],{runtimeType:Ws,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new zt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new zt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new Ct(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ct(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ct(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ct(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ct(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new zt(Ue.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},GM);class b2 extends Ks{constructor(i,a,d,p){super(i,qM(),a,d,p,i.layout?i.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=B([]),this.hasOcclusionOpacityProperties=i.paint!==void 0&&("icon-occlusion-opacity"in i.paint||"text-occlusion-opacity"in i.paint)}_handleSpecialPaintPropertyUpdate(i){i!=="icon-occlusion-opacity"&&i!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(i,a){super.recalculate(i,a),this.appearances&&this.appearances.forEach(p=>{p.recalculate(i,a,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const d=this.layout.get("text-writing-mode");if(d){const p=[];for(const y of d)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(i,a,d,p){return this._saturation===i&&this._contrast===a&&this._brightnessMin===d&&this._brightnessMax===p||(this._colorAdjustmentMatrix=function(y,_,b,E){y=ls(y),_=Ai(_);const I=$(),M=y/3,D=1-2*M,N=[D,M,M,0,M,D,M,0,M,M,D,0,0,0,0,1],V=.5-.5*_,G=E-b;return q(I,[G,0,0,0,0,G,0,0,0,0,G,0,b,b,b,1],[_,0,0,0,0,_,0,0,0,0,_,0,V,V,V,1]),q(I,I,N),I}(i,a,d,p),this._saturation=i,this._contrast=a,this._brightnessMin=d,this._brightnessMax=p),this._colorAdjustmentMatrix}getValueAndResolveTokens(i,a,d,p){const y=this.layout.get(i).evaluate(a,{},d,p),_=this._unevaluatedLayout._values[i];return _.isDataDriven()||Mm(_.value)||!y?y:$U(a.properties,y)}getAppearanceValueAndResolveTokens(i,a,d,p,y){const _=i.getProperty(a);if(!_)return;const b=_.evaluate(d,{},p,y),E=i.getUnevaluatedProperties()._values[a];return E.isDataDriven()||Mm(E.value)||!b||typeof b!="string"?b:$U(d.properties,b)}createBucket(i){return new x2(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of qM().paint.overridableProperties){if(!b2.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),d=new GU(a),p=new c_(d,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let y=null;y=a.value.kind==="constant"||a.value.kind==="source"?new Dm("source",p):new ah("composite",p,a.value.zoomStops,a.value.interpolationType),this.paint._values[i]=new ch(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&b2.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const d=i.get("text-field"),p=qM().paint.properties[a];let y=!1;const _=b=>{for(const E of b)if(p.overrides&&p.overrides.hasOverride(E))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof ks)_(d.value.value.sections);else if(d.value.kind==="source"){const b=I=>{y||(I instanceof uu&&Co(I.value)===yf?_(I.value.sections):I instanceof Qt?_(I.sections):I.eachChild(b))},E=d.value;E._styleExpression&&b(E._styleExpression.expression)}return y}getProgramIds(){return["symbol"]}getDefaultProgramParams(i,a,d){return{config:new z(this,{zoom:a,lut:d}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let qU,HU,WU,ZU;var HM=Zr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function w2(c,i,a,d,p,y,_,b){const E=[c,i,1,a,d,1,p,y,1],I=[_,b,1],M=k([],E),[D,N,V]=Xr(I,I,M);return L(E,E,[D,0,0,0,N,0,0,0,V])}function XU(c,i,a,d,p,y,_,b){const E=function(I,M,D,N,V,G,Y,re){const J=w2(0,0,1,0,1,1,0,1),oe=w2(I,M,D,N,V,G,Y,re);return L(oe,oe,k([],J))}(c,i,a,d,p,y,_,b);return[E[2]/E[8]/Mt,E[5]/E[8]/Mt]}function S2(c){return[c[0],Math.min(Math.max(c[1],-85.051129),Re)]}class KU extends cu{constructor(i,a,d,p){super(),this.id=i,this.dispatcher=d,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(p),this.options=a,this._dirty=!1}load(i,a){if(this._loaded=a||!1,this.fire(new lu("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return i&&(this.coordinates=i),this._loaded=!0,void this._finishLoading();this._imageRequest=My(this.map._requestManager.transformRequest(this.url,ca.Image),(d,p)=>{this._imageRequest=null,this._loaded=!0,d?this.fire(new ym(d)):p&&(this.image=p instanceof HTMLImageElement?Za.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}setTexture(i){if(!(i.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new xw(this.map.painter.context,i.handle),this.width=i.dimensions[0],this.height=i.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new lu("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(i){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof xw||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(i){if(this.coordinates=i,this._boundsArray=void 0,this._unsupportedCoords=!1,!i.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=i[0][1],d=i[0][1];for(const y of i)y[1]>d&&(d=y[1]),y[1]<a&&(a=y[1]);const p=(d+a)/2;if(p>Re?this.onNorthPole=!0:p<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const y=i.map(Lt.fromLngLat);this.tileID=function(_){let b=1/0,E=1/0,I=-1/0,M=-1/0;for(const Y of _)b=Math.min(b,Y.x),E=Math.min(E,Y.y),I=Math.max(I,Y.x),M=Math.max(M,Y.y);const D=Math.max(I-b,M-E),N=Math.max(0,Math.floor(-Math.log2(D))),V=Math.pow(2,N);let G=Math.floor((b+I)/2*V);return G>1&&(G-=1),new Jm(N,G,Math.floor((E+M)/2*V))}(y),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new lu("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof xw||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(i){for(const J in this.tiles){const oe=this.tiles[J];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=Cw(new Jm(0,0,0),this.map.transform.projection),d=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(J){const oe=J[1].x-J[0].x,le=J[1].y-J[0].y,de=J[2].x-J[1].x,_e=J[2].y-J[1].y,ye=J[3].x-J[2].x,Te=J[3].y-J[2].y,Ae=J[0].x-J[3].x,Se=J[0].y-J[3].y,Oe=oe*_e-de*le,Me=de*Te-ye*_e,st=ye*Se-Ae*Te,et=Ae*le-oe*Se;return Oe>0&&Me>0&&st>0&&et>0||Oe<0&&Me<0&&st<0&&et<0}(d))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const p=Cw(this.tileID,this.map.transform.projection),[y,_,b,E]=this.coordinates.map(J=>{const oe=p.projection.project(J[0],J[1]);return LU(p,oe)._round()});this.perspectiveTransform=XU(y.x,y.y,_.x,_.y,b.x,b.y,E.x,E.y);const I=this._boundsArray=new mu;I.emplaceBack(y.x,y.y,0,0),I.emplaceBack(_.x,_.y,Mt,0),I.emplaceBack(E.x,E.y,0,Mt),I.emplaceBack(b.x,b.y,Mt,Mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=i.createVertexBuffer(I,HM.members),this.boundsSegments=di.simpleSegment(0,0,4,2);const M=[],D=[S2((N=this.coordinates)[0]),S2(N[1]),S2(N[2]),S2(N[3])];var N;const[V,G,Y,re]=function(J){let oe=J[0][0],le=oe,de=J[0][1],_e=de;for(let ye=1;ye<J.length;ye++)J[ye][0]<oe?oe=J[ye][0]:J[ye][0]>le&&(le=J[ye][0]),J[ye][1]<de?de=J[ye][1]:J[ye][1]>_e&&(_e=J[ye][1]);return[oe,de,le-oe,_e-de]}(D);{const J=new mu,[oe,le,de,_e]=function(pt){let Ke=pt[0].x,yt=Ke,ut=pt[0].y,_t=ut;for(let gt=1;gt<pt.length;gt++)pt[gt].x<Ke?Ke=pt[gt].x:pt[gt].x>yt&&(yt=pt[gt].x),pt[gt].y<ut?ut=pt[gt].y:pt[gt].y>_t&&(_t=pt[gt].y);return[Ke,ut,yt-Ke,_t-ut]}(d),ye=pt=>[(pt.x-oe)/de,(pt.y-le)/_e],[Te,Ae,Se,Oe]=d.map(ye),Me=function(pt,Ke,yt,ut,_t,gt,Vt,Ut){const kt=w2(0,0,1,0,1,1,0,1);return L(kt,kt,k([],w2(pt,Ke,yt,ut,_t,gt,Vt,Ut)))}(Te[0],Te[1],Ae[0],Ae[1],Se[0],Se[1],Oe[0],Oe[1]);this.elevatedGlobePerspectiveTransform=XU(Te[0],Te[1],Ae[0],Ae[1],Se[0],Se[1],Oe[0],Oe[1]);const st=(pt,Ke)=>{M.push(pt.lng);const yt=Math.round((pt.lng-V)/Y*Mt),ut=Math.round((pt.lat-G)/re*Mt),_t=ye(Ke),gt=Xr([],[_t[0],_t[1],1],Me),Vt=Math.round(gt[0]/gt[2]*Mt),Ut=Math.round(gt[1]/gt[2]*Mt);J.emplaceBack(yt,ut,Vt,Ut)},et=d[3].x-d[0].x,it=d[3].y-d[0].y,mt=d[2].x-d[1].x,ft=d[2].y-d[1].y;for(let pt=0;pt<65;pt++){const Ke=pt/64,yt=[d[0].x+Ke*et,d[0].y+Ke*it],ut=[d[1].x+Ke*mt,d[1].y+Ke*ft],_t=ut[0]-yt[0],gt=ut[1]-yt[1];for(let Vt=0;Vt<65;Vt++){const Ut=Vt/64,kt={x:yt[0]+_t*Ut,y:yt[1]+gt*Ut};st(a.projection.unproject(kt.x,kt.y),kt)}}this.elevatedGlobeVertexBuffer=i.createVertexBuffer(J,HM.members)}{this.maxLongitudeTriangleSize=0;let J=[],oe=new go;const le=(de,_e,ye)=>{oe.emplaceBack(de,_e,ye);const Te=M[de],Ae=M[_e],Se=M[ye],Oe=Math.min(Math.min(Te,Ae),Se),Me=Math.max(Math.max(Te,Ae),Se)-Oe;Me>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Me),J.push(Oe+Me/2)};for(let de=0;de<64;de++)for(let _e=0;_e<64;_e++){const ye=65*de+_e,Te=ye+1,Ae=ye+65,Se=Ae+1;le(ye,Ae,Te),le(Te,Ae,Se)}[J,oe]=function(de,_e){const ye=Array.from({length:de.length},(Se,Oe)=>Oe);ye.sort((Se,Oe)=>de[Se]-de[Oe]);const Te=[],Ae=new go;for(let Se=0;Se<ye.length;Se++){const Oe=ye[Se];Te.push(de[Oe]);const Me=3*Oe,st=Me+1;Ae.emplaceBack(_e.uint16[Me],_e.uint16[st],_e.uint16[st+1])}return[Te,Ae]}(J,oe),this.elevatedGlobeTrianglesCenterLongitudes=J,this.elevatedGlobeIndexBuffer=i.createIndexBuffer(oe)}this.elevatedGlobeSegments=di.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Y/Mt,0,re/Mt,0,0,G,V,0])}prepare(){const i=Object.keys(this.tiles).length!==0;if(this.tileID&&!i)return;const a=this.map.painter.context,d=a.gl;!this._dirty||this.texture instanceof xw||(this.texture?this.texture.update(this.image):(this.texture=new gM(a,this.image,d.RGBA8),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._dirty=!1),i&&this._prepareData(a)}loadTile(i,a){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},a(null)):(i.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(i){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const d=this.elevatedGlobeTrianglesCenterLongitudes;let p=(y=i+180)+360*Math.round((d[0]-y)/360);var y;const _=new di,b=(D,N)=>{_.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:a.segments[0].vertexLength,primitiveLength:N,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(d[0]-p)<=E){const D=$n(d,0,d.length,p+E);return D===d.length||b(D,Bn(d,D+1,d.length,p+360-E)-D),_}p<d[0]&&(p+=360);const I=Bn(d,0,d.length,p-E);if(I===d.length)return b(0,d.length),_;b(0,I-0);const M=$n(d,I+1,d.length,p+E);return M!==d.length&&b(M,d.length-M),_}}const Nhe=(Math.pow(256,2)-1)/16907520;class YU extends Ks{constructor(i,a,d,p){super(i,{layout:WU||(WU=new bi({visibility:new Ct(Ue.layout_raster.visibility)})),paint:ZU||(ZU=new bi({"raster-opacity":new Ct(Ue.paint_raster["raster-opacity"]),"raster-color":new Df(Ue.paint_raster["raster-color"]),"raster-color-mix":new Ct(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new Ct(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ct(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(Ue.paint_raster["raster-saturation"]),"raster-contrast":new Ct(Ue.paint_raster["raster-contrast"]),"raster-resampling":new Ct(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ct(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ct(Ue.paint_raster["raster-array-band"]),"raster-elevation":new Ct(Ue.paint_raster["raster-elevation"]),"raster-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},a,d,p),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(i){return!(i&&i._source instanceof KU&&(i._source.onNorthPole||i._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(i){i!=="raster-color"&&i!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(i){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[d,p]=i||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(d)&&isNaN(p)||d===this._curRampRange[0]&&p===this._curRampRange[1]||(this.colorRamp=nw({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:d,end:p}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[d,p])}}let JU,QU,e6,t6,r6;class n6 extends Ks{constructor(i,a,d,p){super(i,{layout:JU||(JU=new bi({visibility:new Ct(Ue["layout_raster-particle"].visibility)})),paint:QU||(QU=new bi({"raster-particle-array-band":new Ct(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ct(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Df(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ct(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ct(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ct(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ct(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ct(Ue["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},a,d,p),this._updateColorRamp(),this.lastInvalidatedAt=Za.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(i){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(i){return!1}_handleSpecialPaintPropertyUpdate(i){i!=="raster-particle-color"&&i!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),i==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const i=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=nw({expression:i,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Za.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class zhe extends Ks{constructor(i,a){super(i,{},a,null),this.implementation=i,i.slot&&(this.slot=i.slot)}is3D(i){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(i){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}function WM(c,i,a){const d=[0,0,1],p=Tn([]);return Po(p,p,a?-an(c)+Math.PI:an(c)),Kn(p,p,-an(i)),Vn(d,d,p),Rt(d,d)}const i6={None:0,Model:1,Symbol:2,FillExtrusion:4};class T2{constructor(i,a,d,p){this.message=(i?`${i}: `:"")+d,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)}}function ZM(c,i){const a=c.indexOf("://")===-1;try{return new URL(c,a&&i?"http://example.com":void 0),!0}catch{return!1}}class o6{constructor(i,a){this.feature=i,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class s6{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Jb,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(i){const a=16*i,d=this.instancedDataArray.float32;let p=Math.floor(d[a+2]);const y=1.05*(d[a+2]-p);return p/=100,[d[a]%1*1.05,d[a+1]%1*1.05,y,p]}tileCoordinatesForInstance(i){const a=16*i,d=this.instancedDataArray.float32;let p=d[a+0];return p=p>Mt?p-Mt:p,new wt(Math.trunc(p),Math.trunc(d[a+1]))}translationForInstance(i){const a=16*i,d=this.instancedDataArray.float32;return[d[a+4],d[a+5],d[a+6]]}rotationScaleForInstance(i){const a=16*i,d=this.instancedDataArray.float32;return[d[a+7],d[a+8],d[a+9],d[a+10],d[a+11],d[a+12],d[a+13],d[a+14],d[a+15]]}transformForInstance(i){const a=16*i,d=this.instancedDataArray.float32;return[d[a+7],d[a+8],d[a+9],d[a+4],d[a+10],d[a+11],d[a+12],d[a+5],d[a+13],d[a+14],d[a+15],d[a+6],0,0,0,1]}}class XM{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaledZ=this.canonical.z+Math.log2(i.overscaling),this.layers=i.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=i.projection,this.index=i.index,this.worldview=i.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=i.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(i,a){}updateAppearances(i,a,d,p){}populate(i,a,d,p){this.tileToMeter=At(d);const y=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:b,index:E,sourceLayerIndex:I}of i){const M=b??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),D=Lr(_,y);if(!this.layers[0]._featureFilter.filter(new Dn(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),D,d))continue;const N={id:M,sourceLayerIndex:I,index:E,geometry:y?D.geometry:yr(_,d,p),properties:_.properties,type:_.type,patterns:{}},V=this.addFeature(N,N.geometry,D);V&&a.featureIndex.insert(_,N.geometry,E,I,this.index,this.instancesPerModel[V].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const i=this.layers[0].modelManager,a=this.layers[0].scope;let d=0;for(const p of this.modelUris){const y=i.getModel(p,a);if(!y)continue;const _=this.instancesPerModel[p];if(_){const b=.5*Yr(y.aabb.max,y.aabb.min)*_.maxScale+_.maxXYTranslationDistance,E=Math.min(Mt,Math.max(b/this.tileToMeter,256));d=Math.max(E,d)}}return d}update(i,a,d,p){for(const y in this.instancesPerModel){const _=this.instancesPerModel[y];for(const b in i)_.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(_.features[_.idToFeaturesIndex[b]],i[b],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let i=!1;for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];for(const p of d.features){const y=this.layers[0],_=p.feature,b=this.canonical,E=y.paint.get("model-rotation").evaluate(_,{},b),I=y.paint.get("model-scale").evaluate(_,{},b),M=y.paint.get("model-translation").evaluate(_,{},b);ei(p.rotation,E)&&ei(p.scale,I)&&ei(p.translation,M)||(this.evaluate(p,p.featureStates,d,!0),i=!0)}}return i}updateReplacement(i,a,d,p){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const y=a.getReplacementRegionsForTile(i.toUnwrapped(),!0);if(ZA(this.activeReplacements,y))return!1;this.activeReplacements=y;let _=!1;for(const b in this.instancesPerModel){const E=this.instancesPerModel[b],I=E.instancedDataArray;for(const M of E.features){const D=M.instancedDataOffset,N=M.instancedDataCount;for(let V=0;V<N;V++){const G=16*(V+D);let Y=I.float32[G+0];const re=Y>Mt;Y=re?Y-Mt:Y;const J=Math.floor(Y),oe=Math.floor(I.float32[G+1]);let le=!1;for(const de of this.activeReplacements)if(!F$(de,d,i6.Model,p)&&!(de.min.x>J||J>de.max.x||de.min.y>oe||oe>de.max.y)&&(le=G$(U$(J,oe,i.canonical,de.footprintTileId.canonical),de.footprint),le))break;I.float32[G]=le?Y+Mt:Y,_=_||le!==re}}}return _}isEmpty(){for(const i in this.instancesPerModel)if(this.instancesPerModel[i].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(i){if(!this.uploaded)for(const a in this.instancesPerModel){const d=this.instancesPerModel[a];d.instancedDataArray.length<0||d.instancedDataArray.length===0||(d.instancedDataBuffer?d.instancedDataBuffer.updateData(d.instancedDataArray):d.instancedDataBuffer=i.createVertexBuffer(d.instancedDataArray,sde.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(i){for(const d in this.instancesPerModel){const p=this.instancesPerModel[d];p.instancedDataArray.length!==0&&p.instancedDataBuffer&&p.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(i&&a&&this.modelUris&&this.modelsRequested)for(const d of this.modelUris)a.removeModel(d,"",!0)}addFeature(i,a,d){const p=this.layers[0],y=p.layout.get("model-id"),_=p.layout.get("model-allow-density-reduction"),b=y.evaluate(d,{},this.canonical);if(!b)return vr(`modelId is not evaluated for layer ${p.id} and it is not going to get rendered.`),b;(ZM(b,!1)||this.styleDefinedModelURLs[b]!==void 0)&&(this.modelUris.includes(b)||this.modelUris.push(b)),this.instancesPerModel[b]||(this.instancesPerModel[b]=new s6);const E=this.instancesPerModel[b],I=E.instancedDataArray,M=new o6(d,I.length);for(const D of a)for(const N of D){if(N.x<0||N.x>=Mt||N.y<0||N.y>=Mt)continue;if(this.lookupDim!==0&&_){const G=(this.lookupDim-1)/Mt,Y=this.lookupDim*(N.y*G|0)+N.x*G|0;if(this.lookup){if(this.lookup[Y]!==0)continue;this.lookup[Y]=1}}this.instanceCount++;const V=I.length;I.resize(V+1),E.instancesEvaluatedElevation.push(0),I.float32[16*V]=N.x,I.float32[16*V+1]=N.y}return M.instancedDataCount=E.instancedDataArray.length-M.instancedDataOffset,M.instancedDataCount>0&&(i.id&&(E.idToFeaturesIndex[i.id]=E.features.length),E.features.push(M),this.evaluate(M,{},E,!1)),b}getModelUris(){return this.modelUris}evaluate(i,a,d,p){const y=this.layers[0],_=i.feature,b=this.canonical,E=i.rotation=y.paint.get("model-rotation").evaluate(_,a,b),I=i.scale=y.paint.get("model-scale").evaluate(_,a,b),M=i.translation=y.paint.get("model-translation").evaluate(_,a,b),D=Object.assign({},y.paint.get("model-color").evaluate(_,a,b));D.a=y.paint.get("model-color-mix-intensity").evaluate(_,a,b);const N=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const V=M[0]*M[0]+M[1]*M[1],G=V>0?Math.sqrt(V):0;d.maxScale=Math.max(Math.max(d.maxScale,I[0]),Math.max(I[1],I[2])),d.maxXYTranslationDistance=Math.max(d.maxXYTranslationDistance,G),this.maxScale=Math.max(Math.max(this.maxScale,I[0]),Math.max(I[1],I[2])),DV(N,E,I);const Y=Math.round(100*D.a)+D.b/1.05;for(let re=0;re<i.instancedDataCount;++re){const J=i.instancedDataOffset+re,oe=16*J,le=d.instancedDataArray.float32;let de=0;p&&(de=le[oe+6]-d.instancesEvaluatedElevation[J]);const _e=0|le[oe+1];le[oe]=(0|le[oe])+D.r/1.05,le[oe+1]=_e+D.g/1.05,le[oe+2]=Y,le[oe+3]=1/(b.z>10?this.tileToMeter:At(b,_e)),le[oe+4]=M[0],le[oe+5]=M[1],le[oe+6]=M[2]+de,le[oe+7]=N[0],le[oe+8]=N[1],le[oe+9]=N[2],le[oe+10]=N[4],le[oe+11]=N[5],le[oe+12]=N[6],le[oe+13]=N[8],le[oe+14]=N[9],le[oe+15]=N[10],d.instancesEvaluatedElevation[J]=M[2]}}}let a6,l6;Wt(XM,"ModelBucket",{omit:["layers"]}),Wt(s6,"PerModelAttributes"),Wt(o6,"ModelFeature");class q_{constructor(i,a,d){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=d}static create(i,a,d){const p=d||i.findDEMTileFor(a);if(!p||!p.dem)return;const y=p.dem,_=p.tileID,b=1<<a.canonical.z-_.canonical.z;return new q_(p,y.dim/Mt/b,[(a.canonical.x/b-_.canonical.x)*y.dim,(a.canonical.y/b-_.canonical.y)*y.dim])}tileCoordToPixel(i,a){const d=a*this._scale+this._offset[1];return new wt(Math.floor(i*this._scale+this._offset[0]),Math.floor(d))}getElevationAt(i,a,d,p){const y=i*this._scale+this._offset[0],_=a*this._scale+this._offset[1],b=Math.floor(y),E=Math.floor(_),I=this._dem;return p=!!p,d?mr(mr(I.get(b,E,p),I.get(b,E+1,p),_-E),mr(I.get(b+1,E,p),I.get(b+1,E+1,p),_-E),y-b):I.get(b,E,p)}getElevationAtPixel(i,a,d){return this._dem.get(i,a,!!d)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Xe(1,i)*this._dem.stride}}const KM=new Float32Array(262144),sg=new Uint8Array(262144);function c6(c){let i=0;if(c.meshes)for(const a of c.meshes)i=Math.max(i,a.aabb.max[2]);if(c.children)for(const a of c.children)i=Math.max(i,c6(a));return i}function u6(c,i,a){if(c.meshes)for(const d of c.meshes){if(d.aabb.min[0]===1/0)continue;const p=vn.applyTransform(d.aabb,c.globalMatrix);a.insert(i,p.min[0],p.min[1],p.max[0],p.max[1])}if(c.children)for(const d of c.children)u6(d,i,a)}const d6=["","wall","door","roof","window","lamp","logo"];class h6{constructor(i){this.node=i,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:i.id,geometry:[],properties:{height:c6(i)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let i=0;const a=new vn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const d of this.node.meshes)this.node.lightMeshIndex!==i&&(d.transformedAabb=vn.applyTransformFast(d.aabb,this.node.globalMatrix),a.encapsulate(d.transformedAabb)),i++;this.aabb=a}return this.aabb}}class E2{constructor(i,a,d,p,y,_,b,E){this.id=d,this.layers=i,this.layerIds=this.layers.map(I=>I.fqid),this.stateDependentLayerIds=this.layers.filter(I=>I.isStateDependent()).map(I=>I.id),this.modelTraits|=N_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,p&&(this.modelTraits|=N_.HasMapboxMeshFeatures),y&&(this.modelTraits|=N_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const I of a)this.nodesInfo.push(new h6(I)),u6(I,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(i,a){for(const d of this.getNodesInfo()){const p=d.node;p.footprint&&a.push({footprint:p.footprint,id:i})}}updateAppearances(i,a,d,p){}update(i){const a=Object.keys(i).length!==0;if(a&&!this.stateDependentLayers.length)return;const d=a?this.stateDependentLayers:this.layers;if(!Cs(i,this.states))for(const p of d)this.evaluate(p,i);this.states=structuredClone(i)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(i){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const d of a){const p=d.node;this.uploaded?this.updatePbrBuffer(p):vM(p,i,!0)}for(const d of a)s2(d.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(i){let a=!1;if(!i.meshes)return a;for(const d of i.meshes)d.pbrBuffer&&(d.pbrBuffer.updateData(d.featureArray),a=!0);return a}needsReEvaluation(i,a,d){const p=i.transform.projectionOptions,y=i.style.getBrightness(),_=this.brightness!==y;if(!this.uploaded||this.dirty||p.name!==this.projection.name||jw(d.paint.get("model-color").value,_)||jw(d.paint.get("model-color-mix-intensity").value,_)||jw(d.paint.get("model-roughness").value,_)||jw(d.paint.get("model-emissive-strength").value,_)||jw(d.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=p,this.brightness=y;const b=this.getNodesInfo();for(const E of b)E.state=null;return!0}return!1}evaluateTransform(i,a){if(i.transform.zoom===this.zoom)return;this.zoom=i.transform.zoom;const d=this.getNodesInfo(),p=this.id.canonical;for(const y of d){const _=y.feature;y.evaluatedTranslation=a.paint.get("model-translation").evaluate(_,{},p),y.evaluatedScale=a.paint.get("model-scale").evaluate(_,{},p)}}evaluate(i,a){const d=this.getNodesInfo();for(const p of d){if(!p.node.meshes)continue;const y=p.feature,_=a&&a[y.id];if(Cs(_,p.state))continue;p.state=structuredClone(_);const b=p.node.meshes&&p.node.meshes[0].featureData,E=p.evaluatedColor[2],I=p.evaluatedRMEA[2],M=this.id.canonical;if(p.hasTranslucentParts=!1,b){for(let D=0;D<d6.length;D++){const N=d6[D];N.length&&(y.properties.part=N);const V=i.paint.get("model-color").evaluate(y,_,M).toPremultipliedRenderColor(null),G=i.paint.get("model-color-mix-intensity").evaluate(y,_,M);p.evaluatedColor[D]=[V.r,V.g,V.b,G],p.evaluatedRMEA[D][0]=i.paint.get("model-roughness").evaluate(y,_,M),p.evaluatedRMEA[D][2]=i.paint.get("model-emissive-strength").evaluate(y,_,M),p.evaluatedRMEA[D][3]=V.a,p.emissionHeightBasedParams[D]=i.paint.get("model-height-based-emissive-strength-multiplier").evaluate(y,_,M),!p.hasTranslucentParts&&V.a<1&&(p.hasTranslucentParts=!0)}delete y.properties.part,Bhe(p,E!==p.evaluatedColor[2]||I!==p.evaluatedRMEA[2],this.modelTraits)}else p.evaluatedRMEA[0][2]=i.paint.get("model-emissive-strength").evaluate(y,_,M);p.evaluatedTranslation=i.paint.get("model-translation").evaluate(y,_,M),p.evaluatedScale=i.paint.get("model-scale").evaluate(y,_,M),this.updatePbrBuffer(p.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(i,a,d,p){const y=i.findDEMTileFor(d);if(y&&(y.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(y.dem&&y.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=y.tileID.overscaledZ;const _=q_.create(i,d,y);if(!_)return;this.modelTraits&N_.HasMapboxMeshFeatures&&this.updateDEM(i,_,d,p);for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const I=E.footprint.vertices;let M=_.getElevationAt(I[0].x,I[0].y,!0,!0);for(let D=1;D<I.length;D++)M=Math.min(M,_.getElevationAt(I[D].x,I[D].y,!0,!0));E.elevation=M}}this.terrainTile=y.tileID.canonical,this.terrainExaggeration=a}}updateDEM(i,a,d,p){let y=a._dem._modifiedForSources[p];if(y===void 0&&(a._dem._modifiedForSources[p]=[],y=a._dem._modifiedForSources[p]),y.includes(d.canonical))return;const _=a._dem.dim;y.push(d.canonical);let b=!1;for(const E of this.getNodesInfo()){const I=E.node;if(!I.footprint||!I.footprint.grid)continue;const M=I.footprint.grid,D=a.tileCoordToPixel(M.min.x,M.min.y),N=a.tileCoordToPixel(M.max.x,M.max.y),V=Math.min(Math.min(_-N.y,D.x),Math.min(D.y,_-N.x));if(V<0)continue;const G=we(V,2,5);let Y=Math.max(0,D.x-G),re=Math.max(0,D.y-G),J=Math.min(N.x+G,_-1),oe=Math.min(N.y+G,_-1);for(let ye=re;ye<=oe;++ye)for(let Te=Y;Te<=J;++Te)sg[ye*_+Te]=255;let le=0,de=0;for(let ye=0;ye<M.cellsY;++ye)for(let Te=0;Te<M.cellsX;++Te){if(!M.cells[ye*M.cellsX+Te])continue;const Ae=a.tileCoordToPixel(M.min.x+Te/M.xScale,M.min.y+ye/M.yScale),Se=a.tileCoordToPixel(M.min.x+(Te+1)/M.xScale,M.min.y+(ye+1)/M.yScale);for(let Oe=Ae.y;Oe<=Math.min(Se.y+1,_-1);++Oe)for(let Me=Ae.x;Me<=Math.min(Se.x+1,_-1);++Me)sg[Oe*_+Me]===255&&(sg[Oe*_+Me]=0,le+=a.getElevationAtPixel(Me,Oe),de++)}const _e=le/de;Y=Math.max(1,D.x-G),re=Math.max(1,D.y-G),J=Math.min(N.x+G,_-2),oe=Math.min(N.y+G,_-2),b=!0;for(let ye=re;ye<=oe;++ye)for(let Te=Y;Te<=J;++Te)sg[ye*_+Te]===0&&(KM[ye*_+Te]=a._dem.set(Te,ye,_e));for(let ye=1;ye<G;++ye){Y=Math.max(1,D.x-ye),re=Math.max(1,D.y-ye),J=Math.min(N.x+ye,_-2),oe=Math.min(N.y+ye,_-2);for(let Te=re;Te<=oe;++Te)for(let Ae=Y;Ae<=J;++Ae){const Se=Te*_+Ae;if(sg[Se]===255){let Oe=0,Me=0,st=-1,et=-1;for(let it=-1;it<=1;++it)for(let mt=-1;mt<=1;++mt){const ft=(Te+it)*_+Ae+mt;if(sg[ft]>=ye)continue;const pt=KM[ft],Ke=Math.abs(pt);Ke>Me&&(Oe=pt,Me=Ke,st=mt,et=it)}if(Me>.1){const it=1-(ye+.5*Math.abs(st*et))/G;let mt=a._dem.get(Ae,Te)+Oe*it;const ft=a._dem.get(Ae+st,Te+et),pt=a._dem.get(Ae-st,Te-et,!0);(mt-ft)*(mt-pt)>0&&(mt=(ft+pt)/2),KM[Se]=a._dem.set(Ae,Te,mt),sg[Se]=ye}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Za.now())}setFilter(i){this.filter=i?zb(i):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(i=>this.filter.filter(new Dn(this.id.overscaledZ,{worldview:this.worldview}),i.feature,this.id.canonical)):this.nodesInfo}destroy(){const i=this.getNodesInfo();for(const a of i)s2(a.node),xM(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(i,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(i.toUnwrapped());for(const p of this.getNodesInfo()){const y=p.node.footprint;p.hiddenByReplacement=!!y&&!d.find(_=>_.footprint===y)}}getHeightAtTileCoord(i,a){const d=[],p=[0,0,0],y=B([]);for(const _ of this.getNodesInfo()){const b=_.node.meshes[0],E=b.transformedAabb;if(i<E.min[0]||a<E.min[1]||i>E.max[0]||a>E.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};U(y,_.node.globalMatrix),p[0]=i,p[1]=a,Ir(p,p,y);const I=(p[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*rg|0,M=Math.min(63,(p[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*rg|0)*rg+Math.min(63,I),D=b.heightmap[M];if(!(D<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:D,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new wt(i,a),new wt(i,a),d),d.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function jw(c,i){return c instanceof Dm&&!c.isLightConstant&&i}function Fhe(c,i,a,d,p,y,_,b){let E=(61440&i|(61440&i)>>4)>>8,I=(3840&i|(3840&i)>>4)>>4,M=240&i|(240&i)>>4;a[3]>0&&(E=mr(E,255*a[0],a[3]),I=mr(I,255*a[1],a[3]),M=mr(M,255*a[2],a[3]));const D=E<<8|I,N=M<<8|Math.floor(255*d[3]),V=function(ye){const Te=we(ye,0,2);return Math.min(Math.round(.5*Te*255),255)}(d[2])<<8|15*d[0]<<4|15*d[1],G=we(p[0],0,1),Y=we(p[1],0,1),re=we(p[2],0,1),J=we(p[3],0,1);let oe,le,de,_e;if(G!==Y&&_!==y&&Y!==G){const ye=_-y;le=1/(ye*(Y-G)),de=-(y+ye*G)/(ye*(Y-G));const Te=we(p[4],-1,1);_e=Math.pow(10,Te),oe=255*re<<8|255*J}else oe=65535,le=0,de=1,_e=1;if(c.emplaceBack(D,N,V,oe,le,de,_e),b){const ye=b.length;b.clear();for(let Te=0;Te<ye;Te++)b.emplaceBack(D,N,V,oe,le,de,_e)}}function Bhe(c,i,a){const d=c.node;let p=0;const y=a&N_.HasMeshoptCompression;for(const _ of d.meshes){if(d.lights&&d.lightMeshIndex===p||!_.featureData)continue;_.featureArray=new qm,_.featureArray.reserve(_.featureData.length);let b=i;for(const E of _.featureData){const I=y?65535&E:E>>16&65535,M=y?E>>16&65535:65535&E,D=(15&M)<8?15&M:0,N=c.evaluatedRMEA[D],V=c.evaluatedColor[D],G=c.emissionHeightBasedParams[D];let Y;if(b&&D===2&&d.lights&&(Y=new qm,Y.resize(10*d.lights.length)),Fhe(_.featureArray,I,V,N,G,_.aabb.min[2],_.aabb.max[2],Y),Y&&b){b=!1;const re=d.meshes[d.lightMeshIndex];re.featureArray=Y,re.featureArray._trim()}}_.featureArray._trim(),p++}}Wt(E2,"Tiled3dModelBucket",{omit:["layers"]}),Wt(h6,"Tiled3dModelFeature");const $he=["id","tile","layer","source","sourceLayer","state"];class ag{constructor(i,a,d,p,y){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=d,this._y=p,this.properties=i?i.properties:{},this.id=y}clone(){const i=new ag(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(i.state=Object.assign({},this.state)),this.layer&&(i.layer=Object.assign({},this.layer)),this.source&&(i.source=this.source),this.sourceLayer&&(i.sourceLayer=this.sourceLayer),i}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of $he)this[a]!==void 0&&(i[a]=this[a]);return i}}class lg extends cu{constructor(i,a,d,p){super(),this.id=i,this.type="model",this.models=[],this._options=a,this._modelsInfo=new Map}loadGLTFFromURI(i){return OV(this.map._requestManager.transformRequest(i,ca.Model).url)}load(){for(const i in this._options.models){const a=this._options.models[i],d=this._modelsInfo.get(i);if(d){d.modelSpec=a;const p=d.model;p&&(p.position=a.position!=null?new ve(a.position[0],a.position[1]):new ve(0,0),p.orientation=a.orientation!=null?a.orientation:[0,0,0],lg.applyModelSpecification(p,a),p.computeBoundsAndApplyParent(),this.models.push(p))}else this._modelsInfo.set(i,{modelSpec:a,model:null}),this.loadGLTFFromURI(a.uri).then(p=>{if(!p)return;const y=this._modelsInfo.get(i);if(!y)return;const _=wM(p),b=y.modelSpec,E=new LV(i,b.uri,b.position,b.orientation,_);lg.applyModelSpecification(E,b),E.computeBoundsAndApplyParent(),this.models.push(E),y.model=E,this.loaded()&&this.fire(new lu("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(p=>{this.fire(new ym(new Error(`Could not load model ${i} from ${a.uri}: ${p.message}`)))})}this.loaded()&&this.fire(new lu("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(i,a){a.nodeOverrides&&lg.convertNodeOverrides(i,a.nodeOverrides),a.materialOverrides&&lg.convertMaterialOverrides(i,a.materialOverrides),a.nodeOverrideNames&&(i.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(i.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(i.featureProperties=a.featureProperties)}static convertNodeOverrides(i,a){if(Array.isArray(a)&&a.every(d=>typeof d=="string")){i.nodeOverrideNames=[];for(const d of a)i.nodeOverrideNames.push(d)}else Object.entries(a).forEach(([d,p])=>{const y={orientation:[0,0,0]};if(p.hasOwnProperty("orientation")){const _=p.orientation;_&&(y.orientation=_)}i.nodeOverrides.set(d,y)})}static convertMaterialOverrides(i,a){if(Array.isArray(a)&&a.every(d=>typeof d=="string")){i.materialOverrideNames=[];for(const d of a)i.materialOverrideNames.push(d)}else Object.entries(a).forEach(([d,p])=>{const y={color:new En(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=p["model-color"];_!==void 0&&(y.color.r=_[0],y.color.g=_[1],y.color.b=_[2]);const b=p["model-color-mix-intensity"];b!==void 0&&(y.colorMix=b);const E=p["model-emissive-strength"];E!==void 0&&(y.emissionStrength=E);const I=p["model-opacity"];I!==void 0&&(y.opacity=I),i.materialOverrides.set(d,y)})}onAdd(i){this.map=i,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const i of this._modelsInfo.values())if(i.model==null)return!1;return!0}getModels(){return this.models}loadTile(i,a){}serialize(){return this._options}setProperty(i,a){return!1}reload(){const i=uh(this.id,this.scope);this.map.style.clearSource(i),this.models=[],this._modelsInfo.clear(),this.load()}setModels(i){this.models=[];const a=new Map;for(const d in i){const p=i[d];if(this._modelsInfo.has(d)){const y=this._modelsInfo.get(d);y&&y.modelSpec.uri===p.uri&&a.set(d,y)}}this._modelsInfo=a,this._options.models=i,this.load()}}function YM(c,i,a,d){const p=1<<c.z;i.lat=vt((d/Mt+c.y)/p),i.lng=ht((a/Mt+c.x)/p)}function Vhe(c,i,a,d){const p=c.getNodesInfo()[i];if(!p||p.hiddenByReplacement||!p.node.meshes)return;let y=Number.MAX_VALUE;const _=p.node,b=a.tile,E=d.calculatePosMatrix(b.tileID.toUnwrapped(),d.worldSize),I=p.evaluatedScale;let M=0;d.elevation&&_.elevation&&(M=_.elevation*d.elevation.exaggeration()),H(E,E,[(_.anchor?_.anchor[0]:0)*(I[0]-1),(_.anchor?_.anchor[1]:0)*(I[1]-1),M]),te(E,E,I);const D=a.queryGeometry,N=D.isPointQuery()?D.screenBounds:D.screenGeometry,V=function(Y){const re=q([],E,Y.globalMatrix);q(re,d.expandedFarZProjMatrix,re);for(let J=0;J<Y.meshes.length;++J){const oe=Y.meshes[J];if(J===Y.lightMeshIndex)continue;const le=_M(N,d,re,oe.aabb);le!=null&&(y=Math.min(le,y))}if(Y.children)for(const J of Y.children)V(J)};if(V(_),y===Number.MAX_VALUE)return;const G=new ve(0,0);return YM(b.tileID.canonical,G,p.node.anchor[0],p.node.anchor[1]),{intersectionZ:y,position:G,feature:p.feature}}const Uhe={circle:class extends Ks{constructor(c,i,a,d){super(c,{layout:Z4||(Z4=new bi({"circle-sort-key":new zt(Ue.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ct(Ue.layout_circle["circle-elevation-reference"]),visibility:new Ct(Ue.layout_circle.visibility)})),paint:X4||(X4=new bi({"circle-radius":new zt(Ue.paint_circle["circle-radius"]),"circle-color":new zt(Ue.paint_circle["circle-color"]),"circle-blur":new zt(Ue.paint_circle["circle-blur"]),"circle-opacity":new zt(Ue.paint_circle["circle-opacity"]),"circle-translate":new Ct(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ct(Ue.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}createBucket(c){return new Js(c)}queryRadius(c){const i=c;return fh("circle-radius",this,i)+fh("circle-stroke-width",this,i)+P_(this.paint.get("circle-translate"))}queryIntersectsFeature(c,i,a,d,p,y,_,b){const E=W4(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),I=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return l$(c,d,y,_,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,I)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,i,a){const d=a$(this);return{config:new z(this,{zoom:i,lut:a}),defines:d,overrideFog:!1}}is3D(c){return!c&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ks{createBucket(c){return new u$(c)}constructor(c,i,a,d){super(c,{layout:d$||(d$=new bi({visibility:new Ct(Ue.layout_heatmap.visibility)})),paint:h$||(h$=new bi({"heatmap-radius":new zt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Df(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(Ue.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=nw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(c){return fh("heatmap-radius",this,c)}queryIntersectsFeature(c,i,a,d,p,y,_,b){const E=this.paint.get("heatmap-radius").evaluate(i,a);return l$(c,d,y,_,b,!0,!0,new wt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,i,a){return c==="heatmap"?{config:new z(this,{zoom:i,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Ks{constructor(c,i,a,d){super(c,{layout:f$||(f$=new bi({visibility:new Ct(Ue.layout_hillshade.visibility)})),paint:p$||(p$=new bi({"hillshade-illumination-direction":new Ct(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ct(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ct(Ue.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}},fill:class extends Ks{constructor(c,i,a,d){super(c,{layout:D$||(D$=new bi({"fill-sort-key":new zt(Ue.layout_fill["fill-sort-key"]),visibility:new Ct(Ue.layout_fill.visibility),"fill-elevation-reference":new Ct(Ue.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new zt(Ue.layout_fill["fill-construct-bridge-guard-rail"])})),paint:L$||(L$=new bi({"fill-antialias":new Ct(Ue.paint_fill["fill-antialias"]),"fill-opacity":new zt(Ue.paint_fill["fill-opacity"]),"fill-color":new zt(Ue.paint_fill["fill-color"]),"fill-outline-color":new zt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new Ct(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new zt(Ue.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ct(Ue.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ct(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new zt(Ue.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new zt(Ue.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new zt(Ue.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}getProgramIds(){const c=this.paint.get("fill-pattern"),i=c&&c.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,i,a){return{config:new z(this,{zoom:i,lut:a}),overrideFog:!1}}recalculate(c,i){super.recalculate(c,i);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new tM(c)}queryRadius(){return P_(this.paint.get("fill-translate"))}queryIntersectsFeature(c,i,a,d,p,y){return!c.queryGeometry.isAboveHorizon&&Qn(H4(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),d)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(c){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const i=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return c!=null?i&&!c:i}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ks{constructor(c,i,a,d){super(c,{layout:iV||(iV=new bi({visibility:new Ct(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ct(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oV||(oV=new bi({"fill-extrusion-opacity":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new zt(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ct(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new KA(c)}queryRadius(){return P_(this.paint.get("fill-extrusion-translate"))}is3D(c){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,i,a,d,p,y,_,b,E){const I=W4(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(i,a),D=this.paint.get("fill-extrusion-base").evaluate(i,a),N=[0,0],V=b&&y.elevation,G=y.elevation?y.elevation.exaggeration():1,Y=c.tile.getBucket(this);if(V&&Y instanceof KA){const de=Y.centroidVertexArray,_e=E+1;_e<de.length&&(N[0]=de.geta_centroid_pos0(_e),N[1]=de.geta_centroid_pos1(_e))}if(N[0]===0&&N[1]===1)return!1;y.projection.name==="globe"&&(d=nV([d],[new wt(0,0),new wt(Mt,Mt)],c.tileID.canonical).map(de=>de.polygon).flat());const re=V?b:null,[J,oe]=hV(y,d,D,M,I,_,re,N,G,y.center.lat,c.tileID.canonical),le=c.queryGeometry;return dV(J,oe,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends Ks{constructor(c,i,a,d){super(c,{layout:VV||(VV=new bi({visibility:new Ct(Ue.layout_building.visibility),"building-facade":new zt(Ue.layout_building["building-facade"]),"building-facade-floors":new zt(Ue.layout_building["building-facade-floors"]),"building-facade-unit-width":new zt(Ue.layout_building["building-facade-unit-width"]),"building-facade-window":new zt(Ue.layout_building["building-facade-window"]),"building-roof-shape":new zt(Ue.layout_building["building-roof-shape"]),"building-height":new zt(Ue.layout_building["building-height"]),"building-base":new zt(Ue.layout_building["building-base"]),"building-flood-light-wall-radius":new zt(Ue.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new zt(Ue.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new zt(Ue.layout_building["building-flip-roof-orientation"])})),paint:UV||(UV=new bi({"building-opacity":new Ct(Ue.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ct(Ue.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ct(Ue.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ct(Ue.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ct(Ue.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ct(Ue.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ct(Ue.paint_building["building-cast-shadows"]),"building-color":new zt(Ue.paint_building["building-color"]),"building-emissive-strength":new zt(Ue.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ct(Ue.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ct(Ue.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Ct(Ue.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Ct(Ue.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Ct(Ue.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new $V(c)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(c){return!0}queryRadius(c){return 0}queryIntersectsFeature(c,i,a,d,p,y,_,b,E,I){let M=this.layout.get("building-height").evaluate(i,a);const D=this.layout.get("building-base").evaluate(i,a),N=c.tile.getBucket(this).getFootprint(i);if(N){if(N.hiddenFlags!==0)return!1;M=N.height}const[V,G]=hV(y,d,D,M,new wt(0,0),_,null,[0,0],1,y.center.lat,c.tileID.canonical),Y=c.queryGeometry;return dV(V,G,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends Ks{constructor(c,i,a,d){const p=QV();super(c,p,i,a,d),p.layout&&(this.layout=new Xs(p.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Pm,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(c,i){super.recalculate(c,i),this.paint._values["line-floorwidth"]=(()=>{if(ww)return ww;const a=QV();return ww=new Nde(a.paint.properties["line-width"].specification),ww.useIntegerZoom=!0,ww})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new EM(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,i,a){const d=YV(this);return{config:new z(this,{zoom:i,lut:a}),defines:d,overrideFog:!1}}queryRadius(c){const i=c,a=eU(fh("line-width",this,i),fh("line-gap-width",this,i)),d=fh("line-offset",this,i);return a/2+Math.abs(d)+P_(this.paint.get("line-translate"))}queryIntersectsFeature(c,i,a,d,p,y){if(c.queryGeometry.isAboveHorizon)return!1;const _=H4(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,c.pixelToTileUnitsFactor),b=c.pixelToTileUnitsFactor/2*eU(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),E=this.paint.get("line-offset").evaluate(i,a);return E&&(d=function(I,M){const D=[],N=new wt(0,0);for(let V=0;V<I.length;V++){const G=I[V],Y=[];for(let re=0;re<G.length;re++){const J=G[re],oe=G[re+1],le=re===0?N:J.sub(G[re-1])._unit()._perp(),de=re===G.length-1?N:oe.sub(J)._unit()._perp(),_e=le._add(de)._unit();_e._mult(1/(_e.x*de.x+_e.y*de.y)),Y.push(_e._mult(M)._add(J))}D.push(Y)}return D}(d,E*c.pixelToTileUnitsFactor)),function(I,M,D){for(let N=0;N<M.length;N++){const V=M[N];if(I.length>=3){for(let G=0;G<V.length;G++)if(Ra(I,V[G]))return!0}if(eo(I,V,D))return!0}return!1}(_,d,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(c){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:b2,background:class extends Ks{constructor(c,i,a,d){super(c,{layout:qU||(qU=new bi({visibility:new Ct(Ue.layout_background.visibility)})),paint:HU||(HU=new bi({"background-pitch-alignment":new Ct(Ue.paint_background["background-pitch-alignment"]),"background-color":new Ct(Ue.paint_background["background-color"]),"background-pattern":new Ct(Ue.paint_background["background-pattern"]),"background-opacity":new Ct(Ue.paint_background["background-opacity"]),"background-emissive-strength":new Ct(Ue.paint_background["background-emissive-strength"]),"background-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,i,a){return{overrideFog:!1}}is3D(c){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:YU,"raster-particle":n6,sky:class extends Ks{constructor(c,i,a,d){super(c,{layout:e6||(e6=new bi({visibility:new Ct(Ue.layout_sky.visibility)})),paint:t6||(t6=new bi({"sky-type":new Ct(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ct(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ct(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ct(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ct(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new Df(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ct(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ct(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ct(Ue.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=nw({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(c,i){if(this.paint.get("sky-type")==="atmosphere"){const d=this.paint.get("sky-atmosphere-sun"),p=!d,y=c.style.light,_=y.properties.get("position");return p&&y.properties.get("anchor")==="viewport"&&vr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?WM(_.azimuthal,90-_.polar,i):WM(d[0],90-d[1],i)}const a=this.paint.get("sky-gradient-center");return WM(a[0],90-a[1],i)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Ks{constructor(c,i,a,d){super(c,{paint:r6||(r6=new bi({}))},i,null)}},model:class extends Ks{constructor(c,i,a,d){super(c,{layout:a6||(a6=new bi({visibility:new Ct(Ue.layout_model.visibility),"model-id":new zt(Ue.layout_model["model-id"]),"model-allow-density-reduction":new Ct(Ue.layout_model["model-allow-density-reduction"])})),paint:l6||(l6=new bi({"model-opacity":new zt(Ue.paint_model["model-opacity"]),"model-rotation":new zt(Ue.paint_model["model-rotation"]),"model-scale":new zt(Ue.paint_model["model-scale"]),"model-translation":new zt(Ue.paint_model["model-translation"]),"model-color":new zt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new zt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new Ct(Ue.paint_model["model-type"]),"model-cast-shadows":new Ct(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ct(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ct(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new zt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new zt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new zt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ct(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ct(Ue.paint_model["model-front-cutoff"]),"model-elevation-reference":new Ct(Ue.paint_model["model-elevation-reference"]),"model-color-use-theme":new zt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,d),this.layer=c,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new XM(c)}getProgramIds(){return["model"]}is3D(c){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof E2?8191:0}queryRenderedFeatures(c,i,a){const d=i.getSource();if(!(d&&d instanceof lg))return{};const p=d,y={};y[this.id]=[];const _=y[this.id];let b=0;for(const E of p.models){const I=i.getFeatureState(this.sourceLayer,E.id),M={type:"Unknown",id:E.id,properties:E.featureProperties},D=this.paint.get("model-rotation").evaluate(M,I),N=this.paint.get("model-scale").evaluate(M,I),V=this.paint.get("model-translation").evaluate(M,I),G=this.paint.get("model-elevation-reference");let Y=[];o2(Y,E,a,E.position,D,N,V,G==="ground",G==="ground",!1),a.projection.name==="globe"&&(Y=i2(Y,a));const re=q([],a.projMatrix,Y),J=_M(c.isPointQuery()?c.screenBounds:c.screenGeometry,a,re,E.aabb);if(J!=null){const oe=new ag(void 0,0,0,0,E.id);oe.layer=this.layer,oe.properties=structuredClone(E.featureProperties),oe.properties.layer=this.id,oe.properties.uri=E.uri,oe.properties.orientation=E.orientation,oe.sourceLayer=this.sourceLayer,oe.geometry={type:"Point",coordinates:[E.position.lng,E.position.lat]},oe.state=I,oe.source=this.source,_.push({featureIndex:b,feature:oe,intersectionZ:J})}++b}return y}queryIntersectsFeature(c,i,a,d,p,y,_,b,E,I){if(!this.modelManager)return!1;const M=this.modelManager,D=c.tile.getBucket(this);if(!(D&&D instanceof XM))return!1;for(const N in D.instancesPerModel){const V=D.instancesPerModel[N],G=i.id!==void 0?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(V.idToFeaturesIndex.hasOwnProperty(G)){const Y=V.features[V.idToFeaturesIndex[G]],re=M.getModel(N,I||this.scope);if(!re)return!1;let J=[];const oe=new ve(0,0),le=D.canonical;let de=Number.MAX_VALUE;for(let _e=0;_e<Y.instancedDataCount;++_e){const ye=16*(Y.instancedDataOffset+_e),Te=V.instancedDataArray.float32,Ae=[Te[ye+4],Te[ye+5],Te[ye+6]];YM(le,oe,Math.floor(Te[ye]),Math.floor(Te[ye+1])),o2(J,re,y,oe,Y.rotation,Y.scale,Ae,!1,!1,!1),y.projection.name==="globe"&&(J=i2(J,y));const Se=q([],y.projMatrix,J),Oe=c.queryGeometry,Me=_M(Oe.isPointQuery()?Oe.screenBounds:Oe.screenGeometry,y,Se,re.aabb);Me!=null&&(de=Math.min(Me,de))}return de!==Number.MAX_VALUE&&de}}return!1}_handleOverridablePaintPropertyUpdate(c,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const i=this._transitionablePaint._values[c];return i!=null&&i.value!=null&&i.value.expression!=null&&i.value.expression instanceof ah}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ks{constructor(c,i,a,d){super(c,{layout:j$||(j$=new bi({"clip-layer-types":new Ct(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ct(Ue.layout_clip["clip-layer-scope"])})),paint:N$||(N$=new bi({}))},i,a,d)}recalculate(c,i){super.recalculate(c,i)}createBucket(c){return new z$(c)}is3D(c){return!0}}},JM=new En(0,0,0);function Ghe(c,i,a){c===1&&i.icons.push(function(d,p){return function(y){if(y.usvg_tree.height||(y.usvg_tree.height=y.usvg_tree.width),!y.metadata)return y;const{metadata:_}=y;if(_.content_area){const{content_area:b}=_;b.left==null&&(b.left=0),b.top==null&&(b.top=b.left),b.width==null&&(b.width=y.usvg_tree.width),b.height==null&&(b.height=b.width)}if(_.text_placeholder){const{text_placeholder:b}=_;b.top==null&&(b.top=b.left),b.height==null&&(b.height=b.width)}return _.stretch_x&&_.stretch_x.length&&f6(_,"x"),_.stretch_y&&_.stretch_y.length&&f6(_,"y"),y}(d.readFields(qhe,{name:void 0},p))}(a,a.readVarint()+a.pos))}function f6(c,i){const a=[],d=c[`stretch_${i}`];let p=null;for(let y=0;y<d.length;y++)p===null?p=a.length===0?d[0]:a[a.length-1][1]+d[y]:(a.push([p,p+d[y]]),p=null);c[`stretch_${i}_areas`]=a}function qhe(c,i,a){c===1?i.name=a.readString():c===2?i.metadata=function(d,p){return d.readFields(Hhe,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},p)}(a,a.readVarint()+a.pos):c===3&&(i.usvg_tree=function(d,p){return d.readFields(Xhe,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},p)}(a,a.readVarint()+a.pos),i.data="usvg_tree")}function Hhe(c,i,a){c===1?i.stretch_x=a.readPackedVarint():c===2?i.stretch_y=a.readPackedVarint():c===3?i.content_area=p6(a,a.readVarint()+a.pos):c===4?i.variables.push(function(d,p){return d.readFields(Zhe,{name:void 0},p)}(a,a.readVarint()+a.pos)):c===5&&(i.text_placeholder=p6(a,a.readVarint()+a.pos))}function p6(c,i){return c.readFields(Whe,{},i)}function Whe(c,i,a){c===1?i.left=a.readVarint():c===2?i.width=a.readVarint():c===3?i.top=a.readVarint():c===4&&(i.height=a.readVarint())}function Zhe(c,i,a){c===1?i.name=a.readString():c===2&&(i.rgb_color=C2(a.readVarint()),i.value="rgb_color")}function Xhe(c,i,a){c===1?i.width=i.height=a.readVarint():c===2?i.height=a.readVarint():c===3?i.children.push(A2(a,a.readVarint()+a.pos)):c===4?i.linear_gradients.push(function(d,p){return d.readFields(rfe,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},p)}(a,a.readVarint()+a.pos)):c===5?i.radial_gradients.push(function(d,p){return d.readFields(ife,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},p)}(a,a.readVarint()+a.pos)):c===7?i.clip_paths.push(function(d,p){return d.readFields(ofe,{children:[]},p)}(a,a.readVarint()+a.pos)):c===8&&i.masks.push(function(d,p){const y=d.readFields(sfe,{left:0,width:20,mask_type:1,children:[]},p);return y.height==null&&(y.height=y.width),y.top==null&&(y.top=y.left),y}(a,a.readVarint()+a.pos))}function A2(c,i){return c.readFields(Khe,{},i)}function Khe(c,i,a){c===1?(i.group=function(d,p){return d.readFields(Yhe,{opacity:255,children:[]},p)}(a,a.readVarint()+a.pos),i.node="group"):c===2&&(i.path=function(d,p){return d.readFields(Qhe,{paint_order:1,commands:[],step:1,diffs:[],rule:1},p)}(a,a.readVarint()+a.pos),i.node="path")}function Yhe(c,i,a){c===1?i.transform=P2(a,a.readVarint()+a.pos):c===2?i.opacity=a.readVarint():c===5?i.clip_path_idx=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(A2(a,a.readVarint()+a.pos))}function P2(c,i){return c.readFields(Jhe,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},i)}function Jhe(c,i,a){c===1?i.sx=a.readFloat():c===2?i.ky=a.readFloat():c===3?i.kx=a.readFloat():c===4?i.sy=a.readFloat():c===5?i.tx=a.readFloat():c===6&&(i.ty=a.readFloat())}function Qhe(c,i,a){c===1?i.fill=function(d,p){return d.readFields(efe,{rgb_color:JM,paint:"rgb_color",opacity:255},p)}(a,a.readVarint()+a.pos):c===2?i.stroke=function(d,p){return d.readFields(tfe,{rgb_color:JM,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},p)}(a,a.readVarint()+a.pos):c===3?i.paint_order=a.readVarint():c===5?a.readPackedVarint(i.commands):c===6?i.step=a.readFloat():c===7?a.readPackedSVarint(i.diffs):c===8&&(i.rule=a.readVarint())}function efe(c,i,a){c===1?(i.rgb_color=C2(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5&&(i.opacity=a.readVarint())}function C2(c){return new En((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function tfe(c,i,a){c===1?(i.rgb_color=C2(a.readVarint()),i.paint="rgb_color"):c===2?(i.linear_gradient_idx=a.readVarint(),i.paint="linear_gradient_idx"):c===3?(i.radial_gradient_idx=a.readVarint(),i.paint="radial_gradient_idx"):c===5?a.readPackedFloat(i.dasharray):c===6?i.dashoffset=a.readFloat():c===7?i.miterlimit=a.readFloat():c===8?i.opacity=a.readVarint():c===9?i.width=a.readFloat():c===10?i.linecap=a.readVarint():c===11&&(i.linejoin=a.readVarint())}function rfe(c,i,a){c===1?i.transform=P2(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(m6(a,a.readVarint()+a.pos)):c===4?i.x1=a.readFloat():c===5?i.y1=a.readFloat():c===6?i.x2=a.readFloat():c===7&&(i.y2=a.readFloat())}function m6(c,i){return c.readFields(nfe,{offset:0,opacity:255,rgb_color:JM},i)}function nfe(c,i,a){c===1?i.offset=a.readFloat():c===2?i.opacity=a.readVarint():c===3&&(i.rgb_color=C2(a.readVarint()))}function ife(c,i,a){c===1?i.transform=P2(a,a.readVarint()+a.pos):c===2?i.spread_method=a.readVarint():c===3?i.stops.push(m6(a,a.readVarint()+a.pos)):c===4?i.cx=a.readFloat():c===5?i.cy=a.readFloat():c===6?i.r=a.readFloat():c===7?i.fx=a.readFloat():c===8?i.fy=a.readFloat():c===9&&(i.fr=a.readFloat())}function ofe(c,i,a){c===1?i.transform=P2(a,a.readVarint()+a.pos):c===2?i.clip_path_idx=a.readVarint():c===3&&i.children.push(A2(a,a.readVarint()+a.pos))}function sfe(c,i,a){c===1?i.left=i.top=a.readFloat():c===2?i.width=i.height=a.readFloat():c===3?i.top=a.readFloat():c===4?i.height=a.readFloat():c===5?i.mask_type=a.readVarint():c===6?i.mask_idx=a.readVarint():c===7&&i.children.push(A2(a,a.readVarint()+a.pos))}class afe{static calculate(i={},a=[]){const d=new Map,p=new Map;if(Object.keys(i).length===0)return d;a.forEach(y=>{p.set(y.name,y.rgb_color||new En(0,0,0))});for(const[y,_]of Object.entries(i))p.has(y)?d.set(p.get(y).toString(),_):console.warn(`Ignoring unknown image variable "${y}"`);return d}}function H_(c,i=255,a){const d=i/255,p=c.toString(),y=a.has(p)?a.get(p).clone():c.clone();return y.a*=d,y.toString()}function Nw(c,i){if(!Yd()){const a=document.createElement("canvas");return a.width=c,a.height=i,a}return new OffscreenCanvas(c,i)}let QM,zw=null;function eD(c,i,a,d,p){for(const y of d.children)g6(c,i,a,y,p)}function g6(c,i,a,d,p){d.group?(c.save(),function(y,_,b,E,I){const M=E.mask_idx!=null?b.masks[E.mask_idx]:null,D=E.clip_path_idx!=null?b.clip_paths[E.clip_path_idx]:null;if(E.transform&&(_=W_(E.transform).preMultiplySelf(_)),!function(G,Y,re){return G.opacity!==255||Y||re}(E,D!=null,M!=null))return void eD(y,_,b,E,I);const N=Nw(y.canvas.width,y.canvas.height),V=N.getContext("2d");eD(V,_,b,E,I),D&&S6(V,_,b,D),M&&T6(V,_,b,M,I),y.globalAlpha=E.opacity/255,y.drawImage(N,0,0)}(c,i,a,d.group,p),c.restore()):d.path&&(c.save(),function(y,_,b,E,I){y.setTransform(_),E.paint_order===1?(y6(y,b,E,I),v6(y,b,E,I)):(v6(y,b,E,I),y6(y,b,E,I))}(c,i,a,d.path,p),c.restore())}function y6(c,i,a,d){const p=a.fill;if(!p)return;const y=p.opacity/255;switch(c.save(),c.beginPath(),E6(a,c),p.paint){case"rgb_color":c.fillStyle=H_(p.rgb_color,p.opacity,d);break;case"linear_gradient_idx":{const _=i.linear_gradients[p.linear_gradient_idx];_.transform&&c.setTransform(W_(_.transform).preMultiplySelf(c.getTransform())),c.fillStyle=x6(c,_,y,d);break}case"radial_gradient_idx":{const _=i.radial_gradients[p.radial_gradient_idx];_.transform&&c.setTransform(W_(_.transform).preMultiplySelf(c.getTransform())),c.fillStyle=b6(c,_,y,d)}}c.fill(_6(a)),c.restore()}function _6(c){return c.rule===1?"nonzero":c.rule===2?"evenodd":void 0}function v6(c,i,a,d){const p=a.stroke;if(!p)return;const y=A6(a);c.lineWidth=p.width,c.miterLimit=p.miterlimit,c.setLineDash(p.dasharray),c.lineDashOffset=p.dashoffset;const _=p.opacity/255;switch(p.paint){case"rgb_color":c.strokeStyle=H_(p.rgb_color,p.opacity,d);break;case"linear_gradient_idx":c.strokeStyle=x6(c,i.linear_gradients[p.linear_gradient_idx],_,d,!0);break;case"radial_gradient_idx":c.strokeStyle=b6(c,i.radial_gradients[p.radial_gradient_idx],_,d,!0)}switch(p.linejoin){case 2:case 1:c.lineJoin="miter";break;case 3:c.lineJoin="round";break;case 4:c.lineJoin="bevel"}switch(p.linecap){case 1:c.lineCap="butt";break;case 2:c.lineCap="round";break;case 3:c.lineCap="square"}c.stroke(y)}function x6(c,i,a,d,p=!1){if(i.stops.length===1){const N=i.stops[0];return H_(N.rgb_color,N.opacity*a,d)}const{x1:y,y1:_,x2:b,y2:E}=i;let I=new DOMPoint(y,_),M=new DOMPoint(b,E);if(p){const N=W_(i.transform);I=N.transformPoint(I),M=N.transformPoint(M)}const D=c.createLinearGradient(I.x,I.y,M.x,M.y);for(const N of i.stops)D.addColorStop(N.offset,H_(N.rgb_color,N.opacity*a,d));return D}function b6(c,i,a,d,p=!1){if(i.stops.length===1){const J=i.stops[0];return H_(J.rgb_color,J.opacity*a,d)}const y=W_(i.transform),{fx:_,fy:b,fr:E,cx:I,cy:M,r:D}=i;let N=new DOMPoint(_,b),V=new DOMPoint(I,M),G=E,Y=D;if(p){N=y.transformPoint(N),V=y.transformPoint(V);const J=(y.a+y.d)/2;G=E*J,Y=i.r*J}const re=c.createRadialGradient(N.x,N.y,G,V.x,V.y,Y);for(const J of i.stops)re.addColorStop(J.offset,H_(J.rgb_color,J.opacity*a,d));return re}function w6(c,i,a,d){const p=d.transform?W_(d.transform).preMultiplySelf(i):i,y=Nw(c.canvas.width,c.canvas.height),_=y.getContext("2d");for(const E of d.children)if(E.group)w6(_,p,a,E.group);else if(E.path){const I=E.path,M=new Path2D;M.addPath(A6(I),p),_.fill(M,_6(I))}const b=d.clip_path_idx!=null?a.clip_paths[d.clip_path_idx]:null;b&&S6(_,p,a,b),c.globalCompositeOperation="source-over",c.drawImage(y,0,0)}function S6(c,i,a,d){const p=Nw(c.canvas.width,c.canvas.height);w6(p.getContext("2d"),i,a,d),c.globalCompositeOperation="destination-in",c.drawImage(p,0,0)}function T6(c,i,a,d,p){if(d.children.length===0)return;const y=d.mask_idx!=null?a.masks[d.mask_idx]:null;y&&T6(c,i,a,y,p);const _=c.canvas.width,b=c.canvas.height,E=Nw(_,b),I=E.getContext("2d"),M=d.width,D=d.height,N=d.left,V=d.top,G=new Path2D,Y=new Path2D;Y.rect(N,V,M,D),G.addPath(Y,i),I.clip(G);for(const oe of d.children)g6(I,i,a,oe,p);const re=I.getImageData(0,0,_,b),J=re.data;if(d.mask_type===1)for(let oe=0;oe<J.length;oe+=4)J[oe+3]=J[oe+3]/255*(.2126*J[oe]+.7152*J[oe+1]+.0722*J[oe+2]);I.putImageData(re,0,0),c.globalCompositeOperation="destination-in",c.drawImage(E,0,0)}function W_(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function E6(c,i){const a=c.step;let d=c.diffs[0]*a,p=c.diffs[1]*a;i.moveTo(d,p);for(let y=0,_=2;y<c.commands.length;y++)switch(c.commands[y]){case 1:d+=c.diffs[_++]*a,p+=c.diffs[_++]*a,i.moveTo(d,p);break;case 2:d+=c.diffs[_++]*a,p+=c.diffs[_++]*a,i.lineTo(d,p);break;case 3:{const b=d+c.diffs[_++]*a,E=p+c.diffs[_++]*a;d=b+c.diffs[_++]*a,p=E+c.diffs[_++]*a,i.quadraticCurveTo(b,E,d,p);break}case 4:{const b=d+c.diffs[_++]*a,E=p+c.diffs[_++]*a,I=b+c.diffs[_++]*a,M=E+c.diffs[_++]*a;d=I+c.diffs[_++]*a,p=M+c.diffs[_++]*a,i.bezierCurveTo(b,E,I,M,d,p);break}case 5:i.closePath();break}return i}function A6(c){return E6(c,new Path2D)}class I2{constructor(i){this.capacity=i,this.cache=new Map}get(i){if(!this.cache.has(i))return;const a=this.cache.get(i);return this.cache.delete(i),this.cache.set(i,a),a}put(i,a){this.cache.has(i)?this.cache.delete(i):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(i,a)}delete(i){this.cache.delete(i)}}Wt(I2,"LRUCache");class tD{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(i){return new ys(i,i.data)}getFromCache(i,a,d){return this.cacheMap.has(d)||this.cacheMap.set(d,new I2(150)),this.cacheMap.get(d).get(uh(i.toString(),a))}setInCache(i,a,d,p){this.cacheDependenciesMap.has(p)||this.cacheDependenciesMap.set(p,new Map),this.cacheMap.has(p)||this.cacheMap.set(p,new I2(150));const y=this.cacheDependenciesMap.get(p),_=uh(i.id.toString(),d);y.get(_)||y.set(_,new Set);const b=this.cacheMap.get(p),E=i.toString();y.get(_).add(E),b.put(uh(i.toString(),d),a)}removeImagesFromCacheByIds(i,a,d=0){if(!this.cacheMap.has(d)||!this.cacheDependenciesMap.has(d))return;const p=this.cacheMap.get(d),y=this.cacheDependenciesMap.get(d);for(const _ of i){const b=uh(_.toString(),a);if(y.has(b)){for(const E of y.get(b))p.delete(E);y.delete(b)}}}rasterize(i,a,d,p){const y=this.getFromCache(i,d,p);if(y)return y.clone();const _=function(E,I){const M=afe.calculate(I.params,E.metadata?E.metadata.variables:[]),D=E.usvg_tree,N=D.width,V=D.height,G=Math.max(1,Math.round(N*I.sx)),Y=Math.max(1,Math.round(V*I.sy)),re=new DOMMatrix([G/N,0,0,Y/V,0,0]);return zw===null&&(zw=Nw(10,10),QM=zw.getContext("2d",{willReadFrequently:!0})),zw.width=G,zw.height=Y,eD(QM,re,D,D,M),QM.getImageData(0,0,G,Y)}(a.icon,i),b=tD._getImage(_);return this.setInCache(i,b,d,p),b.clone()}}class P6{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const d=this.toIdx(i,a);return{min:this.minimums[d],max:this.maximums[d]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function C6(c,i,a,d){let p=0,y=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(d[_])<1e-15){if(a[_]<c[_]||a[_]>i[_])return null}else{const b=1/d[_];let E=(c[_]-a[_])*b,I=(i[_]-a[_])*b;if(E>I){const M=E;E=I,I=M}if(E>p&&(p=E),I<y&&(y=I),p>y)return null}return p}function I6(c,i,a,d,p,y,_,b,E,I,M){const D=d-c,N=p-i,V=y-a,G=_-c,Y=b-i,re=E-a,J=M[1]*re-M[2]*Y,oe=M[2]*G-M[0]*re,le=M[0]*Y-M[1]*G,de=D*J+N*oe+V*le;if(Math.abs(de)<1e-15)return null;const _e=1/de,ye=I[0]-c,Te=I[1]-i,Ae=I[2]-a,Se=(ye*J+Te*oe+Ae*le)*_e;if(Se<0||Se>1)return null;const Oe=Te*V-Ae*N,Me=Ae*D-ye*V,st=ye*N-Te*D,et=(M[0]*Oe+M[1]*Me+M[2]*st)*_e;return et<0||Se+et>1?null:(G*Oe+Y*Me+re*st)*_e}function O6(c,i,a){return(c-i)/(a-i)}function k6(c,i,a,d,p,y,_,b,E){const I=1<<a,M=y-d,D=_-p,N=(c+1)/I*M+d,V=(i+0)/I*D+p,G=(i+1)/I*D+p;b[0]=(c+0)/I*M+d,b[1]=V,E[0]=N,E[1]=G}class R6{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(y){const _=Math.ceil(Math.log2(y.dim/8)),b=[];let E=Math.ceil(Math.pow(2,_));const I=1/E,M=(V,G,Y,re,J)=>{const oe=re?1:0,le=(V+1)*Y-oe,de=G*Y,_e=(G+1)*Y-oe;J[0]=V*Y,J[1]=de,J[2]=le,J[3]=_e};let D=new P6(E);const N=[];for(let V=0;V<E*E;V++){M(V%E,Math.floor(V/E),I,!1,N);const G=Kf(N[0],N[1],y),Y=Kf(N[2],N[1],y),re=Kf(N[2],N[3],y),J=Kf(N[0],N[3],y);D.minimums.push(Math.min(G,Y,re,J)),D.maximums.push(Math.max(G,Y,re,J)),D.leaves.push(1)}for(b.push(D),E/=2;E>=1;E/=2){const V=b[b.length-1];D=new P6(E);for(let G=0;G<E*E;G++){M(G%E,Math.floor(G/E),2,!0,N);const Y=V.getElevation(N[0],N[1]),re=V.getElevation(N[2],N[1]),J=V.getElevation(N[2],N[3]),oe=V.getElevation(N[0],N[3]),le=V.isLeaf(N[0],N[1]),de=V.isLeaf(N[2],N[1]),_e=V.isLeaf(N[2],N[3]),ye=V.isLeaf(N[0],N[3]),Te=Math.min(Y.min,re.min,J.min,oe.min),Ae=Math.max(Y.max,re.max,J.max,oe.max),Se=le&&de&&_e&&ye;D.maximums.push(Ae),D.minimums.push(Te),D.leaves.push(Ae-Te<=5&&Se?1:0)}b.push(D)}return b}(this.dem),d=a.length-1,p=a[d];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(a,0,0,d,0)}raycastRoot(i,a,d,p,y,_,b=1){return C6([i,a,-100],[d,p,this.maximums[0]*b],y,_)}raycast(i,a,d,p,y,_,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(i,a,d,p,y,_,b);if(E==null)return null;const I=[],M=[],D=[],N=[],V=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:G,t:Y,nodex:re,nodey:J,depth:oe}=V.pop();if(this.leaves[G]){k6(re,J,oe,i,a,d,p,D,N);const de=1<<oe,_e=(re+0)/de,ye=(re+1)/de,Te=(J+0)/de,Ae=(J+1)/de,Se=Kf(_e,Te,this.dem)*b,Oe=Kf(ye,Te,this.dem)*b,Me=Kf(ye,Ae,this.dem)*b,st=Kf(_e,Ae,this.dem)*b,et=I6(D[0],D[1],Se,N[0],D[1],Oe,N[0],N[1],Me,y,_),it=I6(N[0],N[1],Me,D[0],N[1],st,D[0],D[1],Se,y,_),mt=Math.min(et!==null?et:Number.MAX_VALUE,it!==null?it:Number.MAX_VALUE);if(mt!==Number.MAX_VALUE)return mt;{const ft=ur([],y,_,Y);if(M6(Se,Oe,st,Me,O6(ft[0],D[0],N[0]),O6(ft[1],D[1],N[1]))>=ft[2])return Y}continue}let le=0;for(let de=0;de<this._siblingOffset.length;de++){k6((re<<1)+this._siblingOffset[de][0],(J<<1)+this._siblingOffset[de][1],oe+1,i,a,d,p,D,N),D[2]=-100,N[2]=this.maximums[this.childOffsets[G]+de]*b;const _e=C6(D,N,y,_);if(_e!=null){const ye=_e;I[de]=ye;let Te=!1;for(let Ae=0;Ae<le&&!Te;Ae++)ye>=I[M[Ae]]&&(M.splice(Ae,0,de),Te=!0);Te||(M[le]=de),le++}}for(let de=0;de<le;de++){const _e=M[de];V.push({idx:this.childOffsets[G]+_e,t:I[_e],nodex:(re<<1)+this._siblingOffset[_e][0],nodey:(J<<1)+this._siblingOffset[_e][1],depth:oe+1})}}return null}_addNode(i,a,d){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(d),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,d,p,y){if(i[p].isLeaf(a,d)===1)return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const _=p-1,b=i[_];let E=0,I=0;for(let M=0;M<this._siblingOffset.length;M++){const D=2*a+this._siblingOffset[M][0],N=2*d+this._siblingOffset[M][1],V=b.getElevation(D,N),G=b.isLeaf(D,N),Y=this._addNode(V.min,V.max,G);G&&(E|=1<<M),I||(I=Y)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(i,2*a+this._siblingOffset[M][0],2*d+this._siblingOffset[M][1],_,I+M)}}function M6(c,i,a,d,p,y){return mr(mr(c,a,y),mr(i,d,y),p)}function Kf(c,i,a){const d=a.dim,p=we(c*d-.5,0,d-1),y=we(i*d-.5,0,d-1),_=Math.floor(p),b=Math.floor(y),E=Math.min(_+1,d-1),I=Math.min(b+1,d-1);return M6(a.get(_,b),a.get(E,b),a.get(_,I),a.get(E,I),p-_,y-b)}const lfe={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function cfe(c,i,a){return(256*c*256+256*i+a)/10-1e4}function ufe(c,i,a){return 256*c+i+a/256-32768}class O2{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,d,p=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&d!=="mapbox"&&d!=="terrarium")return void vr(`"${d}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const y=this.dim=a.height-2,_=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=p,this._modifiedForSources={},!p){for(let E=0;E<y;E++)_[this._idx(-1,E)]=_[this._idx(0,E)],_[this._idx(y,E)]=_[this._idx(y-1,E)],_[this._idx(E,-1)]=_[this._idx(E,0)],_[this._idx(E,y)]=_[this._idx(E,y-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(y,-1)]=_[this._idx(y-1,0)],_[this._idx(-1,y)]=_[this._idx(0,y-1)],_[this._idx(y,y)]=_[this._idx(y-1,y-1)]}const b=d==="terrarium"?ufe:cfe;for(let E=0;E<_.length;++E){const I=4*E;this.floatView[E]=b(this.pixels[I],this.pixels[I+1],this.pixels[I+2])}this._timestamp=Za.now()}_buildQuadTree(){this._tree=new R6(this)}get(i,a,d=!1){d&&(i=we(i,-1,this.dim),a=we(a,-1,this.dim));const p=this._idx(i,a);return this.floatView[p]}set(i,a,d){const p=this._idx(i,a),y=this.floatView[p];return this.floatView[p]=d,d-y}static getUnpackVector(i){return lfe[i]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}static pack(i,a){const d=[0,0,0,0],p=O2.getUnpackVector(a);let y=Math.floor((i+p[3])/p[2]);return d[2]=y%256,y=Math.floor(y/256),d[1]=y%256,y=Math.floor(y/256),d[0]=y,d}getPixels(){return new y$({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,d){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let p=a*this.dim,y=a*this.dim+this.dim,_=d*this.dim,b=d*this.dim+this.dim;switch(a){case-1:p=y-1;break;case 1:y=p+1}switch(d){case-1:_=b-1;break;case 1:b=_+1}const E=-a*this.dim,I=-d*this.dim;for(let M=_;M<b;M++)for(let D=p;D<y;D++){const N=4*this._idx(D,M),V=4*this._idx(D+E,M+I);this.pixels[N+0]=i.pixels[V+0],this.pixels[N+1]=i.pixels[V+1],this.pixels[N+2]=i.pixels[V+2],this.pixels[N+3]=i.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function dfe(c,i,a){c===1?i.headerLength=a.readFixed32():c===2?i.x=a.readVarint():c===3?i.y=a.readVarint():c===4?i.z=a.readVarint():c===5&&i.layers.push(function(d,p){return d.readFields(gfe,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},p)}(a,a.readVarint()+a.pos))}function hfe(c,i,a){c===1?(i.delta_filter=function(d,p){return d.readFields(ffe,{blockSize:0},p)}(a,a.readVarint()+a.pos),i.filter="delta_filter"):c===2?(a.readVarint(),i.filter="zigzag_filter"):c===3?(a.readVarint(),i.filter="bitshuffle_filter"):c===4&&(a.readVarint(),i.filter="byteshuffle_filter")}function ffe(c,i,a){c===1&&(i.blockSize=a.readVarint())}function pfe(c,i,a){c===1?(a.readVarint(),i.codec="gzip_data"):c===2?(a.readVarint(),i.codec="jpeg_image"):c===3?(a.readVarint(),i.codec="webp_image"):c===4&&(a.readVarint(),i.codec="png_image")}function mfe(c,i,a){let d=0,p=0;c===1?i.firstByte=a.readFixed64():c===2?i.lastByte=a.readFixed64():c===3?i.filters.push(function(y,_){return y.readFields(hfe,{},_)}(a,a.readVarint()+a.pos)):c===4?i.codec=function(y,_){return y.readFields(pfe,{},_)}(a,a.readVarint()+a.pos):c===5?p=a.readFloat():c===6?d=a.readFloat():c===7?i.bands.push(a.readString()):c===8?i.offset=a.readDouble():c===9&&(i.scale=a.readDouble()),i.offset===0&&(i.offset=p),i.scale===0&&(i.scale=d)}function gfe(c,i,a){c===1?i.version=a.readVarint():c===2?i.name=a.readString():c===3?i.units=a.readString():c===4?i.tileSize=a.readVarint():c===5?i.buffer=a.readVarint():c===6?i.pixelFormat=a.readVarint():c===7&&i.dataIndex.push(function(d,p){return d.readFields(mfe,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},p)}(a,a.readVarint()+a.pos))}function yfe(c,i,a){if(c===2)(function(d,p,y){d.readFields(_fe,y,p)})(a,a.readVarint()+a.pos,i);else if(c===3)throw new Error("Not implemented")}function _fe(c,i,a){if(c===1){let d=0;const p=a.readVarint()+a.pos;for(;a.pos<p;)i[d++]=a.readVarint()}}function vfe(c,i){if(i.length!==4)throw new Error(`Expected data of dimension 4 but got ${i.length}.`);let a=i[3];for(let d=2;d>=1;d--){const p=d===1?1:0,y=d===2?1:0;for(let _=0;_<i[0];_++){const b=i[1]*_;for(let E=p;E<i[1];E++){const I=i[2]*(E+b);for(let M=y;M<i[2];M++){const D=i[3]*(M+I);for(let N=0;N<i[3];N++){const V=D+N;c[V]+=c[V-a]}}}}a*=i[d]}return c}function xfe(c){for(let i=0,a=c.length;i<a;i++)c[i]=c[i]>>>1^-(1&c[i]);return c}function bfe(c,i){switch(i){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){const d=c[a],p=c[a+1];c[a]=(240&d)>>4|(61440&d)>>8|(240&p)<<4|61440&p,c[a+1]=15&d|(3840&d)>>4|(15&p)<<8|(3840&p)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){const d=c[a],p=c[a+1],y=c[a+2],_=c[a+3];c[a+0]=(192&d)>>6|(192&p)>>4|(192&y)>>2|192&_,c[a+1]=(48&d)>>4|(48&p)>>2|48&y|(48&_)<<2,c[a+2]=(12&d)>>2|12&p|(12&y)<<2|(12&_)<<4,c[a+3]=3&d|(3&p)<<2|(3&y)<<4|(3&_)<<6}return c;default:throw new Error(`Invalid pixel format, "${i}"`)}}Wt(O2,"DEMData"),Wt(R6,"DemMinMaxQuadTree",{omit:["dem"]});var Zl=Uint8Array,Fw=Uint16Array,wfe=Int32Array,D6=new Zl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),L6=new Zl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Sfe=new Zl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),j6=function(c,i){for(var a=new Fw(31),d=0;d<31;++d)a[d]=i+=1<<c[d-1];var p=new wfe(a[30]);for(d=1;d<30;++d)for(var y=a[d];y<a[d+1];++y)p[y]=y-a[d]<<5|d;return{b:a,r:p}},N6=j6(D6,2),z6=N6.b,Tfe=N6.r;z6[28]=258,Tfe[258]=28;for(var Efe=j6(L6,0).b,F6=new Fw(32768),yo=0;yo<32768;++yo){var Z_=(43690&yo)>>1|(21845&yo)<<1;F6[yo]=((65280&(Z_=(61680&(Z_=(52428&Z_)>>2|(13107&Z_)<<2))>>4|(3855&Z_)<<4))>>8|(255&Z_)<<8)>>1}var Bw=function(c,i,a){for(var d=c.length,p=0,y=new Fw(i);p<d;++p)c[p]&&++y[c[p]-1];var _,b=new Fw(i);for(p=1;p<i;++p)b[p]=b[p-1]+y[p-1]<<1;_=new Fw(1<<i);var E=15-i;for(p=0;p<d;++p)if(c[p])for(var I=p<<4|c[p],M=i-c[p],D=b[c[p]-1]++<<M,N=D|(1<<M)-1;D<=N;++D)_[F6[D]>>E]=I;return _},$w=new Zl(288);for(yo=0;yo<144;++yo)$w[yo]=8;for(yo=144;yo<256;++yo)$w[yo]=9;for(yo=256;yo<280;++yo)$w[yo]=7;for(yo=280;yo<288;++yo)$w[yo]=8;var B6=new Zl(32);for(yo=0;yo<32;++yo)B6[yo]=5;var Afe=Bw($w,9),Pfe=Bw(B6,5),rD=function(c){for(var i=c[0],a=1;a<c.length;++a)c[a]>i&&(i=c[a]);return i},_u=function(c,i,a){var d=i/8|0;return(c[d]|c[d+1]<<8)>>(7&i)&a},nD=function(c,i){var a=i/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&i)},Cfe=function(c){return(c+7)/8|0},Ife=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vu=function(c,i,a){var d=new Error(i||Ife[c]);if(d.code=c,Error.captureStackTrace&&Error.captureStackTrace(d,vu),!a)throw d;return d},Ofe=new Zl(0),kfe=typeof TextDecoder<"u"&&new TextDecoder;try{kfe.decode(Ofe,{stream:!0})}catch{}const Rfe={gzip_data:"gzip"};class Oc extends Error{constructor(i){super(i),this.name="MRTError"}}const Mfe={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},$6={uint32:1,uint16:2,uint8:4},Dfe={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let iD;class k2{constructor(i=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=i}getLayer(i){const a=this.layers[i];if(!a)throw new Oc(`Layer '${i}' not found`);return a}getHeaderLength(i){const a=new Uint8Array(i),d=new DataView(i);if(a[0]!==13)throw new Oc("File is not a valid MRT.");return d.getUint32(1,!0)}parseHeader(i){const a=new Uint8Array(i),d=this.getHeaderLength(i);if(a.length<d)throw new Oc(`Expected header with length >= ${d} but got buffer of length ${a.length}`);const p=new iD(a.subarray(0,d)).readFields(dfe,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==p.x||this.y!==p.y||this.z!==p.z))throw new Oc(`Invalid attempt to parse header ${p.z}/${p.x}/${p.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=p.x,this.y=p.y,this.z=p.z;for(const y of p.layers)this.layers[y.name]=new V6(y,{cacheSize:this._cacheSize});return this}createDecodingTask(i){const a=[],d=this.getLayer(i.layerName);for(let p of i.blockIndices){const y=d.dataIndex[p],_=y.firstByte-i.firstByte,b=y.lastByte-i.firstByte;if(d._blocksInProgress.has(p))continue;const E={layerName:d.name,firstByte:_,lastByte:b,pixelFormat:d.pixelFormat,blockIndex:p,blockShape:[y.bands.length].concat(d.bandShape),buffer:d.buffer,codec:y.codec.codec,filters:y.filters.map(I=>I.filter)};d._blocksInProgress.add(p),a.push(E)}return new U6(a,()=>{a.forEach(p=>d._blocksInProgress.delete(p.blockIndex))},(p,y)=>{if(a.forEach(_=>d._blocksInProgress.delete(_.blockIndex)),p)throw p;y.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class V6{constructor({version:i,name:a,units:d,tileSize:p,pixelFormat:y,buffer:_,dataIndex:b},E){if(this.version=i,this.version!==1)throw new Oc(`Cannot parse raster layer encoded with MRT version ${i}`);this.name=a,this.units=d,this.tileSize=p,this.buffer=_,this.pixelFormat=Mfe[y],this.dataIndex=b,this.bandShape=[p+2*_,p+2*_,$6[this.pixelFormat]],this._decodedBlocks=new I2(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return $6[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:i})=>i).flat()}processDecodedData(i){const a=i.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,i.data)}getBlockForBand(i){let a=0;switch(typeof i){case"string":for(const[d,p]of this.dataIndex.entries()){for(const[y,_]of p.bands.entries())if(_===i)return{bandIndex:a+y,blockIndex:d,blockBandIndex:y};a+=p.bands.length}break;case"number":for(const[d,p]of this.dataIndex.entries()){if(i>=a&&i<a+p.bands.length)return{bandIndex:i,blockIndex:d,blockBandIndex:i-a};a+=p.bands.length}break;default:throw new Oc(`Invalid band \`${JSON.stringify(i)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(i){let a=1/0,d=-1/0;const p=[],y=new Set;for(const _ of i){const{blockIndex:b}=this.getBlockForBand(_);if(b<0)throw new Oc(`Invalid band: ${JSON.stringify(_)}`);const E=this.dataIndex[b];p.includes(b)||p.push(b),y.add(b),a=Math.min(a,E.firstByte),d=Math.max(d,E.lastByte)}if(y.size>this.cacheSize)throw new Oc(`Number of blocks to decode (${y.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:d,blockIndices:p}}hasBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0}hasDataForBand(i){const{blockIndex:a}=this.getBlockForBand(i);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(i){const{blockIndex:a,blockBandIndex:d}=this.getBlockForBand(i);if(a<0)throw new Oc(`Band not found: ${JSON.stringify(i)}`);const p=this._decodedBlocks.get(a.toString());if(!p)throw new Oc(`Data for band ${JSON.stringify(i)} of layer "${this.name}" not decoded.`);const y=this.dataIndex[a],_=this.bandShape.reduce((I,M)=>I*M,1),b=d*_,E=p.subarray(b,b+_);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:y.offset,scale:y.scale}}}k2.setPbf=function(c){iD=c};class U6{constructor(i,a,d){this.tasks=i,this._onCancel=a,this._onComplete=d,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(i,a){this._finalized||(this._onComplete(i,a),this._finalized=!0)}}k2.performDecoding=function(c,i){const a=new Uint8Array(c);return Promise.all(i.tasks.map(d=>{const{layerName:p,firstByte:y,lastByte:_,pixelFormat:b,blockShape:E,blockIndex:I,filters:M,codec:D}=d,N=a.subarray(y,_+1),V=new Uint32Array(E[0]*E[1]*E[2]);let G;if(D!=="gzip_data")throw new Oc(`Unhandled codec: ${D}`);return G=function(Y,re){if(!globalThis.DecompressionStream&&re==="gzip_data")return Promise.resolve((_e=function(Ae){Ae[0]==31&&Ae[1]==139&&Ae[2]==8||vu(6,"invalid gzip data");var Se=Ae[3],Oe=10;4&Se&&(Oe+=2+(Ae[10]|Ae[11]<<8));for(var Me=(Se>>3&1)+(Se>>4&1);Me>0;Me-=!Ae[Oe++]);return Oe+(2&Se)}(J=Y),_e+8>J.length&&vu(6,"invalid gzip data"),function(Ae,Se,Oe,Me){var st=Ae.length;if(!st||Se.f&&!Se.l)return Oe||new Zl(0);var et=!Oe,it=et||Se.i!=2,mt=Se.i;et&&(Oe=new Zl(3*st));var ft=function(ta){var vd=Oe.length;if(ta>vd){var Rs=new Zl(Math.max(2*vd,ta));Rs.set(Oe),Oe=Rs}},pt=Se.f||0,Ke=Se.p||0,yt=Se.b||0,ut=Se.l,_t=Se.d,gt=Se.m,Vt=Se.n,Ut=8*st;do{if(!ut){pt=_u(Ae,Ke,1);var kt=_u(Ae,Ke+1,3);if(Ke+=3,!kt){var Dt=Ae[(un=Cfe(Ke)+4)-4]|Ae[un-3]<<8,lr=un+Dt;if(lr>st){mt&&vu(0);break}it&&ft(yt+Dt),Oe.set(Ae.subarray(un,lr),yt),Se.b=yt+=Dt,Se.p=Ke=8*lr,Se.f=pt;continue}if(kt==1)ut=Afe,_t=Pfe,gt=9,Vt=5;else if(kt==2){var Jt=_u(Ae,Ke,31)+257,Ft=_u(Ae,Ke+10,15)+4,br=Jt+_u(Ae,Ke+5,31)+1;Ke+=14;for(var Gr=new Zl(br),mn=new Zl(19),$r=0;$r<Ft;++$r)mn[Sfe[$r]]=_u(Ae,Ke+3*$r,7);Ke+=3*Ft;var Ln=rD(mn),sn=(1<<Ln)-1,Di=Bw(mn,Ln);for($r=0;$r<br;){var un,On=Di[_u(Ae,Ke,sn)];if(Ke+=15&On,(un=On>>4)<16)Gr[$r++]=un;else{var li=0,gi=0;for(un==16?(gi=3+_u(Ae,Ke,3),Ke+=2,li=Gr[$r-1]):un==17?(gi=3+_u(Ae,Ke,7),Ke+=3):un==18&&(gi=11+_u(Ae,Ke,127),Ke+=7);gi--;)Gr[$r++]=li}}var yi=Gr.subarray(0,Jt),Li=Gr.subarray(Jt);gt=rD(yi),Vt=rD(Li),ut=Bw(yi,gt),_t=Bw(Li,Vt)}else vu(1);if(Ke>Ut){mt&&vu(0);break}}it&&ft(yt+131072);for(var Yo=(1<<gt)-1,_s=(1<<Vt)-1,io=Ke;;io=Ke){var _o=(li=ut[nD(Ae,Ke)&Yo])>>4;if((Ke+=15&li)>Ut){mt&&vu(0);break}if(li||vu(2),_o<256)Oe[yt++]=_o;else{if(_o==256){io=Ke,ut=null;break}var Io=_o-254;_o>264&&(Io=_u(Ae,Ke,(1<<(Si=D6[$r=_o-257]))-1)+z6[$r],Ke+=Si);var jr=_t[nD(Ae,Ke)&_s],_i=jr>>4;if(jr||vu(3),Ke+=15&jr,Li=Efe[_i],_i>3){var Si=L6[_i];Li+=nD(Ae,Ke)&(1<<Si)-1,Ke+=Si}if(Ke>Ut){mt&&vu(0);break}it&&ft(yt+131072);var sl=yt+Io;if(yt<Li){var ea=0-Li,Jo=Math.min(Li,sl);for(ea+yt<0&&vu(3);yt<Jo;++yt)Oe[yt]=Me[ea+yt]}for(;yt<sl;++yt)Oe[yt]=Oe[yt-Li]}}Se.l=ut,Se.p=io,Se.b=yt,Se.f=pt,ut&&(pt=1,Se.m=gt,Se.d=_t,Se.n=Vt)}while(!pt);return yt!=Oe.length&&et?function(ta,vd,Rs){return(Rs==null||Rs>ta.length)&&(Rs=ta.length),new Zl(ta.subarray(0,Rs))}(Oe,0,yt):Oe.subarray(0,yt)}(J.subarray(_e,-8),{i:2},new Zl(((le=J)[(de=le.length)-4]|le[de-3]<<8|le[de-2]<<16|le[de-1]<<24)>>>0),oe)));var J,oe,le,de,_e;const ye=Rfe[re];if(!ye)throw new Error(`Unhandled codec: ${re}`);const Te=new globalThis.DecompressionStream(ye);return new Response(new Blob([Y]).stream().pipeThrough(Te)).arrayBuffer().then(Ae=>new Uint8Array(Ae))}(N,D).then(Y=>(function(re,J){re.readFields(yfe,J)}(new iD(Y),V),new Dfe[b](V.buffer))),G.then(Y=>{for(let re=M.length-1;re>=0;re--)switch(M[re]){case"delta_filter":vfe(Y,E);break;case"zigzag_filter":xfe(Y);break;case"bitshuffle_filter":bfe(Y,b);break;default:throw new Oc(`Unhandled filter "${M[re]}"`)}return{layerName:p,blockIndex:I,data:Y}}).catch(Y=>{throw Y})}))},Wt(U6,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Wt(k2,"MapboxRasterTile"),Wt(V6,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class G6{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const d=i[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}class q6{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new lh(Mt,16,0),this.featureIndexArray=new Wm,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(i,a,d,p,y,_=0,b=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,y,_);const I=this.grid;for(let M=0;M<a.length;M++){const D=a[M],N=[1/0,1/0,-1/0,-1/0];for(let V=0;V<D.length;V++){const G=D[V];N[0]=Math.min(N[0],G.x),N[1]=Math.min(N[1],G.y),N[2]=Math.max(N[2],G.x),N[3]=Math.max(N[3],G.y)}b!==0&&(N[0]-=b,N[1]-=b,N[2]+=b,N[3]+=b),N[0]<Mt&&N[1]<Mt&&N[2]>=0&&N[3]>=0&&I.insert(E,N[0],N[1],N[2],N[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new An(new l2(this.rawTileData)).layers,this.sourceLayerCoder=new G6(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a){const{tilespaceGeometry:d,transform:p,tileTransform:y,pixelPosMatrix:_,availableImages:b,worldview:E}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const I=a.queryRadius?a.queryRadius:0,M=d.bufferedTilespaceBounds,D=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(Y,re,J,oe)=>Cc(d.bufferedTilespaceGeometry,Y-I,re-I,J+I,oe+I));D.sort(Lfe);let N=null;p.elevation&&D.length>0&&(N=q_.create(p.elevation,this.tileID));const V={};let G;for(let Y=0;Y<D.length;Y++){const re=D[Y];if(re===G)continue;G=re;const J=this.featureIndexArray.get(re);let oe=null;this.is3DTile?this.loadMatchingModelFeature(V,J,i,d,p,E):this.loadMatchingFeature(V,J,i,b,E,(le,de,_e,ye=0)=>(oe||(oe=yr(le,this.tileID.canonical,y)),de.queryIntersectsFeature(d,le,_e,oe,this.z,p,_,N,ye,a.scope)))}return V}loadMatchingFeature(i,a,d,p,y,_){const{featureIndex:b,bucketIndex:E,sourceLayerIndex:I,layoutVertexArrayOffset:M}=a,D=this.bucketLayerIDs[E],N=d.layers,V=Object.keys(N);if(V.length&&!Br(V,D))return;const G=d.sourceCache,Y=this.sourceLayerCoder.decode(I),re=this.vtLayers[Y].feature(b),J=this.getId(re,Y);for(let oe=0;oe<D.length;oe++){const le=D[oe];if(!N[le])continue;const{styleLayer:de,targets:_e}=N[le];let ye={};J!==void 0&&(ye=G.getFeatureState(de.sourceLayer,J));const Te=!_||_(re,de,ye,M);if(!Te)continue;const Ae=new ag(re,this.z,this.x,this.y,J);Ae.tile=this.tileID.canonical,Ae.state=ye;let Se=this.serializedLayersCache.get(le);Se||(Se=de.serialize(),Se.id=le,this.serializedLayersCache.set(le,Se)),Ae.source=Se.source,Ae.sourceLayer=Se["source-layer"],Ae.layer=Object.assign({},Se),Ae.layer.paint=H6(Se.paint,de.paint,re,ye,p),Ae.layer.layout=H6(Se.layout,de.layout,re,ye,p);let Oe=!1;for(const Me of _e){this.updateFeatureProperties(Ae,Me);const{filter:st}=Me;if(st){if(re.properties=Ae.properties,st.needGeometry){const et=Lr(re,!0);if(!st.filter(new Dn(this.tileID.overscaledZ,{worldview:y}),et,this.tileID.canonical))continue}else if(!st.filter(new Dn(this.tileID.overscaledZ,{worldview:y}),re))continue}Oe=!0,Me.targetId&&this.addFeatureVariant(Ae,Me)}Oe&&this.appendToResult(i,le,b,Ae,Te)}}loadMatchingModelFeature(i,a,d,p,y,_){const{featureIndex:b,bucketIndex:E}=a,I=this.bucketLayerIDs[E],M=d.layers,D=Object.keys(M);if(!D.length||Br(D,I))for(let N=0;N<I.length;N++){const V=I[N],{styleLayer:G,targets:Y}=M[V];if(G.type!=="model")continue;const re=p.tile,J=re.getBucket(G);if(!(J&&J instanceof E2))continue;const oe=Vhe(J,b,p,y);if(!oe)continue;const{z:le,x:de,y:_e}=re.tileID.canonical,{feature:ye,intersectionZ:Te,position:Ae}=oe;let Se={};ye.id!==void 0&&(Se=d.sourceCache.getFeatureState(G.sourceLayer,ye.id));const Oe=new ag({},le,de,_e,ye.id);Oe.tile=this.tileID.canonical,Oe.state=Se,Oe.properties=ye.properties,Oe.geometry={type:"Point",coordinates:[Ae.lng,Ae.lat]};let Me=this.serializedLayersCache.get(V);Me||(Me=G.serialize(),Me.id=V,this.serializedLayersCache.set(V,Me)),Oe.source=Me.source,Oe.sourceLayer=Me["source-layer"],Oe.layer=Object.assign({},Me);let st=!1;for(const et of Y){this.updateFeatureProperties(Oe,et);const{filter:it}=et;if(it){if(ye.properties=Oe.properties,it.needGeometry){if(!it.filter(new Dn(this.tileID.overscaledZ,{worldview:_}),ye,this.tileID.canonical))continue}else if(!it.filter(new Dn(this.tileID.overscaledZ,{worldview:_}),ye))continue}st=!0,et.targetId&&this.addFeatureVariant(Oe,et)}st&&this.appendToResult(i,V,b,Oe,Te)}}updateFeatureProperties(i,a,d){if(a.properties){const p={};for(const y in a.properties){const _=a.properties[y].evaluate({zoom:this.z},i._vectorTileFeature,i.state,i.tile,d);_!=null&&(p[y]=_)}i.properties=p}}addFeatureVariant(i,a,d){const p={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(p.properties=i.properties),i.variants=i.variants||{},i.variants[a.targetId]=i.variants[a.targetId]||[],i.variants[a.targetId].push(p)}appendToResult(i,a,d,p,y){let _=i[a];_===void 0&&(_=i[a]=[]),_.push({featureIndex:d,feature:p,intersectionZ:y})}lookupSymbolFeatures(i,a,d,p,y,_){const b={};this.loadVTLayers();for(const E of i)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:d,featureIndex:E,layoutVertexArrayOffset:0},p,y,_);return b}loadFeature(i){const{featureIndex:a,sourceLayerIndex:d}=i;this.loadVTLayers();const p=this.sourceLayerCoder.decode(d),y=this.vtFeatures[p];if(y[a])return y[a];const _=this.vtLayers[p].feature(a);return y[a]=_,_}hasLayer(i){for(const a of this.bucketLayerIDs)for(const d of a)if(i===d)return!0;return!1}getId(i,a){let d=i.id;if(this.promoteId){const p=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(p!=null)if(Array.isArray(p)){if(!this.promoteIdExpression){const y=ld(p);if(y.result!=="success"){const _=y.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void vr(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=y.value}d=this.promoteIdExpression.evaluate({zoom:0},i)}else d=i.properties[p];typeof d=="boolean"&&(d=Number(d))}return d}}function H6(c,i,a,d,p){return ar(c,(y,_)=>{const b=i instanceof Xs?i.get(_):null;return b&&b.evaluate?b.evaluate(a,d,void 0,p):b})}function Lfe(c,i){return i-c}Wt(q6,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const W6=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class oD{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,d]=new Uint8Array(i,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=d>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const y=W6[15&d];if(!y)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(i,2,1),[b]=new Uint32Array(i,4,1);return new oD(b,_,y,i)}constructor(i,a=64,d=Float64Array,p){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const y=W6.indexOf(this.ArrayType),_=2*i*this.ArrayType.BYTES_PER_ELEMENT,b=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-b%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+_+b+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+b+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=i)}add(i,a){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=i,this.coords[this._pos++]=a,d}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return sD(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,a,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:_,nodeSize:b}=this,E=[0,y.length-1,0],I=[];for(;E.length;){const M=E.pop()||0,D=E.pop()||0,N=E.pop()||0;if(D-N<=b){for(let re=N;re<=D;re++){const J=_[2*re],oe=_[2*re+1];J>=i&&J<=d&&oe>=a&&oe<=p&&I.push(y[re])}continue}const V=N+D>>1,G=_[2*V],Y=_[2*V+1];G>=i&&G<=d&&Y>=a&&Y<=p&&I.push(y[V]),(M===0?i<=G:a<=Y)&&(E.push(N),E.push(V-1),E.push(1-M)),(M===0?d>=G:p>=Y)&&(E.push(V+1),E.push(D),E.push(1-M))}return I}within(i,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:y,nodeSize:_}=this,b=[0,p.length-1,0],E=[],I=d*d;for(;b.length;){const M=b.pop()||0,D=b.pop()||0,N=b.pop()||0;if(D-N<=_){for(let re=N;re<=D;re++)X6(y[2*re],y[2*re+1],i,a)<=I&&E.push(p[re]);continue}const V=N+D>>1,G=y[2*V],Y=y[2*V+1];X6(G,Y,i,a)<=I&&E.push(p[V]),(M===0?i-d<=G:a-d<=Y)&&(b.push(N),b.push(V-1),b.push(1-M)),(M===0?i+d>=G:a+d>=Y)&&(b.push(V+1),b.push(D),b.push(1-M))}return E}}function sD(c,i,a,d,p,y){if(p-d<=a)return;const _=d+p>>1;Z6(c,i,_,d,p,y),sD(c,i,a,d,_-1,1-y),sD(c,i,a,_+1,p,1-y)}function Z6(c,i,a,d,p,y){for(;p>d;){if(p-d>600){const I=p-d+1,M=a-d+1,D=Math.log(I),N=.5*Math.exp(2*D/3),V=.5*Math.sqrt(D*N*(I-N)/I)*(M-I/2<0?-1:1);Z6(c,i,a,Math.max(d,Math.floor(a-M*N/I+V)),Math.min(p,Math.floor(a+(I-M)*N/I+V)),y)}const _=i[2*a+y];let b=d,E=p;for(Vw(c,i,d,a),i[2*p+y]>_&&Vw(c,i,d,p);b<E;){for(Vw(c,i,b,E),b++,E--;i[2*b+y]<_;)b++;for(;i[2*E+y]>_;)E--}i[2*d+y]===_?Vw(c,i,d,E):(E++,Vw(c,i,E,p)),E<=a&&(d=E+1),a<=E&&(p=E-1)}}function Vw(c,i,a,d){aD(c,a,d),aD(i,2*a,2*d),aD(i,2*a+1,2*d+1)}function aD(c,i,a){const d=c[i];c[i]=c[a],c[a]=d}function X6(c,i,a,d){const p=c-a,y=i-d;return p*p+y*y}o.$=Ux,o.A=ha,o.B=uh,o.C=2,o.D=M_,o.E=cu,o.F=Ew,o.G=_U,o.H=By,o.I=ua,o.J=uA,o.K=xr,o.L=gr,o.M=vb,o.N=a_,o.O=GE,o.P=wt,o.Q=Mm,o.R=ca,o.S=__,o.T=gM,o.U=ld,o.V=T2,o.W=u_,o.X=Sf,o.Y=wf,o.Z=Am,o._=pa,o.a=function(c){return po.API_CDN_URL_REGEX.test(c)},o.a$=vt,o.a0=xm,o.a1=_E,o.a2=Nb,o.a3=class extends T2{},o.a4=l_,o.a5=_b,o.a6=Ue,o.a7=function(c){const i=c.value;return i?xm(i)?ZM(i,!0)?[]:[new T2(c.key,i,`invalid url "${i}"`)]:[new T2(c.key,i,`string expected, "${xr(i)}" found`)]:[]},o.a8=Mf,o.a9=bi,o.aA=we,o.aB=q,o.aC=er,o.aD=ie,o.aE=Ra,o.aF=$e,o.aG=It,o.aH=function(c,i){const a={};for(let d=0;d<i.length;d++){const p=i[d];p in c&&(a[p]=c[p])}return a},o.aI=ke,o.aJ=Je,o.aK=class{constructor(c){this.entries={},this.scheduler=c}request(c,i,a,d){const p=this.entries[c]=this.entries[c]||{callbacks:[]};if(p.result){const[y,_]=p.result;return this.scheduler?this.scheduler.add(()=>{d(y,_)},i):d(y,_),()=>{}}return p.callbacks.push(d),p.cancel||(p.cancel=a((y,_)=>{p.result=[y,_];for(const b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(y,_)},i):b(y,_);setTimeout(()=>delete this.entries[c],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(y=>y!==d),p.callbacks.length||(p.cancel(),delete this.entries[c]))}}},o.aL=function(c,i,a){const d=JSON.stringify(c.request);return c.data&&(this.deduped.entries[d]={result:[null,c.data]}),this.deduped.request(d,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},p=>{const y=pm(c.request,(_,b,E)=>{_?p(_):b&&p(null,{rawData:b,vectorTile:a?void 0:new An(new l2(b)),responseHeaders:new Map(E.entries())})});return()=>{y.cancel(),p()}},i)},o.aM=function(c){return c?{cacheControl:c.get("Cache-Control"),expires:c.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=hm,o.aO=function(c){_c++,_c>Lx&&(c.getActor().send("enforceCacheSizeLimit",hE),_c=0)},o.aP=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log2(c)))},o.aQ=Qs,o.aR=YU,o.aS=n6,o.aT=ve,o.aU=KU,o.aV=function(c,i){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let d=0;d<c.length;d++){const p=document.createElement("source");oR(c[d])||(a.crossOrigin="Anonymous"),p.src=c[d],a.appendChild(p)}return{cancel:()=>{}}},o.aW=xw,o.aX=lg,o.aY=qt,o.aZ=Cw,o.a_=ht,o.aa=Ct,o.ab=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return ki(c.expression.evaluate(i))}interpolate(c,i,a){return{x:mr(c.x,i.x,a),y:mr(c.y,i.y,a),z:mr(c.z,i.z,a),azimuthal:mr(c.azimuthal,i.azimuthal,a),polar:mr(c.polar,i.polar,a)}}},o.ac=Dn,o.ad=ah,o.ae=Lt,o.af=Ir,o.ag=dt,o.ah=je,o.ai=Xs,o.aj=Uf,o.ak=mr,o.al=Mt,o.am=Fx,o.an=an,o.ao=En,o.ap=class{constructor(c){this.specification=c}possiblyEvaluate(c,i){return function([a,d]){const p=ki([1,a,d]);return{x:p.x,y:p.y,z:p.z}}(c.expression.evaluate(i))}interpolate(c,i,a){return{x:mr(c.x,i.x,a),y:mr(c.y,i.y,a),z:mr(c.z,i.z,a)}}},o.aq=function(c,i,a=0,d=!0){const p=new wt(a,a),y=c.sub(p),_=i.add(p),b=[y,new wt(_.x,y.y),_,new wt(y.x,_.y)];return d&&b.push(y.clone()),b},o.ar=function(c,i){const a=[];for(let d=0;d<c.length;d++){const p=Ye(d-1,-1,c.length-1),y=Ye(d+1,-1,c.length-1),_=c[d],b=c[y],E=c[p].sub(_).unit(),I=b.sub(_).unit(),M=I.angleWithSep(E.x,E.y),D=E.add(I).unit().mult(-1*i/Math.sin(M/2));a.push(_.add(D))}return a},o.as=LU,o.at=Cc,o.au=function(c,i,a=0){return rt(((i.x-a)*c.scale-c.x)*Mt,(i.y*c.scale-c.y)*Mt,We(i.z,i.y))},o.av=Nn,o.aw=Rt,o.ax=Zn,o.ay=WV,o.az=function(c){let i=1/0,a=1/0,d=-1/0,p=-1/0;for(const y of c)i=Math.min(i,y.x),a=Math.min(a,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return{min:new wt(i,a),max:new wt(d,p)}},o.b=function(c){return po.API_FONTS_REGEX.test(c)},o.b$=U$,o.b0=go,o.b1=mu,o.b2=Tt,o.b3=vA,o.b4=x2,o.b5=function(){Hl.isLoading()||Hl.isLoaded()||Db()!=="deferred"||Lb()},o.b6=zb,o.b7=Lr,o.b8=ag,o.b9=ui,o.bA=B,o.bB=ue,o.bC=$,o.bD=function(c,i){const{x:a,y:d}=c.point,p=i$(a,d,c.worldSize/c._pixelsPerMercatorPixel,0,0);return q(p,p,zR(gd(i)))},o.bE=P,o.bF=Hn,o.bG=Yr,o.bH=ur,o.bI=ir,o.bJ=Yt,o.bK=B_,o.bL=ol,o.bM=MM,o.bN=function(c,i,a,d,p){const y=5*i+2;c.float32[y+0]=a,c.float32[y+1]=d,c.float32[y+2]=p},o.bO=G_,o.bP=as,o.bQ=Ul,o.bR=Wa,o.bS=si,o.bT=Ye,o.bU=function(c,i,a,d){var p=new w(4);return p[0]=c,p[1]=i,p[2]=a,p[3]=d,p},o.bV=class{isDataAvailableAtPoint(c){const i=this._source();if(this.isUsingMockSource()||!i||c.y<0||c.y>1)return!1;const a=i.getSource().maxzoom,d=1<<a,p=Math.floor(c.x),y=Math.floor((c.x-p)*d),_=Math.floor(c.y*d),b=this.findDEMTileFor(new Qs(a,p,a,y,_));return!(!b||!b.dem)}getAtPointOrZero(c,i=0){return this.getAtPoint(c,i)||0}getAtPoint(c,i,a=!0){if(this.isUsingMockSource())return null;i==null&&(i=null);const d=this._source();if(!d||c.y<0||c.y>1)return i;const p=d.getSource().maxzoom,y=1<<p,_=Math.floor(c.x),b=c.x-_,E=new Qs(p,_,p,Math.floor(b*y),Math.floor(c.y*y)),I=this.findDEMTileFor(E);if(!I||!I.dem)return i;const M=I.dem,D=1<<I.tileID.canonical.z,N=(b*D-I.tileID.canonical.x)*M.dim,V=(c.y*D-I.tileID.canonical.y)*M.dim,G=Math.floor(N),Y=Math.floor(V);return(a?this.exaggeration():1)*mr(mr(M.get(G,Y),M.get(G,Y+1),V-Y),mr(M.get(G+1,Y),M.get(G+1,Y+1),V-Y),N-G)}static getAtTileOffset(c,i,a,d){const p=1<<c.canonical.z;return d?d.pointElevation(i):a?a.getAtPointOrZero(new Lt(c.wrap+(c.canonical.x+i.x/Mt)/p,(c.canonical.y+i.y/Mt)/p)):0}static getAtTileOffsetFunc(c,i,a,d){return(p,y,_)=>{const b=this.getAtTileOffset(c,p,y,_),E=d.upVector(c.canonical,p.x,p.y);return $t(E,E,b*d.upVectorScale(c.canonical,i,a).metersToTile),E}}getForTilePoints(c,i,a,d){if(this.isUsingMockSource())return!1;const p=q_.create(this,c,d);return!!p&&(i.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],a)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(c);if(!i||!i.dem)return null;const a=i.dem.tree,d=i.tileID,p=1<<c.canonical.z-d.canonical.z;let y=c.canonical.x/p-d.canonical.x,_=c.canonical.y/p-d.canonical.y,b=0;for(let E=0;E<c.canonical.z-d.canonical.z&&!a.leaves[b];E++){y*=2,_*=2;const I=2*Math.floor(_)+Math.floor(y);b=a.childOffsets[b]+I,y%=1,_%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let i=!1,a=Number.MAX_VALUE,d=Number.MIN_VALUE;for(const p of c){const y=this.getMinMaxForTile(p.tileID);y&&(a=Math.min(a,y.min),d=Math.max(d,y.max),i=!0)}return i?{min:a,max:d}:null}},o.bW=YA,o.bX=mi,o.bY=jo,o.bZ=F$,o.b_=i6,o.ba=EM,o.bb=tM,o.bc=yr,o.bd=pd,o.be=Gm,o.bf=J4,o.bg=di,o.bh=I_,o.bi=HM,o.bj=function(c,i){const a=Uf(i.zoom);if(a===0)return gd(c);const d=NA(c),p=NR(d),y=$e(d.getWest())*i.worldSize,_=$e(d.getEast())*i.worldSize,b=Je(d.getNorth())*i.worldSize,E=Je(d.getSouth())*i.worldSize,I=[y,b,0],M=[_,b,0],D=[y,E,0],N=[_,E,0],V=U([],i.globeMatrix);return Ir(I,I,V),Ir(M,M,V),Ir(D,D,V),Ir(N,N,V),p[0]=ph(p[0],D,a),p[1]=ph(p[1],N,a),p[2]=ph(p[2],M,a),p[3]=ph(p[3],I,a),vn.fromPoints(p)},o.bk=FA,o.bl=U,o.bm=rw,o.bn=ph,o.bo=pu,o.bp=Wce,o.bq=me,o.br=H,o.bs=k2,o.bt=l2,o.bu=pm,o.bv=function(c,i){const a=[];for(const d in c)d in i||a.push(d);return a},o.bw=ze,o.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.by=Cs,o.bz=j,o.c=Is,o.c$=function(c,i,a){let d=0;for(let p=0;p<2;++p)c[p]>0&&(d+=(c[p]-0)*(c[p]-0)),i[p]<0&&(d+=(0-i[p])*(0-i[p]));return d},o.c0=G$,o.c1=OM,o.c2=AU,o.c3=zM,o.c4=oD,o.c5=$t,o.c6=ot,o.c7=Tn,o.c8=function(c,i,a){a*=.5;var d=i[0],p=i[1],y=i[2],_=i[3],b=Math.sin(a),E=Math.cos(a);return c[0]=d*E+p*b,c[1]=p*E-d*b,c[2]=y*E+_*b,c[3]=_*E-y*b,c},o.c9=Kn,o.cA=Ze,o.cB=Do,o.cC=RV,o.cD=Jm,o.cE=t$,o.cF=function(c,i,a,d,p,y,_,b,E){if(E.name==="globe")return t$(c,i,new Jm(a,d,p),!1);const I=Cw({z:a,x:d,y:p},E);return new vn([(y+I.x/I.scale)*i,i*(I.y/I.scale),_],[(y+I.x2/I.scale)*i,i*(I.y2/I.scale),b])},o.cG=function(c,i,a){return c[0]=Math.min(i[0],a[0]),c[1]=Math.min(i[1],a[1]),c[2]=Math.min(i[2],a[2]),c[3]=Math.min(i[3],a[3]),c},o.cH=function(c,i,a){return c[0]=Math.max(i[0],a[0]),c[1]=Math.max(i[1],a[1]),c[2]=Math.max(i[2],a[2]),c[3]=Math.max(i[3],a[3]),c},o.cI=function(c){const i=Math.round((c+45+360)%360/90)%4;return se[i]},o.cJ=Re,o.cK=Nt,o.cL=6,o.cM=function(c){const i=B(new Float64Array(16));q(i,c.pixelMatrix,c.globeMatrix);const a=[0,pe,0],d=[0,fe,0];return Ir(a,a,i),Ir(d,d,i),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!BR(c,new ve(c.center.lat,90)),d[0]>0&&d[0]<=c.width&&d[1]>0&&d[1]<=c.height&&!BR(c,new ve(c.center.lat,-90))]},o.cN=function(c,i){const{scale:a}=c.tileTransform,d=a*Mt/(c.tileSize*Math.pow(2,i.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return function(p,y,_){var b=y[1],E=y[2],I=y[3],M=_[0],D=_[1];return p[0]=y[0]*M,p[1]=b*M,p[2]=E*D,p[3]=I*D,p}(new Float32Array(4),i.inverseAdjustmentMatrix,[d,d])},o.cO=r2,o.cP=Ve,o.cQ=kV,o.cR=function(c){const i=kV(c,!0);return P([],[i[0],i[1],i[4],i[5]])},o.cS=te,o.cT=wi,o.cU=Q,o.cV=function(c){const{x:i,y:a}=c.point,{lng:d,lat:p}=c._center;return i$(i,a,c.worldSize,d,p)},o.cW=Et,o.cX=Be,o.cY=C_,o.cZ=Ic,o.c_=5,o.ca=pi,o.cb=function(c,i){return c[0]=-i[0],c[1]=-i[1],c[2]=-i[2],c[3]=i[3],c},o.cc=Ge,o.cd=function(c,i,a,d,p){var y=1/Math.tan(i/2);if(c[0]=y/a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=y,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,p!=null&&p!==1/0){var _=1/(d-p);c[10]=(p+d)*_,c[14]=2*p*d*_}else c[10]=-1,c[14]=-2*d;return c},o.ce=function(c,i,a,d,p,y,_){var b=1/(i-a),E=1/(d-p),I=1/(y-_);return c[0]=-2*b,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*E,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*I,c[11]=0,c[12]=(i+a)*b,c[13]=(p+d)*E,c[14]=(_+y)*I,c[15]=1,c},o.cf=Xe,o.cg=function(c,i,a){c[4*i+0]=a[0],c[4*i+1]=a[1],c[4*i+2]=a[2],c[4*i+3]=a[3]},o.ch=el,o.ci=Km,o.cj=Qi,o.ck=tl,o.cl=Bf,o.cm=BU,o.cn=function(){var c=new w(4);return w!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},o.co=function(c,i,a){var d=i[0],p=i[1],y=i[2],_=i[3],b=Math.sin(a),E=Math.cos(a);return c[0]=d*E+y*b,c[1]=p*E+_*b,c[2]=d*-b+y*E,c[3]=p*-b+_*E,c},o.cp=function(c,i){return c[0]===i[0]&&c[1]===i[1]&&c[2]===i[2]&&c[3]===i[3]},o.cq=ei,o.cr=function(c){var i=c[0],a=c[1],d=c[2],p=c[3];return Math.sqrt(i*i+a*a+d*d+p*p)},o.cs=qa,o.ct=Vn,o.cu=Y4,o.cv=3,o.cw=2,o.cx=7,o.cy=6,o.cz=jt,o.d=function(c){return po.API_TILEJSON_REGEX.test(c)},o.d$=class{constructor(c,i,a,d){this.context=c,this.format=d,this.size=a,this.texture=c.gl.createTexture();const[p,y,_]=this.size,{gl:b}=c;b.bindTexture(b.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in i&&i.data&&b.texImage3D(b.TEXTURE_3D,0,this.format,p,y,_,0,pM(this.format),mM(this.format),i.data)}bind(c,i){const{context:a}=this,{gl:d}=a;d.bindTexture(d.TEXTURE_3D,this.texture),c!==this.minFilter&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MAG_FILTER,c),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_MIN_FILTER,c),this.minFilter=c),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_3D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},o.d0=function(c){return c*c*c*c*c},o.d1=Ne,o.d2=45,o.d3=A_,o.d4=function(c,i,a){const d=Math.sqrt(c*c+i*i+a*a),p=d>0?Math.acos(a/d)*Aa:0;let y=c!==0||i!==0?Math.atan2(-i,-c)*Aa+90:0;return y<0&&(y+=360),[d,y,p]},o.d5=rt,o.d6=ki,o.d7=At,o.d8=qe,o.d9=vn,o.dA=function(c){return c({pluginStatus:Zs,pluginURL:hd}),Mb.on("pluginStateChange",c),c},o.dB=DA,o.dC=class extends Wl{constructor(c){super(c),this.current=q4}set(c,i,a){if(this.fetchUniformLocation(c,i)){for(let d=0;d<9;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},o.dD=he,o.dE=function(c,i,a){const d=Uf(a.zoom),p=c.style.map._antialias,y=c.terrain&&c.terrain.exaggeration()>0;return d===0&&!p&&!y},o.dF=function(c){const i=c.pixelsPerMeter,a=i/Xe(1,c.center.lat),d=B(new Float64Array(16));return H(d,d,[c.point.x,c.point.y,0]),te(d,d,[a,a,i]),Float32Array.from(d)},o.dG=NA,o.dH=function(c){const i=80.051129;c=we(c,-80.051129,i)/i*90;const a=Math.pow(Math.abs(Math.sin(an(c))),3);return Math.round(a*(ge.length-1))},o.dI=function(c,i,a,d){const p=i.getNorth(),y=i.getSouth(),_=i.getWest(),b=i.getEast(),E=1<<c.z,I=b-_,M=p-y,D=I/ce,N=-M/ge[a],V=[0,D,0,N,0,0,p,_,0];if(c.z>0){const G=180/d;L(V,V,[G/I+1,0,0,0,G/M+1,0,-.5*G/D,.5*G/N,1])}return V[2]=E,V[5]=c.x,V[8]=c.y,V},o.dJ=gd,o.dK=function(c,i,a){const d=B(new Float64Array(16)),p=(i/(1<<c)-.5)*Math.PI*2;return ae(d,a.globeMatrix,p),Float32Array.from(d)},o.dL=y$,o.dM=jA,o.dN=function(c,i){return[Math.pow(c[0],2.2)*i,Math.pow(c[1],2.2)*i,Math.pow(c[2],2.2)*i]},o.dO=C,o.dP=function(c,i){var a=Math.sin(i),d=Math.cos(i);return c[0]=d,c[1]=a,c[2]=0,c[3]=-a,c[4]=d,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},o.dQ=Xr,o.dR=n$,o.dS=Ai,o.dT=ls,o.dU=256,o.dV=function(c,i){const a=[0,0,0];return Ir(a,a,FA(gd(i.canonical))),Ir(a,a,c),a},o.dW=c=>({u_matrix:new Bf(c),u_texsize:new tl(c),u_pixels_to_tile_units:new s(c),u_device_pixel_ratio:new Qi(c),u_width_scale:new Qi(c),u_floor_width_scale:new Qi(c),u_image:new el(c),u_units_to_pixels:new tl(c),u_tile_units_to_pixels:new Qi(c),u_alpha_discard_threshold:new Qi(c),u_trim_offset:new tl(c),u_trim_fade_range:new tl(c),u_trim_gradient_mix_range:new tl(c),u_trim_color:new A_(c),u_zbias_factor:new Qi(c),u_tile_to_meter:new Qi(c),u_ground_shadow_factor:new Km(c),u_pattern_transition:new Qi(c)}),o.dX=c=>({u_matrix:new Bf(c),u_pixels_to_tile_units:new s(c),u_device_pixel_ratio:new Qi(c),u_width_scale:new Qi(c),u_floor_width_scale:new Qi(c),u_units_to_pixels:new tl(c),u_dash_image:new el(c),u_gradient_image:new el(c),u_image_height:new Qi(c),u_texsize:new tl(c),u_tile_units_to_pixels:new Qi(c),u_alpha_discard_threshold:new Qi(c),u_trim_offset:new tl(c),u_trim_fade_range:new tl(c),u_trim_gradient_mix_range:new tl(c),u_trim_color:new A_(c),u_zbias_factor:new Qi(c),u_tile_to_meter:new Qi(c),u_ground_shadow_factor:new Km(c)}),o.dY=c=>({u_camera_to_center_distance:new Qi(c),u_extrude_scale:new s(c),u_device_pixel_ratio:new Qi(c),u_matrix:new Bf(c),u_inv_rot_matrix:new Bf(c),u_merc_center:new tl(c),u_tile_id:new Km(c),u_zoom_transition:new Qi(c),u_up_dir:new Km(c),u_emissive_strength:new Qi(c)}),o.dZ=b_,o.d_=Hde,o.da=He,o.db=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},o.dc=OV,o.dd=wM,o.de=LV,o.df=ZM,o.dg=function(c,i){return c.readFields(Ghe,{icons:[]},i)},o.dh=JA,o.di=$_,o.dj=LM,o.dk=fm,o.dl=aA,o.dm=dm,o.dn=mf,o.dp=Or,o.dq=function(c){const i=c.indexOf(Bm);return i>=0?c.slice(0,i):c},o.dr=function(c){return c.indexOf(Bm)>=0},o.ds=function(c){const i=c.lastIndexOf(Bm);return i>=0?c.slice(i+1):""},o.dt=function(c){const i=[],a=c.id;return a===void 0&&i.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&i.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},o.du=function(c,i,a,d){return c.type==="custom"?new zhe(c,i):new Uhe[c.type](c,i,a,d)},o.dv=pr,o.dw=function(c){const i=c.indexOf(Bm);return i>=0?c.slice(i+1):""},o.dx=class extends ag{constructor(c,i){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state=Object.assign({},c.state)),this.target=i.target,this.namespace=i.namespace,i.properties&&(this.properties=i.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},o.dy=Mb,o.dz=au,o.e=po,o.e$=at,o.e0=a$,o.e1=(c,i,a,d,p,y)=>{const _=c.transform,b=_.projection.name==="globe";let E;if(y.paint.get("circle-pitch-alignment")==="map")if(b){const M=n$(_.zoom,i.canonical)*_._pixelsPerMercatorPixel;E=Float32Array.from([M,0,0,M])}else E=_.calculatePixelsToTileUnitsMatrix(a);else E=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const I={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(_.projection),u_matrix:c.translatePosMatrix(i.projMatrix,a,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Za.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Jce,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:y.paint.get("circle-emissive-strength")};if(b){I.u_inv_rot_matrix=d,I.u_merc_center=p,I.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],I.u_zoom_transition=Uf(_.zoom);const M=p[0]*Mt,D=p[1]*Mt;I.u_up_dir=_.projection.upVector(new Jm(0,0,0),M,D)}return I},o.e2=YV,o.e3=fa,o.e4=(c,i,a,d,p,y,_,b,E,I)=>{const M=c.transform,D=M.pitch<15?ZV(.07,.7,we((14-M.zoom)/5,0,1)):.07,N=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:KV(c,i,a,d),u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:p,u_width_scale:y,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:XV(i,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:a.lut).toArray01(),u_zbias_factor:D,u_tile_to_meter:At(i.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:I}},o.e5=(c,i,a,d,p,y,_,b,E,I)=>{const M=c.transform,D=M.calculatePixelsToTileUnitsMatrix(i),N=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=M.pitch<15?ZV(.07,.7,we((14-M.zoom)/5,0,1)):.07;return{u_matrix:KV(c,i,a,d),u_pixels_to_tile_units:D,u_device_pixel_ratio:y,u_width_scale:_,u_floor_width_scale:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:JV(a)&&i.lineAtlasTexture?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:XV(i,c.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(N?null:a.lut).toArray01(),u_zbias_factor:V,u_tile_to_meter:At(i.tileID.canonical,0),u_ground_shadow_factor:I}},o.e6=xt,o.e7=nw,o.e8=We,o.e9=qce,o.eA=function(c,i){var a=2*Math.acos(i[3]),d=Math.sin(a/2);return d>v?(c[0]=i[0]/d,c[1]=i[1]/d,c[2]=i[2]/d):(c[0]=1,c[1]=0,c[2]=0),a},o.eB=YM,o.eC=o2,o.eD=i2,o.eE=[1,1,1],o.eF=q_,o.eG=St,o.eH=function(c,i,a,d){var p=i[0],y=i[1],_=i[2],b=i[3];return c[0]=p+d*(a[0]-p),c[1]=y+d*(a[1]-y),c[2]=_+d*(a[2]-_),c[3]=b+d*(a[3]-b),c},o.eI=N_,o.eJ=Qa,o.eK=hh,o.eL=function(c,i,a,d,p,y,_,b,E,I,M,D,N,V,G,Y){var re=new w(16);return re[0]=c,re[1]=i,re[2]=a,re[3]=d,re[4]=p,re[5]=y,re[6]=_,re[7]=b,re[8]=E,re[9]=I,re[10]=M,re[11]=D,re[12]=N,re[13]=V,re[14]=G,re[15]=Y,re},o.eM=Pe,o.eN=Um,o.eO=Kb,o.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new wt(1/0,1/0),max:new wt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,i=!1){const a=$$(new wt(0,0),new wt(Mt,Mt),c),d=[];if(i&&!rM(a,this._globalClipBounds))return d;for(const p of this._activeRegions){if(p.hiddenByOverlap||!rM(a,p))continue;const y=Due(p.min,p.max,c);d.push({min:y.min,max:y.max,sourceId:this._sourceIds[p.priority],footprint:p.footprint,footprintTileId:p.tileId,order:p.order,clipMask:p.clipMask,clipScope:p.clipScope})}return d}setSources(c){this._setSources(c.map(i=>({getSourceId:()=>i.cache.id,getFootprints:()=>{const a=[];for(const d of i.cache.getVisibleCoordinates()){const p=i.cache.getTile(d).buckets[i.layer];p&&p.updateFootprints(d.toUnwrapped(),a)}return a},getOrder:()=>i.order,getClipMask:()=>i.clipMask,getClipScope:()=>i.clipScope})))}_addSource(c){const i=c.getFootprints();if(i.length===0)return;const a=c.getOrder(),d=c.getClipMask(),p=c.getClipScope();for(const y of i){if(!y.footprint)continue;const _=$$(y.footprint.min,y.footprint.max,y.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:y.id,footprint:y.footprint,order:a,clipMask:d,clipScope:p})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((i,a)=>i.priority-a.priority||WA(i.min,a.min)||WA(i.max,a.max)||i.order-a.order||i.clipMask-a.clipMask||function(d,p){const y=(_,b)=>_+b;return d.length-p.length||d.reduce(y,"").localeCompare(p.reduce(y,""))}(i.clipScope,a.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let i=0;for(;!c&&i!==this._activeRegions.length;){const a=this._activeRegions[i],d=this._prevRegions[i];c=a.priority!==d.priority||!B$(a,d)||a.order!==d.order||a.clipMask!==d.clipMask||!Cs(a.clipScope,d.clipScope),this._activeRegions[i].hiddenByOverlap=d.hiddenByOverlap,++i}}if(c){++this._updateTime;for(const a of this._activeRegions)a.order!==dw&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const i=a=>{const d=this._activeRegions;if(a>=d.length)return a;const p=d[a].priority;for(;a<d.length&&d[a].priority===p;)++a;return a};if(this._sourceIds.length>1){let a=0,d=i(a);for(;a!==d;){let p=a;const y=a;for(;p!==d;){const _=this._activeRegions[p];_.hiddenByOverlap=!1;for(let b=0;b<y;b++){const E=this._activeRegions[b];if(!E.hiddenByOverlap&&_.order===dw&&rM(_,E)&&(_.hiddenByOverlap=V$(_.footprint,_.tileId,E.footprint,E.tileId),_.hiddenByOverlap))break}++p}a=d,d=i(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let i=c.length-1;i>=0;i--)this._addSource(c[i]);this._computeReplacement()}},o.eQ=dw,o.eR=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,i){const a=new pd,d=new go,p=[],y=c+1+2,_=i[0]+1,b=i[0]+1+(1+i.length),E=(I,M,D)=>{let N=I===y-1?I-2:I===0?I:I-1;return N+=D?24575:0,[N,M]};for(let I=0;I<y;++I)a.emplaceBack(...E(I,0,!0));for(let I=0;I<_;++I)for(let M=0;M<y;++M)a.emplaceBack(...E(M,I,(M===0||M===y-1)&&!0));for(let I=0;I<i.length;++I){const M=i[I];for(let D=0;D<y;++D)a.emplaceBack(...E(D,M,!0))}for(let I=0;I<i.length;++I){const M=d.length,D=i[I]+1+2,N=new go;for(let Y=0;Y<D-1;Y++){const re=Y===D-2,J=re?y*(b-i.length+I-Y):y;for(let oe=0;oe<y-1;oe++){const le=Y*y+oe;Y===0||re||oe===0||oe===y-2?(N.emplaceBack(le+1,le,le+J),N.emplaceBack(le+J,le+J+1,le+1)):(d.emplaceBack(le+1,le,le+J),d.emplaceBack(le+J,le+J+1,le+1))}}const V=di.simpleSegment(0,M,a.length,d.length-M);for(let Y=0;Y<N.uint16.length;Y+=3)d.emplaceBack(N.uint16[Y],N.uint16[Y+1],N.uint16[Y+2]);const G=di.simpleSegment(0,M,a.length,d.length-M);p.push({withoutSkirts:V,withSkirts:G})}return{vertices:a,indices:d,segments:p}}_createGrid(c){const i=this._fillGridMeshWithLods(ce,ge);this._gridSegments=i.segments,this._gridBuffer=c.createVertexBuffer(i.vertices,J4.members),this._gridIndexBuffer=c.createIndexBuffer(i.indices,!0)}_createPoles(c){const i=new go;for(let _=0;_<=ce;_++)i.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=c.createIndexBuffer(i,!0);const a=new dh,d=new dh,p=new dh,y=new dh;this._poleSegments=[];for(let _=0,b=0;_<5;_++){const E=360/(1<<_);a.emplaceBack(0,-ie,0,.5,0),d.emplaceBack(0,-ie,0,.5,1),p.emplaceBack(0,-ie,0,.5,.5),y.emplaceBack(0,-ie,0,.5,.5);for(let I=0;I<=ce;I++){let M=I/ce,D=0;const N=mr(0,E,M),[V,G,Y]=Ie(Kce,Yce,N,ie);a.emplaceBack(V,G,Y,M,D),d.emplaceBack(V,G,Y,M,1-D);const re=an(N);M=.5+.5*Math.sin(re),D=.5+.5*Math.cos(re),p.emplaceBack(V,G,Y,M,D),y.emplaceBack(V,G,Y,M,1-D)}this._poleSegments.push(di.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,LA,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(d,LA,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(p,LA,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(y,LA,!1)}getGridBuffers(c,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,i){return[i?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,i?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},o.eS=Mue,o.eT=xe,o.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eV=Le,o.eW=bt,o.eX=function(c,i,a){return c[0]=i[0]/a[0],c[1]=i[1]/a[1],c[2]=i[2]/a[2],c},o.eY=ho,o.eZ=Ee,o.e_=rr,o.ea=KA,o.eb=rV,o.ec=gh,o.ed=450,o.ee=7,o.ef=Qe,o.eg=function(c,i){if(c===i){var a=i[1],d=i[2],p=i[3],y=i[6],_=i[7],b=i[11];c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=a,c[6]=i[9],c[7]=i[13],c[8]=d,c[9]=y,c[11]=i[14],c[12]=p,c[13]=_,c[14]=b}else c[0]=i[0],c[1]=i[4],c[2]=i[8],c[3]=i[12],c[4]=i[1],c[5]=i[5],c[6]=i[9],c[7]=i[13],c[8]=i[2],c[9]=i[6],c[10]=i[10],c[11]=i[14],c[12]=i[3],c[13]=i[7],c[14]=i[11],c[15]=i[15];return c},o.eh=Nhe,o.ei=Zr,o.ej=Qb,o.ek=256,o.el=zR,o.em=Il,o.en=ae,o.eo=function(c,i){return c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[4],c[4]=i[5],c[5]=i[6],c[6]=i[8],c[7]=i[9],c[8]=i[10],c},o.ep=dh,o.eq=BE,o.er=T_,o.es=function(c,i,a,d,p){return we((c-i)/(a-i)*(p-d)+d,d,p)},o.et=Po,o.eu=function(c,i){var a=i[0],d=i[1],p=i[2],y=i[3],_=i[4],b=i[5],E=i[6],I=i[7],M=i[8],D=M*_-b*I,N=-M*y+b*E,V=I*y-_*E,G=a*D+d*N+p*V;return G?(c[0]=D*(G=1/G),c[1]=(-M*d+p*I)*G,c[2]=(b*d-p*_)*G,c[3]=N*G,c[4]=(M*a-p*E)*G,c[5]=(-b*a+p*y)*G,c[6]=V*G,c[7]=(-I*a+d*E)*G,c[8]=(_*a-d*y)*G,c):null},o.ev=2,o.ew=Wr,o.ex=wr,o.ey=Fe,o.ez=function(c,i){var a=new w(3);Fe(a,i);var d=1/a[0],p=1/a[1],y=1/a[2],_=i[0]*d,b=i[1]*p,E=i[2]*y,I=i[4]*d,M=i[5]*p,D=i[6]*y,N=i[8]*d,V=i[9]*p,G=i[10]*y,Y=_+M+G,re=0;return Y>0?(re=2*Math.sqrt(Y+1),c[3]=.25*re,c[0]=(D-V)/re,c[1]=(N-E)/re,c[2]=(b-I)/re):_>M&&_>G?(re=2*Math.sqrt(1+_-M-G),c[3]=(D-V)/re,c[0]=.25*re,c[1]=(b+I)/re,c[2]=(N+E)/re):M>G?(re=2*Math.sqrt(1+M-_-G),c[3]=(N-E)/re,c[0]=(b+I)/re,c[1]=.25*re,c[2]=(D+V)/re):(re=2*Math.sqrt(1+G-_-M),c[3]=(b-I)/re,c[0]=(N+E)/re,c[1]=(D+V)/re,c[2]=.25*re),c},o.f=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(i,a)=>String.fromCharCode(+("0x"+a))))},o.f0=function([c,i,a]){const d=Math.hypot(c,i,a),p=Math.atan2(c,a),y=.5*Math.PI-Math.acos(-i/d);return new ve(Be(p),Be(y))},o.f1=dr,o.f2=yM,o.f3=function(c){const i=c.navigator?c.navigator.userAgent:null;return!!function(a){if(on==null){const d=a.navigator?a.navigator.userAgent:null;on=!!a.safari||!(!d||!(/\b(iPad|iPhone|iPod)\b/.test(d)||d.match("Safari")&&!d.match("Chrome")))}return on}(c)&&!(!i||!(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f4=function(c,i){hE=c,Lx=i},o.f5=BR,o.f6=o$,o.f7=function(c){const i=[0,0,0],a=B(new Float64Array(16));return q(a,c.pixelMatrix,c.globeMatrix),Ir(i,i,a),new wt(i[0],i[1])},o.f8=function(){const c=yw;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(lM),yw=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f9=function(){JA().acquire(lM)},o.fA=O2,o.fB=Jr,o.fC=function(c){let i=0;if(new Uint32Array(c,0,1)[0]!==EV){const a=new Uint32Array(c,0,7),[,,d,p,y,_]=a;i=a.byteLength+p+y+_+y,(d!==c.byteLength||i>=c.byteLength)&&vr("Invalid b3dm header information.")}return IV(c,i)},o.fD=function(c,i){const a=wM(c);for(const d of a){for(const p of d.meshes)pde(p);d.lights&&(d.lightMeshIndex=d.meshes.length,d.meshes.push(mde(d.lights,i)))}return a},o.fE=E2,o.fF=Ri,o.fG=pV,o.fH=Hl,o.fI=ma,o.fJ=function(c){Ka(),Xo!=null&&Xo.then(i=>{i.keys().then(a=>{for(let d=0;d<a.length-c;d++)i.delete(a[d]).catch(p=>vr(p.message))}).catch(a=>vr(a.message))}).catch(i=>vr(i.message))},o.fa=Db,o.fb=function(c,i,a=!1){if(Zs===ma.deferred||Zs===ma.loading||Zs===ma.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");hd=Za.resolveURL(c),Zs=ma.deferred,dd=i,Rb(),a||Lb()},o.fc=function(c){D_=Za.resolveURL(c),L_||(L_=new M_(JA(),new cu)),L_.broadcast("setMeshoptUrl",D_)},o.fd=yV,o.fe=function(c){dM=Za.resolveURL(c),L_||(L_=new M_(JA(),new cu)),L_.broadcast("setDracoUrl",dM)},o.ff=gV,o.fg=gw,o.fh=function(c){const i=su();if(!i)return;const a=i.delete(dE);c&&a.then(()=>c()).catch(c)},o.fi=tg,o.fj=Wt,o.fk=Gf,o.fl=2,o.fm=G6,o.fn=q6,o.fo=GV,o.fp=en,o.fq="hd_road_elevation",o.fr=ya,o.fs=ar,o.ft=mh,o.fu=DM,o.fv=1,o.fw=function(c,i,a,d,p,y,_,b=1,E,I,M,D){c.createArrays(),c.tilePixelRatio=Mt/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const N=c.layers[0].layout,V=c.layers[0]._unevaluatedLayout._values,G={};G.scaleFactor=b,G.textSizeScaleRange=N.get("text-size-scale-range"),G.iconSizeScaleRange=N.get("icon-size-scale-range");const[Y,re]=G.textSizeScaleRange,[J,oe]=G.iconSizeScaleRange;G.textScaleFactor=we(G.scaleFactor,Y,re),G.iconScaleFactor=we(G.scaleFactor,J,oe);const le=V["text-size"],de=V["icon-size"];if(c.textSizeData.kind==="composite"){const{minZoom:Oe,maxZoom:Me}=c.textSizeData;G.compositeTextSizes=[le.possiblyEvaluate(new Dn(Oe,{worldview:M}),y),le.possiblyEvaluate(new Dn(Me,{worldview:M}),y)]}if(c.iconSizeData.kind==="composite"){const{minZoom:Oe,maxZoom:Me}=c.iconSizeData;G.compositeIconSizes=[de.possiblyEvaluate(new Dn(Oe,{worldview:M}),y,D),de.possiblyEvaluate(new Dn(Me,{worldview:M}),y,D)]}G.layoutTextSize=le.possiblyEvaluate(new Dn(_+1,{worldview:M}),y),G.layoutIconSize=de.possiblyEvaluate(new Dn(_+1,{worldview:M}),y,D),G.textMaxSize=le.possiblyEvaluate(new Dn(18,{worldview:M}),y);const _e=N.get("symbol-placement"),ye=N.get("text-rotation-alignment")==="map"&&_e!=="point",Te=N.get("text-size");let Ae=!1;const Se=[];for(const Oe of c.features){const Me=N.get("text-font").evaluate(Oe,{},y).join(","),st=Te.evaluate(Oe,{},y)*G.textScaleFactor,et=G.layoutTextSize.evaluate(Oe,{},y)*G.textScaleFactor,it=G.layoutIconSize.evaluate(Oe,{},y,D)*G.iconScaleFactor,mt={horizontal:{},vertical:void 0},ft=Oe.text;let pt,Ke=[0,0];if(ft){const sn=ft.toString(),Di=N.get("text-letter-spacing").evaluate(Oe,{},y)*jo,un=N.get("text-line-height").evaluate(Oe,{},y)*jo,On=PR(sn)?Di:0,li=N.get("text-anchor").evaluate(Oe,{},y),gi=N.get("text-variable-anchor");if(!gi){const io=N.get("text-radial-offset").evaluate(Oe,{},y);if(io)Ke=AU(li,[io*jo,NM]);else{const _o=N.get("text-offset").evaluate(Oe,{},y);Ke=[_o[0]*jo,_o[1]*jo]}}let yi=ye?"center":N.get("text-justify").evaluate(Oe,{},y);const Li=_e==="point",Yo=Li?N.get("text-max-width").evaluate(Oe,{},y)*jo:1/0,_s=io=>{c.allowVerticalPlacement&&Ob(sn)&&(mt.vertical=IM(ft,i,a,p,Me,Yo,un,li,io,On,Ke,ol.vertical,!0,et,st,E))};if(!ye&&gi){const io=yi==="auto"?gi.map(Io=>zM(Io)):[yi];let _o=!1;for(let Io=0;Io<io.length;Io++){const jr=io[Io];if(!mt.horizontal[jr])if(_o)mt.horizontal[jr]=mt.horizontal[0];else{const _i=IM(ft,i,a,p,Me,Yo,un,"center",jr,On,Ke,ol.horizontal,!1,et,st,E);_i&&(mt.horizontal[jr]=_i,_o=_i.positionedLines.length===1)}}_s("left")}else{if(yi==="auto"&&(yi=zM(li)),Li||N.get("text-writing-mode").indexOf("horizontal")>=0||!Ob(sn)){const io=IM(ft,i,a,p,Me,Yo,un,li,yi,On,Ke,ol.horizontal,!1,et,st,E);io&&(mt.horizontal[yi]=io)}_s(Li?"left":yi)}}let yt,ut,_t,gt,Vt,Ut,kt=!1;const Dt=N.get("icon-text-fit").evaluate(Oe,{},y);if(Oe.icon&&Oe.icon.hasPrimary()){const sn=Pw(Oe.icon,c.iconSizeData,V["icon-size"],y,c.zoom,Oe,E,G.iconScaleFactor,M,D);yt=sn.iconPrimary,_t=sn.iconSecondary;const Di=yt.toString();if(ut=d.get(Di),ut&&(Vt=N.get("icon-offset").evaluate(Oe,{},y),Ut=N.get("icon-anchor").evaluate(Oe,{},y),pt=u2(p.get(Di),_t?p.get(_t.toString()):void 0,Vt,Ut),kt=ut.sdf,c.sdfIcons===void 0?c.sdfIcons=ut.sdf:c.sdfIcons!==ut.sdf&&vr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ut.pixelRatio!==c.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0)),_t){const un=_t.toString();gt=d.get(un)}}Ae=Ae||!(!Oe.icon||!Oe.icon.hasSecondary());const lr=m2(mt.horizontal)||mt.vertical;c.iconsInText||(c.iconsInText=!!lr&&lr.iconsInText);const Jt=et*G.textScaleFactor/jo,{defaultShapedIcon:Ft,verticallyShapedIcon:br}=She(c,pt,N,Oe,y,mt,Jt,Vt,Dt);Dt!=="none"&&pt&&(uU(pt)||dU(pt))&&(p2(0,ut,yt,pt,Ft,Dt,I,d,p),p2(0,gt,_t,pt,Ft,Dt,I,d,p),br&&(p2(0,ut,yt,pt,br,Dt,I,d,p),p2(0,gt,_t,pt,br,Dt,I,d,p))),pt=Ft;const{iconBBox:Gr,iconVerticalBBox:mn,textBBox:$r,textVerticalBBox:Ln}=_he(c,pt,br,N,Oe,y,it,Vt,G,p,Ut,mt,et,Ke,D);Se.push({feature:Oe,shapedTextOrientations:mt,shapedText:lr,shapedIcon:pt,iconPrimary:yt,iconSecondary:_t,iconOffset:Vt,iconAnchor:Ut,verticallyShapedIcon:br,layoutTextSize:et,layoutIconSize:it,textOffset:Ke,isSDFIcon:kt,iconTextFit:Dt,iconCollisionBounds:Gr,iconVerticalCollisionBounds:mn,textCollisionBounds:$r,textVerticalCollisionBounds:Ln})}return{featureData:Se,sizes:G,hasAnySecondaryIcon:Ae,textAlongLine:ye,symbolPlacement:_e}},o.fx=vU,o.fy=function(c,i,a,d,p,y,_,b,E,I){c.iconAtlasPositions=I.iconPositions;const{featureData:M,hasAnySecondaryIcon:D,sizes:N,textAlongLine:V,symbolPlacement:G}=i;for(const Y of M){const{shapedIcon:re,verticallyShapedIcon:J,feature:oe,shapedTextOrientations:le,shapedText:de,layoutTextSize:_e,textOffset:ye,isSDFIcon:Te,iconPrimary:Ae,iconSecondary:Se,iconTextFit:Oe,iconOffset:Me,iconCollisionBounds:st,iconVerticalCollisionBounds:et,textCollisionBounds:it}=Y;OU(re,I.iconPositions,Ae,Se),OU(J,I.iconPositions,Ae,Se),whe(le,I.iconPositions),bhe(Ae,Se,I.iconPositions),(de||re)&&The(c,oe,le,re,J,E,N,_e,0,ye,Te,d,p,_,b,D,Oe,Me,V,G,st,et,it)}a&&c.generateCollisionDebugBuffers(y,c.collisionBoxArray,N.textScaleFactor)},o.fz=An,o.g=function(c,i){return au(Object.assign(c,{method:"GET"}),i)},o.h=function(c){return c.indexOf("mapbox:")===0},o.i=function(c){return po.API_STYLE_REGEX.test(c)&&!Is(c)},o.j=Ku,o.k=hf,o.l=function(c){return decodeURIComponent(atob(c).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(c,i){return au(Object.assign(c,{type:"json"}),i)},o.n=My,o.o=Za,o.p=function(c,i){return au(Object.assign(c,{method:"POST"}),i)},o.q=ys,o.r=Yd,o.s=function(c){try{const i=self[c];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return cM||(cM=new tg("ImageRasterizer")),cM},o.u=function(){return function c(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},o.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},o.w=vr,o.x=tD,o.y=ym,o.z=lu}),u(["./shared"],function(o){function v(Be){const se=Be?Be.url.toString():void 0;return se?performance.getEntriesByName(se):[]}function w(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let he="[";for(const xe of Be)he+=`${w(xe)},`;return`${he}]`}let se="{";for(const he of Object.keys(Be).sort())se+=`${he}:${w(Be[he])},`;return`${se}}`}function P(Be){let se="";for(const he of o.bx)se+=`/${w(Be[he])}`;return se}function C(Be,se){return function he(xe){return typeof xe=="string"&&xe===se||(Array.isArray(xe)?xe.some(he):!(!xe||typeof xe!="object")&&Object.values(xe).some(he))}(Be)}class k{constructor(se){this.keyCache={},this._layers={},this._layerConfigs={},se&&this.replace(se)}replace(se,he){this._layerConfigs={},this._layers={},this.update(se,[],he)}update(se,he,xe){this._options=xe;for(const we of se)this._layerConfigs[we.id]=we,(this._layers[we.id]=o.du(we,this.scope,null,this._options)).compileFilter(xe),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of he)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const Le=function(we,je){const Ye={};for(let tt=0;tt<we.length;tt++){const Tt=we[tt];let xt=je&&je[Tt.id];xt||(Tt.type==="symbol"?xt=Tt.id:(xt=P(Tt),Tt.type==="line"&&Tt.paint&&C(Tt.paint["line-width"],"line-progress")&&(xt+=`/${w(Tt.paint["line-width"])}`))),je&&(je[Tt.id]=xt);let qt=Ye[xt];qt||(qt=Ye[xt]=[]),qt.push(Tt)}const ze=[];for(const tt in Ye)ze.push(Ye[tt]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const we of Le){const je=we.map(qt=>this._layers[qt.id]),Ye=je[0];if(Ye.visibility==="none")continue;const ze=Ye.source||"";let tt=this.familiesBySource[ze];tt||(tt=this.familiesBySource[ze]={});const Tt=Ye.sourceLayer||"_geojsonTileLayer";let xt=tt[Tt];xt||(xt=tt[Tt]=[]),xt.push(je)}}}const L=1*o.fl;class ${constructor(se){const he={},xe=[];for(const Ye in se){const ze=se[Ye],tt=he[Ye]={};for(const Tt in ze.glyphs){const xt=ze.glyphs[+Tt];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const qt=xt.metrics.localGlyph?L:1,ar={x:0,y:0,w:xt.bitmap.width+2*qt,h:xt.bitmap.height+2*qt};xe.push(ar),tt[Tt]=ar}}const{w:Le,h:we}=o.G(xe),je=new o.fk({width:Le||1,height:we||1});for(const Ye in se){const ze=se[Ye];for(const tt in ze.glyphs){const Tt=ze.glyphs[+tt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const xt=he[Ye][tt],qt=Tt.metrics.localGlyph?L:1;o.fk.copy(Tt.bitmap,je,{x:0,y:0},{x:xt.x+qt,y:xt.y+qt},Tt.bitmap)}}this.image=je,this.positions=he}}function j(Be,se,he){Be[se]?he&&(Be[se].center=he):Be[se]={floorIds:new Set,center:he||[0,0],floors:{}}}function B(Be,se,he,xe){for(const Le of se)j(Be,Le),Be[Le].floors[he]=xe,Be[Le].floorIds.add(he)}function U(Be){return{id:Be.properties.id.toString(),center:Be.properties.center.toString().split(";").map(Number)}}function q(Be){return{id:Be.properties.id.toString(),isDefault:!!Be.properties.is_default&&Be.properties.is_default,connections:Be.properties.connected_floor_ids?new Set(Be.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Be.properties.conflicted_floor_ids?new Set(Be.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Be.properties.building_ids?new Set(Be.properties.building_ids.toString().split(";")):new Set,name:Be.properties.name.toString(),zIndex:Be.properties.z_index}}function H(Be,se){return se.every(he=>Be.properties&&Be.properties[he]!=null)}function te(Be){return H(Be,["type","id","name"])&&Be.properties.type==="building"}function Q(Be){return H(Be,["type","id","name","z_index"])&&Be.properties.type==="floor"}o.fj($,"GlyphAtlas");class ae{constructor(se){this.tileID=new o.aQ(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.lut=se.lut,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.scope=se.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.request&&se.request.collectResourceTiming,this.promoteId=se.promoteId,this.isSymbolTile=se.isSymbolTile,this.tileTransform=o.aZ(se.tileID.canonical,se.projection),this.projection=se.projection,this.worldview=se.worldview,this.localizableLayerIds=se.localizableLayerIds,this.brightness=se.brightness,this.extraShadowCaster=!!se.extraShadowCaster,this.tessellationStep=se.tessellationStep,this.scaleFactor=se.scaleFactor,this.worldview=se.worldview,this.indoor=se.indoor}parse(se,he,xe,Le,we,je){this.status="parsing",this.data=se,this.collisionBoxArray=new o.b3;const Ye=new o.fm(Object.keys(se.layers).sort()),ze=new o.fn(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const tt={},Tt=new o.fo(256,256),xt={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Tt,availableImages:xe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Or=this.indoor.indoorState.activeFloorsVisible,Br=function(Sr,vr,Yn){const no=function(ui,on){if(!ui)return o.w("No source layers defined in indoor specification"),on;if(ui.size===0)return on;const pi=ui.difference(on);for(const Bn of pi)o.w(`Missing source layer required in indoor specification: ${Bn}`);return on.intersection(on)}(vr.sourceLayers,new Set(Object.keys(Sr.layers))),ki=vr.indoorState,Ri=function(ui,on,pi,Bn){const $n=new Set,Ai=new Set,ls=new Set,Zo=new Map,po={},Ku=Is=>{const Pa=Zo.get(Is)||new Set;for(const El of $n)if((Zo.get(El)||new Set).has(Is)||Pa.has(El))return!0;return!1};for(const Is of on){const Pa=ui.layers[Is];if(Pa)for(let El=0;El<Pa.length;El++){const Gl=Pa.feature(El);if(te(Gl)){const{id:Ca,center:qs}=U(Gl);j(po,Ca,qs),$n.add(Ca);continue}if(Q(Gl)){const{id:Ca,isDefault:qs,connections:ou,conflicts:Yd,buildings:Za,name:um,zIndex:dm}=q(Gl);B(po,Za,Ca,{name:um,zIndex:dm}),Zo.set(Ca,Yd),(Ca===Bn||ou.has(Bn))&&$n.add(Ca),Ai.add(Ca),qs&&ls.add(Ca)}}else o.w(`indoor source layer not found: ${Is}`)}if(pi)for(const Is of pi)Ai.has(Is)&&(Ku(Is)||$n.add(Is));for(const Is of ls)$n.has(Is)||Ku(Is)||$n.add(Is);return{buildings:po,activeFloors:$n}}(Sr,no,ki.lastActiveFloors,ki.selectedFloorId);return Yn.send("setIndoorData",Ri),Ri}(se,this.indoor,we);xt.activeFloors=Or?Br.activeFloors:void 0}const qt=[],ar=he.familiesBySource[this.source];for(const Or in ar){const Br=se.layers[Or];if(!Br)continue;let Sr=!1,vr=!1,Yn=!1;for(const on of ar[Or])on[0].type==="symbol"?Sr=!0:vr=!0,on[0].is3D()&&on[0].type!=="model"&&(Yn=!0);if(this.extraShadowCaster&&!Yn||this.isSymbolTile===!0&&!Sr||this.isSymbolTile===!1&&!vr)continue;Br.version===1&&o.w(`Vector tile source "${this.source}" layer "${Or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const no=Ye.encode(Or),ki=[],Ri=this.localizableLayerIds&&this.localizableLayerIds.has(Or);let ui=!1;for(let on=0,pi=0;on<Br.length;on++){const Bn=Br.feature(on),$n=ze.getId(Bn,Or),Ai=Bn.properties?Bn.properties.worldview:null;if(Ri&&this.worldview&&typeof Ai=="string")if(Ai==="all")Bn.properties.$localized=!0;else{if(!Ai.split(",").includes(this.worldview))continue;Bn.properties.$localized=!0,Bn.properties.worldview=this.worldview}!ui&&Bn.properties&&Bn.properties.hasOwnProperty(o.fp)&&(ui=!0),ki.push({feature:Bn,id:$n,index:pi,sourceLayerIndex:no}),pi++}ui&&!xt.elevationFeatures&&se.layers.hasOwnProperty(o.fq)&&(xt.elevationFeatures=o.fr.parseFrom(se.layers[o.fq],this.canonical));for(const on of ar[Or]){const pi=on[0];if(this.extraShadowCaster&&(!pi.is3D()||pi.type==="model")||this.isSymbolTile!==void 0&&pi.type==="symbol"!==this.isSymbolTile||pi.minzoom&&this.zoom<Math.floor(pi.minzoom)||pi.maxzoom&&this.zoom>=pi.maxzoom||pi.visibility==="none")continue;ue(on,this.zoom,xt.brightness,xe,this.worldview);const Bn=tt[pi.id]=pi.createBucket({index:ze.bucketLayerIDs.length,layers:on,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:no,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Le,worldview:this.worldview,localizable:Ri,availableImages:xe});ze.bucketLayerIDs.push(on.map(Ai=>o.B(Ai.id,Ai.scope)));let $n=Bn.prepare?Bn.prepare():null;$n!=null?($n=$n.then(()=>Bn.populate(ki,xt,this.tileID.canonical,this.tileTransform)),qt.push($n)):Bn.populate(ki,xt,this.tileID.canonical,this.tileTransform)}}const pr=()=>{let Or,Br,Sr,vr,Yn,no;Tt.trim();const ki={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ri=()=>{if(Or)return this.status="done",je(Or);if(this.extraShadowCaster)this.status="done",je(null,{buckets:Object.values(tt).filter(on=>!on.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:xt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Br&&Sr&&vr){const on=new $(Br),pi=new Map;for(const[Ai,ls]of Sr.entries()){const{imagePosition:Zo}=o.fu(Ai,ls,o.fv);pi.set(Ai,Zo)}const Bn={};for(const Ai in tt){const ls=tt[Ai];ls instanceof o.b4&&(ue(ls.layers,this.zoom,xt.brightness,xe,this.worldview),Bn[Ai]=o.fw(ls,Br,on.positions,Sr,pi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Yn,this.worldview,xe))}const $n={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(we,Sr,Yn,()=>{$n.iconsPending=!1,ui(Bn,on,$n)}),this.rasterizeIfNeeded(we,vr,no,()=>{$n.patternsPending=!1,ui(Bn,on,$n)})}},ui=(on,pi,Bn,$n)=>{if(Bn.iconsPending||Bn.patternsPending)return;const Ai=new o.fx(Sr,vr,this.lut);for(const ls in tt){const Zo=tt[ls];if(ls in on)o.fy(Zo,on[ls],this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Sr,Ai);else if(Zo.hasPattern&&(Zo instanceof o.ba||Zo instanceof o.bb||Zo instanceof o.ea)){ue(Zo.layers,this.zoom,xt.brightness,xe,this.worldview);const po=Object.fromEntries(Ai.patternPositions);Zo.addFeatures(xt,this.tileID.canonical,po,xe,this.tileTransform,this.brightness)}}this.status="done",je(null,{buckets:Object.values(tt).filter(ls=>!ls.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pi.image,lineAtlas:Tt,imageAtlas:Ai,brightness:xt.brightness})};if(!this.extraShadowCaster){const on=o.fs(xt.glyphDependencies,$n=>Object.keys($n).map(Number));Object.keys(on).length?we.send("getGlyphs",{uid:this.uid,stacks:on},($n,Ai)=>{Or||(Or=$n,Br=Ai,Ri())},void 0,!1,ki):Br={};const pi=Array.from(xt.iconDependencies.keys()).map($n=>o.I.parse($n));pi.length?we.send("getImages",{images:pi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},($n,Ai)=>{Or||(Or=$n,Sr=new Map,Yn=this.updateImageMapAndGetImageTaskQueue(Sr,Ai,xt.iconDependencies),Ri())},void 0,!1,ki):(Sr=new Map,Yn=new Map);const Bn=Array.from(xt.patternDependencies.keys()).map($n=>o.I.parse($n));Bn.length?we.send("getImages",{images:Bn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},($n,Ai)=>{Or||(Or=$n,vr=new Map,no=this.updateImageMapAndGetImageTaskQueue(vr,Ai,xt.patternDependencies),Ri())},void 0,!1,ki):(vr=new Map,no=new Map)}if(xt.elevationFeatures&&xt.elevationFeatures.length>0){const on=[];for(const Bn of Object.values(tt))if(Bn instanceof o.bb){const $n=Bn.getUnevaluatedPortalGraph();$n&&on.push($n)}const pi=o.ft.evaluate(on);for(const Bn of Object.values(tt))if(Bn instanceof o.bb){const $n=se.layers[Ye.decode(Bn.sourceLayerIndex)];Bn.setEvaluatedPortalGraph(pi,$n,this.tileID.canonical,xt.availableImages,xt.brightness)}}Ri()};qt.length>0?Promise.allSettled(qt).then(pr).catch(je):pr()}updateParameters(se){this.scaleFactor=se.scaleFactor,this.showCollisionBoxes=se.showCollisionBoxes,this.projection=se.projection,this.brightness=se.brightness,this.tileTransform=o.aZ(se.tileID.canonical,se.projection),this.extraShadowCaster=se.extraShadowCaster,this.lut=se.lut,this.worldview=se.worldview,this.indoor=se.indoor}rasterizeIfNeeded(se,he,xe,Le){Array.from(he.values()).some(we=>we.usvg)?this.rasterize(se,he,xe,Le):Le()}updateImageMapAndGetImageTaskQueue(se,he,xe){const Le=new Map;for(const we of he.keys()){const je=xe.get(we)||[];for(const Ye of je){const ze=Ye.toString(),tt=he.get(Ye.id.toString());tt.usvg?Le.has(ze)||(Le.set(ze,Ye),se.set(ze,Object.assign({},tt))):se.set(ze,tt)}}return Le}rasterize(se,he,xe,Le){this.rasterizeTask=se.send("rasterizeImages",{scope:this.scope,tasks:xe},(we,je)=>{if(!we)for(const[Ye,ze]of je.entries()){const tt=Object.assign(he.get(Ye),{data:ze});he.set(Ye,tt)}Le()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ue(Be,se,he,xe,Le){const we=new o.ac(se,{brightness:he,worldview:Le});for(const je of Be)je.recalculate(we,xe)}class me extends o.E{constructor(se,he,xe,Le,we,je,Ye){super(),this.actor=se,this.layerIndex=he,this.availableImages=xe,this.availableModels=Le,this.loadVectorData=je||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(se.scheduler),this.isSpriteLoaded=we,this.scheduler=se.scheduler,this.brightness=Ye}loadTile(se,he){const xe=se.uid,Le=se&&se.request,we=Le&&Le.collectResourceTiming,je=this.loading[xe]=new ae(se);je.abort=this.loadVectorData(se,(Ye,ze)=>{const tt=!this.loading[xe];if(delete this.loading[xe],je.cancelRasterize(),tt||Ye||!ze)return je.status="done",tt||(this.loaded[xe]=je),he(Ye);const Tt=ze.rawData,xt={},qt=o.aM(ze.responseHeaders);qt&&qt.expires&&(xt.expires=qt.expires),qt&&qt.cacheControl&&(xt.cacheControl=qt.cacheControl),je.vectorTile=ze.vectorTile||new o.fz(new o.bt(Tt));const ar=()=>{je.parse(je.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(pr,Or)=>{if(pr||!Or)return he(pr);const Br={};if(we){const Sr=v(Le);Sr.length>0&&(Br.resourceTiming=JSON.parse(JSON.stringify(Sr)))}he(null,Object.assign({rawTileData:Tt.slice(0),responseHeaders:ze.responseHeaders},Or,xt,Br))})};this.isSpriteLoaded?ar():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(ar,{type:"parseTile",isSymbolTile:se.isSymbolTile,zoom:se.tileZoom}):ar()}),this.loaded=this.loaded||{},this.loaded[xe]=je})}reloadTile(se,he){const xe=this.loaded,Le=se.uid;if(xe&&xe[Le]){const we=xe[Le];we.updateParameters(se);const je=(Ye,ze)=>{const tt=we.reloadCallback;tt&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,tt)),he(Ye,ze)};we.status==="parsing"?we.reloadCallback=je:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,je):je())}else he(null,void 0)}abortTile(se,he){const xe=se.uid,Le=this.loading[xe];Le&&(Le.abort&&Le.abort(),delete this.loading[xe]),he()}removeTile(se,he){const xe=this.loaded,Le=se.uid;xe&&xe[Le]&&delete xe[Le],he()}}class Ce{loadTile(se,he){const{uid:xe,encoding:Le,rawImageData:we,padding:je}=se,Ye=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,je):we;he(null,new o.fA(xe,Ye,Le,je<1))}reloadTile(se,he){he(null,null)}abortTile(se,he){he()}removeTile(se,he){he()}getImageData(se,he){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const xe=this.offscreenCanvasContext.getImageData(-he,-he,se.width+2*he,se.height+2*he);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}o.bs.setPbf(o.bt);class Fe{constructor(se){this._mrt=new o.bs(se.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=se.uid,this.tileID=se.tileID,this.source=se.source}parse(se,he){const xe=this._mrt;this.status="parsing",this._entireBuffer=se;try{xe.parseHeader(se),this._isHeaderLoaded=!0;const Le=[];for(const we in xe.layers){const je=xe.getLayer(we),Ye=je.getDataRange(je.getBandList()),ze=xe.createDecodingTask(Ye),tt=se.slice(Ye.firstByte,Ye.lastByte+1),Tt=o.bs.performDecoding(tt,ze).then(xt=>ze.complete(null,xt)).catch(xt=>ze.complete(xt,null));Le.push(Tt)}Promise.allSettled(Le).then(()=>he(null,xe)).catch(we=>he(we))}catch(Le){he(Le)}}}class Ge{constructor(se){this.actor=se,this.loading={},this.loaded={}}loadTile(se,he){const xe=se.uid,Le=se.request,we=this.loading[xe]=new Fe(se),{cancel:je}=o.bu(Le,(Ye,ze,tt)=>{const Tt=!this.loading[xe];if(delete this.loading[xe],Tt||Ye||!ze)return we.status="done",Tt||(this.loaded[xe]=we),he(Ye);we.parse(ze,(xt,qt)=>{if(xt||!qt)return he(xt);he(null,qt,tt)}),this.loaded[xe]=we});we.abort=je}reloadTile(se,he){he(null,void 0)}abortTile(se,he){const xe=se.uid,Le=this.loading[xe];Le&&(Le.abort&&Le.abort(),delete this.loading[xe]),he()}removeTile(se,he){const xe=se.uid;this.loaded[xe]&&delete this.loaded[xe],he()}decodeRasterArray(se,he){o.bs.performDecoding(se.buffer,se.task).then(xe=>he(null,xe)).catch(xe=>he(xe))}}const Ve=o.fB.prototype.toGeoJSON;class Ze{constructor(se){this._feature=se,this.extent=o.al,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const he of this._feature.geometry)se.push([new o.P(he[0],he[1])]);return se}{const se=[];for(const he of this._feature.geometry){const xe=[];for(const Le of he)xe.push(new o.P(Le[0],Le[1]));se.push(xe)}return se}}toGeoJSON(se,he,xe){return Ve.call(this,se,he,xe)}}class nt{constructor(se,he){this.name=se,this.extent=o.al,this.length=he.length,this._jsonFeatures=he}feature(se){return new Ze(this._jsonFeatures[se])}}class dt{constructor(se){this.layers={},this.extent=o.al;for(const he of Object.keys(se))this.layers[he]=new nt(he,se[he])}}const rt=64/4096;class at{constructor(){this.features=new Map}clear(){this.features.clear()}load(se=[],he){for(const xe of se){const Le=xe.id;if(Le==null)continue;let we=this.features.get(Le);we&&this.updateCache(we,he),xe.geometry?(we=He(xe),this.updateCache(we,he),this.features.set(Le,we)):this.features.delete(Le),this.updateCache(we,he)}}updateCache(se,he){for(const{canonical:xe,uid:Le}of Object.values(he)){const{z:we,x:je,y:Ye}=xe;qe(se,Math.pow(2,we),je,Ye)&&delete he[Le]}}getTile(se,he,xe){const Le=Math.pow(2,se),we=[];for(const je of this.features.values())qe(je,Le,he,xe)&&we.push($t(je,Le,he,xe));return{features:we}}getFeatures(){return[...this.features.values()]}}function qe({minX:Be,minY:se,maxX:he,maxY:xe},Le,we,je){return Be<(we+1+rt)/Le&&se<(je+1+rt)/Le&&he>(we-rt)/Le&&xe>(je-rt)/Le}function He(Be){const{id:se,geometry:he,properties:xe}=Be;if(!he)return;if(he.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Le,coordinates:we}=he,je={id:se,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=je.geometry;if(Le==="Point")Et(we,Ye,je);else if(Le==="MultiPoint")for(const ze of we)Et(ze,Ye,je);else if(Le==="LineString")je.type=2,Gt(we,Ye,je);else if(Le==="MultiLineString")je.type=2,Ot(we,Ye,je);else if(Le==="Polygon")je.type=3,Ot(we,Ye,je,!0);else{if(Le!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");je.type=3;for(const ze of we)Ot(ze,Ye,je,!0)}return je}function Et([Be,se],he,xe){const Le=o.aF(Be);let we=o.aJ(se);we=we<0?0:we>1?1:we,he.push(Le,we),xe.minX=Math.min(xe.minX,Le),xe.minY=Math.min(xe.minY,we),xe.maxX=Math.max(xe.maxX,Le),xe.maxY=Math.max(xe.maxY,we)}function Gt(Be,se,he,xe=!1,Le=!1){const we=[];for(const je of Be)Et(je,we,he);se.push(we),xe&&function(je,Ye){let ze=0;for(let tt=0,Tt=je.length,xt=Tt-2;tt<Tt;xt=tt,tt+=2)ze+=(je[tt]-je[xt])*(je[tt+1]+je[xt+1]);if(ze>0===Ye)for(let tt=0,Tt=je.length;tt<Tt/2;tt+=2){const xt=je[tt],qt=je[tt+1];je[tt]=je[Tt-2-tt],je[tt+1]=je[Tt-1-tt],je[Tt-2-tt]=xt,je[Tt-1-tt]=qt}}(we,Le)}function Ot(Be,se,he,xe=!1){for(let Le=0;Le<Be.length;Le++)Gt(Be[Le],se,he,xe,Le===0)}function $t(Be,se,he,xe){const{id:Le,type:we,geometry:je,tags:Ye}=Be,ze=[];if(we===1)(function(tt,Tt,xt,qt,ar){for(let pr=0;pr<tt.length;pr+=2){const Or=Math.round(o.al*(tt[pr+0]*Tt-xt)),Br=Math.round(o.al*(tt[pr+1]*Tt-qt));ar.push([Or,Br])}})(je,se,he,xe,ze);else if(we===2)for(const tt of je)ur(tt,se,he,xe,ze);else if(we===3)for(const tt of je)Yr(tt,se,he,xe,ze);return{id:Le,type:we,geometry:ze,tags:Ye}}function ur(Be,se,he,xe,Le){const je=o.al+128;let Ye;for(let ze=0;ze<Be.length-2;ze+=2){let tt=Math.round(o.al*(Be[ze+0]*se-he)),Tt=Math.round(o.al*(Be[ze+1]*se-xe)),xt=Math.round(o.al*(Be[ze+2]*se-he)),qt=Math.round(o.al*(Be[ze+3]*se-xe));const ar=xt-tt,pr=qt-Tt;tt<-128&&xt<-128||(tt<-128?(Tt+=Math.round(pr*((-128-tt)/ar)),tt=-128):xt<-128&&(qt=Tt+Math.round(pr*((-128-tt)/ar)),xt=-128),Tt<-128&&qt<-128||(Tt<-128?(tt+=Math.round(ar*((-128-Tt)/pr)),Tt=-128):qt<-128&&(xt=tt+Math.round(ar*((-128-Tt)/pr)),qt=-128),tt>=je&&xt>=je||(tt>=je?(Tt+=Math.round(pr*((je-tt)/ar)),tt=je):xt>=je&&(qt=Tt+Math.round(pr*((je-tt)/ar)),xt=je),Tt>=je&&qt>=je||(Tt>=je?(tt+=Math.round(ar*((je-Tt)/pr)),Tt=je):qt>=je&&(xt=tt+Math.round(ar*((je-Tt)/pr)),qt=je),Ye&&tt===Ye[Ye.length-1][0]&&Tt===Ye[Ye.length-1][1]||(Ye=[[tt,Tt]],Le.push(Ye)),Ye.push([xt,qt])))))}}function Yr(Be,se,he,xe,Le){const we=(he-rt)/se,je=(xe-rt)/se,Ye=(he+1+rt)/se,ze=(xe+1+rt)/se;function tt(qt,ar){let pr=0;return qt<we?pr|=1:qt>Ye&&(pr|=2),ar<je?pr|=4:ar>ze&&(pr|=8),pr}let Tt=[];for(let qt=1;qt<=8;qt*=2){let ar=Be[Be.length-2],pr=Be[Be.length-1],Or=!(tt(ar,pr)&qt);for(let Br=0;Br<Be.length;Br+=2){const Sr=Be[Br],vr=Be[Br+1],Yn=!(tt(Sr,vr)&qt);Yn!==Or&&(8&qt?Tt.push(ar+(Sr-ar)*(ze-pr)/(vr-pr),ze):4&qt?Tt.push(ar+(Sr-ar)*(je-pr)/(vr-pr),je):2&qt?Tt.push(Ye,pr+(vr-pr)*(Ye-ar)/(Sr-ar)):1&qt&&Tt.push(we,pr+(vr-pr)*(we-ar)/(Sr-ar))),Yn&&Tt.push(Sr,vr),ar=Sr,pr=vr,Or=Yn}if(!(Be=Tt).length||qt===8)break;Tt=[]}const xt=[];for(let qt=0;qt<Tt.length;qt+=2)xt.push([Math.round(o.al*(Tt[qt]*se-he)),Math.round(o.al*(Tt[qt+1]*se-xe))]);xt.length&&Le.push(xt)}function hn({name:Be,features:se},he){he.writeStringField(1,Be),he.writeVarintField(5,o.al);const xe=new Map,Le=new Map,we={keys:xe,values:Le,feature:null};for(const je of se)we.feature=je,he.writeMessage(2,rr,we);for(const je of xe.keys())he.writeStringField(3,je);for(const je of Le.keys())he.writeMessage(4,jt,je)}function rr(Be,se){const he=Be.feature;he.id!==void 0&&Number.isSafeInteger(+he.id)&&se.writeVarintField(1,+he.id),he.tags&&se.writeMessage(2,Wr,Be),se.writeVarintField(3,he.type),se.writeMessage(4,ir,he)}function Wr({keys:Be,values:se,feature:he},xe){for(const Le of Object.keys(he.tags)){let we=he.tags[Le];if(we===null)continue;let je=Be.get(Le);je===void 0&&(je=Be.size,Be.set(Le,je)),xe.writeVarint(je);const Ye=typeof we;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(we=JSON.stringify(we));let ze=se.get(we);ze===void 0&&(ze=se.size,se.set(we,ze)),xe.writeVarint(ze)}}function Rt(Be,se){return(se<<3)+(7&Be)}function Yt(Be){return Be<<1^Be>>31}function ir(Be,se){const{geometry:he,type:xe}=Be;let Le=0,we=0;if(xe===1){se.writeVarint(Rt(1,he.length));for(const je of he){const Ye=je[0]-Le,ze=je[1]-we;se.writeVarint(Yt(Ye)),se.writeVarint(Yt(ze)),Le+=Ye,we+=ze}}else for(const je of he){if(je.length===0)continue;se.writeVarint(Rt(1,1));const Ye=je.length-(xe===3?1:0);for(let ze=0;ze<Ye;ze++){ze===1&&se.writeVarint(Rt(2,Ye-1));const tt=je[ze][0]-Le,Tt=je[ze][1]-we;se.writeVarint(Yt(tt)),se.writeVarint(Yt(Tt)),Le+=tt,we+=Tt}xe===3&&se.writeVarint(Rt(7,1))}}function jt(Be,se){const he=typeof Be;he==="string"?se.writeStringField(1,Be):he==="boolean"?se.writeBooleanField(7,Be):he==="number"&&(Be%1!=0?se.writeDoubleField(3,Be):Be<0?se.writeSVarintField(6,Be):se.writeVarintField(5,Be))}const Ir={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},Xr=Math.fround||(Vn=new Float32Array(1),Be=>(Vn[0]=+Be,Vn[0]));var Vn;class Hn{constructor(se){this.options=Object.assign(Object.create(Ir),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:he,minZoom:xe,maxZoom:Le}=this.options;he&&console.time("total time");const we=`prepare ${se.length} points`;he&&console.time(we),this.points=se;const je=[];for(let ze=0;ze<se.length;ze++){const tt=se[ze];if(!tt.geometry)continue;const[Tt,xt]=tt.geometry.coordinates,qt=Xr(ho(Tt)),ar=Xr(ot(xt));je.push(qt,ar,1/0,ze,-1,1),this.options.reduce&&je.push(0)}let Ye=this.trees[Le+1]=this._createTree(je);he&&console.timeEnd(we);for(let ze=Le;ze>=xe;ze--){const tt=+Date.now();Ye=this.trees[ze]=this._createTree(this._cluster(Ye,ze)),he&&console.log("z%d: %d clusters in %dms",ze,Ye.numItems,+Date.now()-tt)}return he&&console.timeEnd("total time"),this}getClusters(se,he){let xe=((se[0]+180)%360+360)%360-180;const Le=Math.max(-90,Math.min(90,se[1]));let we=se[2]===180?180:((se[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)xe=-180,we=180;else if(xe>we){const xt=this.getClusters([xe,Le,180,je],he),qt=this.getClusters([-180,Le,we,je],he);return xt.concat(qt)}const Ye=this.trees[this._limitZoom(he)],ze=Ye.range(ho(xe),ot(je),ho(we),ot(Le)),tt=Ye.data,Tt=[];for(const xt of ze){const qt=this.stride*xt;Tt.push(tt[qt+5]>1?ei(tt,qt,this.clusterProps):this.points[tt[qt+3]])}return Tt}getChildren(se){const he=this._getOriginId(se),xe=this._getOriginZoom(se),Le="No cluster with the specified id.",we=this.trees[xe];if(!we)throw new Error(Le);const je=we.data;if(he*this.stride>=je.length)throw new Error(Le);const Ye=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),ze=we.within(je[he*this.stride],je[he*this.stride+1],Ye),tt=[];for(const Tt of ze){const xt=Tt*this.stride;je[xt+4]===se&&tt.push(je[xt+5]>1?ei(je,xt,this.clusterProps):this.points[je[xt+3]])}if(tt.length===0)throw new Error(Le);return tt}getLeaves(se,he,xe){const Le=[];return this._appendLeaves(Le,se,he=he||10,xe=xe||0,0),Le}getTile(se,he,xe){const Le=this.trees[this._limitZoom(se)],we=Math.pow(2,se),{extent:je,radius:Ye}=this.options,ze=Ye/je,tt=(xe-ze)/we,Tt=(xe+1+ze)/we,xt={features:[]};return this._addTileFeatures(Le.range((he-ze)/we,tt,(he+1+ze)/we,Tt),Le.data,he,xe,we,xt),he===0&&this._addTileFeatures(Le.range(1-ze/we,tt,1,Tt),Le.data,we,xe,we,xt),he===we-1&&this._addTileFeatures(Le.range(0,tt,ze/we,Tt),Le.data,-1,xe,we,xt),xt.features.length?xt:null}getClusterExpansionZoom(se){let he=this._getOriginZoom(se)-1;for(;he<=this.options.maxZoom;){const xe=this.getChildren(se);if(he++,xe.length!==1)break;se=xe[0].properties.cluster_id}return he}_appendLeaves(se,he,xe,Le,we){const je=this.getChildren(he);for(const Ye of je){const ze=Ye.properties;if(ze&&ze.cluster?we+ze.point_count<=Le?we+=ze.point_count:we=this._appendLeaves(se,ze.cluster_id,xe,Le,we):we<Le?we++:se.push(Ye),se.length===xe)break}return we}_createTree(se){const he=new o.c4(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<se.length;xe+=this.stride)he.add(se[xe],se[xe+1]);return he.finish(),he.data=se,he}_addTileFeatures(se,he,xe,Le,we,je){for(const Ye of se){const ze=Ye*this.stride,tt=he[ze+5]>1;let Tt,xt,qt;if(tt)Tt=Nn(he,ze,this.clusterProps),xt=he[ze],qt=he[ze+1];else{const Or=this.points[he[ze+3]];Tt=Or.properties;const[Br,Sr]=Or.geometry.coordinates;xt=ho(Br),qt=ot(Sr)}const ar={type:1,geometry:[[Math.round(this.options.extent*(xt*we-xe)),Math.round(this.options.extent*(qt*we-Le))]],tags:Tt};let pr;pr=tt||this.options.generateId?he[ze+3]:this.points[he[ze+3]].id,pr!==void 0&&(ar.id=pr),je.features.push(ar)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,he){const{radius:xe,extent:Le,reduce:we,minPoints:je}=this.options,Ye=xe/(Le*Math.pow(2,he)),ze=se.data,tt=[],Tt=this.stride;for(let xt=0;xt<ze.length;xt+=Tt){if(ze[xt+2]<=he)continue;ze[xt+2]=he;const qt=ze[xt],ar=ze[xt+1],pr=se.within(ze[xt],ze[xt+1],Ye),Or=ze[xt+5];let Br=Or;for(const Sr of pr){const vr=Sr*Tt;ze[vr+2]>he&&(Br+=ze[vr+5])}if(Br>Or&&Br>=je){let Sr,vr=qt*Or,Yn=ar*Or,no=-1;const ki=(xt/Tt<<5)+(he+1)+this.points.length;for(const Ri of pr){const ui=Ri*Tt;if(ze[ui+2]<=he)continue;ze[ui+2]=he;const on=ze[ui+5];vr+=ze[ui]*on,Yn+=ze[ui+1]*on,ze[ui+4]=ki,we&&(Sr||(Sr=this._map(ze,xt,!0),no=this.clusterProps.length,this.clusterProps.push(Sr)),we(Sr,this._map(ze,ui)))}ze[xt+4]=ki,tt.push(vr/Br,Yn/Br,1/0,ki,-1,Br),we&&tt.push(no)}else{for(let Sr=0;Sr<Tt;Sr++)tt.push(ze[xt+Sr]);if(Br>1)for(const Sr of pr){const vr=Sr*Tt;if(!(ze[vr+2]<=he)){ze[vr+2]=he;for(let Yn=0;Yn<Tt;Yn++)tt.push(ze[vr+Yn])}}}}return tt}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,he,xe){if(se[he+5]>1){const je=this.clusterProps[se[he+6]];return xe?Object.assign({},je):je}const Le=this.points[se[he+3]].properties,we=this.options.map(Le);return xe&&we===Le?Object.assign({},we):we}}function ei(Be,se,he){return{type:"Feature",id:Be[se+3],properties:Nn(Be,se,he),geometry:{type:"Point",coordinates:[(xe=Be[se],360*(xe-.5)),St(Be[se+1])]}};var xe}function Nn(Be,se,he){const xe=Be[se+5],Le=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,we=Be[se+6],je=we===-1?{}:Object.assign({},he[we]);return Object.assign(je,{cluster:!0,cluster_id:Be[se+3],point_count:xe,point_count_abbreviated:Le})}function ho(Be){return Be/360+.5}function ot(Be){const se=Math.sin(Be*Math.PI/180),he=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return he<0?0:he>1?1:he}function St(Be){const se=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Nt(Be,se,he,xe){let Le=xe;const we=se+(he-se>>1);let je,Ye=he-se;const ze=Be[se],tt=Be[se+1],Tt=Be[he],xt=Be[he+1];for(let qt=se+3;qt<he;qt+=3){const ar=dr(Be[qt],Be[qt+1],ze,tt,Tt,xt);if(ar>Le)je=qt,Le=ar;else if(ar===Le){const pr=Math.abs(qt-we);pr<Ye&&(je=qt,Ye=pr)}}Le>xe&&(je-se>3&&Nt(Be,se,je,xe),Be[je+2]=Le,he-je>3&&Nt(Be,je,he,xe))}function dr(Be,se,he,xe,Le,we){let je=Le-he,Ye=we-xe;if(je!==0||Ye!==0){const ze=((Be-he)*je+(se-xe)*Ye)/(je*je+Ye*Ye);ze>1?(he=Le,xe=we):ze>0&&(he+=je*ze,xe+=Ye*ze)}return je=Be-he,Ye=se-xe,je*je+Ye*Ye}function nr(Be,se,he,xe){const Le={id:Be??null,type:se,geometry:he,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")er(Le,he);else if(se==="Polygon")er(Le,he[0]);else if(se==="MultiLineString")for(const we of he)er(Le,we);else if(se==="MultiPolygon")for(const we of he)er(Le,we[0]);return Le}function er(Be,se){for(let he=0;he<se.length;he+=3)Be.minX=Math.min(Be.minX,se[he]),Be.minY=Math.min(Be.minY,se[he+1]),Be.maxX=Math.max(Be.maxX,se[he]),Be.maxY=Math.max(Be.maxY,se[he+1])}function wr(Be,se,he,xe){if(!se.geometry)return;const Le=se.geometry.coordinates;if(Le&&Le.length===0)return;const we=se.geometry.type,je=Math.pow(he.tolerance/((1<<he.maxZoom)*he.extent),2);let Ye=[],ze=se.id;if(he.promoteId?ze=se.properties[he.promoteId]:he.generateId&&(ze=xe||0),we==="Point")Tn(Le,Ye);else if(we==="MultiPoint")for(const tt of Le)Tn(tt,Ye);else if(we==="LineString")Kn(Le,Ye,je,!1);else if(we==="MultiLineString"){if(he.lineMetrics){for(const tt of Le)Ye=[],Kn(tt,Ye,je,!1),Be.push(nr(ze,"LineString",Ye,se.properties));return}Po(Le,Ye,je,!1)}else if(we==="Polygon")Po(Le,Ye,je,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const tt of se.geometry.geometries)wr(Be,{id:ze,geometry:tt,properties:se.properties},he,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const tt of Le){const Tt=[];Po(tt,Tt,je,!0),Ye.push(Tt)}}Be.push(nr(ze,we,Ye,se.properties))}function Tn(Be,se){se.push(Ji(Be[0]),Ps(Be[1]),0)}function Kn(Be,se,he,xe){let Le,we,je=0;for(let ze=0;ze<Be.length;ze++){const tt=Ji(Be[ze][0]),Tt=Ps(Be[ze][1]);se.push(tt,Tt,0),ze>0&&(je+=xe?(Le*Tt-tt*we)/2:Math.sqrt(Math.pow(tt-Le,2)+Math.pow(Tt-we,2))),Le=tt,we=Tt}const Ye=se.length-3;se[2]=1,Nt(se,0,Ye,he),se[Ye+2]=1,se.size=Math.abs(je),se.start=0,se.end=se.size}function Po(Be,se,he,xe){for(let Le=0;Le<Be.length;Le++){const we=[];Kn(Be[Le],we,he,xe),se.push(we)}}function Ji(Be){return Be/360+.5}function Ps(Be){const se=Math.sin(Be*Math.PI/180),he=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return he<0?0:he>1?1:he}function ps(Be,se,he,xe,Le,we,je,Ye){if(xe/=se,we>=(he/=se)&&je<xe)return Be;if(je<he||we>=xe)return null;const ze=[];for(const tt of Be){const Tt=tt.geometry;let xt=tt.type;const qt=Le===0?tt.minX:tt.minY,ar=Le===0?tt.maxX:tt.maxY;if(qt>=he&&ar<xe){ze.push(tt);continue}if(ar<he||qt>=xe)continue;let pr=[];if(xt==="Point"||xt==="MultiPoint")qa(Tt,pr,he,xe,Le);else if(xt==="LineString")Wo(Tt,pr,he,xe,Le,!1,Ye.lineMetrics);else if(xt==="MultiLineString")as(Tt,pr,he,xe,Le,!1);else if(xt==="Polygon")as(Tt,pr,he,xe,Le,!0);else if(xt==="MultiPolygon")for(const Or of Tt){const Br=[];as(Or,Br,he,xe,Le,!0),Br.length&&pr.push(Br)}if(pr.length){if(Ye.lineMetrics&&xt==="LineString"){for(const Or of pr)ze.push(nr(tt.id,xt,Or,tt.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(pr.length===1?(xt="LineString",pr=pr[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=pr.length===3?"Point":"MultiPoint"),ze.push(nr(tt.id,xt,pr,tt.tags))}}return ze.length?ze:null}function qa(Be,se,he,xe,Le){for(let we=0;we<Be.length;we+=3){const je=Be[we+Le];je>=he&&je<=xe&&Ha(se,Be[we],Be[we+1],Be[we+2])}}function Wo(Be,se,he,xe,Le,we,je){let Ye=fo(Be);const ze=Le===0?Wa:Tl;let tt,Tt,xt=Be.start;for(let Br=0;Br<Be.length-3;Br+=3){const Sr=Be[Br],vr=Be[Br+1],Yn=Be[Br+2],no=Be[Br+3],ki=Be[Br+4],Ri=Le===0?Sr:vr,ui=Le===0?no:ki;let on=!1;je&&(tt=Math.sqrt(Math.pow(Sr-no,2)+Math.pow(vr-ki,2))),Ri<he?ui>he&&(Tt=ze(Ye,Sr,vr,no,ki,he),je&&(Ye.start=xt+tt*Tt)):Ri>xe?ui<xe&&(Tt=ze(Ye,Sr,vr,no,ki,xe),je&&(Ye.start=xt+tt*Tt)):Ha(Ye,Sr,vr,Yn),ui<he&&Ri>=he&&(Tt=ze(Ye,Sr,vr,no,ki,he),on=!0),ui>xe&&Ri<=xe&&(Tt=ze(Ye,Sr,vr,no,ki,xe),on=!0),!we&&on&&(je&&(Ye.end=xt+tt*Tt),se.push(Ye),Ye=fo(Be)),je&&(xt+=tt)}let qt=Be.length-3;const ar=Be[qt],pr=Be[qt+1],Or=Le===0?ar:pr;Or>=he&&Or<=xe&&Ha(Ye,ar,pr,Be[qt+2]),qt=Ye.length-3,we&&qt>=3&&(Ye[qt]!==Ye[0]||Ye[qt+1]!==Ye[1])&&Ha(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&se.push(Ye)}function fo(Be){const se=[];return se.size=Be.size,se.start=Be.start,se.end=Be.end,se}function as(Be,se,he,xe,Le,we){for(const je of Be)Wo(je,se,he,xe,Le,we,!1)}function Ha(Be,se,he,xe){Be.push(se,he,xe)}function Wa(Be,se,he,xe,Le,we){const je=(we-se)/(xe-se);return Ha(Be,we,he+(Le-he)*je,1),je}function Tl(Be,se,he,xe,Le,we){const je=(we-he)/(Le-he);return Ha(Be,se+(xe-se)*je,we,1),je}function Ul(Be,se){const he=[];for(let xe=0;xe<Be.length;xe++){const Le=Be[xe],we=Le.type;let je;if(we==="Point"||we==="MultiPoint"||we==="LineString")je=gc(Le.geometry,se);else if(we==="MultiLineString"||we==="Polygon"){je=[];for(const Ye of Le.geometry)je.push(gc(Ye,se))}else if(we==="MultiPolygon"){je=[];for(const Ye of Le.geometry){const ze=[];for(const tt of Ye)ze.push(gc(tt,se));je.push(ze)}}he.push(nr(Le.id,we,je,Le.tags))}return he}function gc(Be,se){const he=[];he.size=Be.size,Be.start!==void 0&&(he.start=Be.start,he.end=Be.end);for(let xe=0;xe<Be.length;xe+=3)he.push(Be[xe]+se,Be[xe+1],Be[xe+2]);return he}function yc(Be,se){if(Be.transformed)return Be;const he=1<<Be.z,xe=Be.x,Le=Be.y;for(const we of Be.features){const je=we.geometry,Ye=we.type;if(we.geometry=[],Ye===1)for(let ze=0;ze<je.length;ze+=2)we.geometry.push(Mn(je[ze],je[ze+1],se,he,xe,Le));else for(let ze=0;ze<je.length;ze++){const tt=[];for(let Tt=0;Tt<je[ze].length;Tt+=2)tt.push(Mn(je[ze][Tt],je[ze][Tt+1],se,he,xe,Le));we.geometry.push(tt)}}return Be.transformed=!0,Be}function Mn(Be,se,he,xe,Le,we){return[Math.round(he*(Be*xe-Le)),Math.round(he*(se*xe-we))]}function Mo(Be,se,he,xe,Le){const we=se===Le.maxZoom?0:Le.tolerance/((1<<se)*Le.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:he,y:xe,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Be)gn(je,Ye,we,Le);return je}function gn(Be,se,he,xe){const Le=se.geometry,we=se.type,je=[];if(Be.minX=Math.min(Be.minX,se.minX),Be.minY=Math.min(Be.minY,se.minY),Be.maxX=Math.max(Be.maxX,se.maxX),Be.maxY=Math.max(Be.maxY,se.maxY),we==="Point"||we==="MultiPoint")for(let Ye=0;Ye<Le.length;Ye+=3)je.push(Le[Ye],Le[Ye+1]),Be.numPoints++,Be.numSimplified++;else if(we==="LineString")si(je,Le,Be,he,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let Ye=0;Ye<Le.length;Ye++)si(je,Le[Ye],Be,he,we==="Polygon",Ye===0);else if(we==="MultiPolygon")for(let Ye=0;Ye<Le.length;Ye++){const ze=Le[Ye];for(let tt=0;tt<ze.length;tt++)si(je,ze[tt],Be,he,!0,tt===0)}if(je.length){let Ye=se.tags||null;if(we==="LineString"&&xe.lineMetrics){Ye={};for(const tt in se.tags)Ye[tt]=se.tags[tt];Ye.mapbox_clip_start=Le.start/Le.size,Ye.mapbox_clip_end=Le.end/Le.size}const ze={geometry:je,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:Ye};se.id!==null&&(ze.id=se.id),Be.features.push(ze)}}function si(Be,se,he,xe,Le,we){const je=xe*xe;if(xe>0&&se.size<(Le?je:xe))return void(he.numPoints+=se.length/3);const Ye=[];for(let ze=0;ze<se.length;ze+=3)(xe===0||se[ze+2]>je)&&(he.numSimplified++,Ye.push(se[ze],se[ze+1])),he.numPoints++;Le&&function(ze,tt){let Tt=0;for(let xt=0,qt=ze.length,ar=qt-2;xt<qt;ar=xt,xt+=2)Tt+=(ze[xt]-ze[ar])*(ze[xt+1]+ze[ar+1]);if(Tt>0===tt)for(let xt=0,qt=ze.length;xt<qt/2;xt+=2){const ar=ze[xt],pr=ze[xt+1];ze[xt]=ze[qt-2-xt],ze[xt+1]=ze[qt-1-xt],ze[qt-2-xt]=ar,ze[qt-1-xt]=pr}}(Ye,we),Be.push(Ye)}const Wn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class aa{constructor(se,he){const xe=(he=this.options=function(we,je){for(const Ye in je)we[Ye]=je[Ye];return we}(Object.create(Wn),he)).debug;if(xe&&console.time("preprocess data"),he.maxZoom<0||he.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(he.promoteId&&he.generateId)throw new Error("promoteId and generateId cannot be used together.");let Le=function(we,je){const Ye=[];if(we.type==="FeatureCollection")for(let ze=0;ze<we.features.length;ze++)wr(Ye,we.features[ze],je,ze);else wr(Ye,we.type==="Feature"?we:{geometry:we},je);return Ye}(se,he);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",he.indexMaxZoom,he.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Le=function(we,je){const Ye=je.buffer/je.extent;let ze=we;const tt=ps(we,1,-1-Ye,Ye,0,-1,2,je),Tt=ps(we,1,1-Ye,2+Ye,0,-1,2,je);return(tt||Tt)&&(ze=ps(we,1,-Ye,1+Ye,0,-1,2,je)||[],tt&&(ze=Ul(tt,1).concat(ze)),Tt&&(ze=ze.concat(Ul(Tt,-1)))),ze}(Le,he),Le.length&&this.splitTile(Le,0,0,0),xe&&(Le.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,he,xe,Le,we,je,Ye){const ze=[se,he,xe,Le],tt=this.options,Tt=tt.debug;for(;ze.length;){Le=ze.pop(),xe=ze.pop(),he=ze.pop(),se=ze.pop();const xt=1<<he,qt=ms(he,xe,Le);let ar=this.tiles[qt];if(!ar&&(Tt>1&&console.time("creation"),ar=this.tiles[qt]=Mo(se,he,xe,Le,tt),this.tileCoords.push({z:he,x:xe,y:Le}),Tt)){Tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",he,xe,Le,ar.numFeatures,ar.numPoints,ar.numSimplified),console.timeEnd("creation"));const on=`z${he}`;this.stats[on]=(this.stats[on]||0)+1,this.total++}if(ar.source=se,we==null){if(he===tt.indexMaxZoom||ar.numPoints<=tt.indexMaxPoints)continue}else{if(he===tt.maxZoom||he===we)continue;if(we!=null){const on=we-he;if(xe!==je>>on||Le!==Ye>>on)continue}}if(ar.source=null,se.length===0)continue;Tt>1&&console.time("clipping");const pr=.5*tt.buffer/tt.extent,Or=.5-pr,Br=.5+pr,Sr=1+pr;let vr=null,Yn=null,no=null,ki=null,Ri=ps(se,xt,xe-pr,xe+Br,0,ar.minX,ar.maxX,tt),ui=ps(se,xt,xe+Or,xe+Sr,0,ar.minX,ar.maxX,tt);se=null,Ri&&(vr=ps(Ri,xt,Le-pr,Le+Br,1,ar.minY,ar.maxY,tt),Yn=ps(Ri,xt,Le+Or,Le+Sr,1,ar.minY,ar.maxY,tt),Ri=null),ui&&(no=ps(ui,xt,Le-pr,Le+Br,1,ar.minY,ar.maxY,tt),ki=ps(ui,xt,Le+Or,Le+Sr,1,ar.minY,ar.maxY,tt),ui=null),Tt>1&&console.timeEnd("clipping"),ze.push(vr||[],he+1,2*xe,2*Le),ze.push(Yn||[],he+1,2*xe,2*Le+1),ze.push(no||[],he+1,2*xe+1,2*Le),ze.push(ki||[],he+1,2*xe+1,2*Le+1)}}getTile(se,he,xe){se=+se,he=+he,xe=+xe;const Le=this.options,{extent:we,debug:je}=Le;if(se<0||se>24)return null;const Ye=1<<se,ze=ms(se,he=he+Ye&Ye-1,xe);if(this.tiles[ze])return yc(this.tiles[ze],we);je>1&&console.log("drilling down to z%d-%d-%d",se,he,xe);let tt,Tt=se,xt=he,qt=xe;for(;!tt&&Tt>0;)Tt--,xt>>=1,qt>>=1,tt=this.tiles[ms(Tt,xt,qt)];return tt&&tt.source?(je>1&&(console.log("found parent tile z%d-%d-%d",Tt,xt,qt),console.time("drilling down")),this.splitTile(tt.source,Tt,xt,qt,se,he,xe),je>1&&console.timeEnd("drilling down"),this.tiles[ze]?yc(this.tiles[ze],we):null):null}}function ms(Be,se,he){return 32*((1<<Be)*he+se)+Be}function wt(Be,se){const he=Be.tileID.canonical;if(!this._geoJSONIndex)return void se(null,null);const xe=this._geoJSONIndex.getTile(he.z,he.x,he.y);if(!xe)return void se(null,null);const Le=tt=>tt.tags&&"3d_elevation_id"in tt.tags&&"source"in tt.tags&&tt.tags.source==="elevation",we=xe.features.filter(tt=>Le(tt));let je={_geojsonTileLayer:xe.features};we.length>0&&(je={_geojsonTileLayer:xe.features.filter(tt=>!Le(tt)),hd_road_elevation:we});const Ye=new dt(je),ze=function(tt){const Tt=new o.bt;for(const xt of Object.keys(tt))Tt.writeMessage(3,hn,{name:xt,features:tt[xt]});return Tt.finish()}(je).buffer;se(null,{vectorTile:Ye,rawData:ze})}class Cs extends me{constructor(se,he,xe,Le,we,je,Ye){super(se,he,xe,Le,we,wt,Ye),je&&(this.loadGeoJSON=je),this._dynamicIndex=new at}loadData(se,he){const xe=se&&se.request,Le=xe&&xe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(se,(we,je)=>{if(we||!je)return he(we);if(typeof je!="object")return he(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{try{if(se.filter){const ze=o.U(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));je.features=je.features.filter(tt=>ze.value.evaluate({zoom:0},tt))}se.dynamic?(je.type==="Feature"&&(je={type:"FeatureCollection",features:[je]}),se.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(je.features,this.loaded),se.cluster&&(je.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=se.cluster?new Hn(function({superclusterOptions:ze,clusterProperties:tt}){if(!tt||!ze)return ze;const Tt={},xt={},qt={accumulated:null,zoom:0},ar={properties:null},pr=Object.keys(tt);for(const Or of pr){const[Br,Sr]=tt[Or],vr=o.U(Sr),Yn=o.U(typeof Br=="string"?[Br,["accumulated"],["get",Or]]:Br);Tt[Or]=vr.value,xt[Or]=Yn.value}return ze.map=Or=>{ar.properties=Or;const Br={};for(const Sr of pr)Br[Sr]=Tt[Sr].evaluate(qt,ar);return Br},ze.reduce=(Or,Br)=>{ar.properties=Br;for(const Sr of pr)qt.accumulated=Or[Sr],Or[Sr]=xt[Sr].evaluate(qt,ar)},ze}(se)).load(je.features):se.dynamic?this._dynamicIndex:function(ze,tt){return new aa(ze,tt)}(je,se.geojsonVtOptions)}catch(ze){return he(ze)}const Ye={};if(Le){const ze=v(xe);ze&&(Ye.resourceTiming={},Ye.resourceTiming[se.source]=JSON.parse(JSON.stringify(ze)))}he(null,Ye)}})}reloadTile(se,he){const xe=this.loaded;return xe&&xe[se.uid]?se.partial?he(null,void 0):super.reloadTile(se,he):this.loadTile(se,he)}loadGeoJSON(se,he){if(se.request)o.m(se.request,he);else{if(typeof se.data!="string")return he(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return he(null,JSON.parse(se.data))}catch{return he(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(se,he){try{he(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(xe){he(xe)}}getClusterChildren(se,he){try{he(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(xe){he(xe)}}getClusterLeaves(se,he){try{he(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(xe){he(xe)}}}class la{constructor(se,he,xe){this.tileID=new o.aQ(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=se.projection,this.brightness=he,this.worldview=xe}parse(se,he,xe,Le){this.status="parsing";const we=new o.aQ(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),je=[],Ye=he.familiesBySource[xe.source],ze=new o.fn(we,xe.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,o.fC(se).then(tt=>{if(!tt)return Le(new Error("Could not parse tile"));const Tt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("MAPBOX_mesh_features")||tt.json.asset.extras&&tt.json.asset.extras.MAPBOX_mesh_features,xt=tt.json.extensionsUsed&&tt.json.extensionsUsed.includes("EXT_meshopt_compression"),qt=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const ar in Ye)for(const pr of Ye[ar]){const Or=pr[0];ze.bucketLayerIDs.push(pr.map(vr=>o.B(vr.id,vr.scope))),Or.recalculate(qt,[]);const Br=o.fD(tt,1/o.d7(xe.tileID.canonical)),Sr=new o.fE(pr,Br,we,Tt,xt,this.brightness,ze,this.worldview);Tt||(Sr.needsUpload=!0),je.push(Sr),Sr.evaluate(Or)}this.status="done",Le(null,{buckets:je,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(tt=>Le(new Error(tt.message)))}}class Aa{constructor(se,he,xe,Le,we,je,Ye,ze){this.actor=se,this.layerIndex=he,this.availableImages=xe,this.availableModels=Le,this.brightness=Ye,this.loading={},this.loaded={},this.worldview=ze}loadTile(se,he){const xe=se.uid,Le=this.loading[xe]=new la(se,this.brightness,this.worldview);o.bu(se.request,(we,je)=>{const Ye=!this.loading[xe];return delete this.loading[xe],Ye||we?(Le.status="done",Ye||(this.loaded[xe]=Le),he(we)):je&&je.byteLength!==0?void Le.parse(je,this.layerIndex,se,(ze,tt)=>{Le.status="done",this.loaded=this.loaded||{},this.loaded[xe]=Le,ze||!tt?he(ze):he(null,tt)}):(Le.status="done",this.loaded[xe]=Le,he())})}reloadTile(se,he){const xe=this.loaded,Le=se.uid;if(xe&&xe[Le]){const we=xe[Le];we.projection=se.projection,we.brightness=se.brightness;const je=(Ye,ze)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(se,he)),he(Ye,ze)};we.status==="parsing"?we.reloadCallback=je:we.status==="done"&&this.loadTile(se,he)}}abortTile(se,he){const xe=se.uid;this.loading[xe]&&delete this.loading[xe],he()}removeTile(se,he){const xe=this.loaded,Le=se.uid;xe&&xe[Le]&&delete xe[Le],he()}}class an{constructor(se){this.self=se,this.actor=new o.fG(se,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cm({name:"mercator"}),this.workerSourceTypes={vector:me,geojson:Cs,"raster-dem":Ce,"raster-array":Ge,"batched-model":Aa},this.workerSources={},this.self.registerWorkerSource=(he,xe)=>{if(this.workerSourceTypes[he])throw new Error(`Worker source with name "${he}" already registered.`);this.workerSourceTypes[he]=xe},this.self.registerRTLTextPlugin=he=>{if(o.fH.isParsed())throw new Error("RTL text plugin already registered.");o.fH.setState({pluginStatus:o.fI.parsed,pluginURL:o.fH.getPluginURL()}),o.fH.applyArabicShaping=he.applyArabicShaping,o.fH.processBidirectionalText=he.processBidirectionalText,o.fH.processStyledBidirectionalText=he.processStyledBidirectionalText;for(const xe of this.rtlPluginParsingListeners)xe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(se,he,xe){delete this.layerIndexes[se],delete this.availableImages[se],delete this.availableModels[se],delete this.workerSources[se],xe()}checkIfReady(se,he,xe){xe()}setReferrer(se,he){this.referrer=he}spriteLoaded(se,he){this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={});const{scope:xe,isLoaded:Le}=he;if(this.isSpriteLoaded[se][xe]=Le,this.workerSources[se]&&this.workerSources[se][xe])for(const we in this.workerSources[se][xe]){const je=this.workerSources[se][xe][we];for(const Ye in je){const ze=je[Ye];ze instanceof me&&(ze.isSpriteLoaded=Le,ze.fire(new o.z("isSpriteLoaded")))}}}setImages(se,he,xe){this.availableImages[se]||(this.availableImages[se]={});const{scope:Le,images:we}=he;if(this.availableImages[se][Le]=we,this.workerSources[se]&&this.workerSources[se][Le]){for(const je in this.workerSources[se][Le]){const Ye=this.workerSources[se][Le][je];for(const ze in Ye)Ye[ze].availableImages=we}xe()}else xe()}setModels(se,{scope:he,models:xe},Le){if(this.availableModels[se]||(this.availableModels[se]={}),this.availableModels[se][he]=xe,this.workerSources[se]&&this.workerSources[se][he]){for(const we in this.workerSources[se][he]){const je=this.workerSources[se][he][we];for(const Ye in je)je[Ye].availableModels=xe}Le()}else Le()}setProjection(se,he){this.projections[se]=o.cm(he)}setBrightness(se,he,xe){this.brightness=he,xe()}setWorldview(se,he,xe){this.worldview=he,xe()}setLayers(se,he,xe){this.getLayerIndex(se,he.scope).replace(he.layers,he.options),xe()}updateLayers(se,he,xe){this.getLayerIndex(se,he.scope).update(he.layers,he.removedIds,he.options),xe()}loadTile(se,he,xe){he.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,he.type,he.source,he.scope).loadTile(he,xe)}decodeRasterArray(se,he,xe){this.getWorkerSource(se,he.type,he.source,he.scope).decodeRasterArray(he,xe)}reloadTile(se,he,xe){he.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,he.type,he.source,he.scope).reloadTile(he,xe)}abortTile(se,he,xe){this.getWorkerSource(se,he.type,he.source,he.scope).abortTile(he,xe)}removeTile(se,he,xe){this.getWorkerSource(se,he.type,he.source,he.scope).removeTile(he,xe)}removeSource(se,he,xe){if(!(this.workerSources[se]&&this.workerSources[se][he.scope]&&this.workerSources[se][he.scope][he.type]&&this.workerSources[se][he.scope][he.type][he.source]))return;const Le=this.workerSources[se][he.scope][he.type][he.source];delete this.workerSources[se][he.scope][he.type][he.source],Le.removeSource!==void 0?Le.removeSource(he,xe):xe()}loadWorkerSource(se,he,xe){try{this.self.importScripts(he.url),xe()}catch(Le){xe(Le)}}syncRTLPluginState(se,he,xe){if(o.fH.isParsed())xe(null,!0);else if(o.fH.isParsing())this.rtlPluginParsingListeners.push(xe);else try{o.fH.setState(he);const Le=o.fH.getPluginURL();!o.fH.isLoaded()||o.fH.isParsed()||o.fH.isParsing()||Le==null||(o.fH.setState({pluginStatus:o.fI.parsing,pluginURL:o.fH.getPluginURL()}),this.self.importScripts(Le),o.fH.isParsed()?xe(null,!0):this.rtlPluginParsingListeners.push(xe))}catch(Le){xe(Le)}}setDracoUrl(se,he){this.dracoUrl=he}getAvailableImages(se,he){this.availableImages[se]||(this.availableImages[se]={});let xe=this.availableImages[se][he];return xe||(xe=[]),xe}getAvailableModels(se,he){this.availableModels[se]||(this.availableModels[se]={});let xe=this.availableModels[se][he];return xe||(xe={}),xe}getLayerIndex(se,he){this.layerIndexes[se]||(this.layerIndexes[se]={});let xe=this.layerIndexes[se][he];return xe||(xe=this.layerIndexes[se][he]=new k,xe.scope=he),xe}getWorkerSource(se,he,xe,Le){const we=this.workerSources;return we[se]||(we[se]={}),we[se][Le]||(we[se][Le]={}),we[se][Le][he]||(we[se][Le][he]={}),this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),we[se][Le][he][xe]||(we[se][Le][he][xe]=new this.workerSourceTypes[he]({send:(je,Ye,ze,tt,Tt,xt)=>this.actor.send(je,Ye,ze,se,Tt,xt),scheduler:this.actor.scheduler},this.getLayerIndex(se,Le),this.getAvailableImages(se,Le),this.getAvailableModels(se,Le),this.isSpriteLoaded[se][Le],void 0,this.brightness,this.worldview)),we[se][Le][he][xe]}rasterizeImagesWorker(se,he,xe){const Le=new Map;for(const[we,{image:je,imageVariant:Ye}]of he.tasks.entries()){const ze=this.imageRasterizer.rasterize(Ye,je,he.scope,se);Le.set(we,ze)}xe(void 0,Le)}removeRasterizedImages(se,he,xe){this.imageRasterizer.removeImagesFromCacheByIds(he.imageIds,he.scope,se),xe()}enforceCacheSizeLimit(se,he){o.fJ(he)}getWorkerPerformanceMetrics(se,he,xe){xe(void 0,void 0)}}return o.fF(self)&&(self.worker=new an(self)),an}),u(["./shared"],function(o){var v="3.18.0";const w={create:"create",load:"load",fullLoad:"fullLoad"},P={mark(m){performance.mark(m)},measure(m,s,h){performance.measure(m,s,h)}};function C(m){const s=m.name.split("?")[0];return o.a(s)&&s.includes("mapbox-gl.js")?"javascript":o.a(s)&&s.includes("mapbox-gl.css")?"css":o.b(s)?"fontRange":o.c(s)?"sprite":o.i(s)?"style":o.d(s)?"tilejson":"other"}var k,L={},$=function(){if(k)return L;function m(g){return!s(g)}function s(g){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var S,T,O=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(O);try{T=new Worker(R),S=!0}catch{S=!1}return T&&T.terminate(),URL.revokeObjectURL(R),S}()?function(){var S=document.createElement("canvas");S.width=S.height=1;var T=S.getContext("2d");if(!T)return!1;var O=T.getImageData(0,0,1,1);return O&&O.width===S.width}()?(h[x=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[x]=function(S){var T,O=function(R){var z=document.createElement("canvas"),F=Object.create(m.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=R,z.getContext("webgl2",F)}(S);if(!O)return!1;try{T=O.createShader(O.VERTEX_SHADER)}catch{return!1}return!(!T||O.isContextLost())&&(O.shaderSource(T,"void main() {}"),O.compileShader(T),O.getShaderParameter(T,O.COMPILE_STATUS)===!0)}(x)),h[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}k=1,L.supported=m,L.notSupportedReason=s;var h={};return m.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},L}();function j(m,s,h){const g=document.createElement(m);return s!=null&&(g.className=s),h&&h.appendChild(g),g}function B(m,s,h){const g=document.createElementNS("http://www.w3.org/2000/svg",m);for(const x of Object.keys(s))g.setAttributeNS(null,x,String(s[x]));return h&&h.appendChild(g),g}const U=typeof document<"u"?document.documentElement&&document.documentElement.style:null,q=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let H;function te(){U&&q&&(H=U[q],U[q]="none")}function Q(){U&&q&&(U[q]=H)}function ae(m){m.preventDefault(),m.stopPropagation(),window.removeEventListener("click",ae,!0)}function ue(){window.addEventListener("click",ae,!0),window.setTimeout(()=>{window.removeEventListener("click",ae,!0)},0)}function me(m,s){const h=m.getBoundingClientRect();return Ge(m,h,s)}function Ce(m,s){const h=m.getBoundingClientRect(),g=[];for(let x=0;x<s.length;x++)g.push(Ge(m,h,s[x]));return g}function Fe(m){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&m.button===2&&m.ctrlKey?0:m.button}function Ge(m,s,h){const g=m.offsetWidth===s.width?1:m.offsetWidth/s.width;return new o.P((h.clientX-s.left)*g,(h.clientY-s.top)*g)}const Ve="01",Ze="NO_ACCESS_TOKEN";class nt{constructor(s,h,g){this._transformRequestFn=s,this._customAccessToken=h,this._silenceAuthErrors=!!g,this._createSkuToken()}_createSkuToken(){const s=function(){let h="";for(let g=0;g<10;g++)h+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ve,h].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}normalizeStyleURL(s,h){if(!o.h(s))return s;const g=rt(s);return g.params.push(`sdk=js-${v}`),g.path=`/styles/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||h)}normalizeGlyphsURL(s,h){if(!o.h(s))return s;const g=rt(s);return g.path=`/fonts/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||h)}normalizeModelURL(s,h){if(!o.h(s))return s;const g=rt(s);return g.path=`/models/v1${g.path}`,this._makeAPIURL(g,this._customAccessToken||h)}normalizeSourceURL(s,h,g,x){if(!o.h(s))return s;const S=rt(s);return S.path=`/v4/${S.authority}.json`,S.params.push("secure"),g&&S.params.push(`language=${g}`),x&&S.params.push(`worldview=${x}`),this._makeAPIURL(S,this._customAccessToken||h)}normalizeIconsetURL(s,h){const g=rt(s);return o.h(s)?(g.path=`/styles/v1${g.path}/iconset.pbf`,this._makeAPIURL(g,this._customAccessToken||h)):at(g)}normalizeSpriteURL(s,h,g,x){const S=rt(s);return o.h(s)?(S.path=`/styles/v1${S.path}/sprite${h}${g}`,this._makeAPIURL(S,this._customAccessToken||x)):(S.path+=`${h}${g}`,at(S))}normalizeTileURL(s,h,g){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!o.h(s))return s;const x=rt(s);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${h||g&&x.authority!=="raster"&&g===512?"@2x":""}${o.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${o.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${o.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${o.e.TILE_URL_VERSION}${x.path}`);const S=this._customAccessToken||function(T){for(const O of T){const R=O.match(/^access_token=(.*)$/);if(R)return R[1]}return null}(x.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&S&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,S)}canonicalizeTileURL(s,h){const g=rt(s);if(!g.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!g.path.match(/\.[\w]+$/))return s;let x="mapbox://";g.path.match(/^\/raster\/v1\//)?x+=`raster/${g.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:g.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${g.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${g.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let S=g.params;return h&&(S=S.filter(T=>!T.match(/^access_token=/))),S.length&&(x+=`?${S.join("&")}`),x}canonicalizeTileset(s,h){const g=!!h&&o.h(h),x=[];for(const S of s.tiles||[])o.j(S)?x.push(this.canonicalizeTileURL(S,g)):x.push(S);return x}_makeAPIURL(s,h){const g="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=rt(o.e.API_URL);if(s.protocol=x.protocol,s.authority=x.authority,s.protocol==="http"){const S=s.params.indexOf("secure");S>=0&&s.params.splice(S,1)}if(x.path!=="/"&&(s.path=`${x.path}${s.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return at(s);if(h=h||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!h)throw new Error(`An API access token is required to use Mapbox GL. ${g}`);if(h[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${g}`)}return s.params=s.params.filter(S=>S.indexOf("access_token")===-1),s.params.push(`access_token=${h||""}`),at(s)}}const dt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function rt(m){const s=m.match(dt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function at(m){const s=m.params.length?`?${m.params.join("&")}`:"";return`${m.protocol}://${m.authority}${m.path}${s}`}const qe="mapbox.eventData";function He(m){if(!m)return null;const s=m.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(o.l(s[1]))}catch{return null}}class Et{constructor(s){this.type=s,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const h=He(o.e.ACCESS_TOKEN);let g="";return g=h&&h.u?o.f(h.u):o.e.ACCESS_TOKEN||"",s?`${qe}.${s}:${g}`:`${qe}:${g}`}fetchEventData(){const s=o.s("localStorage"),h=this.getStorageKey(),g=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp");if(s)try{const S=localStorage.getItem(h);S&&(this.eventData=JSON.parse(S));const T=localStorage.getItem(g);T&&(this.anonId=T);const O=localStorage.getItem(x);O&&(this.anonIdTimestamp=Number(O));const R=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<R)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const s=o.s("localStorage"),h=this.getStorageKey(),g=this.getStorageKey("uuid"),x=this.getStorageKey("uuidTimestamp"),S=this.anonId,T=this.anonIdTimestamp;if(s&&S)try{localStorage.setItem(g,S),Object.keys(this.eventData).length>=1&&localStorage.setItem(h,JSON.stringify(this.eventData)),T&&localStorage.setItem(x,T.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,h,g,x){if(!o.e.EVENTS_URL)return;const S=rt(o.e.EVENTS_URL);S.params.push(`access_token=${x||o.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(s).toISOString()},O=h?Object.assign(T,h):T,R={url:at(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([O])};this.pendingRequest=o.p(R,z=>{this.pendingRequest=null,g(z),this.saveEventData(),this.processRequests(x)})}queueRequest(s,h){this.queue.push(s),this.processRequests(h)}}class Gt extends Et{constructor(s){super("metrics"),s&&(this.data=s)}postMetricsEvent(s){if(!o.e.EVENTS_URL||!s&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const h=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:h},s)}processRequests(s){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:h,payload:g}=this.queue.shift();this.postEvent(h,g,()=>{},s)}}const Ot=new class extends Et{constructor(m){super("appUserTurnstile"),this._customAccessToken=m}postTurnstileEvent(m,s){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(m)&&m.some(h=>o.h(h)||o.j(h))&&this.queueRequest(Date.now(),s)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=He(o.e.ACCESS_TOKEN),h=s?s.u:o.e.ACCESS_TOKEN;let g=h!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),g=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const S=new Date(this.eventData.lastSuccess),T=new Date(x),O=(x-this.eventData.lastSuccess)/864e5;g=g||O>=1||O<-1||S.getDate()!==T.getDate()}else g=!0;g?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ve,"enabled.telemetry":!1,userId:this.anonId},S=>{S||(this.eventData.lastSuccess=x,this.eventData.tokenU=h)},m):this.processRequests()}},$t=Ot.postTurnstileEvent.bind(Ot),ur=new class extends Et{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(m,s,h,g){this.skuToken=s,this.errorCb=g,o.e.EVENTS_URL&&(h||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},h):this.errorCb(new Error(Ze)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:h}=this.queue.shift();s&&this.success[s]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:Ve,skuToken:this.skuToken,userId:this.anonId},g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m))}remove(){this.errorCb=null}},Yr=ur.postMapLoadEvent.bind(ur),hn=new class extends Et{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(m){let s=this.mapInstanceIdMap.get(m);return s||(s=o.u(),this.mapInstanceIdMap.set(m,s)),s}getEventId(m){const s=this.eventIdPerMapInstanceMap.get(m)||0;return this.eventIdPerMapInstanceMap.set(m,s+1),s}postStyleLoadEvent(m,s){const{map:h,style:g,importedStyles:x}=s;if(!o.e.EVENTS_URL||!m&&!o.e.ACCESS_TOKEN)return;const S=this.getMapInstanceId(h),T={mapInstanceId:S,eventId:this.getEventId(S),style:g};x.length&&(T.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:T},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:h}=this.queue.shift();this.postEvent(s,h,()=>{},m)}},rr=hn.postStyleLoadEvent.bind(hn),Wr=new Gt({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Rt=Wr.postMetricsEvent.bind(Wr),Yt=new Gt({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),ir=Yt.postMetricsEvent.bind(Yt),jt=new class extends Et{constructor(){super("gljs.performance")}postPerformanceEvent(m,s){o.e.EVENTS_URL&&(m||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},m)}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:h}=this.queue.shift(),g=function(x){const S=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),O=function(K){const ne={};if(K){for(const ee in K)if(ee!=="other")for(const ie of K[ee]){const ce=`${ee}ResolveRangeMin`,ge=`${ee}ResolveRangeMax`,pe=`${ee}RequestCount`,fe=`${ee}RequestCachedCount`;ne[ce]=Math.min(ne[ce]||1/0,ie.startTime),ne[ge]=Math.max(ne[ge]||-1/0,ie.responseEnd);const Ie=Ee=>{ne[Ee]===void 0&&(ne[Ee]=0),++ne[Ee]};ie.transferSize!==void 0&&ie.transferSize===0&&Ie(fe),Ie(pe)}}return ne}(function(K,ne){const ee={};if(K)for(const ie of K){const ce=ne(ie);ee[ce]===void 0&&(ee[ce]=[]),ee[ce].push(ie)}return ee}(S,C)),R=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=z?z.effectiveType:void 0,Z={counters:[],metadata:[],attributes:[]},W=(K,ne,ee)=>{ee!=null&&K.push({name:ne,value:ee.toString()})};for(const K in O)W(Z.counters,K,O[K]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(W(Z.counters,"interactionRangeMin",x.interactionRange[0]),W(Z.counters,"interactionRangeMax",x.interactionRange[1])),T)for(const K of Object.values(w)){const ne=T.find(ee=>ee.name===K);ne&&W(Z.counters,K,ne.startTime)}return W(Z.counters,"visibilityHidden",x.visibilityHidden),W(Z.attributes,"style",function(K){if(K)for(const ne of K){const ee=ne.name.split("?")[0];if(o.i(ee)){const ie=ee.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}}(S)),W(Z.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),W(Z.attributes,"fogEnabled",x.fogEnabled?"true":"false"),W(Z.attributes,"projection",x.projection),W(Z.attributes,"zoom",x.zoom),W(Z.metadata,"devicePixelRatio",R),W(Z.metadata,"connectionEffectiveType",F),W(Z.metadata,"navigatorUserAgent",navigator.userAgent),W(Z.metadata,"screenWidth",window.screen.width),W(Z.metadata,"screenHeight",window.screen.height),W(Z.metadata,"windowWidth",window.innerWidth),W(Z.metadata,"windowHeight",window.innerHeight),W(Z.metadata,"mapWidth",x.width/R),W(Z.metadata,"mapHeight",x.height/R),W(Z.metadata,"webglRenderer",x.renderer),W(Z.metadata,"webglVendor",x.vendor),W(Z.metadata,"sdkVersion",v),W(Z.metadata,"sdkIdentifier","mapbox-gl-js"),Z}(h);for(const x of g.metadata);for(const x of g.counters);for(const x of g.attributes);this.postEvent(s,g,()=>{},m)}},Ir=jt.postPerformanceEvent.bind(jt),Xr=new class extends Et{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(m,s,h,g){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const x=rt(o.e.API_URL+o.e.SESSION_PATH);x.params.push(`sku=${s||""}`),x.params.push(`access_token=${g||o.e.ACCESS_TOKEN||""}`);const S={url:at(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(S,T=>{this.pendingRequest=null,h(T),this.saveEventData(),this.processRequests(g)})}getSessionAPI(m,s,h,g){this.skuToken=s,this.errorCb=g,o.e.SESSION_PATH&&o.e.API_URL&&(h||o.e.ACCESS_TOKEN?this.queueRequest({id:m,timestamp:Date.now()},h):this.errorCb(new Error(Ze)))}processRequests(m){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:h}=this.queue.shift();s&&this.success[s]||this.getSession(h,this.skuToken,g=>{g?this.errorCb(g):s&&(this.success[s]=!0)},m)}remove(){this.errorCb=null}},Vn=Xr.getSessionAPI.bind(Xr),Hn=new Set;function ei(m,s){s?Hn.add(m):Hn.delete(m)}class Nn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,h){this._updatedSourceCaches[s]=h,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const h=s.scope;this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._updatedLayers[h].add(s.id),this.setDirty()}removeLayer(s){const h=s.scope;this._removedLayers[h]=this._removedLayers[h]||{},this._updatedLayers[h]=this._updatedLayers[h]||new Set,this._removedLayers[h][s.id]=s,this._updatedLayers[h].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const h in this._updatedLayers)s[h]=s[h]||{},s[h].updatedIds=Array.from(this._updatedLayers[h].values());for(const h in this._removedLayers)s[h]=s[h]||{},s[h].removedIds=Object.keys(this._removedLayers[h]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,h){this._updatedImages[h]=this._updatedImages[h]||new Set,this._updatedImages[h].add(o.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ho(m){const{userImage:s}=m;return!!(s&&s.render&&s.render())&&(m.data.replace(new Uint8Array(s.data.buffer)),!0)}class ot extends o.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new o.q({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const h=this.atlasTexture.get(s);h&&(h.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,h){this.imageProviders.has(h)||this.imageProviders.set(h,new Map),this.imageProviders.get(h).set(s.id,s)}removeImageProvider(s,h){this.imageProviders.has(h)&&this.imageProviders.get(h).delete(s)}getPendingImageProviders(){const s=[];for(const h of this.imageProviders.values())for(const g of h.values())g.hasPendingRequests()&&s.push(g);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,h){if(this.loaded.get(h)!==s&&(this.loaded.set(h,s),s)){for(const{ids:g,callback:x}of this.requestors)this._notify(g,h,x);this.requestors=[]}}hasImage(s,h){return!!this.getImage(s,h)}getImage(s,h){return this.images.get(h).get(s.toString())}addImage(s,h,g){this._validate(s,g)&&this.images.get(h).set(s.toString(),g)}_validate(s,h){let g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new o.y(new Error(`Image "${s.name}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new o.y(new Error(`Image "${s.name}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new o.y(new Error(`Image "${s.name}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(const x of s){if(x[0]<g||x[1]<x[0]||h<x[1])return!1;g=x[1]}return!0}_validateContent(s,h){return s?s.length!==4||!h.usvg&&(s[0]<0||h.data.width<s[0]||s[1]<0||h.data.height<s[1]||s[2]<0||h.data.width<s[2]||s[3]<0||h.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,h,g){const x=this.images.get(h).get(s.toString());g.version=x.version+1,this.images.get(h).set(s.toString(),g),this.updatedImages.get(h).add(s),this.removeFromImageRasterizerCache(s,h)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,h){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:h}):this.imageRasterizer.removeImagesFromCacheByIds([s],h))}removeImage(s,h){const g=this.images.get(h),x=g.get(s.toString());g.delete(s.toString()),this.patterns.get(h).delete(s.toString()),this.removeFromImageRasterizerCache(s,h),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(h=>o.I.from(h))}getImages(s,h,g){const x=[],S=[],T=this.imageProviders.get(h);for(const F of s){if(!F.iconsetId){x.push(F);continue}const Z=T.get(F.iconsetId);Z&&(this.getImage(F,h)?S.push(F):Z.addPendingRequest(F))}if(x.length===0)return void this._notify(S,h,g);let O=!0;const R=!!this.loaded.get(h),z=this.images.get(h);if(!R)for(const F of x)z.has(F.toString())||(O=!1);R||O?this._notify(x,h,g):this.requestors.push({ids:x,scope:h,callback:g})}rasterizeImages(s,h){const g=new Map,{tasks:x,scope:S}=s;for(const[T,O]of x.entries()){const R=this.getImage(O.id,S);R&&g.set(T,{image:R,imageVariant:O})}this._rasterizeImages(S,g,h)}_rasterizeImages(s,h,g){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:h,scope:s},g);else{const x=new Map;for(const[S,{image:T,imageVariant:O}]of h.entries())x.set(S,this.imageRasterizer.rasterize(O,T,s,0));g(void 0,x)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,h,g){const x=this.images.get(h),S=new Map;for(const T of s){if(!x.get(T.toString())){if(T.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:T.name}))}const O=x.get(T.toString());if(!O){o.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:O.usvg?null:O.data.clone(),pixelRatio:O.pixelRatio,sdf:O.sdf,usvg:O.usvg,version:O.version,stretchX:O.stretchX,stretchY:O.stretchY,content:O.content,hasRenderCallback:!!(O.userImage&&O.userImage.render)};O.usvg&&Object.assign(R,{width:O.icon.usvg_tree.width,height:O.icon.usvg_tree.height}),S.set(o.I.toString(T),R)}g(null,S)}getPixelSize(s){const{width:h,height:g}=this.atlasImage.get(s);return{width:h,height:g}}getPattern(s,h,g){const x=s.toString(),S=this.patterns.get(h),T=S.get(x),O=this.getImage(s,h);if(!O)return null;if(T){if(T.position.version===O.version)return T.position;T.position.version=O.version}else{if(O.usvg&&!O.data){const R=this.getPatternInFlightId(x,h);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const z=new o.A(s).scaleSelf(o.o.devicePixelRatio),F=new Map([[z.toString(),{image:O,imageVariant:z}]]);return this._rasterizeImages(h,F,(Z,W)=>this.storePatternImage(z,h,O,g,W)),null}this.storePattern(s,h,O)}return this._updatePatternAtlas(h,g),S.get(x).position}getPatternInFlightId(s,h){return o.B(s,h)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,h,g,x,S){const T=s.toString(),O=S?S.get(T):void 0;O&&(g.data=O,this.storePattern(s.id,h,g),this._updatePatternAtlas(h,x),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),h)))}storePattern(s,h,g){const x={w:g.data.width+2*o.C,h:g.data.height+2*o.C,x:0,y:0},S=new o.F(x,g,o.C);this.patterns.get(h).set(s.toString(),{bin:x,position:S})}destroyAtlasTextures(){for(const s of this.atlasTexture.values())s&&s.destroy();this.atlasTexture.clear()}bind(s,h){const g=s.gl;let x=this.atlasTexture.get(h);x?this.dirty&&(x.update(this.atlasImage.get(h)),this.dirty=!1):(x=new o.T(s,this.atlasImage.get(h),g.RGBA8),this.atlasTexture.set(h,x)),x.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(s,h){const g=this.patterns.get(s),x=Array.from(g.values()).map(({bin:z})=>z),{w:S,h:T}=o.G(x),O=this.atlasImage.get(s);O.resize({width:S||1,height:T||1});const R=this.images.get(s);for(const[z,{bin:F,position:Z}]of g.entries()){let W=Z.padding;const K=F.x+W,ne=F.y+W,ee=R.get(z).data,ie=ee.width,ce=ee.height;W=W>1?W-1:W,o.q.copy(ee,O,{x:0,y:0},{x:K,y:ne},{width:ie,height:ce},h),o.q.copy(ee,O,{x:0,y:ce-W},{x:K,y:ne-W},{width:ie,height:W},h),o.q.copy(ee,O,{x:0,y:0},{x:K,y:ne+ce},{width:ie,height:W},h),o.q.copy(ee,O,{x:ie-W,y:0},{x:K-W,y:ne},{width:W,height:ce},h),o.q.copy(ee,O,{x:0,y:0},{x:K+ie,y:ne},{width:W,height:ce},h),o.q.copy(ee,O,{x:ie-W,y:ce-W},{x:K-W,y:ne-W},{width:W,height:W},h),o.q.copy(ee,O,{x:0,y:ce-W},{x:K+ie,y:ne-W},{width:W,height:W},h),o.q.copy(ee,O,{x:0,y:0},{x:K+ie,y:ne+ce},{width:W,height:W},h),o.q.copy(ee,O,{x:ie-W,y:0},{x:K-W,y:ne+ce},{width:W,height:W},h)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,h){const g=this.images.get(h);for(const x of s){if(this.callbackDispatchedThisFrame.get(h).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(h).add(x.toString());const S=g.get(x.toString());ho(S)&&this.updateImage(x,h,S)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function St(m){const s=m.value,h=m.valueSpec,g=m.style,x=m.styleSpec,S=m.key,T=m.arrayElementValidator||Mn;if(!Array.isArray(s))return[new o.V(S,s,`array expected, ${o.K(s)} found`)];if(h.length&&s.length!==h.length)return[new o.V(S,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new o.V(S,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let O={type:h.value,values:h.values,minimum:h.minimum,maximum:h.maximum,function:void 0};x.$version<7&&(O.function=h.function),o.H(h.value)&&(O=h.value);let R=[];for(let z=0;z<s.length;z++)R=R.concat(T({array:s,arrayIndex:z,value:s[z],valueSpec:O,style:g,styleSpec:x,key:`${S}[${z}]`},!0));return R}function Nt(m){const s=m.key,h=m.value,g=m.valueSpec;if(!o.L(h))return[new o.V(s,h,`number expected, ${o.K(h)} found`)];if(h!=h)return[new o.V(s,h,"number expected, NaN found")];if("minimum"in g){let x=g.minimum;if(Array.isArray(g.minimum)&&(x=g.minimum[m.arrayIndex]),h<x)return[new o.V(s,h,`${h} is less than the minimum value ${x}`)]}if("maximum"in g){let x=g.maximum;if(Array.isArray(g.maximum)&&(x=g.maximum[m.arrayIndex]),h>x)return[new o.V(s,h,`${h} is greater than the maximum value ${x}`)]}return[]}function dr(m){const s=m.key,h=m.value;if(!o.H(h))return[new o.V(s,h,`object expected, ${o.K(h)} found`)];const g=m.valueSpec,x=o.J(h.type);let S,T,O,R={};const z=x!=="categorical"&&h.property===void 0,F=!z,Z=function(ee){const ie=ee.stops;return Array.isArray(ie)&&Array.isArray(ie[0])&&o.H(ie[0][0])}(h),W=Mo({key:m.key,value:m.value,valueSpec:m.styleSpec.function,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{stops:function(ee){if(x==="identity")return[new o.V(ee.key,ee.value,'identity function may not have a "stops" property')];let ie=[];const ce=ee.value;return ie=ie.concat(St({key:ee.key,value:ce,valueSpec:ee.valueSpec,style:ee.style,styleSpec:ee.styleSpec,arrayElementValidator:K})),Array.isArray(ce)&&ce.length===0&&ie.push(new o.V(ee.key,ce,"array must have at least one stop")),ie},default:function(ee){return Mn({key:ee.key,value:ee.value,valueSpec:g,style:ee.style,styleSpec:ee.styleSpec})}}});return x==="identity"&&z&&W.push(new o.V(m.key,m.value,'missing required property "property"')),x==="identity"||h.stops||W.push(new o.V(m.key,m.value,'missing required property "stops"')),x==="exponential"&&g.expression&&!o.M(g)&&W.push(new o.V(m.key,m.value,"exponential functions not supported")),m.styleSpec.$version>=8&&(F&&!o.N(g)?W.push(new o.V(m.key,m.value,"property functions not supported")):z&&!o.O(g)&&W.push(new o.V(m.key,m.value,"zoom functions not supported"))),x!=="categorical"&&!Z||h.property!==void 0||W.push(new o.V(m.key,m.value,'"property" property is required')),W;function K(ee){let ie=[];const ce=ee.value,ge=ee.key;if(!Array.isArray(ce))return[new o.V(ge,ce,`array expected, ${o.K(ce)} found`)];if(ce.length!==2)return[new o.V(ge,ce,`array length 2 expected, length ${ce.length} found`)];if(Z){if(!o.H(ce[0]))return[new o.V(ge,ce,`object expected, ${o.K(ce[0])} found`)];const pe=ce[0];if(pe.zoom===void 0)return[new o.V(ge,ce,"object stop key must have zoom")];if(pe.value===void 0)return[new o.V(ge,ce,"object stop key must have value")];const fe=o.J(pe.zoom);if(typeof fe!="number")return[new o.V(ge,pe.zoom,"stop zoom values must be numbers")];if(O&&O>fe)return[new o.V(ge,pe.zoom,"stop zoom values must appear in ascending order")];fe!==O&&(O=fe,T=void 0,R={}),ie=ie.concat(Mo({key:`${ge}[0]`,value:ce[0],valueSpec:{zoom:{}},style:ee.style,styleSpec:ee.styleSpec,objectElementValidators:{zoom:Nt,value:ne}}))}else ie=ie.concat(ne({key:`${ge}[0]`,value:ce[0],style:ee.style,styleSpec:ee.styleSpec},ce));return o.Q(o.S(ce[1]))?ie.concat([new o.V(`${ge}[1]`,ce[1],"expressions are not allowed in function stops.")]):ie.concat(Mn({key:`${ge}[1]`,value:ce[1],valueSpec:g,style:ee.style,styleSpec:ee.styleSpec}))}function ne(ee,ie){const ce=o.K(ee.value),ge=o.J(ee.value),pe=ee.value!==null?ee.value:ie;if(S){if(ce!==S)return[new o.V(ee.key,pe,`${ce} stop domain type must match previous stop domain type ${S}`)]}else S=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean"&&typeof ge!="number"&&typeof ge!="string"&&typeof ge!="boolean")return[new o.V(ee.key,pe,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&x!=="categorical"){let fe=`number expected, ${ce} found`;return o.N(g)&&x===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(ee.key,pe,fe)]}return x!=="categorical"||ce!=="number"||typeof ge=="number"&&isFinite(ge)&&Math.floor(ge)===ge?x!=="categorical"&&ce==="number"&&typeof ge=="number"&&typeof T=="number"&&T!==void 0&&ge<T?[new o.V(ee.key,pe,"stop domain values must appear in ascending order")]:(T=ge,x==="categorical"&&ge in R?[new o.V(ee.key,pe,"stop domain values must be unique")]:(R[ge]=!0,[])):[new o.V(ee.key,pe,`integer expected, found ${String(ge)}`)]}}function nr(m){const s=(m.expressionContext==="property"?o.W:o.U)(o.S(m.value),m.valueSpec);if(s.result==="error")return s.value.map(g=>new o.V(`${m.key}${g.key}`,m.value,g.message));const h=s.value.expression||s.value._styleExpression.expression;if(m.expressionContext==="property"&&m.propertyKey==="text-font"&&!h.outputDefined())return[new o.V(m.key,m.value,`Invalid data expression for "${m.propertyKey}". Output values must be contained as literals within the expression.`)];if(m.expressionContext==="property"&&m.propertyType==="layout"&&!o.Z(h))return[new o.V(m.key,m.value,'"feature-state" data expressions are not supported with layout properties.')];if(m.expressionContext==="filter")return er(h,m);if(m.expressionContext==="appearance")return wr(h,m);if(m.expressionContext&&m.expressionContext.indexOf("cluster")===0){if(!o.X(h,["zoom","feature-state"]))return[new o.V(m.key,m.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(m.expressionContext==="cluster-initial"&&!o.Y(h))return[new o.V(m.key,m.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function er(m,s){const h=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)h.delete(x);if(h.size===0)return[];const g=[];return m instanceof o._&&h.has(m.name)?[new o.V(s.key,s.value,`["${m.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(m.eachChild(x=>{g.push(...er(x,s))}),g)}function wr(m,s){const h=new Set;if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)h.add(x);if(h.size===0)return[];const g=[];return m instanceof o._&&!h.has(m.name)?[new o.V(s.key,s.value,`["${m.name}"] is not an allowed parameter`)]:(m.eachChild(x=>{g.push(...wr(x,s))}),g)}function Tn(m){const s=m.key,h=m.value,g=m.valueSpec,x=[];return Array.isArray(g.values)?g.values.indexOf(o.J(h))===-1&&x.push(new o.V(s,h,`expected one of [${g.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(g.values).indexOf(o.J(h))===-1&&x.push(new o.V(s,h,`expected one of [${Object.keys(g.values).join(", ")}], ${JSON.stringify(h)} found`)),x}function Kn(m){return o.a2(o.S(m.value))?nr(Object.assign({},m,{expressionContext:"filter",valueSpec:m.styleSpec[`filter_${m.layerType||"fill"}`]})):Po(m)}function Po(m){const s=m.value,h=m.key;if(!Array.isArray(s))return[new o.V(h,s,`array expected, ${o.K(s)} found`)];if(s.length<1)return[new o.V(h,s,"filter array must have at least 1 element")];const g=m.styleSpec;let x=Tn({key:`${h}[0]`,value:s[0],valueSpec:g.filter_operator});const S=()=>{s.length>=2&&(o.a0(s[1])||x.push(new o.V(`${h}[1]`,s[1],`string expected, ${o.K(s[1])} found`)));for(let T=2;T<s.length;T++)o.J(s[1])==="$type"?x=x.concat(Tn({key:`${h}[${T}]`,value:s[T],valueSpec:g.geometry_type})):o.a0(s[T])||o.L(s[T])||o.$(s[T])||x.push(new o.V(`${h}[${T}]`,s[T],`string, number, or boolean expected, ${o.K(s[T])} found.`))};switch(o.J(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&o.J(s[1])==="$type"&&x.push(new o.V(h,s,`"$type" cannot be use with operator "${s[0]}"`)),s.length!==3&&x.push(new o.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`)),S();break;case"==":case"!=":s.length!==3&&x.push(new o.V(h,s,`filter array for operator "${s[0]}" must have 3 elements`)),S();break;case"in":case"!in":S();break;case"any":case"all":case"none":for(let T=1;T<s.length;T++)x=x.concat(Po({key:`${h}[${T}]`,value:s[T],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":s.length!==2?x.push(new o.V(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):o.a0(s[1])||x.push(new o.V(`${h}[1]`,s[1],`string expected, ${o.K(s[1])} found`))}return x}function Ji(m,s){const h=m.key,g=m.style,x=m.layer,S=m.styleSpec,T=m.value,O=m.objectKey,R=S[`${s}_${m.layerType}`];if(!R)return[];const z=O.match(/^(.*)-use-theme$/);if(z&&R[z[1]])return o.Q(o.S(T))?[].concat(Mn({key:h,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:g,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:O})):Mn({key:h,value:T,valueSpec:{type:"string"},style:g,styleSpec:S});const F=O.match(/^(.*)-transition$/);if(s==="paint"&&F&&R[F[1]]&&R[F[1]].transition)return Mn({key:h,value:T,valueSpec:S.transition,style:g,styleSpec:S});const Z=m.valueSpec||R[O];if(!Z)return[new o.a3(h,T,`unknown property "${O}"`)];let W;if(o.a0(T)&&o.N(Z)&&!Z.tokens&&(W=/^{([^}]+)}$/.exec(T))){const ne=`\`{ "type": "identity", "property": ${W?JSON.stringify(W[1]):'"_"'} }\``;return[new o.V(h,T,`"${O}" does not support interpolation syntax
Use an identity property function instead: ${ne}.`)]}const K=[];if(m.layerType==="symbol")O!=="text-field"||!g||g.glyphs||g.imports||K.push(new o.V(h,T,'use of "text-field" requires a style "glyphs" property')),O==="text-font"&&o.a4(o.S(T))&&o.J(T.type)==="identity"&&K.push(new o.V(h,T,'"text-font" does not support identity functions'));else if(m.layerType==="model"&&s==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&o.N(Z)&&(o.a5(Z)||o.O(Z))){const ne=o.W(o.S(T),Z).value,ee="expression"in ne&&ne.expression||"_styleExpression"in ne&&ne._styleExpression&&ne._styleExpression.expression;ee&&!o.X(ee,["measure-light"])&&(O==="model-emissive-strength"&&o.Y(ee)&&o.Z(ee)||K.push(new o.V(h,T,`${O} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return K.concat(Mn({key:m.key,value:T,valueSpec:Z,style:g,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:O}))}function Ps(m){return Ji(m,"paint")}function ps(m){return Ji(m,"layout")}function qa(m){let s=[];const h=m.value,g=m.key,x=m.style,S=m.styleSpec;if(!o.H(h))return[new o.V(g,h,"object expected")];h.type||h.ref||s.push(new o.V(g,h,'either "type" or "ref" is required'));let T=o.J(h.type);const O=o.J(h.ref);if(h.id){const R=o.J(h.id);for(let z=0;z<m.arrayIndex;z++){const F=x.layers[z];o.J(F.id)===R&&s.push(new o.V(g,h.id,`duplicate layer id "${R}", previously used at line ${F.id.__line__}`))}}if("ref"in h){let R;["type","source","source-layer","filter","layout"].forEach(z=>{z in h&&s.push(new o.V(g,h[z],`"${z}" is prohibited for ref layers`))}),x.layers.forEach(z=>{o.J(z.id)===O&&(R=z)}),R?R.ref?s.push(new o.V(g,h.ref,"ref cannot reference another ref layer")):T=o.J(R.type):typeof O=="string"&&s.push(new o.V(g,h.ref,`ref layer "${O}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(h.source)if(o.a0(h.source)){const R=x.sources&&x.sources[h.source],z=R&&o.J(R.type);R?z==="vector"&&T==="raster"?s.push(new o.V(g,h.source,`layer "${h.id}" requires a raster source`)):z==="raster"&&T!=="raster"?s.push(new o.V(g,h.source,`layer "${h.id}" requires a vector source`)):z!=="vector"||h["source-layer"]?z==="raster-dem"&&T!=="hillshade"?s.push(new o.V(g,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&h.paint&&(h.paint["line-gradient"]||h.paint["line-trim-offset"])&&z==="geojson"&&!R.lineMetrics?s.push(new o.V(g,h,`layer "${h.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&z!=="raster-array"&&s.push(new o.V(g,h.source,`layer "${h.id}" requires a 'raster-array' source.`)):s.push(new o.V(g,h.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new o.V(g,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new o.V(g,h.source,`source "${h.source}" not found`))}else s.push(new o.V(`${g}.source`,h.source,'"source" must be a string'));else s.push(new o.V(g,h,'missing required property "source"'));return s=s.concat(Mo({key:g,value:h,valueSpec:S.layer,style:m.style,styleSpec:m.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Mn({key:`${g}.type`,value:h.type,valueSpec:S.layer.type,style:m.style,styleSpec:m.styleSpec,object:h,objectKey:"type"}),filter:R=>Kn(Object.assign({layerType:T},R)),layout:R=>Mo({layer:h,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":z=>ps(Object.assign({layerType:T},z))}}),paint:R=>Mo({layer:h,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":z=>Ps(Object.assign({layerType:T,layer:h},z))}}),appearances(R){const z=St({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:W=>function(K){const{key:ne,layer:ee,layerType:ie}=K,ce=o.J(K.value),ge=o.J(ce.name),pe=o.J(ce.condition),fe=Mo({key:ne,value:ce,valueSpec:K.styleSpec.appearance,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{condition:Ie=>function(Ee){const Pe=[];return Pe.push(...nr({key:Ee.key,value:Ee.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),Pe}(Object.assign({layer:ee,layerType:ie},Ie)),properties:Ie=>function(Ee){const Pe=[],{styleSpec:be,layer:ve,layerType:ke}=Ee,Ne=be[`paint_${ke}`],$e=be[`layout_${ke}`],Je=Ee.object[Ee.objectKey];for(const Xe in Je){const ht=Xe in Ne?"paint":Xe in $e?"layout":void 0;if(!ht){Pe.push(new o.V(Ee.key,Xe,`unknown property "${Xe}" for layer type "${ke}"`));continue}const vt=Object.assign({},Ee,{key:`${Ee.key}.${Xe}`,object:Je,objectKey:Xe,layer:ve,layerType:ke,value:Je[Xe],valueSpec:ht==="paint"?Ne[Xe]:$e[Xe]});Pe.push(...Ji(vt,ht))}return Pe}(Object.assign({layer:ee,layerType:ie},Ie))}});return ge!=="hidden"&&pe===void 0&&fe.push(new o.V(K.key,"name",'Appearance with name different than "hidden" must have a condition')),fe}(Object.assign({layerType:T,layer:h},W))}),F=Array.isArray(R.value)?R.value:[],Z=new Set;return F.forEach((W,K)=>{const ne=o.J(W.name);if(ne)if(Z.has(ne)){const ee=o.J(h.id);z.push(new o.V(R.key,ne,`Duplicated appearance name "${ne}" for layer "${ee}"`))}else Z.add(ne)}),z}}})),s}function Wo({key:m,value:s}){return o.a0(s)?[]:[new o.V(m,s,`string expected, ${o.K(s)} found`)]}const fo={promoteId:function m({key:s,value:h}){if(o.a0(h))return Wo({key:s,value:h});if(Array.isArray(h)){const x=[],S=o.S(h),T=o.U(S);return T.result==="error"&&T.value.forEach(O=>{x.push(new o.V(`${s}${O.key}`,null,`${O.message}`))}),o.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new o.V(`${s}`,null,"promoteId expression should be only feature dependent")),x}if(!o.H(h))return[new o.V(s,h,`string, expression or object expected, "${o.K(h)}" found`)];const g=[];for(const x in h)g.push(...m({key:`${s}.${x}`,value:h[x]}));return g}};function as(m){const s=m.value,h=m.key,g=m.styleSpec,x=m.style;if(!o.H(s))return[new o.V(h,s,`object expected, ${o.K(s)} found`)];if(!("type"in s))return[new o.V(h,s,'"type" is required')];const S=o.J(s.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(S)&&("url"in s||"tiles"in s||T.push(new o.a3(h,s,'Either "url" or "tiles" is required.'))),S){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Mo({key:h,value:s,valueSpec:g[`source_${S.replace("-","_")}`],style:m.style,styleSpec:g,objectElementValidators:fo})),T;case"geojson":if(T=Mo({key:h,value:s,valueSpec:g.source_geojson,style:x,styleSpec:g,objectElementValidators:fo}),"cluster"in s&&"clusterProperties"in s){if(!o.H(s.clusterProperties))return[new o.V(`${h}.clusterProperties`,s,`object expected, ${o.K(s)} found`)];for(const O in s.clusterProperties){const R=s.clusterProperties[O];if(!Array.isArray(R))return[new o.V(`${h}.clusterProperties.${O}`,R,"array expected")];const[z,F]=R,Z=typeof z=="string"?[z,["accumulated"],["get",O]]:z;T.push(...nr({key:`${h}.${O}.map`,value:F,expressionContext:"cluster-map"})),T.push(...nr({key:`${h}.${O}.reduce`,value:Z,expressionContext:"cluster-reduce"}))}}return T;case"video":return Mo({key:h,value:s,valueSpec:g.source_video,style:x,styleSpec:g});case"image":return Mo({key:h,value:s,valueSpec:g.source_image,style:x,styleSpec:g});case"canvas":return[new o.V(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tn({key:`${h}.type`,value:s.type,valueSpec:{values:Ha(g)}})}}function Ha(m){return m.source.reduce((s,h)=>{const g=m[h];return g.type.type==="enum"&&(s=s.concat(Object.keys(g.type.values||{}))),s},[])}function Wa(m){const s=m.value,h=m.styleSpec,g=h.light,x=m.style;if(s===void 0)return[];if(!o.H(s))return[new o.V("light",s,`object expected, ${o.K(s)} found`)];let S=[];for(const T in s){const O=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);S=S.concat(R&&g[R[1]]?Mn({key:T,value:s[T],valueSpec:{type:"string"},style:x,styleSpec:h}):O&&g[O[1]]&&g[O[1]].transition?Mn({key:T,value:s[T],valueSpec:h.transition,style:x,styleSpec:h}):g[T]?Mn({key:T,value:s[T],valueSpec:g[T],style:x,styleSpec:h}):[new o.V(T,s[T],`unknown property "${T}"`)])}return S}function Tl(m){const s=m.value;if(!s)return[];const h=m.key;if(!o.H(s))return[new o.V(h,s,`object expected, ${o.K(s)} found`)];let g=[];const x=m.styleSpec,S=x["light-3d"],T=m.style,O=m.style.lights;for(const F of["type","id"])if(!(F in s))return g=g.concat([new o.V(h,s,`missing property "${F}"`)]),g;if(!o.a0(s.type))return g=g.concat([new o.V(`${h}.type`,s.type,"string expected")]),g;if(O)for(let F=0;F<m.arrayIndex;F++){const Z=o.J(s.type),W=O[F];o.J(W.type)===Z&&g.push(new o.V(h,s.id,`duplicate light type "${s.type}", previously defined at line ${W.id.__line__}`))}const R=`properties_light_${s.type}`;if(!(R in x))return g=g.concat([new o.V(`${h}.type`,s,`Invalid light type ${s.type}`)]),g;const z=x[R];for(const F in s)if(F==="properties"){const Z=s[F];if(!o.H(Z))return g=g.concat([new o.V("properties",Z,`object expected, ${o.K(Z)} found`)]),g;for(const W in Z){const K=W.match(/^(.*)-transition$/),ne=W.match(/^(.*)-use-theme$/);g=g.concat(ne&&z[ne[1]]?Mn({key:F,value:Z[W],valueSpec:{type:"string"},style:T,styleSpec:x}):K&&z[K[1]]&&z[K[1]].transition?Mn({key:F,value:s[F],valueSpec:x.transition,style:T,styleSpec:x}):z[W]?Mn({key:W,value:Z[W],valueSpec:z[W],style:T,styleSpec:x}):[new o.a3(m.key,Z[W],`unknown property "${W}"`)])}}else g=g.concat(S[F]?Mn({key:F,value:s[F],valueSpec:S[F],style:T,styleSpec:x}):[new o.a3(F,s[F],`unknown property "${F}"`)]);return g}function Ul(m){const s=m.value,h=m.key,g=m.style,x=m.styleSpec,S=x.terrain;if(s==null)return[];if(!o.H(s))return[new o.V("terrain",s,`object expected, ${o.K(s)} found`)];let T=[];for(const O in s){const R=O.match(/^(.*)-transition$/),z=O.match(/^(.*)-use-theme$/);T=T.concat(z&&S[z[1]]?Mn({key:O,value:s[O],valueSpec:{type:"string"},style:g,styleSpec:x}):R&&S[R[1]]&&S[R[1]].transition?Mn({key:O,value:s[O],valueSpec:x.transition,style:g,styleSpec:x}):S[O]?Mn({key:O,value:s[O],valueSpec:S[O],style:g,styleSpec:x}):[new o.a3(O,s[O],`unknown property "${O}"`)])}if(s.source)if(o.a0(s.source)){const O=g.sources&&g.sources[s.source],R=O&&o.J(O.type);O?R!=="raster-dem"&&T.push(new o.V(`${h}.source`,s.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):T.push(new o.V(`${h}.source`,s.source,`source "${s.source}" not found`))}else T.push(new o.V(`${h}.source`,s.source,"source must be a string"));else T.push(new o.V(h,s,'terrain is missing required property "source"'));return T}function gc(m){const s=m.value,h=m.style,g=m.styleSpec,x=g.fog;if(s===void 0)return[];if(!o.H(s))return[new o.V("fog",s,`object expected, ${o.K(s)} found`)];let S=[];for(const T in s){const O=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);S=S.concat(R&&x[R[1]]?Mn({key:T,value:s[T],valueSpec:{type:"string"},style:h,styleSpec:g}):O&&x[O[1]]&&x[O[1]].transition?Mn({key:T,value:s[T],valueSpec:g.transition,style:h,styleSpec:g}):x[T]?Mn({key:T,value:s[T],valueSpec:x[T],style:h,styleSpec:g}):[new o.a3(T,s[T],`unknown property "${T}"`)])}return S}const yc={"*":()=>[],array:St,boolean:function(m){const s=m.value,h=m.key;return o.$(s)?[]:[new o.V(h,s,`boolean expected, ${o.K(s)} found`)]},number:Nt,color:function({key:m,value:s}){return o.a0(s)?o.a1.parseCSSColor(s)===null?[new o.V(m,s,`color expected, "${s}" found`)]:[]:[new o.V(m,s,`color expected, ${o.K(s)} found`)]},enum:Tn,filter:Kn,function:dr,layer:qa,object:Mo,source:as,model:o.a7,light:Wa,"light-3d":Tl,terrain:Ul,fog:gc,string:Wo,formatted:function(m){return Wo(m).length===0?[]:nr(m)},resolvedImage:function(m){return Wo(m).length===0?[]:nr(m)},projection:function(m){const s=m.value,h=m.styleSpec,g=h.projection,x=m.style;if(o.H(s)){let S=[];for(const T in s)S=S.concat(Mn({key:T,value:s[T],valueSpec:g[T],style:x,styleSpec:h}));return S}return o.a0(s)?[]:[new o.V("projection",s,`object or string expected, ${o.K(s)} found`)]},import:function(m){const s=m.key,{value:h,styleSpec:g}=m;if(!o.H(h))return[new o.V(s,h,"import must be an object")];const{data:x,...S}=h;Object.defineProperty(S,"__line__",{value:h.__line__,enumerable:!1});let T=Mo(Object.assign({},m,{value:S,valueSpec:g.import}));return o.J(S.id)===""&&T.push(new o.V(`${m.key}.id`,S,"import id can't be an empty string")),x&&(T=T.concat(si(x,g,{key:`${m.key}.data`}))),T},iconset:function(m){const s=m.value,h=m.key,g=m.styleSpec,x=m.style;if(!o.H(s))return[new o.V(h,s,"object expected")];if(!s.type)return[new o.V(h,s,'"type" is required')];const S=o.J(s.type);let T=[];if(T=T.concat(Mo({key:h,value:s,valueSpec:g[`iconset_${S}`],style:x,styleSpec:g})),function(O,R){return!(O!=="source"||!R.source)}(S,s)){const O=x.sources&&x.sources[s.source],R=O&&o.J(O.type);O?R!=="raster-array"&&T.push(new o.V(h,s.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):T.push(new o.V(h,s.source,`source "${s.source}" not found`))}return T}};function Mn(m,s=!1){const h=m.value,g=m.valueSpec,x=m.styleSpec;if(g.expression){if(o.a4(o.J(h)))return dr(m);if(o.Q(o.S(h)))return nr(m)}if(g.type&&yc[g.type]){const S=yc[g.type](m);return s===!0&&S.length>0&&Array.isArray(m.value)?nr(m):S}return Mo(Object.assign({},m,{valueSpec:g.type?x[g.type]:g}))}function Mo(m){const s=m.key,h=m.value,g=m.valueSpec||{},x=m.objectElementValidators||{},S=m.style,T=m.styleSpec;if(!o.H(h))return[new o.V(s,h,`object expected, ${o.K(h)} found`)];let O=[];for(const R in h){const z=R.split(".")[0];let F;x[z]?F=x[z]:g[z]?F=Mn:x["*"]?F=x["*"]:g["*"]&&(F=Mn),F?O=O.concat(F({key:(s&&`${s}.`)+R,value:h[R],valueSpec:g[z]||g["*"],style:S,styleSpec:T,object:h,objectKey:R},h)):O.push(new o.a3(s,h[R],`unknown property "${R}"`))}for(const R in g){if(x[R])continue;const z=g[R];z.required&&z.default===void 0&&h[R]===void 0&&O.push(new o.V(s,h,`missing required property "${R}"`))}return O}function gn({key:m,value:s}){const h=Wo({key:m,value:s});if(h.length)return h;const g=s;return g.indexOf("{fontstack}")===-1&&h.push(new o.V(m,s,'"glyphs" url must include a "{fontstack}" token')),g.indexOf("{range}")===-1&&h.push(new o.V(m,s,'"glyphs" url must include a "{range}" token')),h}function si(m,s=o.a6,h={}){return Mo({key:h.key||"",value:m,valueSpec:Object.assign(s.$root,{"*":{type:"*"}}),styleSpec:s,style:m,objectElementValidators:{glyphs:gn}})}function Wn(m,s=o.a6){return we(si(m,s))}const aa=m=>we(as(m)),ms=m=>we(Wa(m)),wt=m=>we(Tl(m)),Cs=m=>we(Ul(m)),la=m=>we(gc(m)),Aa=m=>we(function(s){const h=s.value,g=s.style,x=s.styleSpec,S=x.snow;if(h===void 0)return[];if(!o.H(h))return[new o.V("snow",h,`object expected, ${o.K(h)} found`)];let T=[];for(const O in h){const R=O.match(/^(.*)-transition$/);T=T.concat(R&&S[R[1]]&&S[R[1]].transition?Mn({key:O,value:h[O],valueSpec:x.transition,style:g,styleSpec:x}):S[O]?Mn({key:O,value:h[O],valueSpec:S[O],style:g,styleSpec:x}):[new o.a3(O,h[O],`unknown property "${O}"`)])}return T}(m)),an=m=>we(function(s){const h=s.value,g=s.style,x=s.styleSpec,S=x.rain;if(h===void 0)return[];if(!o.H(h))return[new o.V("rain",h,`object expected, ${o.K(h)} found`)];let T=[];for(const O in h){const R=O.match(/^(.*)-transition$/);T=T.concat(R&&S[R[1]]&&S[R[1]].transition?Mn({key:O,value:h[O],valueSpec:x.transition,style:g,styleSpec:x}):S[O]?Mn({key:O,value:h[O],valueSpec:S[O],style:g,styleSpec:x}):[new o.a3(O,h[O],`unknown property "${O}"`)])}return T}(m)),Be=m=>we(qa(m)),se=m=>we(Kn(m)),he=m=>we(Ps(m)),xe=m=>we(ps(m)),Le=m=>we(o.a7(m));function we(m){return m.slice().sort((s,h)=>s.line&&h.line?s.line-h.line:0)}function je(m,s){let h=!1;if(s&&s.length)for(const g of s)g instanceof o.a3?o.w(g.message):(m.fire(new o.y(new Error(g.message))),h=!0);return h}const Ye=o.a6.light;let ze;class tt extends o.E{constructor(s,h="flat"){super(),this._transitionable=new o.a8(ze||(ze=new o.a9({anchor:new o.aa(Ye.anchor),position:new o.ab(Ye.position),color:new o.aa(Ye.color),intensity:new o.aa(Ye.intensity)}))),this.setLight(s,h),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h,g={}){this._validate(ms,s,g)||(this._transitionable.setTransitionOrValue(s),this.id=h)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&je(this,s.call(Wn,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const Tt=o.a6.terrain;let xt=class extends o.E{constructor(m,s,h,g,x){super(),this.scope=h,this._transitionable=new o.a8(new o.a9({source:new o.aa(Tt.source),exaggeration:new o.aa(Tt.exaggeration)}),h,g),this._transitionable.setTransitionOrValue(m,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=x}get(){return this._transitionable.serialize()}set(m,s){this._transitionable.setTransitionOrValue(m,s)}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}getExaggeration(m){return this._transitioning.possiblyEvaluate(new o.ac(m,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const m=this._transitionable._values.exaggeration;if(!m)return null;const s=m.value.expression;if(!s)return null;let h=-1,g=-1,x=1;for(const S of s.zoomStops)x=s.evaluate(new o.ac(S,{worldview:this.worldview})),x>.01?(h=S,g=-1):g=S;return x<.01&&h>0&&g>h?[h,g]:null}isZoomDependent(){const m=this._transitionable._values.exaggeration;return m!=null&&m.value!=null&&m.value.expression!=null&&m.value.expression instanceof o.ad}};const qt=.05;function ar(m,s,h,g){const x=o.ah(45,65,h),[S,T]=pr(m,g);let O=1-Math.min(1,Math.exp((s-S)/(T-S)*-6));return O*=O*O,O=Math.min(1,1.00747*O),O*x*m.alpha}function pr(m,s){const h=.5/Math.tan(.5*s);return[m.range[0]+h,m.range[1]+h]}function Or(m,s,h,g,x){const S=o.af([],[s,h,g],x.mercatorFogMatrix);return ar(m,o.ag(S),x.pitch,x._fov)}function Br(m,s,h,g,x,S,T){const O=[[h,g,0],[x,g,0],[x,S,0],[h,S,0]];let R=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const F of O){const Z=o.af([],F,s),W=o.ag(Z);R=Math.min(R,W),z=Math.max(z,W)}return[ar(m,R,T.pitch,T._fov),ar(m,z,T.pitch,T._fov)]}const Sr=o.a6.fog;class vr extends o.E{constructor(s,h,g,x){super();const S=new o.a9({range:new o.aa(Sr.range),color:new o.aa(Sr.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(Sr["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(Sr["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(Sr["horizon-blend"]),"star-intensity":new o.aa(Sr["star-intensity"]),"vertical-range":new o.aa(Sr["vertical-range"])});this._transitionable=new o.a8(S,g,new Map(x)),this.set(s,x),this._transitioning=this._transitionable.untransitioned(),this._transform=h,this.properties=new o.ai(S),this.scope=g}get state(){const s=this._transform,h=s.projection.name==="globe",g=o.aj(s.zoom),x=this.properties.get("range"),S=[.5,3];return{range:h?[o.ak(S[0],x[0],g),o.ak(S[1],x[1],g)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,h,g={}){if(this._validate(la,s,g))return;const x=Object.assign({},s);for(const S of Object.keys(Sr))x[S]===void 0&&(x[S]=Sr[S].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,h)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(45,65,s))*h.a}getOpacityAtLatLng(s,h){return this._transform.projection.supportsFog?function(g,x,S){const T=o.ae.fromLngLat(x),O=S.elevation?S.elevation.getAtPointOrZero(T):0;return Or(g,T.x,T.y,O,S)}(this.state,s,h):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const h=this._transform.calculateFogTileMatrix(s.toUnwrapped());return Br(this.state,h,0,0,o.al,o.al,this._transform)}getOpacityForBounds(s,h,g,x,S){return this._transform.projection.supportsFog?Br(this.state,s,h,g,x,S,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?pr(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const h=[4,5,6,7];for(const g of h){const x=s.points[g];let S;if(x[2]>=0)S=x;else{const T=s.points[g-4];S=o.am(T,x,T[2]/(T[2]-x[2]))}if(Or(this.state,S[0],S[1],0,this._transform)>=qt)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&je(this,s.call(Wn,Object.assign({value:h,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Yn,no,ki,Ri=class extends o.E{constructor(m,s,h,g){super();const x=Yn||(Yn=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(x,h,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(x),this.scope=h}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),h=this.properties.get("direction"),g=o.an(h[0]),x=-Math.max(o.an(h[1]),.01),S=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette"),O=this.properties.get("vignette-color");return O.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(s.r,s.g,s.b,s.a*m),direction:S,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:O}}get(){return this._transitionable.serialize()}set(m,s,h={}){if(this._validate(Aa,m,h))return;const g=Object.assign({},m),x=o.a6.snow;for(const S of Object.keys(x))g[S]===void 0&&(g[S]=x[S].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,h){return(!h||h.validate!==!1)&&je(this,m.call(Wn,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},ui=class extends o.E{constructor(m,s,h,g){super();const x=no||(no=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(x,h,new Map(g)),this.set(m,g),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(x),this.scope=h}get state(){const m=this.properties.get("opacity"),s=this.properties.get("color"),h=this.properties.get("direction"),g=o.an(h[0]),x=-Math.max(o.an(h[1]),.01),S=[Math.cos(g)*Math.cos(x),Math.sin(g)*Math.cos(x),Math.sin(x)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(s.r,s.g,s.b,s.a*m),direction:S,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(m,s,h={}){if(this._validate(an,m,h))return;const g=Object.assign({},m),x=o.a6.rain;for(const S of Object.keys(x))g[S]===void 0&&(g[S]=x[S].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(m){this._transitionable.setTransitionOrValue(this._options,new Map(m))}updateTransitions(m){this._transitioning=this._transitionable.transitioned(m,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(m){this.properties=this._transitioning.possiblyEvaluate(m)}_validate(m,s,h){return(!h||h.validate!==!1)&&je(this,m.call(Wn,Object.assign({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class on extends o.E{constructor(s,h,g,x){super(),this.scope=g,this._options=s,this.properties=new o.ai(h),this._transitionable=new o.a8(h,g,new Map(x)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,h){this._options=s,this._transitionable.setTransitionOrValue(s.properties,h)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const pi=()=>ki||(ki=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)}));let Bn;const $n=()=>Bn||(Bn=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new o.aa(o.a6.properties_light_directional["shadow-draw-before-layer"])}));class Ai{constructor(s,h,g){this.screenBounds=s,this.cameraPoint=g.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,g)}static createFromScreenPoints(s,h){let g,x;if(s instanceof o.P||typeof s[0]=="number"){const S=o.P.convert(s);g=[S],x=h.isPointAboveHorizon(S)}else{const S=o.P.convert(s[0]),T=o.P.convert(s[1]),O=S.add(T)._div(2);g=[S,T],x=o.aq(S,T).every(R=>h.isPointAboveHorizon(R))&&h.isPointAboveHorizon(O)}return new Ai(g,x,h)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.aq(h,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<g.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?x[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(x[3]=this.cameraPoint)),o.ar(x,s)}bufferedCameraGeometryGlobe(s){const h=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.aq(h,g,s),S=this.cameraPoint.clone();switch(3*((S.y>h.y)+(S.y>g.y))+((S.x>h.x)+(S.x>g.x))){case 0:x[0]=S,x[4]=S.clone();break;case 1:x.splice(1,0,S);break;case 2:x[1]=S;break;case 3:x.splice(4,0,S);break;case 5:x.splice(2,0,S);break;case 6:x[3]=S;break;case 7:x.splice(3,0,S);break;case 8:x[2]=S}return x}containsTile(s,h,g,x=0){const S=Math.max(s.queryPadding,s.evaluateQueryRenderedFeaturePadding())/h._pixelsPerMercatorPixel+1,T=g?this._bufferedCameraMercator(S,h):this._bufferedScreenMercator(S,h);let O=s.tileID.wrap+(T.unwrapped?x:0);const R=T.polygon.map(ie=>o.as(s.tileTransform,ie,O));if(!o.at(R,0,0,o.al,o.al))return;O=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map(ie=>o.au(s.tileTransform,ie,O)),F=z.map(ie=>new o.P(ie[0],ie[1])),Z=h.getFreeCameraOptions().position||new o.ae(0,0,0),W=o.au(s.tileTransform,Z,O),K=z.map(ie=>{const ce=o.av(ie,ie,W);return o.aw(ce,ce),new o.ax(W,ce)}),ne=o.ay(s,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:K,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ee=o.az(R),ee.min.x=o.aA(ee.min.x,0,o.al),ee.min.y=o.aA(ee.min.y,0,o.al),ee.max.x=o.aA(ee.max.x,0,o.al),ee.max.y=o.aA(ee.max.y,0,o.al),ee),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:ne};var ee}_bufferedScreenMercator(s,h){const g=po(s);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let x;return x=h.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),h):{polygon:this.bufferedScreenGeometry(s).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[g]=x,x}}_bufferedCameraMercator(s,h){const g=po(s);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let x;return x=h.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),h):{polygon:this.bufferedCameraGeometry(s).map(S=>h.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[g]=x,x}}_projectAndResample(s,h){const g=function(S,T){const O=o.aB([],T.pixelMatrix,T.globeMatrix),R=[0,-o.aD,0,1],z=[0,o.aD,0,1],F=[0,0,0,1];o.aC(R,R,O),o.aC(z,z,O),o.aC(F,F,O);const Z=new o.P(R[0]/R[3],R[1]/R[3]),W=new o.P(z[0]/z[3],z[1]/z[3]),K=o.aE(S,Z)&&R[3]<F[3],ne=o.aE(S,W)&&z[3]<F[3];if(!K&&!ne)return null;const ee=function(Pe,be,ve){for(let ke=1;ke<Pe.length;ke++){const Ne=Zo(be.pointCoordinate3D(Pe[ke-1]).x),$e=Zo(be.pointCoordinate3D(Pe[ke]).x);if(ve<0){if(Ne<$e)return{idx:ke,t:-Ne/($e-1-Ne)}}else if($e<Ne)return{idx:ke,t:(1-Ne)/($e+1-Ne)}}return null}(S,T,K?-1:1);if(!ee)return null;const{idx:ie,t:ce}=ee;let ge=ie>1?ls(S.slice(0,ie),T):[],pe=ie<S.length?ls(S.slice(ie),T):[];ge=ge.map(Pe=>new o.P(Zo(Pe.x),Pe.y)),pe=pe.map(Pe=>new o.P(Zo(Pe.x),Pe.y));const fe=[...ge];fe.length===0&&fe.push(pe[pe.length-1]);const Ie=o.ak(fe[fe.length-1].y,(pe.length===0?ge[0]:pe[0]).y,ce);let Ee;return Ee=K?[new o.P(0,Ie),new o.P(0,0),new o.P(1,0),new o.P(1,Ie)]:[new o.P(1,Ie),new o.P(1,1),new o.P(0,1),new o.P(0,Ie)],fe.push(...Ee),pe.length===0?fe.push(ge[0]):fe.push(...pe),{polygon:fe.map(Pe=>new o.ae(Pe.x,Pe.y)),unwrapped:!1}}(s,h);if(g)return g;const x=function(S,T){let O=!1,R=-1/0,z=0;for(let Z=0;Z<S.length-1;Z++)S[Z].x>R&&(R=S[Z].x,z=Z);for(let Z=0;Z<S.length-1;Z++){const W=(z+Z)%(S.length-1),K=S[W],ne=S[W+1];Math.abs(K.x-ne.x)>.5&&(K.x<ne.x?(K.x+=1,W===0&&(S[S.length-1].x+=1)):(ne.x+=1,W+1===S.length-1&&(S[0].x+=1)),O=!0)}const F=o.aF(T.center.lng);return O&&F<Math.abs(F-1)&&S.forEach(Z=>{Z.x-=1}),{polygon:S,unwrapped:O}}(ls(s,h).map(S=>new o.P(Zo(S.x),S.y)),h);return{polygon:x.polygon.map(S=>new o.ae(S.x,S.y)),unwrapped:x.unwrapped}}}function ls(m,s){return o.aG(m,h=>{const g=s.pointCoordinate3D(h);h.x=g.x,h.y=g.y},1/256)}function Zo(m){return m<0?1+m%1:m%1}function po(m){return 100*m|0}function Ku(m,s,h,g,x){const S=function(O,R){if(O)return x(O);if(R){if(m.url&&R.tiles&&m.tiles&&delete m.tiles,R.variants){if(!Array.isArray(R.variants))return x(new Error("variants must be an array"));for(const F of R.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return x(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){R=Object.assign(R,F);break}}}const z=o.aH(Object.assign({},R,m),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=s.canonicalizeTileset(z,m.url),x(null,z)}},T=function(O,R,z){if(!O)return null;if(!R&&!z)return O;z=z||O.worldview_default;const F=Object.values(O.language||{});if(F.length===0)return null;const Z=Object.values(O.worldview||{});if(Z.length===0)return null;const W=F.every(ne=>ne===R),K=Z.every(ne=>ne===z);return W&&K?O:R in(O.language_options||{})||z in(O.worldview_options||{})?null:O.language_options&&O.worldview_options?O:null}(m.data,h,g);return T?o.o.frame(()=>S(null,T)):m.url?o.m(s.transformRequest(s.normalizeSourceURL(m.url,null,h,g),o.R.Source),S):o.o.frame(()=>{const{data:O,...R}=m;S(null,R)})}function Is(m,s){const h=Math.pow(2,s.z),g=Math.floor(o.aF(m.getWest())*h),x=Math.floor(o.aJ(m.getNorth())*h),S=Math.ceil(o.aF(m.getEast())*h),T=Math.ceil(o.aJ(m.getSouth())*h);return s.x>=g&&s.x<S&&s.y>=x&&s.y<T}class Pa{constructor(s,h,g){this.bounds=s?o.aI.convert(this.validateBounds(s)):null,this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const h of s)this.extraBounds.push(o.aI.convert(this.validateBounds(h)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!Is(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const h of this.extraBounds)if(Is(h,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const h=new Pa(s.bounds,s.minzoom,s.maxzoom);return h.addExtraBounds(s.extra_bounds),h}}class El extends o.E{constructor(s,h,g,x){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(h,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},h),this._collectResourceTiming=!!h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.aK}load(s){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const h=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map.getWorldview();this._tileJSONRequest=Ku(this._options,this.map._requestManager,h,g,(x,S)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)h&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${h}`),g&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new o.y(x));else if(S){if(Object.assign(this,S),this.hasWorldviews=!!S.worldview_options,S.worldview_default&&(this.worldviewDefault=S.worldview_default),S.vector_layers){this.vectorLayers=S.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of S.vector_layers)this.vectorLayerIds.push(T.id),S.worldview&&S.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=Pa.fromTileJSON(S),$t(S.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}s&&s(x)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(s,h){const g=s.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(g),S=this.map._requestManager.transformRequest(x,o.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,O=T?{image:T.image.clone()}:null,R={request:S,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:O,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&o.h(g)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=h:s.request=s.actor.send("reloadTile",R,z.bind(this));else if(s.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",R,z.bind(this),void 0,!0);else{const F=o.aL.call({deduped:this._deduped},R,(Z,W)=>{if(Z||!W)z.call(this,Z);else{const K=o.aM(W.responseHeaders);R.data={rawData:W.rawData.slice(0),expires:K.expires,cacheControl:K.cacheControl},s.actor&&s.actor.send("loadTile",R,z.bind(this),void 0,!0)}},!0);s.request={cancel:F}}function z(F,Z){return delete s.request,s.aborted?h(null):F&&F instanceof o.aN&&F.status!==404?h(F):(Z&&Z.resourceTiming&&(s.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&s.setExpiryData(Z),s.loadVectorData(Z,this.map.painter),o.aO(this.dispatcher),h(null,Z),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Gl extends o.E{constructor(s,h,g,x){super(),this.id=s,this.dispatcher=g,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},h),Object.assign(this,o.aH(h,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const h=this.map.getWorldview();this._tileJSONRequest=Ku(this._options,this.map._requestManager,null,h,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?this.fire(new o.y(g)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map(S=>S.id)),this.tileBounds=Pa.fromTileJSON(x),$t(x.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),s&&s(g)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,h){const g=o.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);s.request=o.n(this.map._requestManager.transformRequest(x,o.R.Tile),(S,T,O)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(S)return s.state="errored",h(S);if(!T)return h(null);const R=o.aM(O);this.map._refreshExpiredTiles&&s.setExpiryData(R),s.setTexture(T,this.map.painter),s.state="loaded",o.aO(this.dispatcher),h(null)})}abortTile(s,h){s.request&&(s.request.cancel(),delete s.request),h&&h()}unloadTile(s,h){s.texture&&s.texture instanceof o.T?(s.destroy(!1),s.texture&&s.texture instanceof o.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),h&&h()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ca([m,s],h,g,{scaled:x=!0}={}){const{tileSize:S,buffer:T}=g,{x:O,y:R,z}=h;if(!isFinite(O)||!isFinite(R)||!isFinite(z))throw new Error("Invalid MRT header");const F=2**z,Z=F*o.aF(m),W=F*o.aJ(s);return function([K,ne],ee,{scaled:ie=!0}={}){if(!ee)throw new Error("bandView is undefined");const{data:ce,tileSize:ge,buffer:pe,offset:fe,scale:Ie,dimension:Ee}=ee;if(K<-pe||K>ge+pe||ne<-pe||ne>ge+pe)throw new Error(`Point (${K}, ${ne}) out of bounds for tileSize=${ge}, buffer=${pe}`);const Pe=(ne+pe)*(ge+2*pe)+(K+pe);if(new Uint32Array(ce.buffer)[Pe]===4294967295)return null;let be=[];be=ie?[]:new ee.data.constructor(Ee);for(let ve=0;ve<Ee;ve++)be[ve]=Math.round(1e12*(ce[Ee*Pe+ve]*Ie+fe))/1e12;return be}([Math.min(Math.max(-T,Math.floor((Z-O)*S)),S-1+T),Math.min(Math.max(-T,Math.floor((W-R)*S)),S-1+T)],g,{scaled:x})}class qs extends Gl{constructor(s,h,g,x){super(s,h,g,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},h)}triggerRepaint(s){const h=this.map.painter._terrain,g=this.map.style.getSourceCache(this.id);h&&h.enabled&&g&&h._clearRenderCacheForTile(g.id,s.tileID),this.map.triggerRepaint()}loadTile(s,h){const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(g,o.R.Tile),S={request:x,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=x,s.actor||(s.actor=this.dispatcher.getActor());const T=(O,R,z)=>{if(delete s.request,s.aborted)return s.state="unloaded",h(null);if(O)return O.name==="AbortError"?void 0:(s.state="errored",h(O));if(this.map._refreshExpiredTiles&&R){const F=o.aM(z);s.setExpiryData(F)}if(this.partial&&s.state!=="expired")s.state="empty";else if(!this.partial){if(!R)return h(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=R}h(null)};s.request=this.partial?s.fetchHeader(void 0,T.bind(this)):s.actor.send("loadTile",S,T.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,h){const g=s.texturePerLayer;if(s.flushAllQueues(),g.size){s.destroy(!1);for(const x of g.values())this.map.painter.saveTileTexture(x)}else s.destroy()}prepareTile(s,h,g,x){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBandForRender(h,g,x,(S,T)=>{if(S)return s.state="errored",this.fire(new o.y(S)),void this.triggerRepaint(s);T&&(s._isHeaderLoaded=!0,s.setTexturePerLayer(g,T,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const h=this.rasterLayers.find(({id:S})=>S===s),g=h&&h.fields,x=g&&g.bands&&g.bands;return x?x[0]:0}getTextureDescriptor(s,h,g){if(!s)return;const x=h.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let S=null;h instanceof o.aR?S=h.paint.get("raster-array-band"):h instanceof o.aS&&(S=h.paint.get("raster-particle-array-band"));const T=S||this.getInitialBand(x);if(T==null)return;if(!s.textureDescriptorPerLayer.get(h.id))return void this.prepareTile(s,x,h.id,T);if(s.updateNeeded(h.id,T)&&!g)return;const O=s.textureDescriptorPerLayer.get(h.id);return Object.assign({},O,{texture:s.texturePerLayer.get(h.id)})}getImages(s,h){const g=new Map;for(const x of s)for(const S of h){const[T,O]=S.split("/"),R=x.getLayer(T);if(!R||!R.hasBand(O)||!R.hasDataForBand(O))continue;const{bytes:z,tileSize:F,buffer:Z}=R.getBandView(O),W=F+2*Z,K={data:new o.q({width:W,height:W},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};g.set(S,K)}return g}queryRasterArrayValueByBandId(s,h,g){const x=h._mrt;return new Promise(S=>{const T={},O=new Set;for(const[R,z]of Object.entries(x.layers)){if(g.layerName&&R!==g.layerName)continue;const F={};T[R]=F;for(const{bands:Z}of z.dataIndex)for(const W of Z)g.bands&&!g.bands.includes(W)||(O.add(o.B(R,W)),h.fetchBand(R,null,W,K=>{o.o.frame(()=>{F[W]=K?null:Ca([s.lng,s.lat],x,z.getBandView(W)),O.delete(o.B(R,W)),O.size===0&&S(T)})},!1))}O.size===0&&S(T)})}_loadTileForQuery(s,h){if(this._loadTileLoaded[s.uid])return void h(null,s._mrt);if(this._loadTilePending[s.uid])return void this._loadTilePending[s.uid].push(h);this._loadTilePending[s.uid]=[h];const g=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(g,o.R.Tile);s.actor.send("loadTile",{request:x,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(S,T,O)=>{if(S)return this._loadTilePending[s.uid].forEach(R=>R(S,null)),void delete this._loadTilePending[s.uid];if(!T)return this._loadTilePending[s.uid].forEach(R=>R(null,null)),void delete this._loadTilePending[s.uid];if(this.map._refreshExpiredTiles&&T){const R=o.aM(O);s.setExpiryData(R)}s._mrt=T,s._isHeaderLoaded=!0,s.state="loaded",this._loadTilePending[s.uid].forEach(R=>R(null,T)),this._loadTileLoaded[s.uid]=!0,delete this._loadTilePending[s.uid]},void 0,!0)}queryRasterArrayValueByAllBands(s,h,g){return new Promise((x,S)=>{this._loadTileForQuery(h,(T,O)=>{T?S(T):x(O?this.queryRasterArrayValueByBandId(s,h,g):null)})})}queryRasterArrayValue(s,h){const g=o.aT.convert(s),x=this.findLoadedParent(g);return x&&x._mrt?h.bands||!this.partial?this.queryRasterArrayValueByBandId(g,x,h):this.queryRasterArrayValueByAllBands(g,x,h):Promise.resolve(null)}findLoadedParent(s){const h=o.ae.fromLngLat(s,this.map.transform.tileSize),g=this.maxzoom+1,x=1<<g,S=Math.floor(h.x),T=Math.floor((h.x-S)*x),O=Math.floor(h.y*x),R=this.map.style.getSourceCache(this.id),z=new o.aQ(g,S,g,T,O);return R.findLoadedParent(z,this.minzoom)}}const ou={vector:El,raster:Gl,"raster-dem":class extends Gl{constructor(m,s,h,g){super(m,s,h,g),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(m,s){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(x,S){x&&(m.state="errored",s(x)),S&&(m.dem=S,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",s(null))}m.request=o.n(this.map._requestManager.transformRequest(h,o.R.Tile),(function(x,S,T){if(delete m.request,m.aborted)m.state="unloaded",s(null);else if(x)m.state="errored",s(x);else if(S){const O=o.aM(T);this.map._refreshExpiredTiles&&m.setExpiryData(O);const R=ImageBitmap&&S instanceof ImageBitmap&&o.r(),z=1-(S.width-o.aP(S.width))/2;z<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const F=R?S:o.o.getImageData(S,z),Z={uid:m.uid,tileID:m.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:z};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadTile",Z,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(m){const s=m.canonical,h=Math.pow(2,s.z),g=(s.x-1+h)%h,x=s.x===0?m.wrap-1:m.wrap,S=(s.x+1+h)%h,T=s.x+1===h?m.wrap+1:m.wrap,O={};return O[new o.aQ(m.overscaledZ,x,s.z,g,s.y).key]={backfilled:!1},O[new o.aQ(m.overscaledZ,T,s.z,S,s.y).key]={backfilled:!1},s.y>0&&(O[new o.aQ(m.overscaledZ,x,s.z,g,s.y-1).key]={backfilled:!1},O[new o.aQ(m.overscaledZ,m.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},O[new o.aQ(m.overscaledZ,T,s.z,S,s.y-1).key]={backfilled:!1}),s.y+1<h&&(O[new o.aQ(m.overscaledZ,x,s.z,g,s.y+1).key]={backfilled:!1},O[new o.aQ(m.overscaledZ,m.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},O[new o.aQ(m.overscaledZ,T,s.z,S,s.y+1).key]={backfilled:!1}),O}},"raster-array":qs,geojson:class extends o.E{constructor(m,s,h,g){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(g),this._data=s.data,this._options=Object.assign({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const x=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*x,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*x,extent:o.al,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.al,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*x,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}updateData(m){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof m!="string"&&(m.type==="Feature"&&(m={type:"FeatureCollection",features:[m]}),m.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof m!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const h of this._data.features)s.set(h.id,h);for(const h of m.features)s.set(h.id,h);this._data.features=[...s.values()]}else this._data=m;return this._updateWorkerData(!0),this}getClusterExpansionZoom(m,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterChildren(m,s){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id,scope:this.scope},s),this}getClusterLeaves(m,s,h,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:m,limit:s,offset:h},g),this}_updateWorkerData(m=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const s=Object.assign({append:m},this.workerOptions);s.scope=this.scope;const h=this._data;typeof h=="string"?(s.request=this.map._requestManager.transformRequest(o.o.resolveURL(h),o.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(h),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(g,x)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new o.y(g));else{const S={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(S.resourceTiming=x.resourceTiming[this.id]),m&&(this._partialReload=!0),this.fire(new o.z("data",S)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(m),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const m=o.B(this.id,this.scope);this.map.style.clearSource(m),this._updateWorkerData()}loadTile(m,s){const h=m.actor?"reloadTile":"loadTile";m.actor=this.actor;const g=this.map.style?this.map.style.getLut(this.scope):null,x=g?{image:g.image.clone()}:null,S=this._partialReload,T={type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:m.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:S,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};m.request=this.actor.send(h,T,(O,R)=>S&&!R?(m.state="loaded",s(null)):(delete m.request,m.destroy(!1),m.aborted?s(null):O?s(O):(m.loadVectorData(R,this.map.painter,h==="reloadTile"),s(null))),void 0,h==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m,s){this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id,scope:this.scope}),m.destroy()}onRemove(m){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aU{constructor(m,s,h,g){super(m,s,h,g),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const s of m.urls)this.urls.push(this.map._requestManager.transformRequest(s,o.R.Source).url);o.aV(this.urls,(s,h)=>{this._loaded=!0,s?this.fire(new o.y(s)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const s=this.video.seekable;m<s.start(0)||m>s.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,s=m.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(m,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aU,model:o.aX,"batched-model":class extends o.E{constructor(m,s,h,g){super(),this.type="batched-model",this.id=m,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=h,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(m){this.map=m,this.load()}reload(){this.cancelTileJSONRequest();const m=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(m))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(m){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Ku(this._options,this.map._requestManager,s,h,(g,x)=>{this._tileJSONRequest=null,this._loaded=!0,g?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new o.y(g))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Pa(x.bounds,this.minzoom,this.maxzoom)),$t(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),m&&m(g)})}hasTransition(){return!1}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}loaded(){return this._loaded}loadTile(m,s){const h=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(h,o.R.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:m.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(m.actor&&m.state!=="expired")if(m.state==="loading")m.reloadCallback=s;else{if(m.buckets){const S=Object.values(m.buckets);for(const T of S)T.dirty=!0;return void(m.state="loaded")}m.request=m.actor.send("reloadTile",g,x.bind(this))}else m.actor=this.dispatcher.getActor(),m.request=m.actor.send("loadTile",g,x.bind(this),void 0,!0);function x(S,T){return m.aborted?s(null):S&&S.status!==404?s(S):(this.map._refreshExpiredTiles&&T&&m.setExpiryData(T),m.loadModelData(T,this.map.painter),m.state="loaded",void s(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aU{constructor(m,s,h,g){super(m,s,h,g),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(S=>typeof S!="number"))||this.fire(new o.y(new o.V(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${m}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${m}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(m){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!m&&!this._playing||this.texture instanceof o.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends o.E{constructor(m,s,h,g){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=s,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Pa(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this.map=m,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:s,y:h,z:g}=m.canonical;return this._implementation.hasTile({x:s,y:h,z:g})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,s){const{x:h,y:g,z:x}=m.tileID.canonical,S=new AbortController;m.request=Promise.resolve(this._implementation.loadTile({x:h,y:g,z:x},{signal:S.signal})).then((function(T){return delete m.request,m.aborted?(m.state="unloaded",s(null)):T===void 0?(m.state="errored",s(null)):T===null?(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",s(null)):function(O){return O instanceof ImageData||O instanceof HTMLCanvasElement||O instanceof ImageBitmap||O instanceof HTMLImageElement}(T)?(this.loadTileData(m,T),m.state="loaded",void s(null)):(m.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(m.state="errored",s(T))}),m.request.cancel=()=>S.abort()}loadTileData(m,s){m.setTexture(s,this.map.painter)}unloadTile(m,s){if(m.texture&&m.texture instanceof o.T?(m.destroy(!1),m.texture&&m.texture instanceof o.T&&this.map.painter.saveTileTexture(m.texture)):m.destroy(),this._implementation.unloadTile){const{x:h,y:g,z:x}=m.tileID.canonical;this._implementation.unloadTile({x:h,y:g,z:x})}s&&s()}abortTile(m,s){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_clearTiles(){const m=o.B(this.id,this.scope);this.map.style.clearSource(m)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},Yd=function(m,s,h,g){const x=new ou[s.type](m,s,h,g);if(x.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${x.id}`);return o.aY(["load","abort","unload","serialize","prepare"],x),x};function Za(m,s,h=""){return`${h}:${s.id||""}:${s.layer.id}:${function(g){if("layerId"in g)return`layer:${g.layerId}`;{const{featuresetId:x,importId:S}=g;return`featureset:${x}${S?`:import:${S}`:""}`}}(m.target)}`}function um(m,s,h,g=""){if(m.uniqueFeatureID){const x=Za(m,s,g);if(h.has(x))return!0;h.add(x)}return!1}function dm(m,s,h,g,x=!1,S=void 0){const T=s.sourceCache.transform,O=s.sourceCache.tilesIn(m,s.has3DLayers,x);O.sort(Lx);const R=[];for(const z of O){const F=z.tile.queryRenderedFeatures(s,z,h,g,T,x,S);Object.keys(F).length&&R.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:F})}for(const z in s.layers){const F=s.layers[z];if(F.styleLayer){const Z=F.styleLayer.queryRenderedFeatures(m,s.sourceCache,g);Object.keys(Z).length&&R.push({wrappedTileID:0,queryResults:Z})}}return R.length===0?{}:function(z){const F={},Z={};for(const W of z){const K=W.queryResults,ne=W.wrappedTileID,ee=Z[ne]=Z[ne]||{};for(const ie in K){const ce=K[ie],ge=ee[ie]=ee[ie]||{},pe=F[ie]=F[ie]||[];for(const fe of ce)ge[fe.featureIndex]||(ge[fe.featureIndex]=!0,pe.push(fe))}}return F}(R)}function dE(m,s,h,g,x,S){const T={},O=g.queryRenderedSymbols(m),R=[];for(const z of Object.keys(O).map(Number))R.push(x[z]);R.sort(Lx);for(const z of R){const F=z.featureIndex.lookupSymbolFeatures(O[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,s,h,S);for(const Z in F){const W=T[Z]=T[Z]||[],K=F[Z];K.sort((ne,ee)=>{const ie=z.featureSortOrder;if(ie){const ce=ie.indexOf(ne.featureIndex);return ie.indexOf(ee.featureIndex)-ce}return ee.featureIndex-ne.featureIndex});for(const ne of K)W.push(ne)}}return T}function hE(m,s){const h=m.getRenderableIds().map(S=>m.getTileByID(S)),g=[],x={};for(let S=0;S<h.length;S++){const T=h[S],O=T.tileID.canonical.key;x[O]||(x[O]=!0,T.querySourceFeatures(g,s))}return g}function Lx(m,s){const h=m.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function jx(m,s){const h={};if(!s)return h;for(const g of m){const x=g.layerIds.map(S=>s.getLayer(S)).filter(Boolean);if(x.length!==0){g.layers=x,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(S=>x.filter(T=>T.id===S)[0]));for(const S of x)h[S.fqid]=g}}return h}const Xo=32,Xa=33,su=new Uint16Array(8184);for(let m=0;m<2046;m++){let s=m+2,h=0,g=0,x=0,S=0,T=0,O=0;for(1&s?x=S=T=Xo:h=g=O=Xo;(s>>=1)>1;){const z=h+x>>1,F=g+S>>1;1&s?(x=h,S=g,h=T,g=O):(h=x,g=S,x=T,S=O),T=z,O=F}const R=4*m;su[R+0]=h,su[R+1]=g,su[R+2]=x,su[R+3]=S}const Ka=new Uint16Array(2178),_c=new Uint8Array(1089),hf=new Uint16Array(1089);function ff(m){return m===0?-.03125:m===32?.03125:0}const Jd={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class Yu{constructor(s,h,g,x,S,T){this.tileID=s,this.uid=o.b2(),this.uses=0,this.tileSize=h,this.tileZoom=g,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=S,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(s){const h=s+this.timeAdded;h<o.o.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,h,g){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=jx(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const S=this.buckets[x];if(S instanceof o.b4){if(this.hasSymbolBuckets=!0,!g)break;S.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const S=this.buckets[x];if(S instanceof o.b4&&S.hasRTLText){this.hasRTLText=!0,o.b5();break}}this.queryPadding=0;for(const x in this.buckets){const S=this.buckets[x],T=h.style.getOwnLayer(x);if(!T)continue;const O=T.queryRadius(S);this.queryPadding=Math.max(this.queryPadding,O)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new o.b3}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,h,g){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,jx(s.buckets,h.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s,h){for(const S in this.buckets){const T=this.buckets[S];if(T.uploadPending()){let O={},R=[],z={zoom:0,pitch:0,brightness:0,worldview:""};if(h){if(h.style){R=h.style.listImages();const F=T.layers[0],Z=F.sourceLayer||"_geojsonTileLayer",W=h.style.getLayerSourceCache(F);W&&(O=W._state.getState(Z,void 0))}z={zoom:h.transform.zoom||0,pitch:h.transform.pitch||0,brightness:h.style.getBrightness()||0,worldview:h.worldview||""}}T.upload(s,this.tileID.canonical,O,R,z)}}const g=s.gl,x=this.imageAtlas;x&&!x.uploaded&&(this.imageAtlasTexture=new o.T(s,x.image,g.RGBA8,{useMipmap:!!x.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(s,this.glyphAtlasImage,g.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(s,this.lineAtlas.image,g.R8),this.lineAtlas.uploaded=!0)}prepare(s,h,g){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,g),!h||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=h.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(h)),(this._lastUpdatedBrightness||x||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(h,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}evaluateQueryRenderedFeaturePadding(){let s=0;for(const h in this.buckets){const g=this.buckets[h];g.evaluateQueryRenderedFeaturePadding&&(s=Math.max(s,g.evaluateQueryRenderedFeaturePadding()))}return s}queryRenderedFeatures(s,h,g,x,S,T,O){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const R=this.evaluateQueryRenderedFeaturePadding(),z=function(F,Z){const W=o.bq([],[.5*F.width,.5*-F.height,1]);return o.br(W,W,[1,-1,0]),o.aB(W,W,F.calculateProjMatrix(Z.toUnwrapped())),Float32Array.from(W)}(S,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:h,pixelPosMatrix:z,transform:x,availableImages:g,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:R,scope:O})}querySourceFeatures(s,h){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const x=g.loadVTLayers(),S=h?h.sourceLayer:"",T=x._geojsonTileLayer||x[S];if(!T)return;const O=o.b6(h&&h.filter),{z:R,x:z,y:F}=this.tileID.canonical,Z={z:R,x:z,y:F};for(let W=0;W<T.length;W++){const K=T.feature(W);if(O.needGeometry){const ie=o.b7(K,!0);if(!O.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ie,this.tileID.canonical))continue}else if(!O.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),K))continue;const ne=g.getId(K,S),ee=new o.b8(K,R,z,F,ne);ee.tile=Z,s.push(ee)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const g=o.b9(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let x=!1;if(this.expirationTime>g)x=!1;else if(h)if(this.expirationTime<h)x=!0;else{const S=this.expirationTime-h;S?this.expirationTime=g+Math.max(S,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}hasAppearances(s){for(const h in this.buckets)if(s.style.hasLayer(h)&&this.buckets[h].layers.some(g=>g.appearances&&g.appearances.length>0))return!0;return!1}updateBuckets(s,h){if(!this.latestFeatureIndex||!s.style)return;const g=s.style.listImages(),x=s.style.getBrightness();for(const S in this.buckets){if(!s.style.hasLayer(S))continue;const T=this.buckets[S],O=T.layers[0],R=O.sourceLayer||"_geojsonTileLayer",z=s.style.getLayerSourceCache(O);let F={};z&&(F=z._state.getState(R,void 0));const Z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},W=Object.keys(F).length>0&&!h;T.hasAppearances=T.layers.some(ee=>ee.appearances&&ee.appearances.length>0);const K=W?T.stateDependentLayers:T.layers;if(W&&T.stateDependentLayers.length!==0||h){const ee=this.latestFeatureIndex.loadVTLayers();T.update(F,ee[R],g,Z,K,h,x)}if(W&&T.stateDependentLayers.length!==0||h||T.hasAppearances){const ee={zoom:s.transform.zoom,pitch:s.transform.pitch,brightness:s.style.getBrightness()||0,worldview:s.worldview};T.updateAppearances(this.tileID.canonical,F,g,ee,s.imageManager)}(T instanceof o.ba||T instanceof o.bb)&&s._terrain&&s._terrain.enabled&&z&&T.uploadPending()&&s._terrain._clearRenderCacheForTile(z.id,this.tileID);const ne=s&&s.style&&s.style.getOwnLayer(S);ne&&(this.queryPadding=Math.max(this.queryPadding,ne.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=o.o.now()+s}setTexture(s,h){const g=h.context,x=g.gl;this.texture=this.texture||h.getTileTexture(s.width),this.texture&&this.texture instanceof o.T?this.texture.update(s):(this.texture=new o.T(g,s,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(s,h){const g={};for(const x of h)g[x]=!0;this.dependencies[s]=g}hasDependency(s,h){for(const g of s){const x=this.dependencies[g];if(x){for(const S of h)if(x[S])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,h){if(!h||h.name==="mercator"||this._tileDebugBuffer)return;const g=o.bc(Jd,this.tileID.canonical,this.tileTransform)[0],x=new o.bd,S=new o.be;for(let T=0;T<g.length;T++){const{x:O,y:R}=g[T];x.emplaceBack(O,R),S.emplaceBack(T)}S.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(S),this._tileDebugBuffer=s.createVertexBuffer(x,o.bf.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,x.length,S.length)}_makeTileBoundsBuffers(s,h){if(this._tileBoundsBuffer||!h||h.name==="mercator")return;const g=o.bc(Jd,this.tileID.canonical,this.tileTransform)[0];let x,S;if(this.isRaster){const T=function(O,R){const z=o.aZ(O,R),F=Math.pow(2,O.z);for(let ie=0;ie<Xa;ie++)for(let ce=0;ce<Xa;ce++){const ge=o.a_((O.x+(ce+ff(ce))/Xo)/F),pe=o.a$((O.y+(ie+ff(ie))/Xo)/F),fe=R.project(ge,pe),Ie=ie*Xa+ce;Ka[2*Ie+0]=Math.round((fe.x*z.scale-z.x)*o.al),Ka[2*Ie+1]=Math.round((fe.y*z.scale-z.y)*o.al)}_c.fill(0),hf.fill(0);for(let ie=2045;ie>=0;ie--){const ce=4*ie,ge=su[ce+0],pe=su[ce+1],fe=su[ce+2],Ie=su[ce+3],Ee=ge+fe>>1,Pe=pe+Ie>>1,be=Ee+Pe-pe,ve=Pe+ge-Ee,ke=pe*Xa+ge,Ne=Ie*Xa+fe,$e=Pe*Xa+Ee,Je=Math.hypot((Ka[2*ke+0]+Ka[2*Ne+0])/2-Ka[2*$e+0],(Ka[2*ke+1]+Ka[2*Ne+1])/2-Ka[2*$e+1])>=16;_c[$e]=_c[$e]||(Je?1:0),ie<1022&&(_c[$e]=_c[$e]||_c[(pe+ve>>1)*Xa+(ge+be>>1)]||_c[(Ie+ve>>1)*Xa+(fe+be>>1)])}const Z=new o.b1,W=new o.b0;let K=0;function ne(ie,ce){const ge=ce*Xa+ie;return hf[ge]===0&&(Z.emplaceBack(Ka[2*ge+0],Ka[2*ge+1],ie*o.al/Xo,ce*o.al/Xo),hf[ge]=++K),hf[ge]-1}function ee(ie,ce,ge,pe,fe,Ie){const Ee=ie+ge>>1,Pe=ce+pe>>1;if(Math.abs(ie-fe)+Math.abs(ce-Ie)>1&&_c[Pe*Xa+Ee])ee(fe,Ie,ie,ce,Ee,Pe),ee(ge,pe,fe,Ie,Ee,Pe);else{const be=ne(ie,ce),ve=ne(ge,pe),ke=ne(fe,Ie);W.emplaceBack(be,ve,ke)}}return ee(0,0,Xo,Xo,Xo,0),ee(Xo,Xo,0,0,0,Xo),{vertices:Z,indices:W}}(this.tileID.canonical,h);x=T.vertices,S=T.indices}else{x=new o.b1,S=new o.b0;for(const{x:O,y:R}of g)x.emplaceBack(O,R,0,0);const T=o.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let O=0;O<T.length;O+=3)S.emplaceBack(T[O],T[O+1],T[O+2])}this._tileBoundsBuffer=s.createVertexBuffer(x,o.bi.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(S),this._tileBoundsSegments=o.bg.simpleSegment(0,0,x.length,S.length)}_makeGlobeTileDebugBuffers(s,h){const g=h.projection;if(!g||g.name!=="globe"||h.freezeTileCoverage)return;const x=this.tileID.canonical,S=o.bj(x,h),T=o.bk(S),O=o.aj(h.zoom);let R;O>0&&(R=o.bl(new Float64Array(16),h.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,x,h,T,R,O),this._makeGlobeTileDebugTextBuffer(s,x,h,T,R,O)}_globePoint(s,h,g,x,S,T,O){let R=o.bm(s,h,g);if(T){const z=1<<g.z,F=o.aF(x.center.lng),Z=o.aJ(x.center.lat),W=(g.x+.5)/z-F;let K=0;W>.5?K=-1:W<-.5&&(K=1);let ne=(s/o.al+g.x)/z+K,ee=(h/o.al+g.y)/z;ne=(ne-F)*x._pixelsPerMercatorPixel+F,ee=(ee-Z)*x._pixelsPerMercatorPixel+Z;const ie=[ne*x.worldSize,ee*x.worldSize,0];o.af(ie,ie,T),R=o.bn(R,ie,O)}return o.af(R,R,S)}_makeGlobeTileDebugBorderBuffer(s,h,g,x,S,T){const O=new o.bd,R=new o.be,z=new o.bo,F=(W,K,ne,ee,ie)=>{const ce=(ne-W)/(ie-1),ge=(ee-K)/(ie-1),pe=O.length;for(let fe=0;fe<ie;fe++){const Ie=W+fe*ce,Ee=K+fe*ge;O.emplaceBack(Ie,Ee);const Pe=this._globePoint(Ie,Ee,h,g,x,S,T);z.emplaceBack(Pe[0],Pe[1],Pe[2]),R.emplaceBack(pe+fe)}},Z=o.al;F(0,0,Z,0,16),F(Z,0,Z,Z,16),F(Z,Z,0,Z,16),F(0,Z,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(R),this._tileDebugBuffer=s.createVertexBuffer(O,o.bf.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(z,o.bp.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,O.length,R.length)}_makeGlobeTileDebugTextBuffer(s,h,g,x,S,T){const O=o.al/4,R=new o.bd,z=new o.b0,F=new o.bo,Z=25;z.reserve(32),R.reserve(Z),F.reserve(Z);const W=(K,ne)=>Z*K+ne;for(let K=0;K<Z;K++){const ne=K*O;for(let ee=0;ee<Z;ee++){const ie=ee*O;R.emplaceBack(ie,ne);const ce=this._globePoint(ie,ne,h,g,x,S,T);F.emplaceBack(ce[0],ce[1],ce[2])}}for(let K=0;K<4;K++)for(let ne=0;ne<4;ne++){const ee=W(K,ne),ie=W(K,ne+1),ce=W(K+1,ne),ge=W(K+1,ne+1);z.emplaceBack(ee,ie,ce),z.emplaceBack(ce,ie,ge)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(z),this._tileDebugTextBuffer=s.createVertexBuffer(R,o.bf.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(F,o.bp.members),this._tileDebugTextSegments=o.bg.simpleSegment(0,0,Z,32)}destroy(s=!0){for(const h in this.buckets)this.buckets[h].destroy(s);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),s&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof o.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bs.setPbf(o.bt);class Ry extends Yu{constructor(s,h,g,x,S){super(s,h,g,x,S),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexturePerLayer(s,h,g){const x=g.context,S=x.gl;let T=this.texturePerLayer.get(s)||g.getTileTexture(h.width);T&&T instanceof o.T?T.update(h,{premultiply:!1}):T=new o.T(x,h,S.RGBA8,{premultiply:!1}),this.texturePerLayer.has(s)||this.texturePerLayer.set(s,T)}flushQueues(s){const h=this._workQueuePerLayer.get(s)||[],g=this._fetchQueuePerLayer.get(s)||[];for(;h.length;)h.pop()();for(;g.length;)g.pop()()}flushAllQueues(){for(const s of this._workQueuePerLayer.keys()){const h=this._workQueuePerLayer.get(s)||[];for(;h.length;)h.pop()()}for(const s of this._fetchQueuePerLayer.keys()){const h=this._fetchQueuePerLayer.get(s)||[];for(;h.length;)h.pop()()}}fetchHeader(s=16384,h){const g=this._mrt=new o.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=o.bu(x,(S,T,O)=>{if(S)h(S);else try{const R=g.getHeaderLength(T);if(R>s)return void(this.request=this.fetchHeader(R,h));g.parseHeader(T),this._isHeaderLoaded=!0;let z=0;for(const F of Object.values(g.layers))z=Math.max(z,F.dataIndex[F.dataIndex.length-1].lastByte);T.byteLength>=z&&(this.entireBuffer=T),h(null,this.entireBuffer||T,O)}catch(R){h(R)}}),this.request}fetchBandForRender(s,h,g,x){this.fetchBand(s,h,g,S=>{if(S)return void x(S);this.updateTextureDescriptor(s,h,g);const T=this.textureDescriptorPerLayer.get(h);x(null,T?T.img:null)})}fetchBand(s,h,g,x,S=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void x(new Error("Tile header is not ready"));const O=this.actor;if(!O)return void x(new Error("Can't fetch tile band without an actor"));let R;const z=o.B(String(g),o.B(this.tileID.key,s));let F=this._taskQueue.get(z);F?F.add(x):(F=new Set,F.add(x),this._taskQueue.set(z,F));const Z=(ee,ie)=>{R.complete(ee,ie),ee?x(ee):(F.forEach(ce=>ce(null,ie)),this._taskQueue.delete(z))},W=(ee,ie)=>{if(ee)return x(ee);const ce=O.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ie,task:R},Z,void 0,!0);if(h!==null){const ge=this._workQueuePerLayer.get(h)||[];ge.push(()=>{ce&&ce.cancel(),R.cancel()}),this._workQueuePerLayer.has(h)||this._workQueuePerLayer.set(h,ge)}};let K;try{K=T.getLayer(s)}catch(ee){if(this.state==="reloading")return;throw ee}if(!K)return void x(new Error(`Unknown sourceLayer "${s}"`));if(K.hasDataForBand(g))return F.forEach(ee=>ee(null,null)),void this._taskQueue.delete(z);const ne=K.getDataRange([g]);if(R=T.createDecodingTask(ne),!R||R.tasks.length)if(h!==null&&this.flushQueues(h),this.entireBuffer)W(null,this.entireBuffer.slice(ne.firstByte,ne.lastByte+1));else{const ee=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ne.firstByte}-${ne.lastByte}`}}),ie=o.bu(ee,W);if(h!==null){const ce=this._fetchQueuePerLayer.get(h)||[];ce.push(()=>{ie.cancel(),R.cancel()}),this._fetchQueuePerLayer.has(h)||this._fetchQueuePerLayer.set(h,ce)}}}updateNeeded(s,h){return(!this.textureDescriptorPerLayer.get(s)||this.textureDescriptorPerLayer.get(s).band!==h||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(s,h,g){if(!this._mrt)return;const x=this._mrt.getLayer(s);if(!x||!x.hasBand(g)||!x.hasDataForBand(g))return;const{bytes:S,tileSize:T,buffer:O,offset:R,scale:z}=x.getBandView(g),F=T+2*O,Z=new o.q({width:F,height:F},S),W=this.texturePerLayer.get(h);W&&W instanceof o.T&&W.update(Z,{premultiply:!1}),this.textureDescriptorPerLayer.set(h,{layer:s,band:g,img:Z,buffer:O,offset:R,tileSize:T,format:x.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(s=!1){if(super.destroy(s),delete this._mrt,!s)for(const h of this.texturePerLayer.values())h&&h instanceof o.T&&h.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class fE{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,g){const x=s.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const S={value:h,timeout:void 0};if(g!==void 0&&(S.timeout=setTimeout(()=>{this.remove(s,S)},g)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const g=s.wrapped().key,x=h===void 0?0:this.data[g].indexOf(h),S=this.data[g][x];return this.data[g].splice(x,1),S.timeout&&clearTimeout(S.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(S.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const g in this.data)for(const x of this.data[g])s(x.value)||h.push(x);for(const g of h)this.remove(g.value.tileID,g)}}class pE{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,g){const x=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][x]=this.stateChanges[s][x]||{},Object.assign(this.stateChanges[s][x],g),this.deletedStates[s]===null){this.deletedStates[s]={};for(const S in this.state[s])S!==x&&(this.deletedStates[s][S]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][x]===null){this.deletedStates[s][x]={};for(const S in this.state[s][x])g[S]||(this.deletedStates[s][x][S]=null)}else for(const S in g)this.deletedStates[s]&&this.deletedStates[s][x]&&this.deletedStates[s][x][S]===null&&delete this.deletedStates[s][x][S]}removeFeatureState(s,h,g){if(this.deletedStates[s]===null)return;const x=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&h!==void 0)this.deletedStates[s][x]!==null&&(this.deletedStates[s][x]=this.deletedStates[s][x]||{},this.deletedStates[s][x][g]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][x])for(g in this.deletedStates[s][x]={},this.stateChanges[s][x])this.deletedStates[s][x][g]=null;else this.deletedStates[s][x]=null;else this.deletedStates[s]=null}getState(s,h){const g=this.state[s]||{},x=this.stateChanges[s]||{},S=this.deletedStates[s];if(S===null)return{};if(h!==void 0){const O=String(h),R=Object.assign({},g[O],x[O]);if(S){const z=S[h];if(z===null)return{};for(const F in z)delete R[F]}return R}const T=Object.assign({},g,x);if(S)for(const O in S)delete T[O];return T}initializeTileState(s,h){s.refreshFeatureState(h)}coalesceChanges(s,h){const g={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const S={};for(const T in this.stateChanges[x])this.state[x][T]||(this.state[x][T]={}),Object.assign(this.state[x][T],this.stateChanges[x][T]),S[T]=this.state[x][T];g[x]=S}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const S={};if(this.deletedStates[x]===null)for(const T in this.state[x])S[T]={},this.state[x][T]={};else for(const T in this.deletedStates[x]){if(this.deletedStates[x][T]===null)this.state[x][T]={};else if(this.state[x][T])for(const O of Object.keys(this.deletedStates[x][T]))delete this.state[x][T][O];S[T]=this.state[x][T]}g[x]=g[x]||{},Object.assign(g[x],S)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const x in s)s[x].refreshFeatureState(h)}}class ca extends o.E{constructor(s,h,g){super(),this.id=s,this._onlySymbols=g,h.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),h.on("error",()=>{this._sourceErrored=!0}),this._source=h,this._tiles={},this._cache=new fE(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new pE,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,h){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,h)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const g=this._tiles[h];g.upload(s,this.map?this.map.painter:void 0),g.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(hm).map(s=>s.key)}getRenderableIds(s,h){const g=[];for(const x in this._tiles)this._isIdRenderable(+x,s,h)&&g.push(this._tiles[x]);return s?g.sort((x,S)=>{const T=x.tileID,O=S.tileID,R=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),z=new o.P(O.canonical.x,O.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-O.overscaledZ||z.y-R.y||z.x-R.x}).map(x=>x.tileID.key):g.map(x=>x.tileID).sort(hm).map(x=>x.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h,g){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())&&(g||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,h){const g=this._tiles[s];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,s,h)))}_tileLoaded(s,h,g,x,S){if(x){if(s.state="errored",x.status!==404)this._source.fire(new o.y(x,{tile:s}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const O=this.map.painter.terrain;this.update(this.transform,O.getScaledDemTileSize(),!0),O.resetTileLookupCache(this.id)}else this.update(this.transform)}return}s.timeAdded=o.o.now(),g==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null);let T=new Map;S&&S.responseHeaders&&(T=S.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(s){const h=this.getRenderableIds();for(let x=0;x<h.length;x++){const S=h[x];if(s.neighboringTiles&&s.neighboringTiles[S]){const T=this.getTileByID(S);g(s,T),g(T,s)}}function g(x,S){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let T=S.tileID.canonical.x-x.tileID.canonical.x;const O=S.tileID.canonical.y-x.tileID.canonical.y,R=Math.pow(2,x.tileID.canonical.z),z=S.tileID.key;T===0&&O===0||Math.abs(O)>1||(Math.abs(T)>1&&(Math.abs(T+R)===1?T+=R:Math.abs(T-R)===1&&(T-=R)),S.dem&&x.dem&&(x.dem.backfillBorder(S.dem,T,O),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,g,x){for(const S in this._tiles){let T=this._tiles[S];if(x[S]||!T.hasData()||T.tileID.overscaledZ<=h||T.tileID.overscaledZ>g)continue;let O=T.tileID;for(;T&&T.tileID.overscaledZ>h+1;){const z=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[z.key],T&&T.hasData()&&(O=z)}let R=O;for(;R.overscaledZ>h;)if(R=R.scaledTo(R.overscaledZ-1),s[R.key]){x[O.key]=O;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=h?g:null}for(let g=s.overscaledZ-1;g>=h;g--){const x=s.scaledTo(g),S=this._getLoadedTile(x);if(S)return S}}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,h){h=h||this._source.tileSize;const g=Math.ceil(s.width/h)+1,x=Math.ceil(s.height/h)+1,S=Math.floor(g*x*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,S):S,O=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(O)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const g={};for(const x in this._tiles){const S=this._tiles[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+h),g[S.tileID.key]=S}this._tiles=g;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(s,h,g,x,S){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!g)return;this.updateCacheSize(s,h),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let O,R=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const W=z.attenuationRange()[0],K=Math.floor(W)-Math.log2(z.getDemUpscale());R>K&&(R=K)}if(this.used||this.usedForTerrain){if(this._source.tileID)O=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(W=>new o.aQ(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y));else if(this.tileCoverLift!==0){const W=s.clone();W.tileCoverLift=this.tileCoverLift,O=W.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&s.projection.name==="globe"&&(O.push(new o.aQ(1,0,1,0,0)),O.push(new o.aQ(1,0,1,1,0)),O.push(new o.aQ(1,0,1,0,1)),O.push(new o.aQ(1,0,1,1,1)))}else if(O=s.coveringTiles({tileSize:h||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!g,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const W=this._source.hasTile.bind(this._source);O=O.filter(K=>W(K))}}else O=[];if(O.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!fm(this._source.type)){const W=s.coveringZoomLevel({tileSize:h||this._source.tileSize,roundZoom:this._source.roundZoom&&!g}),K=Math.min(W,this._source.maxzoom);if(T){const ne=s.extendTileCover(O,K);for(const ee of ne)O.push(ee)}else if(S){const ne=s.extendTileCoverToNearPlane(O,this.transform.getFrustum(K),K);for(const ee of ne)O.push(ee)}else if(this.castsShadows&&x){const ne=s.extendTileCover(O,K,x,16);for(const ee of ne)this._shadowCasterTiles[ee.key]=!0,O.push(ee)}}const F=this._updateRetainedTiles(O);if(fm(this._source.type)&&O.length!==0){const W={},K={},ne=Object.keys(F);for(const ie of ne){const ce=F[ie],ge=this._tiles[ie];if(!ge||ge.fadeEndTime&&ge.fadeEndTime<=o.o.now())continue;const pe=this.findLoadedParent(ce,Math.max(ce.overscaledZ-ca.maxOverzooming,this._source.minzoom));pe&&(this._addTile(pe.tileID),W[pe.tileID.key]=pe.tileID),K[ie]=ce}const ee=O[O.length-1].overscaledZ;for(const ie in this._tiles){const ce=this._tiles[ie];if(F[ie]||!ce.hasData())continue;let ge=ce.tileID;for(;ge.overscaledZ>ee;){ge=ge.scaledTo(ge.overscaledZ-1);const pe=this._tiles[ge.key];if(pe&&pe.hasData()&&K[ge.key]){F[ie]=ce.tileID;break}}}for(const ie in W)F[ie]||(this._coveredTiles[ie]=!0,F[ie]=W[ie])}for(const W in F)this._tiles[W].clearFadeHold();const Z=o.bv(this._tiles,F);for(const W of Z){const K=this._tiles[W];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(+W)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const h={};if(s.length===0)return h;const g={},x=s.reduce((z,F)=>Math.min(z,F.overscaledZ),1/0),S=s[0].overscaledZ,T=Math.max(S-ca.maxOverzooming,this._source.minzoom),O=Math.max(S+ca.maxUnderzooming,this._source.minzoom),R={};for(const z of s){const F=this._addTile(z);h[z.key]=z,F.hasData()||x<this._source.maxzoom&&(R[z.key]=z)}this._retainLoadedChildren(R,x,O,h);for(const z of s){let F=this._tiles[z.key];if(F.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const W=z.children(this._source.maxzoom)[0],K=this.getTile(W);if(K&&K.hasData()){h[W.key]=W;continue}}else{const W=z.children(this._source.maxzoom);if(h[W[0].key]&&h[W[1].key]&&h[W[2].key]&&h[W[3].key])continue}let Z=F.wasRequested();for(let W=z.overscaledZ-1;W>=T;--W){const K=z.scaledTo(W);if(g[K.key]||(g[K.key]=!0,F=this.getTile(K),!F&&Z&&(F=this._addTile(K)),F&&(h[K.key]=K,Z=F.wasRequested(),F.hasData())))break}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let g,x=this._tiles[s].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){g=this._loadedParentTiles[x.key];break}h.push(x.key);const S=x.scaledTo(x.overscaledZ-1);if(g=this._getLoadedTile(S),g)break;x=S}for(const S of h)this._loadedParentTiles[S]=g}}_addTile(s){let h=this._tiles[s.key];if(h)return h.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const g=!!h;if(!g){const x=this.map?this.map.painter:null,S=this._source.tileSize*s.overscaleFactor();h=this._source.type==="raster-array"?new Ry(s,S,this.transform.tileZoom,x,this._isRaster):new Yu(s,S,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(h,this._tileLoaded.bind(this,h,s.key,h.state))}return h.uses++,this._tiles[s.key]=h,g||this._source.fire(new o.z("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=h.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"||h.state==="empty"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,h,g){const x=[],S=this.transform;if(!S)return x;const T=S.projection.name==="globe",O=o.aF(S.center.lng);for(const R in this._tiles){const z=this._tiles[R];if(g&&z.clearQueryDebugViz(),z.holdingForFade())continue;let F;if(T){const Z=z.tileID.canonical;if(Z.z===0){const W=[Math.abs(o.aA(O,...au(Z,-1))-O),Math.abs(o.aA(O,...au(Z,1))-O)];F=[0,2*W.indexOf(Math.min(...W))-1]}else{const W=[Math.abs(o.aA(O,...au(Z,-1))-O),Math.abs(o.aA(O,...au(Z,0))-O),Math.abs(o.aA(O,...au(Z,1))-O)];F=[W.indexOf(Math.min(...W))-1]}}else F=[0];for(const Z of F){const W=s.containsTile(z,S,h,Z);W&&x.push(W)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,h){const g=this.getRenderableIds(s,h).map(S=>this._tiles[S].tileID),x=this.transform.projection.name==="globe";for(const S of g)S.projMatrix=this.transform.calculateProjMatrix(S.toUnwrapped()),S.expandedProjMatrix=x?this.transform.calculateProjMatrix(S.toUnwrapped(),!1,!0):S.projMatrix;return g}sortCoordinatesByDistance(s){const h=s.slice(),g=this.transform._camera.position,x=this.transform._camera.forward(),S={};for(const T of h){const O=1/(1<<T.canonical.z);S[T.key]=((T.canonical.x+.5)*O+T.wrap-g[0])*x[0]+((T.canonical.y+.5)*O-g[1])*x[1]-g[2]*x[2]}return h.sort((T,O)=>S[T.key]-S[O.key]),h}hasTransition(){if(this._source.hasTransition())return!0;if(fm(this._source.type))for(const s in this._tiles){const h=this._tiles[s];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(s,h,g){this._state.updateState(s=s||"_geojsonTileLayer",h,g)}removeFeatureState(s,h,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,g)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,g){const x=this._tiles[s];x&&x.setDependencies(h,g)}reloadTilesForDependencies(s,h){for(const g in this._tiles)this._tiles[g].hasDependency(s,h)&&this._reloadTile(+g,"reloading");this._cache.filter(g=>!g.hasDependency(s,h))}_preloadTiles(s,h){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(s,h))};return void this._source.on("data",R)}const g=new Map,x=Array.isArray(s)?s:[s],S=this.map.painter.terrain,T=this.usedForTerrain&&S?S.getScaledDemTileSize():this._source.tileSize;for(const R of x){const z=R.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of z)g.set(F.key,F);this.usedForTerrain&&R.updateElevation(!1)}const O=Array.from(g.values());o.bw(O,(R,z)=>{const F=new Yu(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,Z=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),z(Z,F)})},h)}}function hm(m,s){const h=Math.abs(2*m.wrap)-+(m.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return m.overscaledZ-s.overscaledZ||g-h||s.canonical.y-m.canonical.y||s.canonical.x-m.canonical.x}function fm(m){return m==="raster"||m==="image"||m==="video"||m==="custom"}function au(m,s){const h=1<<m.z;return[m.x/h+s,(m.x+1)/h+s]}ca.maxOverzooming=10,ca.maxUnderzooming=3;class pm{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,h=!1;for(const g in this.style._mergedLayers){const x=this.style._mergedLayers[g];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:s,visibilityChanged:h});else if(x.type==="model"){const S=this.style.getLayerSource(x);S&&S.type==="batched-model"&&this.layers.push({layer:x,visible:s,visibilityChanged:h})}}}onNewFrame(s){this.layersGotHidden=!1;for(const h of this.layers){const g=h.layer;let x=!1;g.type==="fill-extrusion"?x=!g.isHidden(s)&&g.paint.get("fill-extrusion-opacity")>0:g.type==="building"?x=!g.isHidden(s)&&g.paint.get("building-opacity")>0:g.type==="model"&&(x=!g.isHidden(s)&&g.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&h.visible,h.visible=x}}updateZOffset(s,h){this.currentBuildingBuckets=[];for(const x of this.layers){const S=x.layer,T=this.style.getLayerSourceCache(S);let O=1;S.type==="fill-extrusion"?O=x.visible?S.paint.get("fill-extrusion-vertical-scale"):0:S.type==="building"&&(O=x.visible?S.paint.get("building-vertical-scale"):0);let R=T?T.getTile(h):null;if(!R&&T)for(const z in T._tiles){const F=T._tiles[z];if(h.canonical.isChildOf(F.tileID.canonical)){R=F;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(S):null,tileID:R?R.tileID:h,verticalScale:O})}s.hasAnyZOffset=!1;let g=!1;for(let x=0;x<s.symbolInstances.length;x++){const S=s.symbolInstances.get(x),T=S.zOffset,O=this._getHeightAtTileOffset(h,S.tileAnchorX,S.tileAnchorY);S.zOffset=O!==Number.NEGATIVE_INFINITY?O:T,g||T===S.zOffset||(g=!0),s.hasAnyZOffset||S.zOffset===0||(s.hasAnyZOffset=!0)}g&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,h,g,x){let S=h,T=g;if(s.canonical.z!==x.canonical.z){const O=x.canonical,R=1/(1<<s.canonical.z-O.z);S=(h+s.canonical.x*o.al)*R-O.x*o.al|0,T=(g+s.canonical.y*o.al)*R-O.y*o.al|0}return{tileX:S,tileY:T}}_getHeightAtTileOffset(s,h,g){let x,S;for(let T=0;T<this.layers.length;++T){const O=this.layers[T].layer;if(O.type!=="fill-extrusion"&&O.type!=="building")continue;const{bucket:R,tileID:z,verticalScale:F}=this.currentBuildingBuckets[T];if(!R)continue;const{tileX:Z,tileY:W}=this._mapCoordToOverlappingTile(s,h,g,z),K=R.getHeightAtTileCoord(Z,W);K&&K.height!==void 0&&(K.hidden?x=K.height:S=Math.max(K.height*F,S||0))}if(S!==void 0)return S;for(let T=0;T<this.layers.length;++T){const O=this.layers[T];if(O.layer.type!=="model"||!O.visible)continue;const{bucket:R,tileID:z}=this.currentBuildingBuckets[T];if(!R)continue;const{tileX:F,tileY:Z}=this._mapCoordToOverlappingTile(s,h,g,z),W=R.getHeightAtTileCoord(F,Z);if(W&&!W.hidden)return W.height===void 0&&x!==void 0?Math.min(W.maxHeight,x)*W.verticalScale:W.height?W.height*W.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function oR(m,s){const h={};for(const g in m)g!=="ref"&&(h[g]=m[g]);return o.bx.forEach(g=>{g in s&&(h[g]=s[g])}),h}function Nx(m){m=m.slice();const s=Object.create(null);for(let h=0;h<m.length;h++)s[m[h].id]=m[h];for(let h=0;h<m.length;h++)"ref"in m[h]&&(m[h]=oR(m[h],s[m[h].ref]));return m}const cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function pf(m,s,h){h.push({command:cn.addSource,args:[m,s[m]]})}function My(m,s,h){s.push({command:cn.removeSource,args:[m]}),h[m]=!0}function mE(m,s,h,g){My(m,h,g),pf(m,s,h)}function gE(m,s,h){let g;for(g in m[h])if(m[h].hasOwnProperty(g)&&g!=="data"&&!o.by(m[h][g],s[h][g]))return!1;for(g in s[h])if(s[h].hasOwnProperty(g)&&g!=="data"&&!o.by(m[h][g],s[h][g]))return!1;return!0}function mm(m,s,h,g,x,S){let T;for(T in s=s||{},m=m||{})m.hasOwnProperty(T)&&(o.by(m[T],s[T])||h.push({command:S,args:[g,T,s[T],x]}));for(T in s)s.hasOwnProperty(T)&&!m.hasOwnProperty(T)&&(o.by(m[T],s[T])||h.push({command:S,args:[g,T,s[T],x]}))}function Ju(m){return m.id}function gm(m,s){return m[s.id]=s,m}function Dy(m,s,h){const g=s.createTileMatrix(m,m.worldSize,h.toUnwrapped());return o.aB(new Float32Array(16),m.projMatrix,g)}function sR(m,s,h){if(s.projection.name===h.projection.name)return m.projMatrix;const g=h.clone();return g.setProjection(s.projection),Dy(g,s.getProjection(),m)}function mf(m,s,h){return s.name===h.projection.name?m.projMatrix:Dy(h,s,m)}class lu{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.aA(s,0,1);let h=1,g=this._distances[h];const x=s*this.paddedLength+this.padding;for(;g<x&&h<this._distances.length;)g=this._distances[++h];const S=h-1,T=this._distances[S],O=g-T,R=O>0?(x-T)/O:0;return this.points[S].mult(1-R).add(this.points[h].mult(R))}}class ym{constructor(s,h,g){const x=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)x.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,x,S){this._forEachCell(h,g,x,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(x),this.bboxes.push(S)}insertCircle(s,h,g,x){this._forEachCell(h-x,g-x,h+x,g+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(x)}_insertBoxCell(s,h,g,x,S,T){this.boxCells[S].push(T)}_insertCircleCell(s,h,g,x,S,T){this.circleCells[S].push(T)}_query(s,h,g,x,S,T){if(g<0||s>this.width||x<0||h>this.height)return!S&&[];const O=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=x){if(S)return!0;for(let R=0;R<this.boxKeys.length;R++)O.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const z=this.circles[3*R],F=this.circles[3*R+1],Z=this.circles[3*R+2];O.push({key:this.circleKeys[R],x1:z-Z,y1:F-Z,x2:z+Z,y2:F+Z})}return T?O.filter(T):O}return this._forEachCell(s,h,g,x,this._queryCell,O,{hitTest:S,seenUids:{box:{},circle:{}}},T),S?O.length>0:O}_queryCircle(s,h,g,x,S){const T=s-g,O=s+g,R=h-g,z=h+g;if(O<0||T>this.width||z<0||R>this.height)return!x&&[];const F=[];return this._forEachCell(T,R,O,z,this._queryCellCircle,F,{hitTest:x,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},S),x?F.length>0:F}query(s,h,g,x,S){return this._query(s,h,g,x,!1,S)}hitTest(s,h,g,x,S){return this._query(s,h,g,x,!0,S)}hitTestCircle(s,h,g,x){return this._queryCircle(s,h,g,!0,x)}_queryCell(s,h,g,x,S,T,O,R){const z=O.seenUids,F=this.boxCells[S];if(F!==null){const W=this.bboxes;for(const K of F)if(!z.box[K]){z.box[K]=!0;const ne=4*K;if(s<=W[ne+2]&&h<=W[ne+3]&&g>=W[ne+0]&&x>=W[ne+1]&&(!R||R(this.boxKeys[K]))){if(O.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[K],x1:W[ne],y1:W[ne+1],x2:W[ne+2],y2:W[ne+3]})}}}const Z=this.circleCells[S];if(Z!==null){const W=this.circles;for(const K of Z)if(!z.circle[K]){z.circle[K]=!0;const ne=3*K;if(this._circleAndRectCollide(W[ne],W[ne+1],W[ne+2],s,h,g,x)&&(!R||R(this.circleKeys[K]))){if(O.hitTest)return T.push(!0),!0;{const ee=W[ne],ie=W[ne+1],ce=W[ne+2];T.push({key:this.circleKeys[K],x1:ee-ce,y1:ie-ce,x2:ee+ce,y2:ie+ce})}}}}}_queryCellCircle(s,h,g,x,S,T,O,R){const z=O.circle,F=O.seenUids,Z=this.boxCells[S];if(Z!==null){const K=this.bboxes;for(const ne of Z)if(!F.box[ne]){F.box[ne]=!0;const ee=4*ne;if(this._circleAndRectCollide(z.x,z.y,z.radius,K[ee+0],K[ee+1],K[ee+2],K[ee+3])&&(!R||R(this.boxKeys[ne])))return T.push(!0),!0}}const W=this.circleCells[S];if(W!==null){const K=this.circles;for(const ne of W)if(!F.circle[ne]){F.circle[ne]=!0;const ee=3*ne;if(this._circlesCollide(K[ee],K[ee+1],K[ee+2],z.x,z.y,z.radius)&&(!R||R(this.circleKeys[ne])))return T.push(!0),!0}}}_forEachCell(s,h,g,x,S,T,O,R){const z=this._convertToXCellCoord(s),F=this._convertToYCellCoord(h),Z=this._convertToXCellCoord(g),W=this._convertToYCellCoord(x);for(let K=z;K<=Z;K++)for(let ne=F;ne<=W;ne++)if(S.call(this,s,h,g,x,this.xCellCount*ne+K,T,O,R))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,x,S,T){const O=x-s,R=S-h,z=g+T;return z*z>O*O+R*R}_circleAndRectCollide(s,h,g,x,S,T,O){const R=(T-x)/2,z=Math.abs(s-(x+R));if(z>R+g)return!1;const F=(O-S)/2,Z=Math.abs(h-(S+F));if(Z>F+g)return!1;if(z<=R||Z<=F)return!0;const W=z-R,K=Z-F;return W*W+K*K<=g*g}}const yE=Math.tan(85*Math.PI/180);function Qd(m,s,h,g,x,S,T){const O=o.bC();if(h)if(S.name==="globe"){const R=o.bD(x,s);o.aB(O,O,R)}else{const R=o.bE([],T);O[0]=R[0],O[1]=R[1],O[4]=R[2],O[5]=R[3],g||o.bB(O,O,x.angle)}else o.aB(O,x.labelPlaneMatrix,m);return O}function cu(m,s,h,g,x,S,T){const O=Qd(m,s,h,g,x,S,T);return S.name==="globe"&&h||(O[2]=O[6]=O[10]=O[14]=0),O}function ua(m,s,h,g,x,S,T){if(h){if(S.name==="globe"){const O=Qd(m,s,h,g,x,S,T);return o.bl(O,O),o.aB(O,m,O),O}{const O=o.bz(m),R=o.bA([]);return R[0]=T[0],R[1]=T[1],R[4]=T[2],R[5]=T[3],o.aB(O,O,R),g||o.bB(O,O,-x.angle),O}}return x.glCoordMatrix}function Al(m,s,h,g){const x=[m,s,h,1];h?o.aC(x,x,g):jy(x,x,g);const S=x[3];return x[0]/=S,x[1]/=S,x[2]/=S,x}function Ly(m,s){return Math.min(.5+m/s*.5,1.5)}function _E(m,s){const h=m[0]/m[3],g=m[1]/m[3];return h>=-s[0]&&h<=s[0]&&g>=-s[1]&&g<=s[1]}function En(m,s,h,g,x,S,T,O,R,z,F=1){const Z=h.transform,W=g?m.textSizeData:m.iconSizeData,K=o.bK(W,h.transform.zoom,F),ne=Z.projection.name==="globe",ee=[256/h.width*2+1,256/h.height*2+1],ie=g?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ie.clear();let ce=null;ne&&(ce=g?m.text.globeExtVertexArray:m.icon.globeExtVertexArray);const ge=m.lineVertexArray,pe=g?m.text.placedSymbolArray:m.icon.placedSymbolArray,fe=h.transform.width/h.transform.height;let Ie,Ee=!1;for(let Pe=0;Pe<pe.length;Pe++){const be=pe.get(Pe),{numGlyphs:ve,writingMode:ke}=be;if(ke!==o.bL.vertical||Ee||Ie===o.bL.horizontal||(Ee=!0),Ie=ke,(be.hidden||ke===o.bL.vertical)&&!Ee){Hs(ve,ie);continue}Ee=!1;const Ne=new o.P(be.tileAnchorX,be.tileAnchorY),$e=m.elevationType==="road",Je=!!Z.elevation||$e;let{x:Xe,y:ht,z:vt}=Z.projection.projectTilePoint(Ne.x,Ne.y,z.canonical),We=null;if(Je){const Zt=$e?m.getElevationFeatureForText(Pe):null;We={getElevation:R,elevation:Z.elevation,elevationFeature:Zt};const[or,yr,Lr]=R(Ne,Z.elevation,Zt);Xe+=or,ht+=yr,vt+=Lr}const Re=[Xe,ht,vt,1];if(o.aC(Re,Re,s),!_E(Re,ee)){Hs(ve,ie);continue}const lt=Re[3],Qe=Ly(h.transform.getCameraToCenterDistance(Z.projection),lt),bt=o.bM(W,K,be),At=T?bt/Qe:bt*Qe,Lt=Al(Xe,ht,vt,x);if(Lt[3]<=0){Hs(ve,ie);continue}let Pt={};const It=o.an(m.layers[0].layout.get("text-max-angle")),Kt=Math.cos(It),Xt=T?null:We,Bt=xE(be,At,!1,O,s,x,S,m.glyphOffsetArray,ge,ie,ce,Lt,Ne,Pt,fe,Xt,Z.projection,z,T,Kt);Ee=Bt.useVertical,Xt&&Bt.needsFlipping&&(Pt={}),(Bt.notEnoughRoom||Ee||Bt.needsFlipping&&xE(be,At,!0,O,s,x,S,m.glyphOffsetArray,ge,ie,ce,Lt,Ne,Pt,fe,Xt,Z.projection,z,T,Kt).notEnoughRoom)&&Hs(ve,ie)}g?(m.text.dynamicLayoutVertexBuffer.updateData(ie),ce&&m.text.globeExtVertexBuffer&&m.text.globeExtVertexBuffer.updateData(ce)):(m.icon.dynamicLayoutVertexBuffer.updateData(ie),ce&&m.icon.globeExtVertexBuffer&&m.icon.globeExtVertexBuffer.updateData(ce))}function zx(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie){const{lineStartIndex:ce,glyphStartIndex:ge,segment:pe}=O,fe=ge+O.numGlyphs,Ie=ce+O.lineLength,Ee=s.getoffsetX(ge),Pe=s.getoffsetX(fe-1),be=eh(m*Ee,h,g,x,S,T,pe,ce,Ie,R,z,F,Z,W,!0,K,ne,ee,ie);if(!be)return null;const ve=eh(m*Pe,h,g,x,S,T,pe,ce,Ie,R,z,F,Z,W,!0,K,ne,ee,ie);return ve?{first:be,last:ve}:null}function vE(m,s,h,g){return m===o.bL.horizontal&&Math.abs(g)>Math.abs(h)?{useVertical:!0}:m===o.bL.vertical?g>0?{needsFlipping:!0}:null:s!==0&&function(x,S){return x===0||Math.abs(S/x)>yE}(h,g)?s===1?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null}function xE(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce,ge,pe){const fe=s/24,Ie=m.lineOffsetX*fe,Ee=m.lineOffsetY*fe,{lineStartIndex:Pe,glyphStartIndex:be,numGlyphs:ve,segment:ke,writingMode:Ne,flipState:$e}=m,Je=Pe+m.lineLength,Xe=ht=>{if(F){const[lt,Qe,bt]=ht.up,At=z.length;o.bN(F,At+0,lt,Qe,bt),o.bN(F,At+1,lt,Qe,bt),o.bN(F,At+2,lt,Qe,bt),o.bN(F,At+3,lt,Qe,bt)}const[vt,We,Re]=ht.point;o.bO(z,vt,We,Re,ht.angle)};if(ve>1){const ht=zx(fe,O,Ie,Ee,h,Z,W,m,R,S,K,ee,!1,ie,ce,ge,pe);if(!ht)return{notEnoughRoom:!0};if(g&&!h){let[vt,We,Re]=ht.first.point,[lt,Qe,bt]=ht.last.point;[vt,We]=Al(vt,We,Re,T),[lt,Qe]=Al(lt,Qe,bt,T);const At=vE(Ne,$e,(lt-vt)*ne,Qe-We);if(m.flipState=At&&At.needsFlipping?1:2,At)return At}Xe(ht.first);for(let vt=be+1;vt<be+ve-1;vt++){const We=eh(fe*O.getoffsetX(vt),Ie,Ee,h,Z,W,ke,Pe,Je,R,S,K,ee,!1,!1,ie,ce,ge,pe);if(!We)return z.length-=4*(vt-be),{notEnoughRoom:!0};Xe(We)}Xe(ht.last)}else{if(g&&!h){const vt=Al(W.x,W.y,0,x),We=Pe+ke+1,Re=new o.P(R.getx(We),R.gety(We)),lt=Al(Re.x,Re.y,0,x),Qe=lt[3]>0?lt:Fx(W,Re,vt,1,x,void 0,ie,ce.canonical),bt=vE(Ne,$e,(Qe[0]-vt[0])*ne,Qe[1]-vt[1]);if(m.flipState=bt&&bt.needsFlipping?1:2,bt)return bt}const ht=eh(fe*O.getoffsetX(be),Ie,Ee,h,Z,W,ke,Pe,Je,R,S,K,ee,!1,!1,ie,ce,ge,pe);if(!ht)return{notEnoughRoom:!0};Xe(ht)}return{}}function mr(m,s,h,g,x){const{x:S,y:T,z:O}=g.projectTilePoint(m.x,m.y,s);if(!x)return Al(S,T,O,h);const[R,z,F]=x.getElevation(m,x.elevation,x.elevationFeature);return Al(S+R,T+z,O+F,h)}function Fx(m,s,h,g,x,S,T,O){const R=mr(m.sub(s)._unit()._add(m),O,x,T,S);return o.av(R,h,R),o.aw(R,R),o.bH(R,h,R,g)}function eh(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce,ge){const pe=g?m-s:m+s;let fe=pe>0?1:-1,Ie=0;g&&(fe*=-1,Ie=Math.PI),fe<0&&(Ie+=Math.PI);let Ee=O+T+(fe>0?0:1)|0,Pe=x,be=x,ve=0,ke=0;const Ne=Math.abs(pe),$e=[],Je=[];let Xe=S,ht=Xe,vt=o.bF([]);const We=()=>Fx(ht,Xe,be,Ne-ve+1,F,W,ee,ie.canonical);for(;ve+ke<=Ne;){if(Ee+=fe,Ee<O||Ee>=R)return null;if(be=Pe,ht=Xe,$e.push(be),K&&Je.push(ht),Xe=new o.P(z.getx(Ee),z.gety(Ee)),Pe=Z[Ee],!Pe){const Xt=mr(Xe,ie.canonical,F,ee,W);Pe=Xt[3]>0?Z[Ee]=Xt:We()}ve+=ke;const It=o.av([],Pe,be),Kt=o.bG(be,Pe);if(h&&Kt>0&&ke>0&&o.bJ(vt,It)/(ke*Kt)<ge)return null;ke=Kt,vt=It}ne&&W&&(Z[Ee]&&(Pe=We(),ke=o.bG(be,Pe),vt=o.av([],Pe,be)),Z[Ee]=Pe);const Re=(Ne-ve)/ke,lt=Xe.sub(ht)._mult(Re)._add(ht),Qe=o.bH([],be,vt,Re);let bt=[0,0,1],At=vt[0],Lt=vt[1];if(ce&&(bt=ee.upVector(ie.canonical,lt.x,lt.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const It=[bt[2],0,-bt[0]],Kt=o.bI([],bt,It);o.aw(It,It),o.aw(Kt,Kt),At=o.bJ(vt,It),Lt=o.bJ(vt,Kt)}if(h){const It=o.bI([],bt,vt);o.aw(It,It),o.bH(Qe,Qe,It,h*fe)}const Pt=Ie+Math.atan2(Lt,At);return $e.push(Qe),K&&Je.push(lt),{point:Qe,angle:Pt,path:$e,tilePath:Je,up:bt}}function Hs(m,s){const h=s.length,g=h+4*m;s.resize(g),s.float32.fill(-1/0,4*h,4*g)}function jy(m,s,h){const g=s[0],x=s[1];return m[0]=h[0]*g+h[4]*x+h[12],m[1]=h[1]*g+h[5]*x+h[13],m[3]=h[3]*g+h[7]*x+h[15],m}const da=100;class tr{constructor(s,h,g=new ym(s.width+200,s.height+200,25),x=new ym(s.width+200,s.height+200,25)){this.transform=s,this.grid=g,this.ignoredGrid=x,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+da,this.screenBottomBoundary=s.height+da,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=h}placeCollisionBox(s,h,g,x,S,T,O,R,z,F,Z){let W=g.projectedAnchorX,K=g.projectedAnchorY,ne=g.projectedAnchorZ;const ee=g.tileAnchorX,ie=g.tileAnchorY,ce=g.elevation,ge=g.tileID,pe=s.getProjection();if(ce&&ge){const[Je,Xe,ht]=pe.upVector(ge.canonical,g.tileAnchorX,g.tileAnchorY),vt=pe.upVectorScale(ge.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;W+=Je*ce*vt,K+=Xe*ce*vt,ne+=ht*ce*vt}const fe=s.projection.name==="globe",Ie=s.projection.name==="globe"?o.aj(this.transform.zoom):0;if(ge&&fe&&Ie<1&&!T){const Je=1<<ge.canonical.z,Xe=o.bP(ee,ie);o.bQ(Xe,Xe,1/o.al),o.bR(Xe,Xe,o.bP(ge.canonical.x,ge.canonical.y)),o.bQ(Xe,Xe,1/Je),o.bS(Xe,Xe,o.bP(x[0],x[1])),Xe[0]=o.bT(Xe[0],-.5,.5),o.bQ(Xe,Xe,o.al);const ht=o.bU(Xe[0],Xe[1],o.al/(2*Math.PI),1);o.aC(ht,ht,S),W=o.ak(W,ht[0],Ie),K=o.ak(K,ht[1],Ie),ne=o.ak(ne,ht[2],Ie)}const Ee=this.projectAndGetPerspectiveRatio(F,W,K,ne,g.tileID,pe.name==="globe"||!!ce||this.transform.pitch>0,pe),Pe=z*Ee.perspectiveRatio,be=(g.x1*h+O.x-g.padding)*Pe+Ee.point.x,ve=(g.y1*h+O.y-g.padding)*Pe+Ee.point.y,ke=(g.x2*h+O.x+g.padding)*Pe+Ee.point.x,Ne=(g.y2*h+O.y+g.padding)*Pe+Ee.point.y,$e=Ee.perspectiveRatio<=.55||Ee.occluded;return!this.isInsideGrid(be,ve,ke,Ne)||!R&&this.grid.hitTest(be,ve,ke,Ne,Z)||$e?{box:[],offscreen:!1,occluded:Ee.occluded}:{box:[be,ve,ke,Ne],offscreen:this.isOffscreen(be,ve,ke,Ne),occluded:!1}}placeCollisionCircles(s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie){const ce=[],ge=this.transform.elevation,pe=s.getProjection(),fe=s.elevationType==="road",Ie=!!ge||fe,Ee=o.bV.getAtTileOffsetFunc(ie,this.transform.center.lat,this.transform.worldSize,pe),Pe=new o.P(g.tileAnchorX,g.tileAnchorY),be=new o.P(g.tileAnchorX,g.tileAnchorY);let{x:ve,y:ke,z:Ne}=pe.projectTilePoint(be.x,be.y,ie.canonical),$e=null;if(Ie){const Kt=fe?s.getElevationFeatureForText(x):null;$e={getElevation:Ee,elevation:ge,elevationFeature:Kt};const[Xt,Bt,Zt]=Ee(Pe,ge,Kt);ve+=Xt,ke+=Bt,Ne+=Zt}const Je=pe.name==="globe",Xe=this.projectAndGetPerspectiveRatio(R,ve,ke,Ne,ie,Je||!!ge||this.transform.pitch>0,pe),{perspectiveRatio:ht}=Xe,vt=(W?O/ht:O*ht)/o.bY,We=Al(ve,ke,Ne,z),Re=g.lineOffsetX*vt,lt=g.lineOffsetY*vt,Qe=o.an(s.layers[0].layout.get("text-max-angle")),bt=Math.cos(Qe),At=Xe.signedDistanceFromCamera>0?zx(vt,T,Re,lt,fe&&g.flipState===1,We,be,g,S,z,{},Ie&&!W?$e:null,W&&Ie,pe,ie,W,bt):null;let Lt=!1,Pt=!1,It=!0;if(At&&!Xe.occluded){const Kt=.5*ne*ht+ee,Xt=new o.P(-100,-100),Bt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Zt=new lu,{first:or,last:yr}=At,Lr=or.path.length;let Jr=[];for(let Cr=Lr-1;Cr>=1;Cr--)Jr.push(or.path[Cr]);for(let Cr=1;Cr<yr.path.length;Cr++)Jr.push(yr.path[Cr]);const Tr=2.5*Kt;F&&(Jr=Jr.map(([Cr,In,An],kn)=>(Ie&&!Je&&(An=Ee(kn<Lr-1?or.tilePath[Lr-1-kn]:yr.tilePath[kn-Lr+2],ge,$e.elevationFeature)[2]),Al(Cr,In,An,F))),Jr.some(Cr=>Cr[3]<=0)&&(Jr=[]));let ln=[];if(Jr.length>0){let Cr=1/0,In=-1/0,An=1/0,kn=-1/0;for(const en of Jr)Cr=Math.min(Cr,en[0]),An=Math.min(An,en[1]),In=Math.max(In,en[0]),kn=Math.max(kn,en[1]);In>=Xt.x&&Cr<=Bt.x&&kn>=Xt.y&&An<=Bt.y&&(ln=[Jr.map(en=>new o.P(en[0],en[1]))],(Cr<Xt.x||In>Bt.x||An<Xt.y||kn>Bt.y)&&(ln=o.bW(ln,Xt.x,Xt.y,Bt.x,Bt.y)))}for(const Cr of ln){Zt.reset(Cr,.25*Kt);let In=0;In=Zt.length<=.5*Kt?1:Math.ceil(Zt.paddedLength/Tr)+1;for(let An=0;An<In;An++){const kn=An/Math.max(In-1,1),en=Zt.lerp(kn),kr=en.x+da,yn=en.y+da;ce.push(kr,yn,Kt,0);const hi=kr-Kt,fi=yn-Kt,_n=kr+Kt,qr=yn+Kt;if(It=It&&this.isOffscreen(hi,fi,_n,qr),Pt=Pt||this.isInsideGrid(hi,fi,_n,qr),!h&&this.grid.hitTestCircle(kr,yn,Kt,K)&&(Lt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Lt,occluded:!1}}}}return{circles:!Z&&Lt||!Pt?[]:ce,offscreen:It,collisionDetected:Lt,occluded:Xe.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,x=1/0,S=-1/0,T=-1/0;for(const F of s){const Z=new o.P(F.x+da,F.y+da);g=Math.min(g,Z.x),x=Math.min(x,Z.y),S=Math.max(S,Z.x),T=Math.max(T,Z.y),h.push(Z)}const O=this.grid.query(g,x,S,T).concat(this.ignoredGrid.query(g,x,S,T)),R={},z={};for(const F of O){const Z=F.key;if(R[Z.bucketInstanceId]===void 0&&(R[Z.bucketInstanceId]={}),R[Z.bucketInstanceId][Z.featureIndex])continue;const W=[new o.P(F.x1,F.y1),new o.P(F.x2,F.y1),new o.P(F.x2,F.y2),new o.P(F.x1,F.y2)];o.bX(h,W)&&(R[Z.bucketInstanceId][Z.featureIndex]=!0,z[Z.bucketInstanceId]===void 0&&(z[Z.bucketInstanceId]=[]),z[Z.bucketInstanceId].push(Z.featureIndex))}return z}insertCollisionBox(s,h,g,x,S){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:S},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,x,S){const T=h?this.ignoredGrid:this.grid,O={bucketInstanceId:g,featureIndex:x,collisionGroupID:S};for(let R=0;R<s.length;R+=4)T.insertCircle(O,s[R],s[R+1],s[R+2])}projectAndGetPerspectiveRatio(s,h,g,x,S,T,O){const R=[h,g,x,1];let z=!1;x||this.transform.pitch>0?(o.aC(R,R,s),this.fogState&&S&&O.name!=="globe"&&(z=function(W,K,ne,ee,ie,ce){const ge=ce.calculateFogTileMatrix(ie),pe=[K,ne,ee];return o.af(pe,pe,ge),ar(W,o.ag(pe),ce.pitch,ce._fov)}(this.fogState,h,g,x,S.toUnwrapped(),this.transform)>.9)):jy(R,R,s);const F=R[3];return{point:new o.P((R[0]/F+1)/2*this.transform.width+da,(-R[1]/F+1)/2*this.transform.height+da),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(O)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&R[2]>F||z}}isOffscreen(s,h,g,x){return g<da||s>=this.screenRightBoundary||x<da||h>this.screenBottomBoundary}isInsideGrid(s,h,g,x){return g>=0&&s<this.gridRightBoundary&&x>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=o.bA([]);return o.br(s,s,[-100,-100,0]),s}}class Sn{constructor(s,h,g,x){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):x&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class pn{constructor(s,h,g,x,S,T=!1){this.text=new Sn(s?s.text:null,h,g,S),this.icon=new Sn(s?s.icon:null,h,x,S),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ws{constructor(s,h,g,x=!1){this.text=s,this.icon=h,this.skipFade=g,this.clipped=x}}class gf{constructor(){this.invProjMatrix=o.bC(),this.viewportMatrix=o.bC(),this.circles=[]}}class Cn{constructor(s,h,g,x,S){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=x,this.tileID=S}}class Ny{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function yf(m,s,h,g,x){const{horizontalAlign:S,verticalAlign:T}=o.c1(m),O=-(S-.5)*s,R=-(T-.5)*h,z=o.c2(m,g);return new o.P(O+z[0]*x,R+z[1]*x)}function th(m,s,h,g,x){const S=new o.P(m,s);return h&&S._rotate(g?x:-x),S}class Os{constructor(s,h,g,x,S,T){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new tr(this.transform,S),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Ny(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(s,h,g,x,S=1){const T=g.getBucket(h),O=g.latestFeatureIndex;if(!T||!O||h.fqid!==T.layerIds[0])return;const R=T.layers[0].layout,z=T.layers[0].paint,F=g.collisionBoxArray,Z=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),W=g.tileSize/o.al,K=g.tileID.toUnwrapped();this.transform.setProjection(T.projection);const ne=(ee=g.tileID,ie=T.getProjection(),ce=this.transform,ie.name===this.projection?ce.calculateProjMatrix(ee.toUnwrapped()):Dy(ce,ie,ee));var ee,ie,ce;const ge=R.get("text-pitch-alignment")==="map",pe=R.get("text-rotation-alignment")==="map";h.compileFilter(h.options);const fe=h.dynamicFilter(),Ie=h.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(g),Pe=cu(ne,g.tileID.canonical,ge,pe,this.transform,T.getProjection(),Ee);let be=null;const ve=T.getProjection().createInversionMatrix(this.transform,g.tileID.canonical);if(ge){const Re=ua(ne,g.tileID.canonical,ge,pe,this.transform,T.getProjection(),Ee);be=o.aB([],this.transform.labelPlaneMatrix,Re)}let ke=null;fe&&g.latestFeatureIndex&&(ke={unwrappedTileID:K,dynamicFilter:fe,dynamicFilterNeedsFeature:Ie}),this.retainedQueryData[T.bucketInstanceId]=new Cn(T.bucketInstanceId,O,T.sourceLayerIndex,T.index,g.tileID);const[Ne,$e]=T.layers[0].layout.get("text-size-scale-range"),Je=o.aA(S,Ne,$e),[Xe,ht]=R.get("icon-size-scale-range"),vt=o.aA(S,Xe,ht),We={bucket:T,layout:R,paint:z,posMatrix:ne,invMatrix:ve,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Pe,labelToScreenMatrix:be,clippingData:ke,scale:Z,textPixelRatio:W,holdingForFade:g.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.bK(T.textSizeData,this.transform.zoom,Je),partiallyEvaluatedIconSize:o.bK(T.iconSizeData,this.transform.zoom,vt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:g.latestFeatureIndex};if(x)for(const Re of T.sortKeyRanges){const{sortKey:lt,symbolInstanceStart:Qe,symbolInstanceEnd:bt}=Re;s.push({sortKey:lt,symbolInstanceStart:Qe,symbolInstanceEnd:bt,parameters:We})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:We})}attemptAnchorPlacement(s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce,ge,pe,fe,Ie){const{textOffset0:Ee,textOffset1:Pe,crossTileID:be}=ee,ve=[Ee,Pe],ke=yf(s,T,O,ve,R),Ne=this.collisionIndex.placeCollisionBox(ce,R,h,g,x,S,th(ke.x,ke.y,z,F,this.transform.angle),ne,Z,W,K.predicate);if(pe){const $e=ce.getSymbolInstanceIconSize(Ie,this.transform.zoom,ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ce,$e,pe,g,x,S,th(ke.x,ke.y,z,F,this.transform.angle),ne,Z,W,K.predicate).box.length===0)return}if(Ne.box.length>0){let $e;return this.prevPlacement&&this.prevPlacement.variableOffsets[be]&&this.prevPlacement.placements[be]&&this.prevPlacement.placements[be].text&&($e=this.prevPlacement.variableOffsets[be].anchor),this.variableOffsets[be]={textOffset:ve,width:T,height:O,anchor:s,textScale:R,prevAnchor:$e},this.markUsedJustification(ce,s,ee,ge),ce.allowVerticalPlacement&&(this.markUsedOrientation(ce,ge,ee),this.placedOrientations[be]=ge),{shift:ke,placedGlyphBoxes:Ne}}}placeLayerBucketPart(s,h,g,x,S=1){const{bucket:T,layout:O,paint:R,posMatrix:z,textLabelPlaneMatrix:F,labelToScreenMatrix:Z,clippingData:W,textPixelRatio:K,mercatorCenter:ne,invMatrix:ee,holdingForFade:ie,collisionBoxArray:ce,partiallyEvaluatedTextSize:ge,partiallyEvaluatedIconSize:pe,collisionGroup:fe,latestFeatureIndex:Ie}=s.parameters,Ee=O.get("text-optional"),Pe=O.get("icon-optional"),be=O.get("text-allow-overlap"),ve=O.get("icon-allow-overlap"),ke=O.get("text-rotation-alignment")==="map",Ne=O.get("icon-rotation-alignment")==="map",$e=O.get("text-pitch-alignment")==="map",Je=R.get("symbol-z-offset"),Xe=O.get("symbol-elevation-reference")==="sea",ht=O.get("symbol-placement"),[vt,We]=O.get("text-size-scale-range"),[Re,lt]=O.get("icon-size-scale-range"),Qe=o.aA(S,vt,We),bt=o.aA(S,Re,lt),At=O.get("text-variable-anchor"),Lt=ke&&ht!=="point",Pt=Ne&&ht!=="point",It=At&&T.hasTextData(),Kt=T.hasIconTextFit()&&It&&T.hasIconData();this.transform.setProjection(T.projection);const Xt=It||Lt,Bt=Pt||Kt;let Zt=be&&(ve||!T.hasIconData()||Pe),or=ve&&(be||!T.hasTextData()||Ee);const yr=!Je.isConstant();!T.collisionArrays&&ce&&T.deserializeCollisionBoxes(ce),g&&x&&T.updateCollisionDebugBuffers(this.transform.zoom,ce,Qe,bt);const Lr=(Tr,ln,Cr)=>{const{crossTileID:In,numVerticalGlyphVertices:An}=Tr;let kn=null;if(W&&W.dynamicFilterNeedsFeature||yr){const mi=this.retainedQueryData[T.bucketInstanceId];kn=Ie.loadFeature({featureIndex:Tr.featureIndex,bucketIndex:mi.bucketIndex,sourceLayerIndex:mi.sourceLayerIndex,layoutVertexArrayOffset:0});const Fi=kn.properties?kn.properties.worldview:null;if(T.localizable&&T.worldview&&typeof Fi=="string")if(Fi==="all")kn.properties.$localized=!0;else{if(!Fi.split(",").includes(T.worldview))return;kn.properties.$localized=!0,kn.properties.worldview=T.worldview}}if(W&&!(0,W.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},kn,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new o.P(Tr.tileAnchorX,Tr.tileAnchorY),this.transform.calculateDistanceTileData(W.unwrappedTileID)))return this.placements[In]=new Ws(!1,!1,!1,!0),void h.add(In);const en=Je.evaluate(kn,{});if(h.has(In))return;if(ie)return void(this.placements[In]=new Ws(!1,!1,!1));let kr=!1,yn=!1,hi=!0,fi=!1,_n=!1,qr=null,Rr={box:null,offscreen:null,occluded:null},Zn={box:null},wi=null,Jn=null,ri=null,Ys=0,ga=0,Do=0;Cr.textFeatureIndex?Ys=Cr.textFeatureIndex:Tr.useRuntimeCollisionCircles&&(Ys=Tr.featureIndex),Cr.verticalTextFeatureIndex&&(ga=Cr.verticalTextFeatureIndex);const vn=T.elevationFeatures?T.elevationFeatures[Tr.elevationFeatureIndex]:void 0,Oa=mi=>{mi.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Fi=this.transform.elevation;mi.elevation=Xe?en:en+o.bV.getAtTileOffset(mi.tileID,new o.P(mi.tileAnchorX,mi.tileAnchorY),Fi,vn),mi.elevation+=Tr.zOffset},cs=Cr.textBox;if(cs){Oa(cs);const mi=Qn=>{let eo=o.bL.horizontal;if(T.allowVerticalPlacement&&!Qn&&this.prevPlacement){const gs=this.prevPlacement.placedOrientations[In];gs&&(this.placedOrientations[In]=gs,eo=gs,this.markUsedOrientation(T,eo,Tr))}return eo},Fi=(Qn,eo)=>{if(T.allowVerticalPlacement&&An>0&&Cr.verticalTextBox){for(const gs of T.writingModes)if(gs===o.bL.vertical?(Rr=eo(),Zn=Rr):Rr=Qn(),Rr&&Rr.box&&Rr.box.length)break}else Rr=Qn()};if(At){let Qn=At;if(this.prevPlacement&&this.prevPlacement.variableOffsets[In]){const Mi=this.prevPlacement.variableOffsets[In];Qn.indexOf(Mi.anchor)>0&&(Qn=Qn.filter(ka=>ka!==Mi.anchor),Qn.unshift(Mi.anchor))}const eo=(Mi,ka,Ym)=>{const Pc=T.getSymbolInstanceTextSize(ge,Tr,this.transform.zoom,ln),$f=(Mi.x2-Mi.x1)*Pc+2*Mi.padding,Vf=(Mi.y2-Mi.y1)*Pc+2*Mi.padding,Ra=Tr.hasIconTextFit&&!ve?ka:null;Ra&&Oa(Ra);let Cc={box:[],offscreen:!1,occluded:!1};const Ic=be?2*Qn.length:Qn.length;for(let rl=0;rl<Ic;++rl){const gu=this.attemptAnchorPlacement(Qn[rl%Qn.length],Mi,ne,ee,Xt,$f,Vf,Pc,ke,$e,K,z,fe,rl>=Qn.length,Tr,ln,T,Ym,Ra,ge,pe);if(gu&&(Cc=gu.placedGlyphBoxes,Cc&&Cc.box&&Cc.box.length)){kr=!0,qr=gu.shift;break}}return Cc};Fi(()=>eo(cs,Cr.iconBox,o.bL.horizontal),()=>{const Mi=Cr.verticalTextBox;return Mi&&Oa(Mi),T.allowVerticalPlacement&&!(Rr&&Rr.box&&Rr.box.length)&&An>0&&Mi?eo(Mi,Cr.verticalIconBox,o.bL.vertical):{box:null,offscreen:null,occluded:null}}),Rr&&(kr=Rr.box,hi=Rr.offscreen,fi=Rr.occluded);const gs=mi(!(!Rr||!Rr.box));if(!kr&&this.prevPlacement){const Mi=this.prevPlacement.variableOffsets[In];Mi&&(this.variableOffsets[In]=Mi,this.markUsedJustification(T,Mi.anchor,Tr,gs))}}else{const Qn=(eo,gs)=>{const Mi=T.getSymbolInstanceTextSize(ge,Tr,this.transform.zoom,ln),ka=this.collisionIndex.placeCollisionBox(T,Mi,eo,ne,ee,Xt,new o.P(0,0),be,K,z,fe.predicate);return ka&&ka.box&&ka.box.length&&(this.markUsedOrientation(T,gs,Tr),this.placedOrientations[In]=gs),ka};Fi(()=>Qn(cs,o.bL.horizontal),()=>{const eo=Cr.verticalTextBox;return T.allowVerticalPlacement&&An>0&&eo?(Oa(eo),Qn(eo,o.bL.vertical)):{box:null,offscreen:null,occluded:null}}),mi(!!(Rr&&Rr.box&&Rr.box.length))}}if(wi=Rr,kr=wi&&wi.box&&wi.box.length>0,hi=wi&&wi.offscreen,fi=wi&&wi.occluded,Tr.useRuntimeCollisionCircles){const mi=Tr.centerJustifiedTextSymbolIndex>=0?Tr.centerJustifiedTextSymbolIndex:Tr.verticalPlacedTextSymbolIndex,Fi=T.text.placedSymbolArray.get(mi),Qn=o.bM(T.textSizeData,ge,Fi),eo=O.get("text-padding");Jn=this.collisionIndex.placeCollisionCircles(T,be,Fi,mi,T.lineVertexArray,T.glyphOffsetArray,Qn,z,F,Z,g,$e,fe.predicate,Tr.collisionCircleDiameter*Qn/o.bY,eo,this.retainedQueryData[T.bucketInstanceId].tileID),kr=be||Jn.circles.length>0&&!Jn.collisionDetected,hi=hi&&Jn.offscreen,fi=Jn.occluded}if(Cr.iconFeatureIndex&&(Do=Cr.iconFeatureIndex),Cr.iconBox){const mi=Fi=>{Oa(Fi);const Qn=Tr.hasIconTextFit&&qr?th(qr.x,qr.y,ke,$e,this.transform.angle):new o.P(0,0),eo=T.getSymbolInstanceIconSize(pe,this.transform.zoom,Tr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,eo,Fi,ne,ee,Bt,Qn,ve,K,z,fe.predicate)};Zn&&Zn.box&&Zn.box.length&&Cr.verticalIconBox?(ri=mi(Cr.verticalIconBox),yn=ri.box.length>0):(ri=mi(Cr.iconBox),yn=ri.box.length>0),hi=hi&&ri.offscreen,_n=ri.occluded}const ya=Ee||Tr.numHorizontalGlyphVertices===0&&An===0,Ol=Pe||Tr.numIconVertices===0;if(ya||Ol?Ol?ya||(yn=yn&&kr):kr=yn&&kr:yn=kr=yn&&kr,kr&&wi&&wi.box&&this.collisionIndex.insertCollisionBox(wi.box,O.get("text-ignore-placement"),T.bucketInstanceId,Zn&&Zn.box&&ga?ga:Ys,fe.ID),yn&&ri&&this.collisionIndex.insertCollisionBox(ri.box,O.get("icon-ignore-placement"),T.bucketInstanceId,Do,fe.ID),Jn&&(kr&&this.collisionIndex.insertCollisionCircles(Jn.circles,O.get("text-ignore-placement"),T.bucketInstanceId,Ys,fe.ID),g)){const mi=T.bucketInstanceId;let Fi=this.collisionCircleArrays[mi];Fi===void 0&&(Fi=this.collisionCircleArrays[mi]=new gf);for(let Qn=0;Qn<Jn.circles.length;Qn+=4)Fi.circles.push(Jn.circles[Qn+0]),Fi.circles.push(Jn.circles[Qn+1]),Fi.circles.push(Jn.circles[Qn+2]),Fi.circles.push(Jn.collisionDetected?1:0)}const Js=T.projection.name!=="globe";Zt=Zt&&(Js||!fi),or=or&&(Js||!_n),this.placements[In]=new Ws(kr||Zt,yn||or,hi||T.justReloaded),h.add(In)},Jr=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Jr),T.elevationType==="road"&&T.updateRoadElevation(Jr.canonical),T.updateZOffset(),T.sortFeaturesByY){const Tr=T.getSortedSymbolIndexes(this.transform.angle);for(let ln=Tr.length-1;ln>=0;--ln){const Cr=Tr[ln];Lr(T.symbolInstances.get(Cr),Cr,T.collisionArrays[Cr])}T.hasAnyZOffset&&o.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Tr=T.getSortedIndexesByZOffset();for(let ln=0;ln<Tr.length;++ln){const Cr=Tr[ln];Lr(T.symbolInstances.get(Cr),Cr,T.collisionArrays[Cr])}}else for(let Tr=s.symbolInstanceStart;Tr<s.symbolInstanceEnd;Tr++)Lr(T.symbolInstances.get(Tr),Tr,T.collisionArrays[Tr]);if(g&&T.bucketInstanceId in this.collisionCircleArrays){const Tr=this.collisionCircleArrays[T.bucketInstanceId];o.bl(Tr.invProjMatrix,z),Tr.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(s,h,g,x){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:R,crossTileID:z}=g,F=o.c3(h),Z=x===o.bL.vertical?R:F==="left"?S:F==="center"?T:F==="right"?O:-1;S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=Z>=0&&S!==Z?0:z),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=Z>=0&&T!==Z?0:z),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=Z>=0&&O!==Z?0:z),R>=0&&(s.text.placedSymbolArray.get(R).crossTileID=Z>=0&&R!==Z?0:z)}markUsedOrientation(s,h,g){const x=h===o.bL.horizontal||h===o.bL.horizontalOnly?h:0,S=h===o.bL.vertical?h:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:z}=g,F=s.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=x),O>=0&&(F.get(O).placedOrientation=x),R>=0&&(F.get(R).placedOrientation=x),z>=0&&(F.get(z).placedOrientation=S)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const x=h?h.symbolFadeChange(s):1,S=h?h.opacities:{},T=h?h.variableOffsets:{},O=h?h.placedOrientations:{};for(const R in this.placements){const z=this.placements[R],F=S[R];F?(this.opacities[R]=new pn(F,x,z.text,z.icon,null,z.clipped),g=g||z.text!==F.text.placed||z.icon!==F.icon.placed):(this.opacities[R]=new pn(null,x,z.text,z.icon,z.skipFade,z.clipped),g=g||z.text||z.icon)}for(const R in S){const z=S[R];if(!this.opacities[R]){const F=new pn(z,x,!1,!1);F.isHidden()||(this.opacities[R]=F,g=g||z.text.placed||z.icon.placed)}}for(const R in T)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=T[R]);for(const R in O)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=O[R]);g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h,g,x){x&&(this.lastReplacementSourceUpdateTime=x.updateTime);const S=new Set;for(const T of h){const O=T.getBucket(s);O&&T.latestFeatureIndex&&s.fqid===O.layerIds[0]&&(this.updateBucketOpacities(O,S,T,T.collisionBoxArray,g,x,T.tileID,s.scope),O.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(O,T.tileID),O.elevationType==="road"&&O.updateRoadElevation(T.tileID.canonical),O.updateZOffset())}}updateBucketOpacities(s,h,g,x,S,T,O,R){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const z=s.layers[0].layout,F=s.layers[0].paint,Z=!!s.layers[0].dynamicFilter(),W=new pn(null,0,!1,!1,!0),K=z.get("text-allow-overlap"),ne=z.get("icon-allow-overlap"),ee=z.get("text-variable-anchor"),ie=z.get("text-rotation-alignment")==="map",ce=z.get("text-pitch-alignment")==="map",ge=F.get("symbol-z-offset"),pe=z.get("symbol-elevation-reference")==="sea",fe=!ge.isConstant(),Ie=new pn(null,0,K&&(ne||!s.hasIconData()||z.get("icon-optional")),ne&&(K||!s.hasTextData()||z.get("text-optional")),!0);!s.collisionArrays&&x&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(x);const Ee=(be,ve,ke)=>{for(let Ne=0;Ne<ve/4;Ne++)be.opacityVertexArray.emplaceBack(ke)};let Pe=0;T&&s.updateReplacement(O,T);for(let be=0;be<s.symbolInstances.length;be++){const ve=s.symbolInstances.get(be),{numHorizontalGlyphVertices:ke,numVerticalGlyphVertices:Ne,crossTileID:$e,numIconVertices:Je,tileAnchorX:Xe,tileAnchorY:ht}=ve;let vt=null;const We=this.retainedQueryData[s.bucketInstanceId];fe&&ve&&We&&(vt=g.latestFeatureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:We.bucketIndex,sourceLayerIndex:We.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=ge.evaluate(vt,{}),lt=h.has($e);let Qe=this.opacities[$e];lt?Qe=W:Qe||(Qe=Ie,this.opacities[$e]=Qe),h.add($e);const bt=ke>0||Ne>0,At=Je>0,Lt=this.placedOrientations[$e],Pt=Lt===o.bL.vertical,It=Lt===o.bL.horizontal||Lt===o.bL.horizontalOnly;!bt&&!At||Qe.isHidden()||Pe++;let Kt=!1;if((bt||At)&&T)for(const Xt of s.activeReplacements){if(o.bZ(Xt,S,o.b_.Symbol,R)||Xt.min.x>Xe||Xe>Xt.max.x||Xt.min.y>ht||ht>Xt.max.y)continue;const Bt=o.b$(Xe,ht,O.canonical,Xt.footprintTileId.canonical);if(Kt=o.c0(Bt,Xt.footprint),Kt)break}if(bt){const Xt=Kt?ha:ks(Qe.text);Ee(s.text,ke,Pt?ha:Xt),Ee(s.text,Ne,It?ha:Xt);const Bt=Qe.text.isHidden(),{leftJustifiedTextSymbolIndex:Zt,centerJustifiedTextSymbolIndex:or,rightJustifiedTextSymbolIndex:yr,verticalPlacedTextSymbolIndex:Lr}=ve,Jr=s.text.placedSymbolArray,Tr=Bt||Pt?1:0;Zt>=0&&(Jr.get(Zt).hidden=Tr),or>=0&&(Jr.get(or).hidden=Tr),yr>=0&&(Jr.get(yr).hidden=Tr),Lr>=0&&(Jr.get(Lr).hidden=Bt||It?1:0);const ln=this.variableOffsets[$e];ln&&this.markUsedJustification(s,ln.anchor,ve,Lt);const Cr=this.placedOrientations[$e];Cr&&(this.markUsedJustification(s,"left",ve,Cr),this.markUsedOrientation(s,Cr,ve))}if(At){const Xt=Kt?ha:ks(Qe.icon),{placedIconSymbolIndex:Bt,verticalPlacedIconSymbolIndex:Zt}=ve,or=s.icon.placedSymbolArray,yr=Qe.icon.isHidden()?1:0;Bt>=0&&(Ee(s.icon,Je,Pt?ha:Xt),or.get(Bt).hidden=yr),Zt>=0&&(Ee(s.icon,ve.numVerticalIconVertices,It?ha:Xt),or.get(Zt).hidden=yr)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Xt=s.collisionArrays[be];if(Xt){let Bt=new o.P(0,0),Zt=!0;if(Xt.textBox||Xt.verticalTextBox){if(ee){const yr=this.variableOffsets[$e];yr?(Bt=yf(yr.anchor,yr.width,yr.height,yr.textOffset,yr.textScale),ie&&Bt._rotate(ce?this.transform.angle:-this.transform.angle)):Zt=!1}Z&&(Zt=!Qe.clipped),Xt.textBox&&Vi(s.textCollisionBox.collisionVertexArray,Qe.text.placed,!Zt||Pt,Re,pe,Bt.x,Bt.y),Xt.verticalTextBox&&Vi(s.textCollisionBox.collisionVertexArray,Qe.text.placed,!Zt||It,Re,pe,Bt.x,Bt.y)}const or=Zt&&!!(!It&&Xt.verticalIconBox);Xt.iconBox&&Vi(s.iconCollisionBox.collisionVertexArray,Qe.icon.placed,or,Re,pe,ve.hasIconTextFit?Bt.x:0,ve.hasIconTextFit?Bt.y:0),Xt.verticalIconBox&&Vi(s.iconCollisionBox.collisionVertexArray,Qe.icon.placed,!or,Re,pe,ve.hasIconTextFit?Bt.x:0,ve.hasIconTextFit?Bt.y:0)}}}if(s.fullyClipped=Pe===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=be.invProjMatrix,s.placementViewportMatrix=be.viewportMatrix,s.collisionCircleArray=be.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}isStale(){return this.stale}setStale(){this.stale=!0}}function Vi(m,s,h,g,x,S,T){m.emplaceBack(s?1:0,h?1:0,S||0,T||0,g,x?1:0),m.emplaceBack(s?1:0,h?1:0,S||0,T||0,g,x?1:0),m.emplaceBack(s?1:0,h?1:0,S||0,T||0,g,x?1:0),m.emplaceBack(s?1:0,h?1:0,S||0,T||0,g,x?1:0)}const aR=Math.pow(2,25),_m=Math.pow(2,24),Bx=Math.pow(2,17),vm=Math.pow(2,16),zy=Math.pow(2,9),$x=Math.pow(2,8),Fy=Math.pow(2,1);function ks(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const s=m.placed?1:0,h=Math.floor(127*m.opacity);return h*aR+s*_m+h*Bx+s*vm+h*zy+s*$x+h*Fy+s}const ha=0;class fa{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,h,g,x,S,T){const O=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(O,x,s[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<O.length;){const R=O[this._currentPartIndex];if(h.placeLayerBucketPart(R,this._seenCrossTileIDs,g,R.symbolInstanceStart===0,T),this._currentPartIndex++,S())return!0}return!1}}class Vx{startNewPlacement(s,h,g,x,S,T,O,R){return this.placement=new Os(s,x,S,T,O,R),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=g,this._fadeDuration=x,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(s,h,g,x,S){const T=o.o.now(),O=()=>{const R=o.o.now()-T;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&R>2};for(;this._currentPlacementIndex>=0;){const R=h[s[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&R.visibility!=="none"&&(!R.minzoom||R.minzoom<=z)&&(!R.maxzoom||R.maxzoom>z)){const F=R,Z=F.layout.get("symbol-z-elevate"),W=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,K=F.layout.get("symbol-z-order"),ne=K==="viewport-y"||K==="auto"&&!(K!=="viewport-y"&&W),ee=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),ie=ne&&ee,ce=this._inProgressLayer=this._inProgressLayer||new fa(F),ge=o.B(R.source,R.scope);if(ce.continuePlacement(Z||ie?x[ge]:g[ge],this.placement,this._showCollisionBoxes,R,O,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Qu=512/o.al/2;class Co{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this.index=new o.c4(h.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=s.canonical.x*o.al,S=s.canonical.y*o.al;for(let T=0;T<h.length;T++){const{key:O,crossTileID:R,tileAnchorX:z,tileAnchorY:F}=h.get(T),Z=Math.floor((x+z)*Qu),W=Math.floor((S+F)*Qu);this.index.add(Z,W),this.keys.push(O),this.crossTileIDs.push(R)}this.index.finish()}findMatches(s,h,g){const x=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z),S=Qu/Math.pow(2,h.canonical.z-this.tileID.canonical.z),T=h.canonical.x*o.al,O=h.canonical.y*o.al;for(let R=0;R<s.length;R++){const z=s.get(R);if(z.crossTileID)continue;const{key:F,tileAnchorX:Z,tileAnchorY:W}=z,K=Math.floor((T+Z)*S),ne=Math.floor((O+W)*S),ee=this.index.range(K-x,ne-x,K+x,ne+x).sort((ie,ce)=>ie-ce);for(const ie of ee){const ce=this.crossTileIDs[ie];if(this.keys[ie]===F&&!g.has(ce)){g.add(ce),z.crossTileID=ce;break}}}}}class vc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const g in this.indexes){const x=this.indexes[g],S={};for(const T in x){const O=x[T];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+h),S[O.tileID.key]=O}this.indexes[g]=S}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let S=0;S<h.symbolInstances.length;S++)h.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const x=this.usedCrossTileIDs[s.overscaledZ];for(const S in this.indexes){const T=this.indexes[S];if(Number(S)>s.overscaledZ)for(const O in T){const R=T[O];R.tileID.isChildOf(s)&&R.findMatches(h.symbolInstances,s,x)}else{const O=T[s.scaledTo(Number(S)).key];O&&O.findMatches(h.symbolInstances,s,x)}}for(let S=0;S<h.symbolInstances.length;S++){const T=h.symbolInstances.get(S);T.crossTileID||(T.crossTileID=g.generate(),x.add(T.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Co(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const g of h.crossTileIDs)this.usedCrossTileIDs[s].delete(g)}removeStaleBuckets(s){let h=!1;for(const g in this.indexes){const x=this.indexes[g];for(const S in x)s[x[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,x[S]),delete x[S],h=!0)}return h}}class mo{constructor(){this.layerIndexes={},this.crossTileIDs=new vc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g,x){let S=this.layerIndexes[s.fqid];S===void 0&&(S=this.layerIndexes[s.fqid]=new uu);let T=!1;const O={};x.name!=="globe"&&S.handleWrapJump(g);for(const R of h){const z=R.getBucket(s);z&&s.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(R.tileID,z,this.crossTileIDs)&&(T=!0),O[z.bucketInstanceId]=!0)}return S.removeStaleBuckets(O)&&(T=!0),T}pruneUnusedLayers(s){const h={};s.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const ed=771;class Er{constructor(s,h,g,x){this.blendFunction=s,this.blendColor=h.toNonPremultipliedRenderColor(null),this.mask=g,this.blendEquation=x}}Er.Replace=[1,0,1,0],Er.disabled=new Er(Er.Replace,o.ao.transparent,[!1,!1,!1,!1]),Er.unblended=new Er(Er.Replace,o.ao.transparent,[!0,!0,!0,!0]),Er.alphaBlended=new Er([1,ed,1,ed],o.ao.transparent,[!0,!0,!0,!0]),Er.alphaBlendedNonPremultiplied=new Er([770,ed,770,ed],o.ao.transparent,[!0,!0,!0,!0]),Er.multiply=new Er([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),Er.additive=new Er([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Qt{constructor(s,h,g){this.func=s,this.mask=h,this.range=g}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const _f=7680;class xr{constructor(s,h,g,x,S,T){this.test=s,this.ref=h,this.mask=g,this.fail=x,this.depthFail=S,this.pass=T}}xr.disabled=new xr({func:519,mask:0},0,0,_f,_f,_f);const By=1029,xm=2305;class gr{constructor(s,h,g){this.enable=s,this.mode=h,this.frontFace=g}}function Ux(m,s){const h=o.ca(m,3);o.cc(m,s),o.cg(m,3,h)}function Gx(m,s){const h=o.c7([]);return o.c8(h,h,-s),o.c9(h,h,-m),h}function xc(m,s){const h=[m[0],m[1],0],g=[s[0],s[1],0];if(o.ag(h)>=1e-15){const T=o.aw([],h);o.c5(g,T,o.bJ(g,T)),s[0]=g[0],s[1]=g[1]}const x=o.bI([],s,m);if(o.c6(x)<1e-15)return null;const S=Math.atan2(-x[1],x[0]);return Gx(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),S)}gr.disabled=new gr(!1,By,xm),gr.backCCW=new gr(!0,By,xm),gr.backCW=new gr(!0,By,2304),gr.frontCW=new gr(!0,1028,2304),gr.frontCCW=new gr(!0,1028,xm);class bE{constructor(s,h){this.position=s,this.orientation=h}get position(){return this._position}set position(s){if(s){const h=s instanceof o.ae?s:new o.ae(s[0],s[1],s[2]);this._renderWorldCopies&&(h.x=o.bT(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(s,h,g){if(this.orientation=null,!this.position)return;const x=this.position,S=g||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(s)):0),T=o.ae.fromLngLat(s,S),O=[T.x-x.x,T.y-x.y,T.z-x.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=xc(O,h)}setPitchBearing(s,h){this.orientation=Gx(o.an(s),o.an(-h))}}class vf{constructor(s,h){this._transform=o.bA([]),this.orientation=h,this.position=s}get mercatorPosition(){const s=this.position;return new o.ae(s[0],s[1],s[2])}get position(){const s=o.ca(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var h;s&&o.cg(this._transform,3,[(h=s)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||o.c7([]),s&&Ux(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,h){this._orientation=Gx(s,h),Ux(this._transform,this._orientation)}forward(){const s=o.ca(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=o.ca(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=o.ca(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,h){const g=new Float64Array(16);return o.bl(g,this.getWorldToCamera(s,h)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,h,g){const x=this.position;o.c5(x,x,-s);const S=new Float64Array(16);return o.bq(S,[g,g,g]),o.br(S,S,x),S[10]*=h,S}getWorldToCamera(s,h){const g=new Float64Array(16),x=new Float64Array(4),S=this.position;return o.cb(x,this._orientation),o.c5(S,S,-s),o.cc(g,x),o.br(g,g,S),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=h,g[9]*=h,g[10]*=h,g[11]*=h,g}getCameraToClipPerspective(s,h,g,x){const S=new Float64Array(16);return o.cd(S,s,h,g,x),S}getCameraToClipOrthographic(s,h,g,x,S,T){const O=new Float64Array(16);return o.ce(O,s,h,g,x,S,T),O}getDistanceToElevation(s,h=!1){const g=s===0?0:o.cf(s,h?o.a$(this.position[1]):this.position[1]),x=this.forward();return(g-this.position[2])/x[2]}clone(){return new vf([...this.position],[...this.orientation])}}const pa=(m,s)=>({u_matrix:m,u_ground_shadow_factor:s});class qx{constructor(s=0,h=0,g=0,x=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=x}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=o.ak(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=o.ak(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=o.ak(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=o.ak(s.right,h.right,g)),this}getCenter(s,h){const g=o.aA((this.left+s-this.right)/2,0,s),x=o.aA((this.top+h-this.bottom)/2,0,h);return new o.P(g,x)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new qx(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const bc=15;class $y{constructor(s,h,g,x,S,T,O){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=x??60,this.setProjection(T),this.setMaxBounds(O),this.width=0,this.height=0,this._center=new o.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qx,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new vf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new $y(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<bc}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,h=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(s||g)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=o.cm(this.projectionOptions);const g=this.getProjection(),x=!o.by(h,g);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cm({name:"mercator"});const h=s!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bT(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const h=-s*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=o.cn(),o.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=o.aA(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=o.an(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,h=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!h||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const g=this._elevation;h||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let x=0,S=0;for(let T=0;T<h.length;T++){const O=new o.P(h[T][0]*this.width,g+h[T][1]*(this.height-g)),R=s.pointCoordinate(O);if(!R)continue;const z=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);x+=R[3]*z,S+=z}return S===0?NaN:x/S}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*h,x=this._mercatorZfromZoom(s),S=this._mercatorZfromZoom(this._maxZoom),T=Math.max(x-g,S);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}equals(s){const h=this.elevation,g=s.elevation,x=h!=null!=(g!=null)||h&&g&&h.exaggeration()!==g.exaggeration();return this.width===s.width&&this.height===s.height&&this.center.lng===s.center.lng&&this.center.lat===s.center.lat&&this.zoom===s.zoom&&this.bearing===s.bearing&&this.pitch===s.pitch&&this.fov===s.fov&&this.projection.name===s.projection.name&&this._edgeInsets.equals(s.padding)&&!x}computeZoomRelativeTo(s){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let g;g=s.z<this._camera.position[2]?[h.x,h.y,h.z]:[s.x,s.y,s.z];const x=o.ag(o.av([],this._camera.position,g));return o.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let h=!1;if(s.orientation&&!o.cp(s.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(s.orientation)),s.position){const g=[s.position.x,s.position.y,s.position.z];o.cq(g,this._camera.position)||(this._setCameraPosition(g),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,h=new bE;return h.position=new o.ae(s[0],s[1],s[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(s){if(!o.cr(s))return!1;o.cs(s,s);const h=o.ct([],[0,0,-1],s),g=o.ct([],[0,-1,0],s);if(g[2]<0)return!1;const x=xc(h,g);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(s){const h=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;s[2]=o.aA(s[2],x/g,x/h),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new o.cu(0,s)];if(this.renderWorldCopies){const g=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),S=this.pointCoordinate(new o.P(this.width,this.height)),T=this.pointCoordinate(new o.P(0,this.height)),O=Math.floor(Math.min(g.x,x.x,S.x,T.x)),R=Math.floor(Math.max(g.x,x.x,S.x,T.x)),z=1;for(let F=O-z;F<=R+z;F++)F!==0&&h.push(new o.cu(F,s))}return h}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,h,g,x){let S=[];const T=g!=null,O=!T;if(O&&this.zoom<h||T&&g[0]===0&&g[1]===0)return S;const R=new Set,z=(Z,W,K,ne,ee)=>{const ie=o.cY(W,Z,K,ne,ee);R.has(ie)||(S.push(new o.aQ(Z,W,K,ne,ee)),R.add(ie))};for(let Z=0;Z<s.length;Z++){const W=s[Z];if(O&&W.canonical.z!==h||T&&x!==void 0&&x>W.canonical.z)continue;const K=W.canonical,ne=W.overscaledZ,ee=W.wrap,ie=1<<K.z,ce=K.x+1<ie,ge=K.x>0,pe=K.y+1<ie,fe=K.y>0,Ie=W.wrap-(ge?0:1),Ee=W.wrap+(ce?0:1),Pe=ge?K.x-1:ie-1,be=ce?K.x+1:0;if(T)g[0]<0?(z(ne,Ee,K.z,be,K.y),g[1]<0&&pe&&(z(ne,ee,K.z,K.x,K.y+1),z(ne,Ee,K.z,be,K.y+1)),g[1]>0&&fe&&(z(ne,ee,K.z,K.x,K.y-1),z(ne,Ee,K.z,be,K.y-1))):g[0]>0?(z(ne,Ie,K.z,Pe,K.y),g[1]<0&&pe&&(z(ne,ee,K.z,K.x,K.y+1),z(ne,Ie,K.z,Pe,K.y+1)),g[1]>0&&fe&&(z(ne,ee,K.z,K.x,K.y-1),z(ne,Ie,K.z,Pe,K.y-1))):g[1]<0&&pe?z(ne,ee,K.z,K.x,K.y+1):fe&&z(ne,ee,K.z,K.x,K.y-1);else{const ve=W.visibleQuadrants;1&ve&&(z(ne,Ie,K.z,Pe,K.y),fe&&(z(ne,ee,K.z,K.x,K.y-1),z(ne,Ie,K.z,Pe,K.y-1))),2&ve&&(z(ne,Ee,K.z,be,K.y),fe&&(z(ne,ee,K.z,K.x,K.y-1),z(ne,Ee,K.z,be,K.y-1))),4&ve&&(z(ne,Ie,K.z,Pe,K.y),pe&&(z(ne,ee,K.z,K.x,K.y+1),z(ne,Ie,K.z,Pe,K.y+1))),8&ve&&(z(ne,Ee,K.z,be,K.y),pe&&(z(ne,ee,K.z,K.x,K.y+1),z(ne,Ee,K.z,be,K.y+1)))}}const F=[];for(const Z of S)S.some(W=>Z.isChildOf(W))||F.push(Z);if(S=F.filter(Z=>!s.some(W=>!!(Z.overscaledZ<h&&W.isChildOf(Z))||Z.equals(W)||Z.isChildOf(W))),O){const Z=1<<h,W=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=[Z*W.x,Z*W.y],ne=4,ee=ne*ne;S=S.filter(ie=>{const ce=ie.canonical.x+.5-K[0],ge=ie.canonical.y+.5-K[1];return ce*ce+ge*ge<ee})}return S}extendTileCoverToNearPlane(s,h,g){const x=[],S=new Set;for(const ge of s)S.add(ge.key);const T=(ge,pe,fe,Ie,Ee)=>{const Pe=o.cY(pe,ge,fe,Ie,Ee);S.has(Pe)||(x.push(new o.aQ(ge,pe,fe,Ie,Ee)),S.add(Pe))},O=s.reduce((ge,pe)=>Math.max(ge,pe.overscaledZ),g),R=1<<g,z=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],F=new o.P(0,0),Z=new o.P(0,0),W=(ge,pe)=>{const fe=Math.floor(ge[0]),Ie=Math.floor(ge[1]),Ee=(ge[0]-fe)*o.al,Pe=(ge[1]-Ie)*o.al,be=Math.floor(pe[0]),ve=Math.floor(pe[1]),ke=(pe[0]-be)*o.al,Ne=(pe[1]-ve)*o.al;for(let $e=-1;$e<=1;$e++){const Je=fe+$e;if(!(Je<0||Je>=R)){F.x=Ee-$e*o.al,Z.x=ke-(Je-be)*o.al;for(let Xe=-1;Xe<=1;Xe++){const ht=Ie+Xe;F.y=Pe-Xe*o.al,Z.y=Ne-(ht-ve)*o.al,o.cZ(F,Z,z)&&T(O,0,g,Je,ht)}}}},K=h.points,ne=K[o.cv],ee=K[o.cw],ie=this._projectToGround(ne,K[o.cx]),ce=this._projectToGround(ee,K[o.cy]);return W(ne,ie),W(ee,ce),x}_projectToGround(s,h){return o.cz(o.cA(),s,h,s[2]/(s[2]-h[2]))}coveringTiles(s){let h=this.coveringZoomLevel(s);const g=h,x=this.elevation&&this.elevation.exaggeration(),S=x&&!s.isTerrainDEM,T=this.projection.name==="mercator";if(s.minzoom!==void 0&&h<s.minzoom)return[];s.maxzoom!==void 0&&h>s.maxzoom&&(h=s.maxzoom);const O=this.locationCoordinate(this.center),R=this.center.lat,z=1<<h,F=[z*O.x,z*O.y,0],Z=this.projection.name==="globe",W=!Z,K=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,W),ne=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=z*o.cf(1,this.center.lat),ie=this._camera.position[2]/o.cf(1,this.center.lat),ce=[z*ne.x,z*ne.y,ie*(W?1:ee)],ge=Z||x,pe=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),fe=this.isLODDisabled(!0)?h:0;let Ie;if(this._elevation&&s.isTerrainDEM)Ie=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();Ie=Re?Re.max:this._centerAltitude}else Ie=this._centerAltitude;const Ee=s.isTerrainDEM?-Ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,Pe=this.projection.isReprojectedInTileSpace?o.cC(this):1,be=Re=>{const Qe=new o.ae(Re.x+25e-6,Re.y,Re.z),bt=new o.ae(Re.x,Re.y+25e-6,Re.z),At=Re.toLngLat(),Lt=Qe.toLngLat(),Pt=bt.toLngLat(),It=this.locationCoordinate(At),Kt=this.locationCoordinate(Lt),Xt=this.locationCoordinate(Pt),Bt=Math.hypot(Kt.x-It.x,Kt.y-It.y),Zt=Math.hypot(Xt.x-It.x,Xt.y-It.y);return Math.sqrt(Bt*Zt)*Pe/25e-6},ve=Re=>{const lt=Ie,Qe=Ee;return{aabb:o.cF(this,z,0,0,0,Re,Qe,lt,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:lt,wrap:Re,fullyVisible:!1}},ke=[];let Ne=[];const $e=h,Je=s.reparseOverscaled?g:h,Xe=(ie-this._centerAltitude)*ee,ht=Re=>{if(!this._elevation||!Re.tileID||!T)return;const lt=this._elevation.getMinMaxForTile(Re.tileID),Qe=Re.aabb;lt?(Qe.min[2]=lt.min,Qe.max[2]=lt.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Re.shouldSplit=We(Re),Re.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},vt=(Re,lt)=>{if(.707*lt<Re)return 1;const Qe=lt/Re;return Qe/(1.4144271570014144+(Math.pow(1.1,Qe-1.4144271570014144+1)-1)/(1.1-1)-1)},We=Re=>{if(Re.zoom<fe)return!0;if(Re.zoom===$e)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const lt=Re.aabb.distanceX(ce),Qe=Re.aabb.distanceY(ce);let bt=Xe,At=1;if(Z){bt=Re.aabb.distanceZ(ce);const Zt=Math.pow(2,Re.zoom),or=o.a$((Re.y+1)/Zt),yr=o.a$(Re.y/Zt),Lr=Math.min(Math.max(R,or),yr),Jr=o.d1(Lr)/o.d1(R);if(At=Lr===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Jr/this._mercatorScaleRatio),this.zoom<=o.c_&&Re.zoom===$e-1&&Jr>=.9)return!0}else if(S&&(bt=Re.aabb.distanceZ(ce)*ee),this.projection.isReprojectedInTileSpace&&g<=5){const Zt=Math.pow(2,Re.zoom),or=be(new o.ae((Re.x+.5)/Zt,(Re.y+.5)/Zt));At=or>.85?1:or}if(!T&&!Z){const Zt=Math.sqrt(lt*lt+Qe*Qe+bt*bt);let or=(1<<$e-Re.zoom)*pe*At;return or*=vt(Math.max(bt,Xe),Zt),Zt<or}let Lt=Number.MAX_VALUE,Pt=0;const It=Re.aabb.getCorners(),Kt=[];for(const Zt of It){o.av(Kt,Zt,ce),Z||(S?Kt[2]*=ee:Kt[2]=Xe);const or=o.bJ(Kt,this._camera.forward());or<Lt&&(Lt=or,Pt=Math.abs(Kt[2]))}let Xt=(1<<$e-Re.zoom)*pe*At;if(Xt*=vt(Math.max(Pt,Xe),Lt),Lt<Xt)return!0;const Bt=Re.aabb.closestPoint(F);return Bt[0]===F[0]&&Bt[1]===F[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)ke.push(ve(-Re)),ke.push(ve(Re));for(ke.push(ve(0));ke.length>0;){const Re=ke.pop(),lt=Re.x,Qe=Re.y;let bt=Re.fullyVisible;const At=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!bt){let Lt=ge?Re.aabb.intersects(K):Re.aabb.intersectsFlat(K);if(Lt===0&&At()){const Pt=new o.cD(Re.zoom,lt,Qe);Lt=o.cE(this,z,Pt,!0).intersects(K)}if(Lt===0)continue;bt=Lt===2}if(Re.zoom===$e||!We(Re)){const Lt=Re.zoom===$e?Je:Re.zoom;if(s.minzoom&&s.minzoom>Lt)continue;let Pt=0;if(!bt){let Bt=ge?Re.aabb.intersectsPrecise(K):Re.aabb.intersectsPreciseFlat(K);if(Bt===0&&At()){const Zt=new o.cD(Re.zoom,lt,Qe);Bt=o.cE(this,z,Zt,!0).intersectsPrecise(K)}if(Bt===0)continue;if(s.calculateQuadrantVisibility)if(K.containsPoint(Re.aabb.center))Pt=15;else for(let Zt=0;Zt<4;Zt++)Re.aabb.quadrant(Zt).intersects(K)!==0&&(Pt|=1<<Zt)}const It=F[0]-(.5+lt+(Re.wrap<<Re.zoom))*(1<<h-Re.zoom),Kt=F[1]-.5-Qe,Xt=Re.tileID?Re.tileID:new o.aQ(Lt,Re.wrap,Re.zoom,lt,Qe);s.calculateQuadrantVisibility&&(Xt.visibleQuadrants=Pt),Ne.push({tileID:Xt,distanceSq:It*It+Kt*Kt});continue}for(let Lt=0;Lt<4;Lt++){const Pt=(lt<<1)+Lt%2,It=(Qe<<1)+(Lt>>1),Kt={aabb:T?Re.aabb.quadrant(Lt):o.cF(this,z,Re.zoom+1,Pt,It,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:Pt,y:It,wrap:Re.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};S&&!Z&&(Kt.tileID=new o.aQ(Re.zoom+1===$e?Je:Re.zoom+1,Re.wrap,Re.zoom+1,Pt,It),ht(Kt)),ke.push(Kt)}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,lt=this.horizonLineFromTop();Ne=Ne.filter(Qe=>{const bt=[0,0,0,1],At=[o.al,o.al,0,1],Lt=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());o.aC(bt,bt,Lt),o.aC(At,At,Lt);const Pt=o.cG([],bt,At),It=o.cH([],bt,At),Kt=o.c$(Pt,It);if(Kt===0)return!0;let Xt=!1;const Bt=this._elevation;if(Bt&&Kt>Re&&lt!==0){const Zt=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let or;s.isTerrainDEM||(or=Bt.getMinMaxForTile(Qe.tileID)),or||(or={min:Ee,max:Ie});const yr=o.cI(this.rotation),Lr=[yr[0]*o.al,yr[1]*o.al,or.max];o.af(Lr,Lr,Zt),Xt=(1-Lr[1])*this.height*.5<lt}return Kt<Re||Xt})}return Ne.sort((Re,lt)=>Re.distanceSq-lt.distanceSq).map(Re=>Re.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log2(s)}project(s){const h=o.aA(s.lat,-o.cJ,o.cJ),g=this.projection.project(s.lng,h);return new o.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,h){let g,x;const S=this.centerPoint;if(this.projection.name==="globe"){const O=this.worldSize;g=(h.x-S.x)/O,x=(h.y-S.y)/O}else{const O=this.pointCoordinate(h),R=this.pointCoordinate(S);g=O.x-R.x,x=O.y-R.y}const T=this.locationCoordinate(s);this.setLocation(new o.ae(T.x-g,T.y-x))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,h){return this.projection.locationPoint(this,s,h)}locationPoint3D(s,h){return this.projection.locationPoint(this,s,h,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,h){return this.coordinateLocation(this.pointCoordinate3D(s,h))}locationCoordinate(s,h){const g=h?o.cf(h,s.lat):void 0,x=this.projection.project(s.lng,s.lat);return new o.ae(x.x,x.y,g)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,h){const g=h??this._centerAltitude,x=[s.x,s.y,0,1],S=[s.x,s.y,1,1];o.aC(x,x,this.pixelMatrixInverse),o.aC(S,S,this.pixelMatrixInverse);const T=S[3];o.cK(x,x,1/x[3]),o.cK(S,S,1/T);const O=x[2],R=S[2];return{p0:x,p1:S,t:O===R?0:(g-O)/(R-O)}}screenPointToMercatorRay(s){const h=[s.x,s.y,0,1],g=[s.x,s.y,1,1];return o.aC(h,h,this.pixelMatrixInverse),o.aC(g,g,this.pixelMatrixInverse),o.cK(h,h,1/h[3]),o.cK(g,g,1/g[3]),h[2]=o.cf(h[2],this._center.lat)*this.worldSize,g[2]=o.cf(g[2],this._center.lat)*this.worldSize,o.cK(h,h,1/this.worldSize),o.cK(g,g,1/this.worldSize),new o.ax([h[0],h[1],h[2]],o.aw([],o.av([],g,h)))}rayIntersectionCoordinate(s){const{p0:h,p1:g,t:x}=s,S=o.cf(h[2],this._center.lat),T=o.cf(g[2],this._center.lat);return new o.ae(o.ak(h[0],g[0],x)/this.worldSize,o.ak(h[1],g[1],x)/this.worldSize,o.ak(S,T,x))}pointCoordinate(s,h=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,h)}pointCoordinate3D(s,h){if(!this.elevation)return this.pointCoordinate(s,h);let g=this.projection.pointCoordinate3D(this,s.x,s.y);if(g)return new o.ae(g[0],g[1],g[2]);let x=0,S=this.horizonLineFromTop();if(s.y>S)return this.pointCoordinate(s,h);const T=.02*S,O=s.clone();for(let R=0;R<10&&S-x>T;R++){O.y=o.ak(x,S,.66);const z=this.projection.pointCoordinate3D(this,O.x,O.y);z?(S=O.y,g=z):x=O.y}return g?new o.ae(g[0],g[1],g[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=o.cL)return!this.isPointAboveHorizon(s);const h=this.pointCoordinate(s);return h.y>=0&&h.y<=1}_coordinatePoint(s,h){const g=h&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,x=[s.x*this.worldSize,s.y*this.worldSize,g+s.toAltitude(),1];return o.aC(x,x,this.pixelMatrix),x[3]>0?new o.P(x[0]/x[3],x[1]/x[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:h}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,S=this.pointLocation3D(new o.P(h,s)),T=this.pointLocation3D(new o.P(x,s)),O=this.pointLocation3D(new o.P(x,g)),R=this.pointLocation3D(new o.P(h,g));let z=Math.min(S.lng,T.lng,O.lng,R.lng),F=Math.max(S.lng,T.lng,O.lng,R.lng),Z=Math.min(S.lat,T.lat,O.lat,R.lat),W=Math.max(S.lat,T.lat,O.lat,R.lat);const K=Math.pow(2,-this.zoom)/16*270,ne=this.projection.name==="globe"?1:4,ee=(ie,ce,ge,pe,fe)=>{const Ie=(ie+ge)/2,Ee=(ce+pe)/2,Pe=new o.P(Ie,Ee),{lng:be,lat:ve}=this.pointLocation3D(Pe),ke=Math.max(0,z-be,Z-ve,be-F,ve-W);z=Math.min(z,be),F=Math.max(F,be),Z=Math.min(Z,ve),W=Math.max(W,ve),(fe<ne||ke>K)&&(ee(ie,ce,Ie,Ee,fe+1),ee(Ie,Ee,ge,pe,fe+1))};if(ee(h,s,x,s,1),ee(x,s,x,g,1),ee(x,g,h,g,1),ee(h,g,h,s,1),this.projection.name==="globe"){const[ie,ce]=o.cM(this);ie?(W=90,F=180,z=-180):ce&&(Z=-90,F=180,z=-180)}return new o.aI(new o.aT(z,Z),new o.aT(F,W))}_getBoundsRectangular(s,h){const{top:g,left:x}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,O=new o.P(x,g),R=new o.P(T,g),z=new o.P(T,S),F=new o.P(x,S);let Z=this.pointCoordinate(O,s),W=this.pointCoordinate(R,s);const K=this.pointCoordinate(z,h),ne=this.pointCoordinate(F,h),ee=(ie,ce)=>(ce.y-ie.y)/(ce.x-ie.x);return Z.y>1&&W.y>=0?Z=new o.ae((1-ne.y)/ee(ne,Z)+ne.x,1):Z.y<0&&W.y<=1&&(Z=new o.ae(-ne.y/ee(ne,Z)+ne.x,0)),W.y>1&&Z.y>=0?W=new o.ae((1-K.y)/ee(K,W)+K.x,1):W.y<0&&Z.y<=1&&(W=new o.ae(-K.y/ee(K,W)+K.x,0)),new o.aI().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(K))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const h=s.visibleDemTiles.reduce((g,x)=>{if(x.dem){const S=x.dem.tree;g.min=Math.min(g.min,S.minimums[0]),g.max=Math.max(g.max,S.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(h.min*s.exaggeration(),h.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-h*(1-this._horizonShift);return s?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-o.cJ,this.maxLat=o.cJ,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,h){return this.projection.createTileMatrix(this,h,s)}calculateDistanceTileData(s){const h=s.key,g=this._distanceTileDataCache;if(g[h])return g[h];const x=s.canonical,S=1/this.height,T=this.cameraWorldSize,O=T/this.zoomScale(x.z),R=(x.x+Math.pow(2,x.z)*s.wrap)*O,z=x.y*O,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const Z=this.angle,W=Math.sin(-Z),K=-Math.cos(-Z);return g[h]={bearing:[W,K],center:[(F.x-R)*S,(F.y-z)*S],scale:O/o.al*S},g[h]}calculateFogTileMatrix(s){const h=s.key,g=this._fogTileMatrixCache;if(g[h])return g[h];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return o.aB(x,this.worldToFogMatrix,x),g[h]=new Float32Array(x),g[h]}calculateProjMatrix(s,h=!1,g=!1){const x=s.key;let S;if(S=g?this._expandedProjMatrixCache:h?this._alignedProjMatrixCache:this._projMatrixCache,S[x])return S[x];const T=this.calculatePosMatrix(s,this.worldSize);let O;return O=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:h?this.alignedProjMatrix:this.projMatrix,o.aB(T,O,T),S[x]=new Float32Array(T),S[x]}calculatePixelsToTileUnitsMatrix(s){const h=s.tileID.key,g=this._pixelsToTileUnitsCache;if(g[h])return g[h];const x=o.cN(s,this);return g[h]=x,g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,h=o.bq([],[s,s,s]);return o.aB(h,h,this.globeMatrix),h}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const h=o.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(h),x=this._camera.forward(),S=o.cf(1,this._center.lat);g[2]/=S,x[2]/=S,o.aw(x,x);const T=s.raycast(g,x,s.exaggeration());if(T){const O=o.bH([],g,x,T),R=new o.ae(O[0],O[1],o.cf(O[2],o.a$(O[1]))),z=(R.z+o.ag([R.x-g[0],R.y-g[1],R.z-g[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const h=this._elevation,g=o.cf(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(g),S=h.getAtPointOrZero(new o.ae(...x)),T=this.pixelsPerMeter/this.worldSize*S,O=this._minimumHeightOverTerrain(),R=x[2]-T;if(R<=O)if(R<0||s){const z=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],z.z-x[2]],Z=o.ag(F);F[2]-=(O-R)/this._pixelsPerMercatorPixel;const W=o.ag(F);if(W===0)return;o.c5(F,F,Z/W*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const W=this.center;return W.lat=o.aA(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(W.lng=o.aA(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const h=this._unmodified,{x:g,y:x}=this.point;let S=0,T=g,O=x;const R=this.width/2,z=this.height/2,F=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(x-z<F&&(O=F+z),x+z>Z&&(O=Z-z),Z-F<this.height&&(S=Math.max(S,this.height/(Z-F)),O=(Z+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,ne=this.worldSize/2-(W+K)/2;T=(g+ne+this.worldSize)%this.worldSize-ne,T-R<W&&(T=W+R),T+R>K&&(T=K-R),K-W<this.width&&(S=Math.max(S,this.width/(K-W)),T=(K+W)/2)}T===g&&O===x||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(T,O))),S&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cf(1,this.center.lat)/o.cf(1,o.d2));const x=o.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?g:1,T=this._camera.getWorldToCamera(this.worldSize,S);let O;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-s.x/this.width,R[9]=2*s.y/this.height,this.isOrthographic){let ve=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ke=ve*this.aspect,Ne=-ke,$e=-ve;ke-=s.x,Ne-=s.x,ve+=s.y,$e+=s.y,O=this._camera.getCameraToClipOrthographic(Ne,ke,$e,ve,this._nearZ,this._farZ),((Je,Xe,ht,vt)=>{for(let We=0;We<16;We++)Je[We]=o.ak(Xe[We],ht[We],vt)})(O,O,R,o.d0(this.pitch>=bc?1:this.pitch/bc))}else O=R;const z=o.cP([],R,T);let F=o.cP([],O,T);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),ke=o.bA([]);o.br(ke,ke,[ve.x*this.worldSize,ve.y*this.worldSize,0]),o.aB(ke,ke,o.cQ(this)),o.br(ke,ke,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),o.aB(F,F,ke),o.aB(z,z,ke),this.inverseAdjustmentMatrix=o.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cS([],F,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=F,this.invProjMatrix=o.bl(new Float64Array(16),this.projMatrix),h){const ve=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ve[8]=2*-s.x/this.width,ve[9]=2*s.y/this.height,this.expandedFarZProjMatrix=o.cP([],ve,T)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=o.bl([],O);this.frustumCorners=o.cT.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!h);const W=new Float32Array(16);o.bA(W),o.cS(W,W,[1,-1,1]),o.cU(W,W,this._pitch),o.bB(W,W,this.angle);const K=o.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bz(K);const ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;K[8]=2*-s.x/this.width,K[9]=2*(s.y+ne)/this.height,this.skyboxMatrix=o.aB(W,K,W);const ee=this.point,ie=ee.x,ce=ee.y,ge=this.width%2/2,pe=this.height%2/2,fe=Math.cos(this.angle),Ie=Math.sin(this.angle),Ee=ie-Math.round(ie)+fe*ge+Ie*pe,Pe=ce-Math.round(ce)+fe*pe+Ie*ge,be=new Float64Array(F);if(o.br(be,be,[Ee>.5?Ee-1:Ee,Pe>.5?Pe-1:Pe,0]),this.alignedProjMatrix=be,F=o.bC(),o.cS(F,F,[this.width/2,-this.height/2,1]),o.br(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=o.bC(),o.cS(F,F,[1,-1,1]),o.br(F,F,[-1,-1,0]),o.cS(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},F=o.bl(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cV(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(ve,ve,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,g=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,S=[s,s,h];o.c5(S,S,x),o.c5(g,g,-1),o.cW(g,g,S);const T=o.bC();o.br(T,T,g),o.cS(T,T,S),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,h,x)}_computeCameraPosition(s){const h=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),x=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-s/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-g[0]*S,x.y/this.worldSize-g[1]*S,s/this.worldSize*this._centerAltitude-g[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],x=s[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(S=Math.min((h-g)/x,1)),this._camera.position=o.bH([],this._camera.position,s,S),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,h=this._camera.forward(),{pitch:g,bearing:x}=this._camera.getPitchBearing(),S=o.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),O=Math.max((s[2]-S)/Math.cos(g),T),R=this._zoomFromMercatorZ(O);o.bH(s,s,h,O),this._pitch=o.aA(g,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bT(x,-Math.PI,Math.PI),this._setZoom(o.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let h=0,g=o.cL,x=0,S=1/0;for(;g-h>1e-6&&g>h;){const T=h+.5*(g-h),O=this.tileSize*Math.pow(2,T),R=this.getCameraToCenterDistance(this.projection,T,O),z=this.scaleZoom(R/(Math.max(0,s)*this.tileSize)),F=Math.abs(T-z);F<S&&(S=F,x=T),T<z?h=T:g=T}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,h){const g=Math.min(s.x,h.x),x=Math.max(s.x,h.x),S=Math.min(s.y,h.y),T=Math.max(s.y,h.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const O=[new o.P(g,S),new o.P(x,T),new o.P(g,T),new o.P(x,S)],R=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const F of O){const Z=this.pointRayIntersection(F);if(Z.t<0)return!0;const W=this.rayIntersectionCoordinate(Z);if(W.x<R||W.y<0||W.x>z||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(s,h){const g=o.ag(o.av([],this._camera.position,s)),x=this._zoomFromMercatorZ(g)+h;return g-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([h,g,x],S){const T=[h,g,x,1];o.aC(T,T,S);const O=T[3]=Math.max(T[3],1e-6);return T[0]/=O,T[1]/=O,T[2]/=O,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,s))}}getCameraToCenterDistance(s,h=this.zoom,g=this.worldSize){const x=o.cO(s,h,this.width,this.height,1024),S=s.pixelSpaceConversion(this.center.lat,g,x);let T=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(T=o.ak(1,T,o.d0(this.pitch>=bc?1:this.pitch/bc))),T}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(s,s,this.globeMatrix),s}getFrustum(s){return o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const Pl=(m,s)=>{if(s>0&&m.terrain&&o.w("Cutoff is currently disabled on terrain"),s<=0||m.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const h=m.transform,g=Math.max(Math.abs(h._zoom-(m.minCutoffZoom-1)),1),x=h.isLODDisabled(!1)?o.ah(60,45,h.pitch):o.ah(30,15,h.pitch),S=h._farZ-h._nearZ,T=s*h.height,O=((1-(R=x))*h.cameraToCenterDistance+R*(h._farZ+T))*g;var R;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[h._nearZ,h._farZ,(O-h._nearZ)/S,(O-T-h._nearZ)/S]}}},td=2048;class lR{constructor(s,h){this.aabb=s,this.lastCascade=h}}class bm{add(s,h){const g=this.receivers[s.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],h.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],h.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],h.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],h.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],h.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],h.max[2])):this.receivers[s.key]=new lR(h,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,h,g){const x=o.d9.fromPoints(s.points);let S=0;for(const T in this.receivers){const O=this.receivers[T];if(!O||!x.intersectsAabb(O.aabb))continue;O.aabb.min=x.closestPoint(O.aabb.min),O.aabb.max=x.closestPoint(O.aabb.max);const R=O.aabb.getCorners();for(let z=0;z<g.length;z++){let F=!0;for(const Z of R){const W=[Z[0]*h,Z[1]*h,Z[2]];if(o.af(W,W,g[z].matrix),W[0]<-1||W[0]>1||W[1]<-1||W[1]>1){F=!1;break}}if(O.lastCascade=z,S=Math.max(S,z),F)break}}return S+1}}class wm{constructor(s){this.painter=s,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new bm,this._depthMode=new Qt(s.context.gl.LEQUAL,Qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,h){const g=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!h||!h.properties)return;const x=h.properties.get("shadow-intensity"),S=h.properties.get("shadow-draw-before-layer");if(!h.shadowsEnabled()||x<=0)return;let T=-1,O=0;for(const ce of g.style.order){const ge=g.style._mergedLayers[ce];ge.hasShadowPass()&&!ge.isHidden(s.zoom)&&(T=O),S&&S===ce&&(this._drawShadowAfterLayer=O>0?O-1:0),O+=1}if(this._enabled=T>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=T);const R=g.context,z=td,F=td;if(this._cascades.length===0||td!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ce=0;ce<2;++ce){const ge=g._shadowMapDebug,pe=R.gl,fe=R.createFramebuffer(z,F,ge?1:0,"texture"),Ie=new o.T(R,{width:z,height:F,data:null},pe.DEPTH_COMPONENT16);if(fe.depthAttachment.set(Ie.texture),ge){const Ee=new o.T(R,{width:z,height:F,data:null},pe.RGBA8);fe.colorAttachment0.set(Ee.texture)}this._cascades.push({framebuffer:fe,texture:Ie,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cB,scale:0})}}this.shadowDirection=wE(h);let Z=0;if(s.elevation){const ce=s.elevation,ge=[1e4,-1e4];ce.visibleDemTiles.filter(pe=>pe.dem).forEach(pe=>{const fe=pe.dem.tree;ge[0]=Math.min(ge[0],fe.minimums[0]),ge[1]=Math.max(ge[1],fe.maximums[0])}),ge[0]!==1e4&&(Z=(ge[1]-ge[0])*ce.exaggeration())}const W=1.5*s.cameraToCenterDistance,K=3*W,ne=new Float64Array(16);for(let ce=0;ce<this._cascades.length;++ce){const ge=this._cascades[ce];let pe=s.height/50,fe=1;ce===0?fe=W:(pe=W,fe=K);const[Ie,Ee]=SE(s,this.shadowDirection,pe,fe,td,Z);ge.scale=s.scale,ge.matrix=Ie,ge.boundingSphereRadius=Ee,o.bl(ne,ge.matrix),ge.frustum=o.cB.fromInvProjectionMatrix(ne,1,0,!0),ge.far=fe}const ee=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[ee].far,this._cascades[ee].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=td,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ie=g.transform.elevation;for(const ce of this._groundShadowTiles){let ge={min:0,max:0};if(ie){const pe=ie.getMinMaxForTile(ce);pe&&(ge=pe)}this.addShadowReceiver(ce.toUnwrapped(),ge.min,ge.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,h){if(!this.enabled)return;const g=this.painter,x=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),x.viewport.set([0,0,td,td]);for(let S=0;S<this._numCascadesToRender;++S){g.currentShadowCascade=S,x.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),x.clear({color:o.ao.white,depth:1});for(const T of s.order){const O=s._mergedLayers[T];if(!O.hasShadowPass()||O.isHidden(g.transform.zoom))continue;const R=s.getLayerSourceCache(O),z=R?h[R.id]:void 0;(O.type==="model"||z&&z.length)&&g.renderLayer(g,R,O,z)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,h=s.style,g=s.context,x=g.gl,S=h.directionalLight,T=h.ambientLight;if(!S||!T)return;const O=[],R=Pl(s,s.longestCutoffRange);R.shouldRenderCutoff&&O.push("RENDER_CUTOFF"),O.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&O.push("NORMAL_OFFSET");const z=Cl(h,S,T),F=new Qt(x.LEQUAL,Qt.ReadOnly,s.depthRangeFor3D),Z=new xr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const W of this._groundShadowTiles){const K=W.toUnwrapped(),ne=s.isTileAffectedByFog(W),ee=s.getOrCreateProgram("groundShadow",{defines:O,overrideFog:ne});this.setupShadows(K,ee),s.uploadCommonUniforms(g,ee,K,null,R);const ie=pa(s.transform.calculateProjMatrix(K),z);ee.draw(s,x.TRIANGLES,F,Z,Er.multiply,gr.disabled,ie,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Er.unblended:Er.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(s){const h=this.painter.transform,g=h.calculatePosMatrix(s,h.worldSize);return o.aB(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(s){const h=o.bz(s);return o.aB(h,this._cascades[this.painter.currentShadowCascade].matrix,s),h}setupShadows(s,h,g){if(!this.enabled)return;const x=this.painter.transform,S=this.painter.context,T=S.gl,O=this._uniformValues,R=new Float64Array(16),z=x.calculatePosMatrix(s,x.worldSize);for(let F=0;F<this._cascades.length;F++)o.aB(R,this._cascades[F].matrix,z),O[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),S.activeTexture.set(T.TEXTURE0+11+F),this._cascades[F].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!g,this.useNormalOffset){const F=o.d7(s.canonical),Z=2/x.tileSize*o.al/td,W=Z*this._cascades[0].boundingSphereRadius,K=Z*this._cascades[this._cascades.length-1].boundingSphereRadius,ne=(g==="vector-tile"?1:3)*function(ee){const ie=o.aA((ee-22)/-22,0,1);return .125*(1-ie)+4*ie}(x.zoom);O.u_shadow_normal_offset=[F,W*ne,K*ne],O.u_shadow_bias=[1e-4,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];h.setShadowUniformValues(S,O)}setupShadowsFromMatrix(s,h,g=!1){if(!this.enabled)return;const x=this.painter.context,S=x.gl,T=this._uniformValues,O=new Float64Array(16);for(let R=0;R<2;R++)o.aB(O,this._cascades[R].matrix,s),T[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),x.activeTexture.set(S.TEXTURE0+11+R),this._cascades[R].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);this.useNormalOffset=g,g?(T.u_shadow_normal_offset=[1,3,3],T.u_shadow_bias=[6e-5,.0012,.012]):T.u_shadow_bias=[36e-5,.0012,.012],h.setShadowUniformValues(x,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,h,g,x){if(x[2]>=0)return{};const S=function(R,z,F){const Z=F/(1<<R.canonical.z);return new o.d9([R.canonical.x*Z+R.wrap*F,R.canonical.y*Z+R.wrap*F,0],[(R.canonical.x+1)*Z+R.wrap*F,(R.canonical.y+1)*Z+R.wrap*F,z])}(s,h,g).getCorners(),T=h/-x[2];x[0]<0?(o.d8(S[0],S[0],[x[0]*T,0,0]),o.d8(S[3],S[3],[x[0]*T,0,0])):x[0]>0&&(o.d8(S[1],S[1],[x[0]*T,0,0]),o.d8(S[2],S[2],[x[0]*T,0,0])),x[1]<0?(o.d8(S[0],S[0],[0,x[1]*T,0]),o.d8(S[1],S[1],[0,x[1]*T,0])):x[1]>0&&(o.d8(S[2],S[2],[0,x[1]*T,0]),o.d8(S[3],S[3],[0,x[1]*T,0]));const O={};return O.vertices=S,O.planes=[Vy(S[1],S[0],S[4]),Vy(S[2],S[1],S[5]),Vy(S[3],S[2],S[6]),Vy(S[0],S[3],S[7])],O}addShadowReceiver(s,h,g){this._receivers.add(s,o.d9.fromTileIdAndHeight(s,h,g))}getMaxCascadeForTile(s){const h=this._receivers.get(s);return h&&h.lastCascade?h.lastCascade:0}}function Vy(m,s,h){const g=o.av([],h,s),x=o.av([],m,s),S=o.bI([],g,x),T=o.ag(S);return T===0?[0,0,1,0]:(o.c5(S,S,1/T),[S[0],S[1],S[2],-o.bJ(S,s)])}function wE(m){const s=m.properties.get("direction"),h=o.d4(s.x,s.y,s.z);h[2]=o.aA(h[2],0,75);const g=o.d6([h[0],h[1],h[2]]);return o.d5(g.x,g.y,g.z)}function Cl(m,s,h){const g=s.properties.get("color-use-theme")==="none",x=s.properties.get("color"),S=s.properties.get("intensity"),T=s.properties.get("direction"),O=[T.x,T.y,T.z],R=h.properties.get("color-use-theme")==="none",z=h.properties.get("color"),F=h.properties.get("intensity"),Z=Math.max(o.bJ([0,0,1],O),0),W=[0,0,0];o.c5(W,z.toPremultipliedRenderColor(R?null:m.getLut(s.scope)).toArray01Linear().slice(0,3),F);const K=[0,0,0];return o.c5(K,x.toPremultipliedRenderColor(g?null:m.getLut(h.scope)).toArray01Linear().slice(0,3),Z*S),o.db([W[0]>0?W[0]/(W[0]+K[0]):0,W[1]>0?W[1]/(W[1]+K[1]):0,W[2]>0?W[2]/(W[2]+K[2]):0])}function SE(m,s,h,g,x,S){const T=m.zoom,O=m.scale,R=m.worldSize,z=1/R,F=m.aspect,Z=Math.sqrt(1+F*F)*Math.tan(.5*m.fovX),W=Z*Z,K=g-h,ne=g+h;let ee,ie;W>K/ne?(ee=g,ie=g*Z):(ee=.5*ne*(1+W),ie=.5*Math.sqrt(K*K+2*(g*g+h*h)*W+ne*ne*W*W));const ce=m.projection.pixelsPerMeter(m.center.lat,R),ge=m._camera.getCameraToWorldMercator(),pe=[0,0,-ee*z];o.af(pe,pe,ge);let fe=ie*z;const Ie=function(bt){return bt[0]/=O,bt[1]/=O,bt[2]=o.cf(bt[2],m._center.lat),bt},Ee=m._edgeInsets;if(!(Ee.left===0&&Ee.top===0&&Ee.right===0&&Ee.bottom===0||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const bt=m._camera.getWorldToCamera(m.worldSize,m.projection.zAxisUnit==="meters"?ce:1),At=m._camera.getCameraToClipPerspective(m._fov,m.width/m.height,h,g);At[8]=2*-m.centerOffset.x/m.width,At[9]=2*m.centerOffset.y/m.height;const Lt=new Float64Array(16);o.cP(Lt,At,bt);const Pt=new Float64Array(16);o.bl(Pt,Lt);const It=o.cB.fromInvProjectionMatrix(Pt,R,T,!0);for(const Kt of It.points){const Xt=Ie(Kt);fe=Math.max(fe,o.c6(o.da([],pe,Xt)))}}fe*=x/(x-1);const Pe=Math.acos(s[2]),be=Math.atan2(-s[0],-s[1]),ve=new vf;ve.position=pe,ve.setPitchBearing(Pe,be);const ke=ve.getWorldToCamera(R,ce),Ne=fe*R,$e=Math.min(m._mercatorZfromZoom(17)*R*-2,-2*Ne),Je=ve.getCameraToClipOrthographic(-Ne,Ne,-Ne,Ne,$e,(Ne+S*ce)/s[2]),Xe=new Float64Array(16);o.aB(Xe,Je,ke);const ht=o.d5(Math.floor(1e6*pe[0])/1e6*R,Math.floor(1e6*pe[1])/1e6*R,0),vt=.5*x,We=[0,0,0];o.af(We,ht,Xe),o.c5(We,We,vt);const Re=[Math.floor(We[0]),Math.floor(We[1]),Math.floor(We[2])],lt=[0,0,0];o.av(lt,We,Re),o.c5(lt,lt,-1/vt);const Qe=new Float64Array(16);return o.bA(Qe),o.br(Qe,Qe,lt),o.aB(Xe,Qe,Xe),[Xe,Ne]}class Uy extends o.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,h){return o.dc(this.requestManager.transformRequest(h,o.R.Model).url).then(g=>{if(!g)return;const x=o.dd(g),S=new o.de(s,h,void 0,void 0,x);return S.computeBoundsAndApplyParent(),S}).catch(g=>{if(g&&g.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${s} from ${h}: ${g.message}`)))})}load(s,h,g={forceReload:!1}){this.models[h]||(this.models[h]={});const x=Object.keys(s),S=[],T=[];for(const O of x){const R=s[O];this.hasURLBeenRequested(R)&&!g.forceReload||(this.modelByURL[R]={modelId:O,scope:h},S.push(this.loadModel(O,R)),T.push(O)),this.models[h][O]||(this.models[h][O]={model:null,numReferences:1})}this.numModelsLoading[h]=(this.numModelsLoading[h]||0)+T.length,Promise.allSettled(S).then(O=>{for(let R=0;R<O.length;R++){const{status:z}=O[R];if(z==="rejected")continue;const{value:F}=O[R];this.models[h][T[R]]||(this.models[h][T[R]]={model:null,numReferences:1}),this.models[h][T[R]].model=F}this.numModelsLoading[h]-=T.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(O=>{this.fire(new o.y(new Error(`Could not load models: ${O.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,h,g={exactIdMatch:!1}){return!!(g.exactIdMatch?this.getModel(s,h):this.getModelByURL(this.modelUris[h][s]))}getModel(s,h){return this.models[h]||(this.models[h]={}),this.models[h][s]?this.models[h][s].model:void 0}getModelByURL(s){if(!s)return null;const h=this.modelByURL[s];return h?this.models[h.scope][h.modelId].model:null}hasModelBeenAdded(s,h){return this.models[h]&&this.models[h][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,h,g){this.models[g]||(this.models[g]={}),this.modelUris[g]||(this.modelUris[g]={});const x=this.requestManager.normalizeModelURL(h);if((this.hasModel(s,g,{exactIdMatch:!0})||this.hasModelBeenAdded(s,g))&&this.modelUris[g][s]===x)this.models[g][s].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:S,modelId:T}=this.modelByURL[x];this.models[S][T].numReferences++}else this.modelUris[g][s]=x,this.load({[s]:this.modelUris[g][s]},g)}addModelURLs(s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const g=this.modelUris[h];for(const x in s)g[x]=this.requestManager.normalizeModelURL(s[x])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={});const g={};for(const x of s)this.hasModel(x,h,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[h][x].numReferences++:this.modelUris[h][x]&&!this.hasURLBeenRequested(x)?g[x]=this.modelUris[h][x]:!this.hasURLBeenRequested(x)&&o.df(x,!1)&&(this.modelUris[h][x]=this.requestManager.normalizeModelURL(x),g[x]=this.modelUris[h][x]);this.load(g,h)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,h,g=!1,x=!1){if(this.models[h]&&this.models[h][s]&&(this.models[h][s].numReferences--,this.models[h][s].numReferences===0||x)){const S=this.modelUris[h][s];g||delete this.modelUris[h][s],delete this.modelByURL[S];const T=this.models[h][s].model;if(!T)return;delete this.models[h][s],T.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const h of Object.keys(this.models[s])){const g=this.models[s][h].model;delete this.models[s][h],g&&g.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,h){this.models[h]||(this.models[h]={});for(const g in this.models[h])this.models[h][g].model&&this.models[h][g].model.upload(s.context)}}const Sm=o.a6.colorTheme,rd=new o.a9({data:new o.aa(Sm.data)});function cR(m){if(!m.metadata||!m.metadata.content_area)return;const s=o.o.devicePixelRatio,{left:h,top:g,width:x,height:S}=m.metadata.content_area,T=h*s,O=g*s;return[T,O,T+x*s,O+S*s]}function TE(m){if(m)return m.map(([s,h])=>[s*o.o.devicePixelRatio,h*o.o.devicePixelRatio])}class uR{constructor(s,h,g){this.id=s,this.scope=h,this.sourceCache=g,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const h=this.sourceCache.getVisibleCoordinates();if(h.length===0)return s;const g=this.sourceCache.getSource();if(!(g instanceof qs))return s;const x=h.map(T=>this.sourceCache.getTile(T)),S=g.getImages(x,Array.from(this.pendingRequests));for(const[T,O]of S)s.set(o.I.from({name:T,iconsetId:this.id}),O),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),s}}class Hx{constructor(){o.aY(["_onIndoorUpdate"],this)}onAdd(s){return this._map=s,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",h=>this._onIndoorUpdate(h)),this._container}_createButton(s,h){const g=j("button",s,this._container);return g.type="button",g.addEventListener("click",h),g}_createSeparator(){return j("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(s,h){this._map&&(s.setAttribute("aria-label",h),s.textContent=h)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(s){if(!s||!s.floors)return this._model=s,void(this._container.style.display="none");const h=this._model;this._model=s,this._container.style.display="inline-block",this._container.style.borderRadius="8px",h&&Array.from(this._container.children).forEach(g=>g.remove()),s.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(s.floors,s.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const s=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const h=this._map;this._model&&h&&h._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});j("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden","true"),s.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&s.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(s),this._createSeparator()}_updateBuildingsButtonState(){const s=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");s&&this._model&&(this._model.activeFloorsVisible?s.classList.remove("mapboxgl-ctrl-level-button-selected"):s.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(s,h){for(let g=0;g<s.length;g++){const x=s[g],S=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(x.id)});this._setButtonTitle(S,x.zIndex.toString()),this._model&&x.id===this._model.selectedFloorId&&h&&S.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(S),g<s.length-1&&this._createSeparator()}}}class dR extends o.E{constructor(s){super(),this._style=s,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(s){s===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=s,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(s){this._activeFloorsVisible=s,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(s){for(const[h,g]of Object.entries(s.buildings))if(this._buildings[h])for(const x of g.floorIds)this._buildings[h].floors[x]||(this._buildings[h].floors[x]=g.floors[x]);else this._buildings[h]=g;for(const h of s.activeFloors)this._activeFloors.add(h);this._updateIndoorSelector()}getIndoorTileOptions(s,h){const g=this._style.getIndoorSourceLayers(s,h);return g&&this._indoorState?{sourceLayers:g,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Hx,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const s=this._style.map.transform,h=function(g,x,S,T){let O=null,R=Number.MAX_SAFE_INTEGER;if(T<16)return null;for(const[z,F]of Object.entries(g)){const Z=F.center;if(Z){const W=x.distanceTo(o.aT.convert(Z));W<R&&S.contains(Z)&&(R=W,O=z)}}return O}(this._buildings,s.center,s.getBounds(),s.zoom);h!==this._closestBuildingId&&(this._closestBuildingId=h,this._updateIndoorSelector())}_updateIndoorSelector(){const s=this._buildings,h=this._closestBuildingId,g=h&&s?s[h]:void 0;if(!g)return this._removeIndoorControl(),void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let x=null;for(const T of g.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){x=T;break}const S=Array.from(g.floorIds).map(T=>({id:T,name:g.floors[T].name,zIndex:g.floors[T].zIndex})).sort((T,O)=>O.zIndex-T.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:x,activeFloorsVisible:this._activeFloorsVisible,floors:S}))}_updateActiveFloors(){const s=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:s,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const du=(m,s)=>je(m,s&&s.filter(h=>h.identifier!=="source.canvas")),EE=o.aH(cn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),AE=o.aH(cn,["setCenter","setZoom","setBearing","setPitch"]),Gy=new Set(["background","sky","slot","custom"]),Wx={version:8,layers:[],sources:{}},nd={duration:300,delay:0};class Ia extends o.E{constructor(s,h={}){super(),this.map=s,this.scope=h.scope||"",this.globalId=null,this.fragments=[],this.importDepth=h.importDepth||0,this.importsCache=h.importsCache||new Map,this.resolvedImports=h.resolvedImports||new Set,this.transition=Object.assign({},nd),this._buildingIndex=new pm(this),this.crossTileSymbolIndex=new mo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=h.styleChanges||new Nn,this._hasDataDrivenEmissive=!1,this.indoorManager=new dR(this),this.dispatcher=h.dispatcher?h.dispatcher:new o.D(o.dh(),this),h.imageManager?this.imageManager=h.imageManager:(this.imageManager=new ot(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=h.glyphManager?h.glyphManager:new o.di(s._requestManager,h.localFontFamily?o.dj.all:h.localIdeographFontFamily?o.dj.ideographs:o.dj.none,h.localFontFamily||h.localIdeographFontFamily),h.modelManager?this.modelManager=h.modelManager:(this.modelManager=new Uy(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=h.configOptions?h.configOptions:new Map,this._configDependentLayers=h.configDependentLayers?h.configDependentLayers:new Set,this._indoorDependentLayers=h.indoorDependentLayers?h.indoorDependentLayers:new Set,this._config=h.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:h.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=h.initialConfig,this.dispatcher.broadcast("setReferrer",o.dk());const g=this;this._rtlTextPluginCallback=Ia.registerForPluginStateChange(x=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(S,T)=>{if(o.dl(S),T&&T.every(O=>O))for(const O in g._sourceCaches){const R=g._sourceCaches[O],z=R.getSource().type;z!=="vector"&&z!=="geojson"||R.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const S=this.getOwnSource(x.sourceId);if(S&&S.vectorLayerIds)for(const T in this._layers){const O=this._layers[T];O.source===S.id&&this._validateLayer(O)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(o.h(s))return s;const h=o.dm(s);if(!h.startsWith("http"))try{return new URL(h,location.href).toString()}catch{return h}return h}return`json://${o.dn(JSON.stringify(s))}`}_diffStyle(s,h,g){this.globalId=this._getGlobalId(s);const x=(S,T)=>{try{T(null,this.setState(S,g))}catch(O){T(O,!1)}};if(typeof s=="string"){const S=this.map._requestManager.normalizeStyleURL(s),T=this.map._requestManager.transformRequest(S,o.R.Style);o.m(T,(O,R)=>{O?this.fire(new o.y(O)):R&&x(R,h)})}else typeof s=="object"&&x(s,h)}loadURL(s,h={}){this.fire(new o.z("dataloading",{dataType:"style"}));const g=typeof h.validate=="boolean"?h.validate:!o.h(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,h.accessToken),this.resolvedImports.add(s);const x=this.importsCache.get(s);if(x)return this._load(x,g);const S=this.map._requestManager.transformRequest(s,o.R.Style);this._request=o.m(S,(T,O)=>{if(this._request=null,T)this.fire(new o.y(T));else if(O)return this.importsCache.set(s,O),this._load(O,g)})}loadJSON(s,h={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=o.o.frame(()=>{this._request=null,this._load(s,h.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(Wx,!1)}_loadImports(s,h,g){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const S of s){const T=this._createFragmentStyle(S),O=new Promise(F=>{T.once("style.import.load",F),T.once("error",F)}).then(()=>this.mergeAll());if(x.push(O),this.resolvedImports.has(S.url)){T.loadEmpty();continue}const R=S.data||this.importsCache.get(S.url);R?(T.loadJSON(R,{validate:h}),this._isInternalStyle(R)&&(T.globalId=null)):S.url?T.loadURL(S.url,{validate:h}):T.loadEmpty();const z={style:T,id:S.id,config:S.config};if(g){const F=this.fragments.findIndex(({id:Z})=>Z===g);this.fragments=this.fragments.slice(0,F).concat(z).concat(this.fragments.slice(F))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(s=this,h=new Set){for(const g of s.fragments)g.style.globalId&&h.add(g.style.globalId),this.getImportGlobalIds(g.style,h);return[...h.values()]}_createFragmentStyle(s){const h=this.scope?o.B(s.id,this.scope):s.id;let g;const x=this._initialConfig&&this._initialConfig[h];(s.config||x)&&(g=Object.assign({},s.config,x));const S=new Ia(this.map,{scope:h,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:g,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return S.setEventedParent(this.map,{style:S}),S}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,h){if(this._isInternalStyle(s)){const S=Object.assign({},Wx,{imports:[{id:"basemap",data:s,url:""}]},s.center?{center:s.center}:{},s.bearing?{bearing:s.bearing}:{},s.pitch?{pitch:s.pitch}:{},s.zoom?{zoom:s.zoom}:{},s.light?{light:s.light}:{});return this._importedAsBasemap=!0,void this._load(S,h)}if(this.updateConfig(this._config,s.schema),h&&du(this,Wn(s)))return;this._loaded=!0,this.stylesheet=o.dp(s);const g=()=>{for(const R in s.sources)this.addSource(R,s.sources[R],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const R in s.iconsets)this.addIconset(R,s.iconsets[R]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&s.glyphs&&this.glyphManager.setURL(s.glyphs);const S=Nx(this.stylesheet.layers);if(this._order=S.map(R=>R.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new tt(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new tt(this.stylesheet.light)),this._layers={};for(const R of S){const z=o.du(R,this.scope,this._styleColorTheme.lut,this.options);z.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(z.fqid),this._hasAppearances=this._hasAppearances||z.getAppearances().length!==0,z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const F=this.getOwnLayerSourceCache(z),Z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&z.canCastShadows()&&Z&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const O=this.isRootStyle();s.imports?this._loadImports(s.imports,h).then(()=>{this._reloadImports(),this.fire(new o.z(O?"style.load":"style.import.load"))}).catch(R=>{this.fire(new o.y(new Error("Failed to load imports",R))),this.fire(new o.z(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{g()}).catch(T=>{o.w(`Couldn't load color theme from the stylesheet: ${T}`),g()})}else this._styleColorTheme.lut=null,g()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(s=>s.style.hasAppearances())}mergeAll(){let s,h,g,x,S,T,O,R,z,F;const Z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(W=>{if(W.stylesheet){if(W.light!=null&&(s=W.light),W.stylesheet.lights)for(const K of W.stylesheet.lights)K.type==="ambient"&&W.ambientLight!=null&&(h=W.ambientLight),K.type==="directional"&&W.directionalLight!=null&&(g=W.directionalLight);x=this._prioritizeTerrain(x,W.terrain,W.stylesheet.terrain),W.stylesheet.fog&&W.fog!=null&&(S=W.fog),W.stylesheet.snow&&W.snow!=null&&(T=W.snow),W.stylesheet.rain&&W.rain!=null&&(O=W.rain),W.stylesheet.camera!=null&&(F=W.stylesheet.camera),W.stylesheet.projection!=null&&(R=W.stylesheet.projection),W.stylesheet.transition!=null&&(z=W.stylesheet.transition),Z[W.scope]=W._styleColorTheme}}),this.light=s,this.ambientLight=h,this.directionalLight=g,this.fog=S,this.snow=T,this.rain=O,this._styleColorThemeForScope=Z,x===null?delete this.terrain:this.terrain=x,this.camera=F||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},nd,z),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(s){const h=g=>{for(const x of g.fragments)h(x.style);s(g)};h(this)}_prioritizeTerrain(s,h,g){const x=s&&s.drapeRenderMode===0;return g===null?h&&h.drapeRenderMode===0?h:x?s:null:h!=null&&(!s||x||h&&h.drapeRenderMode===1)?h:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(h=>{s=this._prioritizeTerrain(s,h.terrain,h.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(h=>{h.stylesheet.projection!=null&&(s=h.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},h={},g={};this.forEachFragmentStyle(x=>{for(const S in x._sourceCaches){const T=o.B(S,x.scope);s[T]=x._sourceCaches[S]}for(const S in x._otherSourceCaches){const T=o.B(S,x.scope);h[T]=x._otherSourceCaches[S]}for(const S in x._symbolSourceCaches){const T=o.B(S,x.scope);g[T]=x._symbolSourceCaches[S]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=h,this._mergedSymbolSourceCaches=g}mergeIndoor(){this.forEachFragmentStyle(s=>{if(s.stylesheet&&s.stylesheet.indoor)for(const h of Object.values(s.stylesheet.indoor)){const g=h,x=o.B(g.sourceId,s.scope);this._mergedIndoor[x]=new Set(g.sourceLayers||[])}})}mergeLayers(){const s={},h=[],g={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const O of T._order){const R=T._layers[O];if(R.type==="slot"){const z=o.dq(O);if(s[z])continue;s[z]=[]}R.slot&&s[R.slot]?s[R.slot].push(R):h.push(R)}}),this._mergedOrder=[];let x=-1;const S=(T=[])=>{for(const O of T)if(O.type==="slot"){const R=o.dq(O.id);s[R]&&S(s[R]),this._mergedSlots.push(R)}else{const R=o.B(O.id,O.scope);this._mergedOrder.push(R),g[R]=O,O.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),O.type==="circle"&&(this._hasCircleLayers=!0),O.type==="symbol"&&(this._hasSymbolLayers=!0),O.type==="clip"&&(this._clipLayerPresent=!0)}};if(S(h),this._has3DLayers){const T={};for(let O=0;O<this._mergedOrder.length;++O){const R=this._mergedOrder[O];T[R]=O===x?1:O<x?g[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((O,R)=>T[O]-T[R])}this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(h,g,x){const S=Object.assign({},g);for(const O of Object.keys(Sm))S[O]===void 0&&(S[O]=Sm[O].default);const T=new o.a8(rd,h,new Map(x));return T.setTransitionOrValue(S,x),T.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const h=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((g,x)=>{const S="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void g();let T=s;T.startsWith(S)||(T=S+T);const O=o.I.from("mapbox-reserved-lut"),R=new Image;R.src=T,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==h)return void g();this._styleColorTheme.lutLoading=!1;const{width:z,height:F,data:Z}=o.o.getImageData(R);if(F>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==F*F)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(O)&&this.removeImage(O),this.addImage(O,{data:new o.q({width:z,height:F},Z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const W=this.imageManager.getImage(O,this.scope);W?(this._styleColorTheme.lut={image:W.data,data:s},g()):x(new Error("Missing LUT image."))}})}getLut(s){const h=this._styleColorThemeForScope[s];return h?h.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(h,g,x){let S,T,O;const R=o.o.devicePixelRatio>1?"@2x":"";let z=o.m(g.transformRequest(g.normalizeSpriteURL(h,R,".json"),o.R.SpriteJSON),(W,K)=>{z=null,O||(O=W,S=K,Z())}),F=o.n(g.transformRequest(g.normalizeSpriteURL(h,R,".png"),o.R.SpriteImage),(W,K)=>{F=null,O||(O=W,T=K,Z())});function Z(){if(O)x(O);else if(S&&T){const W=o.o.getImageData(T),K={};for(const ne in S){const{width:ee,height:ie,x:ce,y:ge,sdf:pe,pixelRatio:fe,stretchX:Ie,stretchY:Ee,content:Pe}=S[ne],be=new o.q({width:ee,height:ie});o.q.copy(W,be,{x:ce,y:ge},{x:0,y:0},{width:ee,height:ie},null),K[ne]={data:be,pixelRatio:fe!==void 0?fe:1,sdf:pe!==void 0&&pe,stretchX:Ie,stretchY:Ee,content:Pe,usvg:!1,version:0}}x(null,K)}}return{cancel(){z&&(z.cancel(),z=null),F&&(F.cancel(),F=null)}}}(s,this.map._requestManager,(h,g)=>{if(this._spriteRequest=null,h)this.fire(new o.y(h));else if(g){const x=new Map;for(const S in g)x.set(o.I.from(S),g[S]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(s,h){if(h.type==="sprite")return void this._loadSprite(h.url);const g=this.getOwnSourceCache(h.source);if(!g)return void this.fire(new o.y(new Error(`Source "${h.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const x=g.getSource();if(x.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${h.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const S=new uR(s,this.scope,g);this.imageManager.addImageProvider(S,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!o.h(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const h=this.map._spriteFormat==="auto";var g,x;this._spriteRequest=(x=(S,T)=>{if(this._spriteRequest=null,S)h?this._loadSprite(s):this.fire(new o.y(S));else if(T){const O=new Map;for(const R in T)O.set(o.I.from(R),T[R]);this.addImages(O)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bu((g=this.map._requestManager).transformRequest(g.normalizeIconsetURL(s),o.R.Iconset),(S,T)=>{if(S)return void x(S);const O={},R=o.dg(new o.bt(T));for(const z of R.icons){const F={version:1,pixelRatio:o.o.devicePixelRatio,content:cR(z),stretchX:z.metadata?TE(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?TE(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};O[z.name]=F}x(null,O)}))}_validateLayer(s){const h=this.getOwnSource(s.source);if(!h)return;const g=s.sourceLayer;g&&(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(g)===-1)&&this.fire(new o.y(new Error(`Source layer "${g}" does not exist on source "${h.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,h)=>{const g=this.fragments[h];return g&&g.style&&(s.data=g.style.serialize()),s})}_serializeSources(){const s={};for(const h in this._sourceCaches){const g=this._sourceCaches[h].getSource();s[g.id]||(s[g.id]=g.serialize())}return s}_serializeLayers(s){const h=[];for(const g of s){const x=this._layers[g];x&&x.type!=="custom"&&h.push(x.serialize())}return h}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const s in this._mergedLayers){const h=this._mergedLayers[s];if(h._transitionablePaint&&h._transitionablePaint._values){const g=h._transitionablePaint._values["line-emissive-strength"];if(g&&g.value&&g.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const h=this.getOwnLayer(s);if(h)return h;this.fire(new o.y(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const h=this.getOwnSource(s);if(h)return h;this.fire(new o.y(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,h){const g=this.map.painter;if(g)for(let x=s.minzoom||0;x<(s.maxzoom||25.5);x++){const S=s.getProgramIds();if(S)for(const T of S){const O=s.getDefaultProgramParams(T,h.zoom,this._styleColorTheme.lut);O&&(g.style=this,this.fog&&(g._fogVisible=!0,O.overrideFog=!0,g.getOrCreateProgram(T,O)),g._fogVisible=!1,O.overrideFog=!1,g.getOrCreateProgram(T,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,g.getOrCreateProgram(T,O)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const h=this.calculateLightsBrightness();s.brightness=h||0,h!==this._brightness&&(this._brightness=h,this.dispatcher.broadcast("setBrightness",h)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const g=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const O=this._changes.getLayerUpdatesByScope();for(const R in O){const{updatedIds:z,removedIds:F}=O[R];(z||F)&&(this._updateWorkerLayers(R,z,F),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const S={};for(const O in this._mergedSourceCaches){const R=this._mergedSourceCaches[O];S[O]=R.used,R.used=!1,R.tileCoverLift=0}for(const O of this._mergedOrder){const R=this._mergedLayers[O];if(R.visibility!=="none"&&R.recalculate(s,this._availableImages),!R.isHidden(s.zoom)){const z=this.getLayerSourceCache(R);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,s)}):this.precompilePrograms(R,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const O of T)O.sourceCache.used=!0;for(const O in S){const R=this._mergedSourceCaches[O];S[O]!==R.used&&R.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),g&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const h of s){const g=h.resolvePendingRequests(),x=this.getFragmentStyle(h.scope);x&&x.addImages(g)}}_updateTilesForChangedImages(){const s={};for(const h in this._mergedSourceCaches){const g=this._mergedSourceCaches[h].getSource().scope;s[g]=s[g]||this._changes.getUpdatedImages(g),s[g].length!==0&&this._mergedSourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s[g])}for(const h in s)this._changes.resetUpdatedImages(h)}_updateWorkerLayers(s,h,g){const x=this.getFragmentStyle(s);x&&this.dispatcher.broadcast("updateLayers",{layers:h?x._serializeLayers(h):[],scope:s,removedIds:g||[],options:x.options})}setState(s,h){if(this._checkLoaded(),du(this,Wn(s)))return!1;(s=o.dp(s)).layers=Nx(s.layers);const g=function(T,O){if(!T)return[{command:cn.setStyle,args:[O]}];let R=[];try{if(!o.by(T.version,O.version))return[{command:cn.setStyle,args:[O]}];if(o.by(T.center,O.center)||R.push({command:cn.setCenter,args:[O.center]}),o.by(T.zoom,O.zoom)||R.push({command:cn.setZoom,args:[O.zoom]}),o.by(T.bearing,O.bearing)||R.push({command:cn.setBearing,args:[O.bearing]}),o.by(T.pitch,O.pitch)||R.push({command:cn.setPitch,args:[O.pitch]}),o.by(T.sprite,O.sprite)||R.push({command:cn.setSprite,args:[O.sprite]}),o.by(T.glyphs,O.glyphs)||R.push({command:cn.setGlyphs,args:[O.glyphs]}),o.by(T.imports,O.imports)||function(K=[],ne=[],ee){ne=ne||[];const ie=(K=K||[]).map(Ju),ce=ne.map(Ju),ge=K.reduce(gm,{}),pe=ne.reduce(gm,{}),fe=ie.slice();let Ie,Ee,Pe,be;for(Ie=0,Ee=0;Ie<ie.length;Ie++)Pe=ie[Ie],pe.hasOwnProperty(Pe)?Ee++:(ee.push({command:cn.removeImport,args:[Pe]}),fe.splice(fe.indexOf(Pe,Ee),1));for(Ie=0,Ee=0;Ie<ce.length;Ie++)Pe=ce[ce.length-1-Ie],fe[fe.length-1-Ie]!==Pe&&(ge.hasOwnProperty(Pe)?(ee.push({command:cn.removeImport,args:[Pe]}),fe.splice(fe.lastIndexOf(Pe,fe.length-Ee),1)):Ee++,be=fe[fe.length-Ie],ee.push({command:cn.addImport,args:[pe[Pe],be]}),fe.splice(fe.length-Ie,0,Pe));for(const ve of ne){const ke=ge[ve.id];ke&&(delete ke.data,o.by(ke,ve)||ee.push({command:cn.updateImport,args:[ve.id,ve]}))}}(T.imports,O.imports,R),o.by(T.transition,O.transition)||R.push({command:cn.setTransition,args:[O.transition]}),o.by(T.light,O.light)||R.push({command:cn.setLight,args:[O.light]}),o.by(T.fog,O.fog)||R.push({command:cn.setFog,args:[O.fog]}),o.by(T.snow,O.snow)||R.push({command:cn.setSnow,args:[O.snow]}),o.by(T.rain,O.rain)||R.push({command:cn.setRain,args:[O.rain]}),o.by(T.projection,O.projection)||R.push({command:cn.setProjection,args:[O.projection]}),o.by(T.lights,O.lights)||R.push({command:cn.setLights,args:[O.lights]}),o.by(T.camera,O.camera)||R.push({command:cn.setCamera,args:[O.camera]}),o.by(T.iconsets,O.iconsets)||function(K,ne,ee){let ie;for(ie in ne=ne||{},K=K||{})K.hasOwnProperty(ie)&&(ne.hasOwnProperty(ie)||ee.push({command:cn.removeIconset,args:[ie]}));for(ie in ne){if(!ne.hasOwnProperty(ie))continue;const ce=ne[ie];K.hasOwnProperty(ie)?o.by(K[ie],ce)||(ee.push({command:cn.removeIconset,args:[ie]}),ee.push({command:cn.addIconset,args:[ie,ce]})):ee.push({command:cn.addIconset,args:[ie,ce]})}}(T.iconsets,O.iconsets,R),!o.by(T["color-theme"],O["color-theme"]))return[{command:cn.setStyle,args:[O]}];const z={},F=[];(function(K,ne,ee,ie){let ce;for(ce in ne=ne||{},K=K||{})K.hasOwnProperty(ce)&&(ne.hasOwnProperty(ce)||My(ce,ee,ie));for(ce in ne){if(!ne.hasOwnProperty(ce))continue;const ge=ne[ce];K.hasOwnProperty(ce)?o.by(K[ce],ge)||(K[ce].type==="geojson"&&ge.type==="geojson"&&gE(K,ne,ce)?ee.push({command:cn.setGeoJSONSourceData,args:[ce,ge.data]}):mE(ce,ne,ee,ie)):pf(ce,ne,ee)}})(T.sources,O.sources,F,z);const Z=[];T.layers&&T.layers.forEach(K=>{K.source&&z[K.source]?R.push({command:cn.removeLayer,args:[K.id]}):Z.push(K)});let W=T.terrain;W&&z[W.source]&&(R.push({command:cn.setTerrain,args:[void 0]}),W=void 0),R=R.concat(F),o.by(W,O.terrain)||R.push({command:cn.setTerrain,args:[O.terrain]}),function(K,ne,ee){ne=ne||[];const ie=(K=K||[]).map(Ju),ce=ne.map(Ju),ge=K.reduce(gm,{}),pe=ne.reduce(gm,{}),fe=ie.slice(),Ie=Object.create(null);let Ee,Pe,be,ve,ke,Ne,$e;for(Ee=0,Pe=0;Ee<ie.length;Ee++)be=ie[Ee],pe.hasOwnProperty(be)?Pe++:(ee.push({command:cn.removeLayer,args:[be]}),fe.splice(fe.indexOf(be,Pe),1));for(Ee=0,Pe=0;Ee<ce.length;Ee++)be=ce[ce.length-1-Ee],fe[fe.length-1-Ee]!==be&&(ge.hasOwnProperty(be)?(ee.push({command:cn.removeLayer,args:[be]}),fe.splice(fe.lastIndexOf(be,fe.length-Pe),1)):Pe++,Ne=fe[fe.length-Ee],ee.push({command:cn.addLayer,args:[pe[be],Ne]}),fe.splice(fe.length-Ee,0,be),Ie[be]=!0);for(Ee=0;Ee<ce.length;Ee++)if(be=ce[Ee],ve=ge[be],ke=pe[be],!Ie[be]&&!o.by(ve,ke))if(o.by(ve.source,ke.source)&&o.by(ve["source-layer"],ke["source-layer"])&&o.by(ve.type,ke.type)){for($e in mm(ve.layout,ke.layout,ee,be,null,cn.setLayoutProperty),mm(ve.paint,ke.paint,ee,be,null,cn.setPaintProperty),o.by(ve.slot,ke.slot)||ee.push({command:cn.setSlot,args:[be,ke.slot]}),o.by(ve.filter,ke.filter)||ee.push({command:cn.setFilter,args:[be,ke.filter]}),o.by(ve.minzoom,ke.minzoom)&&o.by(ve.maxzoom,ke.maxzoom)||ee.push({command:cn.setLayerZoomRange,args:[be,ke.minzoom,ke.maxzoom]}),ve)ve.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?mm(ve[$e],ke[$e],ee,be,$e.slice(6),cn.setPaintProperty):o.by(ve[$e],ke[$e])||ee.push({command:cn.setLayerProperty,args:[be,$e,ke[$e]]}));for($e in ke)ke.hasOwnProperty($e)&&!ve.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?mm(ve[$e],ke[$e],ee,be,$e.slice(6),cn.setPaintProperty):o.by(ve[$e],ke[$e])||ee.push({command:cn.setLayerProperty,args:[be,$e,ke[$e]]}))}else ee.push({command:cn.removeLayer,args:[be]}),Ne=fe[fe.lastIndexOf(be)+1],ee.push({command:cn.addLayer,args:[ke,Ne]})}(Z,O.layers,R)}catch(z){console.warn("Unable to compute style diff:",z),R=[{command:cn.setStyle,args:[O]}]}return R}(this.serialize(),s).filter(T=>!(T.command in AE));if(g.length===0)return!1;const x=g.filter(T=>!(T.command in EE));if(x.length>0)throw new Error(`Unimplemented: ${x.map(T=>T.command).join(", ")}.`);const S=[];return g.forEach(T=>{S.push(this[T.command](...T.args))}),h&&Promise.all(S).then(h).catch(h),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){if(s.size===0)return this;for(const[h,g]of s.entries()){if(this.getImage(h))return this.fire(new o.y(new Error(`An image with the name "${h.name}" already exists.`)));this.imageManager.addImage(h,this.scope,g),this._changes.updateImage(h,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(s,h){return this.getImage(s)?this.fire(new o.y(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(s,h,g=!1){this.imageManager.updateImage(s,this.scope,h),g&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(s){return this.modelManager.addModelURLs(s,this.getActualScope()),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(s,h,g={}){return this._checkLoaded(),this._validate(Le,`models.${s}`,h,null,g)||(this.modelManager.addModel(s,h,this.getActualScope()),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.getActualScope())}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.getActualScope(),!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(s,h,g={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(aa,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const x=Yd(s,h,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const S=T=>{const O=(T?"symbol:":"other:")+x.id,R=o.B(O,this.scope),z=this._sourceCaches[O]=new ca(R,x,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};S(!1),h.type!=="vector"&&h.type!=="geojson"||S(!0),x.onAdd&&x.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const h=this.getOwnSource(s);if(!h)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new o.y(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new o.y(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find(([S,T])=>T.type==="source"&&T.source===s);if(x)return this.fire(new o.y(new Error(`Source "${s}" cannot be removed while iconset "${x[0]}" is using it.`)))}const g=this.getOwnSourceCaches(s);for(const x of g){const S=o.dq(x.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(x.id),x.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,h){this._checkLoaded(),this.getOwnSource(s).setData(h),this._changes.setDirty()}getOwnSource(s){const h=this.getOwnSourceCache(s);return h&&h.getSource()}getOwnSources(){const s=[];for(const h in this._otherSourceCaches){const g=this.getOwnSourceCache(h);g&&s.push(g.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const h in s){const g=s[h]._tiles;for(const x in g){const S=g[x];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const h=this._getTransitionParameters();for(const S of s){if(this._validate(wt,"lights",S))return;switch(S.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(S),T.updateTransitions(h)}else this.ambientLight=new on(S,pi(),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(S),T.updateTransitions(h)}else this.directionalLight=new on(S,$n(),this.scope,this.options)}}const g=Object.assign(h,{worldview:this.map.getWorldview()}),x=new o.ac(this.z||0,g);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,h=this.ambientLight;if(!s||!h)return;const g=W=>.2126*(W[0]<=.03928?W[0]/12.92:Math.pow((W[0]+.055)/1.055,2.4))+.7152*(W[1]<=.03928?W[1]/12.92:Math.pow((W[1]+.055)/1.055,2.4))+.0722*(W[2]<=.03928?W[2]/12.92:Math.pow((W[2]+.055)/1.055,2.4)),x=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),S=s.properties.get("intensity"),T=s.properties.get("direction"),O=1-o.d4(T.x,T.y,T.z)[2]/90,R=g(x)*S*O,z=h.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=h.properties.get("intensity"),Z=g(z)*F;return Number(((R+Z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(o.dr(s)){const h=o.ds(s),g=this.fragments.find(({id:S})=>S===h);if(!g)return;const x=o.dq(s);return g.style.getFragmentStyle(x)}{const h=this.fragments.find(({id:g})=>g===s);return h?h.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const h={},g=(x,S="")=>`${x}::${S}`;this._featuresetSelectors={};for(const x in s){const S=this._featuresetSelectors[x]=[];for(const T of s[x].selectors){if(T.featureNamespace){const R=this.getOwnLayer(T.layer);if(!R){o.w(`Layer is undefined for selector: ${T.layer}`);continue}const z=g(R.source,R.sourceLayer);if(z in h&&h[z]!==T.featureNamespace){o.w(`"featureNamespace ${T.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}h[z]=T.featureNamespace}let O;if(T.properties)for(const R in T.properties){const z=o.U(T.properties[R]);z.result==="success"&&(O=O||{},O[R]=z.value)}S.push({layerId:T.layer,namespace:T.featureNamespace,properties:O,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const h=this.getFragmentStyle(s);if(!h||!h.stylesheet.featuresets)return[];const g=[];for(const x in h.stylesheet.featuresets)g.push({featuresetId:x,importId:h.scope?h.scope:void 0});return g}getFeaturesetLayers(s,h){const g=this.getFragmentStyle(h),x=g.stylesheet.featuresets;if(!x||!x[s])return this.fire(new o.y(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const S=[];for(const T of x[s].selectors){const O=g.getOwnLayer(T.layer);O&&S.push(O)}return S}getConfigProperty(s,h){const g=this.getFragmentStyle(s);if(!g)return null;const x=o.B(h,g.scope),S=g.options.get(x),T=S?S.value||S.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(s,h){const g=o.B(s,h);return this._mergedIndoor[g]}setIndoorData(s,h){this.indoorManager.setIndoorData(h)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(s,h,g){const x=this.getFragmentStyle(s);if(!x)return;const S=x.stylesheet.schema;if(!S||!S[h])return;const T=o.U(g);if(T.result!=="success")return void du(this,T.value);const O=T.value.expression,R=o.B(h,x.scope),z=x.options.get(R);if(!z)return;let F;const{minValue:Z,maxValue:W,stepValue:K,type:ne,values:ee}=S[h],ie=o.U(S[h].default);ie.result==="success"&&(F=ie.value.expression),F?(this.options.set(R,Object.assign({},z,{value:O,default:F,minValue:Z,maxValue:W,stepValue:K,type:ne,values:ee})),this.updateConfigDependencies(h)):this.fire(new o.y(new Error(`No schema defined for the config option "${h}" in the "${s}" fragment.`)))}getConfig(s){const h=this.getFragmentStyle(s);if(!h)return null;const g=h.stylesheet.schema;if(!g)return null;const x={};for(const S in g){const T=o.B(S,h.scope),O=h.options.get(T),R=O?O.value||O.default:null;x[S]=R?R.serialize():null}return x}setConfig(s,h){const g=this.getFragmentStyle(s);g&&(g.updateConfig(h,g.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const h=this.getFragmentStyle(s);return h?h.stylesheet.schema:null}setSchema(s,h){const g=this.getFragmentStyle(s);g&&(g.stylesheet.schema=h,g.updateConfig(g._config,h),this.updateConfigDependencies())}updateConfig(s,h){if(this._config=s,s||h)if(h)for(const g in h){let x,S;const T=o.U(h[g].default);if(T.result==="success"&&(x=T.value.expression),s&&s[g]!==void 0){const W=o.U(s[g]);W.result==="success"&&(S=W.value.expression)}const{minValue:O,maxValue:R,stepValue:z,type:F,values:Z}=h[g];if(x){const W=o.B(g,this.scope);this.options.set(W,{default:x,value:S,minValue:O,maxValue:R,stepValue:z,type:F,values:Z})}else this.fire(new o.y(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(s,h=()=>!0){for(const g of s){const x=this.getLayer(g);x&&h(x)&&(x.possiblyEvaluateVisibility(),this._updateLayer(x),this._changes.setDirty())}}updateConfigDependencies(s){this._updateLayers(this._configDependentLayers,h=>!s||h.expressionDependencies.configDependencies.has(s)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(h=>{const g=h._styleColorTheme.colorThemeOverride?h._styleColorTheme.colorThemeOverride:h._styleColorTheme.colorTheme;if(g){const x=h._evaluateColorThemeData(g);(!h._styleColorTheme.lut&&x!==""||h._styleColorTheme.lut&&x!==h._styleColorTheme.lut.data)&&h.setColorTheme(g)}}),this._changes.setDirty()}addLayer(s,h,g={}){this._checkLoaded();const x=s.id;if(this._layers[x])return void this.fire(new o.y(new Error(`Layer with id "${x}" already exists on this map`)));let S;if(s.type==="custom"){if(du(this,o.dt(s)))return;S=o.du(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(x,s.source),s=o.dp(s),s=Object.assign(s,{source:x})),this._validate(Be,`layers.${x}`,s,{arrayIndex:-1},g))return;S=o.du(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:x}})}const T=o.B(S.source,S.scope);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let O=this._order.length;if(h){const Z=this._order.indexOf(h);if(Z===-1)return void this.fire(new o.y(new Error(`Layer with id "${h}" does not exist on this map.`)));S.slot&&S.slot!==this._layers[h].slot?o.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`):O=Z}this._order.splice(O,0,x),this._handleLayerOrderChange(),this._layers[x]=S;const R=this.getOwnLayerSourceCache(S),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&S.canCastShadows()&&z&&(R.castsShadows=!0);const F=this._changes.getRemovedLayer(S);if(F&&S.source&&R&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const Z=o.B(S.source,S.scope);F.type!==S.type?this._changes.updateSourceCache(Z,"clear"):(this._changes.updateSourceCache(Z,"reload"),R.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(s,h){this._checkLoaded();const g=this._checkLayer(s);if(!g||s===h)return;const x=this._order.indexOf(s);this._order.splice(x,1);let S=this._order.length;if(h){const T=this._order.indexOf(h);if(T===-1)return void this.fire(new o.y(new Error(`Layer with id "${h}" does not exist on this map.`)));g.slot&&g.slot!==this._layers[h].slot?o.w(`Layer with id "${h}" has a different slot. Layers can only be rearranged within the same slot.`):S=T}this._order.splice(S,0,s),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(s){this._checkLoaded();const h=this._checkLayer(s);if(!h)return;h.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),delete this._layers[s],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(h.fqid),this._indoorDependentLayers.delete(h.fqid),this._changes.removeLayer(h);const x=this.getOwnLayerSourceCache(h);if(x&&x.castsShadows){let S=!1;for(const T in this._layers)if(this._layers[T].source===h.source&&this._layers[T].canCastShadows()){S=!0;break}x.castsShadows=S}h.onRemove&&h.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const h in this._layers)if(this._layers[h].type===s)return!0;return!1}setLayerZoomRange(s,h,g){this._checkLoaded();const x=this._checkLayer(s);x&&(x.minzoom===h&&x.maxzoom===g||(h!=null&&(x.minzoom=h),g!=null&&(x.maxzoom=g),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,h){this._checkLoaded();const g=this._checkLayer(s);g&&g.slot!==h&&(g.slot=h,this._updateLayer(g))}setFilter(s,h,g={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!o.by(x.filter,h))return h==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(se,`layers.${x.id}.filter`,h,{layerType:x.type},g)||(x.filter=o.dp(h),this._updateLayer(x)))}getFilter(s){const h=this._checkLayer(s);if(h)return o.dp(h.filter)}setLayoutProperty(s,h,g,x={}){this._checkLoaded();const S=this._checkLayer(s);if(S&&!o.by(S.getLayoutProperty(h),g)){if(g!=null&&(!x||x.validate!==!1)&&du(S,xe.call(Wn,{key:`layers.${s}.layout.${h}`,layerType:S.type,objectKey:h,value:g,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;S.setLayoutProperty(h,g),S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),this._updateLayer(S)}}setLayerProperty(s,h,g,x={}){this._checkLoaded();const S=this._checkLayer(s);S&&(h==="appearances"?(S.setAppearances(g),this._changes.setDirty()):S.isPaintProperty(h)?this.setPaintProperty(s,h,g,x):this.setLayoutProperty(s,h,g,x))}getLayoutProperty(s,h){const g=this._checkLayer(s);if(g)return g.getLayoutProperty(h)}setPaintProperty(s,h,g,x={}){this._checkLoaded();const S=this._checkLayer(s);if(!S||o.by(S.getPaintProperty(h),g)||g!=null&&(!x||x.validate!==!1)&&du(S,he.call(Wn,{key:`layers.${s}.paint.${h}`,layerType:S.type,objectKey:h,value:g,styleSpec:o.a6})))return;const T=S.setPaintProperty(h,g);S.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S.fqid),S.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S.fqid),T&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(s,h){const g=this._checkLayer(s);if(g)return g.getPaintProperty(h)}setFeatureState(s,h){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:R,importId:z}=s.target,F=this.getFragmentStyle(z),Z=F.getFeaturesetLayers(R);for(const{source:W,sourceLayer:K}of Z)F.setFeatureState({id:s.id,source:W,sourceLayer:K},h)}else if("layerId"in s.target){const{layerId:R}=s.target,z=this.getLayer(R);this.setFeatureState({id:s.id,source:z.source,sourceLayer:z.sourceLayer},h)}return}const g=s.source,x=s.sourceLayer,S=this._checkSource(g);if(!S)return;const T=S.type;if(T==="geojson"&&x)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!x)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const O=this.getOwnSourceCaches(g);for(const R of O)R.setFeatureState(x,s.id,h)}removeFeatureState(s,h){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:R,importId:z}=s.target,F=this.getFragmentStyle(z),Z=F.getFeaturesetLayers(R);for(const{source:W,sourceLayer:K}of Z)F.removeFeatureState({id:s.id,source:W,sourceLayer:K},h)}else if("layerId"in s.target){const{layerId:R}=s.target,z=this.getLayer(R);this.removeFeatureState({id:s.id,source:z.source,sourceLayer:z.sourceLayer},h)}return}const g=s.source,x=this._checkSource(g);if(!x)return;const S=x.type,T=S==="vector"?s.sourceLayer:void 0;if(S==="vector"&&!T)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const O=this.getOwnSourceCaches(g);for(const R of O)R.removeFeatureState(T,s.id,h)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let S;if("featuresetId"in s.target){const{featuresetId:T,importId:O}=s.target,R=this.getFragmentStyle(O),z=R.getFeaturesetLayers(T);for(const{source:F,sourceLayer:Z}of z){const W=R.getFeatureState({id:s.id,source:F,sourceLayer:Z});if(W&&!S)S=W;else if(!o.by(S,W))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:T}=s.target,O=this.getLayer(T);S=this.getFeatureState({id:s.id,source:O.source,sourceLayer:O.sourceLayer})}return S}const h=s.source,g=s.sourceLayer,x=this._checkSource(h);if(x){if(x.type!=="vector"||g)return s.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(h)[0].getFeatureState(g,s.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),h=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return o.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:h,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateFilteredLayers(s){for(const h of Object.values(this._mergedLayers))s(h)&&this._updateLayer(h)}_updateLayer(s){this._changes.updateLayer(s);const h=this.getLayerSourceCache(s),g=o.B(s.source,s.scope),x=this._changes.getUpdatedSourceCaches();s.source&&!x[g]&&h&&h.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),h.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const h=O=>this._mergedLayers[O].is3D(!!this.terrain),g=this.order,x={},S=[];for(let O=g.length-1;O>=0;O--){const R=g[O];if(h(R)){x[R]=O;for(const z of s){const F=z[R];if(F)for(const Z of F)S.push(Z)}}}S.sort((O,R)=>R.intersectionZ-O.intersectionZ);const T=[];for(let O=g.length-1;O>=0;O--){const R=g[O];if(h(R))for(let z=S.length-1;z>=0;z--){const F=S[z].feature;if(F.layer&&x[F.layer.id]<O)break;T.push(F),S.pop()}else for(const z of s){const F=z[R];if(F)for(const Z of F)T.push(Z.feature)}}return T}queryRasterValue(s,h,g){const x=this.getOwnSource(s);return x?x.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(h,g):(this.fire(new o.y(new Error(`Source with id "${s}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(s,h,g){let x;h&&!Array.isArray(h)&&h.filter&&(this._validate(se,"queryRenderedFeatures.filter",h.filter,null,h),x=o.b6(h.filter));const S={},T=F=>{if(Gy.has(F.type))return;const Z=this.getOwnLayerSourceCache(F),W=S[Z.id]=S[Z.id]||{sourceCache:Z,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(W.has3DLayers=!0),W.layers[F.fqid]=W.layers[F.fqid]||{styleLayer:F,targets:[]},W.layers[F.fqid].targets.push({filter:x})};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const F of h.layers){const Z=this._layers[F];if(!Z)return this.fire(new o.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(Z)}}else for(const F in this._layers)T(this._layers[F]);const O=this._queryRenderedFeatures(s,S,g),R=this._flattenAndSortRenderedFeatures(O),z=[];for(const F of R)o.dw(F.layer.id)===this.scope&&z.push(F);return z}queryRenderedFeatureset(s,h,g){let x;h&&!Array.isArray(h)&&h.filter&&(this._validate(se,"queryRenderedFeatures.filter",h.filter,null,h),x=o.b6(h.filter));const S="mock",T=[];if(h&&h.target)T.push(Object.assign({},h,{targetId:S,filter:x}));else{const F=this.getFeaturesetDescriptors();for(const Z of F)T.push({targetId:S,filter:x,target:Z});for(const{style:Z}of this.fragments){const W=Z.getFeaturesetDescriptors();for(const K of W)T.push({targetId:S,filter:x,target:K})}}const O=this.queryRenderedTargets(s,T,g),R=[],z=new Set;for(const F of O)for(const Z of F.variants[S])um(Z,F,z)||R.push(new o.dx(F,Z));return R}queryRenderedTargets(s,h,g){const x={},S=(O,R,z,F)=>{const Z=x[R.id]=x[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(Z.layers[O.fqid]=Z.layers[O.fqid]||{styleLayer:O,targets:[]},O.is3D(!!this.terrain)&&(Z.has3DLayers=!0),!F)return z.uniqueFeatureID=!1,void Z.layers[O.fqid].targets.push(z);Z.layers[O.fqid].targets.push(Object.assign({},z,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const O of h)if("featuresetId"in O.target){const{featuresetId:R,importId:z}=O.target,F=this.getFragmentStyle(z);if(!F||!F._featuresetSelectors)continue;const Z=F._featuresetSelectors[R];if(!Z){this.fire(new o.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const W of Z){const K=F.getOwnLayer(W.layerId);K&&!Gy.has(K.type)&&S(K,F.getOwnLayerSourceCache(K),O,W)}}else if("layerId"in O.target){const{layerId:R}=O.target,z=this.getLayer(R);if(!z||Gy.has(z.type))continue;S(z,this.getLayerSourceCache(z),O)}const T=this._queryRenderedFeatures(s,x,g);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(s,h,g){const x=[],S=!!this.map._showQueryGeometry,T=Ai.createFromScreenPoints(s,g);for(const O in h){const R=dm(T,h[O],this._availableImages,g,S,this.getActualScope());Object.keys(R).length&&x.push(R)}if(this.placement)for(const O in h){if(!h[O].sourceCache._onlySymbols)continue;const R=dE(T.screenGeometry,h[O],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&x.push(R)}return x}querySourceFeatures(s,h){const g=h&&h.filter;g&&this._validate(se,"querySourceFeatures.filter",g,null,h);let x=[];const S=this.getOwnSourceCaches(s);for(const T of S)x=x.concat(hE(T,h));return x}addSourceType(s,h,g){return Ia.getSourceType(s)?g(new Error(`A source type called "${s}" already exists.`)):(Ia.setSourceType(s,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:h.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,h,g={}){this._checkLoaded();const x=this.light.getLight();let S=!1;for(const O in s)if(!o.by(s[O],x[O])){S=!0;break}if(!S)return;const T=this._getTransitionParameters();this.light.setLight(s,h,g),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,h=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),h===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let g=s;const x=!("source"in s)||s.source==null;if(h===1){if(this.disableElevatedTerrain)return;if("source"in g&&typeof g.source=="object"){const O="terrain-dem-src";this.addSource(O,g.source),g=o.dp(g),g=Object.assign(g,{source:O})}const S=Object.assign({},g),T={};if(this.terrain&&x){S.source=this.terrain.get().source;const O=this.terrain?this.getFragmentStyle(this.terrain.scope):null;O&&(T.style=O.serialize())}if(this._validate(Cs,"terrain",S,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&h!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,h),this.fire(new o.z("data",{dataType:"style"}))}else{const S=this.terrain,T=S.get();for(const O of Object.keys(o.a6.terrain))!g.hasOwnProperty(O)&&o.a6.terrain[O].default&&(g[O]=o.a6.terrain[O].default);for(const O in s)if(!o.by(s[O],T[O])){S.set(s,this.options),this.stylesheet.terrain=s;const R=this._getTransitionParameters({duration:0});S.updateTransitions(R),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const h=this.fog=new vr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_createSnow(s){const h=this.snow=new Ri(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_createRain(s){const h=this.rain=new ui(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog;if(!o.by(h.get(),s)){h.set(s,this.options),this.stylesheet.fog=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const h=this.snow;if(!o.by(h.get(),s)){h.set(s,this.options),this.stylesheet.snow=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const h=this.rain;if(!o.by(h.get(),s)){h.set(s,this.options),this.stylesheet.rain=h.get();const g=this._getTransitionParameters({duration:0});h.updateTransitions(g)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},h=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!h)return this._styleColorTheme.lut=null,void s();const g=this._evaluateColorThemeData(h);this._loadColorTheme(g).then(()=>{this.fire(new o.z("colorthemeset")),s()}).catch(x=>{o.w(`Couldn't set color theme: ${x}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,h){const g=this.getFragmentStyle(s);g&&(g._styleColorTheme.colorThemeOverride=h,g._reloadColorTheme())}_getTransitionParameters(s){return{now:o.o.now(),transition:Object.assign(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],h=[];for(const g of this._mergedOrder)this.isLayerDraped(this._mergedLayers[g])?s.push(g):h.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...h)}_createTerrain(s,h){const g=this.terrain=new xt(s,h,this.scope,this.options,this.map.getWorldview());h===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});g.updateTransitions(x)}_force3DLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="fill-extrusion"&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const h=this._layers[s];h.type==="symbol"&&this._updateLayer(h)}}_validate(s,h,g,x,S={}){if(S&&S.validate===!1)return!1;const T=Object.assign({},this.serialize());return du(this,s.call(Wn,Object.assign({key:h,style:T,value:g,styleSpec:o.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const h=this.getSourceCaches(s);for(const g of h)g.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}clearLayers(){for(const s in this._mergedLayers){const h=this._mergedLayers[s];h._clear&&h._clear()}}reloadSource(s){const h=this.getSourceCaches(s);for(const g of h)g.resume(),g.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let h;this.directionalLight&&(h=wE(this.directionalLight));const g=new Set,x=new Set;for(const S in this._mergedLayers){const T=this._mergedLayers[S];T.type==="building"&&g.add(T.source),T.hasElevation()&&!x.has(T.source)&&x.add(T.source)}for(const S in this._mergedSourceCaches){const T=this._mergedSourceCaches[S],O=x.has(T._source.id);g.has(T._source.id)&&(T._source.reparseOverscaled=!1),T.update(s,void 0,void 0,h,O)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const h=this._sourceCaches[s];h.resume(),h.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new o.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new Vx),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(s,h,g,x,S){this.pauseablePlacement||(this.pauseablePlacement=new Vx);let T=!1,O=!1;const R={},z={};for(const ee of this._mergedOrder){const ie=this._mergedLayers[ee];if(ie.type!=="symbol")continue;const ce=o.B(ie.source,ie.scope);let ge=R[ce];if(!ge){const fe=this.getLayerSourceCache(ie);if(!fe)continue;const Ie=fe.getRenderableIds(!0).map(Ee=>fe.getTileByID(Ee));z[ce]=Ie.slice(),ge=R[ce]=Ie.sort((Ee,Pe)=>Pe.tileID.overscaledZ-Ee.tileID.overscaledZ||(Ee.tileID.isLessThan(Pe.tileID)?-1:1))}const pe=this.crossTileSymbolIndex.addLayer(ie,ge,s.center.lng,s.projection);T=T||pe}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const F=!!(this.placement&&!s.equals(this.placement.transform)),Z=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!S||this.placement.lastReplacementSourceUpdateTime!==S.updateTime)),W=F||Z||T,K=(W||this.pauseablePlacement.isStale())&&g===0,ne=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),s.zoom)&&g!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||K||ne)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(s,this._mergedOrder,h,g,x,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?W&&g!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,R,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),O=!0),T&&this.pauseablePlacement.setStale()),O||T){this._buildingIndex.onNewFrame(s.zoom);for(let ee=0;ee<this._mergedOrder.length;ee++){const ie=this._mergedLayers[this._mergedOrder[ee]];if(ie.type!=="symbol"||ie.visibility==="none")continue;const ce=this.isLayerClipped(ie);this.placement.updateLayerOpacities(ie,R[o.B(ie.source,ie.scope)],ee,ce?S:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(o.o.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,h){this._checkLoaded();const g=this.stylesheet.imports=this.stylesheet.imports||[];if(g.findIndex(({id:S})=>S===s.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!h)return g.push(s),this._loadImports([s],!0);const x=g.findIndex(({id:S})=>S===h);return x===-1&&this.fire(new o.y(new Error(`Import with id "${h}" does not exist on this map.`))),this.stylesheet.imports=g.slice(0,x).concat(s).concat(g.slice(x)),this._loadImports([s],!0,h)}updateImport(s,h){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(s);return x===-1?this:typeof h=="string"?(this.setImportUrl(s,h),this):(h.url&&h.url!==g[x].url&&this.setImportUrl(s,h.url),o.by(h.config,g[x].config)||this.setImportConfig(s,h.config,h.data.schema),o.by(h.data,g[x].data)||this.setImportData(s,h.data),this)}moveImport(s,h){this._checkLoaded();let g=this.stylesheet.imports||[];const x=this.getImportIndex(s);if(x===-1)return this;const S=this.getImportIndex(h);if(S===-1)return this;const T=g[x],O=this.fragments[x];return g=g.filter(({id:R})=>R!==s),this.fragments=this.fragments.filter(({id:R})=>R!==s),this.stylesheet.imports=g.slice(0,S).concat(T).concat(g.slice(S)),this.fragments=this.fragments.slice(0,S).concat(O).concat(this.fragments.slice(S)),this.mergeLayers(),this}setImportUrl(s,h){this._checkLoaded();const g=this.stylesheet.imports||[],x=this.getImportIndex(s);if(x===-1)return this;g[x].url=h;const S=this.fragments[x];return S.style=this._createFragmentStyle(g[x]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(h),this}setImportData(s,h){this._checkLoaded();const g=this.getImportIndex(s),x=this.stylesheet.imports||[];return g===-1?this:h?(this.fragments[g].style.setState(h),this._reloadImports(),this):(delete x[g].data,this.setImportUrl(s,x[g].url))}setImportConfig(s,h,g){this._checkLoaded();const x=this.getImportIndex(s),S=this.stylesheet.imports||[];if(x===-1)return this;h?S[x].config=h:delete S[x].config;const T=this.fragments[x];g&&T.style.stylesheet&&(T.style.stylesheet.schema=g);const O=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=h,T.style.updateConfig(h,O),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const h=this.stylesheet.imports||[],g=this.getImportIndex(s);g!==-1&&(h.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports())}getImportIndex(s){const h=(this.stylesheet.imports||[]).findIndex(g=>g.id===s);return h===-1&&this.fire(new o.y(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),h}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const h in this._mergedOtherSourceCaches){const g=this._mergedOtherSourceCaches[h];g&&s.push(g.getSource())}return s}getSource(s,h){const g=this.getSourceCache(s,h);return g&&g.getSource()}getLayerSource(s){const h=this.getLayerSourceCache(s);return h&&h.getSource()}getSourceCache(s,h){const g=o.B(s,h);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(s){const h=o.B(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[h]:this._mergedOtherSourceCaches[h]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const h=[];return this._mergedOtherSourceCaches[s]&&h.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&h.push(this._mergedSymbolSourceCaches[s]),h}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const h in s){const g=s[h];g==="reload"?this.reloadSource(h):g==="clear"&&this.clearSource(h)}}updateLayers(s){const h=this._changes.getUpdatedPaintProperties();for(const g of h){const x=this.getLayer(g);x&&x.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s)}getImages(s,h,g){this.imageManager.getImages(h.images,h.scope,g),this._updateTilesForChangedImages();const x=T=>{if(T){const O=h.images.map(R=>o.I.toString(R));T.setDependencies(h.tileID.key,h.type,O)}},S=o.B(h.source,h.scope);x(this._mergedOtherSourceCaches[S]),x(this._mergedSymbolSourceCaches[S]),h.images.some(T=>T.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(s,h,g){this.imageManager.rasterizeImages(h,g)}getGlyphs(s,h,g){this.glyphManager.getGlyphs(h.stacks,g)}getResource(s,h,g){return o.dz(h,g)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const h=[];return this._otherSourceCaches[s]&&h.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&h.push(this._symbolSourceCaches[s]),h}_isSourceCacheLoaded(s){const h=this.getOwnSourceCaches(s);return h.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${s}'`))),!1):h.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,h){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const g=s.type==="fill-extrusion"&&(s.sourceLayer==="building"||s.sourceLayer==="procedural_buildings"),x=s.type==="building";if(s.is3D(!!this.terrain)){if(g||x||h&&h.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ia.getSourceType=function(m){return ou[m]},Ia.setSourceType=function(m,s){ou[m]=s},Ia.registerForPluginStateChange=o.dA;var Zx=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Xx=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,xf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,bf="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kx=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,qy=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ya=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Tm=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Mt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Yx=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Jx=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Em=/#include\s+"([^"]+)"/g,wc=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Qx=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,rh=new Set(["ifdef","ifndef","elif","if","defined"]),nh=new Set;od(Zx,nh),od(xf,nh),od(Xx,nh);const id={"_prelude_fog.vertex.glsl":qy,"_prelude_terrain.vertex.glsl":Kx,"_prelude_shadow.vertex.glsl":Yx,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Ya,"_prelude_shadow.fragment.glsl":Jx,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Tm,"_prelude_raster_particle.glsl":Mt},Hy={};rn("",Kx),rn(Ya,qy),rn(Jx,Yx),rn(Tm,""),rn(Mt,"");const PE=rn(Xx,xf),Wy=Zx,hR=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Wy,PE.fragmentSource].join(`
`),CE=["precision highp float;",Wy,PE.vertexSource].join(`
`);var eb={background:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:rn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:rn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:rn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:rn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:rn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:rn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:rn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:rn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:rn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:rn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:rn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:rn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:rn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:rn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:rn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:rn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,bf),skyboxGradient:rn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,bf),skyboxCapture:rn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:rn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:rn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:rn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:rn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:rn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:rn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:rn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:rn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function od(m,s){const h=m.split(`
`);for(let g of h){if(g=g.trimStart(),g[0]!=="#"||!g.includes("if")||g.startsWith("#endif"))continue;const x=g.match(Qx);if(x)for(const S of x)rh.has(S)||s.add(S)}}function rn(m,s){const h=new Set,g=[],x=[];m=m.replace(Em,(T,O)=>(x.push(O),"")),s=s.replace(Em,(T,O)=>(g.push(O),""));let S=new Set(nh);od(m,S),od(s,S);for(const T of[...g,...x])Hy[T]||(Hy[T]=new Set,od(id[T],Hy[T])),S=new Set([...S,...Hy[T]]);return{fragmentSource:m=m.replace(wc,(T,O,R,z,F)=>(h.add(F),O==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${R} ${z} ${F};
#else
uniform ${R} ${z} u_${F};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${R} ${z} ${F} = u_${F};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${R} ${z} ${F};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(wc,(T,O,R,z,F)=>{const Z=`MATERIAL_ATTRIBUTE_OFFSET_${F}`,W=z==="float"?"vec2":z,K=`GET_ATTRIBUTE_${W}(a_${F}, materialInfo, ${Z})`,ne=F.match(/color/)?"color":W;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${R} ${z} a_${F};
#endif
`:h.has(F)?O==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
    #if !defined(${Z})
        in ${R} ${W} a_${F};
    #endif
out ${R} ${z} ${F};
#else
uniform ${R} ${z} u_${F};
#endif
`:O==="initialize"?ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${R} ${z} ${F} = u_${F};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${F})
    #ifdef ${Z}
        ${F} = unpack_mix_${ne}(${K}, u_${F}_t);
    #else
        ${F} = unpack_mix_${ne}(a_${F}, u_${F}_t);
    #endif
#else
    ${R} ${z} ${F} = u_${F};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${R} ${z} a_${F};
    out ${R} ${z} ${F};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
    #if !defined(${Z})
        in ${R} ${W} a_${F};
    #endif
#else
uniform ${R} ${z} u_${F};
#endif
`:O==="define-instanced"?ne==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${R} ${z} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${R} ${W} a_${F};
#else
uniform ${R} ${z} u_${F};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${R} ${z} ${F} = a_${F};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    #ifdef ${Z}
        ${R} ${z} ${F} = ${K};
    #else
        ${R} ${z} ${F} = a_${F};
    #endif
#else
    ${R} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    #ifdef ${Z}
        ${R} ${z} ${F} = unpack_mix_${ne}(${K}, u_${F}_t);
    #else
        ${R} ${z} ${F} = unpack_mix_${ne}(a_${F}, u_${F}_t);
    #endif
#else
    ${R} ${z} ${F} = u_${F};
#endif
`}),usedDefines:S,vertexIncludes:g,fragmentIncludes:x}}class fR{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,h,g,x,S,T,O,R){this.context=s;let z=this.boundPaintVertexBuffers.length!==x.length;for(let Z=0;!z&&Z<x.length;Z++)this.boundPaintVertexBuffers[Z]!==x[Z]&&(z=!0);let F=this.boundDynamicVertexBuffers.length!==O.length;for(let Z=0;!F&&Z<O.length;Z++)this.boundDynamicVertexBuffers[Z]!==O[Z]&&(F=!0);if(!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||z||F||this.boundIndexBuffer!==S||this.boundVertexOffset!==T)this.freshBind(h,g,x,S,T,O,R);else{s.bindVertexArrayOES.set(this.vao);for(const Z of O)Z&&(Z.bind(),R&&Z.instanceCount&&Z.setVertexAttribDivisor(s.gl,h,R));S&&S.dynamicDraw&&S.bind()}}freshBind(s,h,g,x,S,T,O){const R=this.context,z=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=x,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=T,h.enableAttributes(z,s),h.bind(),h.setVertexAttribPointers(z,s,S);for(const F of g)F.enableAttributes(z,s),F.bind(),F.setVertexAttribPointers(z,s,S);for(const F of T)F&&(F.enableAttributes(z,s),F.bind(),F.setVertexAttribPointers(z,s,S),O&&F.instanceCount&&F.setVertexAttribDivisor(z,s,O));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function pR(m,s){const h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new o.ae(0,g/h).toLngLat().lat,new o.ae(0,(g+1)/h).toLngLat().lat]}function mR(m,s,h,g,x,S,T){const O=m.context,R=O.gl,z=h.hillshadeFBO;if(!z)return;m.prepareDrawTile();const F=m.isTileAffectedByFog(s),Z=[];m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Z.push("USE_MRT1");const W=m.getOrCreateProgram("hillshade",{overrideFog:F,defines:Z});O.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment0.get());const K=((ce,ge,pe,fe)=>{const Ie=pe.paint.get("hillshade-shadow-color"),Ee=pe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Pe=pe.paint.get("hillshade-highlight-color"),be=pe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ve=pe.paint.get("hillshade-accent-color"),ke=pe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ne=pe.paint.get("hillshade-emissive-strength");let $e=o.an(pe.paint.get("hillshade-illumination-direction"));if(pe.paint.get("hillshade-illumination-anchor")==="viewport")$e-=ce.transform.angle;else if(ce.style&&ce.style.enable3dLights()&&ce.style.directionalLight){const Xe=ce.style.directionalLight.properties.get("direction"),ht=o.d4(Xe.x,Xe.y,Xe.z);$e=o.an(ht[1])}const Je=!ce.options.moving;return{u_matrix:fe||ce.transform.calculateProjMatrix(ge.tileID.toUnwrapped(),Je),u_image:0,u_latrange:pR(0,ge.tileID),u_light:[pe.paint.get("hillshade-exaggeration"),$e],u_shadow:Ie.toPremultipliedRenderColor(Ee?null:pe.lut),u_highlight:Pe.toPremultipliedRenderColor(be?null:pe.lut),u_emissive_strength:Ne,u_accent:ve.toPremultipliedRenderColor(ke?null:pe.lut)}})(m,h,g,m.terrain?s.projMatrix:null);m.uploadCommonUniforms(O,W,s.toUnwrapped());const{tileBoundsBuffer:ne,tileBoundsIndexBuffer:ee,tileBoundsSegments:ie}=m.getTileBoundsBuffers(h);W.draw(m,R.TRIANGLES,x,S,T,gr.disabled,K,g.id,ne,ee,ie)}function tb(m,s,h){if(!s.needsDEMTextureUpload)return;const g=m.context,x=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||m.getTileTexture(h.stride);const S=h.getPixels();s.demTexture?s.demTexture.update(S,{premultiply:!1}):s.demTexture=new o.T(g,S,x.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function gR(m,s,h){const g=m.context,x=g.gl;if(!s.dem)return;const S=s.dem;if(g.activeTexture.set(x.TEXTURE1),tb(m,s,S),!s.demTexture)return;s.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const T=S.dim;g.activeTexture.set(x.TEXTURE0);let O=s.hillshadeFBO;if(!O){const W=new o.T(g,{width:T,height:T,data:null},x.RGBA8);W.bind(x.LINEAR,x.CLAMP_TO_EDGE),O=s.hillshadeFBO=g.createFramebuffer(T,T,1,"renderbuffer"),O.colorAttachment0.set(W.texture)}g.bindFramebuffer.set(O.framebuffer),g.viewport.set([0,0,T,T]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:z,tileBoundsSegments:F}=m.getMercatorTileBoundsBuffers(),Z=[];m.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Z.push("USE_MRT1"),m.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(m,x.TRIANGLES,Qt.disabled,xr.disabled,Er.unblended,gr.disabled,((W,K)=>{const ne=K.stride,ee=o.bC();return o.ce(ee,0,o.al,-o.al,0,0,1),o.br(ee,ee,[0,-o.al,0]),{u_matrix:ee,u_image:1,u_dimension:[ne,ne],u_zoom:W.overscaledZ}})(s.tileID,S),h.id,R,z,F),s.needsHillshadePrepare=!1}class ai{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yR extends ai{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class IE extends ai{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class rb extends ai{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Zy extends ai{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class nb extends ai{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class ih extends ai{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class wf extends ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Am extends ai{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Sf extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class OE extends ai{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class ib extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class kE extends ai{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Tf extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class Xy extends ai{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ky extends ai{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class ob extends ai{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class Yy extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class Pm extends ai{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class RE extends ai{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let ME=class extends ai{getDefault(){return null}set(m){(m!==this.current||this.dirty)&&(this.gl.useProgram(m),this.current=m,this.dirty=!1)}};class DE extends ai{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Ef extends ai{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class LE extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class _R extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class vR extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class xR extends ai{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class sb extends ai{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ab extends ai{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class lb extends ai{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class cb extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class jE extends ai{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Jy extends ai{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class Qy extends Jy{constructor(s,h,g=0){super(s,h),this.attachmentPoint=s.gl.COLOR_ATTACHMENT0+g}setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachmentPoint,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Af extends Jy{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Cm extends Jy{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,this.attachment(),h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class NE extends Af{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ja=(m,s,h,g)=>({u_matrix:m,u_image0:0,u_image1:1,u_skirt_height:s,u_ground_shadow_factor:h,u_emissive_texture_available:g}),e_=(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:h,u_zoom_transition:x,u_merc_center:S,u_image0:0,u_image1:1,u_frustum_tl:T,u_frustum_tr:O,u_frustum_br:R,u_frustum_bl:z,u_globe_pos:F,u_globe_radius:Z,u_viewport:W,u_grid_matrix:ie?Float32Array.from(ie):new Float32Array(9),u_skirt_height:K,u_far_z_cutoff:ne,u_emissive_texture_available:ee});function Im(m,s){return m!=null&&s!=null&&!(!m.hasData()||!s.hasData())&&m.demTexture!=null&&s.demTexture!=null&&m.tileID.key!==s.tileID.key}const hu=new class{constructor(){this.operations={}}newMorphing(m,s,h,g,x){if(m in this.operations){const S=this.operations[m];S.to.tileID.key!==h.tileID.key&&(S.queued=h)}else this.operations[m]={startTime:g,phase:0,duration:x,from:s,to:h,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const s=this.operations[m];return{from:s.from,to:s.to,phase:s.phase}}update(m){for(const s in this.operations){const h=this.operations[s];for(h.phase=(m-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,m)){delete this.operations[s];break}}}_nextOp(m,s){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=s,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},t_={0:null,1:"TERRAIN_VERTEX_MORPHING"};function r_(m,s,h){if(s===0)return 0;const g=s<1&&h===514?.25/s:1;return 6*Math.pow(1.5,22-m)*Math.max(s,1)*g}function ub(m,s){const h=1<<m.z;return!s&&(m.x===0||m.x===h-1)||m.y===0||m.y===h-1}function Pf(m,s){if(!m.style||!m.style.enable3dLights())return;const h=m.context,g=h.gl;h.activeTexture.set(g.TEXTURE1),s?s.bind(g.LINEAR,g.CLAMP_TO_EDGE):m.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}const Om=m=>({u_matrix:m});function km(m,s,h,g,x){if(x>0){const S=o.o.now(),T=(S-m.timeAdded)/x,O=s?(S-s.timeAdded)/x:-1,R=h.getSource(),z=g.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),F=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(m.tileID.overscaledZ-z),Z=F&&m.refreshedUponExpiration?1:o.aA(F?T:1-O,0,1);return s?{opacity:1,mix:1-Z,isFading:T<1}:{opacity:Z,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class n_ extends ca{constructor(s){const h=Yd("mock-dem",{type:"raster-dem",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("mock-dem",h,!1),h.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,h){s.state="loaded",h(null)}}class db extends ca{constructor(s){const h=Yd("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},s.style.dispatcher,s.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,h,g){if(s.freezeTileCoverage)return;this.transform=s;const x=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,T)=>{if(S[T.key]="",!this._tiles[T.key]){const O=new Yu(T,this._source.tileSize*T.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);O.state="loaded",this._tiles[T.key]=O}return S},{});for(const S in this._tiles)S in x||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(s){const h=this.proxyCachedFBO[s];if(h!==void 0){const g=Object.values(h);this.renderCachePool.push(...g),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hb extends o.aQ{constructor(s,h,g){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=h,this.projMatrix=g}}class fb extends o.bV{constructor(s,h){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,x,S]=function(){const R=new o.bd,z=new o.b0,F=131;R.reserve(17161),z.reserve(33800);const Z=o.al/128,W=o.al+Z/2,K=W+Z;for(let ee=-Z;ee<K;ee+=Z)for(let ie=-Z;ie<K;ie+=Z){const ce=ie<0||ie>W||ee<0||ee>W?24575:0,ge=o.aA(Math.round(ie),0,o.al),pe=o.aA(Math.round(ee),0,o.al);R.emplaceBack(ge+ce,pe)}const ne=(ee,ie)=>{const ce=ie*F+ee;z.emplaceBack(ce+1,ce,ce+F),z.emplaceBack(ce+F,ce+F+1,ce+1)};for(let ee=1;ee<129;ee++)for(let ie=1;ie<129;ie++)ne(ie,ee);return[0,129].forEach(ee=>{for(let ie=0;ie<130;ie++)ne(ie,ee),ne(ee,ie)}),[R,z,32768]}(),T=s.context;this.gridBuffer=T.createVertexBuffer(g,o.bf.members),this.gridIndexBuffer=T.createIndexBuffer(x),this.gridSegments=o.bg.simpleSegment(0,0,g.length,x.length),this.gridNoSkirtSegments=o.bg.simpleSegment(0,0,g.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new db(h.map),this.orthoMatrix=o.bC(),o.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const O=T.gl;this._overlapStencilMode=new xr({func:O.GEQUAL,mask:255},0,255,O.KEEP,O.KEEP,O.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new n_(h.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,h,g){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const x=s.terrain.properties,S=s.terrain.drapeRenderMode===0,T=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const O=s.terrain&&s.terrain.scope,R=x.get("source"),z=S?this._mockSourceCache:s.getSourceCache(R,O);if(!z)return void o.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=z,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(h):x.get("exaggeration"),!h.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(h,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),h.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0,this._previousZoom=h.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const h=this._previousCameraAltitude,g=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=g;const x=h!=null?g-h:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const S=s.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(S);let O=S-this._previousZoom;const R=this._previousUpdateTimestamp;let z=S;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(S-z)>.5&&(O=.5*(S-z+O)),O*x<0&&(z+=O)),this._evaluationZoom=z;const F=T.getExaggeration(z),Z=F===T.getExaggeration(Math.max(0,z-.1));if(Z&&Math.abs(F-this._exaggeration)<.01)return F;let W=Math.min(.1,.00375*(this._updateTimestamp-R));return(Z||F<.1||Math.abs(O)<1e-4)&&(W=Math.min(.2,4*W)),o.ak(this._exaggeration,F,W)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.dataType==="source"&&s.coord?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=h.getIds().map(R=>{const z=h.getTileByID(R).tileID;return z.projMatrix=g.calculateProjMatrix(z.toUnwrapped()),z});(function(R,z){const F=z.transform.pointCoordinate(z.transform.getCameraPoint()),Z=new o.P(F.x,F.y);R.sort((W,K)=>{if(K.overscaledZ-W.overscaledZ)return K.overscaledZ-W.overscaledZ;const ne=new o.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),ee=new o.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ie=Z.mult(1<<W.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ne)-ie.distSqr(ee)})})(x,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},x.forEach(R=>{this.proxyToSource[R.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const R in T){const z=T[R];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,s[R],S),z.usedForTerrain))continue;const F=s[R];z.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[h.id]=x.map(R=>new hb(R,R.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const O={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const z=this.terrainTileForTile[R.key];if(!z)continue;const F=z.tileID.key;F in O||(this._visibleDemTiles.push(z),O[F]=F)}}_assignTerrainTiles(s){this._initializing||s.forEach(h=>{if(this.terrainTileForTile[h.key])return;const g=this._findTileCoveringTileID(h,this.sourceCache);g&&(this.terrainTileForTile[h.key]=g)})}_prepareDEMTextures(){const s=this.painter.context,h=s.gl;for(const g in this.terrainTileForTile){const x=this.terrainTileForTile[g],S=x.dem;!S||x.demTexture&&!x.needsDEMTextureUpload||(s.activeTexture.set(h.TEXTURE1),tb(this.painter,x,S))}}_prepareDemTileUniforms(s,h,g,x){if(!h||h.demTexture==null)return!1;const S=s.tileID.canonical,T=Math.pow(2,h.tileID.canonical.z-S.z),O=x||"";return g[`u_dem_tl${O}`]=[S.x*T%1,S.y*T%1],g[`u_dem_scale${O}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const h=this._visibleDemTiles.reduce((g,x)=>{if(!x.dem)return g;const S=x.dem.tree.minimums[0];return S>0&&s++,g+S},0);return s?h/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,h=s.gl;s.activeTexture.set(h.TEXTURE2);const g=this._getLoadedAreaMinimum(),x=new o.dL({width:1,height:1},new Float32Array([g]));this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(x,{premultiply:!1}):S=this._emptyDEMTexture=new o.T(s,x,h.R32F,{premultiply:!1}),S}setupElevationDraw(s,h,g){const x=this.painter.context,S=x.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let O=null,R=null,z=1;if(g&&g.morphing&&this._useVertexMorphing){const K=g.morphing.srcDemTile,ne=g.morphing.dstDemTile;z=g.morphing.phase,K&&ne&&(this._prepareDemTileUniforms(s,K,T,"_prev")&&(R=K),this._prepareDemTileUniforms(s,ne,T)&&(O=ne))}const F=K=>K&&K.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST;let Z=null;var W;if(this.enabled?R&&O?(Z=O.demTexture,x.activeTexture.set(S.TEXTURE4),R.demTexture.bind(F(R),S.CLAMP_TO_EDGE),T.u_dem_lerp=z):(O=this.terrainTileForTile[s.tileID.key],Z=this._prepareDemTileUniforms(s,O,T)?O.demTexture:this.emptyDEMTexture):Z=this.emptyDEMTexture,x.activeTexture.set(S.TEXTURE2),Z&&(T.u_dem_size=(W=Z).size[0]===1?1:W.size[0]-2,Z.bind(F(O),S.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(g&&g.useDepthForOcclusion,h,T),g&&g.useMeterToDem&&O){const K=(1<<O.tileID.canonical.z)*o.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=K}if(g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),h.setTerrainUniformValues(x,T),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,s.tileID.canonical,g&&g.useDenormalizedUpVectorScale);h.setGlobeUniformValues(x,K)}}globeUniformValues(s,h,g){const x=s.projection;return{u_tile_tl_up:x.upVector(h,0,0),u_tile_tr_up:x.upVector(h,o.al,0),u_tile_br_up:x.upVector(h,o.al,o.al),u_tile_bl_up:x.upVector(h,0,o.al),u_tile_up_scale:g?o.dM(1):x.upVectorScale(h,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const h=this.painter,g=this.painter.context;s.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,S,T,O,R){if(x.transform.projection.name==="globe")(function(z,F,Z,W,K){const ne=z.context,ee=ne.gl;let ie,ce;const ge=z.transform,pe=o.dE(z,ne,ge),fe=(Je,Xe)=>{if(ce===Xe)return;const ht=[t_[Xe],"PROJECTION_GLOBE_VIEW"];pe&&ht.push("CUSTOM_ANTIALIASING");const vt=z.isTileAffectedByFog(Je);ie=z.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:vt}),ce=Xe},Ie=z.colorModeForRenderPass(),Ee=new Qt(ee.LEQUAL,Qt.ReadWrite,z.depthRangeFor3D);hu.update(K);const Pe=o.dF(ge),be=[o.aF(ge.center.lng),o.aJ(ge.center.lat)],ve=z.globeSharedBuffers,ke=[ge.width*o.o.devicePixelRatio,ge.height*o.o.devicePixelRatio],Ne=Float32Array.from(ge.globeMatrix),$e={useDenormalizedUpVectorScale:!0};{const Je=z.transform,Xe=r_(Je.zoom,F.exaggeration(),F.sourceCache._source.tileSize);ce=-1;const ht=ee.TRIANGLES;for(const vt of W){const We=Z.getTile(vt),Re=xr.disabled,lt=F.prevTerrainTileForTile[vt.key],Qe=F.terrainTileForTile[vt.key];Im(lt,Qe)&&hu.newMorphing(vt.key,lt,Qe,K,250),Pf(z,We.emissiveTexture),ne.activeTexture.set(ee.TEXTURE0),We.texture&&We.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const bt=hu.getMorphValuesForProxy(vt.key),At=bt?1:0;bt&&Object.assign($e,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:o.dD(bt.phase)}});const Lt=o.dG(vt.canonical),Pt=o.dH(Lt.getCenter().lat),It=o.dI(vt.canonical,Lt,Pt,Je.worldSize/Je._pixelsPerMercatorPixel),Kt=o.bk(o.dJ(vt.canonical)),Xt=z.emissiveMode==="mrt-fallback"?1:0,Bt=e_(Je.expandedFarZProjMatrix,Ne,Pe,Kt,o.aj(Je.zoom),be,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,ke,Xe,Je._farZ,Xt,It);if(fe(vt,At),ie&&(F.setupElevationDraw(We,ie,$e),z.uploadCommonUniforms(ne,ie,vt.toUnwrapped()),ve)){const[Zt,or,yr]=ve.getGridBuffers(Pt,Xe!==0);ie.draw(z,ht,Ee,Re,Ie,gr.backCCW,Bt,"globe_raster",Zt,or,yr)}}}if(ve&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pe&&Je.push("CUSTOM_ANTIALIASING"),ie=z.getOrCreateProgram("globeRaster",{defines:Je});for(const Xe of W){const{x:ht,y:vt,z:We}=Xe.canonical,Re=vt===0,lt=vt===(1<<We)-1,[Qe,bt,At,Lt]=ve.getPoleBuffers(We,!1);if(Lt&&(Re||lt)){const Pt=Z.getTile(Xe);Pf(z,Pt.emissiveTexture),ne.activeTexture.set(ee.TEXTURE0),Pt.texture&&Pt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let It=o.dK(We,ht,ge);const Kt=o.bk(o.dJ(Xe.canonical)),Xt=z.emissiveMode==="mrt-fallback"?1:0,Bt=(Zt,or)=>Zt.draw(z,ee.TRIANGLES,Ee,xr.disabled,Ie,gr.disabled,e_(ge.expandedFarZProjMatrix,It,It,Kt,0,be,ge.frustumCorners.TL,ge.frustumCorners.TR,ge.frustumCorners.BR,ge.frustumCorners.BL,ge.globeCenterInViewSpace,ge.globeRadius,ke,0,ge._farZ,Xt),"globe_pole_raster",or,At,Lt);F.setupElevationDraw(Pt,ie,$e),z.uploadCommonUniforms(ne,ie,Xe.toUnwrapped()),Re&&z.renderDefaultNorthPole&&Bt(ie,Qe),lt&&z.renderDefaultSouthPole&&(It=o.cS(o.bC(),It,[1,-1,1]),Bt(ie,bt))}}}})(x,S,T,O,R);else{const z=x.context,F=z.gl;let Z,W;const K=x.shadowRenderer,ne=Pl(x,x.longestCutoffRange),ee=Ie=>{if(W===Ie)return;const Ee=[];Ee.push(t_[Ie]),ne.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),K&&(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&Ee.push("NORMAL_OFFSET")),Z=x.getOrCreateProgram("terrainRaster",{defines:Ee}),W=Ie},ie=x.colorModeForRenderPass(),ce=new Qt(F.LEQUAL,Qt.ReadWrite,x.depthRangeFor3D);hu.update(R);const ge=x.transform,pe=r_(ge.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let fe=[0,0,0];if(K){const Ie=x.style.directionalLight,Ee=x.style.ambientLight;Ie&&Ee&&(fe=Cl(x.style,Ie,Ee))}{W=-1;const Ie=F.TRIANGLES,[Ee,Pe]=[S.gridIndexBuffer,S.gridSegments];for(const be of O){const ve=T.getTile(be),ke=xr.disabled,Ne=S.prevTerrainTileForTile[be.key],$e=S.terrainTileForTile[be.key];Im(Ne,$e)&&hu.newMorphing(be.key,Ne,$e,R,250),Pf(x,ve.emissiveTexture),z.activeTexture.set(F.TEXTURE0),ve.texture&&ve.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Je=hu.getMorphValuesForProxy(be.key),Xe=Je?1:0;let ht;Je&&(ht={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:o.dD(Je.phase)}});const vt=x.emissiveMode==="mrt-fallback"?1:0,We=Ja(be.projMatrix,ub(be.canonical,ge.renderWorldCopies)?pe/10:pe,fe,vt);if(ee(Xe),!Z)continue;S.setupElevationDraw(ve,Z,ht);const Re=be.toUnwrapped();K&&K.setupShadows(Re,Z),x.uploadCommonUniforms(z,Z,Re,null,ne),Z.draw(x,Ie,ce,ke,ie,gr.backCCW,We,"terrain_raster",S.gridBuffer,Ee,Pe)}}}}(h,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const h=this.painter,g=this.painter.context,x=this.proxySourceCache,S=this.proxiedCoords[x.id],T=this._drapedRenderBatches.shift(),O=h.style.order,R=[];this._updateFBOs(h.emissiveMode==="mrt-fallback");let z=0;for(const F of S){const Z=x.getTileByID(F.proxyTileKey),W=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][s]:void 0,K=W!==void 0?x.renderCache[W]:this.pool[z++],ne=W!==void 0;if(Z.texture=K.tex,Z.emissiveTexture=K.emissiveTex,ne&&!K.dirty){R.push(Z.tileID);continue}g.bindFramebuffer.set(K.fb.framebuffer);const ee=g.gl;let ie;ee.drawBuffers(h.emissiveMode==="mrt-fallback"?[ee.COLOR_ATTACHMENT0,ee.COLOR_ATTACHMENT1]:[ee.COLOR_ATTACHMENT0]),this.renderedToTile=!1,K.dirty&&(g.clear({color:o.ao.transparent,stencil:0}),K.dirty=!1);for(let ce=T.start;ce<=T.end;++ce){const ge=h.style._mergedLayers[O[ce]];if(ge.isHidden(h.transform.zoom))continue;const pe=h.style.getLayerSourceCache(ge),fe=pe?this.proxyToSource[F.key][pe.id]:[F];if(!fe)continue;const Ie=fe;g.viewport.set([0,0,K.fb.width,K.fb.height]),ie!==(pe?pe.id:null)&&(this._setupStencil(K,fe,ge,pe),ie=pe?pe.id:null),h.renderLayer(h,pe,ge,Ie)}if(ee.drawBuffers([ee.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ce of this._pendingGroundEffectLayers){const ge=h.style._mergedLayers[O[ce]];if(ge.isHidden(h.transform.zoom))continue;const pe=h.style.getLayerSourceCache(ge),fe=pe?this.proxyToSource[F.key][pe.id]:[F];if(!fe)continue;const Ie=fe;g.viewport.set([0,0,K.fb.width,K.fb.height]),ie!==(pe?pe.id:null)&&(this._setupStencil(K,fe,ge,pe),ie=pe?pe.id:null),h.renderLayer(h,pe,ge,Ie)}this.renderedToTile?(K.dirty=!0,R.push(Z.tileID)):ne||--z,z===5&&(z=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,h.width,h.height]),T.end+1}postRender(){}isLayerOrderingCorrect(s){const h=s.order.length;let g=-1,x=h;for(let S=0;S<h;++S)this._style.isLayerDraped(s._mergedLayers[s.order[S]])?g=Math.max(g,S):x=Math.min(x,S);return x>g}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{s=Math.min(s,h.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,h,g){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const T=S.tileID,O=1<<T.overscaledZ,{x:R,y:z}=T.canonical,F=R/O,Z=(R+1)/O,W=z/O,K=(z+1)/O;return{minx:F,miny:W,maxx:Z,maxy:K,t:S.dem.tree.raycastRoot(F,W,Z,K,s,h,g),tile:S}});x.sort((S,T)=>(S.t!==null?S.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const S of x){if(S.t==null)return null;const T=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,s,h,g);if(T!=null)return T}return null}_createFBO(){const s=this.painter.context,h=s.gl,g=this.drapeBufferSize;s.activeTexture.set(h.TEXTURE0);const x=new o.T(s,{width:g[0],height:g[1],data:null},h.RGBA8);x.bind(h.LINEAR,h.CLAMP_TO_EDGE);const S=s.createFramebuffer(g[0],g[1],1,null);let T;return S.colorAttachment0.set(x.texture),this._emissiveTexture&&(T=new o.T(s,{width:g[0],height:g[1],data:null},h.R8),T.bind(h.LINEAR,h.CLAMP_TO_EDGE),S.createColorAttachment(s,1),S.colorAttachment1.set(T.texture)),S.depthAttachment=new NE(s,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:S,tex:x,emissiveTex:T,dirty:!1}}_updateFBOs(s){if(this._emissiveTexture!==s){for(const h of this.pool)this._updateFBO(h,s);for(const h of this.proxySourceCache.renderCache)this._updateFBO(h,s);this._emissiveTexture=s}}_updateFBO(s,h){const g=s.fb,x=this.painter.context,S=x.gl,T=this.drapeBufferSize;if(h){const O=new o.T(x,{width:T[0],height:T[1],data:null},S.R8);O.bind(S.LINEAR,S.CLAMP_TO_EDGE),s.emissiveTex=O,g.createColorAttachment(x,1),g.colorAttachment1.set(O.texture)}else s.emissiveTex=void 0,g.removeColorAttachment(x,1);s.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const h=this._style._mergedLayers[s],g=h.isHidden(this.painter.transform.zoom);return h.type==="hillshade"||h.type==="custom"?!g&&h.shouldRedrape():!g&&h.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const g of this._style.getSources())if(g instanceof El){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],S=this._style.getLayerSourceCache(x);if(!S||h[S.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="line")continue;const T=x.widthExpression(),O=x.emissiveStrengthExpression();if(T instanceof o.ad||O instanceof o.ad){h[S.id]=!0;for(const R of this.proxyCoords){const z=this.proxyToSource[R.key][S.id];if(z)for(const F of z)this._clearRenderCacheForTile(S.id,F)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof Gl){s=!0;break}if(!s)return;const h={};for(let g=0;g<this._style.order.length;++g){const x=this._style._mergedLayers[this._style.order[g]],S=this._style.getLayerSourceCache(x);if(!S||h[S.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const T=x.paint.get("raster-fade-duration");for(const O of this.proxyCoords){const R=this.proxyToSource[O.key][S.id];if(R)for(const z of R){const F=km(S.getTile(z),S.findLoadedParent(z,0),S,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(S.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,h=s.length;if(h===0)return;const g=[];this._pendingGroundEffectLayers=[];let x,S=0,T=this._style._mergedLayers[s[S]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++S<h;)T=this._style._mergedLayers[s[S]];for(;S<h;++S){const O=this._style._mergedLayers[s[S]];O.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(O)?x===void 0&&(x=S):(O.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),x!==void 0&&(g.push({start:x,end:S-1}),x=void 0)))}if(x!==void 0&&g.push({start:x,end:S-1}),g.length!==0){const O=g[g.length-1];this._pendingGroundEffectLayers.every(R=>R>O.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(s){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const T=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let O=0;O<T.length;++O){const R=Object.values(T[O]);h.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,x=this._tilesDirty;for(let T=g.length-1;T>=0;T--){const O=g[T];if(h.getTileByID(O.key),h.proxyCachedFBO[O.key]!==void 0){const R=s[O.key],z=this.proxyToSource[O.key];let F=0;for(const Z in z){const W=z[Z],K=R[Z];if(!K||K.length!==W.length||W.some((ne,ee)=>ne!==K[ee]||x[Z]&&x[Z].hasOwnProperty(ne.key))){F=-1;break}++F}for(const Z in h.proxyCachedFBO[O.key])h.renderCache[h.proxyCachedFBO[O.key][Z]].dirty=F<0||F!==Object.values(R).length}}const S=[...this._drapedRenderBatches];S.sort((T,O)=>O.end-O.start-(T.end-T.start));for(const T of S)for(const O of g){if(h.proxyCachedFBO[O.key])continue;let R=h.renderCachePool.pop();R===void 0&&h.renderCache.length<50&&(R=h.renderCache.length,h.renderCache.push(this._createFBO())),R!==void 0&&(h.proxyCachedFBO[O.key]={},h.proxyCachedFBO[O.key][T.start]=R,h.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(s,h,g,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,T=S.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let O;if(g.isTileClipped())O=h.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);O=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+O>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=O,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):xr.disabled}_renderTileClippingMasks(s,h){const g=this.painter,x=this.painter.context,S=x.gl;g._tileClippingMaskIDs={},x.setColorMode(Er.disabled),x.setDepthMode(Qt.disabled);const T=g.getOrCreateProgram("clippingMask");for(const O of s){const R=g._tileClippingMaskIDs[O.key]=--h;T.draw(g,S.TRIANGLES,Qt.disabled,new xr({func:S.ALWAYS,mask:0},R,255,S.KEEP,S.KEEP,S.REPLACE),Er.disabled,gr.disabled,Om(O.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(s){const h=this.painter.transform;if(s.x<0||s.x>h.width||s.y<0||s.y>h.height)return null;const g=[s.x,s.y,1,1];o.aC(g,g,h.pixelMatrixInverse),o.cK(g,g,1/g[3]),g[0]/=h.worldSize,g[1]/=h.worldSize;const x=h._camera.position,S=o.cf(1,h.center.lat),T=[x[0],x[1],x[2]/S,0],O=o.da([],g.slice(0,3),T);o.aw(O,O);const R=this.raycast(T,O,this._exaggeration);return R!==null&&R?(o.bH(T,T,O,R),T[3]=T[2],T[2]*=S,T):null}_setupProxiedCoordsForOrtho(s,h,g){if(s.getSource()instanceof o.aU)return this._setupProxiedCoordsForImageSource(s,h,g);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const x=this.proxiedCoords[s.id]=[],S=this.proxyCoords;for(let R=0;R<S.length;R++){const z=S[R],F=this._findTileCoveringTileID(z,s);if(F){const Z=this._createProxiedId(z,F,g[z.key]&&g[z.key][s.id]);x.push(Z),this.proxyToSource[z.key][s.id]=[Z]}}let T=!1;const O=new Set;for(let R=0;R<h.length;R++){const z=s.getTile(h[R]);if(!z||!z.hasData())continue;const F=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==z.tileID.canonical.z){const Z=this.proxyToSource[F.tileID.key][s.id],W=this._createProxiedId(F.tileID,z,g[F.tileID.key]&&g[F.tileID.key][s.id]);Z?Z.splice(Z.length-1,0,W):this.proxyToSource[F.tileID.key][s.id]=[W];const K=this.proxyToSource[F.tileID.key][s.id];O.has(K)||O.add(K),x.push(W),T=!0}}if(this._sourceTilesOverlap[s.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const R of O)R.sort((z,F)=>F.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(s,h,g){if(!s.getSource().loaded())return;const x=this.proxiedCoords[s.id]=[],S=this.proxyCoords,T=s.getSource(),O=T.tileID;if(!O)return;const R=new o.P(O.x,O.y)._div(1<<O.z),z=T.coordinates.map(o.ae.fromLngLat).reduce((Z,W)=>(Z.min.x=Math.min(Z.min.x,W.x-R.x),Z.min.y=Math.min(Z.min.y,W.y-R.y),Z.max.x=Math.max(Z.max.x,W.x-R.x),Z.max.y=Math.max(Z.max.y,W.y-R.y),Z),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(Z,W)=>{const K=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ne=Z.canonical.y/(1<<Z.canonical.z),ee=o.al/(1<<Z.canonical.z),ie=W.wrap+W.canonical.x/(1<<W.canonical.z),ce=W.canonical.y/(1<<W.canonical.z);return K+ee<ie+z.min.x||K>ie+z.max.x||ne+ee<ce+z.min.y||ne>ce+z.max.y};for(let Z=0;Z<S.length;Z++){const W=S[Z];for(let K=0;K<h.length;K++){const ne=s.getTile(h[K]);if(!ne||!ne.hasData()||F(W,ne.tileID))continue;const ee=this._createProxiedId(W,ne,g[W.key]&&g[W.key][s.id]),ie=this.proxyToSource[W.key][s.id];ie?ie.push(ee):this.proxyToSource[W.key][s.id]=[ee],x.push(ee)}}}_createProxiedId(s,h,g){let x=this.orthoMatrix;if(g){const S=g.find(T=>T.key===h.tileID.key);if(S)return S}if(h.tileID.key!==s.key){const S=s.canonical.z-h.tileID.canonical.z;let T,O,R;x=o.bC();const z=h.tileID.wrap-s.wrap<<s.overscaledZ;S>0?(T=o.al>>S,O=T*((h.tileID.canonical.x<<S)-s.canonical.x+z),R=T*((h.tileID.canonical.y<<S)-s.canonical.y)):(T=o.al<<-S,O=o.al*(h.tileID.canonical.x-(s.canonical.x+z<<-S)),R=o.al*(h.tileID.canonical.y-(s.canonical.y<<-S))),o.ce(x,0,T,0,T,0,1),o.br(x,x,[O,R,0])}return new hb(h.tileID,s.key,x)}_findTileCoveringTileID(s,h){let g=h.getTile(s);if(g&&g.hasData())return g;const x=this._findCoveringTileCache[h.id],S=x[s.key];if(g=S?h.getTileByID(S):null,g&&g.hasData()||S===null)return g;let T=g?g.tileID:s,O=T.overscaledZ;const R=h.getSource().minzoom,z=[];if(!S){const Z=h.getSource().maxzoom;if(s.canonical.z>=Z){const W=s.canonical.z-Z;h.getSource().reparseOverscaled?(O=Math.max(s.canonical.z+2,h.transform.tileZoom),T=new o.aQ(O,s.wrap,Z,s.canonical.x>>W,s.canonical.y>>W)):W!==0&&(O=Z,T=new o.aQ(O,s.wrap,Z,s.canonical.x>>W,s.canonical.y>>W))}T.key!==s.key&&(z.push(T.key),g=h.getTile(T))}const F=Z=>{z.forEach(W=>{x[W]=Z}),z.length=0};for(O-=1;O>=R&&(!g||!g.hasData());O--){g&&F(g.tileID.key);const Z=T.calculateScaledKey(O);if(g=h.getTileByID(Z),g&&g.hasData())break;const W=x[Z];if(W===null)break;W===void 0?z.push(Z):g=h.getTileByID(W)}return F(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,h){let g=this._tilesDirty[s];g||(g=this._tilesDirty[s]={}),g[h.key]=!0}}function Cf(m,s,h){const g=function(O,R,z){const F=o.bJ(R,O),Z=o.bJ(z,[.2126,.7152,.0722]),W=(ne,ee,ie)=>(1-ie)*ne+ie*ee,K=W(1-.3*Math.min(Z,1),1,Math.min(F+1,1));return W(.92,1,Math.asin(o.aA(R[2],-1,1))/Math.PI+.5)*K}(m,[0,0,1],s),x=[0,0,0];o.c5(x,h.slice(0,3),g);const S=[0,0,0];o.c5(S,s.slice(0,3),m[2]);const T=[0,0,0];return o.d8(T,x,S),o.db(T)}const bR=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],wR=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class zE{static cacheKey(s,h,g,x){const S=[h];x&&S.push(x.cacheKey);for(const T of g)s.usedDefines.has(T)&&S.push(T);return S.join("/")}constructor(s,h,g,x,S,T){const O=s.gl;this.program=O.createProgram(),this.configuration=x,this.name=h,this.fixedDefines=[...T];const R=`#version 300 es
${(x?x.defines():[]).concat(T.map(ee=>`#define ${ee}`)).join(`
`)}`,z=[R,hR];for(const ee of g.fragmentIncludes)z.push(id[ee]);z.push(g.fragmentSource);const F=z.join(`
`),Z=[R,CE];for(const ee of g.vertexIncludes)Z.push(id[ee]);this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&g.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Z.push("uniform int u_instanceID;"),Z.push(g.vertexSource);let W=Z.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(W=W.replaceAll("gl_InstanceID","u_instanceID"));const K=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(K,F),O.compileShader(K),O.attachShader(this.program,K);const ne=O.createShader(O.VERTEX_SHADER);O.isContextLost()?this.failedToCreate=!0:(O.shaderSource(ne,W),O.compileShader(ne),O.attachShader(this.program,ne),this.attributes={},O.linkProgram(this.program),O.deleteShader(ne),O.deleteShader(K),this.fixedUniforms=S(s),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=x?x.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ee=>({u_instanceID:new o.ch(ee)}))(s)),(T.includes("TERRAIN")||h.includes("symbol")||h.includes("circle"))&&(this.terrainUniforms=(ee=>({u_dem:new o.ch(ee),u_dem_prev:new o.ch(ee),u_dem_tl:new o.ck(ee),u_dem_scale:new o.cj(ee),u_dem_tl_prev:new o.ck(ee),u_dem_scale_prev:new o.cj(ee),u_dem_size:new o.cj(ee),u_dem_lerp:new o.cj(ee),u_exaggeration:new o.cj(ee),u_depth:new o.ch(ee),u_depth_size_inv:new o.ck(ee),u_depth_range_unpack:new o.ck(ee),u_occluder_half_size:new o.cj(ee),u_occlusion_depth_offset:new o.cj(ee),u_meter_to_dem:new o.cj(ee),u_label_plane_matrix_inv:new o.cl(ee)}))(s)),T.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new o.ci(ee),u_tile_tr_up:new o.ci(ee),u_tile_br_up:new o.ci(ee),u_tile_bl_up:new o.ci(ee),u_tile_up_scale:new o.cj(ee)}))(s)),T.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new o.cl(ee),u_fog_range:new o.ck(ee),u_fog_color:new o.d3(ee),u_fog_horizon_blend:new o.cj(ee),u_fog_vertical_limit:new o.ck(ee),u_fog_temporal_offset:new o.cj(ee),u_frustum_tl:new o.ci(ee),u_frustum_tr:new o.ci(ee),u_frustum_br:new o.ci(ee),u_frustum_bl:new o.ci(ee),u_globe_pos:new o.ci(ee),u_globe_radius:new o.cj(ee),u_globe_transition:new o.cj(ee),u_is_globe:new o.ch(ee),u_viewport:new o.ck(ee)}))(s)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ee=>({u_cutoff_params:new o.d3(ee)}))(s)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ee=>({u_lighting_ambient_color:new o.ci(ee),u_lighting_directional_dir:new o.ci(ee),u_lighting_directional_color:new o.ci(ee),u_ground_radiance:new o.ci(ee)}))(s)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ee=>({u_light_matrix_0:new o.cl(ee),u_light_matrix_1:new o.cl(ee),u_fade_range:new o.ck(ee),u_shadow_normal_offset:new o.ci(ee),u_shadow_intensity:new o.cj(ee),u_shadow_texel_size:new o.cj(ee),u_shadow_map_resolution:new o.cj(ee),u_shadow_direction:new o.ci(ee),u_shadow_bias:new o.ci(ee),u_shadowmap_0:new o.ch(ee),u_shadowmap_1:new o.ch(ee)}))(s)))}getAttributeLocation(s,h){let g=this.attributes[h];return g===void 0&&(g=this.attributes[h]=s.getAttribLocation(this.program,h)),g}setTerrainUniformValues(s,h){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)g[x]&&g[x].set(this.program,x,h[x])}}setGlobeUniformValues(s,h){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)g[x]&&g[x].set(this.program,x,h[x])}}setFogUniformValues(s,h){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)g[x].set(this.program,x,h[x])}}setCutoffUniformValues(s,h){if(!this.cutoffUniforms)return;const g=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)g[x].set(this.program,x,h[x])}}setLightsUniformValues(s,h){if(!this.lightsUniforms)return;const g=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in h)g[x].set(this.program,x,h[x])}}setShadowUniformValues(s,h){if(this.failedToCreate||!this.shadowUniforms)return;const g=this.shadowUniforms;s.program.set(this.program);for(const x in h)g[x].set(this.program,x,h[x])}_drawDebugWireframe(s,h,g,x,S,T,O,R,z,F){const Z=s.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;const W=s.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||s._terrain&&s._terrain.renderingToTexture||!bR.includes(this.name))||!(!Z.layers3D||!wR.includes(this.name))))return;const K=W.gl,ne=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,S,W);if(!ne)return;const ee=[...this.fixedDefines,"DEBUG_WIREFRAME"],ie=s.getOrCreateProgram(this.name,{config:this.configuration,defines:ee});W.program.set(ie.program);const ce=(fe,Ie,Ee)=>{if(Ie[fe]&&Ee[fe])for(const Pe in Ie[fe])Ee[fe][Pe]&&Ee[fe][Pe].set(Ee.program,Pe,Ie[fe][Pe].current)};z&&z.setUniforms(ie.program,W,ie.binderUniforms,O,{zoom:R}),ce("fixedUniforms",this,ie),ce("terrainUniforms",this,ie),ce("globeUniforms",this,ie),ce("fogUniforms",this,ie),ce("lightsUniforms",this,ie),ce("shadowUniforms",this,ie),ne.bind(),W.setColorMode(new Er([K.ONE,K.ONE_MINUS_SRC_ALPHA,K.ZERO,K.ONE],o.ao.transparent,[!0,!0,!0,!1])),W.setDepthMode(new Qt(h.func===K.LESS?K.LEQUAL:h.func,Qt.ReadOnly,h.range)),W.setStencilMode(xr.disabled);const ge=3*T.primitiveLength*2,pe=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=F||1;for(let Ie=0;Ie<fe;++Ie)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ie),K.drawElements(K.LINES,ge,K.UNSIGNED_SHORT,pe)}else F&&F>1?K.drawElementsInstanced(K.LINES,ge,K.UNSIGNED_SHORT,pe,F):K.drawElements(K.LINES,ge,K.UNSIGNED_SHORT,pe);S.bind(),W.program.set(this.program),W.setDepthMode(h),W.setStencilMode(g),W.setColorMode(x)}checkUniforms(s,h,g){if(this.fixedDefines.includes(h)){for(const x of Object.keys(g))if(!g[x].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${x} not set but required by ${h} being defined`)}}draw(s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie){const ce=s.context,ge=ce.gl;if(this.failedToCreate)return;ce.program.set(this.program),ce.setDepthMode(g),ce.setStencilMode(x),ce.setColorMode(S),ce.setCullFace(T);for(const[be,ve]of this.fixedUniformsEntries)ve.set(this.program,be,O[be]);ne&&ne.setUniforms(this.program,ce,this.binderUniforms,W,{zoom:K});const pe={[ge.POINTS]:1,[ge.LINES]:2,[ge.TRIANGLES]:3,[ge.LINE_STRIP]:1}[h];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const fe=ee||[],Ie=ne?ne.getPaintVertexBuffers():[],Ee=h===ge.TRIANGLES&&F,Pe=ie&&ie>0?1:void 0;for(const be of Z.get()){const ve=be.vaos||(be.vaos={});if((ve[R]||(ve[R]=new fR)).bind(ce,this,z,Ie,F,be.vertexOffset,fe,Pe),this.forceManualRenderingForInstanceIDShaders){const ke=ie||1;for(let Ne=0;Ne<ke;++Ne)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ne),F?ge.drawElements(h,be.primitiveLength*pe,ge.UNSIGNED_SHORT,be.primitiveOffset*pe*2):ge.drawArrays(h,be.vertexOffset,be.vertexLength)}else ie&&ie>1?ge.drawElementsInstanced(h,be.primitiveLength*pe,ge.UNSIGNED_SHORT,be.primitiveOffset*pe*2,ie):F?ge.drawElements(h,be.primitiveLength*pe,ge.UNSIGNED_SHORT,be.primitiveOffset*pe*2):ge.drawArrays(h,be.vertexOffset,be.vertexLength);Ee&&this._drawDebugWireframe(s,g,x,S,F,be,W,K,ne,ie)}}}function FE(m,s,h=0){const g=Math.pow(2,s.tileID.overscaledZ),x=s.tileSize*Math.pow(2,m.transform.tileZoom)/g,S=x*(s.tileID.canonical.x+s.tileID.wrap*g),T=x*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(s,1,m.transform.tileZoom),u_pixel_coord_upper:[S>>16,T>>16],u_pixel_coord_lower:[65535&S,65535&T],u_pattern_transition:h}}const i_={terrain:0,flat:1},SR=o.bC(),o_=(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce)=>{const ge=s.style.light,pe=ge.properties.get("position"),fe=[pe.x,pe.y,pe.z],Ie=o.dO();ge.properties.get("anchor")==="viewport"&&(o.dP(Ie,-s.transform.angle),o.dQ(fe,fe,Ie));const Ee=ge.properties.get("color").toPremultipliedRenderColor(null),Pe=s.transform,be={u_matrix:m,u_lightpos:fe,u_lightintensity:ge.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_vertical_gradient:+h,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:SR,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:i_[z],u_base_type:i_[F],u_ao:x,u_edge_radius:S,u_width_scale:T,u_flood_light_color:ne,u_vertical_scale:ee,u_flood_light_intensity:ie,u_ground_shadow_factor:ce};return Pe.projection.name==="globe"&&(be.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],be.u_zoom_transition=Z,be.u_inv_rot_matrix=K,be.u_merc_center=W,be.u_up_dir=Pe.projection.upVector(new o.cD(0,0,0),W[0]*o.al,W[1]*o.al),be.u_height_lift=R),be},pb=(m,s,h,g,x,S)=>({u_matrix:m,u_edge_radius:s,u_width_scale:h,u_vertical_scale:g,u_height_type:i_[x],u_base_type:i_[S]}),BE=(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce)=>{const ge=o_(m,s,h,g,x,S,T,O,z,F,Z,W,K,ne,ee,ie,1,[0,0,0]),pe={u_height_factor:-Math.pow(2,O.overscaledZ)/R.tileSize/8};return Object.assign(ge,FE(s,R,ce),pe)},oh=(m,s,h)=>({u_matrix:m,u_emissive_strength:s,u_ground_shadow_factor:h}),mb=(m,s,h,g,x,S=0)=>Object.assign(oh(m,s,x),FE(h,g,S)),$E=(m,s,h,g)=>({u_matrix:m,u_world:h,u_emissive_strength:s,u_ground_shadow_factor:g}),VE=(m,s,h,g,x,S,T=0)=>Object.assign(mb(m,s,h,g,S,T),{u_world:x}),gb=(m,s)=>({u_matrix:m,u_depth_bias:s}),sd=(m,s)=>({u_matrix:m,u_ground_shadow_factor:s}),sh=(m,s,h,g,x)=>({u_matrix:m,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:h,u_height_scale:g,u_reset_depth:x}),s_=(m,s,h,g,x,S,T,O,R)=>({u_matrix:m,u_normal_matrix:s,u_opacity:h,u_faux_facade_ao_intensity:g,u_camera_pos:x,u_tile_to_meter:S,u_facade_emissive_chance:T,u_flood_light_color:O,u_flood_light_intensity:R}),UE=m=>({u_matrix:m}),ad=m=>({u_matrix:m}),yb=(m,s,h,g,x,S,T,O)=>{const R=o.al/S.tileSize;return{u_matrix:m,u_inv_rot_matrix:s,u_camera_to_center_distance:h.getCameraToCenterDistance(O),u_extrude_scale:[h.pixelsToGLUnits[0]/R,h.pixelsToGLUnits[1]/R],u_zoom_transition:g,u_tile_id:T,u_merc_center:x}},a_=(m,s,h,g)=>({u_matrix:m,u_inv_matrix:s,u_camera_to_center_distance:h.getCameraToCenterDistance(g),u_viewport_size:[h.width,h.height]}),_b=(m,s,h=1)=>({u_matrix:m,u_color:s,u_overlay:0,u_overlay_scale:h}),GE=o.bC(),vb=(m,s,h,g,x,S,T)=>{const O=m.transform,R=O.projection.name==="globe",z=R?o.dR(O.zoom,s.canonical)*O._pixelsPerMercatorPixel:o.ay(h,1,S),F={u_matrix:s.projMatrix,u_extrude_scale:z,u_intensity:T,u_inv_rot_matrix:GE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){F.u_inv_rot_matrix=g,F.u_merc_center=x,F.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],F.u_zoom_transition=o.aj(O.zoom);const Z=x[0]*o.al,W=x[1]*o.al;F.u_up_dir=O.projection.upVector(new o.cD(0,0,0),Z,W)}return F};function l_(m,[s,h,g,x],[S,T]){if(S===T)return[0,0,0,0];const O=255*(m-1)/(m*(T-S));return[s*O,h*O,g*O,x*O]}function qE(m,s,[h,g]){return h===g?0:.5/m+(s-h)*(m-1)/(m*(g-h))}const xb=(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce,ge,pe,fe)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:o.dT(Z.paint.get("raster-saturation")),u_contrast_factor:o.dS(Z.paint.get("raster-contrast")),u_spin_weights:Rm(Z.paint.get("raster-hue-rotate")),u_perspective_transform:W,u_raster_elevation:K,u_zoom_transition:T,u_merc_center:O,u_cutoff_params:R,u_colorization_mix:l_(o.dU,ee,ce),u_colorization_offset:qE(o.dU,ie,ce),u_color_ramp:ne,u_texture_offset:[pe/(ge+2*pe),ge/(ge+2*pe)],u_texture_res:[ge+2*pe,ge+2*pe],u_emissive_strength:fe});function Rm(m){m*=Math.PI/180;const s=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const If=.05,TR=(m,s,h,g,x,S,T,O,R,z,F,Z)=>({u_matrix:m,u_normalize_matrix:s,u_globe_matrix:h,u_merc_matrix:g,u_grid_matrix:x,u_tl_parent:S,u_scale_parent:z,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:Z,u_zoom_transition:T,u_merc_center:O,u_cutoff_params:R}),HE=(m,s,h,g,x,S,T,O,R,z)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_tile_offset:h,u_velocity:g,u_color_ramp:S,u_velocity_res:x,u_max_speed:T,u_uv_offset:O,u_data_scale:[255*R[0],255*R[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[If,If]}),ER=(m,s,h,g,x,S,T,O,R,z)=>({u_particle_texture:m,u_particle_texture_side_len:s,u_velocity:h,u_velocity_res:g,u_max_speed:x,u_speed_factor:S,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:O,u_data_scale:[255*R[0],255*R[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[If,If]}),c_=o.bC(),Mm=(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce,ge,pe,fe,Ie,Ee,Pe)=>{const be=x.transform,ve={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:be.getCameraToCenterDistance(ge),u_rotate_symbol:+h,u_aspect_ratio:be.width/be.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:T,u_coord_matrix:O,u_is_text:+z,u_elevation_from_sea:R?1:0,u_pitch_with_map:+g,u_texsize:F,u_texsize_icon:Z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:c_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:c_,u_up_vector:[0,-1,0],u_color_adj_mat:Ie,u_icon_transition:Ee||0,u_gamma_scale:g?x.transform.getCameraToCenterDistance(ge)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Pe||1,u_ground_shadow_factor:pe,u_inv_matrix:o.bl(o.bC(),T),u_normal_scale:fe,u_lutTexture:10};return ge.name==="globe"&&(ve.u_tile_id=[K.canonical.x,K.canonical.y,1<<K.canonical.z],ve.u_zoom_transition=ne,ve.u_inv_rot_matrix=ie,ve.u_merc_center=ee,ve.u_camera_forward=be._camera.forward(),ve.u_ecef_origin=o.dV(be.globeMatrix,K.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(be.globeMatrix),ve.u_up_vector=ce),ve},ld=(m,s,h,g)=>({u_matrix:m,u_emissive_strength:s,u_opacity:h,u_color:g}),Dm=(m,s,h,g,x,S,T,O,R)=>Object.assign(function(z,F,Z,W,K,ne){const{width:ee,height:ie}=W.imageManager.getPixelSize(F),ce=Math.pow(2,ne.tileID.overscaledZ),ge=ne.tileSize*Math.pow(2,W.transform.tileZoom)/ce,pe=ge*(ne.tileID.canonical.x+ne.tileID.wrap*ce),fe=ge*ne.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[ee,ie],u_pattern_size:Z.displaySize,u_pattern_units_to_pixels:K?[W.transform.width,-1*W.transform.height]:[1/o.ay(ne,1,W.transform.tileZoom),1/o.ay(ne,1,W.transform.tileZoom)],u_pixel_coord_upper:[pe>>16,fe>>16],u_pixel_coord_lower:[65535&pe,65535&fe]}}(0,S,T,g,O,R),{u_matrix:m,u_emissive_strength:s,u_opacity:h}),ah=new Float32Array(o.bA([])),u_=(m,s,h,g,x,S,T,O,R,z,F,Z,W,K=[0,0,0],ne,ee,ie)=>{const ce=x.style.light,ge=ce.properties.get("position"),pe=[-ge.x,-ge.y,ge.z],fe=o.dO();ce.properties.get("anchor")==="viewport"&&(o.dP(fe,-x.transform.angle),o.dQ(pe,pe,fe));const Ie=F.alphaMode==="MASK",Ee=ce.properties.get("color").toNonPremultipliedRenderColor(null),Pe=W.paint.get("model-ambient-occlusion-intensity"),be=W.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return be.a=W.paint.get("model-color-mix-intensity").constantOr(0),ie&&(be.r=ie[0],be.g=ie[1],be.b=ie[2],be.a=ie[3]),ee&&(be.r=ee.color.r,be.g=ee.color.g,be.b=ee.color.b,be.a=ee.colorMix,Z=ee.emissionStrength,S*=ee.opacity),{u_matrix:m,u_lighting_matrix:s,u_normal_matrix:h,u_node_matrix:g||ah,u_lightpos:pe,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_camera_pos:K,u_opacity:S,u_baseTextureIsAlpha:0,u_alphaMask:+Ie,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:O.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:z,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:be.toArray01(),u_aoIntensity:Pe,u_emissive_strength:Z,u_occlusionTextureTransform:ne||[0,0,0,0]}},Lm=(m,s=ah,h=ah)=>({u_matrix:m,u_instance:s,u_node_matrix:h}),d_={fillExtrusion:m=>({u_matrix:new o.cl(m),u_lightpos:new o.ci(m),u_lightintensity:new o.cj(m),u_lightcolor:new o.ci(m),u_vertical_gradient:new o.cj(m),u_opacity:new o.cj(m),u_edge_radius:new o.cj(m),u_width_scale:new o.cj(m),u_ao:new o.ck(m),u_height_type:new o.ch(m),u_base_type:new o.ch(m),u_tile_id:new o.ci(m),u_zoom_transition:new o.cj(m),u_inv_rot_matrix:new o.cl(m),u_merc_center:new o.ck(m),u_up_dir:new o.ci(m),u_height_lift:new o.cj(m),u_flood_light_color:new o.ci(m),u_vertical_scale:new o.cj(m),u_flood_light_intensity:new o.cj(m),u_ground_shadow_factor:new o.ci(m)}),fillExtrusionDepth:m=>({u_matrix:new o.cl(m),u_edge_radius:new o.cj(m),u_width_scale:new o.cj(m),u_vertical_scale:new o.cj(m),u_height_type:new o.ch(m),u_base_type:new o.ch(m)}),fillExtrusionPattern:m=>({u_matrix:new o.cl(m),u_lightpos:new o.ci(m),u_lightintensity:new o.cj(m),u_lightcolor:new o.ci(m),u_vertical_gradient:new o.cj(m),u_height_factor:new o.cj(m),u_edge_radius:new o.cj(m),u_width_scale:new o.cj(m),u_ao:new o.ck(m),u_height_type:new o.ch(m),u_base_type:new o.ch(m),u_tile_id:new o.ci(m),u_zoom_transition:new o.cj(m),u_inv_rot_matrix:new o.cl(m),u_merc_center:new o.ck(m),u_up_dir:new o.ci(m),u_height_lift:new o.cj(m),u_image:new o.ch(m),u_texsize:new o.ck(m),u_pixel_coord_upper:new o.ck(m),u_pixel_coord_lower:new o.ck(m),u_tile_units_to_pixels:new o.cj(m),u_opacity:new o.cj(m),u_pattern_transition:new o.cj(m)}),fillExtrusionGroundEffect:m=>({u_matrix:new o.cl(m),u_opacity:new o.cj(m),u_ao_pass:new o.cj(m),u_meter_to_tile:new o.cj(m),u_ao:new o.ck(m),u_flood_light_intensity:new o.cj(m),u_flood_light_color:new o.ci(m),u_attenuation:new o.cj(m),u_edge_radius:new o.cj(m),u_fb:new o.ch(m),u_fb_size:new o.cj(m),u_dynamic_offset:new o.cj(m)}),fill:m=>({u_matrix:new o.cl(m),u_emissive_strength:new o.cj(m),u_ground_shadow_factor:new o.ci(m)}),fillPattern:m=>({u_matrix:new o.cl(m),u_emissive_strength:new o.cj(m),u_image:new o.ch(m),u_texsize:new o.ck(m),u_pixel_coord_upper:new o.ck(m),u_pixel_coord_lower:new o.ck(m),u_tile_units_to_pixels:new o.cj(m),u_ground_shadow_factor:new o.ci(m),u_pattern_transition:new o.cj(m)}),fillOutline:m=>({u_matrix:new o.cl(m),u_emissive_strength:new o.cj(m),u_world:new o.ck(m),u_ground_shadow_factor:new o.ci(m)}),fillOutlinePattern:m=>({u_matrix:new o.cl(m),u_emissive_strength:new o.cj(m),u_world:new o.ck(m),u_image:new o.ch(m),u_texsize:new o.ck(m),u_pixel_coord_upper:new o.ck(m),u_pixel_coord_lower:new o.ck(m),u_tile_units_to_pixels:new o.cj(m),u_ground_shadow_factor:new o.ci(m),u_pattern_transition:new o.cj(m)}),building:m=>({u_matrix:new o.cl(m),u_normal_matrix:new o.cl(m),u_opacity:new o.cj(m),u_faux_facade_ao_intensity:new o.cj(m),u_camera_pos:new o.ci(m),u_tile_to_meter:new o.cj(m),u_facade_emissive_chance:new o.cj(m),u_flood_light_color:new o.ci(m),u_flood_light_intensity:new o.cj(m)}),buildingBloom:m=>({u_matrix:new o.cl(m)}),buildingDepth:m=>({u_matrix:new o.cl(m)}),elevatedStructuresDepth:m=>({u_matrix:new o.cl(m),u_depth_bias:new o.cj(m)}),elevatedStructures:m=>({u_matrix:new o.cl(m),u_ground_shadow_factor:new o.ci(m)}),elevatedStructuresDepthReconstruct:m=>({u_matrix:new o.cl(m),u_camera_pos:new o.ci(m),u_depth_bias:new o.cj(m),u_height_scale:new o.cj(m),u_reset_depth:new o.cj(m)}),circle:o.dY,collisionBox:m=>({u_matrix:new o.cl(m),u_inv_rot_matrix:new o.cl(m),u_camera_to_center_distance:new o.cj(m),u_extrude_scale:new o.ck(m),u_zoom_transition:new o.cj(m),u_merc_center:new o.ck(m),u_tile_id:new o.ci(m)}),collisionCircle:m=>({u_matrix:new o.cl(m),u_inv_matrix:new o.cl(m),u_camera_to_center_distance:new o.cj(m),u_viewport_size:new o.ck(m)}),debug:m=>({u_color:new o.dB(m),u_matrix:new o.cl(m),u_overlay:new o.ch(m),u_overlay_scale:new o.cj(m)}),clippingMask:m=>({u_matrix:new o.cl(m)}),heatmap:m=>({u_extrude_scale:new o.cj(m),u_intensity:new o.cj(m),u_matrix:new o.cl(m),u_inv_rot_matrix:new o.cl(m),u_merc_center:new o.ck(m),u_tile_id:new o.ci(m),u_zoom_transition:new o.cj(m),u_up_dir:new o.ci(m)}),heatmapTexture:m=>({u_image:new o.ch(m),u_color_ramp:new o.ch(m),u_opacity:new o.cj(m)}),hillshade:m=>({u_matrix:new o.cl(m),u_image:new o.ch(m),u_latrange:new o.ck(m),u_light:new o.ck(m),u_shadow:new o.dB(m),u_highlight:new o.dB(m),u_emissive_strength:new o.cj(m),u_accent:new o.dB(m)}),hillshadePrepare:m=>({u_matrix:new o.cl(m),u_image:new o.ch(m),u_dimension:new o.ck(m),u_zoom:new o.cj(m)}),line:o.dX,linePattern:o.dW,raster:m=>({u_matrix:new o.cl(m),u_normalize_matrix:new o.cl(m),u_globe_matrix:new o.cl(m),u_merc_matrix:new o.cl(m),u_grid_matrix:new o.dC(m),u_tl_parent:new o.ck(m),u_scale_parent:new o.cj(m),u_fade_t:new o.cj(m),u_opacity:new o.cj(m),u_image0:new o.ch(m),u_image1:new o.ch(m),u_brightness_low:new o.cj(m),u_brightness_high:new o.cj(m),u_saturation_factor:new o.cj(m),u_contrast_factor:new o.cj(m),u_spin_weights:new o.ci(m),u_perspective_transform:new o.ck(m),u_raster_elevation:new o.cj(m),u_zoom_transition:new o.cj(m),u_merc_center:new o.ck(m),u_cutoff_params:new o.d3(m),u_colorization_mix:new o.d3(m),u_colorization_offset:new o.cj(m),u_color_ramp:new o.ch(m),u_texture_offset:new o.ck(m),u_texture_res:new o.ck(m),u_emissive_strength:new o.cj(m)}),rasterParticle:m=>({u_matrix:new o.cl(m),u_normalize_matrix:new o.cl(m),u_globe_matrix:new o.cl(m),u_merc_matrix:new o.cl(m),u_grid_matrix:new o.dC(m),u_tl_parent:new o.ck(m),u_scale_parent:new o.cj(m),u_fade_t:new o.cj(m),u_opacity:new o.cj(m),u_image0:new o.ch(m),u_image1:new o.ch(m),u_raster_elevation:new o.cj(m),u_zoom_transition:new o.cj(m),u_merc_center:new o.ck(m),u_cutoff_params:new o.d3(m)}),rasterParticleTexture:m=>({u_texture:new o.ch(m),u_opacity:new o.cj(m)}),rasterParticleDraw:m=>({u_particle_texture:new o.ch(m),u_particle_texture_side_len:new o.cj(m),u_tile_offset:new o.ck(m),u_velocity:new o.ch(m),u_color_ramp:new o.ch(m),u_velocity_res:new o.ck(m),u_max_speed:new o.cj(m),u_uv_offset:new o.ck(m),u_data_scale:new o.ck(m),u_data_offset:new o.cj(m),u_particle_pos_scale:new o.cj(m),u_particle_pos_offset:new o.ck(m)}),rasterParticleUpdate:m=>({u_particle_texture:new o.ch(m),u_particle_texture_side_len:new o.cj(m),u_velocity:new o.ch(m),u_velocity_res:new o.ck(m),u_max_speed:new o.cj(m),u_speed_factor:new o.cj(m),u_reset_rate:new o.cj(m),u_rand_seed:new o.cj(m),u_uv_offset:new o.ck(m),u_data_scale:new o.ck(m),u_data_offset:new o.cj(m),u_particle_pos_scale:new o.cj(m),u_particle_pos_offset:new o.ck(m)}),symbol:m=>({u_is_size_zoom_constant:new o.ch(m),u_is_size_feature_constant:new o.ch(m),u_size_t:new o.cj(m),u_size:new o.cj(m),u_camera_to_center_distance:new o.cj(m),u_rotate_symbol:new o.ch(m),u_aspect_ratio:new o.cj(m),u_fade_change:new o.cj(m),u_matrix:new o.cl(m),u_label_plane_matrix:new o.cl(m),u_coord_matrix:new o.cl(m),u_is_text:new o.ch(m),u_elevation_from_sea:new o.ch(m),u_pitch_with_map:new o.ch(m),u_texsize:new o.ck(m),u_texsize_icon:new o.ck(m),u_texture:new o.ch(m),u_texture_icon:new o.ch(m),u_gamma_scale:new o.cj(m),u_device_pixel_ratio:new o.cj(m),u_tile_id:new o.ci(m),u_zoom_transition:new o.cj(m),u_inv_rot_matrix:new o.cl(m),u_merc_center:new o.ck(m),u_camera_forward:new o.ci(m),u_tile_matrix:new o.cl(m),u_up_vector:new o.ci(m),u_ecef_origin:new o.ci(m),u_is_halo:new o.ch(m),u_icon_transition:new o.cj(m),u_color_adj_mat:new o.cl(m),u_scale_factor:new o.cj(m),u_ground_shadow_factor:new o.ci(m),u_inv_matrix:new o.cl(m),u_normal_scale:new o.cj(m),u_lutTexture:new o.ch(m)}),background:m=>({u_matrix:new o.cl(m),u_emissive_strength:new o.cj(m),u_opacity:new o.cj(m),u_color:new o.dB(m)}),backgroundPattern:m=>({u_matrix:new o.cl(m),u_emissive_strength:new o.cj(m),u_opacity:new o.cj(m),u_image:new o.ch(m),u_pattern_tl:new o.ck(m),u_pattern_br:new o.ck(m),u_texsize:new o.ck(m),u_pattern_size:new o.ck(m),u_pixel_coord_upper:new o.ck(m),u_pixel_coord_lower:new o.ck(m),u_pattern_units_to_pixels:new o.ck(m)}),terrainRaster:m=>({u_matrix:new o.cl(m),u_image0:new o.ch(m),u_image1:new o.ch(m),u_skirt_height:new o.cj(m),u_ground_shadow_factor:new o.ci(m),u_emissive_texture_available:new o.cj(m)}),skybox:m=>({u_matrix:new o.cl(m),u_sun_direction:new o.ci(m),u_cubemap:new o.ch(m),u_opacity:new o.cj(m),u_temporal_offset:new o.cj(m)}),skyboxGradient:m=>({u_matrix:new o.cl(m),u_color_ramp:new o.ch(m),u_center_direction:new o.ci(m),u_radius:new o.cj(m),u_opacity:new o.cj(m),u_temporal_offset:new o.cj(m)}),skyboxCapture:m=>({u_matrix_3f:new o.dC(m),u_sun_direction:new o.ci(m),u_sun_intensity:new o.cj(m),u_color_tint_r:new o.d3(m),u_color_tint_m:new o.d3(m),u_luminance:new o.cj(m)}),globeRaster:m=>({u_proj_matrix:new o.cl(m),u_globe_matrix:new o.cl(m),u_normalize_matrix:new o.cl(m),u_merc_matrix:new o.cl(m),u_zoom_transition:new o.cj(m),u_merc_center:new o.ck(m),u_image0:new o.ch(m),u_image1:new o.ch(m),u_grid_matrix:new o.dC(m),u_skirt_height:new o.cj(m),u_far_z_cutoff:new o.cj(m),u_frustum_tl:new o.ci(m),u_frustum_tr:new o.ci(m),u_frustum_br:new o.ci(m),u_frustum_bl:new o.ci(m),u_globe_pos:new o.ci(m),u_globe_radius:new o.cj(m),u_viewport:new o.ck(m),u_emissive_texture_available:new o.cj(m)}),globeAtmosphere:m=>({u_frustum_tl:new o.ci(m),u_frustum_tr:new o.ci(m),u_frustum_br:new o.ci(m),u_frustum_bl:new o.ci(m),u_horizon:new o.cj(m),u_transition:new o.cj(m),u_fadeout_range:new o.cj(m),u_atmosphere_fog_color:new o.d3(m),u_high_color:new o.d3(m),u_space_color:new o.d3(m),u_temporal_offset:new o.cj(m),u_horizon_angle:new o.cj(m)}),model:m=>({u_matrix:new o.cl(m),u_lighting_matrix:new o.cl(m),u_normal_matrix:new o.cl(m),u_node_matrix:new o.cl(m),u_lightpos:new o.ci(m),u_lightintensity:new o.cj(m),u_lightcolor:new o.ci(m),u_camera_pos:new o.ci(m),u_opacity:new o.cj(m),u_baseColorFactor:new o.d3(m),u_emissiveFactor:new o.d3(m),u_metallicFactor:new o.cj(m),u_roughnessFactor:new o.cj(m),u_baseTextureIsAlpha:new o.ch(m),u_alphaMask:new o.ch(m),u_alphaCutoff:new o.cj(m),u_baseColorTexture:new o.ch(m),u_metallicRoughnessTexture:new o.ch(m),u_normalTexture:new o.ch(m),u_occlusionTexture:new o.ch(m),u_emissionTexture:new o.ch(m),u_lutTexture:new o.ch(m),u_color_mix:new o.d3(m),u_aoIntensity:new o.cj(m),u_emissive_strength:new o.cj(m),u_occlusionTextureTransform:new o.d3(m)}),modelDepth:m=>({u_matrix:new o.cl(m),u_instance:new o.cl(m),u_node_matrix:new o.cl(m)}),groundShadow:m=>({u_matrix:new o.cl(m),u_ground_shadow_factor:new o.ci(m)}),stars:m=>({u_matrix:new o.cl(m),u_up:new o.ci(m),u_right:new o.ci(m),u_intensity_multiplier:new o.cj(m)}),snowParticle:m=>({u_modelview:new o.cl(m),u_projection:new o.cl(m),u_time:new o.cj(m),u_cam_pos:new o.ci(m),u_velocityConeAperture:new o.cj(m),u_velocity:new o.cj(m),u_horizontalOscillationRadius:new o.cj(m),u_horizontalOscillationRate:new o.cj(m),u_boxSize:new o.cj(m),u_billboardSize:new o.cj(m),u_simpleShapeParameters:new o.ck(m),u_screenSize:new o.ck(m),u_thinningCenterPos:new o.ck(m),u_thinningShape:new o.ci(m),u_thinningAffectedRatio:new o.cj(m),u_thinningParticleOffset:new o.cj(m),u_particleColor:new o.d3(m),u_direction:new o.ci(m)}),rainParticle:m=>({u_modelview:new o.cl(m),u_projection:new o.cl(m),u_time:new o.cj(m),u_cam_pos:new o.ci(m),u_texScreen:new o.ch(m),u_velocityConeAperture:new o.cj(m),u_velocity:new o.cj(m),u_boxSize:new o.cj(m),u_rainDropletSize:new o.ck(m),u_distortionStrength:new o.cj(m),u_rainDirection:new o.ci(m),u_color:new o.d3(m),u_screenSize:new o.ck(m),u_thinningCenterPos:new o.ck(m),u_thinningShape:new o.ci(m),u_thinningAffectedRatio:new o.cj(m),u_thinningParticleOffset:new o.cj(m),u_shapeDirectionalPower:new o.cj(m),u_shapeNormalPower:new o.cj(m),u_mode:new o.cj(m)}),vignette:m=>({u_vignetteShape:new o.ci(m),u_vignetteColor:new o.d3(m)}),occlusion:m=>({u_matrix:new o.cl(m),u_anchorPos:new o.ci(m),u_screenSizePx:new o.ck(m),u_occluderSizePx:new o.ck(m),u_color:new o.d3(m)})};class Sc{constructor(s,h,g,x){this.id=Sc.uniqueIdxCounter,Sc.uniqueIdxCounter++,this.context=s;const S=s.gl;this.buffer=S.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||x||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=Sc.uniqueIdxCounter,Sc.uniqueIdxCounter++;const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Sc.uniqueIdxCounter=0;const WE={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class AR{constructor(s,h,g,x,S,T){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=x,this.instanceCount=T,this.context=s;const O=s.gl;this.buffer=O.createBuffer(),s.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||S||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){const x=h.getAttributeLocation(s,this.attributes[g].name);x!==-1&&s.enableVertexAttribArray(x)}}setVertexAttribPointers(s,h,g){for(let x=0;x<this.attributes.length;x++){const S=this.attributes[x],T=h.getAttributeLocation(s,S.name);T!==-1&&s.vertexAttribPointer(T,S.components,s[WE[S.type]],!1,this.itemSize,S.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(s,h,g){for(let x=0;x<this.attributes.length;x++){const S=h.getAttributeLocation(s,this.attributes[x].name);S!==-1&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(S,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lh{constructor(s,h,g,x,S){this.context=s,this.width=h,this.height=g;const T=this.framebuffer=s.gl.createFramebuffer();x>0&&(this.colorAttachment0=new Qy(s,T,0)),x>1&&(this.colorAttachment1=new Qy(s,T,1)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new Af(s,T):new Cm(s,T))}createColorAttachment(s,h){h===0?this.colorAttachment0=new Qy(s,this.framebuffer,0):h===1&&(this.colorAttachment1=new Qy(s,this.framebuffer,1))}removeColorAttachment(s,h){const g=this.context.gl;let x;h===0?(x=this.colorAttachment0.get(),this.colorAttachment0=void 0):h===1&&(x=this.colorAttachment1.get(),this.colorAttachment1=void 0),x&&g.deleteTexture(x)}destroy(){const s=this.context.gl;if(this.colorAttachment0){const h=this.colorAttachment0.get();h&&s.deleteTexture(h)}if(this.colorAttachment1){const h=this.colorAttachment1.get();h&&s.deleteTexture(h)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const h=this.depthAttachment.get();h&&s.deleteRenderbuffer(h)}else{const h=this.depthAttachment.get();h&&s.deleteTexture(h)}s.deleteFramebuffer(this.framebuffer)}}class h_{constructor(s,h){this.gl=s,this.clearColor=new yR(this),this.clearDepth=new IE(this),this.clearStencil=new rb(this),this.colorMask=new Zy(this),this.depthMask=new nb(this),this.stencilMask=new ih(this),this.stencilFunc=new wf(this),this.stencilOp=new Am(this),this.stencilTest=new Sf(this),this.depthRange=new OE(this),this.depthTest=new ib(this),this.depthFunc=new kE(this),this.blend=new Tf(this),this.blendFunc=new Xy(this),this.blendColor=new Ky(this),this.blendEquation=new ob(this),this.cullFace=new Yy(this),this.cullFaceSide=new Pm(this),this.frontFace=new RE(this),this.program=new ME(this),this.activeTexture=new DE(this),this.viewport=new Ef(this),this.bindFramebuffer=new LE(this),this.bindRenderbuffer=new _R(this),this.bindTexture=new vR(this),this.bindVertexBuffer=new xR(this),this.bindElementBuffer=new sb(this),this.bindVertexArrayOES=new ab(this),this.pixelStoreUnpack=new lb(this),this.pixelStoreUnpackPremultiplyAlpha=new cb(this),this.pixelStoreUnpackFlipY=new jE(this),this.options=h?Object.assign({},h):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=h&&!!h.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=s.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h,g){return new Sc(this,s,h,g)}createVertexBuffer(s,h,g,x,S){return new AR(this,s,h,g,x,S)}createRenderbuffer(s,h,g){const x=this.gl,S=x.createRenderbuffer();return this.bindRenderbuffer.set(S),x.renderbufferStorage(x.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),S}createFramebuffer(s,h,g,x){return new lh(this,s,h,g,x)}clear({color:s,depth:h,stencil:g,colorMask:x}){const S=this.gl;let T=0;s&&(T|=S.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),h!==void 0&&(T|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(T|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),S.clear(T)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.by(s.blendFunction,Er.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Wt;function bb(m,s,h,g,x,S,T){const O=m.context,R=O.gl,z=m.transform,F=[o.aF(z.center.lng),o.aJ(z.center.lat)],Z=h.layout.get("symbol-placement"),W=h.layout.get("text-variable-anchor"),K=h.layout.get("icon-rotation-alignment")==="map",ne=h.layout.get("text-rotation-alignment")==="map",ee=Z!=="point",ie=[];let ce=0,ge=0;for(let be=0;be<g.length;be++){const ve=g[be],ke=s.getTile(ve),Ne=ke.getBucket(h);if(!Ne)continue;const $e=Ne.getProjection().createInversionMatrix(z,ve.canonical),Je=[],Xe=sR(ve,Ne,z),ht=!T&&K&&ee,vt=T&&ne&&ee,We=W&&Ne.hasTextData(),Re=Ne.hasIconTextFit()&&We&&Ne.hasIconData(),lt=ht||vt||T&&We||Re,Qe=Ne.projection.name==="globe",bt=Qe?o.aj(z.zoom):0;Qe&&(Je.push("PROJECTION_GLOBE_VIEW"),lt&&Je.push("PROJECTED_POS_ON_VIEWPORT"));const At=m.getOrCreateProgram("collisionBox",{defines:Je});let Lt=Xe;x[0]===0&&x[1]===0||(Lt=m.translatePosMatrix(Xe,ke,x,S));const Pt=T?Ne.textCollisionBox:Ne.iconCollisionBox,It=Ne.collisionCircleArray;if(It.length>0){const Xt=o.bC(),Bt=Lt;o.cP(Xt,Ne.placementInvProjMatrix,z.glCoordMatrix),o.cP(Xt,Xt,Ne.placementViewportMatrix),ie.push({circleArray:It,circleOffset:ge,transform:Bt,invTransform:Xt,projection:Ne.getProjection()}),ce+=It.length/4,ge=ce}if(!Pt)continue;m.terrain&&m.terrain.setupElevationDraw(ke,At);const Kt=Qe?[ve.canonical.x,ve.canonical.y,1<<ve.canonical.z]:[0,0,0];At.draw(m,R.LINES,Qt.disabled,xr.disabled,m.colorModeForRenderPass(),gr.disabled,yb(Lt,$e,z,bt,F,ke,Kt,Ne.getProjection()),h.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,null,z.zoom,null,[Pt.collisionVertexBuffer,Pt.collisionVertexBufferExt])}if(!T||!ie.length)return;const pe=m.getOrCreateProgram("collisionCircle"),fe=new o.dZ;fe.resize(4*ce),fe._trim();let Ie=0;for(const be of ie)for(let ve=0;ve<be.circleArray.length/4;ve++){const ke=4*ve,Ne=be.circleArray[ke+0],$e=be.circleArray[ke+1],Je=be.circleArray[ke+2],Xe=be.circleArray[ke+3];fe.emplace(Ie++,Ne,$e,Je,Xe,0),fe.emplace(Ie++,Ne,$e,Je,Xe,1),fe.emplace(Ie++,Ne,$e,Je,Xe,2),fe.emplace(Ie++,Ne,$e,Je,Xe,3)}(!Wt||Wt.length<2*ce)&&(Wt=function(be){const ve=2*be,ke=new o.b0;ke.resize(ve),ke._trim();for(let Ne=0;Ne<ve;Ne++){const $e=6*Ne;ke.uint16[$e+0]=4*Ne+0,ke.uint16[$e+1]=4*Ne+1,ke.uint16[$e+2]=4*Ne+2,ke.uint16[$e+3]=4*Ne+2,ke.uint16[$e+4]=4*Ne+3,ke.uint16[$e+5]=4*Ne+0}return ke}(ce));const Ee=O.createIndexBuffer(Wt,!0),Pe=O.createVertexBuffer(fe,o.d_.members,!0);for(const be of ie){const ve=a_(be.transform,be.invTransform,z,be.projection);pe.draw(m,R.TRIANGLES,Qt.disabled,xr.disabled,m.colorModeForRenderPass(),gr.disabled,ve,h.id,Pe,Ee,o.bg.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,z.zoom)}Pe.destroy(),Ee.destroy()}const ql=o.bC();function fu(m){const s=m._camera.getWorldToCamera(m.worldSize,1),h=o.aB([],s,m.globeMatrix);o.bl(h,h);const g=[0,0,0],x=[0,1,0,0];return o.aC(x,x,h),g[0]=x[0],g[1]=x[1],g[2]=x[2],o.aw(g,g),g}function ZE({width:m,height:s,anchor:h,textOffset:g,textScale:x},S){const{horizontalAlign:T,verticalAlign:O}=o.c1(h),R=-(T-.5)*m,z=-(O-.5)*s,F=o.c2(h,g);return new o.P((R/x+F[0])*S,(z/x+F[1])*S)}function XE(m,s,h,g,x,S,T,O,R,z){const F=m.text.placedSymbolArray,Z=m.text.dynamicLayoutVertexArray,W=m.icon.dynamicLayoutVertexArray,K={},ne=m.getProjection(),ee=mf(T,ne,x),ie=x.elevation,ce=ne.upVectorScale(T.canonical,x.center.lat,x.worldSize).metersToTile;Z.clear();for(let ge=0;ge<F.length;ge++){const pe=F.get(ge),{tileAnchorX:fe,tileAnchorY:Ie,numGlyphs:Ee}=pe,Pe=pe.hidden||!pe.crossTileID||m.allowVerticalPlacement&&!pe.placedOrientation?null:g[pe.crossTileID];if(Pe){let be=0,ve=0,ke=0;const Ne=m.elevationType==="road";if(ie||Ne){const Qe=Ne?m.getElevationFeatureForText(ge):null,bt=o.bV.getAtTileOffset(T,new o.P(fe,Ie),ie,Qe),[At,Lt,Pt]=ne.upVector(T.canonical,fe,Ie);be=bt*At*ce,ve=bt*Lt*ce,ke=bt*Pt*ce}let[$e,Je,Xe,ht]=Al(pe.projectedAnchorX+be,pe.projectedAnchorY+ve,pe.projectedAnchorZ+ke,h?ee:S);const vt=Ly(x.getCameraToCenterDistance(ne),ht);let We=o.bM(m.textSizeData,R,pe)*vt/o.bY;h&&(We*=m.tilePixelRatio/O);const Re=ZE(Pe,We);h?({x:$e,y:Je,z:Xe}=ne.projectTilePoint(fe+Re.x,Ie+Re.y,T.canonical),[$e,Je,Xe]=Al($e+be,Je+ve,Xe+ke,S)):(s&&Re._rotate(-x.angle),$e+=Re.x,Je+=Re.y,Xe=0);const lt=m.allowVerticalPlacement&&pe.placedOrientation===o.bL.vertical?Math.PI/2:0;for(let Qe=0;Qe<Ee;Qe++)o.bO(Z,$e,Je,Xe,lt);z&&pe.associatedIconIndex>=0&&(K[pe.associatedIconIndex]={x:$e,y:Je,z:Xe,angle:lt})}else Hs(Ee,Z)}if(z){W.clear();const ge=m.icon.placedSymbolArray;for(let pe=0;pe<ge.length;pe++){const fe=ge.get(pe),{numGlyphs:Ie}=fe,Ee=K[pe];if(fe.hidden||!Ee)Hs(Ie,W);else{const{x:Pe,y:be,z:ve,angle:ke}=Ee;for(let Ne=0;Ne<Ie;Ne++)o.bO(W,Pe,be,ve,ke)}}m.icon.dynamicLayoutVertexBuffer.updateData(W)}m.text.dynamicLayoutVertexBuffer.updateData(Z)}function f_(m,s,h,g,x,S,T={}){const O=h.paint.get("icon-translate"),R=h.paint.get("text-translate"),z=h.paint.get("icon-translate-anchor"),F=h.paint.get("text-translate-anchor"),Z=h.layout.get("icon-rotation-alignment"),W=h.layout.get("text-rotation-alignment"),K=h.layout.get("icon-pitch-alignment"),ne=h.layout.get("text-pitch-alignment"),ee=h.layout.get("icon-keep-upright"),ie=h.layout.get("text-keep-upright"),ce=h.paint.get("icon-color-saturation"),ge=h.paint.get("icon-color-contrast"),pe=h.paint.get("icon-color-brightness-min"),fe=h.paint.get("icon-color-brightness-max"),Ie=h.layout.get("symbol-elevation-reference")==="sea",Ee=h.layout.get("icon-image-use-theme")==="none",Pe=m.context,be=Pe.gl,ve=m.transform,ke=Z==="map",Ne=W==="map",$e=K==="map",Je=ne==="map",Xe=h.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ht=!1;const vt=m.depthModeForSublayer(0,Qt.ReadOnly),We=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D),Re=[o.aF(ve.center.lng),o.aJ(ve.center.lat)],lt=h.layout.get("text-variable-anchor"),Qe=ve.projection.name==="globe",bt=[],At=[0,-1,0];for(const Lt of g){const Pt=s.getTile(Lt),It=Pt.getBucket(h);if(!It||It.projection.name==="mercator"&&Qe||It.fullyClipped)continue;const Kt=It.projection.name==="globe",Xt=Kt?o.aj(ve.zoom):0,Bt=mf(Lt,It.getProjection(),ve),Zt=ve.calculatePixelsToTileUnitsMatrix(Pt),or=lt&&It.hasTextData(),yr=It.hasIconTextFit()&&or&&It.hasIconData(),Lr=It.getProjection().createInversionMatrix(ve,Lt.canonical),Jr=(1<<Pt.tileID.canonical.z)*o.al/m.transform.worldSize,Tr=_n=>{let qr=[0,0,0];if(_n){const Rr=m.style.directionalLight,Zn=m.style.ambientLight;Rr&&Zn&&(qr=Cl(m.style,Rr,Zn))}return qr},ln=_n=>{ve.depthOcclusionForSymbolsAndCircles&&(h.hasOcclusionOpacityProperties||m.terrain)&&(_n.push("DEPTH_D24"),_n.push("DEPTH_OCCLUSION"))},Cr=_n=>{h.lut&&!Ee&&(h.lut.texture||(h.lut.texture=new o.d$(m.context,h.lut.image,[h.lut.image.height,h.lut.image.height,h.lut.image.height],Pe.gl.RGBA8)),Pe.activeTexture.set(Pe.gl.TEXTURE0+10),h.lut.texture&&h.lut.texture.bind(Pe.gl.LINEAR,Pe.gl.CLAMP_TO_EDGE),_n.push("APPLY_LUT_ON_GPU"))},In=()=>{const _n=ke&&h.layout.get("symbol-placement")!=="point",qr=[];ln(qr),Cr(qr);const Rr=_n||yr,Zn=It.elevationType==="road",wi=m.shadowRenderer,Jn=Zn&&$e&&!!wi&&wi.enabled,ri=Tr(Jn),Ys=Zn&&$e&&!m.terrain?We:vt,ga=h.paint.get("icon-image-cross-fade");m.terrainRenderModeElevated()&&$e&&qr.push("PITCH_WITH_MAP_TERRAIN"),Kt&&(qr.push("PROJECTION_GLOBE_VIEW"),Rr&&qr.push("PROJECTED_POS_ON_VIEWPORT")),ga>0&&It.hasAnySecondaryIcon&&qr.push("ICON_TRANSITION"),!It.icon.zOffsetVertexBuffer||Zn&&m.terrain||qr.push("Z_OFFSET"),ce===0&&ge===0&&pe===0&&fe===1||qr.push("COLOR_ADJUSTMENT"),It.sdfIcons&&qr.push("RENDER_SDF"),Jn&&qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Zn&&$e&&!m.terrain&&It.icon.orientationVertexBuffer&&qr.push("ELEVATED_ROADS");const Do=It.icon.programConfigurations.get(h.id),vn=m.getOrCreateProgram("symbol",{config:Do,defines:qr}),Oa=Pt.imageAtlasTexture?Pt.imageAtlasTexture.size:[0,0],cs=It.iconSizeData,ya=o.bK(cs,ve.zoom),Ol=$e||!ve.isOrthographic,Js=Qd(Bt,Pt.tileID.canonical,$e,ke,ve,It.getProjection(),Zt),mi=ua(Bt,Pt.tileID.canonical,$e,ke,ve,It.getProjection(),Zt),Fi=m.translatePosMatrix(mi,Pt,O,z,!0),Qn=m.translatePosMatrix(Bt,Pt,O,z),eo=Rr?ql:Js,gs=ke&&!$e&&!_n;let Mi=At;!Qe&&!ve.mercatorFromTransition||ke||(Mi=fu(ve));const ka=Kt?Mi:At,Ym=h.getColorAdjustmentMatrix(ce,ge,pe,fe),Pc=Mm(cs.kind,ya,gs,$e,m,Qn,eo,Fi,Ie,!1,Oa,[0,0],0,Lt,Xt,Re,Lr,ka,It.getProjection(),ri,Jr,Ym,ga,null),$f=Pt.imageAtlasTexture?Pt.imageAtlasTexture:null,Vf=h.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear,Ra=It.sdfIcons||m.options.rotating||m.options.zooming||Vf||Ol?be.LINEAR:be.NEAREST,Cc=It.sdfIcons&&h.paint.get("icon-halo-width").constantOr(1)!==0,Ic=m.terrain&&$e&&_n?o.bl(o.bC(),Js):ql;if(_n&&It.icon){const rl=o.bV.getAtTileOffsetFunc(Lt,ve.center.lat,ve.worldSize,It.getProjection()),gu=cu(Bt,Pt.tileID.canonical,$e,ke,ve,It.getProjection(),Zt),fh=h.layout.get("icon-size-scale-range"),P_=o.aA(m.scaleFactor,fh[0],fh[1]);En(It,Bt,m,!1,gu,mi,$e,ee,rl,Lt,P_)}return{program:vn,buffers:It.icon,uniformValues:Pc,atlasTexture:$f,atlasTextureIcon:null,atlasInterpolation:Ra,atlasInterpolationIcon:null,isSDF:It.sdfIcons,hasHalo:Cc,depthMode:Ys,tile:Pt,renderWithShadows:Jn,labelPlaneMatrixInv:Ic}},An=()=>{const _n=Ne&&h.layout.get("symbol-placement")!=="point",qr=[],Rr=_n||lt||yr,Zn=It.elevationType==="road",wi=m.shadowRenderer,Jn=Zn&&Je&&!!wi&&wi.enabled,ri=Tr(Jn),Ys=Zn&&Je&&!m.terrain?We:vt;m.terrainRenderModeElevated()&&Je&&qr.push("PITCH_WITH_MAP_TERRAIN"),Kt&&(qr.push("PROJECTION_GLOBE_VIEW"),Rr&&qr.push("PROJECTED_POS_ON_VIEWPORT")),!It.text.zOffsetVertexBuffer||Zn&&m.terrain||qr.push("Z_OFFSET"),It.iconsInText&&qr.push("RENDER_TEXT_AND_SYMBOL"),qr.push("RENDER_SDF"),Jn&&qr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Zn&&Je&&!m.terrain&&It.text.orientationVertexBuffer&&qr.push("ELEVATED_ROADS"),ln(qr);const ga=It.text.programConfigurations.get(h.id),Do=m.getOrCreateProgram("symbol",{config:ga,defines:qr});let vn,Oa=[0,0],cs=null;const ya=It.textSizeData;It.iconsInText&&(Oa=Pt.imageAtlasTexture?Pt.imageAtlasTexture.size:[0,0],cs=Pt.imageAtlasTexture?Pt.imageAtlasTexture:null,vn=Je||!ve.isOrthographic||m.options.rotating||m.options.zooming||ya.kind==="composite"||ya.kind==="camera"?be.LINEAR:be.NEAREST);const Ol=Pt.glyphAtlasTexture?Pt.glyphAtlasTexture.size:[0,0],Js=h.layout.get("text-size-scale-range"),mi=o.aA(m.scaleFactor,Js[0],Js[1]),Fi=o.bK(ya,ve.zoom,mi),Qn=Qd(Bt,Pt.tileID.canonical,Je,Ne,ve,It.getProjection(),Zt),eo=ua(Bt,Pt.tileID.canonical,Je,Ne,ve,It.getProjection(),Zt),gs=m.translatePosMatrix(eo,Pt,R,F,!0),Mi=m.translatePosMatrix(Bt,Pt,R,F),ka=Rr?ql:Qn,Ym=Ne&&!Je&&!_n;let Pc=At;!Qe&&!ve.mercatorFromTransition||Ne||(Pc=fu(ve));const $f=Mm(ya.kind,Fi,Ym,Je,m,Mi,ka,gs,Ie,!0,Ol,Oa,0,Lt,Xt,Re,Lr,Kt?Pc:At,It.getProjection(),ri,Jr,null,null,mi),Vf=Pt.glyphAtlasTexture?Pt.glyphAtlasTexture:null,Ra=be.LINEAR,Cc=h.paint.get("text-halo-width").constantOr(1)!==0,Ic=m.terrain&&Je&&_n?o.bl(o.bC(),Qn):ql;if(_n&&It.text){const rl=o.bV.getAtTileOffsetFunc(Lt,ve.center.lat,ve.worldSize,It.getProjection()),gu=cu(Bt,Pt.tileID.canonical,Je,Ne,ve,It.getProjection(),Zt);En(It,Bt,m,!0,gu,eo,Je,ie,rl,Lt,mi)}return{program:Do,buffers:It.text,uniformValues:$f,atlasTexture:Vf,atlasTextureIcon:cs,atlasInterpolation:Ra,atlasInterpolationIcon:vn,isSDF:!0,hasHalo:Cc,depthMode:Ys,tile:Pt,renderWithShadows:Jn,labelPlaneMatrixInv:Ic}},kn=It.icon.segments.get().length,en=It.text.segments.get().length,kr=kn&&!T.onlyText?In():null,yn=en&&!T.onlyIcons?An():null,hi=h.paint.get("icon-opacity").constantOr(1),fi=h.paint.get("text-opacity").constantOr(1);if(Xe&&It.canOverlap){ht=!0;const _n=hi&&!T.onlyText?It.icon.segments.get():[],qr=fi&&!T.onlyIcons?It.text.segments.get():[];for(const Rr of _n)bt.push({segments:new o.bg([Rr]),sortKey:Rr.sortKey,state:kr});for(const Rr of qr)bt.push({segments:new o.bg([Rr]),sortKey:Rr.sortKey,state:yn})}else T.onlyText||bt.push({segments:hi?It.icon.segments:new o.bg([]),sortKey:0,state:kr}),T.onlyIcons||bt.push({segments:fi?It.text.segments:new o.bg([]),sortKey:0,state:yn})}ht&&bt.sort((Lt,Pt)=>Lt.sortKey-Pt.sortKey);for(const Lt of bt){const Pt=Lt.state;if(Pt)if(m.terrain?m.terrain.setupElevationDraw(Pt.tile,Pt.program,{useDepthForOcclusion:ve.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Pt.labelPlaneMatrixInv}):m.setupDepthForOcclusion(ve.depthOcclusionForSymbolsAndCircles,Pt.program),Pe.activeTexture.set(be.TEXTURE0),Pt.atlasTexture&&Pt.atlasTexture.bind(Pt.atlasInterpolation,be.CLAMP_TO_EDGE,!0),Pt.atlasTextureIcon&&(Pe.activeTexture.set(be.TEXTURE1),Pt.atlasTextureIcon&&Pt.atlasTextureIcon.bind(Pt.atlasInterpolationIcon,be.CLAMP_TO_EDGE,!0)),Pt.renderWithShadows&&m.shadowRenderer.setupShadows(Pt.tile.tileID.toUnwrapped(),Pt.program,"vector-tile"),m.uploadCommonLightUniforms(m.context,Pt.program),Pt.hasHalo){const It=Pt.uniformValues;It.u_is_halo=1,p_(Pt.buffers,Lt.segments,h,m,Pt.program,Pt.depthMode,x,S,It,2),It.u_is_halo=0}else{if(Pt.isSDF){const It=Pt.uniformValues;Pt.hasHalo&&(It.u_is_halo=1,p_(Pt.buffers,Lt.segments,h,m,Pt.program,Pt.depthMode,x,S,It,1)),It.u_is_halo=0}p_(Pt.buffers,Lt.segments,h,m,Pt.program,Pt.depthMode,x,S,Pt.uniformValues,1)}}}function p_(m,s,h,g,x,S,T,O,R,z){const F=[m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer,m.iconTransitioningVertexBuffer,m.globeExtVertexBuffer,m.zOffsetVertexBuffer,m.orientationVertexBuffer];x.draw(g,g.context.gl.TRIANGLES,S,T,O,gr.disabled,R,h.id,m.layoutVertexBuffer,m.indexBuffer,s,h.paint,g.transform.zoom,m.programConfigurations.get(h.id),F,z)}function wb(m,s){const h=1<<m.canonical.z,g=(s.x*h-m.canonical.x-m.wrap*h)*o.al,x=(s.y*h-m.canonical.y)*o.al,S=o.e8(s.z,s.y);return o.d5(g,x,S)}function Sb(m,s,h,g,x){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const S=m.context.gl,T=new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D),O=new Qt(m.context.gl.GREATER,Qt.ReadWrite,m.depthRangeFor3D),R=function(K){let ne=.01;return K.isOrthographic&&(ne=o.ak(1e-4,ne,o.d0(K.pitch>=bc?1:K.pitch/bc))),2*ne}(m.transform),z=m.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",Z=m.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),W=m.getOrCreateProgram(F);for(const K of g){const ne=s.getTile(K),ee=ne.getBucket(h);if(!ee)continue;const ie=ee.elevatedStructures;if(!ie)continue;const ce=ee.elevationBufferData.heightRange,ge=wb(K.toUnwrapped(),z),pe=m.translatePosMatrix(K.projMatrix,ne,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));let fe,Ie,Ee,Pe;if(x==="initialize"){if(!ce||ce.min>=1||ie.depthSegments.segments[0].primitiveLength===0)continue;fe=sh(pe,ge,R,1,0),Ie=T,Ee=ie.depthSegments,Pe=Z}else if(x==="reset"){if(!ce||ce.min>=0||ie.maskSegments.segments[0].primitiveLength===0)continue;fe=sh(pe,ge,0,0,1),Ie=O,Ee=ie.maskSegments,Pe=Z}else if(x==="geometry"){if(ie.depthSegments.segments[0].primitiveLength===0)continue;fe=sh(pe,ge,R,1,0),Ie=T,Ee=ie.depthSegments,Pe=W}Pe.draw(m,S.TRIANGLES,Ie,xr.disabled,Er.disabled,gr.disabled,fe,h.id,ie.vertexBuffer,ie.indexBuffer,Ee,h.paint,m.transform.zoom)}}function Of(m,s,h,g){const{painter:x,sourceCache:S,layer:T,coords:O,colorMode:R,elevationType:z,terrainEnabled:F,pass:Z}=m,W=x.context.gl,K=T.paint.get("fill-pattern"),ne=T.paint.get("fill-pattern-cross-fade"),ee=K.constantOr(null);let ie=z;z!=="road"||s&&!F||(ie="none");const ce=ie==="road",ge=m.painter.shadowRenderer,pe=ce&&!!ge&&ge.enabled,fe=new Qt(x.context.gl.LEQUAL,Qt.ReadOnly,x.depthRangeFor3D);let Ie=[0,0,0];if(pe){const ve=x.style.directionalLight,ke=x.style.ambientLight;ve&&ke&&(Ie=Cl(x.style,ve,ke))}const Ee=K&&K.constantOr(1),Pe=x.terrain&&x.terrain.renderingToTexture,be=(ve,ke)=>{let Ne,$e,Je,Xe,ht;ke?(Ne=Ee&&!T.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Je=W.LINES):(Ne=Ee?"fillPattern":"fill",Je=W.TRIANGLES);for(const vt of O){const We=S.getTile(vt);if(Ee&&!We.patternsLoaded())continue;const Re=We.getBucket(T);if(!Re)continue;const lt=s?Re.elevationBufferData:Re.bufferData;if(lt.isEmpty())continue;x.prepareDrawTile();const Qe=lt.programConfigurations.get(T.id),bt=x.isTileAffectedByFog(vt),At=[],Lt=[];ce&&(At.push("ELEVATED_ROADS"),Lt.push(lt.elevatedLayoutVertexBuffer)),pe&&At.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pe&&h&&At.push("USE_MRT1"),Ee&&(x.context.activeTexture.set(W.TEXTURE0),We.imageAtlasTexture&&We.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),Qe.updatePaintBuffers());let Pt=!1;if(ee&&We.imageAtlas){const Zt=We.imageAtlas,or=o.e3.from(ee),yr=or.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Lr=or.getSecondary(),Jr=Zt.patternPositions.get(yr),Tr=Lr?Zt.patternPositions.get(Lr.scaleSelf(o.o.devicePixelRatio).toString()):null;Pt=!!Jr&&!!Tr,Jr&&Qe.setConstantPatternPositions(Jr,Tr)}ne>0&&(Pt||Qe.getPatternTransitionVertexBuffer("fill-pattern"))&&At.push("FILL_PATTERN_TRANSITION");const It=x.getOrCreateProgram(Ne,{config:Qe,overrideFog:bt,defines:At}),Kt=x.translatePosMatrix(vt.projMatrix,We,T.paint.get("fill-translate"),T.paint.get("fill-translate-anchor"));pe&&ge.setupShadows(We.tileID.toUnwrapped(),It,"vector-tile");const Xt=T.paint.get("fill-emissive-strength");if(ke){Xe=lt.lineIndexBuffer,ht=lt.lineSegments;const Zt=x.terrain&&x.terrain.renderingToTexture?x.terrain.drapeBufferSize:[W.drawingBufferWidth,W.drawingBufferHeight];$e=Ne==="fillOutlinePattern"&&Ee?VE(Kt,Xt,x,We,Zt,Ie,ne):$E(Kt,Xt,Zt,Ie)}else Xe=lt.indexBuffer,ht=lt.triangleSegments,$e=Ee?mb(Kt,Xt,x,We,Ie,ne):oh(Kt,Xt,Ie);x.uploadCommonUniforms(x.context,It,vt.toUnwrapped());let Bt=ve;(z==="road"&&!F||z==="offset")&&(Bt=fe),It.draw(x,Je,Bt,g||x.stencilModeForClipping(vt),R,gr.disabled,$e,T.id,lt.layoutVertexBuffer,Xe,ht,T.paint,x.transform.zoom,Qe,Lt)}};x.renderPass===Z&&be(x.depthModeForSublayer(1,x.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly),!1),ie==="none"&&x.renderPass==="translucent"&&T.paint.get("fill-antialias")&&be(x.depthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly),!0)}function kf(m,s,h,g,x,S,T,O){h.resetLayerRenderingStats(m);const R=m.context,z=R.gl,F=m.transform,Z=h.paint.get("fill-extrusion-pattern"),W=h.paint.get("fill-extrusion-pattern-cross-fade"),K=Z.constantOr(null),ne=Z.constantOr(1),ee=h.paint.get("fill-extrusion-opacity"),ie=m.style.enable3dLights(),ce=h.paint.get(ie&&!ne?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ge=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ce],pe=h.layout.get("fill-extrusion-edge-radius"),fe=pe>0&&!h.paint.get("fill-extrusion-rounded-roof"),Ie=fe?0:pe,Ee=F.projection.name==="globe"?o.eb():0,Pe=F.projection.name==="globe",be=Pe?o.aj(F.zoom):0,ve=[o.aF(F.center.lng),o.aJ(F.center.lat)],ke=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ne=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ke?null:h.lut).toArray01().slice(0,3),$e=h.paint.get("fill-extrusion-flood-light-intensity"),Je=h.paint.get("fill-extrusion-vertical-scale"),Xe=h.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ht=h.paint.get("fill-extrusion-height-alignment"),vt=h.paint.get("fill-extrusion-base-alignment"),We=Pl(m,h.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let lt;Pe&&Re.push("PROJECTION_GLOBE_VIEW"),ge[0]>0&&Re.push("FAUX_AO"),fe&&Re.push("ZERO_ROOF_RADIUS"),O&&Re.push("HAS_CENTROID"),$e>0&&Re.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),Xe&&Re.push("RENDER_WALL_MODE");const Qe=m.renderPass==="shadow",bt=m.shadowRenderer,At=Qe&&!!bt,Lt=Qe?gr.disabled:gr.backCCW;m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0);let Pt=[0,0,0];if(bt){const Xt=m.style.directionalLight,Bt=m.style.ambientLight;Xt&&Bt&&(Pt=Cl(m.style,Xt,Bt)),Qe||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),bt.useNormalOffset&&Re.push("NORMAL_OFFSET")),lt=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const It=At?"fillExtrusionDepth":ne?"fillExtrusionPattern":"fillExtrusion",Kt=h.getLayerRenderingStats();for(const Xt of g){const Bt=s.getTile(Xt),Zt=Bt.getBucket(h);if(!Zt||Zt.projection.name!==F.projection.name)continue;let or=!1;bt&&(or=bt.getMaxCascadeForTile(Xt.toUnwrapped())===0);const yr=m.isTileAffectedByFog(Xt),Lr=Zt.programConfigurations.get(h.id);let Jr=!1;if(K&&Bt.imageAtlas){const en=Bt.imageAtlas,kr=o.e3.from(K),yn=kr.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),hi=kr.getSecondary(),fi=en.patternPositions.get(yn),_n=hi?en.patternPositions.get(hi.scaleSelf(o.o.devicePixelRatio).toString()):null;Jr=!!fi&&!!_n,fi&&Lr.setConstantPatternPositions(fi,_n)}W>0&&(Jr||Lr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Tr=m.getOrCreateProgram(It,{config:Lr,defines:or?lt:Re,overrideFog:yr});if(m.terrain&&m.terrain.setupElevationDraw(Bt,Tr,{useMeterToDem:!0}),!Zt.centroidVertexBuffer){const en=Tr.getAttributeLocation(z,"a_centroid_pos");en!==-1&&z.vertexAttrib2f(en,0,0)}!Qe&&bt&&bt.setupShadows(Bt.tileID.toUnwrapped(),Tr,"vector-tile"),ne&&(m.context.activeTexture.set(z.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Lr.updatePaintBuffers());const ln=h.paint.get("fill-extrusion-vertical-gradient"),Cr=1/Zt.tileToMeter;let In;if(Qe&&bt){if(Tb(Bt.tileID,Zt.maxHeight,m))continue;const en=bt.calculateShadowPassMatrixFromTile(Bt.tileID.toUnwrapped());In=pb(en,Ie,Cr,Je,ht,vt)}else{const en=m.translatePosMatrix(Xt.expandedProjMatrix,Bt,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),kr=F.projection.createInversionMatrix(F,Xt.canonical);In=ne?BE(en,m,ln,ee,ge,Ie,Cr,Xt,Bt,Ee,ht,vt,be,ve,kr,Ne,Je,W):o_(en,m,ln,ee,ge,Ie,Cr,Xt,Ee,ht,vt,be,ve,kr,Ne,Je,$e,Pt)}m.uploadCommonUniforms(R,Tr,Xt.toUnwrapped(),null,We);let An=Zt.segments;if(F.projection.name==="mercator"&&!Qe&&(An=Zt.getVisibleSegments(Bt.tileID,m.terrain,m.transform.getFrustum(0)),!An.get().length))continue;if(Kt)if(Qe)for(const en of An.get())Kt.numRenderedVerticesInShadowPass+=en.primitiveLength;else for(const en of An.get())Kt.numRenderedVerticesInTransparentPass+=en.primitiveLength;const kn=[];(m.terrain||O)&&kn.push(Zt.centroidVertexBuffer),Pe&&kn.push(Zt.layoutVertexExtBuffer),Xe&&kn.push(Zt.wallVertexBuffer),Tr.draw(m,R.gl.TRIANGLES,x,S,T,Lt,In,h.id,Zt.layoutVertexBuffer,Zt.indexBuffer,An,h.paint,m.transform.zoom,Lr,kn)}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1)}class jm{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Tc(m,s,h,g,x,S,T,O,R,z,F,Z,W,K,ne,ee,ie,ce,ge,pe){const fe=s.context,Ie=fe.gl,Ee=s.transform,Pe=s.transform.zoom,be=[],ve=m.translate,ke=m.translateAnchor,Ne=m.edgeRadius,$e=Pl(s,m.cutoffFadeRange);F==="clear"?(be.push("CLEAR_SUBPASS"),pe&&(be.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(Ie.TEXTURE0),pe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE))):F==="sdf"?be.push("SDF_SUBPASS"):F==="emissive"&&(be.push("USE_MRT1"),fe.activeTexture.set(Ie.TEXTURE0),pe.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)),ce&&be.push("HAS_CENTROID"),$e.shouldRenderCutoff&&be.push("RENDER_CUTOFF");const Je=(Xe,ht,vt,We,Re)=>{let lt=be;ht.groundRadiusBuffer!=null&&(lt=be.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Qe=ht.programConfigurations.get(g.id),bt=s.isTileAffectedByFog(Xe),At=s.getOrCreateProgram("fillExtrusionGroundEffect",{config:Qe,defines:lt,overrideFog:bt}),Lt=((It,Kt,Xt,Bt,Zt,or,yr,Lr,Jr,Tr,ln)=>({u_matrix:Kt,u_opacity:Xt,u_ao_pass:Bt?1:0,u_meter_to_tile:Zt,u_ao:or,u_flood_light_intensity:yr,u_flood_light_color:Lr,u_attenuation:Jr,u_edge_radius:Tr,u_fb:0,u_fb_size:ln,u_dynamic_offset:1}))(0,We,Z,z,Re,[W,K*Re],ne,ee,ie,Pe>=17?0:Ne*Re,pe?pe.size[0]:0),Pt=[];ce&&Pt.push(ht.hiddenByLandmarkVertexBuffer),ht.groundRadiusBuffer!=null&&Pt.push(ht.groundRadiusBuffer),s.uploadCommonUniforms(fe,At,Xe.toUnwrapped(),null,$e),At.draw(s,fe.gl.TRIANGLES,S,T,O,R,Lt,g.id,ht.vertexBuffer,ht.indexBuffer,vt,g.paint,Pe,Qe,Pt)};for(const Xe of x){const ht=h.getTile(Xe),vt=ht.getBucket(g);if(!vt||vt.projection.name!==Ee.projection.name||!vt.groundEffect||vt.groundEffect&&!vt.groundEffect.hasData())continue;const We=vt.groundEffect,Re=1/vt.tileToMeter;{const lt=s.translatePosMatrix(Xe.projMatrix,ht,ve,ke),Qe=We.getDefaultSegment();Je(Xe,We,Qe,lt,Re)}if(ge)for(let lt=0;lt<4;lt++){const Qe=o.e9[lt](Xe),bt=h.getTile(Qe);if(!bt)continue;const At=bt.getBucket(g);if(!At||At.projection.name!==Ee.projection.name||!At.groundEffect||At.groundEffect&&!At.groundEffect.hasData())continue;const Lt=At.groundEffect;let Pt,It;lt===0?(Pt=[-o.al,0,0],It=1):lt===1?(Pt=[o.al,0,0],It=0):lt===2?(Pt=[0,-o.al,0],It=3):(Pt=[0,o.al,0],It=2);const Kt=Lt.regionSegments[It];if(!Kt)continue;const Xt=new Float32Array(16);o.br(Xt,Xe.projMatrix,Pt),Je(Xe,Lt,Kt,s.translatePosMatrix(Xt,ht,ve,ke),Re)}}}function KE(m,s,h,g,x,S,T){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();const O=S?S.findDEMTileFor(h):null;if(!(O&&O.dem||T))return;S&&O&&O.dem&&g.selfDEMTileTimestamp!==O.dem._timestamp&&(g.borderDoneWithNeighborZ=[-1,-1,-1,-1],g.selfDEMTileTimestamp=O.dem._timestamp);const R=(ie,ce)=>{(ie.flags|ce.flags)&o.ec?(ie.flags|=o.ec,ce.flags|=o.ec):(ie.flags&=~o.ec,ce.flags&=~o.ec)},z=ie=>new o.P(Math.ceil((ie+o.ed)*o.ee),0),F=ie=>{const ce=s.getSource().minzoom,ge=fe=>{const Ie=s.getTileByID(fe);if(Ie&&Ie.hasData())return Ie.getBucket(x)},pe=[0,-1,1];for(const fe of pe){if(ie.overscaledZ+fe<ce)continue;const Ie=ge(ie.calculateScaledKey(ie.overscaledZ+fe));if(Ie)return Ie}},Z=[0,0,0],W=(ie,ce)=>(Z[0]=Math.min(ie.min.y,ce.min.y),Z[1]=Math.max(ie.max.y,ce.max.y),Z[2]=o.al-ce.min.x>ie.max.x?ce.min.x-o.al:ie.max.x,Z),K=(ie,ce)=>(Z[0]=Math.min(ie.min.x,ce.min.x),Z[1]=Math.max(ie.max.x,ce.max.x),Z[2]=o.al-ce.min.y>ie.max.y?ce.min.y-o.al:ie.max.y,Z),ne=[(ie,ce)=>W(ie,ce),(ie,ce)=>W(ce,ie),(ie,ce)=>K(ie,ce),(ie,ce)=>K(ce,ie)],ee=(ie,ce,ge,pe,fe,Ie,Ee)=>{if(!S)return 0;const Pe=[[Ie?ge:ie,Ie?ie:ge,0],[Ie?ge:ce,Ie?ce:ge,0]],be=Ee<0?o.al+Ee:Ee,ve=[Ie?be:(ie+ce)/2,Ie?(ie+ce)/2:be,0];return ge===0&&Ee<0||ge!==0&&Ee>0?S.getForTilePoints(fe,[ve],!0,pe):Pe.push(ve),S.getForTilePoints(h,Pe,!0,O),Math.max(Pe[0][2],Pe[1][2],ve[2])/S.exaggeration()};for(let ie=0;ie<4;ie++){const ce=g.borderFeatureIndices[ie];if(ce.length===0)continue;const ge=o.e9[ie](h),pe=F(ge);if(!(pe&&pe instanceof o.ea))continue;const fe=S?S.findDEMTileFor(ge):null;if(!(fe&&fe.dem||T)||(S&&fe&&fe.dem&&g.borderDEMTileTimestamp[ie]!==fe.dem._timestamp&&(g.borderDoneWithNeighborZ[ie]=-1,g.borderDEMTileTimestamp[ie]=fe.dem._timestamp),g.borderDoneWithNeighborZ[ie]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const Ie=(ie<2?1:5)-ie,Ee=pe.borderDoneWithNeighborZ[Ie]!==g.canonical.z,Pe=pe.borderFeatureIndices[Ie];let be=0;if(g.canonical.z!==pe.canonical.z){for(const ve of ce)g.showCentroid(g.featuresOnBorder[ve]);if(Ee)for(const ve of Pe)pe.showCentroid(pe.featuresOnBorder[ve]);g.borderDoneWithNeighborZ[ie]=pe.canonical.z,pe.borderDoneWithNeighborZ[Ie]=g.canonical.z}for(const ve of ce){const ke=g.featuresOnBorder[ve],Ne=g.centroidData[ke.centroidDataIndex],$e=ke.borders[ie];let Je;for(;be<Pe.length;){Je=pe.featuresOnBorder[Pe[be]];const Xe=Je.borders[Ie];if(Xe[1]>$e[0]+3||Xe[0]>$e[0]-3)break;pe.showCentroid(Je),be++}if(Je&&be<Pe.length){const Xe=be;let ht=0;for(;!(Je.borders[Ie][0]>$e[1]-3)&&(ht++,++be!==Pe.length);)Je=pe.featuresOnBorder[Pe[be]];Je=pe.featuresOnBorder[Pe[Xe]];let vt=!1;if(ht>=1){const lt=Je.borders[Ie];Math.abs($e[0]-lt[0])<3&&Math.abs($e[1]-lt[1])<3&&(ht=1,vt=!0,be=Xe+1)}else if(ht===0){g.showCentroid(ke);continue}const We=pe.centroidData[Je.centroidDataIndex];T&&vt&&R(Ne,We);const Re=ke.intersectsCount()>1||Je.intersectsCount()>1;if(ht>1)be=Xe,Ne.centroidXY=We.centroidXY=new o.P(0,0);else if(fe&&fe.dem&&!Re){const lt=ne[ie](Ne,We),Qe=ie%2?o.al-1:0,bt=ee(lt[0],Math.min(o.al-1,lt[1]),Qe,fe,ge,ie<2,lt[2]);Ne.centroidXY=We.centroidXY=z(bt)}else Re?Ne.centroidXY=We.centroidXY=new o.P(0,0):(Ne.centroidXY=g.encodeBorderCentroid(ke),We.centroidXY=pe.encodeBorderCentroid(Je));g.writeCentroidToBuffer(Ne),pe.writeCentroidToBuffer(We)}else g.showCentroid(ke)}g.borderDoneWithNeighborZ[ie]=pe.canonical.z,pe.borderDoneWithNeighborZ[Ie]=g.canonical.z}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(m)}const YE=[1,0,0],JE=[0,1,0],QE=[0,0,1];function Tb(m,s,h){const g=h.transform,x=h.shadowRenderer;if(!x)return!0;const S=m.toUnwrapped(),T=g.tileSize*x._cascades[h.currentShadowCascade].scale;let O=s;if(g.elevation){const ee=g.elevation.getMinMaxForTile(m);ee&&(O+=ee.max)}const R=[...x.shadowDirection];R[2]=-R[2];const z=x.computeSimplifiedTileShadowVolume(S,O,T,R);if(!z)return!1;const F=[YE,JE,QE,R,[R[0],0,R[2]],[0,R[1],R[2]]],Z=g.projection.name==="globe",W=g.scaleZoom(T),K=o.cB.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,W,!Z),ne=x.getCurrentCascadeFrustum();return K.intersectsPrecise(z.vertices,z.planes,F)===0||ne.intersectsPrecise(z.vertices,z.planes,F)===0}function Rf(m){const{painter:s,source:h,layer:g,coords:x}=m;let S=m.defines;const T=s.context,O=s.renderPass==="shadow",R=s.renderPass==="light-beam",z=s.shadowRenderer,F=o.ef(s.transform.center.lat,s.transform.zoom),Z=Pl(s,g.paint.get("building-cutoff-fade-range"));Z.shouldRenderCutoff&&(S=S.concat("RENDER_CUTOFF")),m.floodLightIntensity>0&&(S=S.concat("FLOOD_LIGHT"));for(const W of x){const K=h.getTile(W),ne=K.getBucket(g);if(!ne)continue;z&&z.getMaxCascadeForTile(W.toUnwrapped())===0&&(S=S.concat("SHADOWS_SINGLE_CASCADE"));const ee=ne.programConfigurations.get(g.id);let ie,ce,ge,pe=s.translatePosMatrix(W.expandedProjMatrix,K,[0,0],"map");if(pe=o.cS(o.bC(),pe,[1,1,m.verticalScale]),O&&z){if(Tb(K.tileID,ne.maxHeight*F,s))continue;let Ie=z.calculateShadowPassMatrixFromTile(K.tileID.toUnwrapped());Ie=o.cS(o.bC(),Ie,[1,1,m.verticalScale]),ge=ad(Ie),ie=ce=s.getOrCreateProgram("buildingDepth",{config:ee,defines:S,overrideFog:!1})}else if(R)ie=ce=s.getOrCreateProgram("buildingBloom",{config:ee,defines:S,overrideFog:!1}),ge=UE(pe);else{const Ie=s.transform.calculatePosMatrix(W.toUnwrapped(),s.transform.worldSize);o.cS(Ie,Ie,[1,1,m.verticalScale]);const Ee=o.bC();o.cS(Ee,Ie,[1,-1,1/F]),o.bl(Ee,Ee),o.eg(Ee,Ee);const Pe=s.transform.getFreeCameraOptions().position,be=1<<W.canonical.z;if(ge=s_(pe,Ee,m.opacity,m.facadeAOIntensity,[((Pe.x-W.wrap)*be-W.canonical.x)*o.al,(Pe.y*be-W.canonical.y)*o.al,Pe.z*be*o.al],ne.tileToMeter,m.facadeEmissiveChance,m.floodLightColor,m.floodLightIntensity),ce=s.getOrCreateProgram("building",{config:ee,defines:S,overrideFog:!1}),m.depthOnly===!0)ie=ce;else{const ve=S.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ie=s.getOrCreateProgram("building",{config:ee,defines:ve,overrideFog:!1})}z&&(z.setupShadowsFromMatrix(Ie,ce,!0),ie!==ce&&z.setupShadowsFromMatrix(Ie,ie,!0))}const fe=(Ie,Ee)=>{if(R){const Pe=Ie.entranceBloom;Ee.draw(s,T.gl.TRIANGLES,m.depthMode,xr.disabled,m.blendMode,gr.disabled,ge,g.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segmentsBucket,g.paint,s.transform.zoom,ee,[Pe.layoutAttenuationBuffer,Pe.layoutColorBuffer])}else{const Pe=Ie.segmentsBucket;let be=[Ie.layoutNormalBuffer,Ie.layoutCentroidBuffer,Ie.layoutColorBuffer,Ie.layoutFloodLightDataBuffer];Ie.layoutFacadePaintBuffer&&(be=be.concat([Ie.layoutFacadeDataBuffer,Ie.layoutFacadeVerticalRangeBuffer,Ie.layoutFacadePaintBuffer])),Ee.draw(s,T.gl.TRIANGLES,m.depthMode,xr.disabled,m.blendMode,O?gr.disabled:gr.backCW,ge,g.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Pe,g.paint,s.transform.zoom,ee,be)}};s.uploadCommonUniforms(T,ce,W.toUnwrapped(),null,Z),ne.buildingWithoutFacade&&fe(ne.buildingWithoutFacade,ce),ne.buildingWithFacade&&(ie!==ce&&s.uploadCommonUniforms(T,ie,W.toUnwrapped(),null,Z),fe(ne.buildingWithFacade,ie))}}function m_(m,s,h,g,x,S,T,O,R,z,F,Z,W){const K=m.context.gl,ne=m.depthModeForSublayer(1,Qt.ReadOnly,K.LEQUAL,!0),ee=.1*(1-(ie=F))+3*ie;var ie;const ce=m._showOverdrawInspector,ge=Z,pe=new jm;ce||Tc(pe,m,s,h,g,ne,new xr({func:K.ALWAYS,mask:255},255,255,K.KEEP,K.KEEP,K.REPLACE),new Er([K.ONE,K.ONE,K.ONE,K.ONE],o.ao.transparent,[!1,!1,!1,!0],K.MIN),gr.disabled,x,"sdf",S,T,O,R,z,ee,ge,!1);{const fe=ce?xr.disabled:new xr({func:K.EQUAL,mask:255},255,255,K.KEEP,K.DECR,K.DECR),Ie=ce?m.colorModeForRenderPass():new Er([K.ONE_MINUS_DST_ALPHA,K.DST_ALPHA,K.ONE,K.ONE],o.ao.transparent,[!0,!0,!0,!0]);Tc(pe,m,s,h,g,ne,fe,Ie,gr.disabled,x,"color",S,T,O,R,z,ee,ge,!1)}}function Eb(m){return[m[0]*o.eh,m[1]*o.eh,m[2]*o.eh,0]}function g_(m,s,h,g,x,S,T,O,R){const z=g.getSource(),F=h.globeSharedBuffers;if(!F)return;let Z,W,K;if(s&&(Z=g.getTile(s)),z instanceof o.aU?(W=z.texture,K=o.dK(0,0,h.transform)):Z&&s&&(W=Z.texture,K=o.dK(s.canonical.z,s.canonical.x,h.transform)),!W||!K)return;m||(K=o.cS(o.bC(),K,[1,-1,1]));const ne=h.context,ee=ne.gl,ie=x.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR,ce=h.colorModeForDrapableLayerRenderPass(S),ge=T.defines;ge.push("GLOBE_POLES");const pe=new Qt(ee.LEQUAL,Qt.ReadWrite,h.depthRangeFor3D),fe=Float32Array.from(h.transform.expandedFarZProjMatrix),Ie=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0))));h.terrain&&h.terrain.prepareDrawTile(),ne.activeTexture.set(ee.TEXTURE0),W.bind(ie,ee.CLAMP_TO_EDGE),ne.activeTexture.set(ee.TEXTURE1),W.bind(ie,ee.CLAMP_TO_EDGE),"useMipmap"in W&&ne.extTextureFilterAnisotropic&&h.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,ne.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ne.extTextureFilterAnisotropicMax);const[Ee,Pe,be,ve]=s?F.getPoleBuffers(s.canonical.z,!1):F.getPoleBuffers(0,!0),ke=x.paint.get("raster-elevation");let Ne;m?(Ne=Ee,h.renderDefaultNorthPole=ke!==0):(Ne=Pe,h.renderDefaultSouthPole=ke!==0);const $e=Eb(T.mix),Je=((ht,vt,We,Re,lt,Qe,bt,At,Lt,Pt,It,Kt,Xt)=>xb(ht,vt,We,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Qe,[0,0],At,2,Pt,It,Kt,1,0,Xt))(fe,Ie,K,o.aj(h.transform.zoom),0,x,0,ke,0,$e,T.offset,T.range,S),Xe=h.getOrCreateProgram("raster",{defines:ge});h.uploadCommonUniforms(ne,Xe,null),Xe.draw(h,ee.TRIANGLES,pe,R,ce,O,Je,x.id,Ne,be,ve)}function eA(m){if(m.isOrthographic)return[0,0,0,0];const s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,x=.2*m.height,S=s+x;return[s,h,(S-x-s)/g,(S-s)/g]}function tA(m,s,h,g){if(m)return s instanceof qs&&m instanceof Ry?s.getTextureDescriptor(m,h,!0):{texture:m.texture,mix:Eb(g.mix),offset:g.offset,buffer:0,tileSize:1}}var Ab=o.ei([{name:"a_index",type:"Int16",components:1}]);class rA{constructor(s,h,g,x){const S={width:g[0],height:g[1],data:null},T=s.gl;this.targetColorTexture=new o.T(s,S,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(s,S,T.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(h,x),this.lastInvalidatedAt=0}updateParticleTexture(s,h){if(this.particleTextureDimension===h.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const g=this.context.gl,x=h.width*h.height;this.particleTexture0=new o.T(this.context,h,g.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,h,g.RGBA8,{premultiply:!1,useMipmap:!1});const S=new o.ej;S.reserve(x);for(let T=0;T<x;T++)S.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(S,Ab.members,!0),this.particleSegment=o.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=h.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Pb(m,s,h){if(!m)return null;const g=s.getTextureDescriptor(m,h,!0);if(!g)return null;let{texture:x,mix:S,offset:T,tileSize:O,buffer:R,format:z}=g;if(!x||!z)return null;let F=!1;return z==="uint32"&&(F=!0,S[3]=0,S=l_(o.ek,S,[0,h.paint.get("raster-particle-max-speed")]),T=qE(o.ek,T,[0,h.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[R/(O+2*R),O/(O+2*R)],tileSize:O,scalarData:F,scale:S,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function nA(m){const s=m._nearZ,h=m.projection.farthestPixelDistance(m),g=h-s,x=.2*m.height,S=s+x;return[s,h,(S-x-s)/g,(S-s)/g]}const Cb=new o.ao(1,0,0,1),Ib=new o.ao(0,1,0,1),Ob=new o.ao(0,0,1,1),PR=new o.ao(1,0,1,1),CR=new o.ao(0,1,1,1);function iA(m,s,h,g,x,S){for(let T=0;T<h.length;T++)if(x){const z=new o.ao(g.r*.8,g.g*.8,g.b*.8,1);cd(m,s,h[T],g,-1,-1,S),cd(m,s,h[T],g,-1,1,S),cd(m,s,h[T],g,1,1,S),cd(m,s,h[T],g,1,-1,S),cd(m,s,h[T],z,0,0,S)}else cd(m,s,h[T],g,0,0,S)}function cd(m,s,h,g,x,S,T){const O=m.context,R=m.transform,z=O.gl,F=R.projection.name==="globe",Z=F?["PROJECTION_GLOBE_VIEW"]:[];let W=o.bz(h.projMatrix);if(F&&o.aj(R.zoom)>0){const $e=o.bj(h.canonical,R),Je=o.el($e);W=o.aB(new Float32Array(16),R.globeMatrix,Je),o.aB(W,R.projMatrix,W)}const K=o.bC();K[12]+=2*x/(o.o.devicePixelRatio*R.width),K[13]+=2*S/(o.o.devicePixelRatio*R.height),o.aB(W,K,W);const ne=m.getOrCreateProgram("debug",{defines:Z}),ee=s.getTileByID(h.key);m.terrain&&m.terrain.setupElevationDraw(ee,ne);const ie=Qt.disabled,ce=xr.disabled,ge=m.colorModeForRenderPass(),pe="$debug";O.activeTexture.set(z.TEXTURE0),m.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),F?ee._makeGlobeTileDebugBuffers(m.context,R):ee._makeDebugTileBoundsBuffers(m.context,R.projection);const fe=ee._tileDebugBuffer||m.debugBuffer,Ie=ee._tileDebugIndexBuffer||m.debugIndexBuffer,Ee=ee._tileDebugSegments||m.debugSegments;if(ne.draw(m,z.LINE_STRIP,ie,ce,ge,gr.disabled,_b(W,g.toPremultipliedRenderColor(null)),pe,fe,Ie,Ee,null,null,null,[ee._globeTileDebugBorderBuffer]),T){const $e=ee.latestRawTileData,Je=Math.floor(($e&&$e.byteLength||0)/1024);let Xe=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Xe+=` => ${h.overscaledZ}`),Xe+=` ${ee.state}`,Xe+=` ${Je}kb`,function(ht,vt){ht.initDebugOverlayCanvas();const We=ht.debugOverlayCanvas,Re=ht.context.gl,lt=ht.debugOverlayCanvas.getContext("2d");lt.clearRect(0,0,We.width,We.height),lt.shadowColor="white",lt.shadowBlur=2,lt.lineWidth=1.5,lt.strokeStyle="white",lt.textBaseline="top",lt.font="bold 36px Open Sans, sans-serif",lt.fillText(vt,5,5),lt.strokeText(vt,5,5),ht.debugOverlayTexture.update(We),ht.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(m,Xe)}const Pe=s.getTile(h).tileSize,be=512/Math.min(Pe,512)*(h.overscaledZ/R.zoom)*.5,ve=ee._tileDebugTextBuffer||m.debugBuffer,ke=ee._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,Ne=ee._tileDebugTextSegments||m.debugSegments;ne.draw(m,z.TRIANGLES,ie,ce,Er.alphaBlended,gr.disabled,_b(W,o.ao.transparent.toPremultipliedRenderColor(null),be),pe,ve,ke,Ne,null,null,null,[ee._globeTileDebugTextBuffer])}function oA(m,s,h,g){y_(m,0,s+h/2,m.transform.width,h,g)}function kb(m,s,h,g){y_(m,s-h/2,0,h,m.transform.height,g)}function y_(m,s,h,g,x,S){const T=m.context,O=T.gl;O.enable(O.SCISSOR_TEST),O.scissor(s*o.o.devicePixelRatio,h*o.o.devicePixelRatio,g*o.o.devicePixelRatio,x*o.o.devicePixelRatio),T.clear({color:S}),O.disable(O.SCISSOR_TEST)}const sA=o.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:IR}=sA;function ud(m,s,h,g){m.emplaceBack(s,h,g)}class ma{constructor(s){this.vertexArray=new o.em,this.indices=new o.b0,ud(this.vertexArray,-1,-1,1),ud(this.vertexArray,1,-1,1),ud(this.vertexArray,-1,1,1),ud(this.vertexArray,1,1,1),ud(this.vertexArray,-1,-1,-1),ud(this.vertexArray,1,-1,-1),ud(this.vertexArray,-1,1,-1),ud(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,IR),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=o.bg.simpleSegment(0,0,36,12)}}function dd(m,s,h,g,x,S){const T=m.context.gl,O=s.paint.get("sky-atmosphere-color"),R=s.paint.get("sky-atmosphere-halo-color"),z=s.paint.get("sky-atmosphere-sun-intensity"),F=((Z,W,K,ne,ee)=>({u_matrix_3f:Z,u_sun_direction:W,u_sun_intensity:K,u_color_tint_r:[ne.r,ne.g,ne.b,ne.a],u_color_tint_m:[ee.r,ee.g,ee.b,ee.a],u_luminance:5e-5}))(o.eo(o.dO(),g),x,z,O.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+S,s.skyboxTexture,0),h.draw(m,T.TRIANGLES,Qt.disabled,xr.disabled,Er.unblended,gr.frontCW,F,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Zs=o.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class hd{constructor(s){const h=new o.ep;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const g=new o.b0;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(h,Zs.members),this.indexBuffer=s.createIndexBuffer(g),this.segments=o.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const aA=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Rb{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Mb{constructor(s){this.colorModeAlphaBlendedWriteRGB=new Er([1,ed,1,ed],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Er([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Rb,this.updateNeeded=!0}update(s){const h=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new hd(h);const g=this.params.sizeRange,x=this.params.intensityRange,S=function(F){const Z=o.eq(30),W=[];for(let K=0;K<F;++K){const ne=2*Math.PI*Z(),ee=Math.acos(1-2*Z())-.5*Math.PI;W.push(o.d5(Math.cos(ee)*Math.cos(ne),Math.cos(ee)*Math.sin(ne),Math.sin(ee)))}return W}(this.params.starsCount),T=o.eq(300),O=new o.er,R=new o.b0;let z=0;for(let F=0;F<S.length;++F){const Z=o.c5([],S[F],200),W=Math.max(0,1+.01*g*(1*T()-.5)),K=Math.max(0,1+.01*x*(1*T()-.5));O.emplaceBack(Z[0],Z[1],Z[2],-1,-1,W,K),O.emplaceBack(Z[0],Z[1],Z[2],1,-1,W,K),O.emplaceBack(Z[0],Z[1],Z[2],1,1,W,K),O.emplaceBack(Z[0],Z[1],Z[2],-1,1,W,K),R.emplaceBack(z+0,z+1,z+2),R.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=h.createVertexBuffer(O,aA.members),this.starsIdx=h.createIndexBuffer(R),this.starsSegments=o.bg.simpleSegment(0,0,O.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,h){const g=s.context,x=g.gl,S=s.transform,T=new Qt(x.LEQUAL,Qt.ReadOnly,[0,1]),O=o.aj(S.zoom),R=s.style.getLut(h.scope),z=h.properties.get("color-use-theme")==="none",F=h.properties.get("color").toNonPremultipliedRenderColor(z?null:R),Z=h.properties.get("high-color-use-theme")==="none",W=h.properties.get("high-color").toNonPremultipliedRenderColor(Z?null:R),K=h.properties.get("space-color-use-theme")==="none",ne=h.properties.get("space-color").toNonPremultipliedRenderColor(K?null:R),ee=5e-4,ie=o.es(h.properties.get("horizon-blend"),0,1,ee,.25),ce=o.dE(s,g,S)&&ie===ee?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,ge=s.frameCounter/1e3%1,pe=o.ag(S.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(pe,2)-Math.pow(ce,2)),Ie=Math.acos(fe/pe),Ee=Pe=>{const be=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Pe&&be.push("ALPHA_PASS");const ve=s.getOrCreateProgram("globeAtmosphere",{defines:be}),ke=(($e,Je,Xe,ht,vt,We,Re,lt,Qe,bt,At,Lt)=>({u_frustum_tl:$e,u_frustum_tr:Je,u_frustum_br:Xe,u_frustum_bl:ht,u_horizon:vt,u_transition:We,u_fadeout_range:Re,u_atmosphere_fog_color:lt.toArray01(),u_high_color:Qe.toArray01(),u_space_color:bt.toArray01(),u_temporal_offset:At,u_horizon_angle:Lt}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,O,ie,F,W,ne,ge,Ie);s.uploadCommonUniforms(g,ve);const Ne=this.atmosphereBuffer;Ne&&ve.draw(s,x.TRIANGLES,T,xr.disabled,Pe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,gr.backCW,ke,Pe?"atmosphere_glow_alpha":"atmosphere_glow",Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)};Ee(!1),Ee(!0)}drawStars(s,h){const g=o.aA(h.properties.get("star-intensity"),0,1);if(g===0)return;const x=s.context,S=x.gl,T=s.transform,O=s.getOrCreateProgram("stars"),R=o.c7([]);o.c9(R,R,-T._pitch),o.c8(R,R,-T.angle),o.c9(R,R,o.an(T._center.lat)),o.et(R,R,-o.an(T._center.lng));const z=o.cc(new Float32Array(16),R),F=o.aB([],T.starsProjMatrix,z),Z=o.eo([],z),W=o.eu([],Z),K=[0,1,0];o.dQ(K,K,W),o.c5(K,K,this.params.sizeMultiplier);const ne=[1,0,0];o.dQ(ne,ne,W),o.c5(ne,ne,this.params.sizeMultiplier);const ee=(ie=K,ce=ne,ge=g,{u_matrix:Float32Array.from(F),u_up:ie,u_right:ce,u_intensity_multiplier:ge});var ie,ce,ge;s.uploadCommonUniforms(x,O),this.starsVx&&this.starsIdx&&O.draw(s,S.TRIANGLES,Qt.disabled,xr.disabled,this.colorModeAlphaBlendedWriteRGB,gr.disabled,ee,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Db{constructor(){this.visibleTiles=[]}updateBorders(s,h){const g=[],x=[],S=s._getRenderableCoordinates(!1,!0);for(const R of S){const z=s.getTile(R);if(!z.hasData())continue;const F=z.getBucket(h);F&&(F.isEmpty()||(g.push(R.key),x.push({bucket:F,tileID:R.canonical})))}let T=g.length!==this.visibleTiles.length;if(!T){g.sort();for(let R=0;R<g.length;R++)if(g[R]!==this.visibleTiles[R]){T=!0;break}}if(!T)return;const O=new Set;this.visibleTiles=g,x.sort((R,z)=>R.tileID.z-z.tileID.z||R.tileID.x-z.tileID.x||R.tileID.y-z.tileID.y);for(const R of x){const z=new Array,F=new Array,Z=R.bucket;for(const W of Z.featuresOnBorder)O.has(W.featureId)?F.push(W.footprintIndex):(O.add(W.featureId),z.push(W.footprintIndex));Z.updateFootprintHiddenFlags(z,o.ev,!1),Z.updateFootprintHiddenFlags(F,o.ev,!0)}}}function Lb(m,s){const h=[...m],g=s.cameraWorldSizeForFog/s.worldSize,x=o.bA([]);return o.cS(x,x,[g,g,1]),o.aB(h,x,h),o.aB(h,s.worldToFogMatrix,h),h}function Hl(m,s,h,g,x){const S=h.material,T=g.context,{baseColorTexture:O,metallicRoughnessTexture:R}=S.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:F,emissionTexture:Z}=S;function W(ne,ee,ie){if(ne&&(m.push(ee),T.activeTexture.set(T.gl.TEXTURE0+ie),ne.gfxTexture)){const{minFilter:ce,magFilter:ge,wrapS:pe,wrapT:fe}=ne.sampler;ne.gfxTexture.bindExtraParam(ce,ge,pe,fe)}}W(O,"HAS_TEXTURE_u_baseColorTexture",5),W(R,"HAS_TEXTURE_u_metallicRoughnessTexture",6),W(z,"HAS_TEXTURE_u_normalTexture",7),W(F,"HAS_TEXTURE_u_occlusionTexture",8),W(Z,"HAS_TEXTURE_u_emissionTexture",9),x&&(x.texture||(x.texture=new o.d$(g.context,x.image,[x.image.height,x.image.height,x.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+10),x.texture&&x.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),m.push("APPLY_LUT_ON_GPU")),h.texcoordBuffer&&(m.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(h.texcoordBuffer)),h.colorBuffer&&(m.push(h.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(h.colorBuffer)),h.normalBuffer&&(m.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(h.normalBuffer)),h.pbrBuffer&&(m.push("HAS_ATTRIBUTE_a_pbr"),m.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(h.pbrBuffer)),S.alphaMode!=="OPAQUE"&&S.alphaMode!=="MASK"||m.push("UNPREMULT_TEXTURE_IN_SHADER"),S.defined||m.push("DIFFUSE_SHADED");const K=g.shadowRenderer;K&&(m.push("RENDER_SHADOWS","DEPTH_TEXTURE"),K.useNormalOffset&&m.push("NORMAL_OFFSET"))}function Dn(m,s,h,g,x,S){const T=m.modelOpacity,O=s.context,R=new Qt(s.context.gl.LEQUAL,m.isLightMesh?Qt.ReadOnly:Qt.ReadWrite,s.depthRangeFor3D),z=s.transform,F=m.mesh,Z=F.material,W=Z.pbrMetallicRoughness,K=s.style.fog;let ne;ne=s.transform.projection.zAxisUnit==="pixels"?[...m.nodeModelMatrix]:o.aB([],g.zScaleMatrix,m.nodeModelMatrix),o.aB(ne,g.negCameraPosMatrix,ne);const ee=o.bl([],ne);o.eg(ee,ee);const ie=h.paint.get("model-color-use-theme").constantOr("default")==="none",ce=h.paint.get("model-emissive-strength").constantOr(0),ge=u_(new Float32Array(m.worldViewProjection),new Float32Array(ne),new Float32Array(ee),null,s,T,W.baseColorFactor,Z.emissiveFactor,W.metallicFactor,W.roughnessFactor,Z,ce,h,void 0,void 0,m.materialOverride,m.modelColor),pe={defines:[]},fe=[],Ie=s.shadowRenderer;Ie&&(Ie.useNormalOffset=!1),Hl(pe.defines,fe,F,s,ie?null:h.lut);let Ee=null;if(K){const ve=Lb(m.nodeModelMatrix,s.transform);if(Ee=new Float32Array(ve),z.projection.name!=="globe"){const ke=F.aabb.min,Ne=F.aabb.max,[$e,Je]=K.getOpacityForBounds(ve,ke[0],ke[1],Ne[0],Ne[1]);pe.overrideFog=$e>=qt||Je>=qt}}const Pe=Pl(s,h.paint.get("model-cutoff-fade-range"));Pe.shouldRenderCutoff&&pe.defines.push("RENDER_CUTOFF");const be=s.getOrCreateProgram("model",pe);s.uploadCommonUniforms(O,be,null,Ee,Pe),s.renderPass!=="shadow"&&Ie&&Ie.setupShadowsFromMatrix(m.nodeModelMatrix,be),be.draw(s,O.gl.TRIANGLES,R,x,S,F.material.doubleSided?gr.disabled:gr.backCCW,ge,h.id,F.vertexBuffer,F.indexBuffer,F.segments,h.paint,s.transform.zoom,void 0,fe)}function Nm(m,s){return m.style._importedAsBasemap?"basemap":s.scope}function zm(m,s,h,g,x,S,T,O,R,z){const F=m.transform,Z=!!s.isGeometryBloom&&s.isGeometryBloom;if(Z&&m.renderPass==="shadow")return;const W=F.projection.name==="globe"?o.eD(h,F):[...h];o.aB(W,W,s.globalMatrix);const K=o.aB([],g,W);if(s.meshes)for(const ne of s.meshes){const ee=O.get(ne.material.name);if(ee&&ee.opacity<=0)continue;if(ne.material.alphaMode!=="BLEND"){T.push({mesh:ne,depth:0,modelIndex:x,worldViewProjection:K,nodeModelMatrix:W,isLightMesh:Z,materialOverride:ee,modelOpacity:R,modelColor:z});continue}const ie=o.af([],ne.centroid,K);!F.isOrthographic&&ie[2]<=0||S.push({mesh:ne,depth:ie[2],modelIndex:x,worldViewProjection:K,nodeModelMatrix:W,isLightMesh:Z,materialOverride:ee,modelOpacity:R,modelColor:z})}if(s.children)for(const ne of s.children)zm(m,ne,h,g,x,S,T,O,R,z)}function Mf(m,s,h,g){const x=h.shadowRenderer;if(!x)return;const S=x.getShadowPassDepthMode(),T=x.getShadowPassColorMode(),O=x.calculateShadowPassMatrixFromMatrix(s),R=Lm(O);h.getOrCreateProgram("modelDepth",{defines:h._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(h,h.context.gl.TRIANGLES,S,xr.disabled,T,gr.disabled,R,g.id,m.vertexBuffer,m.indexBuffer,m.segments,g.paint,h.transform.zoom,void 0,void 0)}function lA(m,s,h,g,x,S){for(const T of x){const O=Object.assign({},g);O.part=T;const R={type:"Unknown",id:s,properties:O},z={orientation:m.paint.get("model-rotation").evaluate(R,h)};S.set(T,z)}}function cA(m,s,h,g,x,S){for(const T of x){const O=Object.assign({},g);O.part=T;const R={type:"Unknown",id:s,properties:O},z={color:m.paint.get("model-color").evaluate(R,h),colorMix:m.paint.get("model-color-mix-intensity").evaluate(R,h),opacity:m.paint.get("model-opacity").evaluate(R,h),emissionStrength:m.paint.get("model-emissive-strength").evaluate(R,h)};S.set(T,z)}}function jb(m,s,h,g,x){let S=!1;for(const O of g)O.modelOpacity!==1&&(Dn(O,m,s,x[O.modelIndex],xr.disabled,Er.disabled),S=!0);for(const O of g)Dn(O,m,s,x[O.modelIndex],O.modelOpacity!==1?m.stencilModeFor3D():xr.disabled,m.colorModeForRenderPass());S&&m.resetStencilClippingMasks();const T=Er.additive;for(const O of h)Dn(O,m,s,x[O.modelIndex],xr.disabled,O.isLightMesh?T:m.colorModeForRenderPass())}function ch(m,s,h){const g=s.updateZoomBasedPaintProperties(),x=function(S,T,O){let R,z,F,Z=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&Z>0){const W=S.terrain,K=W.findDEMTileFor(O);K&&K.dem?R=o.eF.create(W,O,K):Z=0}if(Z===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),Z===T.validForExaggeration&&(Z===0||R&&R._demTile&&R._demTile.tileID===T.validForDEMTile.id&&R._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const W in T.instancesPerModel){const K=T.instancesPerModel[W];for(let ne=0;ne<K.instancedDataArray.length;++ne){const ee=(R?Z*R.getElevationAt(0|K.instancedDataArray.float32[16*ne],0|K.instancedDataArray.float32[16*ne+1],!0,!0):0)+K.instancesEvaluatedElevation[ne];K.instancedDataArray.float32[16*ne+6]=ee,z=z?Math.min(T.terrainElevationMin,ee):ee,F=F?Math.max(T.terrainElevationMax,ee):ee}}return T.terrainElevationMin=z||0,T.terrainElevationMax=F||0,T.validForExaggeration=Z,T.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0}(m,s,h);(g||x)&&(s.uploaded=!1,s.upload(m.context))}const Xs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d9([0,0,0],[o.al,o.al,0])};function Ct(m,s){const h=1<<m.canonical.z,g=s.getFreeCameraOptions().position,x=s.elevation,S=m.canonical.x/h,T=(m.canonical.x+1)/h,O=m.canonical.y/h,R=(m.canonical.y+1)/h;let z=s._centerAltitude;if(x){const K=x.getMinMaxForTile(m);K&&K.max>z&&(z=K.max)}const F=o.aA(g.x,S,T)-g.x,Z=o.aA(g.y,O,R)-g.y,W=o.cf(z,s.center.lat)-g.z;return s._zoomFromMercatorZ(Math.sqrt(F*F+Z*Z+W*W))}function zt(m,s,h,g,x,S,T){const O=m.context,R=m.renderPass==="shadow",z=m.shadowRenderer,F=R&&z?z.getShadowPassDepthMode():new Qt(O.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D),Z=m.isTileAffectedByFog(S),W=m.transform.projection.name==="globe";if(h.meshes)for(const K of h.meshes){const ne=W?[]:["MODEL_POSITION_ON_GPU"],ee=[];let ie,ce,ge;const pe=!W&&g.instancedDataArray.length>20;pe&&ne.push("INSTANCED_ARRAYS");const fe=Pl(m,s.paint.get("model-cutoff-fade-range"));if(fe.shouldRenderCutoff&&ne.push("RENDER_CUTOFF"),R&&z)ie=m.getOrCreateProgram("modelDepth",{defines:ne}),ce=Lm(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(h.globalMatrix)),ge=z.getShadowPassColorMode();else{Hl(ne,ee,K,m,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),ie=m.getOrCreateProgram("model",{defines:ne,overrideFog:Z});const Ee=K.material,Pe=Ee.pbrMetallicRoughness,be=s.paint.get("model-opacity").constantOr(1),ve=s.paint.get("model-emissive-strength").constantOr(0);ce=u_(S.expandedProjMatrix,Float32Array.from(h.globalMatrix),new Float32Array(16),null,m,be,Pe.baseColorFactor,Ee.emissiveFactor,Pe.metallicFactor,Pe.roughnessFactor,Ee,ve,s,x),z&&(T.shadowUniformsInitialized?ie.setShadowUniformValues(O,z.getShadowUniformValues()):(z.setupShadows(S.toUnwrapped(),ie,"model-tile"),T.shadowUniformsInitialized=!0)),ge=fe.shouldRenderCutoff||be<1||Ee.alphaMode!=="OPAQUE"?Er.alphaBlended:Er.unblended}m.uploadCommonUniforms(O,ie,S.toUnwrapped(),null,fe);const Ie=K.material.doubleSided?gr.disabled:gr.backCCW;if(pe)ee.push(g.instancedDataBuffer),ie.draw(m,O.gl.TRIANGLES,F,xr.disabled,ge,Ie,ce,s.id,K.vertexBuffer,K.indexBuffer,K.segments,s.paint,m.transform.zoom,void 0,ee,g.instancedDataArray.length);else{const Ee=R?"u_instance":"u_normal_matrix";for(let Pe=0;Pe<g.instancedDataArray.length;++Pe)ce[Ee]=new Float32Array(g.instancedDataArray.arrayBuffer,64*Pe,16),ie.draw(m,O.gl.TRIANGLES,F,xr.disabled,ge,Ie,ce,s.id,K.vertexBuffer,K.indexBuffer,K.segments,s.paint,m.transform.zoom,void 0,ee)}}if(h.children)for(const K of h.children)zt(m,s,K,g,x,S,T)}const Df=[1,-1,1];function bi(m,s,h,g){if(!h.modelManager)return!0;const x=h.modelManager;if(!h.shadowRenderer)return!0;const S=h.shadowRenderer,T=s.aabb;let O=!0,R=m.maxHeight;if(R===0){let F=0;for(const Z in m.instancesPerModel){const W=x.getModel(Z,g);W?F=Math.max(F,Math.max(Math.max(W.aabb.max[0],W.aabb.max[1]),W.aabb.max[2])):O=!1}R=m.maxScale*F*1.41+m.maxVerticalOffset,O&&(m.maxHeight=R)}T.max[2]=R,T.min[2]+=m.terrainElevationMin,T.max[2]+=m.terrainElevationMax,o.af(T.min,T.min,s.tileMatrix),o.af(T.max,T.max,s.tileMatrix);const z=T.intersects(S.getCurrentCascadeFrustum());return h.currentShadowCascade===0&&(m.isInsideFirstShadowMapFrustum=z===2),z===0}function Ue(m,s){const h=m.uniformValues.u_cutoff_params[0],g=m.uniformValues.u_cutoff_params[1],x=m.uniformValues.u_cutoff_params[2],S=m.uniformValues.u_cutoff_params[3];return g===h||S===x?1:o.aA(((s-h)/(g-h)-x)/(S-x),0,1)}function uA(m,s,h,g){if(s.pitch<20)return 1;const x=s.getWorldToCameraMatrix();o.aB(x,x,m);const S=o.bU(h.min[0],h.min[1],h.min[2],1);let T=o.aC(o.eG(),S,x),O=T,R=T;S[1]=h.max[1],T=o.aC(o.eG(),S,x),O=T[1]<O[1]?T:O,R=T[1]>R[1]?T:R,S[0]=h.max[0],T=o.aC(o.eG(),S,x),O=T[1]<O[1]?T:O,R=T[1]>R[1]?T:R,S[1]=h.min[1],T=o.aC(o.eG(),S,x),O=T[1]<O[1]?T:O,R=T[1]>R[1]?T:R;const z=o.aA(g[0],0,1),F=100*s.pixelsPerMeter*o.aA(g[1],0,1),Z=o.aA(g[2],0,1),W=o.eH(o.eG(),O,R,z),K=Math.tan(.5*s.fovX),ne=-W[2]*K;if(F===0)return W[1]<-Math.abs(ne)?Z:1;const ee=(-Math.abs(ne)-W[1])/F,ie=(ge,pe,fe)=>(1-fe)*ge+fe*pe,ce=o.aA(ie(1,Z,ee),Z,1);return ie(1,ce,o.aA((s.pitch-20)/20,0,1))}class __{}class Nb{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,h,g){{const Z=this._storage.get(h.id);if(Z)return Z.lastUsedFrameIdx=s,Z.buf}const x=g.gl,S=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),T=new ArrayBuffer(S),O=new Int16Array(T);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const R=new o.eJ;for(let Z=0;Z<S/2;Z+=3){const W=O[Z],K=O[Z+1],ne=O[Z+2];R.emplaceBack(W,K),R.emplaceBack(K,ne),R.emplaceBack(ne,W)}const z=g.bindVertexArrayOES.current,F=new __;return F.buf=new Sc(g,R),F.lastUsedFrameIdx=s,this._storage.set(h.id,F),g.bindVertexArrayOES.set(z),F.buf}update(s){for(const[h,g]of this._storage)s-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(h))}destroy(){for(const[s,h]of this._storage)h.buf.destroy(),this._storage.delete(s)}}class zb{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const dA=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Fb{constructor(s){this.revealStart=11,this.revealRange=2}}const Lf=o.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class OR{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,h){const g=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new o.eK,O=new o.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),O.emplaceBack(0,1,2),O.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(T,Lf.members),this.vignetteIdx=s.context.createIndexBuffer(O)}const x=o.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,g);const T={u_vignetteShape:(S={vignetteShape:[h.start,h.range,Math.pow(10,h.fadePower)],vignetteColor:[h.color.r,h.color.g,h.color.b,h.color.a*h.strength]}).vignetteShape,u_vignetteColor:S.vignetteColor};g.draw(s,s.context.gl.TRIANGLES,Qt.disabled,xr.disabled,Er.alphaBlended,gr.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,x)}var S}}class kR{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,h){const g=s.getFreeCameraOptions().position,x=g.toAltitude(),S=g.toLngLat(),T=o.an(S.lng),O=o.an(S.lat),R=s.pixelsPerMeter/h,z=T*o.eM,F=o.eM*Math.log(Math.tan(Math.PI/4+O/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Z=-this._offsetYPrev+F,W=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*R,this._accumulatedOffsetY+=Z*R,this._accumulatedElevation+=W*R,this._offsetXPrev=z,this._offsetYPrev=F,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Bb(m,s){return[-(m[0]-Math.floor(m[0]/s)*s),-(m[1]-Math.floor(m[1]/s)*s),-(m[2]-Math.floor(m[2]/s)*s)]}function Fm(m){const s=o.eq(1323123451230),h=[];for(let g=0;g<m;++g){const x=2*s()-1,S=2*s()-1,T=2*s()-1;h.push(o.d5(x,S,T))}return h}function Ec(m,s,h,g,x){const S=o.aA((x-h)/(g-h),0,1);return(1-S)*m+S*s}class $b{constructor(s){this._movement=new kR,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new OR,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,h){const g=s.transform;this._movement.update(g,this._ppmScaleFactor);const x=g.starsProjMatrix,S=o.c7([]);o.c9(S,S,o.an(90)-g._pitch),o.c8(S,S,-g.angle);const T=o.cc(new Float32Array(16),S),O=o.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=o.eg([],O),z=o.aB([],R,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*h,this._prevTime=F,{projectionMatrix:x,modelviewMatrix:z}}}class hA extends $b{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Fb("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const h=s.context;if(!this.particlesVx){const g=Fm(this.particlesCount),x=new o.eN,S=new o.b0;let T=0;const O=o.eq(1323123451230);for(let R=0;R<g.length;++R){const z=g[R],F=[2*O()-1,O(),O(),O()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,-1,...F),x.emplaceBack(z[0],z[1],z[2],1,1,...F),x.emplaceBack(z[0],z[1],z[2],-1,1,...F),S.emplaceBack(T+0,T+1,T+2),S.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=h.createVertexBuffer(x,dA.members),this.particlesIdx=h.createIndexBuffer(S)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const h=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},g=s.transform.zoom;if(h.revealStart>g)return;const x=Ec(0,1,h.revealStart,h.revealStart+h.revealRange,g);if(!this.particlesVx||!this.particlesIdx)return;const S=structuredClone(this._params);let T=[-S.direction.x,S.direction.y,-100];o.aw(T,T);const O=structuredClone(this._vignetteParams);O.strength*=x,S.overrideStyleParameters||(S.intensity=s.style.rain.state.density,S.timeFactor=s.style.rain.state.intensity,S.color=structuredClone(s.style.rain.state.color),T=structuredClone(s.style.rain.state.direction),S.screenThinning.intensity=s.style.rain.state.centerThinning,S.dropletSizeX=s.style.rain.state.dropletSize[0],S.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],S.distortionStrength=100*s.style.rain.state.distortionStrength,O.strength=1,O.color=structuredClone(s.style.rain.state.vignetteColor));const R=this.updateOnRender(s,S.timeFactor),z=s.context,F=z.gl,Z=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new o.T(z,{width:s.width,height:s.height,data:null},F.RGBA8)),S.distortionStrength>0&&(z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const W=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(z,W),z.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const K=[S.color.r,S.color.g,S.color.b,S.color.a],ne=(ee,ie)=>{const ce=Bb(this._movement.getPosition(),ee),ge=S.dropletSizeX,pe=S.dropletSizeX*S.dropletSizeYScale,fe=s.width/2,Ie=s.height/2,Ee=Ec(0,S.screenThinning.start,0,1,S.screenThinning.intensity),Pe=Ec(.001,S.screenThinning.range,0,1,S.screenThinning.intensity),be=Ec(0,S.screenThinning.particleOffset,0,1,S.screenThinning.intensity),ve=(ke={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ce,velocityConeAperture:S.velocityConeAperture,velocity:S.velocity,boxSize:ee,rainDropletSize:[ge,pe],distortionStrength:S.distortionStrength,rainDirection:T,color:K,screenSize:[Z.width,Z.height],thinningCenterPos:[fe,Ie],thinningShape:[Ee,Pe,Math.pow(10,S.screenThinning.fadePower)],thinningAffectedRatio:S.screenThinning.affectedRatio,thinningParticleOffset:be,shapeDirectionalPower:S.shapeDirPower,shapeNormalPower:S.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(ke.modelview),u_projection:Float32Array.from(ke.projection),u_time:ke.time,u_cam_pos:ke.camPos,u_texScreen:0,u_velocityConeAperture:ke.velocityConeAperture,u_velocity:ke.velocity,u_boxSize:ke.boxSize,u_rainDropletSize:ke.rainDropletSize,u_distortionStrength:ke.distortionStrength,u_rainDirection:ke.rainDirection,u_color:ke.color,u_screenSize:ke.screenSize,u_thinningCenterPos:ke.thinningCenterPos,u_thinningShape:ke.thinningShape,u_thinningAffectedRatio:ke.thinningAffectedRatio,u_thinningParticleOffset:ke.thinningParticleOffset,u_shapeDirectionalPower:ke.shapeDirectionalPower,u_shapeNormalPower:ke.shapeNormalPower,u_mode:ke.mode});var ke;const Ne=Math.round(S.intensity*this.particlesCount),$e=o.bg.simpleSegment(0,0,4*Ne,2*Ne);W.draw(s,F.TRIANGLES,Qt.disabled,xr.disabled,Er.alphaBlended,gr.disabled,ve,"rain_particles",this.particlesVx,this.particlesIdx,$e)};S.distortionStrength>0&&ne(S.boxSize,!0),ne(S.boxSize,!1),this._vignette.draw(s,O)}}const v_=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Bm extends $b{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Fb("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const h=s.context;if(!this.particlesVx){const g=Fm(this.particlesCount),x=new o.eO,S=new o.b0;let T=0;const O=o.eq(1323123451230);for(let R=0;R<g.length;++R){const z=g[R],F=O(),Z=O(),W=O(),K=[R/g.length,F,Z,W],ne=[O(),O()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...K,...ne),x.emplaceBack(z[0],z[1],z[2],1,-1,...K,...ne),x.emplaceBack(z[0],z[1],z[2],1,1,...K,...ne),x.emplaceBack(z[0],z[1],z[2],-1,1,...K,...ne),S.emplaceBack(T+0,T+1,T+2),S.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=h.createVertexBuffer(x,v_.members),this.particlesIdx=h.createIndexBuffer(S)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const h=structuredClone(this._params);let g=[-h.direction.x,h.direction.y,-100];o.aw(g,g);const x=structuredClone(this._vignetteParams),S=h.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=s.transform.zoom;if(S.revealStart>T)return;const O=Ec(0,1,S.revealStart,S.revealStart+S.revealRange,T);x.strength*=O,h.overrideStyleParameters||(h.intensity=s.style.snow.state.density,h.timeFactor=s.style.snow.state.intensity,h.color=structuredClone(s.style.snow.state.color),g=structuredClone(s.style.snow.state.direction),h.screenThinning.intensity=s.style.snow.state.centerThinning,h.billboardSize=2.79*s.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(s.style.snow.state.vignetteColor));const R=this.updateOnRender(s,h.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=s.context,F=z.gl,Z=s.transform,W=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(z,W),((K,ne,ee)=>{const ie=Bb(this._movement.getPosition(),K),ce=Z.width/2,ge=Z.height/2,pe=Ec(0,ee.screenThinning.start,0,1,ee.screenThinning.intensity),fe=Ec(.001,ee.screenThinning.range,0,1,ee.screenThinning.intensity),Ie=Ec(0,ee.screenThinning.particleOffset,0,1,ee.screenThinning.intensity),Ee=(Pe={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:ee.velocityConeAperture,velocity:ee.velocity,horizontalOscillationRadius:ee.horizontalOscillationRadius,horizontalOscillationRate:ee.horizontalOscillationRate,boxSize:K,billboardSize:1*ee.billboardSize,simpleShapeParameters:[ee.shapeFadeStart,ee.shapeFadePower],screenSize:[Z.width,Z.height],thinningCenterPos:[ce,ge],thinningShape:[pe,fe,Math.pow(10,ee.screenThinning.fadePower)],thinningAffectedRatio:ee.screenThinning.affectedRatio,thinningParticleOffset:Ie,color:[ee.color.r,ee.color.g,ee.color.b,ee.color.a],direction:g},{u_modelview:Float32Array.from(Pe.modelview),u_projection:Float32Array.from(Pe.projection),u_time:Pe.time,u_cam_pos:Pe.camPos,u_velocityConeAperture:Pe.velocityConeAperture,u_velocity:Pe.velocity,u_horizontalOscillationRadius:Pe.horizontalOscillationRadius,u_horizontalOscillationRate:Pe.horizontalOscillationRate,u_boxSize:Pe.boxSize,u_billboardSize:Pe.billboardSize,u_simpleShapeParameters:Pe.simpleShapeParameters,u_screenSize:Pe.screenSize,u_thinningCenterPos:Pe.thinningCenterPos,u_thinningShape:Pe.thinningShape,u_thinningAffectedRatio:Pe.thinningAffectedRatio,u_thinningParticleOffset:Pe.thinningParticleOffset,u_particleColor:Pe.color,u_direction:Pe.direction});var Pe;const be=Math.round(ee.intensity*this.particlesCount),ve=o.bg.simpleSegment(0,0,4*be,2*be);this.particlesVx&&this.particlesIdx&&W.draw(s,F.TRIANGLES,Qt.disabled,xr.disabled,Er.alphaBlended,gr.disabled,Ee,"snow_particles",this.particlesVx,this.particlesIdx,ve)})(h.boxSize,0,h),this._vignette.draw(s,x)}}const uh={symbol:function(m,s,h,g,x){if(m.renderPass!=="translucent")return;const S=xr.disabled,T=m.colorModeForRenderPass(),O=h.layout.get("text-variable-anchor"),R=h.layout.get("text-size-scale-range"),z=o.aA(m.scaleFactor,R[0],R[1]);O&&function(W,K,ne,ee,ie,ce,ge,pe){const fe=K.transform,Ie=ie==="map",Ee=ce==="map";for(const Pe of W){const be=ee.getTile(Pe),ve=be.getBucket(ne);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const ke=o.bK(ve.textSizeData,fe.zoom,pe),Ne=mf(Pe,ve.getProjection(),fe),$e=fe.calculatePixelsToTileUnitsMatrix(be),Je=Qd(Ne,be.tileID.canonical,Ee,Ie,fe,ve.getProjection(),$e),Xe=ve.hasIconTextFit()&&ve.hasIconData();ke&&XE(ve,Ie,Ee,ge,fe,Je,Pe,Math.pow(2,fe.zoom-be.tileID.overscaledZ),ke,Xe)}}(g,m,h,s,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),x,z);const F=h.paint.get("icon-opacity").constantOr(1)!==0,Z=h.paint.get("text-opacity").constantOr(1)!==0;h.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||Z)?f_(m,s,h,g,S,T):(F&&f_(m,s,h,g,S,T,{onlyIcons:!0}),Z&&f_(m,s,h,g,S,T,{onlyText:!0})),s.map.showCollisionBoxes&&(bb(m,s,h,g,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),bb(m,s,h,g,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(m,s,h,g){if(m.renderPass!=="translucent")return;const x=h.paint.get("circle-opacity"),S=h.paint.get("circle-stroke-width"),T=h.paint.get("circle-stroke-opacity"),O=h.layout.get("circle-sort-key").constantOr(1)!==void 0,R=h.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(S.constantOr(1)===0||T.constantOr(1)===0))return;const z=m.context,F=z.gl,Z=m.transform,W=!(!m.terrain||!m.terrain.enabled),K=h.layout.get("circle-elevation-reference"),ne=m.depthModeForSublayer(0,Qt.ReadOnly),ee=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D),ie=K==="none"||W?ne:ee,ce=xr.disabled,ge=m.colorModeForDrapableLayerRenderPass(R),pe=Z.projection.name==="globe",fe=[o.aF(Z.center.lng),o.aJ(Z.center.lat)],Ie=[];for(let Pe=0;Pe<g.length;Pe++){const be=g[Pe],ve=s.getTile(be),ke=ve.getBucket(h);if(!ke||ke.projection.name!==Z.projection.name)continue;const Ne=ke.programConfigurations.get(h.id),$e=ke.layoutVertexBuffer,Je=ke.globeExtVertexBuffer,Xe=ke.indexBuffer,ht=o.e0(h),vt=[Je],We=m.isTileAffectedByFog(be);pe&&ht.push("PROJECTION_GLOBE_VIEW"),ht.push("DEPTH_D24"),m.terrain&&Z.depthOcclusionForSymbolsAndCircles&&ht.push("DEPTH_OCCLUSION"),ke.hasElevation&&!m.terrain&&(ht.push("ELEVATED_ROADS"),vt.push(ke.elevatedLayoutVertexBuffer));const Re=m.getOrCreateProgram("circle",{config:Ne,defines:ht,overrideFog:We}),lt=Z.projection.createInversionMatrix(Z,be.canonical),Qe={programConfiguration:Ne,program:Re,layoutVertexBuffer:$e,dynamicBuffers:vt,indexBuffer:Xe,uniformValues:o.e1(m,be,ve,lt,fe,h),tile:ve};if(O){const bt=ke.segments.get();for(const At of bt)Ie.push({segments:new o.bg([At]),sortKey:At.sortKey,state:Qe})}else Ie.push({segments:ke.segments,sortKey:0,state:Qe})}O&&Ie.sort((Pe,be)=>Pe.sortKey-be.sortKey);const Ee={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const Pe of Ie){const{programConfiguration:be,program:ve,layoutVertexBuffer:ke,dynamicBuffers:Ne,indexBuffer:$e,uniformValues:Je,tile:Xe}=Pe.state,ht=Pe.segments;m.terrain&&m.terrain.setupElevationDraw(Xe,ve,Ee),m.uploadCommonUniforms(z,ve,Xe.tileID.toUnwrapped()),ve.draw(m,F.TRIANGLES,ie,ce,ge,gr.disabled,Je,h.id,ke,$e,ht,h.paint,Z.zoom,be,Ne)}},heatmap:function(m,s,h,g){if(h.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const x=m.context,S=x.gl,T=xr.disabled,O=new Er([S.ONE,S.ONE,S.ONE,S.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(K,ne,ee,ie){const ce=K.gl,ge=ne.width*ie,pe=ne.height*ie;K.activeTexture.set(ce.TEXTURE1),K.viewport.set([0,0,ge,pe]);let fe=ee.heatmapFbo;if(!fe||fe&&(fe.width!==ge||fe.height!==pe)){fe&&fe.destroy();const Ie=ce.createTexture();ce.bindTexture(ce.TEXTURE_2D,Ie),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_S,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_WRAP_T,ce.CLAMP_TO_EDGE),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MIN_FILTER,ce.LINEAR),ce.texParameteri(ce.TEXTURE_2D,ce.TEXTURE_MAG_FILTER,ce.LINEAR),fe=ee.heatmapFbo=K.createFramebuffer(ge,pe,1,null),function(Ee,Pe,be,ve,ke,Ne){const $e=Ee.gl;$e.texImage2D($e.TEXTURE_2D,0,Ee.extRenderToTextureHalfFloat?$e.RGBA16F:$e.RGBA,ke,Ne,0,$e.RGBA,Ee.extRenderToTextureHalfFloat?$e.HALF_FLOAT:$e.UNSIGNED_BYTE,null),ve.colorAttachment0.set(be)}(K,0,Ie,fe,ge,pe)}else ce.bindTexture(ce.TEXTURE_2D,fe.colorAttachment0.get()),K.bindFramebuffer.set(fe.framebuffer)})(x,m,h,m.transform.projection.name==="globe"?.5:.25),x.clear({color:o.ao.transparent});const R=m.transform,z=R.projection.name==="globe",F=z?["PROJECTION_GLOBE_VIEW"]:[],Z=z?gr.frontCCW:gr.disabled,W=[o.aF(R.center.lng),o.aJ(R.center.lat)];for(let K=0;K<g.length;K++){const ne=g[K];if(s.hasRenderableParent(ne))continue;const ee=s.getTile(ne),ie=ee.getBucket(h);if(!ie||ie.projection.name!==R.projection.name)continue;const ce=m.isTileAffectedByFog(ne),ge=ie.programConfigurations.get(h.id),pe=m.getOrCreateProgram("heatmap",{config:ge,defines:F,overrideFog:ce}),{zoom:fe}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ee,pe),m.uploadCommonUniforms(x,pe,ne.toUnwrapped());const Ie=R.projection.createInversionMatrix(R,ne.canonical);pe.draw(m,S.TRIANGLES,Qt.disabled,T,O,Z,vb(m,ne,ee,Ie,W,fe,h.paint.get("heatmap-intensity")),h.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,h.paint,m.transform.zoom,ge,z?[ie.globeExtVertexBuffer]:null)}x.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(x,S){const T=x.context,O=T.gl,R=S.heatmapFbo;if(!R)return;T.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,R.colorAttachment0.get()),T.activeTexture.set(O.TEXTURE1);let z=S.colorRampTexture;z||(z=S.colorRampTexture=new o.T(T,S.colorRamp,O.RGBA8)),z.bind(O.LINEAR,O.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,O.TRIANGLES,Qt.disabled,xr.disabled,x.colorModeForRenderPass(),gr.disabled,((F,Z)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,S),S.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,S.paint,x.transform.zoom)}(m,h))},line:function(m,s,h,g){if(m.renderPass!=="translucent")return;const x=h.paint.get("line-opacity"),S=h.paint.get("line-width");if(x.constantOr(1)===0||S.constantOr(1)===0)return;const T=h.paint.get("line-emissive-strength").isConstant(),O=h.paint.get("line-emissive-strength").constantOr(0),R=h.paint.get("line-occlusion-opacity"),z=h.layout.get("line-elevation-reference"),F=h.layout.get("line-width-unit")==="meters",Z=z==="sea",W=!(!m.terrain||!m.terrain.enabled),K=m.context,ne=K.gl;if(h.hasElevatedBuckets&&m.transform.projection.name==="globe")return;const ee=h.layout.get("line-cross-slope"),ie=ee!==void 0,ce=ee<1,ge=m.colorModeForDrapableLayerRenderPass(T?O:null),pe=m.terrain&&m.terrain.renderingToTexture,fe=pe?1:o.o.devicePixelRatio,Ie=h.paint.get("line-dasharray"),Ee=Ie.constantOr(1),Pe=h.layout.get("line-cap"),be=Ie.constantOr(null),ve=Pe.constantOr(null),ke=h.paint.get("line-pattern"),Ne=ke.constantOr(1),$e=h.paint.get("line-pattern-cross-fade"),Je=ke.constantOr(null),Xe=h.paint.get("line-opacity").constantOr(1);let ht=!Ne&&Xe!==1||m.depthOcclusion&&R>0&&R<1;const vt=h.paint.get("line-gradient"),We=Ne?"linePattern":"line",Re=o.e2(h);let lt;if(pe&&m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ht=!1),R!==0&&m.depthOcclusion){const Lt=h.paint._values["line-opacity"];Lt&&Lt.value&&Lt.value.kind==="constant"?lt=Lt.value:o.w(`Occlusion opacity for layer ${h.id} is supported only when line-opacity isn't data-driven.`)}S.value.kind!=="constant"&&S.value.isLineProgressConstant===!1&&Re.push("VARIABLE_LINE_WIDTH"),pe&&(m.emissiveMode!=="dual-source-blending"||T?m.emissiveMode==="mrt-fallback"&&Re.push("USE_MRT1"):Re.push("DUAL_SOURCE_BLENDING"));const Qe=(Lt,Pt,It,Kt,Xt,Bt)=>{for(const Zt of Lt){const or=s.getTile(Zt);if(Ne&&!or.patternsLoaded())continue;const yr=or.getBucket(h);if(!yr||yr.elevationType!=="none"&&!Xt||yr.elevationType==="none"&&Xt)continue;m.prepareDrawTile();const Lr=[...Pt],Jr=m.shadowRenderer,Tr=yr.elevationType==="road"&&!!Jr&&Jr.enabled;let ln=[0,0,0];if(Tr){const Rr=m.style.directionalLight,Zn=m.style.ambientLight;Rr&&Zn&&(ln=Cl(m.style,Rr,Zn)),Lr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Cr=yr.programConfigurations.get(h.id);let In=!1;if(Je&&or.imageAtlas){const Rr=o.e3.from(Je),Zn=Rr.getPrimary().scaleSelf(fe).toString(),wi=or.imageAtlas.patternPositions.get(Zn),Jn=Rr.getSecondary(),ri=Jn?or.imageAtlas.patternPositions.get(Jn.scaleSelf(fe).toString()):null;In=!!wi&&!!ri,wi&&Cr.setConstantPatternPositions(wi,ri)}$e>0&&(In||Cr.getPatternTransitionVertexBuffer("line-pattern"))&&Lr.push("LINE_PATTERN_TRANSITION");const An=m.isTileAffectedByFog(Zt),kn=m.getOrCreateProgram(We,{config:Cr,defines:Lr,overrideFog:An});if(!Ne&&be&&ve&&or.lineAtlas){const Rr=or.lineAtlas.getDash(be,ve);Rr&&Cr.setConstantPatternPositions(Rr)}Tr&&Jr.setupShadows(or.tileID.toUnwrapped(),kn,"vector-tile");let[en,kr]=h.paint.get("line-trim-offset");(ve==="round"||ve==="square")&&en!==kr&&(en===0&&(en-=1),kr===1&&(kr+=1));const yn=pe?Zt.projMatrix:null,hi=F?1/yr.tileToMeter/o.ay(or,1,m.transform.zoom):1,fi=F?1/yr.tileToMeter/o.ay(or,1,Math.floor(m.transform.zoom)):1,_n=Ne?o.e4(m,or,h,yn,fe,hi,fi,[en,kr],ln,$e):o.e5(m,or,h,yn,yr.lineClipsArray.length,fe,hi,fi,[en,kr],ln);if(vt){const Rr=yr.gradients[h.id];let Zn=Rr.texture;if(h.gradientVersion!==Rr.version){let wi=256;if(h.stepInterpolant){const Jn=s.getSource().maxzoom,ri=Zt.canonical.z===Jn?Math.ceil(1<<m.transform.maxZoom-Zt.canonical.z):1;wi=o.aA(o.e6(yr.maxLineLength/o.al*1024*ri),256,K.maxTextureSize)}Rr.gradient=o.e7({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:wi,image:Rr.gradient||void 0,clips:yr.lineClipsArray}),Rr.texture?Rr.texture.update(Rr.gradient):Rr.texture=new o.T(K,Rr.gradient,ne.RGBA8),Rr.version=h.gradientVersion,Zn=Rr.texture}K.activeTexture.set(ne.TEXTURE1),Zn.bind(h.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}Ee&&(K.activeTexture.set(ne.TEXTURE0),or.lineAtlasTexture&&or.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),Cr.updatePaintBuffers()),Ne&&(K.activeTexture.set(ne.TEXTURE0),or.imageAtlasTexture&&or.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),Cr.updatePaintBuffers()),Xt&&!Z&&m.terrain.setupElevationDraw(or,kn),m.uploadCommonUniforms(K,kn,Zt.toUnwrapped());const qr=Rr=>{lt!=null&&(lt.value=Xe*R),kn.draw(m,ne.TRIANGLES,It,Rr,ge,gr.disabled,_n,h.id,yr.layoutVertexBuffer,yr.indexBuffer,yr.segments,h.paint,m.transform.zoom,Cr,[yr.layoutVertexBuffer2,yr.patternVertexBuffer,yr.zOffsetVertexBuffer]),lt!=null&&(lt.value=Xe)};if(ht&&!Xt){const Rr=m.stencilModeForClipping(Zt).ref;Rr===0&&pe&&K.clear({stencil:0});const Zn={func:ne.EQUAL,mask:255};_n.u_alpha_discard_threshold=.8,qr(new xr(Zn,Rr,255,ne.KEEP,ne.KEEP,ne.INVERT)),_n.u_alpha_discard_threshold=0,qr(new xr(Zn,Rr,255,ne.KEEP,ne.KEEP,ne.KEEP))}else _n.u_alpha_discard_threshold=ht&&Xt&&Bt?.8:0,qr(Xt?Kt:m.stencilModeForClipping(Zt))}};let bt=m.depthModeForSublayer(0,Qt.ReadOnly);const At=new Qt(m.depthOcclusion?ne.GREATER:ne.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);if(h.hasNonElevatedBuckets){const Lt=!pe&&m.terrain;R!==0&&Lt?o.w(`Occlusion opacity for layer ${h.id} is supported on terrain only if the layer has line-z-offset enabled.`):Lt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${h.id}.`):Qe(g,Re,bt,xr.disabled,!1,!0)}if(h.hasElevatedBuckets){z==="hd-road-markup"?W||(bt=At,Re.push("ELEVATED_ROADS")):(Re.push("ELEVATED"),bt=At,ie&&Re.push(ce?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Z&&Re.push("ELEVATION_REFERENCE_SEA"));const Lt=ht?m.stencilModeFor3D():xr.disabled;m.forceTerrainMode=!0,Qe(g,Re,bt,Lt,!0,!0),ht&&Qe(g,Re,bt,Lt,!0,!1),m.forceTerrainMode=!1}ht&&(m.resetStencilClippingMasks(),pe&&K.clear({stencil:0})),R===0||m.depthOcclusion||pe||m.layersWithOcclusionOpacity.push(m.currentLayer)},fill:function(m,s,h,g){const x=h.paint.get("fill-color"),S=h.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const T=h.paint.get("fill-emissive-strength"),O=m.colorModeForDrapableLayerRenderPass(T),R=h.paint.get("fill-pattern"),z=m.opaquePassEnabledForLayer()&&!R.constantOr(1)&&x.constantOr(o.ao.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";let F="none";h.layout.get("fill-elevation-reference")!=="none"?F="road":h.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const Z=!(!m.terrain||!m.terrain.enabled),W={painter:m,sourceCache:s,layer:h,coords:g,colorMode:O,elevationType:F,terrainEnabled:Z,pass:z};if(m.renderPass==="shadow")return void(m.shadowRenderer&&F==="road"&&!Z&&function(ne){const{painter:ee,sourceCache:ie,layer:ce,coords:ge}=ne,pe=ee.context.gl,fe=ne.painter.shadowRenderer;for(const Ie of ge){const Ee=ie.getTile(Ie),Pe=Ee.getBucket(ce);if(!Pe)continue;const be=Pe.elevatedStructures;if(!be||!be.shadowCasterSegments||be.shadowCasterSegments.segments[0].primitiveLength===0)continue;ee.prepareDrawTile();const ve=Pe.bufferData.programConfigurations.get(ce.id),ke=ee.isTileAffectedByFog(Ie),Ne=ee.getOrCreateProgram("elevatedStructuresDepth",{config:ve,overrideFog:ke}),$e=fe.calculateShadowPassMatrixFromTile(Ee.tileID.toUnwrapped());ee.uploadCommonUniforms(ee.context,Ne,Ie.toUnwrapped());const Je=gb($e,0);Ne.draw(ee,pe.TRIANGLES,fe.getShadowPassDepthMode(),xr.disabled,fe.getShadowPassColorMode(),gr.disabled,Je,ce.id,be.vertexBuffer,be.indexBuffer,be.shadowCasterSegments,ce.paint,ee.transform.zoom,ve)}}(W));const K=m.emissiveMode==="mrt-fallback";if(F!=="offset"){if(Of(W,!1,K),F==="road"){const ne=!Z&&m.renderPass==="translucent";ne&&Sb(m,s,h,g,"geometry"),Of(W,!0,K,xr.disabled),ne&&function(ee){const{painter:ie,sourceCache:ce,layer:ge,coords:pe,colorMode:fe}=ee,Ie=ie.context.gl,Ee=ee.painter.shadowRenderer,Pe=!!Ee&&Ee.enabled,be=new Qt(ie.context.gl.LEQUAL,Qt.ReadOnly,ie.depthRangeFor3D);let ve=[0,0,0];if(Pe){const Ne=ie.style.directionalLight,$e=ie.style.ambientLight;Ne&&$e&&(ve=Cl(ie.style,Ne,$e))}const ke=Ne=>{for(const $e of pe){const Je=ce.getTile($e),Xe=Je.getBucket(ge);if(!Xe)continue;const ht=Xe.elevatedStructures;if(!ht)continue;let vt,We;if(Ne?(vt=ht.renderableBridgeSegments,We=ht.bridgeProgramConfigurations.get(ge.id)):(vt=ht.renderableTunnelSegments,We=ht.tunnelProgramConfigurations.get(ge.id)),!vt||vt.segments[0].primitiveLength===0)continue;We.updatePaintBuffers(),ie.prepareDrawTile();const Re=ie.isTileAffectedByFog($e),lt=[];Pe&&lt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Qe=ie.getOrCreateProgram("elevatedStructures",{config:We,overrideFog:Re,defines:lt}),bt=ie.translatePosMatrix($e.projMatrix,Je,ge.paint.get("fill-translate"),ge.paint.get("fill-translate-anchor"));Pe&&Ee.setupShadows(Je.tileID.toUnwrapped(),Qe,"vector-tile");const At=sd(bt,ve);ie.uploadCommonUniforms(ie.context,Qe,$e.toUnwrapped()),Qe.draw(ie,Ie.TRIANGLES,be,xr.disabled,fe,gr.backCCW,At,ge.id,ht.vertexBuffer,ht.indexBuffer,vt,ge.paint,ie.transform.zoom,We,[ht.vertexBufferNormal])}};ke(!0),ke(!1)}(W)}}else Of(W,!1,K,m.stencilModeFor3D())},"fill-extrusion":function(m,s,h,g){const x=h.paint.get("fill-extrusion-opacity"),S=m.context,T=S.gl,O=m.terrain,R=O&&O.renderingToTexture;if(x===0)return;const z=m.emissiveMode==="mrt-fallback",F=m.conflationActive&&m.style.isLayerClipped(h,s.getSource()),Z=m.style.order.indexOf(h.fqid);if(F&&function(W,K,ne,ee,ie){for(const ce of ee){const ge=K.getTile(ce).getBucket(ne);ge&&(ge.updateReplacement(ce,W.replacementSource,ie),ge.uploadCentroid(W.context))}}(m,s,h,g,Z),O||F)for(const W of g){const K=s.getTile(W).getBucket(h);K&&KE(m.context,s,W,K,h,O,F)}if(m.renderPass==="shadow"&&m.shadowRenderer){const W=m.shadowRenderer;if(O&&x<.65&&h._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const K=W.getShadowPassDepthMode(),ne=W.getShadowPassColorMode();kf(m,s,h,g,K,xr.disabled,ne,F)}else if(m.renderPass==="translucent"){const W=!h.paint.get("fill-extrusion-pattern").constantOr(1),K=h.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!R&&K.a!==0){const ne=new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D);x===1&&W?kf(m,s,h,g,ne,xr.disabled,Er.unblended,F):(kf(m,s,h,g,ne,xr.disabled,Er.disabled,F),kf(m,s,h,g,ne,m.stencilModeFor3D(),m.colorModeForRenderPass(),F),m.resetStencilClippingMasks())}if(m.style.enable3dLights()&&W&&(!O&&m.transform.projection.name!=="globe"||R)){const ne=h.paint.get("fill-extrusion-opacity"),ee=h.paint.get("fill-extrusion-ambient-occlusion-intensity"),ie=h.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ce=h.paint.get("fill-extrusion-flood-light-intensity"),ge=h.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",pe=h.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ge?null:h.lut).toArray01().slice(0,3),fe=ee>0&&ie>0,Ie=ce>0,Ee=(ve,ke,Ne)=>(1-Ne)*ve+Ne*ke,Pe=new jm;Pe.translate=h.paint.get("fill-extrusion-translate"),Pe.translateAnchor=h.paint.get("fill-extrusion-translate-anchor"),Pe.edgeRadius=h.layout.get("fill-extrusion-edge-radius"),Pe.cutoffFadeRange=h.paint.get("fill-extrusion-cutoff-fade-range");const be=ve=>{const ke=m.depthModeForSublayer(1,Qt.ReadOnly,T.LEQUAL,!0),Ne=h.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),$e=Ee(.1,3,Ne),Je=m._showOverdrawInspector;if(!Je){const Xe=new xr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),ht=new Er([T.ONE,T.ONE,T.ONE,T.ONE],o.ao.transparent,[!1,!1,!1,!0],T.MIN);Tc(Pe,m,s,h,g,ke,Xe,ht,gr.disabled,ve,"sdf",ne,ee,ie,ce,pe,$e,F,!1)}{const Xe=Je?xr.disabled:new xr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),ht=Je?m.colorModeForRenderPass():new Er([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],o.ao.transparent,[!0,!0,!0,!0]);Tc(Pe,m,s,h,g,ke,Xe,ht,gr.disabled,ve,"color",ne,ee,ie,ce,pe,$e,F,!1)}};if(R){const ve=()=>{const Ne=O.drapeBufferSize[0],$e=O.drapeBufferSize[1];let Je=O.framebufferCopyTexture;return Je&&(!Je||Je.size[0]===Ne&&Je.size[1]===$e)||(Je&&Je.destroy(),Je=O.framebufferCopyTexture=new o.T(S,new o.q({width:Ne,height:$e}),T.RGBA8)),Je.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Ne,$e),Je},ke=(Ne,$e,Je)=>{const Xe=m.depthModeForSublayer(1,Qt.ReadOnly,T.LEQUAL,!1),ht=h.paint.get(Ne?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),vt=Ee(.1,3,ht);{const We=new Er([T.ONE,T.ONE,T.ONE,T.ONE],o.ao.transparent,[!1,!1,!1,!0]);Tc(Pe,m,s,h,g,Xe,xr.disabled,We,gr.disabled,Ne,"clear",ne,ee,ie,ce,pe,vt,F,$e)}{const We=new xr({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Re=new Er([T.ONE,T.ONE,T.ONE,T.ONE],o.ao.transparent,[!1,!1,!1,!0],T.MIN);Tc(Pe,m,s,h,g,Xe,We,Re,gr.disabled,Ne,"sdf",ne,ee,ie,ce,pe,vt,F,$e)}z&&!Ne&&(Je=ve());{const We=Ne?T.ZERO:T.ONE_MINUS_DST_ALPHA,Re=new xr({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),lt=new Er([We,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],o.ao.transparent,[!0,!0,!0,!0]);Tc(Pe,m,s,h,g,Xe,Re,lt,gr.disabled,Ne,"color",ne,ee,ie,ce,pe,vt,F,$e)}if(!z||Ne){const We=new Er([T.ONE,T.ONE,T.ONE,Ne?T.ZERO:T.ONE],o.ao.transparent,[!1,!1,!1,!0],Ne?T.FUNC_ADD:T.MAX);Tc(Pe,m,s,h,g,Xe,xr.disabled,We,gr.disabled,Ne,"clear",ne,ee,ie,ce,pe,vt,F,$e,Je)}else{T.drawBuffers([T.NONE,T.COLOR_ATTACHMENT1]);const We=new xr({func:T.EQUAL,mask:255},254,255,T.KEEP,T.DECR,T.DECR),Re=new Er([T.ONE,T.ONE,T.ONE,T.ONE],o.ao.transparent,[!0,!1,!1,!1],T.MAX);Tc(Pe,m,s,h,g,Xe,We,Re,gr.disabled,Ne,"emissive",ne,ee,ie,ce,pe,vt,F,$e,Je),T.drawBuffers([T.COLOR_ATTACHMENT0])}};if(fe||Ie){let Ne;m.prepareDrawTile(),z&&!fe||(Ne=ve()),fe&&ke(!0,!1,Ne),Ie&&ke(!1,!0,Ne)}}else fe&&be(!0),Ie&&be(!1),(fe||Ie)&&m.resetStencilClippingMasks()}}},building:function(m,s,h,g){m.currentLayer<m.firstLightBeamLayer&&(m.firstLightBeamLayer=m.currentLayer);const x=h.paint.get("building-ambient-occlusion-ground-intensity"),S=h.paint.get("building-ambient-occlusion-ground-radius"),T=h.paint.get("building-ambient-occlusion-ground-attenuation"),O=h.paint.get("building-opacity");if(O<=0)return;let R=x>0&&S>0,z=!0;const F=h.paint.get("building-vertical-scale");if(F<=0)return;m.shadowRenderer||(z=!1);const Z=m.conflationActive&&m.style.isLayerClipped(h,s.getSource()),W=m.style.order.indexOf(h.fqid);if(function(K,ne,ee,ie,ce,ge){for(const pe of ge){const fe=ne.getTile(pe).getBucket(ee);fe&&(ce&&fe.updateReplacement(pe,K.replacementSource,ie),fe.uploadUpdatedIndexBuffer(K.context))}}(m,s,h,W,Z,g),function(K,ne,ee,ie){for(const ce of ie){const ge=ne.getTile(ce).getBucket(ee);ge&&ge.needsEvaluation()&&ge.uploadUpdatedColorBuffer(K.context)}}(m,s,h,g),h.resetLayerRenderingStats(m),m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!0),m.renderPass==="shadow"&&m.shadowRenderer){const K=m.shadowRenderer,ne=[],ee=K.getShadowPassDepthMode();Rf({painter:m,source:s,layer:h,coords:g,defines:ne,blendMode:K.getShadowPassColorMode(),depthMode:ee,opacity:O,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(m.renderPass==="translucent"){let K=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];z&&(K=K.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),m.shadowRenderer&&m.shadowRenderer.useNormalOffset&&(K=K.concat("NORMAL_OFFSET"));const ne=h.paint.get("building-facade-emissive-chance"),ee=h.paint.get("building-ambient-occlusion-intensity"),ie=h.paint.get("building-flood-light-intensity"),ce=h.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",ge=h.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ce?null:h.lut).toArray01().slice(0,3),pe=h.paint.get("building-flood-light-ground-attenuation"),fe=ie>0,Ie=new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D);O<1&&Rf({painter:m,source:s,layer:h,coords:g,defines:K,blendMode:Er.disabled,depthMode:Ie,opacity:O,verticalScale:F,facadeEmissiveChance:ne,facadeAOIntensity:ee,floodLightIntensity:ie,floodLightColor:ge,depthOnly:!0});const Ee=m.colorModeForRenderPass();Rf({painter:m,source:s,layer:h,coords:g,defines:K,blendMode:Ee,depthMode:Ie,opacity:O,verticalScale:F,facadeEmissiveChance:ne,facadeAOIntensity:ee,floodLightIntensity:ie,floodLightColor:ge}),R&&m_(m,s,h,g,!0,O,x,S,ie,ge,T,Z),fe&&m_(m,s,h,g,!1,O,x,S,ie,ge,pe,Z)}else if(m.renderPass==="light-beam"){const K=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],ne=new Qt(m.context.gl.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);Rf({painter:m,source:s,layer:h,coords:g,defines:K,blendMode:Er.alphaBlended,depthMode:ne,opacity:O,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}m.shadowRenderer&&(m.shadowRenderer.useNormalOffset=!1),m.resetStencilClippingMasks()},hillshade:function(m,s,h,g){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent"||m.style.disableElevatedTerrain)return;const x=m.context,S=m.terrain&&m.terrain.renderingToTexture,[T,O]=m.renderPass!=="translucent"||S?[{},g]:m.stencilConfigForOverlap(g);for(const R of O){const z=s.getTile(R);if(z.needsHillshadePrepare&&m.renderPass==="offscreen")gR(m,z,h);else if(m.renderPass==="translucent"){const F=m.depthModeForSublayer(0,Qt.ReadOnly),Z=h.paint.get("hillshade-emissive-strength"),W=m.colorModeForDrapableLayerRenderPass(Z),K=S&&m.terrain?m.terrain.stencilModeForRTTOverlap(R):T[R.overscaledZ];mR(m,R,z,h,F,K,W)}}x.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,s,h,g,x,S){if(m.renderPass!=="translucent"||h.paint.get("raster-opacity")===0)return;const T=m.transform.projection.name==="globe",O=h.paint.get("raster-elevation")!==0,R=O&&T;if(m.renderElevatedRasterBackface&&!R)return;const z=m.context,F=z.gl,Z=s.getSource(),W=function(Ee,Pe,be,ve,ke){const Ne=Pe.paint.get("raster-color"),$e=Ee.type==="raster-array",Je=[],Xe=Pe.paint.get("raster-resampling"),ht=Pe.paint.get("raster-color-mix");let vt=Pe.paint.get("raster-color-range");const We=[ht[0],ht[1],ht[2],0],Re=ht[3];let lt=Xe==="nearest"?ve.NEAREST:ve.LINEAR;if($e&&(Je.push("RASTER_ARRAY"),Ne||Je.push("RASTER_COLOR"),Xe==="linear"&&Je.push("RASTER_ARRAY_LINEAR"),lt=ve.NEAREST,!vt&&Ee.rasterLayers)){const Qe=Ee.rasterLayers.find(({id:bt})=>bt===Pe.sourceLayer);Qe&&Qe.fields&&Qe.fields.range&&(vt=Qe.fields.range)}if(vt=vt||[0,1],Ne){Je.push("RASTER_COLOR"),be.activeTexture.set(ve.TEXTURE2),Pe.updateColorRamp(vt);let Qe=Pe.colorRampTexture;Qe||(Qe=Pe.colorRampTexture=new o.T(be,Pe.colorRamp,ve.RGBA8)),Qe.bind(lt,ve.CLAMP_TO_EDGE)}return ke&&Je.push("USE_MRT1"),{mix:We,range:vt,offset:Re,defines:Je,resampling:lt}}(Z,h,z,F,m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback");if(Z instanceof o.aU&&!g.length&&!T)return;const K=h.paint.get("raster-emissive-strength"),ne=m.colorModeForDrapableLayerRenderPass(K),ee=m.terrain&&m.terrain.renderingToTexture,ie=!m.options.moving,ce=h.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(Z instanceof o.aU&&!g.length&&(Z.onNorthPole||Z.onSouthPole)){const Ee=O?m.stencilModeFor3D():xr.disabled;return void g_(!!Z.onNorthPole,null,m,s,h,K,W,gr.disabled,Ee)}if(!g.length)return;const[ge,pe]=Z instanceof o.aU||ee?[{},g]:m.stencilConfigForOverlap(g),fe=pe[pe.length-1].overscaledZ;R&&W.defines.push("PROJECTION_GLOBE_VIEW"),O&&W.defines.push("RENDER_CUTOFF");const Ie=(Ee,Pe,be)=>{for(const ve of Ee){const ke=ve.toUnwrapped(),Ne=s.getTile(ve);if(ee&&(!Ne||!Ne.hasData()))continue;z.activeTexture.set(F.TEXTURE0);const $e=tA(Ne,Z,h,W);if(!$e||!$e.texture)continue;const{texture:Je,mix:Xe,offset:ht,tileSize:vt,buffer:We}=$e;let Re,lt;ee?(Re=Qt.disabled,lt=ve.projMatrix):O?(Re=new Qt(F.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D),lt=T?Float32Array.from(m.transform.expandedFarZProjMatrix):m.transform.calculateProjMatrix(ke,ie)):(Re=m.depthModeForSublayer(ve.overscaledZ-fe,h.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,F.LESS),lt=m.transform.calculateProjMatrix(ke,ie));const Qe=m.terrain&&ee?m.terrain.stencilModeForRTTOverlap(ve):ge[ve.overscaledZ],bt=S?0:h.paint.get("raster-fade-duration");Ne.registerFadeDuration(bt);const At=s.findLoadedParent(ve,0),Lt=km(Ne,At,s,m.transform,bt);let Pt,It;!Lt.isFading&&Ne.refreshedUponExpiration&&(Ne.refreshedUponExpiration=!1),m.terrain&&m.terrain.prepareDrawTile(),z.activeTexture.set(F.TEXTURE0),Je.bind(ce,F.CLAMP_TO_EDGE),z.activeTexture.set(F.TEXTURE1),At?(At.texture&&At.texture.bind(ce,F.CLAMP_TO_EDGE),Pt=Math.pow(2,At.tileID.overscaledZ-Ne.tileID.overscaledZ),It=[Ne.tileID.canonical.x*Pt%1,Ne.tileID.canonical.y*Pt%1]):Je.bind(ce,F.CLAMP_TO_EDGE),"useMipmap"in Je&&z.extTextureFilterAnisotropic&&m.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Kt=m.transform;let Xt;const Bt=O?eA(Kt):[0,0,0,0];let Zt,or,yr,Lr,Jr,Tr=0;if(R&&Z instanceof o.aU&&Z.coordinates.length>3)Zt=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0)))),or=Float32Array.from(Kt.globeMatrix),yr=Float32Array.from(o.dF(Kt)),Lr=[o.aF(Kt.center.lng),o.aJ(Kt.center.lat)],Xt=Z.elevatedGlobePerspectiveTransform,Jr=Z.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const An=o.dG(ve.canonical);Tr=o.dH(An.getCenter().lat),Zt=Float32Array.from(o.bk(o.dJ(ve.canonical))),or=Float32Array.from(Kt.globeMatrix),yr=Float32Array.from(o.dF(Kt)),Lr=[o.aF(Kt.center.lng),o.aJ(Kt.center.lat)],Xt=[0,0],Jr=Float32Array.from(o.dI(ve.canonical,An,Tr,Kt.worldSize/Kt._pixelsPerMercatorPixel))}else Xt=Z instanceof o.aU?Z.perspectiveTransform:[0,0],Zt=new Float32Array(16),or=new Float32Array(9),yr=new Float32Array(16),Lr=[0,0],Jr=new Float32Array(9);const ln=xb(lt,Zt,or,yr,Jr,It||[0,0],o.aj(m.transform.zoom),Lr,Bt,Pt||1,Lt,h,Xt,O?h.paint.get("raster-elevation"):0,2,Xe,ht,W.range,vt,We,K),Cr=m.isTileAffectedByFog(ve),In=m.getOrCreateProgram("raster",{defines:W.defines,overrideFog:Cr});if(m.uploadCommonUniforms(z,In,ke),Z instanceof o.aU){const An=Z.elevatedGlobeVertexBuffer,kn=Z.elevatedGlobeIndexBuffer;if(ee||!T)Z.boundsBuffer&&Z.boundsSegments&&In.draw(m,F.TRIANGLES,Re,xr.disabled,ne,gr.disabled,ln,h.id,Z.boundsBuffer,m.quadTriangleIndexBuffer,Z.boundsSegments);else if(An&&kn){const en=Kt.zoom<=o.c_?Z.elevatedGlobeSegments:Z.getSegmentsForLongitude(Kt.center.lng);en&&In.draw(m,F.TRIANGLES,Re,xr.disabled,ne,Pe,ln,h.id,An,kn,en)}}else if(R){Re=new Qt(F.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D);const An=m.globeSharedBuffers;if(An){const[kn,en,kr]=An.getGridBuffers(Tr,!1);In.draw(m,F.TRIANGLES,Re,be||Qe,m.colorModeForRenderPass(),Pe,ln,h.id,kn,en,kr)}}else{const{tileBoundsBuffer:An,tileBoundsIndexBuffer:kn,tileBoundsSegments:en}=m.getTileBoundsBuffers(Ne);In.draw(m,F.TRIANGLES,Re,Qe,ne,gr.disabled,ln,h.id,An,kn,en)}}if(!(Z instanceof o.aU)&&R)for(const ve of Ee){const ke=ve.canonical.y===(1<<ve.canonical.z)-1;ve.canonical.y===0&&g_(!0,ve,m,s,h,K,W,Pe,be||xr.disabled),ke&&g_(!1,ve,m,s,h,K,W,Pe===gr.frontCW?gr.backCW:gr.frontCW,be||xr.disabled)}};R?Ie(pe,m.renderElevatedRasterBackface?gr.backCW:gr.frontCW,m.stencilModeFor3D()):Ie(pe,gr.disabled,void 0),m.resetStencilClippingMasks()},"raster-particle":function(m,s,h,g,x,S){m.renderPass==="offscreen"&&function(T,O,R,z){if(!z.length)return;const F=T.context,Z=F.gl,W=O.getSource();if(!(W instanceof qs))return;const K=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let ne=R.particlePositionRGBAImage;if(!ne||ne.width!==K){const pe=function(fe){const Ie=fe*fe,Ee=new Uint8Array(4*Ie),Pe=function(ve){return ve|=0,ve=Math.imul(2747636419^ve,2654435769),ve=Math.imul(ve^ve>>>16,2654435769),((ve=Math.imul(ve^ve>>>16,2654435769))>>>0)/4294967296},be=.9090909090909091;for(let ve=0;ve<Ie;ve++){const ke=be*(Pe(2*ve+0)+If),Ne=be*(Pe(2*ve+1)+If),$e=255*ke%1,Je=255*Ne%1,Xe=$e,ht=Ne-Je/255,vt=Je;Ee[4*ve+0]=255*(ke-$e/255),Ee[4*ve+1]=255*Xe,Ee[4*ve+2]=255*ht,Ee[4*ve+3]=255*vt}return Ee}(K);ne=R.particlePositionRGBAImage=new o.q({width:K,height:K},pe)}let ee=R.particleFramebuffer;ee?ee.width!==K&&(ee.destroy(),ee=R.particleFramebuffer=F.createFramebuffer(K,K,1,null)):ee=R.particleFramebuffer=F.createFramebuffer(K,K,1,null);const ie=[];for(const pe of z){const fe=O.getTile(pe);if(!(fe instanceof Ry))continue;const Ie=Pb(fe,W,R);if(!Ie)continue;const Ee=[fe.tileSize,fe.tileSize];let Pe=R.tileFramebuffer;Pe||(Pe=R.tileFramebuffer=F.createFramebuffer(Ee[0],Ee[1],1,null));let be=fe.rasterParticleState;be||(be=fe.rasterParticleState=new rA(F,pe,Ee,ne));const ve=be.update(R.lastInvalidatedAt);be.particleTextureDimension!==K&&be.updateParticleTexture(pe,ne);const ke=be.targetColorTexture;be.targetColorTexture=be.backgroundColorTexture,be.backgroundColorTexture=ke;const Ne=be.particleTexture0;be.particleTexture0=be.particleTexture1,be.particleTexture1=Ne,ie.push([pe,Ie,be,ve])}if(ie.length===0)return;const ce=o.o.now(),ge=R.previousDrawTimestamp?.001*(ce-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=ce,R.hasColorMap()){F.activeTexture.set(Z.TEXTURE0+2);let pe=R.colorRampTexture;pe||(pe=R.colorRampTexture=new o.T(F,R.colorRamp,Z.RGBA8)),pe.bind(Z.LINEAR,Z.CLAMP_TO_EDGE)}F.bindFramebuffer.set(R.tileFramebuffer.framebuffer),function(pe,fe,Ie){const Ee=pe.context,Pe=Ee.gl,be=fe.tileFramebuffer;Ee.activeTexture.set(Pe.TEXTURE0);const ve={u_texture:0,u_opacity:1.05*(Ne=fe.paint.get("raster-particle-fade-opacity-factor"))/(Ne+.05)},ke=pe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ne;for(const $e of Ie){const[,,Je,Xe]=$e;be.colorAttachment0.set(Je.targetColorTexture.texture),Ee.viewport.set([0,0,be.width,be.height]),Ee.clear({color:o.ao.transparent}),Xe&&(Je.backgroundColorTexture.bind(Pe.NEAREST,Pe.CLAMP_TO_EDGE),ke.draw(pe,Pe.TRIANGLES,Qt.disabled,xr.disabled,Er.alphaBlended,gr.disabled,ve,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments))}}(T,R,ie),function(pe,fe,Ie,Ee){const Pe=pe.context,be=Pe.gl,ve=Ie.tileFramebuffer,ke=pe.transform.projection.name==="globe",Ne=Ie.paint.get("raster-particle-max-speed");for(const $e of Ee){const[Je,Xe,ht]=$e;Pe.activeTexture.set(be.TEXTURE0+0),Xe.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),ve.colorAttachment0.set(ht.targetColorTexture.texture);const vt=pe.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});Pe.activeTexture.set(be.TEXTURE0+1);const We=Xe.scalarData?[]:[0,1,2,3].map(Qe=>o.e9[Qe](Je));We.push(Je);const Re=Je.canonical.x,lt=Je.canonical.y;for(const Qe of We){const bt=fe.getTile(ke?Qe.wrapped():Qe);if(!bt)continue;const At=bt.rasterParticleState;if(!At)continue;const Lt=Qe.canonical.x+(1<<Qe.canonical.z)*(Qe.wrap-Je.wrap),Pt=Qe.canonical.y;At.particleTexture0.bind(be.NEAREST,be.CLAMP_TO_EDGE);const It=HE(1,At.particleTexture0.size[0],[Lt-Re,Pt-lt],0,Xe.texture.size,2,Ne,Xe.textureOffset,Xe.scale,Xe.offset);vt.draw(pe,be.POINTS,Qt.disabled,xr.disabled,Er.alphaBlended,gr.disabled,It,Ie.id,At.particleIndexBuffer,void 0,At.particleSegment)}}}(T,O,R,ie),F.bindFramebuffer.set(R.particleFramebuffer.framebuffer),function(pe,fe,Ie,Ee){const Pe=pe.context,be=Pe.gl,ve=fe.paint.get("raster-particle-max-speed"),ke=Ee*fe.paint.get("raster-particle-speed-factor")*.15,Ne=function(Je){return Math.pow(Je,6)}(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),$e=fe.particleFramebuffer;Pe.viewport.set([0,0,$e.width,$e.height]);for(const Je of Ie){const[,Xe,ht]=Je;Pe.activeTexture.set(be.TEXTURE0+0),Xe.texture.bind(be.LINEAR,be.CLAMP_TO_EDGE),Pe.activeTexture.set(be.TEXTURE0+1);const vt=ht.particleTexture0;vt.bind(be.NEAREST,be.CLAMP_TO_EDGE);const We=ER(1,vt.size[0],0,Xe.texture.size,ve,ke,Ne,Xe.textureOffset,Xe.scale,Xe.offset);$e.colorAttachment0.set(ht.particleTexture1.texture),Pe.clear({color:o.ao.transparent}),pe.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(pe,be.TRIANGLES,Qt.disabled,xr.disabled,Er.unblended,gr.disabled,We,fe.id,pe.viewportBuffer,pe.quadTriangleIndexBuffer,pe.viewportSegments)}}(T,R,ie,ge)}(m,s,h,g),m.renderPass==="translucent"&&(function(T,O,R,z){const F=T.context,Z=F.gl,W=O.getSource().tileSize,K=5*(1-o.ah(o.cL,o.cL+1,T.transform.zoom))*W+R.paint.get("raster-particle-elevation"),ne=!T.options.moving,ee=T.transform.projection.name==="globe";if(!z.length)return;const[ie,ce]=T.stencilConfigForOverlap(z),ge=[];ee&&ge.push("PROJECTION_GLOBE_VIEW");const pe=T.stencilModeFor3D();for(const fe of ce){const Ie=fe.toUnwrapped(),Ee=O.getTile(fe);if(!Ee.rasterParticleState)continue;const Pe=Ee.rasterParticleState,be=100;Ee.registerFadeDuration(be);const ve=O.findLoadedParent(fe,0),ke=km(Ee,ve,O,T.transform,be);let Ne,$e;T.terrain&&T.terrain.prepareDrawTile(),F.activeTexture.set(Z.TEXTURE0),Pe.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),F.activeTexture.set(Z.TEXTURE1),ve&&ve.rasterParticleState?(ve.rasterParticleState.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Ne=Math.pow(2,ve.tileID.overscaledZ-Ee.tileID.overscaledZ),$e=[Ee.tileID.canonical.x*Ne%1,Ee.tileID.canonical.y*Ne%1]):Pe.targetColorTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Je=ee?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(Ie,ne),Xe=T.transform,ht=nA(Xe),vt=o.dG(fe.canonical),We=o.dH(vt.getCenter().lat);let Re,lt,Qe,bt,At;ee?(Re=Float32Array.from(o.bk(o.dJ(fe.canonical))),lt=Float32Array.from(Xe.globeMatrix),Qe=Float32Array.from(o.dF(Xe)),bt=[o.aF(Xe.center.lng),o.aJ(Xe.center.lat)],At=Float32Array.from(o.dI(fe.canonical,vt,We,Xe.worldSize/Xe._pixelsPerMercatorPixel))):(Re=new Float32Array(16),lt=new Float32Array(9),Qe=new Float32Array(16),bt=[0,0],At=new Float32Array(9));const Lt=TR(Je,Re,lt,Qe,At,$e||[0,0],o.aj(T.transform.zoom),bt,ht,Ne||1,ke,K),Pt=T.isTileAffectedByFog(fe),It=T.getOrCreateProgram("rasterParticle",{defines:ge,overrideFog:Pt});if(T.uploadCommonUniforms(F,It,Ie),ee){const Kt=new Qt(Z.LEQUAL,Qt.ReadOnly,T.depthRangeFor3D),Xt=0,Bt=T.globeSharedBuffers;if(Bt){const[Zt,or,yr]=Bt.getGridBuffers(We,Xt!==0);It.draw(T,Z.TRIANGLES,Kt,pe,Er.alphaBlended,T.renderElevatedRasterBackface?gr.frontCCW:gr.backCCW,Lt,R.id,Zt,or,yr)}}else{const Kt=T.depthModeForSublayer(0,Qt.ReadOnly),Xt=ie[fe.overscaledZ],{tileBoundsBuffer:Bt,tileBoundsIndexBuffer:Zt,tileBoundsSegments:or}=T.getTileBoundsBuffers(Ee);It.draw(T,Z.TRIANGLES,Kt,Xt,Er.alphaBlended,gr.disabled,Lt,R.id,Bt,Zt,or)}}T.resetStencilClippingMasks()}(m,s,h,g),m.style.map.triggerRepaint())},background:function(m,s,h,g){const x=h.paint.get("background-color"),S=h.paint.get("background-color-use-theme").constantOr("default")==="none",T=h.paint.get("background-opacity"),O=h.paint.get("background-emissive-strength"),R=h.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const z=m.context,F=z.gl,Z=m.transform,W=Z.tileSize,K=h.paint.get("background-pattern");let ne;if(K!==void 0&&(K===null||(ne=m.imageManager.getPattern(o.I.from(K.toString()),h.scope,m.style.getLut(h.scope)),!ne)))return;const ee=!K&&x.a===1&&T===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==ee)return;const ie=xr.disabled,ce=m.depthModeForSublayer(0,ee==="opaque"?Qt.ReadWrite:Qt.ReadOnly),ge=m.colorModeForDrapableLayerRenderPass(O),pe=K?"backgroundPattern":"background";let fe,Ie=g;Ie||(fe=m.getBackgroundTiles(),Ie=Object.values(fe).map(Pe=>Pe.tileID)),K&&(z.activeTexture.set(F.TEXTURE0),m.imageManager.bind(m.context,h.scope));const Ee=[];if(m.terrain&&m.terrain.renderingToTexture&&m.emissiveMode==="mrt-fallback"&&Ee.push("USE_MRT1"),R){const Pe=m.getOrCreateProgram(pe,{overrideFog:!1,overrideRtt:!0,defines:Ee}),be=new Float32Array(o.bA([])),ve=new o.aQ(0,0,0,0,0),ke=K?Dm(be,O,T,m,0,h.scope,ne,R,{tileID:ve,tileSize:W}):ld(be,O,T,x.toPremultipliedRenderColor(S?null:h.lut));return void Pe.draw(m,F.TRIANGLES,ce,ie,ge,gr.disabled,ke,h.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments)}for(const Pe of Ie){const be=m.isTileAffectedByFog(Pe),ve=m.getOrCreateProgram(pe,{overrideFog:be,defines:Ee}),ke=Pe.toUnwrapped(),Ne=g?Pe.projMatrix:m.transform.calculateProjMatrix(ke);m.prepareDrawTile();const $e=s?s.getTile(Pe):fe?fe[Pe.key]:new Yu(Pe,W,Z.zoom,m),Je=K?Dm(Ne,O,T,m,0,h.scope,ne,R,{tileID:Pe,tileSize:W}):ld(Ne,O,T,x.toPremultipliedRenderColor(S?null:h.lut));m.uploadCommonUniforms(z,ve,ke);const{tileBoundsBuffer:Xe,tileBoundsIndexBuffer:ht,tileBoundsSegments:vt}=m.getTileBoundsBuffers($e);ve.draw(m,F.TRIANGLES,ce,ie,ge,gr.disabled,Je,h.id,Xe,ht,vt)}},sky:function(m,s,h){const g=m._atmosphere?o.aj(m.transform.zoom):1,x=h.paint.get("sky-opacity")*g;if(x===0)return;const S=m.context,T=h.paint.get("sky-type"),O=new Qt(S.gl.LEQUAL,Qt.ReadOnly,[0,1]),R=m.frameCounter/1e3%1;T==="atmosphere"?m.renderPass==="offscreen"?h.needsSkyboxCapture(m)&&(function(z,F){const Z=z.context,W=Z.gl;let K=F.skyboxFbo;if(!K){K=F.skyboxFbo=Z.createFramebuffer(32,32,1,null),F.skyboxGeometry=new ma(Z),F.skyboxTexture=Z.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,F.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let ce=0;ce<6;++ce)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(K.framebuffer),Z.viewport.set([0,0,32,32]);const ne=F.getCenter(z,!0),ee=z.getOrCreateProgram("skyboxCapture"),ie=new Float64Array(16);o.bA(ie),o.en(ie,ie,.5*-Math.PI),dd(z,F,ee,ie,ne,0),o.bA(ie),o.en(ie,ie,.5*Math.PI),dd(z,F,ee,ie,ne,1),o.bA(ie),o.cU(ie,ie,.5*-Math.PI),dd(z,F,ee,ie,ne,2),o.bA(ie),o.cU(ie,ie,.5*Math.PI),dd(z,F,ee,ie,ne,3),o.bA(ie),dd(z,F,ee,ie,ne,4),o.bA(ie),o.en(ie,ie,Math.PI),dd(z,F,ee,ie,ne,5),Z.viewport.set([0,0,z.width,z.height])}(m,h),h.markSkyboxValid(m)):m.renderPass==="sky"&&function(z,F,Z,W,K){const ne=z.context,ee=ne.gl,ie=z.transform,ce=z.getOrCreateProgram("skybox");ne.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,F.skyboxTexture);const ge=((pe,fe,Ie,Ee,Pe)=>({u_matrix:pe,u_sun_direction:fe,u_cubemap:0,u_opacity:Ee,u_temporal_offset:Pe}))(ie.skyboxMatrix,F.getCenter(z,!1),0,W,K);z.uploadCommonUniforms(ne,ce),ce.draw(z,ee.TRIANGLES,Z,xr.disabled,z.colorModeForRenderPass(),gr.backCW,ge,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,h,O,x,R):T==="gradient"&&m.renderPass==="sky"&&function(z,F,Z,W,K){const ne=z.context,ee=ne.gl,ie=z.transform,ce=z.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new ma(ne)),ne.activeTexture.set(ee.TEXTURE0);let ge=F.colorRampTexture;ge||(ge=F.colorRampTexture=new o.T(ne,F.colorRamp,ee.RGBA8)),ge.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const pe=((fe,Ie,Ee,Pe,be)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:Ie,u_radius:o.an(Ee),u_opacity:Pe,u_temporal_offset:be}))(ie.skyboxMatrix,F.getCenter(z,!1),F.paint.get("sky-gradient-radius"),W,K);z.uploadCommonUniforms(ne,ce),ce.draw(z,ee.TRIANGLES,Z,xr.disabled,z.colorModeForRenderPass(),gr.backCW,pe,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(m,h,O,x,R)},custom:function(m,s,h,g){const x=m.context,S=h.implementation;if(!m.transform.projection.unsupportedLayers||!m.transform.projection.unsupportedLayers.includes("custom")||m.terrain&&(m.terrain.renderingToTexture||m.renderPass==="offscreen")&&h.isDraped(s)){if(m.renderPass==="offscreen"){const T=S.prerender;if(T){if(m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),m.transform.projection.name==="globe"){const O=m.transform.pointMerc;T.call(S,x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.aj(m.transform.zoom),[O.x,O.y],m.transform.pixelsPerMeterRatio)}else T.call(S,x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState()}}else if(m.renderPass==="translucent"){if(m.terrain&&m.terrain.renderingToTexture){const O=S.renderToTile;if(O){const R=g[0].canonical,z={x:R.x+g[0].wrap*(S.wrapTileId?0:1<<R.z),y:R.y,z:R.z};x.setDepthMode(Qt.disabled),x.setStencilMode(xr.disabled),x.setColorMode(m.colorModeForRenderPass()),m.setCustomLayerDefaults(),O.call(S,x.gl,z),x.setDirty(),m.setBaseState()}return}m.setCustomLayerDefaults(),x.setColorMode(m.colorModeForRenderPass()),x.setStencilMode(xr.disabled);const T=S.renderingMode==="3d"?new Qt(m.context.gl.LEQUAL,Qt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,Qt.ReadOnly);if(x.setDepthMode(T),m.transform.projection.name==="globe"){const O=m.transform.pointMerc;S.render(x.gl,m.transform.customLayerMatrix(),m.transform.getProjection(),m.transform.globeToMercatorMatrix(),o.aj(m.transform.zoom),[O.x,O.y],m.transform.pixelsPerMeterRatio)}else S.render(x.gl,m.transform.customLayerMatrix());x.setDirty(),m.setBaseState(),x.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(m,s,h,g){if(m.renderPass==="opaque")return;const x=h.paint.get("model-opacity").constantOr(1),S=h.paint.get("model-elevation-reference"),T=S==="ground",O=S==="ground";if(x===0)return;const R=h.paint.get("model-cast-shadows");if(m.renderPass==="shadow"&&(!R||m.terrain&&x<.65&&h._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const z=m.shadowRenderer,F=h.paint.get("model-receive-shadows");z&&(z.useNormalOffset=!0,F||(z.enabled=!1));const Z=()=>{z&&(z.useNormalOffset=!0,F||(z.enabled=!0))},W=s.getSource();if(m.renderPass==="light-beam"&&W.type!=="batched-model")return;if(W.type==="vector"||W.type==="geojson")return function(fe,Ie,Ee,Pe,be){const ve=fe.transform,ke=ve.projection.name==="globe",Ne=ve.getFreeCameraOptions().position;if(!fe.modelManager)return;const $e=fe.modelManager;Ee.modelManager=$e;const Je=fe.shadowRenderer;if(!Ee._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Xe=Ee._unevaluatedLayout._values["model-id"],ht=Object.assign({},Ee.layout.get("model-id").parameters),vt=fe.style.order.indexOf(Ee.fqid),We=Ee.paint.get("model-opacity").constantOr(1);for(const Re of Pe){const lt=Ie.getTile(Re).getBucket(Ee);if(!lt||lt.projection.name!==ve.projection.name)continue;const Qe=lt.getModelUris();if(Qe&&!lt.modelsRequested&&($e.addModelsFromBucket(Qe,be),lt.modelsRequested=!0),ke)ht.zoom=Re.overscaledZ;else{const Bt=Ct(Re,ve);ht.zoom=Bt}const bt=Xe.possiblyEvaluate(ht);if(ch(fe,lt,Re),Xs.shadowUniformsInitialized=!1,Xs.useSingleShadowCascade=!!Je&&Je.getMaxCascadeForTile(Re.toUnwrapped())===0,fe.renderPass==="shadow"&&Je){if(fe.currentShadowCascade===1&&lt.isInsideFirstShadowMapFrustum)continue;const Bt=ve.calculatePosMatrix(Re.toUnwrapped(),ve.worldSize);if(Xs.tileMatrix.set(Bt),Xs.shadowTileMatrix=Float32Array.from(Je.calculateShadowPassMatrixFromMatrix(Bt)),Xs.aabb.min=[0,0,0],Xs.aabb.max[0]=Xs.aabb.max[1]=o.al,Xs.aabb.max[2]=0,bi(lt,Xs,fe,Ee.scope))continue}const At=1<<Re.canonical.z,Lt=[((Ne.x-Re.wrap)*At-Re.canonical.x)*o.al,(Ne.y*At-Re.canonical.y)*o.al,Ne.z*At*o.al];fe.conflationActive&&Object.keys(lt.instancesPerModel).length>0&&fe.style.isLayerClipped(Ee,Ie.getSource())&&lt.updateReplacement(Re,fe.replacementSource,vt,Ee.scope)&&(lt.uploaded=!1,lt.upload(fe.context));let Pt=0;const It=new Array,Kt=new Array,Xt=new Array;for(let Bt in lt.instancesPerModel){const Zt=lt.instancesPerModel[Bt];Zt.features.length>0&&!ke&&(Bt=bt.evaluate(Zt.features[0].feature,{}));const or=$e.getModel(Bt,be);if(or||$e.hasURLBeenRequested(Bt)||lt.modelUris.includes(Bt)||(lt.modelUris.push(Bt),lt.modelsRequested=!1),or&&or.uploaded)if(ke){const yr=o.c5([],[Ne.x,Ne.y,Ne.z],fe.transform.worldSize);o.ew(yr,yr);for(let Lr=0;Lr<Zt.instancedDataArray.length;++Lr){const Jr=[0,0,0],Tr=[1,1,1],ln=o.ex(),Cr=Zt.tileCoordinatesForInstance(Lr),In=Zt.transformForInstance(Lr);o.ey(Tr,In),o.ez(ln,In),o.eA(Jr,ln);const An=Zt.translationForInstance(Lr),kn=new o.aT(0,0);o.eB(lt.canonical,kn,Cr.x,Cr.y);const en=o.bC();o.eC(en,or,fe.transform,kn,Jr,Tr,An,!0,!1,!1);const kr=Zt.colorForInstance(Lr),yn=o.bA([]),hi=o.ef(kn.lat,fe.transform.zoom),fi=o.bq([],[1,1,1/hi]);o.br(yn,yn,yr),Xt.push({zScaleMatrix:fi,negCameraPosMatrix:yn});for(const _n of or.nodes)zm(fe,_n,en,fe.transform.expandedFarZProjMatrix,Pt,It,Kt,or.materialOverrides,We,kr);++Pt}}else for(const yr of or.nodes)zt(fe,Ee,yr,Zt,Lt,Re,Xs)}if(ke)if(fe.renderPass==="shadow"){for(const Bt of Kt)Mf(Bt.mesh,Bt.nodeModelMatrix,fe,Ee);for(const Bt of It)Mf(Bt.mesh,Bt.nodeModelMatrix,fe,Ee)}else jb(fe,Ee,It,Kt,Xt)}}(m,s,h,g,Nm(m,h)),void Z();if(!W.loaded())return;if(W.type==="batched-model")return function(fe,Ie,Ee,Pe){Ee.resetLayerRenderingStats(fe);const be=fe.context,ve=fe.transform,ke=fe.style.fog,Ne=fe.shadowRenderer;if(ve.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ve.projection.name} projection is not yet implemented`);const $e=fe.transform.getFreeCameraOptions().position,Je=o.c5([],[$e.x,$e.y,$e.z],fe.transform.worldSize),Xe=o.ew([],Je),ht=o.bA([]),vt=o.ef(ve.center.lat,ve.zoom),We=o.bq([],[1,1,1/vt]);o.br(ht,ht,Xe);const Re=Ee.paint.get("model-opacity").constantOr(1),lt=new Qt(be.gl.LEQUAL,Qt.ReadWrite,fe.depthRangeFor3D),Qe=new Qt(be.gl.LEQUAL,Qt.ReadOnly,fe.depthRangeFor3D),bt=new o.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),At=fe.renderPass==="shadow",Lt=At&&Ne?Ne.getCurrentCascadeFrustum():ve.getFrustum(ve.scaleZoom(ve.worldSize)),Pt=Ee.paint.get("model-front-cutoff"),It=Pt[2]<1,Kt=Pl(fe,Ee.paint.get("model-cutoff-fade-range")),Xt=Ee.getLayerRenderingStats();(function(Bt,Zt,or,yr){const Lr=Bt.terrain?Bt.terrain.exaggeration():0,Jr=Bt.transform.zoom;for(const Tr of yr){const ln=Zt.getTile(Tr).getBucket(or);ln&&(ln.setFilter(or.filter),Bt.conflationActive&&ln.updateReplacement(Tr,Bt.replacementSource),ln.evaluateTransform(Bt,or),Bt.terrain&&Lr>0&&ln.elevationUpdate(Bt.terrain,Lr,Tr,or.source),ln.needsReEvaluation(Bt,Jr,or)&&ln.evaluate(or))}})(fe,Ie,Ee,Pe),function(){let Bt,Zt,or;It?(Bt=Pe.length-1,Zt=-1,or=-1):(Bt=0,Zt=Pe.length,or=1);const yr=new Float64Array(16),Lr=o.cA(),Jr=new o.P(0,0);for(let Tr=Bt;Tr!==Zt;Tr+=or){const ln=Pe[Tr],Cr=Ie.getTile(ln).getBucket(Ee);if(!Cr||!Cr.uploaded)continue;let In=!1;Ne&&(In=Ne.getMaxCascadeForTile(ln.toUnwrapped())===0);const An=ve.calculatePosMatrix(ln.toUnwrapped(),ve.worldSize),kn=Cr.modelTraits;!At&&It&&(o.bl(yr,An),o.af(Lr,Je,yr),Jr.x=Lr[0],Jr.y=Lr[1]);const en=[];Cr.setFilter(Ee.filter);for(const kr of Cr.getNodesInfo()){if(kr.hiddenByReplacement||!kr.node.meshes)continue;const yn=kr.node;let hi=0;fe.terrain&&yn.elevation&&(hi=yn.elevation*fe.terrain.exaggeration());const fi=(()=>{const vn=kr.aabb;return bt.min=[...vn.min],bt.max=[...vn.max],bt.min[2]+=hi,bt.max[2]+=hi,o.af(bt.min,bt.min,An),o.af(bt.max,bt.max,An),bt})(),_n=kr.evaluatedScale;if(_n[0]<=1&&_n[1]<=1&&_n[2]<=1&&fi.intersects(Lt)===0)continue;if(!At&&It){const vn=.16666666666666666;kr.cameraCollisionOpacity=Je[0]>fi.min[0]&&Je[0]<fi.max[0]&&Je[1]>fi.min[1]&&Je[1]<fi.max[1]&&Je[2]*vt<fi.max[2]&&yn.footprint&&o.c0(Jr,yn.footprint)?Math.max(kr.cameraCollisionOpacity-vn,0):Math.min(1,kr.cameraCollisionOpacity+vn)}const qr=[...An],Rr=1/o.d7(ln.canonical),Zn=yn.anchor?yn.anchor[0]:0,wi=yn.anchor?yn.anchor[1]:0;o.br(qr,qr,[Zn*(_n[0]-1)+kr.evaluatedTranslation[0]*Rr,wi*(_n[1]-1)+kr.evaluatedTranslation[1]*Rr,hi+kr.evaluatedTranslation[2]]),o.cq(_n,o.eE)||o.cS(qr,qr,_n);const Jn=o.aB([],qr,yn.globalMatrix),ri=o.aB([],ve.expandedFarZProjMatrix,Jn),Ys=o.aB([],ve.expandedFarZProjMatrix,qr),ga=o.aC([],[Zn,wi,hi,1],ri)[2];yn.hidden=!1;let Do=Re;At||(It&&(Do*=kr.cameraCollisionOpacity,Do*=uA(qr,ve,kr.aabb,Pt)),Do*=Ue(Kt,ga)),Do!==0?en.push({nodeInfo:kr,depth:ga,opacity:Do,wvpForNode:ri,wvpForTile:Ys,nodeModelMatrix:Jn,tileModelMatrix:qr}):yn.hidden=!0}At||en.sort((kr,yn)=>!It||kr.opacity===1&&yn.opacity===1?kr.depth<yn.depth?-1:1:kr.opacity===1?-1:yn.opacity===1?1:kr.depth>yn.depth?-1:1);for(const kr of en){const yn=kr.nodeInfo,hi=yn.node;let fi=o.aB([],We,kr.tileModelMatrix);o.aB(fi,ht,fi);const _n=o.bl([],fi);o.eg(_n,_n),o.cS(_n,_n,Df),fi=o.aB(fi,fi,hi.globalMatrix);const qr=fe.renderPass==="light-beam",Rr=Ee.paint.get("model-color-use-theme").constantOr("default")==="none",Zn=kn&o.eI.HasMapboxMeshFeatures,wi=Zn?0:yn.evaluatedRMEA[0][2];for(let Jn=0;Jn<hi.meshes.length;++Jn){const ri=hi.meshes[Jn],Ys=Jn===hi.lightMeshIndex;let ga=kr.wvpForNode;if(Ys){if(!qr&&!fe.terrain&&fe.shadowRenderer){fe.currentLayer<fe.firstLightBeamLayer&&(fe.firstLightBeamLayer=fe.currentLayer);continue}ga=kr.wvpForTile}else if(qr)continue;const Do={defines:[]},vn=[];if(!At&&Ne&&(Ne.useNormalOffset=!!ri.normalBuffer),Hl(Do.defines,vn,ri,fe,Rr?null:Ee.lut),Zn||Do.defines.push("DIFFUSE_SHADED"),In&&Do.defines.push("SHADOWS_SINGLE_CASCADE"),Xt&&(At?Xt.numRenderedVerticesInShadowPass+=ri.vertexArray.length:Xt.numRenderedVerticesInTransparentPass+=ri.vertexArray.length),At){Mf(ri,kr.nodeModelMatrix,fe,Ee);continue}let Oa=null;if(ke){const Fi=Lb(kr.nodeModelMatrix,fe.transform);if(Oa=new Float32Array(Fi),ve.projection.name!=="globe"){const Qn=ri.aabb.min,eo=ri.aabb.max,[gs,Mi]=ke.getOpacityForBounds(Fi,Qn[0],Qn[1],eo[0],eo[1]);Do.overrideFog=gs>=qt||Mi>=qt}}const cs=ri.material;let ya;cs.occlusionTexture&&cs.occlusionTexture.offsetScale&&(ya=cs.occlusionTexture.offsetScale,Do.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ol=fe.getOrCreateProgram("model",Do);!At&&Ne&&Ne.setupShadowsFromMatrix(kr.tileModelMatrix,Ol,Ne.useNormalOffset),fe.uploadCommonUniforms(be,Ol,null,Oa);const Js=cs.pbrMetallicRoughness;Js.metallicFactor=.9,Js.roughnessFactor=.5;const mi=u_(new Float32Array(ga),new Float32Array(fi),new Float32Array(_n),new Float32Array(hi.globalMatrix),fe,kr.opacity,Js.baseColorFactor,cs.emissiveFactor,Js.metallicFactor,Js.roughnessFactor,cs,wi,Ee,[0,0,0],ya);!Ys&&(yn.hasTranslucentParts||kr.opacity<1)&&Ol.draw(fe,be.gl.TRIANGLES,lt,xr.disabled,Er.disabled,gr.backCCW,mi,Ee.id,ri.vertexBuffer,ri.indexBuffer,ri.segments,Ee.paint,fe.transform.zoom,void 0,vn),Ol.draw(fe,be.gl.TRIANGLES,Ys?Qe:lt,xr.disabled,Ys||kr.opacity<1||yn.hasTranslucentParts?Er.alphaBlended:Er.unblended,gr.backCCW,mi,Ee.id,ri.vertexBuffer,ri.indexBuffer,ri.segments,Ee.paint,fe.transform.zoom,void 0,vn)}}}}()}(m,s,h,g),void Z();if(W.type!=="model")return;const K=W.getModels(),ne=[],ee=m.transform.getFreeCameraOptions().position,ie=o.c5([],[ee.x,ee.y,ee.z],m.transform.worldSize);o.ew(ie,ie);const ce=[],ge=[];let pe=0;for(const fe of K){const Ie=s.getFeatureState("",fe.id),Ee={type:"Unknown",id:fe.id,properties:fe.featureProperties},Pe=h.paint.get("model-rotation").evaluate(Ee,Ie),be=h.paint.get("model-scale").evaluate(Ee,Ie),ve=h.paint.get("model-translation").evaluate(Ee,Ie),ke=h.paint.get("model-opacity").evaluate(Ee,Ie);lA(h,fe.id,Ie,fe.featureProperties,fe.nodeOverrideNames,fe.nodeOverrides),cA(h,fe.id,Ie,fe.featureProperties,fe.materialOverrideNames,fe.materialOverrides),fe.nodeOverrides.size>0&&fe.computeBoundsAndApplyParent(),fe.computeModelMatrix(m,Pe,be,ve,O,T,!1);const Ne=o.bA([]),$e=o.ef(fe.position.lat,m.transform.zoom),Je=o.bq([],[1,1,1/$e]);o.br(Ne,Ne,ie),ne.push({zScaleMatrix:Je,negCameraPosMatrix:Ne});for(const Xe of fe.nodes)zm(m,Xe,fe.matrix,m.transform.expandedFarZProjMatrix,pe,ce,ge,fe.materialOverrides,ke);pe++}if(ce.sort((fe,Ie)=>Ie.depth-fe.depth),m.renderPass!=="shadow")jb(m,h,ce,ge,ne),Z();else{for(const fe of ge)Mf(fe.mesh,fe.nodeModelMatrix,m,h);for(const fe of ce)Mf(fe.mesh,fe.nodeModelMatrix,m,h);Z()}}},Vb={line:function(m,s,h){if(m.hasElevatedBuckets=!1,m.hasNonElevatedBuckets=!1,m._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||m._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const g=s.getVisibleCoordinates();for(const x of g){const S=s.getTile(x).getBucket(m);if(S&&(S.elevationType!=="none"?m.hasElevatedBuckets=!0:m.hasNonElevatedBuckets=!0,m.hasElevatedBuckets&&m.hasNonElevatedBuckets))break}}}else m.hasNonElevatedBuckets=!0},model:function(m,s,h){const g=s.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(h.modelManager&&h.modelManager.upload(h,Nm(h,m)));if(g.type==="batched-model"||g.type!=="model")return;const x=g.getModels();for(const S of x)S.upload(h.context)},raster:function(m,s,h){const g=s.getSource();if(!(g instanceof qs&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const S=m.paint.get("raster-array-band")||g.getInitialBand(x);if(S==null)return;const T=s.getIds().map(O=>s.getTileByID(O));for(const O of T)O.updateNeeded(m.id,S)&&g.prepareTile(O,x,m.id,S)},"raster-particle":function(m,s,h){const g=s.getSource();if(!(g instanceof qs&&g.loaded()))return;const x=m.sourceLayer||g.rasterLayerIds&&g.rasterLayerIds[0];if(!x)return;const S=m.paint.get("raster-particle-array-band")||g.getInitialBand(x);if(S==null)return;const T=s.getIds().map(O=>s.getTileByID(O));for(const O of T)O.updateNeeded(m.id,S)&&g.prepareTile(O,x,m.id,S)}},Ub={fill:Sb},fA={fill:function(m,s,h,g){if(!h.layout||h.layout.get("fill-elevation-reference")==="none"||h.paint.get("fill-opacity").constantOr(1)===0)return;const x=m.context.gl,S=new Qt(x.LEQUAL,Qt.ReadOnly,m.depthRangeFor3D),T=new xr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),O=m.transform.getFreeCameraOptions().position,R=m.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of g){const F=s.getTile(z),Z=F.getBucket(h);if(!Z)continue;const W=Z.elevatedStructures;if(!W||W.depthSegments.segments[0].primitiveLength===0)continue;const K=wb(z.toUnwrapped(),O),ne=m.translatePosMatrix(z.projMatrix,F,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor")),ee=sh(ne,K,0,1,0);R.draw(m,x.TRIANGLES,S,T,Er.disabled,gr.disabled,ee,h.id,W.vertexBuffer,W.indexBuffer,W.depthSegments,h.paint,m.transform.zoom)}}};class pA{constructor(s,h,g,x,S){this.context=new h_(s,h),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const T=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of T)this._debugParams.enabledLayers[R]=!0;for(const R of T);this.occlusionParams=new zb,this.setup(),this.numSublayers=ca.maxUnderzooming+ca.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new wm(this),this._wireframeDebugCache=new Nb,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const O=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,O,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=S,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(s,h){const g=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fb(this,s));const x=this._terrain;this.transform.elevation=g?x:null,x.update(s,this.transform,h),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(s){const h=s.fog;if(!h||this.transform.projection.name==="globe"||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,x]=h.getFovAdjustedRange(this.transform._fov);if(g>x)return void(this.transform.fogCullDistSq=null);const S=g+.78*(x-g);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new fb(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,h){if(this.width=s*o.o.devicePixelRatio,this.height=h*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._mergedLayers[g].resize()}setup(){const s=this.context,h=new o.bd;h.emplaceBack(0,0),h.emplaceBack(o.al,0),h.emplaceBack(0,o.al),h.emplaceBack(o.al,o.al),this.tileExtentBuffer=s.createVertexBuffer(h,o.bf.members),this.tileExtentSegments=o.bg.simpleSegment(0,0,4,2);const g=new o.bd;g.emplaceBack(0,0),g.emplaceBack(o.al,0),g.emplaceBack(0,o.al),g.emplaceBack(o.al,o.al),this.debugBuffer=s.createVertexBuffer(g,o.bf.members),this.debugSegments=o.bg.simpleSegment(0,0,4,5);const x=new o.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,o.bf.members),this.viewportSegments=o.bg.simpleSegment(0,0,4,2);const S=new o.b1;S.emplaceBack(0,0,0,0),S.emplaceBack(o.al,0,o.al,0),S.emplaceBack(0,o.al,0,o.al),S.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=s.createVertexBuffer(S,o.bi.members),this.mercatorBoundsSegments=o.bg.simpleSegment(0,0,4,2);const T=new o.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);const O=new o.be;for(const z of[0,1,3,2,0])O.emplaceBack(z);this.debugIndexBuffer=s.createIndexBuffer(O),this.emptyTexture=new o.T(s,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=o.bC();const R=this.context.gl;this.stencilClearMode=new xr({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Qt.disabled,this.stencilClearMode,Er.disabled,gr.disabled,Om(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,h,g){if(!h||this.currentStencilSource===h.id||!s.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let O=!1;for(const R of g)if(this._tileClippingMaskIDs[R.key]===void 0){O=!0;break}if(!O)return}this.currentStencilSource=h.id;const x=this.context,S=x.gl;this.nextStencilID+g.length>256&&this.clearStencil(),x.setColorMode(Er.disabled),x.setDepthMode(Qt.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const O of g){const R=h.getTile(O),z=this._tileClippingMaskIDs[O.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:Z,tileBoundsSegments:W}=this.getTileBoundsBuffers(R);T.draw(this,S.TRIANGLES,Qt.disabled,new xr({func:S.ALWAYS,mask:0},z,255,S.KEEP,S.KEEP,S.REPLACE),Er.disabled,gr.disabled,Om(O.projMatrix),"$clipping",F,Z,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new xr({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const h=this.context.gl;return new xr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,g=s.sort((T,O)=>O.overscaledZ-T.overscaledZ),x=g[g.length-1].overscaledZ,S=g[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const T={};for(let O=0;O<S;O++)T[O+x]=new xr({func:h.GEQUAL,mask:255},O+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=S,[T,g]}return[{[x]:xr.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Er([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Er.unblended:Er.alphaBlended}colorModeForDrapableLayerRenderPass(s){const h=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?s!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new Er([h.ONE,h.ONE_MINUS_SRC_ALPHA,h.CONSTANT_ALPHA,h.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,s??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new Er([h.ONE,h.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,h.ONE_MINUS_SRC_ALPHA],o.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(s,h,g,x=!1){if(this.depthOcclusion)return new Qt(this.context.gl.GREATER,Qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return Qt.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Qt(g||this.context.gl.LEQUAL,h,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,h=Math.ceil(this.width),g=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),S=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===h&&this.depthFBO.height===g||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),h!==0&&g!==0&&(this.depthFBO=new lh(this.context,h,g,0,"texture"),this.depthTexture=new o.T(this.context,{width:h,height:g,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),s.bindTexture(s.TEXTURE_2D,S),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,h,g,0,0,h,g,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,h)=>s+h/this._fpsHistory.length,0))}render(s,h){const g=o.o.now();this._dt=g-this._timeStamp,this._timeStamp=g,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=h;const x=this.style._mergedLayers,S=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(S).filter(We=>{const Re=x[We];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]});let O=T(),R=!1,z=!1,F=null,Z=0,W=!1;for(const We of O){const Re=x[We];Re.visibility!=="none"&&(Re.type==="circle"?R=!0:Re.type==="building"?(F=Re,++Z):Re.type==="symbol"&&(Re.hasOcclusionOpacityProperties?z=!0:R=!0))}this.updateEmissiveMode();let K=O.map(We=>x[We]);const ne=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();for(const We in ne){const Re=ne[We];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++Z)}let ee=!1;for(const We of K)We.isHidden(this.transform.zoom)||(We.type==="clip"&&(ee=!0),this.prepareLayer(We));const ie={},ce={},ge={},pe={},fe={};for(const We in ne){const Re=ne[We];ie[We]=Re.getVisibleCoordinates(),ce[We]=ie[We].slice().reverse(),ge[We]=Re.getVisibleCoordinates(!0).reverse(),pe[We]=Re.getShadowCasterCoordinates(),fe[We]=Re.sortCoordinatesByDistance(ie[We])}const Ie=We=>{const Re=this.style.getLayerSourceCache(We);return Re&&Re.used?Re.getSource():null};if(Z||ee||this._clippingActiveLastFrame){const We=[],Re=[];let lt=0;for(const Qe of K)this.isSourceForClippingOrConflation(Qe,Ie(Qe))&&(We.push(Qe),Re.push(lt)),lt++;if(We&&(ee||We.length>1)||this._clippingActiveLastFrame){ee=!1;const Qe=[];for(let bt=0;bt<We.length;bt++){const At=We[bt],Lt=Re[bt],Pt=this.style.getLayerSourceCache(At);if(!Pt||!Pt.used||!Pt.getSource().usedInConflation&&At.type!=="clip"&&At.type!=="building")continue;let It=o.eQ,Kt=o.b_.None;const Xt=[];let Bt=!0;if(At.type==="building")It=o.eS;else if(At.type==="clip"){It=Lt;for(const Zt of At.layout.get("clip-layer-types"))Kt|=Zt==="model"?o.b_.Model:Zt==="symbol"?o.b_.Symbol:o.b_.FillExtrusion;for(const Zt of At.layout.get("clip-layer-scope"))Xt.push(Zt);At.isHidden(this.transform.zoom)?Bt=!1:ee=!0}Bt&&Qe.push({layer:At.fqid,cache:Pt,order:It,clipMask:Kt,clipScope:Xt})}this.replacementSource.setSources(Qe),W=!0}}this._clippingActiveLastFrame=ee,W||this.replacementSource.clear(),this.conflationActive=W,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let We=0;We<K.length;We++){const Re=K[We];if(Re.visibility==="none")continue;const lt=Re.cutoffRange();if(this.longestCutoffRange=Math.max(lt,this.longestCutoffRange),lt>0){const Qe=Ie(Re);Qe&&(this.minCutoffZoom=Math.max(Qe.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(S)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=We),this._lastOcclusionLayer=We)}const Ee=this.style&&this.style.fog;Ee?(this._fogVisible=Ee.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ee.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ge),this.opaquePassCutoff=0,O=T(),K=O.map(We=>x[We]));const Pe=this._shadowRenderer;if(Pe){Pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const We in ne)for(const Re of ie[We]){let lt={min:0,max:0};this.terrain&&(lt=this.terrain.getMinMaxForTile(Re)||lt),Pe.addShadowReceiver(Re.toUnwrapped(),lt.min,lt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Mb(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const be=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(be&&!this._snow&&(this._snow=new Bm(this)),!be&&this._snow&&(this._snow.destroy(),delete this._snow),ve&&!this._rain&&(this._rain=new hA(this)),!ve&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Db);const We=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(We,F)}if(!Hn.has(this.context.gl))return;this.renderPass="offscreen";for(const We of K){const Re=s.getLayerSourceCache(We);if(!We.hasOffscreenPass()||We.isHidden(this.transform.zoom))continue;const lt=Re?ce[Re.id]:void 0;(We.type==="custom"||We.type==="raster"||We.type==="raster-particle"||We.isSky()||lt&&lt.length)&&this.renderLayer(this,Re,We,lt)}this.depthRangeFor3D=[0,1-(K.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ke=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ne=(()=>{if(h.showOverdrawInspector)return o.ao.black;const We=this.style.fog;if(We&&this.transform.projection.supportsFog){const Re=this.style.getLut(We.scope);if(!ke){const lt=We.properties.get("color-use-theme")==="none",Qe=We.properties.get("color").toNonPremultipliedRenderColor(lt?null:Re).toArray01();return new o.ao(...Qe)}if(ke){const lt=We.properties.get("space-color-use-theme")==="none",Qe=We.properties.get("space-color").toNonPremultipliedRenderColor(lt?null:Re).toArray01();return new o.ao(...Qe)}}return o.ao.transparent})();if(this.context.clear({color:Ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=O.length-1;this.currentLayer>=0;this.currentLayer--){const We=K[this.currentLayer],Re=s.getLayerSourceCache(We);if(We.isSky())continue;const lt=Re?(We.is3D(S)?fe:ce)[Re.id]:void 0;this._renderTileClippingMasks(We,Re,lt),this.renderLayer(this,Re,We,lt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ke&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<O.length;this.currentLayer++){const We=K[this.currentLayer],Re=s.getLayerSourceCache(We);We.isSky()&&this.renderLayer(this,Re,We,Re?ce[Re.id]:void 0)}function $e(We,Re){let lt;return Re&&(lt=(We.type==="symbol"?ge:We.is3D(S)?fe:ce)[Re.id]),lt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<O.length;){const We=K[this.currentLayer];if(We.type==="raster"||We.type==="raster-particle"){const Re=s.getLayerSourceCache(We);this.renderLayer(this,Re,We,$e(We,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const Je=Pe?Pe.getGroundShadowLayerIndex():-1;let Xe=!1,ht=-1;for(let We=0;We<O.length;++We){const Re=K[We];Re.isHidden(this.transform.zoom)||Re.is3D(S)&&(ht=We)}z&&ht===-1&&(R=!0);let vt=!1;for(;this.currentLayer<O.length;){const We=K[this.currentLayer],Re=s.getLayerSourceCache(We);if(We.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(We)){if(We.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!vt&&We.is3D(S)&&!S){const lt=this.currentLayer,Qe=bt=>{for(this.currentLayer=0;this.currentLayer<K.length;this.currentLayer++){const At=K[this.currentLayer];if(Ub[At.type]){const Lt=this.style.getLayerSourceCache(At);Ub[At.type](this,Lt,At,$e(At,Lt),bt)}}};Qe("initialize"),Qe("reset"),this.currentLayer=lt,vt=!0}if(R&&!Xe&&this.terrain&&!this.transform.isOrthographic&&(Xe=!0,this.blitDepth()),z&&ht!==-1&&this.currentLayer===ht+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(We,Re,Re?ie[Re.id]:void 0),this.renderLayer(this,Re,We,$e(We,Re)),!this.terrain&&Pe&&this.currentLayer===Je){{this.clearStencil(),this.resetStencilClippingMasks();const lt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<K.length;this.currentLayer++){const Qe=K[this.currentLayer];if(fA[Qe.type]){const bt=this.style.getLayerSourceCache(Qe);fA[Qe.type](this,bt,Qe,$e(Qe,bt))}}this.currentLayer=lt}if(Pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const lt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=lt;this.currentLayer++){const Qe=K[this.currentLayer];if(!Qe.hasLightBeamPass())continue;const bt=s.getLayerSourceCache(Qe);this.renderLayer(this,bt,Qe,bt?ce[bt.id]:void 0)}this.currentLayer=lt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const lt=this.currentLayer;this.depthOcclusion=!0;for(const Qe of this.layersWithOcclusionOpacity){this.currentLayer=Qe;const bt=K[this.currentLayer],At=s.getLayerSourceCache(bt),Lt=At?ce[At.id]:void 0;this.terrain||this._renderTileClippingMasks(bt,At,At?ie[At.id]:void 0),this.renderLayer(this,At,bt,Lt)}this.depthOcclusion=!1,this.currentLayer=lt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let We=null;K.forEach(Re=>{const lt=s.getLayerSourceCache(Re);lt&&!Re.isHidden(this.transform.zoom)&&lt.getVisibleCoordinates().length&&(!We||We.getSource().maxzoom<lt.getSource().maxzoom)&&(We=lt)}),We&&this.options.showTileBoundaries&&iA(this,We,We.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&iA(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(We){const Re=We.transform.padding;oA(We,We.transform.height-(Re.top||0),3,Cb),oA(We,Re.bottom||0,3,Ib),kb(We,Re.left||0,3,Ob),kb(We,We.transform.width-(Re.right||0),3,PR);const lt=We.transform.centerPoint;(function(Qe,bt,At,Lt){y_(Qe,bt-1,At-10,2,20,Lt),y_(Qe,bt-10,At-1,20,2,Lt)})(We,lt.x,We.transform.height-lt.y,CR)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),W||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:h}=this.transform.projection,g=!h||!h.includes(s.type);if(Vb[s.type]&&(g||this.terrain&&s.type==="custom")){const x=this.style.getLayerSourceCache(s);Vb[s.type](s,x,this)}this.gpuTimingEnd()}renderLayer(s,h,g,x){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||g.type==="raster-particle"||x&&x.length)&&(this.id=g.id,this.gpuTimingStart(g),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(g.type)&&(!s.terrain||g.type!=="custom")||g.type==="clip"||uh[g.type](s,h,g,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery,g=this.context.gl;let x=this.gpuTimers[s.id];x||(x=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:g.createQuery()}),x.calls++,g.beginQuery(h.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,h=this.context.gl,g=h.createQuery();this.deferredRenderGpuTimeQueries.push(g),h.beginQuery(s.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const h={};for(const g in s){const x=s[g],S=this.context.extTimerQuery,T=S.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(x.query),h[g]=T}return h}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.gl;let g=0;for(const x of s)g+=h.getQueryParameter(x,h.QUERY_RESULT)/1e6,h.deleteQuery(x);return g}translatePosMatrix(s,h,g,x,S){if(!g[0]&&!g[1])return s;const T=S?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(T){const z=Math.sin(T),F=Math.cos(T);g=[g[0]*F-g[1]*z,g[0]*z+g[1]*F]}const O=[S?g[0]:o.ay(h,g[0],this.transform.zoom),S?g[1]:o.ay(h,g[1],this.transform.zoom),0],R=new Float32Array(16);return o.br(R,s,O),R}saveTileTexture(s){if(s.context!==this.context)return;const h=s.size[0],g=this._tileTextures[h];g?g.push(s):this._tileTextures[h]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,h,g){const x=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,S=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||S.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||x||h!==void 0&&!h||S.push("FOG","FOG_DITHERING"),x&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(s,h){this.cache=this.cache||{};const g=h&&h.defines||[],x=h&&h.config,S=this.currentGlobalDefines(s,h&&h.overrideFog,h&&h.overrideRtt).concat(g),T=zE.cacheKey(eb[s],s,S,x);return this.cache[T]||(this.cache[T]=new zE(this.context,s,eb[s],x,d_[s],S)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,h){if(this.style.enable3dLights()){const g=this.style.directionalLight,x=this.style.ambientLight;if(g&&x){const S=((T,O,R)=>{const z=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",Z=T.properties.get("color").toNonPremultipliedRenderColor(F?null:R.getLut(T.scope)).toArray01(),W=T.properties.get("intensity"),K=O.properties.get("color-use-theme")==="none",ne=O.properties.get("color").toNonPremultipliedRenderColor(K?null:R.getLut(O.scope)).toArray01(),ee=O.properties.get("intensity"),ie=[z.x,z.y,z.z],ce=o.dN(ne,ee),ge=o.dN(Z,W);return{u_lighting_ambient_color:ce,u_lighting_directional_dir:ie,u_lighting_directional_color:ge,u_ground_radiance:Cf(ie,ge,ce)}})(g,x,this.style);h.setLightsUniformValues(s,S)}}}uploadCommonUniforms(s,h,g,x,S){if(this.uploadCommonLightUniforms(s,h),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const O=T.getOpacity(this.transform.pitch),R=((z,F,Z,W,K,ne,ee,ie,ce,ge,pe,fe)=>{const Ie=z.transform,Ee=F.properties.get("color-use-theme")==="none",Pe=F.properties.get("color").toNonPremultipliedRenderColor(Ee?null:z.style.getLut(F.scope)).toArray01();Pe[3]=W;const be=z.frameCounter/1e3%1,[ve,ke]=F.properties.get("vertical-range");return{u_fog_matrix:Z?Ie.calculateFogTileMatrix(Z):fe||z.identityMat,u_fog_range:F.getFovAdjustedRange(Ie._fov),u_fog_color:Pe,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ve,ke),ke],u_fog_temporal_offset:be,u_frustum_tl:K,u_frustum_tr:ne,u_frustum_br:ee,u_frustum_bl:ie,u_globe_pos:ce,u_globe_radius:ge,u_viewport:pe,u_globe_transition:o.aj(Ie.zoom),u_is_globe:+(Ie.projection.name==="globe")}})(this,T,g,O,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],x);h.setFogUniformValues(s,R)}S&&h.setCutoffUniformValues(s,S.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,h=s.createTexture();return s.bindTexture(s.TEXTURE_2D,h),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,h=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const x of g)h[x.key]=s[x.key]||new Yu(x,512,this.transform.tileZoom,this,void 0,this.worldview);return h}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,h){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&s.type!=="building"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building"&&s.sourceLayer!=="procedural_buildings")&&(!h||h.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let h=this._cachedTileFogOpacities[s.key];return h||(this._cachedTileFogOpacities[s.key]=h=this.style.fog.getOpacityForTile(s)),h[0]>=qt||h[1]>=qt}setupDepthForOcclusion(s,h,g){const x=this.context,S=x.gl,T=!!g;var O;g||(g={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(S.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),g.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],g.u_depth_range_unpack=[2/((O=this.depthRangeFor3D)[1]-O[0]),-1-2*O[0]/(O[1]-O[0])],g.u_occluder_half_size=.5*this.occlusionParams.occluderSize,g.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),x.activeTexture.set(S.TEXTURE0),T||h.setTerrainUniformValues(x,g)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const s=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=s?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function mA(m,s){let h=!1,g=null;const x=()=>{g=null,h&&(m(),g=setTimeout(x,s),h=!1)};return()=>(h=!0,g||x(),g)}class Ks{constructor(s){this._hashName=s&&encodeURIComponent(s),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=mA(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const h=gA(s);if(this._hashName){const g=this._hashName;let x=!1;const S=location.hash.slice(1).split("&").map(T=>{const O=T.split("=")[0];return O===g?(x=!0,`${O}=${h}`):T}).filter(T=>T);return x||S.push(`${g}=${h}`),`#${S.join("&")}`}return`#${h}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let h;return s.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(h=g)}),(h&&h[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(Number(g)))){const g=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(h[3]||0):s.getBearing();return s.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function gA(m,s){const h=m.getCenter(),g=Math.round(100*m.getZoom())/100,x=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,x),T=Math.round(h.lng*S)/S,O=Math.round(h.lat*S)/S,R=m.getBearing(),z=m.getPitch();let F=s?`/${T}/${O}/${g}`:`${g}/${O}/${T}`;return(R||z)&&(F+="/"+Math.round(10*R)/10),z&&(F+=`/${Math.round(z)}`),F}const fd={linearity:.3,easing:o.eT(0,0,.3,1)},RR=Object.assign({deceleration:2500,maxSpeed:1400},fd),ti=Object.assign({deceleration:20,maxSpeed:1400},fd),Zr=Object.assign({deceleration:1e3,maxSpeed:360},fd),yA=Object.assign({deceleration:1e3,maxSpeed:90},fd);class pd{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=o.o.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const h={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)h.zoom+=S.zoomDelta||0,h.bearing+=S.bearingDelta||0,h.pitch+=S.pitchDelta||0,S.panDelta&&h.pan._add(S.panDelta),S.around&&(h.around=S.around),S.pinchAround&&(h.pinchAround=S.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(h.pan.mag()){const S=mu(h.pan.mag(),g,Object.assign({},RR,s||{}));x.offset=h.pan.mult(S.amount/h.pan.mag()),x.center=this._map.transform.center,pu(x,S)}if(h.zoom){const S=mu(h.zoom,g,ti);x.zoom=this._map.transform.zoom+S.amount,pu(x,S)}if(h.bearing){const S=mu(h.bearing,g,Zr);x.bearing=this._map.transform.bearing+o.aA(S.amount,-179,179),pu(x,S)}if(h.pitch){const S=mu(h.pitch,g,yA);x.pitch=this._map.transform.pitch+S.amount,pu(x,S)}if(x.zoom||x.bearing){const S=h.pinchAround===void 0?h.around:h.pinchAround;x.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function pu(m,s){(!m.duration||m.duration<s.duration)&&(m.duration=s.duration,m.easing=s.easing)}function mu(m,s,h){const{maxSpeed:g,linearity:x,deceleration:S}=h,T=o.aA(m*x/(s/1e3),-g,g),O=Math.abs(T)/(S*x);return{easing:h.easing,duration:1e3*O,amount:T*(O/2)}}class Ko extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,x={}){const S=me(h.getCanvasContainer(),g),T=h.unproject(S);super(s,Object.assign({point:S,lngLat:T,originalEvent:g},x)),this._defaultPrevented=!1,this.target=h}}class jf extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){const x=s==="touchend"?g.changedTouches:g.touches,S=Ce(h.getCanvasContainer(),x),T=S.map(R=>h.unproject(R)),O=S.reduce((R,z,F,Z)=>R.add(z.div(Z.length)),new o.P(0,0));super(s,{points:S,point:O,lngLats:T,lngLat:h.unproject(O),originalEvent:g}),this._defaultPrevented=!1}}class Gb extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h){super("wheel",{originalEvent:h}),this._defaultPrevented=!1}}class qb{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Gb(this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new Ko(s.type,this._map,s))}mouseup(s){this._map.fire(new Ko(s.type,this._map,s))}preclick(s){const h=new MouseEvent("preclick",s);this._map.fire(new Ko(h.type,this._map,h))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(s),this._map.fire(new Ko(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new Ko(s.type,this._map,s))}mouseover(s){this._map.fire(new Ko(s.type,this._map,s))}mouseout(s){this._map.fire(new Ko(s.type,this._map,s))}touchstart(s){return this._firePreventable(new jf(s.type,this._map,s))}touchmove(s){this._map.fire(new jf(s.type,this._map,s))}touchend(s){this._map.fire(new jf(s.type,this._map,s))}touchcancel(s){this._map.fire(new jf(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hb{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new Ko(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Ko(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Il{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(te(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const g=h,x=this._startPos,S=this._lastPos;if(!x||!S||S.equals(g)||!this._box&&g.dist(x)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=j("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const T=Math.min(x.x,g.x),O=Math.max(x.x,g.x),R=Math.min(x.y,g.y),z=Math.max(x.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${R}px)`,this._box.style.width=O-T+"px",this._box.style.height=z-R+"px")})}mouseupWindow(s,h){if(!this._active)return;const g=this._startPos,x=h;if(g&&s.button===0){if(this.reset(),ue(),g.x!==x.x||g.y!==x.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:s})),{cameraAnimation:S=>S.fitScreenCoordinates(g,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Q(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new o.z(s,{originalEvent:h}))}}function Ac(m,s){const h={};for(let g=0;g<m.length;g++)h[m[g].identifier]=s[g];return h}class Nf{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(x){const S=new o.P(0,0);for(const T of x)S._add(T);return S.div(x.length)}(h),this.touches=Ac(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;const x=Ac(g,h);for(const S in this.touches){const T=x[S];(!T||T.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class zf{constructor(s){this.singleTap=new Nf(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){const x=this.singleTap.touchend(s,h,g);if(x){const S=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(x)<30;if(S&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Wb{constructor(){this._zoomIn=new zf({numTouches:1,numTaps:2}),this._zoomOut=new zf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){const x=this._zoomIn.touchend(s,h,g),S=this._zoomOut.touchend(s,h,g);return x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(x)},{originalEvent:s})}):S?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(S)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Zb=0,md=2,Xb={[Zb]:1,[md]:2},Qa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class $m{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,h){return!1}_move(s,h){return{}}mousedown(s,h){if(this._lastPoint)return;const g=Fe(s);this._correctButton(s,g)&&(this._lastPoint=h,this._eventButton=g)}mousemoveWindow(s,h){const g=this._lastPoint;if(g){if(s.preventDefault(),this._eventButton!=null&&function(x,S){const T=Xb[S];return x.buttons===void 0||(x.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(h.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(g,h)}}mouseupWindow(s){this._lastPoint&&Fe(s)===this._eventButton&&(this._moved&&ue(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class x_ extends $m{mousedown(s,h){super.mousedown(s,h),this._lastPoint&&(this._active=!0)}_correctButton(s,h){return h===0&&!s.ctrlKey}_move(s,h){return{around:h,panDelta:h.sub(s)}}}class b_ extends $m{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Qa[s.pitchRotateKey]:void 0}_correctButton(s,h){return this._pitchRotateKey?h===0&&s[this._pitchRotateKey]:h===0&&s.ctrlKey||h===2}_move(s,h){const g=.8*(h.x-s.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class w_ extends $m{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Qa[s.pitchRotateKey]:void 0}_correctButton(s,h){return this._pitchRotateKey?h===0&&s[this._pitchRotateKey]:h===0&&s.ctrlKey||h===2}_move(s,h){const g=-.5*(h.y-s.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class go{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!o.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,h,g)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);const x=Ac(g,h),S=new o.P(0,0),T=new o.P(0,0);let O=0;for(const z in x){const F=x[z],Z=this._touches[z];Z&&(S._add(F),T._add(F.sub(Z)),O++,x[z]=F)}if(this._touches=x,O<this._minTouches||!T.mag())return;const R=T.div(O);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(O),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Vm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,h,g){return{}}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){const x=this._firstTwoTouches;if(!x)return;s.preventDefault();const[S,T]=x,O=Ff(g,h,S),R=Ff(g,h,T);if(!O||!R)return;const z=this._aroundCenter?null:O.add(R).div(2);return this._move([O,R],z,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;const[x,S]=this._firstTwoTouches,T=Ff(g,h,x),O=Ff(g,h,S);T&&O||(this._active&&ue(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ff(m,s,h){for(let g=0;g<m.length;g++)if(m[g].identifier===h)return s[g]}function S_(m,s){return Math.log2(m/s)}class dh extends Vm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(S_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:S_(this._distance,g),pinchAround:h}}}function T_(m,s){return 180*m.angleWith(s)/Math.PI}class Kb extends Vm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h){const g=this._vector;if(this._vector=s[0].sub(s[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:T_(this._vector,g),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const x=T_(s,g);return Math.abs(x)<h}}function Um(m){return Math.abs(m.y)>Math.abs(m.x)}class hh extends Vm{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Um(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){const x=this._lastPoints;if(!x)return;const S=s[0].sub(x[0]),T=s[1].sub(x[1]);return this._map._cooperativeGestures&&!o.eU()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(S,T,g.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(S.y+T.y)/2*-.5})}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;const x=s.mag()>=2,S=h.mag()>=2;if(!x&&!S)return;if(!x||!S)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;const T=s.y>0==h.y>0;return Um(s)&&Um(h)&&T}}const Yb={panStep:100,bearingStep:15,pitchStep:10};class Gm{constructor(){const s=Yb;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,x=0,S=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),S=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),S=1);break;case 38:s.shiftKey?x=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?x=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,x=0),{cameraAnimation:O=>{const R=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Jb,zoom:h?Math.round(R)+h*(s.shiftKey?2:1):R,bearing:O.getBearing()+g*this._bearingStep,pitch:O.getPitch()+x*this._pitchStep,offset:[-S*this._panStep,-T*this._panStep],center:O.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Jb(m){return m*(2-m)}const qm=4.000244140625,Qb=1/450;class E_{constructor(s,h){this._map=s,this._el=s.getCanvasContainer(),this._handler=h,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Qb,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||o.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=o.o.now(),x=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%qm===0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=h,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(x*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=me(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>qm?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&F!==0&&(F=1/F);const Z=h(),W=Math.pow(2,Z),K=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):W;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(K*F))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const g=typeof this._targetZoom=="number"?this._targetZoom:h(),x=this._startZoom,S=this._easing;let T,O=!1;if(this._type==="wheel"&&x&&S){const z=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),F=S(z);T=o.ak(x,g,F),z<1?this._frameId||(this._frameId=!0):O=!0}else T=g,O=!0;this._active=!0,O&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let R=T-h();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!O,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=o.eV;if(this._prevEase){const g=this._prevEase,x=(o.o.now()-g.start)/g.duration,S=g.easing(x+.01)-g.easing(x),T=.27/Math.sqrt(S*S+1e-4)*.01,O=Math.sqrt(.0729-T*T);h=o.eT(T,O,.25,1)}return this._prevEase={start:o.o.now(),duration:s,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class _A{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vA{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(s.shiftKey?-1:1),around:g.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xA{constructor(){this._tap=new zf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,h,g){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=h[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(s,h,g))}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const x=h[0],S=x.y-this._swipePoint.y;return this._swipePoint=x,s.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(s,h,g)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bA{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wA{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class SA{constructor(s,h,g,x){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Hm=m=>m.zoom||m.drag||m.pitch||m.rotate;class TA extends o.z{}class EA{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,h){const g=o.av([],h,s);this.radius=o.ag(g[2]<0?o.eX([],g,this.constants):[g[0],g[1],0])}projectRay(s){o.eX(s,s,this.constants),o.aw(s,s),o.eY(s,s,this.constants);const h=o.c5([],s,this.radius);if(h[2]>0){const g=o.c5([],[0,0,1],o.bJ(h,[0,0,1])),x=o.c5([],o.aw([],[h[0],h[1],0]),this.radius),S=o.d8([],h,o.c5([],o.av([],o.d8([],x,g),h),2));h[0]=S[0],h[1]=S[1]}return h}}function Wm(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class AA{constructor(s,h){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pd(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new EA,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),o.aY(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,S,T]of this._listeners){const O=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(S,O,T)}}destroy(){for(const[s,h,g]of this._listeners){const x=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(h,x,g)}}_addDefaultHandlers(s){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new qb(h,s));const x=h.boxZoom=new Il(h,s);this._add("boxZoom",x);const S=new Wb,T=new vA;h.doubleClickZoom=new _A(T,S),this._add("tapZoom",S),this._add("clickZoom",T);const O=new xA;this._add("tapDragZoom",O);const R=h.touchPitch=new hh(h);this._add("touchPitch",R);const z=new b_(s),F=new w_(s);h.dragRotate=new wA(s,z,F),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const Z=new x_(s),W=new go(h,s);h.dragPan=new bA(g,Z,W),this._add("mousePan",Z),this._add("touchPan",W,["touchZoom","touchRotate"]);const K=new Kb,ne=new dh;h.touchZoomRotate=new SA(g,ne,K,O),this._add("touchRotate",K,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Hb(h));const ee=h.scrollZoom=new E_(h,this);this._add("scrollZoom",ee,["mousePan"]);const ie=h.keyboard=new Gm;this._add("keyboard",ie);for(const ce of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ce]&&h[ce].enable(s[ce])}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Hm(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,h,g){for(const x in s)if(x!==g&&(!h||h.indexOf(x)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const h=[];for(const g of s)this._el.contains(g.target)&&h.push(g);return h}handleEvent(s,h){this._updatingCamera=!0;const g=s.type==="renderFrame",x=g?void 0:s,S={needsRenderFrame:!1},T={},O={},R=s.touches?this._getMapTouches(s.touches):void 0,z=R?Ce(this._el,R):g?void 0:me(this._el,s);for(const{handlerName:W,handler:K,allowed:ne}of this._handlers){if(!K.isEnabled())continue;let ee;this._blockedByActive(O,ne,W)?K.reset():K[h||s.type]&&(ee=K[h||s.type](s,z,R),this.mergeHandlerResult(S,T,ee,W,x),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||K.isActive())&&(O[W]=K)}const F={};for(const W in this._previousActiveHandlers)O[W]||(F[W]=x);this._previousActiveHandlers=O,(Object.keys(F).length||Wm(S))&&(this._changes.push([S,T,F]),this._triggerRenderFrame()),(Object.keys(O).length||Wm(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=S;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(s,h,g,x,S){if(!g)return;Object.assign(s,g);const T={handlerName:x,originalEvent:g.originalEvent||S};g.zoomDelta!==void 0&&(h.zoom=T),g.panDelta!==void 0&&(h.drag=T),g.pitchDelta!==void 0&&(h.pitch=T),g.bearingDelta!==void 0&&(h.rotate=T)}_applyChanges(){const s={},h={},g={};for(const[x,S,T]of this._changes)x.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(s.around=x.around),x.aroundCoord!==void 0&&(s.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(s.pinchAround=x.pinchAround),x.noInertia&&(s.noInertia=x.noInertia),Object.assign(h,S),Object.assign(g,T);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){const x=this._map,S=x.transform,T=ge=>[ge.x,ge.y,ge.z];if((()=>{const ge=this._eventsInProgress.drag;return ge&&!this._handlersById[ge.handlerName].isActive()})()&&!Wm(s)){const ge=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),ge!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&x._stop(!0),!Wm(s))return void this._fireEvents(h,g,!0);let{panDelta:O,zoomDelta:R,bearingDelta:z,pitchDelta:F,around:Z,aroundCoord:W,pinchAround:K}=s;S._isCameraConstrained&&(R>0&&(R=0),S._isCameraConstrained=!1),K!==void 0&&(Z=K),(R||(ge=>h[ge]&&!this._eventsInProgress[ge])("drag"))&&Z&&(this._dragOrigin=T(S.pointCoordinate3D(Z)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",x._stop(!0),Z=Z||x.transform.centerPoint,z&&(S.bearing+=z),F&&(S.pitch+=F),S._updateCameraState();const ne=[0,0,0];if(O)if(S.projection.name==="mercator"){const ge=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(Z).dir),pe=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(Z.sub(O)).dir);ne[0]=pe[0]-ge[0],ne[1]=pe[1]-ge[1]}else{const ge=S.pointCoordinate(Z);if(S.projection.name==="globe"){O=O.rotate(-S.angle);const pe=S._pixelsPerMercatorPixel/S.worldSize;ne[0]=-O.x*o.eW(o.a$(ge.y))*pe,ne[1]=-O.y*o.eW(S.center.lat)*pe}else{const pe=S.pointCoordinate(Z.sub(O));ge&&pe&&(ne[0]=pe.x-ge.x,ne[1]=pe.y-ge.y)}}const ee=S.zoom,ie=[0,0,0];if(R){const ge=T(W||S.pointCoordinate3D(Z)),pe={dir:o.aw([],o.av([],ge,S._camera.position))};if(pe.dir[2]<0){const fe=S.zoomDeltaToMovement(ge,R);o.c5(ie,pe.dir,fe)}}const ce=o.d8(ne,ne,ie);S._translateCameraConstrained(ce),R&&Math.abs(S.zoom-ee)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){const x=Hm(this._eventsInProgress),S=Hm(s),T={};for(const F in s){const{originalEvent:Z}=s[F];this._eventsInProgress[F]||(T[`${F}start`]=Z),this._eventsInProgress[F]=s[F]}!x&&S&&this._fireEvent("movestart",S.originalEvent);for(const F in T)this._fireEvent(F,T[F]);S&&this._fireEvent("move",S.originalEvent);for(const F in s){const{originalEvent:Z}=s[F];this._fireEvent(F,Z)}const O={};let R;for(const F in this._eventsInProgress){const{handlerName:Z,originalEvent:W}=this._eventsInProgress[F];this._handlersById[Z].isActive()||(delete this._eventsInProgress[F],R=h[Z]||W,O[`${F}end`]=R)}for(const F in O)this._fireEvent(F,O[F]);const z=Hm(this._eventsInProgress);if(g&&(x||S)&&!z){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;F?(Z(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:R})):(this._map.fire(new o.z("moveend",{originalEvent:R})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new o.z(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new TA("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ew="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class PA extends o.E{constructor(s,h){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this._respectPrefersReducedMotion=h.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,Object.assign({offset:s},h),g)}panTo(s,h,g){return this.easeTo(Object.assign({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(Object.assign({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(Object.assign({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,Object.assign({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=o.aI.convert(s);const g=h&&h.bearing||0,x=h&&h.pitch||0,S=s.getNorthWest(),T=s.getSouthEast();return this._cameraForBounds(this.transform,S,T,g,x,h)}_extendPadding(s){const h={top:0,right:0,bottom:0,left:0};return s==null?Object.assign({},h,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:Object.assign({},h,s)}_extendCameraOptions(s){return(s=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,h){const g=h.max[0]-h.min[0],x=h.max[1]-h.min[1];return g/x>s.aspect?g/(2*Math.tan(.5*s.fovX)*s.aspect):x/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,h,g,x,S,T){const O=s.clone(),R=this._extendCameraOptions(T);O.bearing=x,O.pitch=S;const z=o.aT.convert(h),F=o.aT.convert(g),Z=.5*(z.lat+F.lat),W=.5*(z.lng+F.lng),K=o.eZ(Z,W),ne=o.aw([],K),ee=o.aw([],o.bI([],ne,[0,1,0])),ie=o.bI([],ee,ne),ce=[ee[0],ee[1],ee[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],ge=[K,o.eZ(z.lat,z.lng),o.eZ(F.lat,z.lng),o.eZ(F.lat,F.lng),o.eZ(z.lat,F.lng),o.eZ(Z,z.lng),o.eZ(Z,F.lng),o.eZ(z.lat,W),o.eZ(F.lat,W)];let pe=o.d9.fromPoints(ge.map(Qe=>[o.bJ(ee,Qe),o.bJ(ie,Qe),o.bJ(ne,Qe)]));const fe=o.af([],pe.center,ce);o.e_(fe)===0&&o.e$(fe,0,0,1),o.aw(fe,fe),o.c5(fe,fe,o.aD),O.center=o.f0(fe);const Ie=O.getWorldToCameraMatrix(),Ee=o.bl(new Float64Array(16),Ie);pe=o.d9.applyTransform(pe,o.aB([],Ie,ce));const Pe=this._extendAABB(pe,O,R,x);if(!Pe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Pe,o.af(fe,fe,Ie);const be=.5*(pe.max[2]-pe.min[2]),ve=this._minimumAABBFrustumDistance(O,pe),ke=o.c5([],[0,0,1],be),Ne=o.d8(ke,fe,ke),$e=ve+(O.pitch===0?0:o.bG(fe,Ne)),Je=O.globeCenterInViewSpace,Xe=o.av([],fe,[Je[0],Je[1],Je[2]]);o.aw(Xe,Xe),o.c5(Xe,Xe,$e);const ht=o.d8([],fe,Xe);o.af(ht,ht,Ee);const vt=o.eM/o.aD,We=o.ag(ht),Re=o.cf(Math.max(We*vt-o.eM,Number.EPSILON),0),lt=Math.min(O.zoomFromMercatorZAdjusted(Re),R.maxZoom);return lt>.5*(o.c_+o.cL)?(O.setProjection({name:"mercator"}),O.zoom=lt,this._cameraForBounds(O,h,g,x,S,T)):{center:O.center,zoom:lt,bearing:x,pitch:S}}_extendAABB(s,h,g,x){const S=.5*((g.padding.left||0)+(g.padding.right||0)),T=.5*((g.padding.top||0)+(g.padding.bottom||0)),O=T,R=S,z=S,F=T,Z=h.width-(R+z),W=h.height-(O+F),K=o.av([],s.max,s.min),ne=Math.min(Z/K[0],W/K[1]),ee=Math.min(h.scaleZoom(h.scale*ne),g.maxZoom);if(isNaN(ee))return null;const ie=h.scale/h.zoomScale(ee),ce=new o.d9([s.min[0]-R*ie,s.min[1]-F*ie,s.min[2]],[s.max[0]+z*ie,s.max[1]+O*ie,s.max[2]]),ge=(typeof g.offset.x=="number"&&typeof g.offset.y=="number"?new o.P(g.offset.x,g.offset.y):o.P.convert(g.offset)).rotate(-o.an(x));return ce.center[0]-=ge.x*ie,ce.center[1]+=ge.y*ie,ce}queryTerrainElevation(s,h){const g=this.transform.elevation;return g?(h=Object.assign({},{exaggerated:!0},h),g.getAtPoint(o.ae.fromLngLat(s),null,h.exaggerated)):null}_cameraForBounds(s,h,g,x,S,T){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,h,g,x,S,T);const O=s.clone(),R=this._extendCameraOptions(T);O.bearing=x,O.pitch=S;const z=o.aT.convert(h),F=o.aT.convert(g),Z=new o.aT(z.lng,F.lat),W=new o.aT(F.lng,z.lat),K=O.project(z),ne=O.project(F),ee=this.queryTerrainElevation(z),ie=this.queryTerrainElevation(F),ce=this.queryTerrainElevation(Z),ge=this.queryTerrainElevation(W),pe=[[K.x,K.y,Math.min(ee||0,ie||0,ce||0,ge||0)],[ne.x,ne.y,Math.max(ee||0,ie||0,ce||0,ge||0)]];let fe=o.d9.fromPoints(pe);const Ie=O.getWorldToCameraMatrix(),Ee=o.bl(new Float64Array(16),Ie);fe=o.d9.applyTransform(fe,Ie);const Pe=this._extendAABB(fe,O,R,x);if(!Pe)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Pe;const be=.5*o.av([],fe.max,fe.min)[2],ve=this._minimumAABBFrustumDistance(O,fe),ke=[0,0,1,0];o.aC(ke,ke,Ie),o.f1(ke,ke);const Ne=o.c5([],ke,ve+be),$e=o.d8([],fe.center,Ne);o.af(fe.center,fe.center,Ee),o.af($e,$e,Ee);const Je=O.unproject(new o.P(fe.center[0],fe.center[1])),Xe=o.f2(O.projection,Je),ht=Math.pow(2,Xe),vt=Math.min(O._zoomFromMercatorZ($e[2]*O.pixelsPerMeter*ht/O.worldSize),R.maxZoom);return O.mercatorFromTransition&&vt<.5*(o.c_+o.cL)?(O.setProjection({name:"globe"}),O.zoom=vt,this._cameraForBounds(O,h,g,x,S,T)):{center:Je,zoom:vt,bearing:x,pitch:S}}fitBounds(s,h,g){const x=this.cameraForBounds(s,h);return this._fitInternal(x,h,g)}fitScreenCoordinates(s,h,g,x,S){const T=o.P.convert(s),O=o.P.convert(h),R=new o.P(Math.min(T.x,O.x),Math.min(T.y,O.y)),z=new o.P(Math.max(T.x,O.x),Math.max(T.y,O.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,O))return this;const F=this.transform.pointLocation3D(R),Z=this.transform.pointLocation3D(z),W=this.transform.pointLocation3D(new o.P(R.x,z.y)),K=this.transform.pointLocation3D(new o.P(z.x,R.y)),ne=[Math.min(F.lng,Z.lng,W.lng,K.lng),Math.min(F.lat,Z.lat,W.lat,K.lat)],ee=[Math.max(F.lng,Z.lng,W.lng,K.lng),Math.max(F.lat,Z.lat,W.lat,K.lat)],ie=x&&x.pitch?x.pitch:this.getPitch(),ce=this._cameraForBounds(this.transform,ne,ee,g,ie,x);return this._fitInternal(ce,x,S)}_fitInternal(s,h,g){return s?(h=Object.assign(s,h)).linear?this.easeTo(h,g):this.flyTo(h,g):this}jumpTo(s,h){this.stop();const g=s.preloadOnly?this.transform.clone():this.transform;let x=!1,S=!1,T=!1;"zoom"in s&&g.zoom!==+s.zoom&&(x=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=o.aT.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(S=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(T=!0,g.pitch=+s.pitch);const O=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!g.isPaddingEqual(O))if(s.retainPadding===!1){const R=g.clone();R.padding=O,g.setLocationAtPoint(g.center,R.centerPoint)}else g.padding=O;return s.preloadOnly?(this._preloadTiles(g),this):(this.fire(new o.z("movestart",h)).fire(new o.z("move",h)),x&&this.fire(new o.z("zoomstart",h)).fire(new o.z("zoom",h)).fire(new o.z("zoomend",h)),S&&this.fire(new o.z("rotatestart",h)).fire(new o.z("rotate",h)).fire(new o.z("rotateend",h)),T&&this.fire(new o.z("pitchstart",h)).fire(new o.z("pitch",h)).fire(new o.z("pitchend",h)),this.fire(new o.z("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(ew),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,h){const g=this.transform;if(!g.projection.supportsFreeCamera)return o.w(ew),this;this.stop();const x=g.zoom,S=g.pitch,T=g.bearing;g.setFreeCameraOptions(s);const O=x!==g.zoom,R=S!==g.pitch,z=T!==g.bearing;return this.fire(new o.z("movestart",h)).fire(new o.z("move",h)),O&&this.fire(new o.z("zoomstart",h)).fire(new o.z("zoom",h)).fire(new o.z("zoomend",h)),z&&this.fire(new o.z("rotatestart",h)).fire(new o.z("rotate",h)).fire(new o.z("rotateend",h)),R&&this.fire(new o.z("pitchstart",h)).fire(new o.z("pitch",h)).fire(new o.z("pitchend",h)),this.fire(new o.z("moveend",h)),this}easeTo(s,h){this._stop(!1,s.easeId),((s=Object.assign({offset:[0,0],duration:500,easing:o.eV},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const g=this.transform,x=this.getZoom(),S=this.getBearing(),T=this.getPitch(),O=this.getPadding(),R="zoom"in s?+s.zoom:x,z="bearing"in s?this._normalizeBearing(s.bearing,S):S,F="pitch"in s?+s.pitch:T,Z=this._extendPadding(s.padding),W=o.P.convert(s.offset);let K,ne,ee;if(g.projection.name==="globe"){const ke=o.ae.fromLngLat(g.center),Ne=W.rotate(-g.angle);ke.x+=Ne.x/g.worldSize,ke.y+=Ne.y/g.worldSize;const $e=ke.toLngLat(),Je=o.aT.convert(s.center||$e);this._normalizeCenter(Je),K=g.centerPoint.add(Ne),ne=new o.P(ke.x,ke.y).mult(g.worldSize),ee=new o.P(o.aF(Je.lng),o.aJ(Je.lat)).mult(g.worldSize).sub(ne)}else{K=g.centerPoint.add(W);const ke=g.pointLocation(K),Ne=o.aT.convert(s.center||ke);this._normalizeCenter(Ne),ne=g.project(ke),ee=g.project(Ne).sub(ne)}const ie=g.zoomScale(R-x);let ce,ge;s.around&&(ce=o.aT.convert(s.around),ge=g.locationPoint(ce));const pe=this._zooming||R!==x,fe=this._rotating||S!==z,Ie=this._pitching||F!==T,Ee=!g.isPaddingEqual(Z),Pe=s.retainPadding===!1?g.clone():g,be=ke=>Ne=>{if(pe&&(ke.zoom=o.ak(x,R,Ne)),fe&&(ke.bearing=o.ak(S,z,Ne)),Ie&&(ke.pitch=o.ak(T,F,Ne)),Ee&&(Pe.interpolatePadding(O,Z,Ne),K=Pe.centerPoint.add(W)),ce)ke.setLocationAtPoint(ce,ge);else{const $e=ke.zoomScale(ke.zoom-x),Je=R>x?Math.min(2,ie):Math.max(.5,ie),Xe=Math.pow(Je,1-Ne),ht=ke.unproject(ne.add(ee.mult(Ne*Xe)).mult($e));ke.setLocationAtPoint(ke.renderWorldCopies?ht.wrap():ht,K)}return s.preloadOnly||this._fireMoveEvents(h),ke};if(s.preloadOnly){const ke=this._emulate(be,s.duration,g);return this._preloadTiles(ke),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=fe,this._pitching=Ie,this._padding=Ee,this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,ve),this._ease(be(g),ke=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(h,ke)},s),this}_prepareEase(s,h,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),h||g.moving||this.fire(new o.z("movestart",s)),this._zooming&&!g.zooming&&this.fire(new o.z("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new o.z("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new o.z("pitchstart",s))}_fireMoveEvents(s){this.fire(new o.z("move",s)),this._zooming&&this.fire(new o.z("zoom",s)),this._rotating&&this.fire(new o.z("rotate",s)),this._pitching&&this.fire(new o.z("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,x=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new o.z("zoomend",s)),x&&this.fire(new o.z("rotateend",s)),S&&this.fire(new o.z("pitchend",s)),this.fire(new o.z("moveend",s))}flyTo(s,h){if(this._prefersReducedMotion(s)){const Qe=o.aH(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Qe,h)}this.stop(),s=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eV},s);const g=this.transform,x=this.getZoom(),S=this.getBearing(),T=this.getPitch(),O=this.getPadding(),R="zoom"in s?o.aA(+s.zoom,g.minZoom,g.maxZoom):x,z="bearing"in s?this._normalizeBearing(s.bearing,S):S,F="pitch"in s?+s.pitch:T,Z=this._extendPadding(s.padding),W=g.zoomScale(R-x),K=o.P.convert(s.offset);let ne=g.centerPoint.add(K);const ee=g.pointLocation(ne),ie=o.aT.convert(s.center||ee);this._normalizeCenter(ie);const ce=g.project(ee),ge=g.project(ie).sub(ce);let pe=s.curve;const fe=Math.max(g.width,g.height),Ie=fe/W,Ee=ge.mag();if("minZoom"in s){const Qe=o.aA(Math.min(s.minZoom,x,R),g.minZoom,g.maxZoom),bt=fe/g.zoomScale(Qe-x);pe=Math.sqrt(bt/Ee*2)}const Pe=pe*pe;function be(Qe){const bt=(Ie*Ie-fe*fe+(Qe?-1:1)*Pe*Pe*Ee*Ee)/(2*(Qe?Ie:fe)*Pe*Ee);return Math.log(Math.sqrt(bt*bt+1)-bt)}function ve(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function ke(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Ne=be(0);let $e=function(Qe){return ke(Ne)/ke(Ne+pe*Qe)},Je=function(Qe){return fe*((ke(Ne)*(ve(bt=Ne+pe*Qe)/ke(bt))-ve(Ne))/Pe)/Ee;var bt},Xe=(be(1)-Ne)/pe;if(Math.abs(Ee)<1e-6||!isFinite(Xe)){if(Math.abs(fe-Ie)<1e-6)return this.easeTo(s,h);const Qe=Ie<fe?-1:1;Xe=Math.abs(Math.log(Ie/fe))/pe,Je=function(){return 0},$e=function(bt){return Math.exp(Qe*pe*bt)}}s.duration="duration"in s?+s.duration:1e3*Xe/("screenSpeed"in s?+s.screenSpeed/pe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const ht=S!==z,vt=F!==T,We=!g.isPaddingEqual(Z),Re=s.retainPadding===!1?g.clone():g,lt=Qe=>bt=>{const At=bt*Xe,Lt=1/$e(At);Qe.zoom=bt===1?R:x+Qe.scaleZoom(Lt),ht&&(Qe.bearing=o.ak(S,z,bt)),vt&&(Qe.pitch=o.ak(T,F,bt)),We&&(Re.interpolatePadding(O,Z,bt),ne=Re.centerPoint.add(K));const Pt=bt===1?ie:Qe.unproject(ce.add(ge.mult(Je(At))).mult(Lt));return Qe.setLocationAtPoint(Qe.renderWorldCopies?Pt.wrap():Pt,ne),Qe._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(h),Qe};if(s.preloadOnly){const Qe=this._emulate(lt,s.duration,g);return this._preloadTiles(Qe),this}return this._zooming=!0,this._rotating=ht,this._pitching=vt,this._padding=We,this._prepareEase(h,!1),this._ease(lt(g),()=>this._afterEase(h),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,h)}if(!s){const g=this.handlers;g&&g.stop(!1)}return this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=o.o.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,h){s=o.bT(s,-180,180);const g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s){const h=this.transform;if(h.maxBounds||h.projection.name!=="globe"&&!h.renderWorldCopies)return;const g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,h,g){const x=Math.ceil(15*h/1e3),S=[],T=s(g.clone());for(let O=0;O<=x;O++){const R=T(O/x);S.push(R.clone())}return S}_preloadTiles(s,h){}}class CA{constructor(s={}){this.options=s,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const h=this.options&&this.options.compact,g=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",g);const x=j("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",g),this._innerContainer=j("div","mapboxgl-ctrl-attrib-inner",this._container),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),h===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(s){const g=h.reduce((x,S,T)=>(S.value&&(x+=`${S.key}=${S.value}${T<h.length-1?"&":""}`),x),"?");s.href=`${o.e.FEEDBACK_URL}/${g}#${gA(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||(s.dataType!=="source"||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility")&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const h=this._map.style._mergedSourceCaches;for(const x in h){const S=h[x];if(S.used){const T=S.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s.sort((x,S)=>x.length-S.length),s=s.filter((x,S)=>{for(let T=S+1;T<s.length;T++)if(s[T].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const g=s.map(x=>function(S){const T=new DOMParser().parseFromString(S,"text/html");return Array.from(T.body.querySelectorAll("*")).reverse().forEach(O=>{const R=O.textContent||"";if(O.tagName!=="A")return void O.replaceWith(...O.childNodes);const z=O.getAttribute("href");if(!z||!/^(https?:|mailto:)/i.test(z))return void O.replaceWith(T.createTextNode(R));const F=T.createElement("a");F.href=z,F.textContent=R,F.rel="noopener nofollow";const Z=O.getAttribute("class");Z&&(F.className=Z),O.replaceWith(F)}),T.body.innerHTML}(x)).join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class IA{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=j("div","mapboxgl-ctrl");const h=j("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const h in s){const g=s[h].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const h=s[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class OA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const x of g)if(x.id===s)return void(x.cancelled=!0)}run(s=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class di{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const h=o.dD((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,h,g){this._start=this.getValue(h),this._end=s,this._startTime=h,this._endTime=h+g}}const kA={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class RA extends o.z{constructor(s,h,g,x){const{point:S,lngLat:T,originalEvent:O,target:R}=s;super(s.type,{point:S,lngLat:T,originalEvent:O,target:R}),this.preventDefault=()=>{s.preventDefault()},this.id=h,this.interaction=g,this.feature=x}}class MR{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,h){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const g=h.filter;let x=h.type;g&&this.filters.set(s,o.b6(g)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const S=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,h)):S.size===0&&this.map.on(x,this.handleType),S.size===0&&this.interactionsByType.set(x,S),S.set(s,h),this.typeById.set(s,x)}get(s){const h=this.typeById.get(s);if(!h)return;const g=this.interactionsByType.get(h);return g?g.get(s):void 0}remove(s){const h=this.typeById.get(s);if(!h)return;this.typeById.delete(s),this.filters.delete(s);const g=this.interactionsByType.get(h);g&&(g.delete(s),h==="mouseenter"||h==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):g.size===0&&this.map.off(h,this.handleType))}queryTargets(s,h){const g=[];for(const[x,S]of h)S.target&&g.push({targetId:x,target:S.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(s,g,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const h=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());h.length&&(s.type="mouseenter",this.handleType(s,h));const g=new Map;for(const[x,{feature:S}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||g.set(S.id,S);g.size&&(s.type="mouseleave",this.handleType(s,Array.from(g.values())))}handleOut(s){const h=Array.from(this.hoveredFeatures.values()).map(({feature:g})=>g);h.length&&(s.type="mouseleave",this.handleType(s,h)),this.hoveredFeatures.clear()}handleType(s,h){const g=s.type==="mouseenter";if(g&&!this.interactionsByType.has(s.type))return void o.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(s.type)).reverse(),S=!!h;h=h||this.queryTargets(s.point,x);let T=!1;const O=new Set;for(const R of h){for(const[z,F]of x){if(!F.target)continue;const Z=R.variants?R.variants[z]:null;if(Z){for(const W of Z){if(um(W,R,O,z))continue;const K=new o.dx(R,W),ne=Za(W,R,z);S&&K.id!==void 0&&(K.state=this.map.getFeatureState(K));const ee=g?this.prevHoveredFeatures.get(ne):null,ie=new RA(s,z,F,K),ce=ee?ee.stop:F.handler(ie);if(g&&this.hoveredFeatures.set(ne,{feature:R,stop:ce}),ce!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[R,z]of x){const{handler:F,target:Z}=z;if(!Z&&F(new RA(s,R,z,null))!==!1)break}}}function DR(m,s){if(Array.isArray(m)&&Array.isArray(s)){const h=new Set(m),g=new Set(s);return h.size===g.size&&m.every(x=>g.has(x))}return o.by(m,s)}const Zm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},MA={showCompass:!0,showZoom:!0,visualizePitch:!1};class tw{constructor(s,h,g=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new b_({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,g&&(this.mousePitch=new w_({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(s,h){this.mouseRotate.mousedown(s,h),this.mousePitch&&this.mousePitch.mousedown(s,h),te()}move(s,h){const g=this.map,x=this.mouseRotate.mousemoveWindow(s,h),S=x&&x.bearingDelta;if(S&&g.setBearing(g.getBearing()+S),this.mousePitch){const T=this.mousePitch.mousemoveWindow(s,h),O=T&&T.pitchDelta;O&&g.setPitch(g.getPitch()+O)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(Object.assign({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),me(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,me(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ce(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Ce(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Xm(m,s,h){if(m=new o.aT(m.lng,m.lat),s){const g=new o.aT(m.lng-360,m.lat),x=new o.aT(m.lng+360,m.lat),S=360*Math.ceil(Math.abs(m.lng-h.center.lng)/360),T=h.locationPoint3D(m).distSqr(s),O=s.x<0||s.y<0||s.x>h.width||s.y>h.height;h.locationPoint3D(g).distSqr(s)<T&&(O||Math.abs(g.lng-h.center.lng)<S)?m=g:h.locationPoint3D(x).distSqr(s)<T&&(O||Math.abs(x.lng-h.center.lng)<S)&&(m=x)}for(;Math.abs(m.lng-h.center.lng)>180;){const g=h.locationPoint3D(m);if(g.x>=0&&g.y>=0&&g.x<=h.width&&g.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}const Wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},el={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Qi extends o.E{constructor(s,h){super(),(s instanceof HTMLElement||h)&&(s=Object.assign({element:s},h)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:g="center",color:x="#3FB1CE",scale:S=1,draggable:T=!1,clickTolerance:O=0,rotation:R=el.rotation,rotationAlignment:z=el.rotationAlignment,pitchAlignment:F=el.pitchAlignment,occludedOpacity:Z=el.occludedOpacity,altitude:W=el.altitude}=s||{};this._anchor=g,this._color=x,this._scale=S,this._draggable=T,this._clickTolerance=O,this._rotation=R,this._rotationAlignment=z,this._pitchAlignment=F,this._occludedOpacity=Z,this._altitude=W,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ee=>{ee.preventDefault()}),this._element.addEventListener("mousedown",ee=>{ee.preventDefault()});const K=this._element.classList;for(const ee in Wl)K.remove(`mapboxgl-marker-anchor-${ee}`);K.add(`mapboxgl-marker-anchor-${this._anchor}`);const ne=s&&s.className?s.className.trim().split(/\s+/):[];K.add(...ne),this._popup=null}_createDefaultMarker(){const s=j("div"),h=B("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const g=B("radialGradient",{id:"shadowGradient"},B("defs",{},h));B("stop",{offset:"10%","stop-opacity":.4},g),B("stop",{offset:"100%","stop-opacity":.05},g),B("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},h)}return B("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},h),B("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},h),B("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},h),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.aT.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||el.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const h=s.code,g=s.charCode||s.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(s){const h=s.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,h=this._pos;if(!s||!h)return!1;const g=s.unproject(h,this._altitude),x=s.getFreeCameraOptions();if(!x.position)return!1;const S=x.position.toLngLat();return S.distanceTo(g)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const h=this._pos;if(!h||h.x<0||h.x>s.transform.width||h.y<0||h.y>s.transform.height)return void this._clearFadeTimer();const g=s.unproject(h,this._altitude);let x;s._showingGlobe()&&o.f5(s.transform,this._lngLat)?x=0:(x=1-s._queryFogOpacity(g),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Wl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${h.x}px,${h.y}px)
        `}_calculateXYTransform(){const s=this._pos,h=this._map,g=this.getPitchAlignment();if(!h||!s||g!=="map")return"";if(!h._showingGlobe()){const R=h.getPitch();return R?`rotateX(${R}deg)`:""}const x=o.cX(o.f6(h.transform,this._lngLat)),S=s.sub(o.f7(h.transform)),T=Math.abs(S.x)+Math.abs(S.y);if(T===0)return"";const O=x/T;return`rotateX(${-S.y*O}deg) rotateY(${S.x*O}deg)`}_calculateZTransform(){const s=this._pos,h=this._map;if(!h||!s)return"";let g=0;const x=this.getRotationAlignment();if(x==="map")if(h._showingGlobe()){const S=h.project(new o.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=h.project(new o.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(S);g=o.cX(Math.atan2(T.y,T.x))-90}else g=-h.getBearing();else if(x==="horizon"){const S=o.ah(4,6,h.getZoom()),T=o.f7(h.transform);T.y+=S*h.transform.height;const O=s.sub(T),R=o.cX(Math.atan2(O.y,O.x));g=(R>90?R-270:R+90)*(1-S)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Xm(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const h=this._map;if(!h)return;const g=this._pointerdownPos,x=this._positionDelta;if(g&&x){if(!this._isDragging){const S=this._clickTolerance||h._clickTolerance;if(s.point.dist(g)<S)return;this._isDragging=!0}this._pos=s.point.sub(x),this._lngLat=h.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(s){const h=this._map,g=this._pos;h&&g&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(g),this._pointerdownPos=s.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const h=this._map;return h&&(s?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||el.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||el.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||el.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||el.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const tl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},Km={maxWidth:100,unit:"metric"},A_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},DA={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},LR=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Bf(m=new o.P(0,0),s="bottom"){if(typeof m=="number"){const h=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(s){case"top":return new o.P(0,m);case"top-left":return new o.P(h,h);case"top-right":return new o.P(-h,h);case"bottom":return new o.P(0,-m);case"bottom-left":return new o.P(h,-h);case"bottom-right":return new o.P(-h,-h);case"left":return new o.P(m,0);case"right":return new o.P(-m,0)}return new o.P(0,0)}return m instanceof o.P||Array.isArray(m)?o.P.convert(m):o.P.convert(m[s]||[0,0])}return{version:v,supported:$.supported,setRTLTextPlugin:o.fb,getRTLTextPluginStatus:o.fa,Map:class extends PA{constructor(m){P.mark(w.create);const s=m;if((m=Object.assign({},Zm,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&o.f3(window)&&(m.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new $y(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies,null,null),m),this._repaint=!!m.repaint,this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._collectResourceTiming=m.collectResourceTiming,this._language=this._parseLanguage(m.language),this._worldview=m.worldview,this._renderTaskQueue=new OA,this._domRenderTaskQueue=new OA,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b2(),this._locale=Object.assign({},kA,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._performanceMetricsCollection=m.performanceMetricsCollection,this._tessellationStep=m.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=m.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new di(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=m.scaleFactor,this._requestManager=new nt(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,this._contextCreateOptions=m.contextCreateOptions?Object.assign({},m.contextCreateOptions):{},typeof m.container=="string"){const h=document.getElementById(m.container);if(!h)throw new Error(`Container '${m.container.toString()}' not found.`);this._container=h}else{if(!(m.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),this._spriteFormat=m.spriteFormat,o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new AA(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,(m.style||!m.testMode)&&this.setStyle(m.style||o.e.DEFAULT_STYLE,{config:m.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),m.hash&&(this._hash=new Ks(typeof m.hash=="string"&&m.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch});const h=m.bounds;h&&(this.resize(),this.fitBounds(h,Object.assign({},m.fitBoundsOptions,{duration:0})))}this.resize(),m.attributionControl&&this.addControl(new CA({customAttribution:m.customAttribution})),this._logoControl=new IA,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new o.z(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new o.z(`${h.dataType}dataloading`,h))}),this._interactions=new MR(this)}_getMapId(){return this._mapId}addControl(m,s){if(s===void 0&&(s=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=m.onAdd(this);this._controls.push(m);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(m);return s>-1&&this._controls.splice(s,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new o.z("movestart",m)).fire(new o.z("move",m)),this.fire(new o.z("resize",m)),s&&this.fire(new o.z("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(o.aI.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(m){return this._scaleFactor=m,this.painter.scaleFactor=m,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(m){return m==="auto"?navigator.language:Array.isArray(m)?m.length===0?void 0:m.map(s=>s==="auto"?navigator.language:s):m}setLanguage(m){const s=this._parseLanguage(m);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(m){return this.style&&m!==this._worldview?(this._worldview=m,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._useExplicitProjection=!!m,this._prioritizeAndUpdateProjection(m,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const m=this.transform,s=m.projection.name;let h;s==="globe"&&m.zoom>=o.cL?(m.setMercatorFromTransition(),h=!0):s==="mercator"&&m.zoom<o.cL&&(m.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(m,s){return this._updateProjection(m||s||{name:"mercator"})}_updateProjection(m){let s;const h=this.transform.mercatorFromTransition;s=m.name==="globe"&&this.transform.zoom>=o.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(m),this.style.applyProjectionUpdate();const g=this.transform.getProjection().name==="mercator"&&h!==this.transform.mercatorFromTransition;return(s||g)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(m,s){return this.transform.locationPoint3D(o.aT.convert(m),s)}unproject(m,s){return this.transform.pointLocation3D(o.P.convert(m),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(m,s,h){const g=x=>{let S=[];if(Array.isArray(s)){const T=s.filter(O=>this.getLayer(O));S=T.length?this.queryRenderedFeatures(x,{layers:T}):[]}else S=this.queryRenderedFeatures(x,{target:s});return S};if(m==="mouseenter"||m==="mouseover"){let x=!1;return{listener:h,targets:s,delegates:{mousemove:T=>{const O=g(T.point);O.length?x||(x=!0,h.call(this,new Ko(m,this,T.originalEvent,{features:O}))):x=!1},mouseout:()=>{x=!1}}}}if(m==="mouseleave"||m==="mouseout"){let x=!1;return{listener:h,targets:s,delegates:{mousemove:O=>{g(O.point).length?x=!0:x&&(x=!1,h.call(this,new Ko(m,this,O.originalEvent)))},mouseout:O=>{x&&(x=!1,h.call(this,new Ko(m,this,O.originalEvent)))}}}}{const x=S=>{const T=g(S.point);T.length&&(S.features=T,h.call(this,S),delete S.features)};return{listener:h,targets:s,delegates:{[m]:x}}}}on(m,s,h){if(typeof s=="function"||h===void 0)return super.on(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(g);for(const x in g.delegates)this.on(x,g.delegates[x]);return this}once(m,s,h){if(typeof s=="function"||h===void 0)return super.once(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._createDelegatedListener(m,s,h);for(const x in g.delegates)this.once(x,g.delegates[x]);return this}off(m,s,h){if(typeof s=="function"||h===void 0)return super.off(m,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const g=this._delegatedListeners?this._delegatedListeners[m]:void 0;return g&&(x=>{for(let S=0;S<x.length;S++){const T=x[S];if(T.listener===h&&DR(T.targets,s)){for(const O in T.delegates)this.off(O,T.delegates[O]);return x.splice(S,1),this}}})(g),this}queryRenderedFeatures(m,s){if(!this.style)return[];if(m===void 0||m instanceof o.P||Array.isArray(m)||s!==void 0||(s=m,m=void 0),m=m||[[0,0],[this.transform.width,this.transform.height]],!s){const S=this.style.queryRenderedFeatures(m,void 0,this.transform),T=this.style.queryRenderedFeatureset(m,void 0,this.transform);return S.concat(T)}let h=!0;if(s.target&&(h=this._isTargetValid(s.target),h&&!s.layers))return this.style.queryRenderedFeatureset(m,s,this.transform);let g=!0;if(s.layers&&Array.isArray(s.layers)){for(const S of s.layers)if(!this._isValidId(S)){g=!1;break}if(g&&!s.target)return this.style.queryRenderedFeatures(m,s,this.transform)}let x=[];return g&&(x=x.concat(this.style.queryRenderedFeatures(m,s,this.transform))),h&&(x=x.concat(this.style.queryRenderedFeatureset(m,s,this.transform))),x}querySourceFeatures(m,s){return!m||typeof m=="string"&&!this._isValidId(m)?[]:this.style.querySourceFeatures(m,s)}queryRasterValue(m,s,h){return this._isValidId(m)?this.style.queryRasterValue(m,s,h):Promise.resolve(null)}isPointOnSurface(m){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&o.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(m))}addInteraction(m,s){return this._interactions.add(m,s),this}removeInteraction(m){return this._interactions.remove(m),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(m){return this._cooperativeGestures=m,this}setStyle(m,s){return s=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&m&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(m,(h,g)=>{if(h){const x=typeof h=="string"?h:h instanceof Error?h.message:h.error;o.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(m,s)}else g&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(m,s))}_getUIString(m){const s=this._locale[m];if(s==null)throw new Error(`Missing UI string '${m}'`);return s}_updateStyle(m,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m){const h=Object.assign({},s);s&&s.config&&(h.initialConfig=s.config,delete h.config),this.style=new Ia(this,h).load(m),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ia(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(m){return m==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dr(m)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${m}".`))),!1)}_isTargetValid(m){return"featuresetId"in m?this._isValidId("importId"in m?m.importId:m.featuresetId):"layerId"in m&&this._isValidId(m.layerId)}_areTargetsValid(m){if(Array.isArray(m)){for(const s of m)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(m)}addSource(m,s){return this._isValidId(m)?(this._lazyInitEmptyStyle(),this.style.addSource(m,s),this._update(!0)):this}isSourceLoaded(m){return!!this._isValidId(m)&&!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(m,s,h){this._lazyInitEmptyStyle(),this.style.addSourceType(m,s,h)}removeSource(m){return this._isValidId(m)?(this.style.removeSource(m),this._updateTerrain(),this._update(!0)):this}getSource(m){return this._isValidId(m)?this.style.getOwnSource(m):null}addImage(m,s,{pixelRatio:h=1,sdf:g=!1,stretchX:x,stretchY:S,content:T}={}){this._lazyInitEmptyStyle();const O=o.I.from(m);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:R,height:z,data:F}=o.o.getImageData(s);this.style.addImage(O,{data:new o.q({width:R,height:z},F),pixelRatio:h,stretchX:x,stretchY:S,content:T,sdf:g,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:z}=s,F=s;this.style.addImage(O,{data:new o.q({width:R,height:z},new Uint8Array(F.data)),pixelRatio:h,stretchX:x,stretchY:S,content:T,sdf:g,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,m)}}updateImage(m,s){this._lazyInitEmptyStyle();const h=o.I.from(m),g=this.style.getImage(h);if(!g)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?o.o.getImageData(s):s,{width:S,height:T,data:O}=x;if(S===void 0||T===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(S!==(g.usvg?g.icon.usvg_tree.width:g.data.width)||T!==(g.usvg?g.icon.usvg_tree.height:g.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${S}, ${T})
                must be that same as the previous version of the image
                (${g.data.width}, ${g.data.height})`)));const R=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let z=!1;g.usvg?(g.data=new o.q({width:S,height:T},new Uint8Array(O)),g.usvg=!1,g.icon=void 0,z=!0):g.data.replace(O,R),this.style.updateImage(h,g,z)}hasImage(m){return m?!!this.style&&!!this.style.getImage(o.I.from(m)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(o.I.from(m))}loadImage(m,s){o.n(this._requestManager.transformRequest(m,o.R.Image),(h,g)=>{s(h,g instanceof HTMLImageElement?o.o.getImageData(g):g)})}listImages(){return this.style.listImages().map(m=>m.name)}addModel(m,s){this._lazyInitEmptyStyle(),this.style.addModel(m,s)}hasModel(m){return m?this.style.hasModel(m):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(m){this.style.removeModel(m)}listModels(){return this.style.listModels()}addLayer(m,s){return this._isValidId(m.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(m,s),this._update(!0)):this}getSlot(m){const s=this.getLayer(m);return s&&s.slot||null}setSlot(m,s){return this.style.setSlot(m,s),this.style.mergeLayers(),this._update(!0)}addImport(m,s){return this.style.addImport(m,s).catch(h=>this.fire(new o.y(new Error("Failed to add import",h)))),this}updateImport(m,s){return typeof s!="string"&&s.id!==m?(this.removeImport(m),this.addImport(s)):(this.style.updateImport(m,s),this._update(!0))}removeImport(m){return this.style.removeImport(m),this}moveImport(m,s){return this.style.moveImport(m,s),this._update(!0)}moveLayer(m,s){return this._isValidId(m)?(this.style.moveLayer(m,s),this._update(!0)):this}removeLayer(m){return this._isValidId(m)?(this.style.removeLayer(m),this._update(!0)):this}getLayer(m){if(!this._isValidId(m))return null;const s=this.style.getOwnLayer(m);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(m,s,h){return this._isValidId(m)?(this.style.setLayerZoomRange(m,s,h),this._update(!0)):this}setFilter(m,s,h={}){return this._isValidId(m)?(this.style.setFilter(m,s,h),this._update(!0)):this}getFilter(m){return this._isValidId(m)?this.style.getFilter(m):null}setPaintProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setPaintProperty(m,s,h,g),this._update(!0)):this}getPaintProperty(m,s){return this._isValidId(m)?this.style.getPaintProperty(m,s):null}setLayoutProperty(m,s,h,g={}){return this._isValidId(m)?(this.style.setLayoutProperty(m,s,h,g),this._update(!0)):this}getLayoutProperty(m,s){return this._isValidId(m)?this.style.getLayoutProperty(m,s):null}setLayerProperty(m,s,h,g={}){return this._isValidId(m)?(s==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(m,s,h,g),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(m){return this.style.setGlyphsUrl(m),this._update(!0)}getSchema(m){return this.style.getSchema(m)}setSchema(m,s){return this.style.setSchema(m,s),this._update(!0)}getConfig(m){return this.style.getConfig(m)}setConfig(m,s){return this.style.setConfig(m,s),this._update(!0)}getConfigProperty(m,s){return this.style.getConfigProperty(m,s)}setConfigProperty(m,s,h){return this.style.setConfigProperty(m,s,h),this._update(!0)}getFeaturesetDescriptors(m){return this.style.getFeaturesetDescriptors(m)}setLights(m){if(this._lazyInitEmptyStyle(),m&&m.length===1&&m[0].type==="flat"){const s=m[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(m),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const m=this.style.getLights()||[];return m.length===0&&m.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),m}setLight(m,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:m}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(m){return this._lazyInitEmptyStyle(),this.style.setSnow(m),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(m){return this._lazyInitEmptyStyle(),this.style.setRain(m),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(m){return this._lazyInitEmptyStyle(),this.style.setColorTheme(m),this._update(!0)}setImportColorTheme(m,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(m,s),this._update(!0)}setCamera(m){return this.style.setCamera(m),this._triggerCameraUpdate(m)}_triggerCameraUpdate(m){return this._update(this.transform.setOrthographicProjectionAtLowPitch(m["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aT.convert(m),this.transform):0}setFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.setFeatureState(m,s),this._update())}removeFeatureState(m,s){return m.source&&!this._isValidId(m.source)?this:(this.style.removeFeatureState(m,s),this._update())}getFeatureState(m){return m.source&&!this._isValidId(m.source)?null:this.style.getFeatureState(m)}_selectIndoorFloor(m){this.style.indoorManager.selectFloor(m)}_setIndoorActiveFloorsVisibility(m){this.style.indoorManager.setActiveFloorsVisibility(m)}getIndoorTileOptions(m,s){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(m,s):null}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let h,g,x,S=this._container;for(;S&&(!g||!x);){const T=window.getComputedStyle(S).transform;T&&T!=="none"&&(h=T.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&h[0]!=="0"&&h[0]!=="1"&&(g=h[0]),h[3]&&h[3]!=="0"&&h[3]!=="1"&&(x=h[3])),S=S.parentElement}this._containerWidth=g?Math.abs(m/g):m,this._containerHeight=x?Math.abs(s/x):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=j("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=j("div","mapboxgl-canvas-container",m);this._canvas=j("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=j("div","mapboxgl-control-container",m),g=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(x=>{g[x]=j("div",`mapboxgl-ctrl-${x}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,s){const h=o.o.devicePixelRatio||1;this._canvas.width=h*Math.ceil(m),this._canvas.height=h*Math.ceil(s),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${s}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const s=this._markers.indexOf(m);s!==-1&&this._markers.splice(s,1)}_addPopup(m){this._popups.push(m)}_removePopup(m){const s=this._popups.indexOf(m);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const m=Object.assign({},$.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",m);s?(ei(s,!0),this.painter=new pA(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",h=>{if(h.dataType==="source"){const g=this.transform.elevation?this.transform.elevation._source():null;g&&h.sourceCacheId===g.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),o.k.testSupport(s)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let s;this.fire(new o.z("renderstart")),++this._frameId;const h=this.painter.context.extTimerQuery,g=o.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=x.createQuery(),x.beginQuery(h.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,z=this.transform.pitch,F=o.o.now(),Z=new o.ac(R,{now:F,fadeDuration:S,pitch:z,transition:this.style.transition,worldview:this._worldview});this.style.update(Z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(g),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(g),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,P.mark(w.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const R=o.o.now()-g;x.endQuery(h.TIME_ELAPSED_EXT),setTimeout(()=>{const z=x.getQueryParameter(s,x.QUERY_RESULT)/1e6;x.deleteQuery(s),this.fire(new o.z("gpu-timing-frame",{cpuTime:R,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(R);this.fire(new o.z("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(R);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:z}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(O||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(T=this._updateAverageElevation(g,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,P.mark(w.fullLoad),this._performanceMetricsCollection&&Ir(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(m){for(const s of this._markers)m&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!m||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(m,s=!1){const h=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&h(0);const g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(s||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const x=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=m;const T=Math.abs(x-S);if(T>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(S),h(S);this._averageElevation.easeTo(S,m,300)}else if(T>1e-4)return this._averageElevation.jumpTo(S),h(S)}return!!this._averageElevation.isEasing(m)&&h(this._averageElevation.getValue(m))}_authenticate(){Vn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{if(m&&(m.message===Ze||m.status===401)){const s=this.painter.context.gl;ei(s,!1),this._logoControl instanceof IA&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Yr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&rr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Rt(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){ir(this._requestManager._customAccessToken)}_updateTerrain(){const m=this._isDragging();this.painter.updateTerrain(this.style,m)}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const h=this.painter.context.gl,g=h.createFramebuffer();function x(S){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,S,0);const T=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,T),T}return h.bindFramebuffer(h.FRAMEBUFFER,g),this._canvasPixelComparison(x(m),s.canvasCopies.map(x),s.timeStamps)}_canvasPixelComparison(m,s,h){let g=h[1]-h[0];const x=m.length/4;for(let S=0;S<s.length;S++){const T=s[S];let O=0;for(let R=0;R<T.length;R+=4)T[R]===m[R]&&T[R+1]===m[R+1]&&T[R+2]===m[R+2]&&T[R+3]===m[R+3]&&(O+=1);g+=(h[S+2]-h[S+1])*(1-O/x)}return g}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Hn.delete(this.painter.context.gl),Xr.remove(),ur.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=o.o.frame(s=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(s)}))}_preloadTiles(m){const s=this.style?this.style.getSourceCaches():[];return o.bw(s,(h,g)=>h._preloadTiles(m,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(m){this._showParseStatus!==m&&(this._showParseStatus=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(m){this._showLayers2DWireframe!==m&&(this._showLayers2DWireframe=m,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(m){this._showLayers3DWireframe!==m&&(this._showLayers3DWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,this.style&&m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(m){this._showTileAABBs!==m&&(this._showTileAABBs=m,m&&this._update())}_setCacheLimits(m,s){o.f4(m,s)}get version(){return v}},NavigationControl:class{constructor(m={}){this.options=Object.assign({},MA,m),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),j("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),j("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:s}):h.resetNorth({},{originalEvent:s}))}),this._compassIcon=j("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const s=m.getZoom(),h=s===m.getMaxZoom(),g=s===m.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tw(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,s){const h=j("button",m,this._container);return h.type="button",h.addEventListener("click",s),h}_setButtonTitle(m,s){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${s}`);m.setAttribute("aria-label",h),m.firstElementChild&&m.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends o.E{constructor(m={}){super();const s=navigator.geolocation;this.options=Object.assign({geolocation:s},tl,m),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=mA(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(m){return this._map=m,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(m){const s=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,m(h)};this._supportsGeolocation!==void 0?m(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(h=>s(h.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(m){const s=this._map.getMaxBounds(),h=m.coords;return!!s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(m),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:m.coords,timestamp:m.timestamp},m.toJSON?{toJSON:m.toJSON.bind(m)}:{}))),this._finish()}}_updateCamera(m){const s=new o.aT(m.coords.longitude,m.coords.latitude),h=m.coords.accuracy,g=this._map.getBearing(),x=Object.assign({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(h),x,{geolocateSource:!0})}_updateMarker(m){if(m){const s=new o.aT(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map.transform,s=o.cf(1,m._center.lat)*m.worldSize,h=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",{code:m.code,message:m.message,PERMISSION_DENIED:m.PERMISSION_DENIED,POSITION_UNAVAILABLE:m.POSITION_UNAVAILABLE,TIMEOUT:m.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const m=this.options.positionOptions.timeout;m&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},m))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(m){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=j("button","mapboxgl-ctrl-geolocate",this._container),j("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j("div","mapboxgl-user-location"),this._dotElement.appendChild(j("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Qi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(m={maximumAge:6e5,timeout:0},this._noTimeout=!0):(m=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,m),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(m){return this.options.followUserLocation=m??tl.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new o.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const m=()=>{const s="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(s,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&m()}).catch(console.error):m()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:CA,ScaleControl:class{constructor(m={}){this.options=Object.assign({},Km,m),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const m=this.options.maxWidth||100,s=this._map,h=s._containerHeight/2,g=s._containerWidth/2-m/2,x=s.unproject([g,h]),S=s.unproject([g+m,h]),T=x.distanceTo(S);if(this.options.unit==="imperial"){const O=3.2808*T;O>5280?this._setScale(m,O/5280,"mile"):this._setScale(m,O,"foot")}else this.options.unit==="nautical"?this._setScale(m,T/1852,"nautical-mile"):T>=1e3?this._setScale(m,T/1e3,"kilometer"):this._setScale(m,T,"meter")}_setScale(m,s,h){this._map._requestDomTask(()=>{const g=function(S){const T=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/T;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(R){const z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(O),T*O}(s),x=g/s;this._container.innerHTML=h!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:h}).format(g):`${g}&nbsp;${A_[h]}`,this._container.style.width=m*x+"px"})}onAdd(m){return this._map=m,this._language=m.getLanguage(),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(m){this._language=m,this._update()}setUnit(m){this.options.unit=m,this._update()}},FullscreenControl:class{constructor(m={}){this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=j("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Hx,Popup:class extends o.E{constructor(m){super(),this.options=Object.assign(Object.create(DA),m),this._altitude=this.options.altitude,o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),m._addPopup(this),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),m._canvasContainer&&m._canvasContainer.classList.remove("mapboxgl-track-pointer"),m._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=o.aT.convert(m),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(m){return this._altitude=m,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){const s=document.createDocumentFragment(),h=document.createElement("body");let g;for(h.innerHTML=m;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=j("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(m),this.options.closeButton){const h=this._closeButton=j("button","mapboxgl-popup-close-button",s);h.type="button",h.setAttribute("aria-label","Close popup"),h.innerHTML='<span aria-hidden="true">&#215;</span>',h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let s;return this._classList.delete(m)?s=!1:(this._classList.add(m),s=!0),this._updateClassList(),s}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const s=this._map,h=this._container,g=this._pos;if(!s||!h||!g)return"bottom";const x=h.offsetWidth,S=h.offsetHeight,T=g.x<x/2,O=g.x>s.transform.width-x/2;if(g.y+m<S)return T?"top-left":O?"top-right":"top";if(g.y>s.transform.height-S){if(T)return"bottom-left";if(O)return"bottom-right"}return T?"left":O?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),m.className=s.join(" ")}_update(m){const s=this._map,h=this._content;if(!s||!this._lngLat&&!this._trackPointer||!h)return;let g=this._container;if(g||(g=this._container=j("div","mapboxgl-popup",s.getContainer()),this._tip=j("div","mapboxgl-popup-tip",g),g.appendChild(h)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xm(this._lngLat,this._pos,s.transform)),!this._trackPointer||m){const x=this._pos=this._trackPointer&&m instanceof o.P?m:s.project(this._lngLat,this._altitude),S=Bf(this.options.offset),T=this._anchor=this._getAnchor(S.y),O=Bf(this.options.offset,T),R=x.add(O).round();s._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Wl[T]} translate(${R.x}px,${R.y}px)`)})}if(!this._marker&&s._showingGlobe()){const x=o.f5(s.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(LR);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._container&&(this._container.style.opacity=`${m}`),this._content&&(this._content.style.pointerEvents=m?"auto":"none")}},Marker:Qi,Style:Ia,LngLat:o.aT,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:bE,Evented:o.E,config:o.e,prewarm:o.f9,clearPrewarmedResources:o.f8,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(m){o.e.ACCESS_TOKEN=m},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(m){o.e.API_URL=m},get workerCount(){return o.fi.workerCount},set workerCount(m){o.fi.workerCount=m},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){o.e.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){o.fh(m)},get workerUrl(){return o.fg.workerUrl},set workerUrl(m){o.fg.workerUrl=m},get workerClass(){return o.fg.workerClass},set workerClass(m){o.fg.workerClass=m},get workerParams(){return o.fg.workerParams},set workerParams(m){o.fg.workerParams=m},get dracoUrl(){return o.ff()},set dracoUrl(m){o.fe(m)},get meshoptUrl(){return o.fd()},set meshoptUrl(m){o.fc(m)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var f=l;return f})})(Lne);var LIe=Lne.exports;const uv=zi(LIe),jIe={streets:"mapbox://styles/mapbox/streets-v12",satellite:"mapbox://styles/mapbox/satellite-streets-v12",terrain:"mapbox://styles/mapbox/outdoors-v12"};function NIe({listings:e,onListingHover:t,hoveredListingId:r}){const n=X.useRef(null),l=X.useRef(null),u=X.useRef({}),f=X.useRef(null),[o,v]=X.useState(null),[w,P]=X.useState(!0),[C,k]=X.useState("streets");X.useEffect(()=>{(async()=>{try{const{data:j,error:B}=await ni.functions.invoke("get-mapbox-token");if(B)throw B;v(j.token)}catch(j){console.error("Failed to fetch Mapbox token:",j)}finally{P(!1)}})()},[]),X.useEffect(()=>{if(!n.current||!o)return;uv.accessToken=o;const $=e.filter(U=>U.latitude&&U.longitude);let j=[-106.6504,35.0844],B=10;if($.length>0){const U=$.reduce((H,te)=>H+(te.latitude||0),0)/$.length;j=[$.reduce((H,te)=>H+(te.longitude||0),0)/$.length,U]}return l.current=new uv.Map({container:n.current,style:jIe[C],center:j,zoom:B}),l.current.addControl(new uv.NavigationControl,"top-left"),()=>{var U;(U=l.current)==null||U.remove()}},[o,C]),X.useEffect(()=>{if(!l.current||!o)return;Object.values(u.current).forEach(j=>j.remove()),u.current={},e.forEach(j=>{if(!j.latitude||!j.longitude)return;const B=document.createElement("div");B.className="listing-marker",B.innerHTML=`
        <div class="w-3 h-3 bg-foreground rounded-full border-2 border-background shadow-lg cursor-pointer transition-transform hover:scale-150" 
             data-listing-id="${j.id}">
        </div>
      `,B.style.cursor="pointer";const U=new uv.Marker(B).setLngLat([j.longitude,j.latitude]).addTo(l.current);B.addEventListener("mouseenter",()=>{t==null||t(j.id),L(j)}),B.addEventListener("mouseleave",()=>{var q;t==null||t(null),(q=f.current)==null||q.remove()}),B.addEventListener("click",()=>{window.location.href=`/listings/${j.slug}`}),u.current[j.id]=U});const $=e.filter(j=>j.latitude&&j.longitude);if($.length>1){const j=new uv.LngLatBounds;$.forEach(B=>{j.extend([B.longitude,B.latitude])}),l.current.fitBounds(j,{padding:50})}},[e,o,C,t]),X.useEffect(()=>{var j;if(!l.current)return;if(!r){(j=f.current)==null||j.remove();return}const $=e.find(B=>B.id===r);$&&$.latitude&&$.longitude&&L($)},[r,e]);const L=$=>{var B,U;if(!l.current||!$.latitude||!$.longitude)return;(B=f.current)==null||B.remove();const j="https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400&q=80";f.current=new uv.Popup({closeButton:!1,closeOnClick:!1,offset:15,className:"listing-popup"}).setLngLat([$.longitude,$.latitude]).setHTML(`
        <div class="bg-card rounded-lg overflow-hidden shadow-xl min-w-[240px]">
          <img src="${$.cover_image_url||j}" alt="${$.title}" class="w-full h-32 object-cover" />
          <div class="p-3">
            <p class="font-semibold text-lg">${BT($.price)}</p>
            <p class="text-sm text-muted-foreground">${$.beds||0} Bed | ${$.baths||0} Bath | ${((U=$.sqft)==null?void 0:U.toLocaleString())||"N/A"} Sqft</p>
            <p class="text-xs text-muted-foreground mt-1 truncate">${$.address}, ${$.city}</p>
          </div>
        </div>
      `).addTo(l.current)};return w?A.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:A.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Loading map..."})}):o?A.jsxs("div",{className:"relative w-full h-full",children:[A.jsx("div",{ref:n,className:"w-full h-full"}),A.jsxs("div",{className:"absolute top-4 right-4 flex bg-background/90 backdrop-blur-sm rounded-lg shadow-lg border border-border overflow-hidden",children:[A.jsx(fn,{variant:"ghost",size:"sm",onClick:()=>k("streets"),className:sr("rounded-none px-3 h-9",C==="streets"&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),title:"Streets",children:A.jsx(kye,{className:"h-4 w-4"})}),A.jsx(fn,{variant:"ghost",size:"sm",onClick:()=>k("satellite"),className:sr("rounded-none px-3 h-9 border-x border-border",C==="satellite"&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),title:"Satellite",children:A.jsx(Dye,{className:"h-4 w-4"})}),A.jsx(fn,{variant:"ghost",size:"sm",onClick:()=>k("terrain"),className:sr("rounded-none px-3 h-9",C==="terrain"&&"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground"),title:"Terrain",children:A.jsx(Rye,{className:"h-4 w-4"})})]})]}):A.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:A.jsx("p",{className:"text-muted-foreground text-center px-4",children:"Map unavailable. Please configure Mapbox token."})})}function zIe({listing:e,isHovered:t,onHover:r}){const[n,l]=X.useState(!1);return A.jsx(xi,{to:`/listings/${e.slug}`,className:"block group",onMouseEnter:()=>r==null?void 0:r(e.id),onMouseLeave:()=>r==null?void 0:r(null),children:A.jsxs("div",{className:sr("bg-card overflow-hidden transition-all duration-300",t&&"ring-2 ring-primary shadow-lg"),children:[A.jsxs("div",{className:"relative aspect-[16/10] overflow-hidden",children:[A.jsx("img",{src:e.cover_image_url||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800&q=80",alt:e.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"}),A.jsx("button",{onClick:f=>{f.preventDefault(),l(!n)},className:sr("absolute top-3 right-3 h-8 w-8 flex items-center justify-center rounded-full transition-all duration-300 z-10",n?"bg-primary text-white":"bg-white/90 text-muted-foreground hover:bg-primary hover:text-white"),children:A.jsx(Q3,{className:sr("h-4 w-4",n&&"fill-current")})}),e.open_house_schedule&&e.open_house_schedule.length>0&&A.jsx(Dh,{className:"absolute top-3 left-3 bg-white text-foreground text-xs",children:"Open House"})]}),A.jsxs("div",{className:"p-4",children:[A.jsx("p",{className:"font-semibold text-xl text-foreground",children:BT(e.price)}),A.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mt-1",children:[e.beds&&A.jsxs("span",{children:[e.beds," Bed"]}),e.baths&&A.jsxs(A.Fragment,{children:[A.jsx("span",{className:"text-border",children:"|"}),A.jsxs("span",{children:[e.baths," Bath"]})]}),e.sqft&&A.jsxs(A.Fragment,{children:[A.jsx("span",{className:"text-border",children:"|"}),A.jsxs("span",{children:[e.sqft.toLocaleString()," Sqft"]})]})]}),A.jsxs("p",{className:"text-sm text-muted-foreground mt-2 line-clamp-1",children:[e.address,", ",e.city,", ",e.state," ",e.zip]})]})]})})}function FIe(e,t){return X.useReducer((r,n)=>t[r][n]??r,e)}var T5="ScrollArea",[Nne,ret]=$l(T5),[BIe,ru]=Nne(T5),zne=X.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:n="hover",dir:l,scrollHideDelay:u=600,...f}=e,[o,v]=X.useState(null),[w,P]=X.useState(null),[C,k]=X.useState(null),[L,$]=X.useState(null),[j,B]=X.useState(null),[U,q]=X.useState(0),[H,te]=X.useState(0),[Q,ae]=X.useState(!1),[ue,me]=X.useState(!1),Ce=qn(t,Ge=>v(Ge)),Fe=YT(l);return A.jsx(BIe,{scope:r,type:n,dir:Fe,scrollHideDelay:u,scrollArea:o,viewport:w,onViewportChange:P,content:C,onContentChange:k,scrollbarX:L,onScrollbarXChange:$,scrollbarXEnabled:Q,onScrollbarXEnabledChange:ae,scrollbarY:j,onScrollbarYChange:B,scrollbarYEnabled:ue,onScrollbarYEnabledChange:me,onCornerWidthChange:q,onCornerHeightChange:te,children:A.jsx(nn.div,{dir:Fe,...f,ref:Ce,style:{position:"relative","--radix-scroll-area-corner-width":U+"px","--radix-scroll-area-corner-height":H+"px",...e.style}})})});zne.displayName=T5;var Fne="ScrollAreaViewport",Bne=X.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:n,nonce:l,...u}=e,f=ru(Fne,r),o=X.useRef(null),v=qn(t,o,f.onViewportChange);return A.jsxs(A.Fragment,{children:[A.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:l}),A.jsx(nn.div,{"data-radix-scroll-area-viewport":"",...u,ref:v,style:{overflowX:f.scrollbarXEnabled?"scroll":"hidden",overflowY:f.scrollbarYEnabled?"scroll":"hidden",...e.style},children:A.jsx("div",{ref:f.onContentChange,style:{minWidth:"100%",display:"table"},children:n})})]})});Bne.displayName=Fne;var Zd="ScrollAreaScrollbar",E5=X.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=ru(Zd,e.__scopeScrollArea),{onScrollbarXEnabledChange:u,onScrollbarYEnabledChange:f}=l,o=e.orientation==="horizontal";return X.useEffect(()=>(o?u(!0):f(!0),()=>{o?u(!1):f(!1)}),[o,u,f]),l.type==="hover"?A.jsx($Ie,{...n,ref:t,forceMount:r}):l.type==="scroll"?A.jsx(VIe,{...n,ref:t,forceMount:r}):l.type==="auto"?A.jsx($ne,{...n,ref:t,forceMount:r}):l.type==="always"?A.jsx(A5,{...n,ref:t}):null});E5.displayName=Zd;var $Ie=X.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=ru(Zd,e.__scopeScrollArea),[u,f]=X.useState(!1);return X.useEffect(()=>{const o=l.scrollArea;let v=0;if(o){const w=()=>{window.clearTimeout(v),f(!0)},P=()=>{v=window.setTimeout(()=>f(!1),l.scrollHideDelay)};return o.addEventListener("pointerenter",w),o.addEventListener("pointerleave",P),()=>{window.clearTimeout(v),o.removeEventListener("pointerenter",w),o.removeEventListener("pointerleave",P)}}},[l.scrollArea,l.scrollHideDelay]),A.jsx(wl,{present:r||u,children:A.jsx($ne,{"data-state":u?"visible":"hidden",...n,ref:t})})}),VIe=X.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=ru(Zd,e.__scopeScrollArea),u=e.orientation==="horizontal",f=tk(()=>v("SCROLL_END"),100),[o,v]=FIe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return X.useEffect(()=>{if(o==="idle"){const w=window.setTimeout(()=>v("HIDE"),l.scrollHideDelay);return()=>window.clearTimeout(w)}},[o,l.scrollHideDelay,v]),X.useEffect(()=>{const w=l.viewport,P=u?"scrollLeft":"scrollTop";if(w){let C=w[P];const k=()=>{const L=w[P];C!==L&&(v("SCROLL"),f()),C=L};return w.addEventListener("scroll",k),()=>w.removeEventListener("scroll",k)}},[l.viewport,u,v,f]),A.jsx(wl,{present:r||o!=="hidden",children:A.jsx(A5,{"data-state":o==="hidden"?"hidden":"visible",...n,ref:t,onPointerEnter:_r(e.onPointerEnter,()=>v("POINTER_ENTER")),onPointerLeave:_r(e.onPointerLeave,()=>v("POINTER_LEAVE"))})})}),$ne=X.forwardRef((e,t)=>{const r=ru(Zd,e.__scopeScrollArea),{forceMount:n,...l}=e,[u,f]=X.useState(!1),o=e.orientation==="horizontal",v=tk(()=>{if(r.viewport){const w=r.viewport.offsetWidth<r.viewport.scrollWidth,P=r.viewport.offsetHeight<r.viewport.scrollHeight;f(o?w:P)}},10);return N0(r.viewport,v),N0(r.content,v),A.jsx(wl,{present:n||u,children:A.jsx(A5,{"data-state":u?"visible":"hidden",...l,ref:t})})}),A5=X.forwardRef((e,t)=>{const{orientation:r="vertical",...n}=e,l=ru(Zd,e.__scopeScrollArea),u=X.useRef(null),f=X.useRef(0),[o,v]=X.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),w=Hne(o.viewport,o.content),P={...n,sizes:o,onSizesChange:v,hasThumb:w>0&&w<1,onThumbChange:k=>u.current=k,onThumbPointerUp:()=>f.current=0,onThumbPointerDown:k=>f.current=k};function C(k,L){return ZIe(k,f.current,o,L)}return r==="horizontal"?A.jsx(UIe,{...P,ref:t,onThumbPositionChange:()=>{if(l.viewport&&u.current){const k=l.viewport.scrollLeft,L=OW(k,o,l.dir);u.current.style.transform=`translate3d(${L}px, 0, 0)`}},onWheelScroll:k=>{l.viewport&&(l.viewport.scrollLeft=k)},onDragScroll:k=>{l.viewport&&(l.viewport.scrollLeft=C(k,l.dir))}}):r==="vertical"?A.jsx(GIe,{...P,ref:t,onThumbPositionChange:()=>{if(l.viewport&&u.current){const k=l.viewport.scrollTop,L=OW(k,o);u.current.style.transform=`translate3d(0, ${L}px, 0)`}},onWheelScroll:k=>{l.viewport&&(l.viewport.scrollTop=k)},onDragScroll:k=>{l.viewport&&(l.viewport.scrollTop=C(k))}}):null}),UIe=X.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...l}=e,u=ru(Zd,e.__scopeScrollArea),[f,o]=X.useState(),v=X.useRef(null),w=qn(t,v,u.onScrollbarXChange);return X.useEffect(()=>{v.current&&o(getComputedStyle(v.current))},[v]),A.jsx(Une,{"data-orientation":"horizontal",...l,ref:w,sizes:r,style:{bottom:0,left:u.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:u.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":ek(r)+"px",...e.style},onThumbPointerDown:P=>e.onThumbPointerDown(P.x),onDragScroll:P=>e.onDragScroll(P.x),onWheelScroll:(P,C)=>{if(u.viewport){const k=u.viewport.scrollLeft+P.deltaX;e.onWheelScroll(k),Zne(k,C)&&P.preventDefault()}},onResize:()=>{v.current&&u.viewport&&f&&n({content:u.viewport.scrollWidth,viewport:u.viewport.offsetWidth,scrollbar:{size:v.current.clientWidth,paddingStart:oI(f.paddingLeft),paddingEnd:oI(f.paddingRight)}})}})}),GIe=X.forwardRef((e,t)=>{const{sizes:r,onSizesChange:n,...l}=e,u=ru(Zd,e.__scopeScrollArea),[f,o]=X.useState(),v=X.useRef(null),w=qn(t,v,u.onScrollbarYChange);return X.useEffect(()=>{v.current&&o(getComputedStyle(v.current))},[v]),A.jsx(Une,{"data-orientation":"vertical",...l,ref:w,sizes:r,style:{top:0,right:u.dir==="ltr"?0:void 0,left:u.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":ek(r)+"px",...e.style},onThumbPointerDown:P=>e.onThumbPointerDown(P.y),onDragScroll:P=>e.onDragScroll(P.y),onWheelScroll:(P,C)=>{if(u.viewport){const k=u.viewport.scrollTop+P.deltaY;e.onWheelScroll(k),Zne(k,C)&&P.preventDefault()}},onResize:()=>{v.current&&u.viewport&&f&&n({content:u.viewport.scrollHeight,viewport:u.viewport.offsetHeight,scrollbar:{size:v.current.clientHeight,paddingStart:oI(f.paddingTop),paddingEnd:oI(f.paddingBottom)}})}})}),[qIe,Vne]=Nne(Zd),Une=X.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:n,hasThumb:l,onThumbChange:u,onThumbPointerUp:f,onThumbPointerDown:o,onThumbPositionChange:v,onDragScroll:w,onWheelScroll:P,onResize:C,...k}=e,L=ru(Zd,r),[$,j]=X.useState(null),B=qn(t,Ce=>j(Ce)),U=X.useRef(null),q=X.useRef(""),H=L.viewport,te=n.content-n.viewport,Q=ss(P),ae=ss(v),ue=tk(C,10);function me(Ce){if(U.current){const Fe=Ce.clientX-U.current.left,Ge=Ce.clientY-U.current.top;w({x:Fe,y:Ge})}}return X.useEffect(()=>{const Ce=Fe=>{const Ge=Fe.target;($==null?void 0:$.contains(Ge))&&Q(Fe,te)};return document.addEventListener("wheel",Ce,{passive:!1}),()=>document.removeEventListener("wheel",Ce,{passive:!1})},[H,$,te,Q]),X.useEffect(ae,[n,ae]),N0($,ue),N0(L.content,ue),A.jsx(qIe,{scope:r,scrollbar:$,hasThumb:l,onThumbChange:ss(u),onThumbPointerUp:ss(f),onThumbPositionChange:ae,onThumbPointerDown:ss(o),children:A.jsx(nn.div,{...k,ref:B,style:{position:"absolute",...k.style},onPointerDown:_r(e.onPointerDown,Ce=>{Ce.button===0&&(Ce.target.setPointerCapture(Ce.pointerId),U.current=$.getBoundingClientRect(),q.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",L.viewport&&(L.viewport.style.scrollBehavior="auto"),me(Ce))}),onPointerMove:_r(e.onPointerMove,me),onPointerUp:_r(e.onPointerUp,Ce=>{const Fe=Ce.target;Fe.hasPointerCapture(Ce.pointerId)&&Fe.releasePointerCapture(Ce.pointerId),document.body.style.webkitUserSelect=q.current,L.viewport&&(L.viewport.style.scrollBehavior=""),U.current=null})})})}),iI="ScrollAreaThumb",Gne=X.forwardRef((e,t)=>{const{forceMount:r,...n}=e,l=Vne(iI,e.__scopeScrollArea);return A.jsx(wl,{present:r||l.hasThumb,children:A.jsx(HIe,{ref:t,...n})})}),HIe=X.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:n,...l}=e,u=ru(iI,r),f=Vne(iI,r),{onThumbPositionChange:o}=f,v=qn(t,C=>f.onThumbChange(C)),w=X.useRef(void 0),P=tk(()=>{w.current&&(w.current(),w.current=void 0)},100);return X.useEffect(()=>{const C=u.viewport;if(C){const k=()=>{if(P(),!w.current){const L=XIe(C,o);w.current=L,o()}};return o(),C.addEventListener("scroll",k),()=>C.removeEventListener("scroll",k)}},[u.viewport,P,o]),A.jsx(nn.div,{"data-state":f.hasThumb?"visible":"hidden",...l,ref:v,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...n},onPointerDownCapture:_r(e.onPointerDownCapture,C=>{const L=C.target.getBoundingClientRect(),$=C.clientX-L.left,j=C.clientY-L.top;f.onThumbPointerDown({x:$,y:j})}),onPointerUp:_r(e.onPointerUp,f.onThumbPointerUp)})});Gne.displayName=iI;var P5="ScrollAreaCorner",qne=X.forwardRef((e,t)=>{const r=ru(P5,e.__scopeScrollArea),n=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&n?A.jsx(WIe,{...e,ref:t}):null});qne.displayName=P5;var WIe=X.forwardRef((e,t)=>{const{__scopeScrollArea:r,...n}=e,l=ru(P5,r),[u,f]=X.useState(0),[o,v]=X.useState(0),w=!!(u&&o);return N0(l.scrollbarX,()=>{var C;const P=((C=l.scrollbarX)==null?void 0:C.offsetHeight)||0;l.onCornerHeightChange(P),v(P)}),N0(l.scrollbarY,()=>{var C;const P=((C=l.scrollbarY)==null?void 0:C.offsetWidth)||0;l.onCornerWidthChange(P),f(P)}),w?A.jsx(nn.div,{...n,ref:t,style:{width:u,height:o,position:"absolute",right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function oI(e){return e?parseInt(e,10):0}function Hne(e,t){const r=e/t;return isNaN(r)?0:r}function ek(e){const t=Hne(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,n=(e.scrollbar.size-r)*t;return Math.max(n,18)}function ZIe(e,t,r,n="ltr"){const l=ek(r),u=l/2,f=t||u,o=l-f,v=r.scrollbar.paddingStart+f,w=r.scrollbar.size-r.scrollbar.paddingEnd-o,P=r.content-r.viewport,C=n==="ltr"?[0,P]:[P*-1,0];return Wne([v,w],C)(e)}function OW(e,t,r="ltr"){const n=ek(t),l=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,u=t.scrollbar.size-l,f=t.content-t.viewport,o=u-n,v=r==="ltr"?[0,f]:[f*-1,0],w=pz(e,v);return Wne([0,f],[0,o])(w)}function Wne(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const n=(t[1]-t[0])/(e[1]-e[0]);return t[0]+n*(r-e[0])}}function Zne(e,t){return e>0&&e<t}var XIe=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},n=0;return function l(){const u={left:e.scrollLeft,top:e.scrollTop},f=r.left!==u.left,o=r.top!==u.top;(f||o)&&t(),r=u,n=window.requestAnimationFrame(l)}(),()=>window.cancelAnimationFrame(n)};function tk(e,t){const r=ss(e),n=X.useRef(0);return X.useEffect(()=>()=>window.clearTimeout(n.current),[]),X.useCallback(()=>{window.clearTimeout(n.current),n.current=window.setTimeout(r,t)},[r,t])}function N0(e,t){const r=ss(t);fs(()=>{let n=0;if(e){const l=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(r)});return l.observe(e),()=>{window.cancelAnimationFrame(n),l.unobserve(e)}}},[e,r])}var Xne=zne,KIe=Bne,YIe=qne;const C5=X.forwardRef(({className:e,children:t,...r},n)=>A.jsxs(Xne,{ref:n,className:sr("relative overflow-hidden",e),...r,children:[A.jsx(KIe,{className:"h-full w-full rounded-[inherit]",children:t}),A.jsx(Kne,{}),A.jsx(YIe,{})]}));C5.displayName=Xne.displayName;const Kne=X.forwardRef(({className:e,orientation:t="vertical",...r},n)=>A.jsx(E5,{ref:n,orientation:t,className:sr("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:A.jsx(Gne,{className:"relative flex-1 rounded-full bg-border"})}));Kne.displayName=E5.displayName;function JIe(){const[e,t]=X.useState({}),[r,n]=X.useState(null),[l,u]=X.useState("grid"),{data:f,isLoading:o}=Kte(e);return A.jsxs("div",{className:"h-screen flex flex-col overflow-hidden",children:[A.jsx("header",{className:"bg-background border-b border-border px-4 py-3 flex-shrink-0",children:A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsx("a",{href:"/",className:"font-display text-xl font-semibold text-foreground",children:"Joel Aguirre Realty"}),A.jsxs("nav",{className:"hidden md:flex items-center gap-6 text-sm",children:[A.jsx("a",{href:"/",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Home"}),A.jsx("a",{href:"/listings",className:"text-foreground font-medium",children:"Search Listings"}),A.jsx("a",{href:"/contact",className:"text-muted-foreground hover:text-foreground transition-colors",children:"Contact"})]})]})}),A.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[A.jsx("div",{className:"hidden lg:block w-1/2 xl:w-[55%] relative",children:A.jsx(NIe,{listings:f||[],onListingHover:n,hoveredListingId:r})}),A.jsxs("div",{className:"w-full lg:w-1/2 xl:w-[45%] flex flex-col bg-background border-l border-border",children:[A.jsxs("div",{className:"p-4 border-b border-border flex-shrink-0",children:[A.jsx("h1",{className:"font-display text-2xl font-semibold text-foreground mb-4",children:"Properties for Sale"}),A.jsx(DIe,{filters:e,onFiltersChange:t})]}),A.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between flex-shrink-0",children:[f&&A.jsxs("p",{className:"text-sm text-muted-foreground",children:[A.jsx("span",{className:"font-semibold text-foreground",children:f.length})," of"," ",A.jsx("span",{className:"font-semibold text-foreground",children:f.length})," listings",A.jsxs("span",{className:"ml-2 text-primary cursor-pointer hover:underline",children:["Sort: ",e.sortBy==="price_asc"?"Price ":e.sortBy==="price_desc"?"Price ":"Newest"]})]}),A.jsxs("div",{className:"flex items-center gap-1",children:[A.jsx(fn,{variant:"ghost",size:"icon",className:sr("h-8 w-8",l==="list"&&"bg-muted"),onClick:()=>u("list"),children:A.jsx(Cye,{className:"h-4 w-4"})}),A.jsx(fn,{variant:"ghost",size:"icon",className:sr("h-8 w-8",l==="grid"&&"bg-muted"),onClick:()=>u("grid"),children:A.jsx(Pye,{className:"h-4 w-4"})})]})]}),A.jsx(C5,{className:"flex-1",children:A.jsx("div",{className:"p-4",children:o?A.jsx("div",{className:sr("gap-4",l==="grid"?"grid grid-cols-1 sm:grid-cols-2":"space-y-4"),children:[1,2,3,4,5,6].map(v=>A.jsxs("div",{className:"animate-pulse",children:[A.jsx("div",{className:"bg-muted aspect-[16/10]"}),A.jsx("div",{className:"mt-3 h-5 bg-muted w-3/4"}),A.jsx("div",{className:"mt-2 h-4 bg-muted w-1/2"})]},v))}):f&&f.length>0?A.jsx("div",{className:sr("gap-4",l==="grid"?"grid grid-cols-1 sm:grid-cols-2":"space-y-4"),children:f.map(v=>A.jsx(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:A.jsx(zIe,{listing:v,isHovered:r===v.id,onHover:n})},v.id))}):A.jsxs("div",{className:"text-center py-20",children:[A.jsx("div",{className:"h-16 w-16 bg-muted flex items-center justify-center mx-auto mb-6 rounded-full",children:A.jsx(EC,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("h3",{className:"font-display text-xl font-semibold mb-2",children:"No properties found"}),A.jsx("p",{className:"text-muted-foreground",children:"Try adjusting your filters or search criteria."})]})})})]})]})]})}const JT=X.forwardRef(({className:e,...t},r)=>A.jsx("textarea",{className:sr("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));JT.displayName="Textarea";const QIe=HT({name:Ss().min(2,"Name must be at least 2 characters"),email:Ss().email("Please enter a valid email"),phone:Ss().optional(),message:Ss().min(10,"Message must be at least 10 characters")});function Yne({listingId:e,listingTitle:t,type:r="contact"}){const[n,l]=X.useState(!1),[u,f]=X.useState(!1),{trackContactClick:o,trackScheduleShowing:v}=KO(),w=FS({resolver:BS(QIe),defaultValues:{name:"",email:"",phone:"",message:t?`I'm interested in "${t}"`:""}}),P=async C=>{l(!0);try{const{error:k}=await ni.from("contact_requests").insert({listing_id:e||null,name:C.name,email:C.email,phone:C.phone||null,message:C.message});if(k)throw k;r==="showing"?v(e):o(e),f(!0),w.reset(),setTimeout(()=>f(!1),3e3)}catch(k){Ni.error(`Failed to send message: ${k.message}`)}finally{l(!1)}};return A.jsx(O0,{mode:"wait",children:u?A.jsxs(Ar.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"py-12 text-center",children:[A.jsx("div",{className:"h-16 w-16 bg-success/10 rounded-full flex items-center justify-center mx-auto mb-4",children:A.jsx(K3,{className:"h-8 w-8 text-success"})}),A.jsx("h3",{className:"font-display text-xl font-bold mb-2",children:"Message Sent!"}),A.jsx("p",{className:"text-muted-foreground",children:"We'll get back to you shortly."})]},"success"):A.jsx(Ar.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:A.jsx(j0,{...w,children:A.jsxs("form",{onSubmit:w.handleSubmit(P),className:"space-y-4",children:[A.jsx(Gi,{control:w.control,name:"name",render:({field:C})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Name"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"Your name",className:"h-12 rounded-2xl",...C})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:w.control,name:"email",render:({field:C})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Email"}),A.jsx(Wi,{children:A.jsx(jn,{type:"email",placeholder:"your@email.com",className:"h-12 rounded-2xl",...C})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:w.control,name:"phone",render:({field:C})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Phone (optional)"}),A.jsx(Wi,{children:A.jsx(jn,{type:"tel",placeholder:"(555) 123-4567",className:"h-12 rounded-2xl",...C})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:w.control,name:"message",render:({field:C})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Message"}),A.jsx(Wi,{children:A.jsx(JT,{placeholder:"How can we help you?",className:"min-h-[120px] rounded-2xl resize-none",...C})}),A.jsx(Zi,{})]})}),A.jsx(fn,{type:"submit",className:"w-full h-12 bg-gradient-primary text-white rounded-2xl shadow-glow hover:shadow-lg hover:scale-[1.02] transition-all",disabled:n,children:n?A.jsxs(A.Fragment,{children:[A.jsx(Ld,{className:"h-5 w-5 mr-2 animate-spin"}),"Sending..."]}):A.jsxs(A.Fragment,{children:[A.jsx(Lye,{className:"h-5 w-5 mr-2"}),r==="showing"?"Request Showing":"Send Message"]})})]})})},"form")})}const Ci=X.forwardRef(({className:e,...t},r)=>A.jsx("div",{ref:r,className:sr("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));Ci.displayName="Card";const Vo=X.forwardRef(({className:e,...t},r)=>A.jsx("div",{ref:r,className:sr("flex flex-col space-y-1.5 p-6",e),...t}));Vo.displayName="CardHeader";const Uo=X.forwardRef(({className:e,...t},r)=>A.jsx("h3",{ref:r,className:sr("text-2xl font-semibold leading-none tracking-tight",e),...t}));Uo.displayName="CardTitle";const Zg=X.forwardRef(({className:e,...t},r)=>A.jsx("p",{ref:r,className:sr("text-sm text-muted-foreground",e),...t}));Zg.displayName="CardDescription";const Ii=X.forwardRef(({className:e,...t},r)=>A.jsx("div",{ref:r,className:sr("p-6 pt-0",e),...t}));Ii.displayName="CardContent";const eOe=X.forwardRef(({className:e,...t},r)=>A.jsx("div",{ref:r,className:sr("flex items-center p-6 pt-0",e),...t}));eOe.displayName="CardFooter";function tOe(){var v;const{slug:e}=qQ(),{data:t,isLoading:r}=z2e(e||""),{data:n}=F2e((t==null?void 0:t.id)||""),{trackOutboundClick:l}=KO(),[u,f]=X.useState(!1);if(WCe(t==null?void 0:t.id),r)return A.jsx(B1,{children:A.jsx("div",{className:"container py-32",children:A.jsxs("div",{className:"animate-pulse space-y-6",children:[A.jsx("div",{className:"h-[60vh] bg-muted"}),A.jsx("div",{className:"h-8 bg-muted w-1/2"})]})})});if(!t)return A.jsx(B1,{children:A.jsxs("div",{className:"container py-32 text-center",children:[A.jsx("h1",{className:"font-display text-2xl font-semibold",children:"Listing not found"}),A.jsx(fn,{asChild:!0,className:"mt-4 btn-primary rounded-none",children:A.jsx(xi,{to:"/listings",children:"Back to Listings"})})]})});const o=n!=null&&n.length?n.map(w=>w.image_url):[t.cover_image_url||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800&q=80"];return A.jsxs(B1,{children:[A.jsx("section",{className:"relative pt-20",children:A.jsxs("div",{className:"relative h-[50vh] md:h-[65vh]",children:[A.jsx("img",{src:o[0],alt:t.title,className:"w-full h-full object-cover"}),A.jsx("div",{className:"absolute inset-0 hero-overlay"}),A.jsx(xi,{to:"/listings",className:"absolute top-6 left-6 h-12 w-12 bg-white flex items-center justify-center hover:bg-secondary transition-colors shadow-elegant",children:A.jsx(gye,{className:"h-6 w-6"})}),A.jsxs("div",{className:"absolute top-6 right-6 flex gap-3",children:[A.jsx("button",{onClick:()=>f(!u),className:sr("h-12 w-12 flex items-center justify-center transition-all shadow-elegant",u?"bg-primary text-white":"bg-white hover:bg-secondary"),children:A.jsx(Q3,{className:sr("h-5 w-5",u&&"fill-current")})}),A.jsx("button",{className:"h-12 w-12 bg-white flex items-center justify-center hover:bg-secondary transition-colors shadow-elegant",children:A.jsx(jye,{className:"h-5 w-5"})})]}),A.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 md:p-12",children:A.jsx("div",{className:"container",children:A.jsxs(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[A.jsx(Dh,{className:sr("rounded-none px-4 py-1.5 mb-4 uppercase tracking-wider text-xs",IB(t.status)),children:CB(t.status)}),A.jsx("h1",{className:"font-display text-3xl md:text-5xl font-semibold text-white mb-3",children:t.title}),A.jsxs("div",{className:"flex items-center gap-2 text-white/80 mb-4",children:[A.jsx(Oh,{className:"h-5 w-5"}),A.jsxs("span",{children:[t.address,", ",t.city,", ",t.state," ",t.zip]})]}),A.jsxs("div",{className:"inline-flex items-center bg-white px-6 py-3 shadow-elegant",children:[A.jsx("span",{className:"font-display text-2xl md:text-3xl font-semibold text-foreground",children:BT(t.price)}),t.status==="for_rent"&&A.jsx("span",{className:"text-muted-foreground ml-2",children:"/month"})]})]})})})]})}),A.jsx("div",{className:"container py-12",children:A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[A.jsxs(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"lg:col-span-2 space-y-8",children:[A.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{icon:MJ,label:"Bedrooms",value:t.beds},{icon:RJ,label:"Bathrooms",value:t.baths},{icon:NJ,label:"Sq Ft",value:(v=t.sqft)==null?void 0:v.toLocaleString()},{icon:Z3,label:"Type",value:tSe(t.property_type)}].map(w=>w.value&&A.jsxs("div",{className:"p-4 bg-secondary text-center",children:[A.jsx(w.icon,{className:"h-6 w-6 mx-auto mb-2 text-muted-foreground"}),A.jsx("p",{className:"font-display text-lg font-semibold",children:w.value}),A.jsx("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:w.label})]},w.label))}),A.jsxs(Ci,{className:"border-0 shadow-card",children:[A.jsx(Vo,{children:A.jsx(Uo,{className:"font-display text-xl",children:"About This Property"})}),A.jsx(Ii,{children:A.jsx("p",{className:"text-muted-foreground leading-relaxed",children:t.description||"No description available for this property. Contact us for more details."})})]}),t.features_json&&t.features_json.length>0&&A.jsxs(Ci,{className:"border-0 shadow-card",children:[A.jsx(Vo,{children:A.jsx(Uo,{className:"font-display text-xl",children:"Features & Amenities"})}),A.jsx(Ii,{children:A.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:t.features_json.map((w,P)=>A.jsx("span",{className:"px-4 py-2 bg-secondary text-sm text-center",children:w},P))})})]}),t.zillow_url&&A.jsxs(fn,{variant:"outline",className:"rounded-none border-primary text-primary hover:bg-primary hover:text-white",onClick:()=>{l(t.id,t.zillow_url),window.open(t.zillow_url,"_blank")},children:[A.jsx(J3,{className:"h-4 w-4 mr-2"})," View on Zillow"]})]}),A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},className:"space-y-6",children:A.jsxs(Ci,{className:"border-0 shadow-card sticky top-24",children:[A.jsx(Vo,{children:A.jsx(Uo,{className:"font-display text-xl",children:"Schedule a Showing"})}),A.jsxs(Ii,{className:"space-y-4",children:[A.jsxs("div",{className:"flex gap-2",children:[A.jsxs(fn,{className:"flex-1 rounded-none",variant:"outline",children:[A.jsx(xS,{className:"h-4 w-4 mr-2"})," Call"]}),A.jsxs(fn,{className:"flex-1 rounded-none",variant:"outline",children:[A.jsx(T0,{className:"h-4 w-4 mr-2"})," Email"]})]}),A.jsx(Yne,{listingId:t.id,listingTitle:t.title,type:"showing"})]})]})})]})})]})}function rOe(){const e=[{icon:xS,label:"Phone",value:"(555) 123-4567",href:"tel:+15551234567"},{icon:T0,label:"Email",value:"joel@prestigerealestate.com",href:"mailto:joel@prestigerealestate.com"},{icon:Oh,label:"Office",value:"123 Main Street, Albuquerque, NM 87101",href:null},{icon:Y3,label:"Hours",value:"Mon-Fri 9AM-6PM, Sat 10AM-4PM",href:null}];return A.jsxs(B1,{children:[A.jsxs("section",{className:"relative min-h-[60vh] flex items-center justify-center overflow-hidden",children:[A.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary via-primary/95 to-primary/90"}),A.jsx("div",{className:"absolute inset-0 opacity-10",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),A.jsx("div",{className:"container relative z-10 py-24",children:A.jsxs(Ar.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center max-w-3xl mx-auto",children:[A.jsx("span",{className:"inline-block text-primary-foreground/70 uppercase tracking-[0.2em] text-sm mb-4",children:"Get In Touch"}),A.jsx("h1",{className:"font-display text-4xl md:text-5xl lg:text-6xl font-semibold text-primary-foreground mb-6",children:"Let's Find Your Perfect Home"}),A.jsx("p",{className:"text-primary-foreground/80 text-lg md:text-xl max-w-xl mx-auto",children:"Whether you're buying, selling, or just exploring your options, I'm here to guide you every step of the way."})]})}),A.jsx("div",{className:"absolute bottom-0 left-0 right-0",children:A.jsx("svg",{viewBox:"0 0 1440 120",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:"w-full",children:A.jsx("path",{d:"M0 120L60 110C120 100 240 80 360 70C480 60 600 60 720 65C840 70 960 80 1080 85C1200 90 1320 90 1380 90L1440 90V120H1380C1320 120 1200 120 1080 120C960 120 840 120 720 120C600 120 480 120 360 120C240 120 120 120 60 120H0Z",fill:"hsl(var(--background))"})})})]}),A.jsx("section",{className:"py-16 md:py-24",children:A.jsx("div",{className:"container",children:A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-20",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},className:"space-y-8",children:[A.jsxs("div",{className:"relative",children:[A.jsx("div",{className:"absolute -inset-4 bg-gradient-to-br from-primary/10 to-transparent rounded-3xl"}),A.jsx(Ci,{className:"relative border-0 shadow-elegant overflow-hidden",children:A.jsx(Ii,{className:"p-0",children:A.jsxs("div",{className:"flex flex-col sm:flex-row",children:[A.jsx("div",{className:"sm:w-48 h-48 sm:h-auto shrink-0",children:A.jsx("img",{src:Jte,alt:"Joel Aguirre",className:"w-full h-full object-cover"})}),A.jsxs("div",{className:"p-6 flex flex-col justify-center",children:[A.jsx("span",{className:"text-xs uppercase tracking-wider text-muted-foreground mb-1",children:"Your Agent"}),A.jsx("h2",{className:"font-display text-2xl font-semibold mb-2",children:"Joel Aguirre"}),A.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Licensed Realtor with 15+ years of experience helping families find their dream homes in the Albuquerque area."}),A.jsxs("a",{href:"tel:+15551234567",className:"inline-flex items-center text-primary font-medium text-sm hover:underline",children:["Schedule a Call",A.jsx(Wv,{className:"h-4 w-4 ml-1"})]})]})]})})})]}),A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.map((t,r)=>A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,delay:.3+r*.1},children:t.href?A.jsxs("a",{href:t.href,className:"group flex items-start gap-4 p-5 bg-secondary/50 hover:bg-secondary transition-colors rounded-xl",children:[A.jsx("div",{className:"h-11 w-11 bg-primary rounded-lg flex items-center justify-center shrink-0 group-hover:scale-105 transition-transform",children:A.jsx(t.icon,{className:"h-5 w-5 text-primary-foreground"})}),A.jsxs("div",{children:[A.jsx("p",{className:"text-xs uppercase tracking-wider text-muted-foreground mb-1",children:t.label}),A.jsx("p",{className:"font-medium text-sm group-hover:text-primary transition-colors",children:t.value})]})]}):A.jsxs("div",{className:"flex items-start gap-4 p-5 bg-secondary/50 rounded-xl",children:[A.jsx("div",{className:"h-11 w-11 bg-primary rounded-lg flex items-center justify-center shrink-0",children:A.jsx(t.icon,{className:"h-5 w-5 text-primary-foreground"})}),A.jsxs("div",{children:[A.jsx("p",{className:"text-xs uppercase tracking-wider text-muted-foreground mb-1",children:t.label}),A.jsx("p",{className:"font-medium text-sm",children:t.value})]})]})},t.label))}),A.jsxs("div",{className:"bg-gradient-to-br from-accent/30 to-accent/10 rounded-2xl p-6",children:[A.jsx("h3",{className:"font-display text-lg font-semibold mb-3",children:"Why Work With Me?"}),A.jsx("ul",{className:"space-y-3 text-sm text-muted-foreground",children:["Deep knowledge of the Albuquerque and Rio Rancho markets","Personalized service tailored to your unique needs","Strong negotiation skills to get you the best deal","Available 7 days a week for showings and questions"].map((t,r)=>A.jsxs("li",{className:"flex items-start gap-3",children:[A.jsx("div",{className:"h-1.5 w-1.5 bg-primary rounded-full mt-2 shrink-0"}),t]},r))})]})]}),A.jsx(Ar.div,{initial:{opacity:0,x:30},animate:{opacity:1,x:0},transition:{duration:.6,delay:.3},children:A.jsx("div",{className:"sticky top-24",children:A.jsxs(Ci,{className:"border-0 shadow-elegant rounded-2xl overflow-hidden",children:[A.jsxs("div",{className:"bg-primary p-6",children:[A.jsx("h2",{className:"font-display text-2xl font-semibold text-primary-foreground",children:"Send a Message"}),A.jsx("p",{className:"text-primary-foreground/70 text-sm mt-1",children:"I typically respond within a few hours"})]}),A.jsx(Ii,{className:"p-6 md:p-8",children:A.jsx(Yne,{})})]})})})]})})}),A.jsx("section",{className:"border-t border-border",children:A.jsxs("div",{className:"h-[400px] bg-muted relative overflow-hidden",children:[A.jsx("iframe",{src:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d209892.35324428893!2d-106.76267705!3d35.10673945!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x87220addd309837b%3A0xc0d3f8ceb8f9f6cd!2sAlbuquerque%2C%20NM!5e0!3m2!1sen!2sus!4v1699900000000!5m2!1sen!2sus",width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Office Location",className:"grayscale hover:grayscale-0 transition-all duration-500"}),A.jsxs("div",{className:"absolute bottom-6 left-6 bg-background/95 backdrop-blur-sm rounded-xl p-4 shadow-lg",children:[A.jsx("p",{className:"font-display font-semibold text-sm",children:"Prestige Real Estate"}),A.jsx("p",{className:"text-muted-foreground text-xs",children:"123 Main Street, Albuquerque, NM"})]})]})})]})}var CL="rovingFocusGroup.onEntryFocus",nOe={bubbles:!1,cancelable:!0},QT="RovingFocusGroup",[xz,Jne,iOe]=SO(QT),[oOe,rk]=$l(QT,[iOe]),[sOe,aOe]=oOe(QT),Qne=X.forwardRef((e,t)=>A.jsx(xz.Provider,{scope:e.__scopeRovingFocusGroup,children:A.jsx(xz.Slot,{scope:e.__scopeRovingFocusGroup,children:A.jsx(lOe,{...e,ref:t})})}));Qne.displayName=QT;var lOe=X.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:n,loop:l=!1,dir:u,currentTabStopId:f,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:v,onEntryFocus:w,preventScrollOnEntryFocus:P=!1,...C}=e,k=X.useRef(null),L=qn(t,k),$=YT(u),[j,B]=qp({prop:f,defaultProp:o??null,onChange:v,caller:QT}),[U,q]=X.useState(!1),H=ss(w),te=Jne(r),Q=X.useRef(!1),[ae,ue]=X.useState(0);return X.useEffect(()=>{const me=k.current;if(me)return me.addEventListener(CL,H),()=>me.removeEventListener(CL,H)},[H]),A.jsx(sOe,{scope:r,orientation:n,dir:$,loop:l,currentTabStopId:j,onItemFocus:X.useCallback(me=>B(me),[B]),onItemShiftTab:X.useCallback(()=>q(!0),[]),onFocusableItemAdd:X.useCallback(()=>ue(me=>me+1),[]),onFocusableItemRemove:X.useCallback(()=>ue(me=>me-1),[]),children:A.jsx(nn.div,{tabIndex:U||ae===0?-1:0,"data-orientation":n,...C,ref:L,style:{outline:"none",...e.style},onMouseDown:_r(e.onMouseDown,()=>{Q.current=!0}),onFocus:_r(e.onFocus,me=>{const Ce=!Q.current;if(me.target===me.currentTarget&&Ce&&!U){const Fe=new CustomEvent(CL,nOe);if(me.currentTarget.dispatchEvent(Fe),!Fe.defaultPrevented){const Ge=te().filter(rt=>rt.focusable),Ve=Ge.find(rt=>rt.active),Ze=Ge.find(rt=>rt.id===j),dt=[Ve,Ze,...Ge].filter(Boolean).map(rt=>rt.ref.current);rie(dt,P)}}Q.current=!1}),onBlur:_r(e.onBlur,()=>q(!1))})})}),eie="RovingFocusGroupItem",tie=X.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:n=!0,active:l=!1,tabStopId:u,children:f,...o}=e,v=jd(),w=u||v,P=aOe(eie,r),C=P.currentTabStopId===w,k=Jne(r),{onFocusableItemAdd:L,onFocusableItemRemove:$,currentTabStopId:j}=P;return X.useEffect(()=>{if(n)return L(),()=>$()},[n,L,$]),A.jsx(xz.ItemSlot,{scope:r,id:w,focusable:n,active:l,children:A.jsx(nn.span,{tabIndex:C?0:-1,"data-orientation":P.orientation,...o,ref:t,onMouseDown:_r(e.onMouseDown,B=>{n?P.onItemFocus(w):B.preventDefault()}),onFocus:_r(e.onFocus,()=>P.onItemFocus(w)),onKeyDown:_r(e.onKeyDown,B=>{if(B.key==="Tab"&&B.shiftKey){P.onItemShiftTab();return}if(B.target!==B.currentTarget)return;const U=dOe(B,P.orientation,P.dir);if(U!==void 0){if(B.metaKey||B.ctrlKey||B.altKey||B.shiftKey)return;B.preventDefault();let H=k().filter(te=>te.focusable).map(te=>te.ref.current);if(U==="last")H.reverse();else if(U==="prev"||U==="next"){U==="prev"&&H.reverse();const te=H.indexOf(B.currentTarget);H=P.loop?hOe(H,te+1):H.slice(te+1)}setTimeout(()=>rie(H))}}),children:typeof f=="function"?f({isCurrentTabStop:C,hasTabStop:j!=null}):f})})});tie.displayName=eie;var cOe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function uOe(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function dOe(e,t,r){const n=uOe(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return cOe[n]}function rie(e,t=!1){const r=document.activeElement;for(const n of e)if(n===r||(n.focus({preventScroll:t}),document.activeElement!==r))return}function hOe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}var nie=Qne,iie=tie,nk="Tabs",[fOe,net]=$l(nk,[rk]),oie=rk(),[pOe,I5]=fOe(nk),sie=X.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,onValueChange:l,defaultValue:u,orientation:f="horizontal",dir:o,activationMode:v="automatic",...w}=e,P=YT(o),[C,k]=qp({prop:n,onChange:l,defaultProp:u??"",caller:nk});return A.jsx(pOe,{scope:r,baseId:jd(),value:C,onValueChange:k,orientation:f,dir:P,activationMode:v,children:A.jsx(nn.div,{dir:P,"data-orientation":f,...w,ref:t})})});sie.displayName=nk;var aie="TabsList",lie=X.forwardRef((e,t)=>{const{__scopeTabs:r,loop:n=!0,...l}=e,u=I5(aie,r),f=oie(r);return A.jsx(nie,{asChild:!0,...f,orientation:u.orientation,dir:u.dir,loop:n,children:A.jsx(nn.div,{role:"tablist","aria-orientation":u.orientation,...l,ref:t})})});lie.displayName=aie;var cie="TabsTrigger",uie=X.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,disabled:l=!1,...u}=e,f=I5(cie,r),o=oie(r),v=fie(f.baseId,n),w=pie(f.baseId,n),P=n===f.value;return A.jsx(iie,{asChild:!0,...o,focusable:!l,active:P,children:A.jsx(nn.button,{type:"button",role:"tab","aria-selected":P,"aria-controls":w,"data-state":P?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:v,...u,ref:t,onMouseDown:_r(e.onMouseDown,C=>{!l&&C.button===0&&C.ctrlKey===!1?f.onValueChange(n):C.preventDefault()}),onKeyDown:_r(e.onKeyDown,C=>{[" ","Enter"].includes(C.key)&&f.onValueChange(n)}),onFocus:_r(e.onFocus,()=>{const C=f.activationMode!=="manual";!P&&!l&&C&&f.onValueChange(n)})})})});uie.displayName=cie;var die="TabsContent",hie=X.forwardRef((e,t)=>{const{__scopeTabs:r,value:n,forceMount:l,children:u,...f}=e,o=I5(die,r),v=fie(o.baseId,n),w=pie(o.baseId,n),P=n===o.value,C=X.useRef(P);return X.useEffect(()=>{const k=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(k)},[]),A.jsx(wl,{present:l||P,children:({present:k})=>A.jsx(nn.div,{"data-state":P?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":v,hidden:!k,id:w,tabIndex:0,...f,ref:t,style:{...e.style,animationDuration:C.current?"0s":void 0},children:k&&u})})});hie.displayName=die;function fie(e,t){return`${e}-trigger-${t}`}function pie(e,t){return`${e}-content-${t}`}var mOe=sie,mie=lie,gie=uie,yie=hie;const ik=mOe,eE=X.forwardRef(({className:e,...t},r)=>A.jsx(mie,{ref:r,className:sr("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));eE.displayName=mie.displayName;const Vu=X.forwardRef(({className:e,...t},r)=>A.jsx(gie,{ref:r,className:sr("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",e),...t}));Vu.displayName=gie.displayName;const Uu=X.forwardRef(({className:e,...t},r)=>A.jsx(yie,{ref:r,className:sr("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));Uu.displayName=yie.displayName;const gOe=HT({email:Ss().email("Please enter a valid email"),password:Ss().min(6,"Password must be at least 6 characters"),name:Ss().optional()});function yOe(){const[e,t]=X.useState(!1),{signIn:r,signUp:n,user:l}=sf(),u=MO();X.useEffect(()=>{l&&u("/admin")},[l,u]);const f=FS({resolver:BS(gOe),defaultValues:{email:"",password:"",name:""}}),o=async w=>{t(!0);const{error:P}=await r(w.email,w.password);t(!1),P?Ni.error(P.message):(Ni.success("Welcome back!"),u("/admin"))},v=async w=>{t(!0);const{error:P}=await n(w.email,w.password,w.name);t(!1),P?Ni.error(P.message):(Ni.success("Account created successfully!"),u("/admin"))};return l?null:A.jsx("div",{className:"min-h-screen flex items-center justify-center p-4 bg-secondary",children:A.jsxs(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"w-full max-w-md",children:[A.jsx("div",{className:"text-center mb-8",children:A.jsxs(xi,{to:"/",className:"inline-block",children:[A.jsx("span",{className:"font-display text-3xl font-semibold tracking-wide text-foreground",children:"PRESTIGE"}),A.jsx("div",{className:"text-[10px] uppercase tracking-luxury text-muted-foreground",children:"Real Estate"})]})}),A.jsxs(Ci,{className:"border-0 shadow-elegant",children:[A.jsxs(Vo,{className:"text-center pb-2",children:[A.jsx(Uo,{className:"font-display text-2xl",children:"Welcome"}),A.jsx(Zg,{children:"Sign in to manage your listings"})]}),A.jsx(Ii,{className:"pt-4",children:A.jsxs(ik,{defaultValue:"signin",children:[A.jsxs(eE,{className:"grid w-full grid-cols-2 mb-6 p-1 bg-secondary rounded-none",children:[A.jsx(Vu,{value:"signin",className:"rounded-none data-[state=active]:bg-white data-[state=active]:shadow-sm uppercase text-xs tracking-wider",children:"Sign In"}),A.jsx(Vu,{value:"signup",className:"rounded-none data-[state=active]:bg-white data-[state=active]:shadow-sm uppercase text-xs tracking-wider",children:"Sign Up"})]}),A.jsx(Uu,{value:"signin",children:A.jsx(j0,{...f,children:A.jsxs("form",{onSubmit:f.handleSubmit(o),className:"space-y-4",children:[A.jsx(Gi,{control:f.control,name:"email",render:({field:w})=>A.jsxs(qi,{children:[A.jsx(Hi,{className:"text-xs uppercase tracking-wider",children:"Email"}),A.jsx(Wi,{children:A.jsx(jn,{type:"email",placeholder:"agent@example.com",className:"h-12 rounded-none border-border",...w})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:f.control,name:"password",render:({field:w})=>A.jsxs(qi,{children:[A.jsx(Hi,{className:"text-xs uppercase tracking-wider",children:"Password"}),A.jsx(Wi,{children:A.jsx(jn,{type:"password",placeholder:"",className:"h-12 rounded-none border-border",...w})}),A.jsx(Zi,{})]})}),A.jsx(fn,{type:"submit",className:"w-full h-12 btn-primary rounded-none",disabled:e,children:e?A.jsx(Ld,{className:"h-5 w-5 animate-spin"}):"Sign In"})]})})}),A.jsx(Uu,{value:"signup",children:A.jsx(j0,{...f,children:A.jsxs("form",{onSubmit:f.handleSubmit(v),className:"space-y-4",children:[A.jsx(Gi,{control:f.control,name:"name",render:({field:w})=>A.jsxs(qi,{children:[A.jsx(Hi,{className:"text-xs uppercase tracking-wider",children:"Name"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"Your name",className:"h-12 rounded-none border-border",...w})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:f.control,name:"email",render:({field:w})=>A.jsxs(qi,{children:[A.jsx(Hi,{className:"text-xs uppercase tracking-wider",children:"Email"}),A.jsx(Wi,{children:A.jsx(jn,{type:"email",placeholder:"agent@example.com",className:"h-12 rounded-none border-border",...w})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:f.control,name:"password",render:({field:w})=>A.jsxs(qi,{children:[A.jsx(Hi,{className:"text-xs uppercase tracking-wider",children:"Password"}),A.jsx(Wi,{children:A.jsx(jn,{type:"password",placeholder:"",className:"h-12 rounded-none border-border",...w})}),A.jsx(Zi,{})]})}),A.jsx(fn,{type:"submit",className:"w-full h-12 btn-primary rounded-none",disabled:e,children:e?A.jsx(Ld,{className:"h-5 w-5 animate-spin"}):"Create Account"})]})})})]})})]})]})})}const _Oe=()=>{const e=Ty();return X.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),A.jsx("div",{className:"flex min-h-screen items-center justify-center bg-muted",children:A.jsxs("div",{className:"text-center",children:[A.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),A.jsx("p",{className:"mb-4 text-xl text-muted-foreground",children:"Oops! Page not found"}),A.jsx("a",{href:"/",className:"text-primary underline hover:text-primary/90",children:"Return to Home"})]})})},kW=[{href:"/admin",label:"Dashboard",icon:Aye},{href:"/admin/listings",label:"Listings",icon:Ud},{href:"/admin/contacts",label:"Contacts",icon:vS},{href:"/admin/import",label:"Import",icon:AO},{href:"/admin/analytics",label:"Analytics",icon:eN},{href:"/admin/settings",label:"Settings",icon:jJ}];function Jh({children:e}){const{user:t,isLoading:r,isAdmin:n,signOut:l}=sf(),u=MO(),f=Ty(),[o,v]=X.useState(!1);if(X.useEffect(()=>{!r&&!t&&u("/auth")},[t,r,u]),r)return A.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-mesh",children:A.jsx(Ar.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"h-12 w-12 rounded-full border-4 border-primary border-t-transparent"})});if(!t)return null;const w=async()=>{await l(),u("/")},P=()=>A.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-b from-card to-background border-r border-border/50",children:[A.jsx("div",{className:"p-6 border-b border-border/50",children:A.jsxs(xi,{to:"/",className:"flex items-center gap-3 group",children:[A.jsx(Ar.div,{whileHover:{scale:1.05,rotate:5},className:"h-10 w-10 bg-gradient-primary rounded-2xl flex items-center justify-center shadow-glow",children:A.jsx(EC,{className:"h-5 w-5 text-primary-foreground"})}),A.jsxs("div",{children:[A.jsx("span",{className:"font-display text-xl font-bold text-gradient",children:"Prestige"}),A.jsx("span",{className:"block text-xs text-muted-foreground",children:"Admin Portal"})]})]})}),A.jsxs(C5,{className:"flex-1 px-4 py-6",children:[A.jsx("nav",{className:"space-y-1",children:kW.map((k,L)=>{const $=f.pathname===k.href||k.href!=="/admin"&&f.pathname.startsWith(k.href);return A.jsx(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:L*.05},children:A.jsxs(xi,{to:k.href,onClick:()=>v(!1),className:sr("flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200",$?"bg-primary text-white shadow-md":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[A.jsx(k.icon,{className:"h-5 w-5"}),k.label,$&&A.jsx("span",{className:"ml-auto h-2 w-2 rounded-full bg-white/80"})]})},k.href)})}),A.jsx("div",{className:"mt-6 pt-4 border-t border-border/50",children:A.jsxs(xi,{to:"/",target:"_blank",className:"flex items-center gap-3 px-4 py-3 rounded-2xl text-sm font-medium text-muted-foreground hover:bg-accent/50 hover:text-foreground transition-all",children:[A.jsx(AG,{className:"h-5 w-5"}),"View Website",A.jsx(J3,{className:"h-3 w-3 ml-auto"})]})})]}),A.jsxs("div",{className:"p-4 border-t border-border/50 bg-muted/30 backdrop-blur-sm",children:[A.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 rounded-2xl bg-background/50",children:[A.jsx("div",{className:"h-11 w-11 rounded-full bg-gradient-primary flex items-center justify-center shadow-md",children:A.jsx(wS,{className:"h-5 w-5 text-primary-foreground"})}),A.jsxs("div",{className:"flex-1 min-w-0",children:[A.jsx("p",{className:"text-sm font-medium truncate",children:t.email}),A.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[A.jsx("span",{className:sr("h-2 w-2 rounded-full",n?"bg-primary":"bg-accent")}),n?"Admin":"Agent"]})]})]}),A.jsxs(fn,{variant:"ghost",className:"w-full justify-start rounded-xl text-muted-foreground hover:text-foreground hover:bg-destructive/10 hover:text-destructive transition-all",onClick:w,children:[A.jsx(Oye,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]}),C=()=>{const k=kW.find(L=>f.pathname===L.href||L.href!=="/admin"&&f.pathname.startsWith(L.href));return(k==null?void 0:k.label)||"Admin"};return A.jsxs("div",{className:"min-h-screen bg-gradient-mesh",children:[A.jsxs("header",{className:"lg:hidden fixed top-0 left-0 right-0 z-50 h-16 bg-background/80 backdrop-blur-xl border-b border-border/50 flex items-center justify-between px-4",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx(fn,{variant:"ghost",size:"icon",onClick:()=>v(!o),className:"rounded-xl",children:o?A.jsx(Hp,{className:"h-5 w-5"}):A.jsx(LJ,{className:"h-5 w-5"})}),A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx("div",{className:"h-8 w-8 bg-gradient-primary rounded-lg flex items-center justify-center",children:A.jsx(EC,{className:"h-4 w-4 text-primary-foreground"})}),A.jsx("span",{className:"font-medium text-sm",children:C()})]})]}),A.jsxs(xi,{to:"/",target:"_blank",className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-muted text-xs font-medium hover:bg-accent transition-colors",children:[A.jsx(AG,{className:"h-3.5 w-3.5"}),"View Site"]})]}),A.jsx(O0,{children:o&&A.jsx(Ar.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"lg:hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-sm",onClick:()=>v(!1)})}),A.jsx(O0,{children:o&&A.jsx(Ar.aside,{initial:{x:"-100%"},animate:{x:0},exit:{x:"-100%"},transition:{type:"spring",damping:25,stiffness:300},className:"lg:hidden fixed top-16 bottom-0 left-0 z-50 w-72",children:A.jsx(P,{})})}),A.jsx("aside",{className:"hidden lg:block fixed top-0 left-0 bottom-0 w-72 z-40",children:A.jsx(P,{})}),A.jsx("main",{className:"lg:pl-72 pt-16 lg:pt-0 min-h-screen",children:A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"p-6 lg:p-8",children:e})})]})}function vOe(){const{user:e}=sf(),{data:t}=$O(),{data:r}=Qc({queryKey:["admin-stats",e==null?void 0:e.id,t],queryFn:async()=>{if(!e)return{views:0,contacts:0};const o=(t==null?void 0:t.map(P=>P.id))||[];let v=0,w=0;if(o.length>0){const{count:P}=await ni.from("events").select("*",{count:"exact",head:!0}).eq("event_type","page_view").in("listing_id",o),{count:C}=await ni.from("contact_requests").select("*",{count:"exact",head:!0}).in("listing_id",o);v=P||0,w=C||0}return{views:v,contacts:w}},enabled:!!e}),{data:n}=Qc({queryKey:["recent-contacts",e==null?void 0:e.id],queryFn:async()=>{if(!e||!(t!=null&&t.length))return[];const{data:o}=await ni.from("contact_requests").select("*").in("listing_id",t.map(v=>v.id)).order("created_at",{ascending:!1}).limit(5);return o||[]},enabled:!!e&&!!(t!=null&&t.length)}),l=(t==null?void 0:t.filter(o=>o.published).length)||0,u=(t==null?void 0:t.filter(o=>!o.published).length)||0,f=[{title:"Total Listings",value:(t==null?void 0:t.length)||0,subtitle:`${l} published, ${u} drafts`,icon:Ud,gradient:"from-primary to-primary/70"},{title:"Total Views",value:(r==null?void 0:r.views)||0,subtitle:"All time page views",icon:Zv,gradient:"from-accent to-accent/70"},{title:"Contact Requests",value:(r==null?void 0:r.contacts)||0,subtitle:"Total inquiries received",icon:vS,gradient:"from-success to-success/70"},{title:"Published",value:l,subtitle:"Active listings",icon:nN,gradient:"from-secondary to-secondary/70"}];return A.jsx(Jh,{children:A.jsxs("div",{className:"space-y-8",children:[A.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[A.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[A.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-primary flex items-center justify-center",children:A.jsx(eB,{className:"h-5 w-5 text-primary-foreground"})}),A.jsx("h1",{className:"font-display text-3xl font-bold text-gradient",children:"Dashboard"})]}),A.jsx("p",{className:"text-muted-foreground",children:"Welcome back! Here's an overview of your listings."})]}),A.jsx(Ar.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},children:A.jsx(fn,{asChild:!0,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:A.jsxs(xi,{to:"/admin/listings/new",children:[A.jsx(AC,{className:"h-4 w-4 mr-2"}),"Add New Listing"]})})})]}),A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:f.map((o,v)=>A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:v*.1},children:A.jsx(Ci,{className:"overflow-hidden rounded-3xl border-0 shadow-card hover:shadow-float transition-all duration-300 hover-lift bg-card/80 backdrop-blur-sm",children:A.jsx(Ii,{className:"p-6",children:A.jsxs("div",{className:"flex items-start justify-between",children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:o.title}),A.jsx("p",{className:"text-3xl font-bold font-display",children:o.value}),A.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:o.subtitle})]}),A.jsx("div",{className:`h-12 w-12 rounded-2xl bg-gradient-to-br ${o.gradient} flex items-center justify-center shadow-md`,children:A.jsx(o.icon,{className:"h-6 w-6 text-primary-foreground"})})]})})})},o.title))}),A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsxs("div",{className:"flex items-center justify-between",children:[A.jsx(Uo,{className:"text-lg font-display",children:"Recent Listings"}),A.jsx(fn,{variant:"ghost",size:"sm",asChild:!0,className:"rounded-full text-primary hover:text-primary",children:A.jsxs(xi,{to:"/admin/listings",children:["View all",A.jsx(pye,{className:"h-4 w-4 ml-1"})]})})]})}),A.jsx(Ii,{className:"p-4",children:t&&t.length>0?A.jsx("div",{className:"space-y-3",children:t.slice(0,5).map((o,v)=>A.jsx(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5+v*.05},children:A.jsxs(xi,{to:`/admin/listings/${o.id}`,className:"flex items-center gap-4 p-3 rounded-2xl hover:bg-muted/50 transition-all duration-300 group",children:[A.jsx("img",{src:o.cover_image_url||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=100&q=80",alt:o.title,className:"w-14 h-14 rounded-xl object-cover shadow-md group-hover:scale-105 transition-transform"}),A.jsxs("div",{className:"flex-1 min-w-0",children:[A.jsx("p",{className:"font-medium truncate group-hover:text-primary transition-colors",children:o.title}),A.jsxs("p",{className:"text-sm text-muted-foreground",children:[o.city,", ",o.state]})]}),A.jsx("span",{className:`text-xs px-3 py-1.5 rounded-full font-medium ${o.published?"bg-success/10 text-success":"bg-muted text-muted-foreground"}`,children:o.published?"Published":"Draft"})]})},o.id))}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx(Ud,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No listings yet"})]})})]})}),A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"text-lg font-display",children:"Recent Inquiries"})}),A.jsx(Ii,{className:"p-4",children:n&&n.length>0?A.jsx("div",{className:"space-y-3",children:n.map((o,v)=>A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6+v*.05},className:"p-4 rounded-2xl bg-muted/30 hover:bg-muted/50 transition-all",children:[A.jsxs("div",{className:"flex items-center justify-between mb-2",children:[A.jsx("p",{className:"font-medium",children:o.name}),A.jsx("span",{className:"text-xs text-muted-foreground bg-background px-2 py-1 rounded-full",children:zC(o.created_at)})]}),A.jsx("p",{className:"text-sm text-muted-foreground",children:o.email}),A.jsx("p",{className:"text-sm mt-2 line-clamp-2",children:o.message})]},o.id))}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx(vS,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No inquiries yet"})]})})]})})]})]})})}var bz=["Enter"," "],xOe=["ArrowDown","PageUp","Home"],_ie=["ArrowUp","PageDown","End"],bOe=[...xOe,..._ie],wOe={ltr:[...bz,"ArrowRight"],rtl:[...bz,"ArrowLeft"]},SOe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},tE="Menu",[VS,TOe,EOe]=SO(tE),[Ey,vie]=$l(tE,[EOe,gx,rk]),ok=gx(),xie=rk(),[AOe,Ay]=Ey(tE),[POe,rE]=Ey(tE),bie=e=>{const{__scopeMenu:t,open:r=!1,children:n,dir:l,onOpenChange:u,modal:f=!0}=e,o=ok(t),[v,w]=X.useState(null),P=X.useRef(!1),C=ss(u),k=YT(l);return X.useEffect(()=>{const L=()=>{P.current=!0,document.addEventListener("pointerdown",$,{capture:!0,once:!0}),document.addEventListener("pointermove",$,{capture:!0,once:!0})},$=()=>P.current=!1;return document.addEventListener("keydown",L,{capture:!0}),()=>{document.removeEventListener("keydown",L,{capture:!0}),document.removeEventListener("pointerdown",$,{capture:!0}),document.removeEventListener("pointermove",$,{capture:!0})}},[]),A.jsx(gQ,{...o,children:A.jsx(AOe,{scope:t,open:r,onOpenChange:C,content:v,onContentChange:w,children:A.jsx(POe,{scope:t,onClose:X.useCallback(()=>C(!1),[C]),isUsingKeyboardRef:P,dir:k,modal:f,children:n})})})};bie.displayName=tE;var COe="MenuAnchor",O5=X.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,l=ok(r);return A.jsx(dB,{...l,...n,ref:t})});O5.displayName=COe;var k5="MenuPortal",[IOe,wie]=Ey(k5,{forceMount:void 0}),Sie=e=>{const{__scopeMenu:t,forceMount:r,children:n,container:l}=e,u=Ay(k5,t);return A.jsx(IOe,{scope:t,forceMount:r,children:A.jsx(wl,{present:r||u.open,children:A.jsx(DT,{asChild:!0,container:l,children:n})})})};Sie.displayName=k5;var Xc="MenuContent",[OOe,R5]=Ey(Xc),Tie=X.forwardRef((e,t)=>{const r=wie(Xc,e.__scopeMenu),{forceMount:n=r.forceMount,...l}=e,u=Ay(Xc,e.__scopeMenu),f=rE(Xc,e.__scopeMenu);return A.jsx(VS.Provider,{scope:e.__scopeMenu,children:A.jsx(wl,{present:n||u.open,children:A.jsx(VS.Slot,{scope:e.__scopeMenu,children:f.modal?A.jsx(kOe,{...l,ref:t}):A.jsx(ROe,{...l,ref:t})})})})}),kOe=X.forwardRef((e,t)=>{const r=Ay(Xc,e.__scopeMenu),n=X.useRef(null),l=qn(t,n);return X.useEffect(()=>{const u=n.current;if(u)return g5(u)},[]),A.jsx(M5,{...e,ref:l,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:_r(e.onFocusOutside,u=>u.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),ROe=X.forwardRef((e,t)=>{const r=Ay(Xc,e.__scopeMenu);return A.jsx(M5,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),MOe=ry("MenuContent.ScrollLock"),M5=X.forwardRef((e,t)=>{const{__scopeMenu:r,loop:n=!1,trapFocus:l,onOpenAutoFocus:u,onCloseAutoFocus:f,disableOutsidePointerEvents:o,onEntryFocus:v,onEscapeKeyDown:w,onPointerDownOutside:P,onFocusOutside:C,onInteractOutside:k,onDismiss:L,disableOutsideScroll:$,...j}=e,B=Ay(Xc,r),U=rE(Xc,r),q=ok(r),H=xie(r),te=TOe(r),[Q,ae]=X.useState(null),ue=X.useRef(null),me=qn(t,ue,B.onContentChange),Ce=X.useRef(0),Fe=X.useRef(""),Ge=X.useRef(0),Ve=X.useRef(null),Ze=X.useRef("right"),nt=X.useRef(0),dt=$?WO:X.Fragment,rt=$?{as:MOe,allowPinchZoom:!0}:void 0,at=He=>{var rr,Wr;const Et=Fe.current+He,Gt=te().filter(Rt=>!Rt.disabled),Ot=document.activeElement,$t=(rr=Gt.find(Rt=>Rt.ref.current===Ot))==null?void 0:rr.textValue,ur=Gt.map(Rt=>Rt.textValue),Yr=qOe(ur,Et,$t),hn=(Wr=Gt.find(Rt=>Rt.textValue===Yr))==null?void 0:Wr.ref.current;(function Rt(Yt){Fe.current=Yt,window.clearTimeout(Ce.current),Yt!==""&&(Ce.current=window.setTimeout(()=>Rt(""),1e3))})(Et),hn&&setTimeout(()=>hn.focus())};X.useEffect(()=>()=>window.clearTimeout(Ce.current),[]),m5();const qe=X.useCallback(He=>{var Gt,Ot;return Ze.current===((Gt=Ve.current)==null?void 0:Gt.side)&&WOe(He,(Ot=Ve.current)==null?void 0:Ot.area)},[]);return A.jsx(OOe,{scope:r,searchRef:Fe,onItemEnter:X.useCallback(He=>{qe(He)&&He.preventDefault()},[qe]),onItemLeave:X.useCallback(He=>{var Et;qe(He)||((Et=ue.current)==null||Et.focus(),ae(null))},[qe]),onTriggerLeave:X.useCallback(He=>{qe(He)&&He.preventDefault()},[qe]),pointerGraceTimerRef:Ge,onPointerGraceIntentChange:X.useCallback(He=>{Ve.current=He},[]),children:A.jsx(dt,{...rt,children:A.jsx(qO,{asChild:!0,trapped:l,onMountAutoFocus:_r(u,He=>{var Et;He.preventDefault(),(Et=ue.current)==null||Et.focus({preventScroll:!0})}),onUnmountAutoFocus:f,children:A.jsx(hx,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:w,onPointerDownOutside:P,onFocusOutside:C,onInteractOutside:k,onDismiss:L,children:A.jsx(nie,{asChild:!0,...H,dir:U.dir,orientation:"vertical",loop:n,currentTabStopId:Q,onCurrentTabStopIdChange:ae,onEntryFocus:_r(v,He=>{U.isUsingKeyboardRef.current||He.preventDefault()}),preventScrollOnEntryFocus:!0,children:A.jsx(hB,{role:"menu","aria-orientation":"vertical","data-state":Bie(B.open),"data-radix-menu-content":"",dir:U.dir,...q,...j,ref:me,style:{outline:"none",...j.style},onKeyDown:_r(j.onKeyDown,He=>{const Gt=He.target.closest("[data-radix-menu-content]")===He.currentTarget,Ot=He.ctrlKey||He.altKey||He.metaKey,$t=He.key.length===1;Gt&&(He.key==="Tab"&&He.preventDefault(),!Ot&&$t&&at(He.key));const ur=ue.current;if(He.target!==ur||!bOe.includes(He.key))return;He.preventDefault();const hn=te().filter(rr=>!rr.disabled).map(rr=>rr.ref.current);_ie.includes(He.key)&&hn.reverse(),UOe(hn)}),onBlur:_r(e.onBlur,He=>{He.currentTarget.contains(He.target)||(window.clearTimeout(Ce.current),Fe.current="")}),onPointerMove:_r(e.onPointerMove,US(He=>{const Et=He.target,Gt=nt.current!==He.clientX;if(He.currentTarget.contains(Et)&&Gt){const Ot=He.clientX>nt.current?"right":"left";Ze.current=Ot,nt.current=He.clientX}}))})})})})})})});Tie.displayName=Xc;var DOe="MenuGroup",D5=X.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return A.jsx(nn.div,{role:"group",...n,ref:t})});D5.displayName=DOe;var LOe="MenuLabel",Eie=X.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return A.jsx(nn.div,{...n,ref:t})});Eie.displayName=LOe;var sI="MenuItem",RW="menu.itemSelect",sk=X.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:n,...l}=e,u=X.useRef(null),f=rE(sI,e.__scopeMenu),o=R5(sI,e.__scopeMenu),v=qn(t,u),w=X.useRef(!1),P=()=>{const C=u.current;if(!r&&C){const k=new CustomEvent(RW,{bubbles:!0,cancelable:!0});C.addEventListener(RW,L=>n==null?void 0:n(L),{once:!0}),G3(C,k),k.defaultPrevented?w.current=!1:f.onClose()}};return A.jsx(Aie,{...l,ref:v,disabled:r,onClick:_r(e.onClick,P),onPointerDown:C=>{var k;(k=e.onPointerDown)==null||k.call(e,C),w.current=!0},onPointerUp:_r(e.onPointerUp,C=>{var k;w.current||(k=C.currentTarget)==null||k.click()}),onKeyDown:_r(e.onKeyDown,C=>{const k=o.searchRef.current!=="";r||k&&C.key===" "||bz.includes(C.key)&&(C.currentTarget.click(),C.preventDefault())})})});sk.displayName=sI;var Aie=X.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:n=!1,textValue:l,...u}=e,f=R5(sI,r),o=xie(r),v=X.useRef(null),w=qn(t,v),[P,C]=X.useState(!1),[k,L]=X.useState("");return X.useEffect(()=>{const $=v.current;$&&L(($.textContent??"").trim())},[u.children]),A.jsx(VS.ItemSlot,{scope:r,disabled:n,textValue:l??k,children:A.jsx(iie,{asChild:!0,...o,focusable:!n,children:A.jsx(nn.div,{role:"menuitem","data-highlighted":P?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...u,ref:w,onPointerMove:_r(e.onPointerMove,US($=>{n?f.onItemLeave($):(f.onItemEnter($),$.defaultPrevented||$.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:_r(e.onPointerLeave,US($=>f.onItemLeave($))),onFocus:_r(e.onFocus,()=>C(!0)),onBlur:_r(e.onBlur,()=>C(!1))})})})}),jOe="MenuCheckboxItem",Pie=X.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:n,...l}=e;return A.jsx(Rie,{scope:e.__scopeMenu,checked:r,children:A.jsx(sk,{role:"menuitemcheckbox","aria-checked":aI(r)?"mixed":r,...l,ref:t,"data-state":j5(r),onSelect:_r(l.onSelect,()=>n==null?void 0:n(aI(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Pie.displayName=jOe;var Cie="MenuRadioGroup",[NOe,zOe]=Ey(Cie,{value:void 0,onValueChange:()=>{}}),Iie=X.forwardRef((e,t)=>{const{value:r,onValueChange:n,...l}=e,u=ss(n);return A.jsx(NOe,{scope:e.__scopeMenu,value:r,onValueChange:u,children:A.jsx(D5,{...l,ref:t})})});Iie.displayName=Cie;var Oie="MenuRadioItem",kie=X.forwardRef((e,t)=>{const{value:r,...n}=e,l=zOe(Oie,e.__scopeMenu),u=r===l.value;return A.jsx(Rie,{scope:e.__scopeMenu,checked:u,children:A.jsx(sk,{role:"menuitemradio","aria-checked":u,...n,ref:t,"data-state":j5(u),onSelect:_r(n.onSelect,()=>{var f;return(f=l.onValueChange)==null?void 0:f.call(l,r)},{checkForDefaultPrevented:!1})})})});kie.displayName=Oie;var L5="MenuItemIndicator",[Rie,FOe]=Ey(L5,{checked:!1}),Mie=X.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:n,...l}=e,u=FOe(L5,r);return A.jsx(wl,{present:n||aI(u.checked)||u.checked===!0,children:A.jsx(nn.span,{...l,ref:t,"data-state":j5(u.checked)})})});Mie.displayName=L5;var BOe="MenuSeparator",Die=X.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e;return A.jsx(nn.div,{role:"separator","aria-orientation":"horizontal",...n,ref:t})});Die.displayName=BOe;var $Oe="MenuArrow",Lie=X.forwardRef((e,t)=>{const{__scopeMenu:r,...n}=e,l=ok(r);return A.jsx(fB,{...l,...n,ref:t})});Lie.displayName=$Oe;var VOe="MenuSub",[iet,jie]=Ey(VOe),A1="MenuSubTrigger",Nie=X.forwardRef((e,t)=>{const r=Ay(A1,e.__scopeMenu),n=rE(A1,e.__scopeMenu),l=jie(A1,e.__scopeMenu),u=R5(A1,e.__scopeMenu),f=X.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:v}=u,w={__scopeMenu:e.__scopeMenu},P=X.useCallback(()=>{f.current&&window.clearTimeout(f.current),f.current=null},[]);return X.useEffect(()=>P,[P]),X.useEffect(()=>{const C=o.current;return()=>{window.clearTimeout(C),v(null)}},[o,v]),A.jsx(O5,{asChild:!0,...w,children:A.jsx(Aie,{id:l.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":l.contentId,"data-state":Bie(r.open),...e,ref:wO(t,l.onTriggerChange),onClick:C=>{var k;(k=e.onClick)==null||k.call(e,C),!(e.disabled||C.defaultPrevented)&&(C.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:_r(e.onPointerMove,US(C=>{u.onItemEnter(C),!C.defaultPrevented&&!e.disabled&&!r.open&&!f.current&&(u.onPointerGraceIntentChange(null),f.current=window.setTimeout(()=>{r.onOpenChange(!0),P()},100))})),onPointerLeave:_r(e.onPointerLeave,US(C=>{var L,$;P();const k=(L=r.content)==null?void 0:L.getBoundingClientRect();if(k){const j=($=r.content)==null?void 0:$.dataset.side,B=j==="right",U=B?-5:5,q=k[B?"left":"right"],H=k[B?"right":"left"];u.onPointerGraceIntentChange({area:[{x:C.clientX+U,y:C.clientY},{x:q,y:k.top},{x:H,y:k.top},{x:H,y:k.bottom},{x:q,y:k.bottom}],side:j}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>u.onPointerGraceIntentChange(null),300)}else{if(u.onTriggerLeave(C),C.defaultPrevented)return;u.onPointerGraceIntentChange(null)}})),onKeyDown:_r(e.onKeyDown,C=>{var L;const k=u.searchRef.current!=="";e.disabled||k&&C.key===" "||wOe[n.dir].includes(C.key)&&(r.onOpenChange(!0),(L=r.content)==null||L.focus(),C.preventDefault())})})})});Nie.displayName=A1;var zie="MenuSubContent",Fie=X.forwardRef((e,t)=>{const r=wie(Xc,e.__scopeMenu),{forceMount:n=r.forceMount,...l}=e,u=Ay(Xc,e.__scopeMenu),f=rE(Xc,e.__scopeMenu),o=jie(zie,e.__scopeMenu),v=X.useRef(null),w=qn(t,v);return A.jsx(VS.Provider,{scope:e.__scopeMenu,children:A.jsx(wl,{present:n||u.open,children:A.jsx(VS.Slot,{scope:e.__scopeMenu,children:A.jsx(M5,{id:o.contentId,"aria-labelledby":o.triggerId,...l,ref:w,align:"start",side:f.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:P=>{var C;f.isUsingKeyboardRef.current&&((C=v.current)==null||C.focus()),P.preventDefault()},onCloseAutoFocus:P=>P.preventDefault(),onFocusOutside:_r(e.onFocusOutside,P=>{P.target!==o.trigger&&u.onOpenChange(!1)}),onEscapeKeyDown:_r(e.onEscapeKeyDown,P=>{f.onClose(),P.preventDefault()}),onKeyDown:_r(e.onKeyDown,P=>{var L;const C=P.currentTarget.contains(P.target),k=SOe[f.dir].includes(P.key);C&&k&&(u.onOpenChange(!1),(L=o.trigger)==null||L.focus(),P.preventDefault())})})})})})});Fie.displayName=zie;function Bie(e){return e?"open":"closed"}function aI(e){return e==="indeterminate"}function j5(e){return aI(e)?"indeterminate":e?"checked":"unchecked"}function UOe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function GOe(e,t){return e.map((r,n)=>e[(t+n)%e.length])}function qOe(e,t,r){const l=t.length>1&&Array.from(t).every(w=>w===t[0])?t[0]:t,u=r?e.indexOf(r):-1;let f=GOe(e,Math.max(u,0));l.length===1&&(f=f.filter(w=>w!==r));const v=f.find(w=>w.toLowerCase().startsWith(l.toLowerCase()));return v!==r?v:void 0}function HOe(e,t){const{x:r,y:n}=e;let l=!1;for(let u=0,f=t.length-1;u<t.length;f=u++){const o=t[u],v=t[f],w=o.x,P=o.y,C=v.x,k=v.y;P>n!=k>n&&r<(C-w)*(n-P)/(k-P)+w&&(l=!l)}return l}function WOe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return HOe(r,t)}function US(e){return t=>t.pointerType==="mouse"?e(t):void 0}var ZOe=bie,XOe=O5,KOe=Sie,YOe=Tie,JOe=D5,QOe=Eie,eke=sk,tke=Pie,rke=Iie,nke=kie,ike=Mie,oke=Die,ske=Lie,ake=Nie,lke=Fie,ak="DropdownMenu",[cke,oet]=$l(ak,[vie]),Sl=vie(),[uke,$ie]=cke(ak),Vie=e=>{const{__scopeDropdownMenu:t,children:r,dir:n,open:l,defaultOpen:u,onOpenChange:f,modal:o=!0}=e,v=Sl(t),w=X.useRef(null),[P,C]=qp({prop:l,defaultProp:u??!1,onChange:f,caller:ak});return A.jsx(uke,{scope:t,triggerId:jd(),triggerRef:w,contentId:jd(),open:P,onOpenChange:C,onOpenToggle:X.useCallback(()=>C(k=>!k),[C]),modal:o,children:A.jsx(ZOe,{...v,open:P,onOpenChange:C,dir:n,modal:o,children:r})})};Vie.displayName=ak;var Uie="DropdownMenuTrigger",Gie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:n=!1,...l}=e,u=$ie(Uie,r),f=Sl(r);return A.jsx(XOe,{asChild:!0,...f,children:A.jsx(nn.button,{type:"button",id:u.triggerId,"aria-haspopup":"menu","aria-expanded":u.open,"aria-controls":u.open?u.contentId:void 0,"data-state":u.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...l,ref:wO(t,u.triggerRef),onPointerDown:_r(e.onPointerDown,o=>{!n&&o.button===0&&o.ctrlKey===!1&&(u.onOpenToggle(),u.open||o.preventDefault())}),onKeyDown:_r(e.onKeyDown,o=>{n||(["Enter"," "].includes(o.key)&&u.onOpenToggle(),o.key==="ArrowDown"&&u.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});Gie.displayName=Uie;var dke="DropdownMenuPortal",qie=e=>{const{__scopeDropdownMenu:t,...r}=e,n=Sl(t);return A.jsx(KOe,{...n,...r})};qie.displayName=dke;var Hie="DropdownMenuContent",Wie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=$ie(Hie,r),u=Sl(r),f=X.useRef(!1);return A.jsx(YOe,{id:l.contentId,"aria-labelledby":l.triggerId,...u,...n,ref:t,onCloseAutoFocus:_r(e.onCloseAutoFocus,o=>{var v;f.current||(v=l.triggerRef.current)==null||v.focus(),f.current=!1,o.preventDefault()}),onInteractOutside:_r(e.onInteractOutside,o=>{const v=o.detail.originalEvent,w=v.button===0&&v.ctrlKey===!0,P=v.button===2||w;(!l.modal||P)&&(f.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Wie.displayName=Hie;var hke="DropdownMenuGroup",fke=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(JOe,{...l,...n,ref:t})});fke.displayName=hke;var pke="DropdownMenuLabel",Zie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(QOe,{...l,...n,ref:t})});Zie.displayName=pke;var mke="DropdownMenuItem",Xie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(eke,{...l,...n,ref:t})});Xie.displayName=mke;var gke="DropdownMenuCheckboxItem",Kie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(tke,{...l,...n,ref:t})});Kie.displayName=gke;var yke="DropdownMenuRadioGroup",_ke=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(rke,{...l,...n,ref:t})});_ke.displayName=yke;var vke="DropdownMenuRadioItem",Yie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(nke,{...l,...n,ref:t})});Yie.displayName=vke;var xke="DropdownMenuItemIndicator",Jie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(ike,{...l,...n,ref:t})});Jie.displayName=xke;var bke="DropdownMenuSeparator",Qie=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(oke,{...l,...n,ref:t})});Qie.displayName=bke;var wke="DropdownMenuArrow",Ske=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(ske,{...l,...n,ref:t})});Ske.displayName=wke;var Tke="DropdownMenuSubTrigger",eoe=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(ake,{...l,...n,ref:t})});eoe.displayName=Tke;var Eke="DropdownMenuSubContent",toe=X.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...n}=e,l=Sl(r);return A.jsx(lke,{...l,...n,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});toe.displayName=Eke;var Ake=Vie,Pke=Gie,Cke=qie,roe=Wie,noe=Zie,ioe=Xie,ooe=Kie,soe=Yie,aoe=Jie,loe=Qie,coe=eoe,uoe=toe;const Ike=Ake,Oke=Pke,kke=X.forwardRef(({className:e,inset:t,children:r,...n},l)=>A.jsxs(coe,{ref:l,className:sr("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",t&&"pl-8",e),...n,children:[r,A.jsx(yye,{className:"ml-auto h-4 w-4"})]}));kke.displayName=coe.displayName;const Rke=X.forwardRef(({className:e,...t},r)=>A.jsx(uoe,{ref:r,className:sr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Rke.displayName=uoe.displayName;const doe=X.forwardRef(({className:e,sideOffset:t=4,...r},n)=>A.jsx(Cke,{children:A.jsx(roe,{ref:n,sideOffset:t,className:sr("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));doe.displayName=roe.displayName;const QP=X.forwardRef(({className:e,inset:t,...r},n)=>A.jsx(ioe,{ref:n,className:sr("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",t&&"pl-8",e),...r}));QP.displayName=ioe.displayName;const Mke=X.forwardRef(({className:e,children:t,checked:r,...n},l)=>A.jsxs(ooe,{ref:l,className:sr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),checked:r,...n,children:[A.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:A.jsx(aoe,{children:A.jsx(DJ,{className:"h-4 w-4"})})}),t]}));Mke.displayName=ooe.displayName;const Dke=X.forwardRef(({className:e,children:t,...r},n)=>A.jsxs(soe,{ref:n,className:sr("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",e),...r,children:[A.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:A.jsx(aoe,{children:A.jsx(xye,{className:"h-2 w-2 fill-current"})})}),t]}));Dke.displayName=soe.displayName;const Lke=X.forwardRef(({className:e,inset:t,...r},n)=>A.jsx(noe,{ref:n,className:sr("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));Lke.displayName=noe.displayName;const hoe=X.forwardRef(({className:e,...t},r)=>A.jsx(loe,{ref:r,className:sr("-mx-1 my-1 h-px bg-muted",e),...t}));hoe.displayName=loe.displayName;var foe="AlertDialog",[jke,set]=$l(foe,[Cre]),af=Cre(),poe=e=>{const{__scopeAlertDialog:t,...r}=e,n=af(t);return A.jsx(x5,{...n,...r,modal:!0})};poe.displayName=foe;var Nke="AlertDialogTrigger",moe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=af(r);return A.jsx(Gre,{...l,...n,ref:t})});moe.displayName=Nke;var zke="AlertDialogPortal",goe=e=>{const{__scopeAlertDialog:t,...r}=e,n=af(t);return A.jsx(b5,{...n,...r})};goe.displayName=zke;var Fke="AlertDialogOverlay",yoe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=af(r);return A.jsx(WT,{...l,...n,ref:t})});yoe.displayName=Fke;var e0="AlertDialogContent",[Bke,$ke]=jke(e0),Vke=oJ("AlertDialogContent"),_oe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,children:n,...l}=e,u=af(r),f=X.useRef(null),o=qn(t,f),v=X.useRef(null);return A.jsx(FCe,{contentName:e0,titleName:voe,docsSlug:"alert-dialog",children:A.jsx(Bke,{scope:r,cancelRef:v,children:A.jsxs(ZT,{role:"alertdialog",...u,...l,ref:o,onOpenAutoFocus:_r(l.onOpenAutoFocus,w=>{var P;w.preventDefault(),(P=v.current)==null||P.focus({preventScroll:!0})}),onPointerDownOutside:w=>w.preventDefault(),onInteractOutside:w=>w.preventDefault(),children:[A.jsx(Vke,{children:n}),A.jsx(Gke,{contentRef:f})]})})})});_oe.displayName=e0;var voe="AlertDialogTitle",xoe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=af(r);return A.jsx(XT,{...l,...n,ref:t})});xoe.displayName=voe;var boe="AlertDialogDescription",woe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=af(r);return A.jsx(KT,{...l,...n,ref:t})});woe.displayName=boe;var Uke="AlertDialogAction",Soe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,l=af(r);return A.jsx(XO,{...l,...n,ref:t})});Soe.displayName=Uke;var Toe="AlertDialogCancel",Eoe=X.forwardRef((e,t)=>{const{__scopeAlertDialog:r,...n}=e,{cancelRef:l}=$ke(Toe,r),u=af(r),f=qn(t,l);return A.jsx(XO,{...u,...n,ref:f})});Eoe.displayName=Toe;var Gke=({contentRef:e})=>{const t=`\`${e0}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${e0}\` by passing a \`${boe}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${e0}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return X.useEffect(()=>{var n;document.getElementById((n=e.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(t)},[t,e]),null},qke=poe,Hke=moe,Wke=goe,Aoe=yoe,Poe=_oe,Coe=Soe,Ioe=Eoe,Ooe=xoe,koe=woe;const Zke=qke,Xke=Hke,Kke=Wke,Roe=X.forwardRef(({className:e,...t},r)=>A.jsx(Aoe,{className:sr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));Roe.displayName=Aoe.displayName;const Moe=X.forwardRef(({className:e,...t},r)=>A.jsxs(Kke,{children:[A.jsx(Roe,{}),A.jsx(Poe,{ref:r,className:sr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));Moe.displayName=Poe.displayName;const Doe=({className:e,...t})=>A.jsx("div",{className:sr("flex flex-col space-y-2 text-center sm:text-left",e),...t});Doe.displayName="AlertDialogHeader";const Loe=({className:e,...t})=>A.jsx("div",{className:sr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});Loe.displayName="AlertDialogFooter";const joe=X.forwardRef(({className:e,...t},r)=>A.jsx(Ooe,{ref:r,className:sr("text-lg font-semibold",e),...t}));joe.displayName=Ooe.displayName;const Noe=X.forwardRef(({className:e,...t},r)=>A.jsx(koe,{ref:r,className:sr("text-sm text-muted-foreground",e),...t}));Noe.displayName=koe.displayName;const zoe=X.forwardRef(({className:e,...t},r)=>A.jsx(Coe,{ref:r,className:sr(PB(),e),...t}));zoe.displayName=Coe.displayName;const Foe=X.forwardRef(({className:e,...t},r)=>A.jsx(Ioe,{ref:r,className:sr(PB({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Foe.displayName=Ioe.displayName;function Yke(){const{data:e,isLoading:t}=$O(),r=$2e(),[n,l]=X.useState(""),u=e==null?void 0:e.filter(f=>f.title.toLowerCase().includes(n.toLowerCase())||f.city.toLowerCase().includes(n.toLowerCase())||f.address.toLowerCase().includes(n.toLowerCase()));return A.jsx(Jh,{children:A.jsxs("div",{className:"space-y-6",children:[A.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[A.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[A.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-primary flex items-center justify-center",children:A.jsx(Ud,{className:"h-5 w-5 text-primary-foreground"})}),A.jsx("h1",{className:"font-display text-3xl font-bold text-gradient",children:"Listings"})]}),A.jsx("p",{className:"text-muted-foreground",children:"Manage your property listings"})]}),A.jsx(Ar.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},children:A.jsx(fn,{asChild:!0,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:A.jsxs(xi,{to:"/admin/listings/new",children:[A.jsx(AC,{className:"h-4 w-4 mr-2"}),"Add Listing"]})})})]}),A.jsxs(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"relative max-w-md",children:[A.jsx(bS,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),A.jsx(jn,{placeholder:"Search listings...",className:"pl-11 rounded-full border-border/50 bg-card/80 backdrop-blur-sm focus:ring-2 focus:ring-primary/20",value:n,onChange:f=>l(f.target.value)})]}),t?A.jsx("div",{className:"space-y-4",children:[1,2,3].map(f=>A.jsx("div",{className:"animate-pulse h-28 bg-muted rounded-3xl"},f))}):u&&u.length>0?A.jsx("div",{className:"space-y-4",children:A.jsx(O0,{mode:"popLayout",children:u.map((f,o)=>A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:o*.05},layout:!0,children:A.jsx(Ci,{className:"overflow-hidden rounded-3xl border-0 shadow-card hover:shadow-float transition-all duration-300 bg-card/80 backdrop-blur-sm group",children:A.jsx(Ii,{className:"p-0",children:A.jsxs("div",{className:"flex flex-col sm:flex-row",children:[A.jsxs("div",{className:"sm:w-52 h-36 sm:h-auto relative overflow-hidden",children:[A.jsx("img",{src:f.cover_image_url||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400&q=80",alt:f.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"}),A.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent sm:bg-gradient-to-r"})]}),A.jsxs("div",{className:"flex-1 p-5 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[A.jsxs("div",{className:"space-y-2",children:[A.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[A.jsx("h3",{className:"font-display font-semibold text-lg group-hover:text-primary transition-colors",children:f.title}),A.jsx(Dh,{variant:f.published?"default":"secondary",className:`rounded-full ${f.published?"bg-success/10 text-success border-success/20":""}`,children:f.published?" Published":"Draft"}),A.jsx(Dh,{className:`rounded-full ${IB(f.status)}`,children:CB(f.status)})]}),A.jsxs("p",{className:"text-sm text-muted-foreground",children:[f.address,", ",f.city,", ",f.state]}),A.jsx("p",{className:"font-display font-bold text-xl text-gradient",children:BT(f.price)})]}),A.jsxs("div",{className:"flex items-center gap-2",children:[A.jsx(fn,{asChild:!0,variant:"outline",size:"sm",className:"rounded-full hover:bg-primary hover:text-primary-foreground transition-all",children:A.jsxs(xi,{to:`/admin/listings/${f.id}`,children:[A.jsx(zye,{className:"h-4 w-4 mr-1"}),"Edit"]})}),A.jsxs(Ike,{children:[A.jsx(Oke,{asChild:!0,children:A.jsx(fn,{variant:"ghost",size:"icon",className:"rounded-full",children:A.jsx(bye,{className:"h-4 w-4"})})}),A.jsxs(doe,{align:"end",className:"rounded-2xl",children:[f.published&&A.jsx(QP,{asChild:!0,className:"rounded-xl",children:A.jsxs(xi,{to:`/listings/${f.slug}`,target:"_blank",children:[A.jsx(J3,{className:"h-4 w-4 mr-2"}),"View Live"]})}),A.jsx(QP,{asChild:!0,className:"rounded-xl",children:A.jsxs(xi,{to:`/admin/listings/${f.id}/preview`,children:[A.jsx(Zv,{className:"h-4 w-4 mr-2"}),"Preview"]})}),A.jsx(hoe,{}),A.jsxs(Zke,{children:[A.jsx(Xke,{asChild:!0,children:A.jsxs(QP,{onSelect:v=>v.preventDefault(),className:"text-destructive focus:text-destructive rounded-xl",children:[A.jsx(Fye,{className:"h-4 w-4 mr-2"}),"Delete"]})}),A.jsxs(Moe,{className:"rounded-3xl",children:[A.jsxs(Doe,{children:[A.jsx(joe,{className:"font-display",children:"Delete Listing"}),A.jsxs(Noe,{children:['Are you sure you want to delete "',f.title,'"? This action cannot be undone.']})]}),A.jsxs(Loe,{children:[A.jsx(Foe,{className:"rounded-full",children:"Cancel"}),A.jsx(zoe,{onClick:()=>r.mutate(f.id),className:"rounded-full bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})]})]})]})]})]})]})})})},f.id))})}):A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:A.jsx(Ci,{className:"py-16 rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:A.jsxs(Ii,{className:"text-center",children:[A.jsx(Ar.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",damping:15},className:"h-20 w-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-6",children:A.jsx(Ud,{className:"h-10 w-10 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground mb-6 text-lg",children:"No listings found"}),A.jsx(fn,{asChild:!0,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:A.jsxs(xi,{to:"/admin/listings/new",children:[A.jsx(AC,{className:"h-4 w-4 mr-2"}),"Create Your First Listing"]})})]})})})]})})}function Jke({images:e,onImagesChange:t,coverImage:r,onCoverImageChange:n,listingId:l}){const[u,f]=X.useState(!1),[o,v]=X.useState(!1),w=async $=>{const j=$.name.split(".").pop(),B=`${l||"temp"}-${Date.now()}-${Math.random().toString(36).substring(2,8)}.${j}`,U=`${l||"uploads"}/${B}`,{error:q}=await ni.storage.from("listing-images").upload(U,$);if(q)return console.error("Upload error:",q),Ni.error(`Failed to upload ${$.name}`),null;const{data:{publicUrl:H}}=ni.storage.from("listing-images").getPublicUrl(U);return H},P=X.useCallback(async $=>{if(!$||$.length===0)return;f(!0);const j=[];for(const B of Array.from($)){if(!B.type.startsWith("image/")){Ni.error(`${B.name} is not an image`);continue}if(B.size>10*1024*1024){Ni.error(`${B.name} is too large (max 10MB)`);continue}const U=await w(B);U&&j.push(U)}if(j.length>0){const B=[...e,...j];t(B),!r&&n&&n(j[0]),Ni.success(`Uploaded ${j.length} image(s)`)}f(!1)},[e,r,t,n,l]),C=X.useCallback($=>{$.preventDefault(),v(!1),P($.dataTransfer.files)},[P]),k=$=>{const j=e.filter(B=>B!==$);t(j),r===$&&n&&n(j[0]||"")},L=$=>{n&&n($)};return A.jsxs("div",{className:"space-y-4",children:[A.jsx("div",{onDragOver:$=>{$.preventDefault(),v(!0)},onDragLeave:()=>v(!1),onDrop:C,className:sr("border-2 border-dashed rounded-lg p-8 text-center transition-colors",o?"border-accent bg-accent/5":"border-muted-foreground/25 hover:border-muted-foreground/50"),children:u?A.jsxs("div",{className:"flex flex-col items-center gap-2",children:[A.jsx(Ld,{className:"h-8 w-8 animate-spin text-accent"}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"Uploading..."})]}):A.jsxs(A.Fragment,{children:[A.jsx(AO,{className:"h-8 w-8 mx-auto text-muted-foreground mb-2"}),A.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Drag and drop images here, or click to select"}),A.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",id:"image-upload",onChange:$=>P($.target.files)}),A.jsx(fn,{type:"button",variant:"outline",size:"sm",onClick:()=>{var $;return($=document.getElementById("image-upload"))==null?void 0:$.click()},children:"Select Images"})]})}),e.length>0&&A.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:e.map(($,j)=>A.jsxs("div",{className:sr("relative group aspect-square rounded-lg overflow-hidden border-2",r===$?"border-accent":"border-transparent"),children:[A.jsx("img",{src:$,alt:`Image ${j+1}`,className:"w-full h-full object-cover"}),A.jsxs("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-2",children:[A.jsx(fn,{type:"button",size:"sm",variant:"secondary",onClick:()=>L($),disabled:r===$,children:r===$?"Cover":"Set Cover"}),A.jsx(fn,{type:"button",size:"icon",variant:"destructive",onClick:()=>k($),children:A.jsx(Hp,{className:"h-4 w-4"})})]}),r===$&&A.jsx("span",{className:"absolute top-2 left-2 text-xs bg-accent text-accent-foreground px-2 py-0.5 rounded",children:"Cover"}),A.jsx("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:A.jsx(Sye,{className:"h-5 w-5 text-white drop-shadow"})})]},$))})]})}var lk="Switch",[Qke,aet]=$l(lk),[eRe,tRe]=Qke(lk),Boe=X.forwardRef((e,t)=>{const{__scopeSwitch:r,name:n,checked:l,defaultChecked:u,required:f,disabled:o,value:v="on",onCheckedChange:w,form:P,...C}=e,[k,L]=X.useState(null),$=qn(t,H=>L(H)),j=X.useRef(!1),B=k?P||!!k.closest("form"):!0,[U,q]=qp({prop:l,defaultProp:u??!1,onChange:w,caller:lk});return A.jsxs(eRe,{scope:r,checked:U,disabled:o,children:[A.jsx(nn.button,{type:"button",role:"switch","aria-checked":U,"aria-required":f,"data-state":Goe(U),"data-disabled":o?"":void 0,disabled:o,value:v,...C,ref:$,onClick:_r(e.onClick,H=>{q(te=>!te),B&&(j.current=H.isPropagationStopped(),j.current||H.stopPropagation())})}),B&&A.jsx(Uoe,{control:k,bubbles:!j.current,name:n,value:v,checked:U,required:f,disabled:o,form:P,style:{transform:"translateX(-100%)"}})]})});Boe.displayName=lk;var $oe="SwitchThumb",Voe=X.forwardRef((e,t)=>{const{__scopeSwitch:r,...n}=e,l=tRe($oe,r);return A.jsx(nn.span,{"data-state":Goe(l.checked),"data-disabled":l.disabled?"":void 0,...n,ref:t})});Voe.displayName=$oe;var rRe="SwitchBubbleInput",Uoe=X.forwardRef(({__scopeSwitch:e,control:t,checked:r,bubbles:n=!0,...l},u)=>{const f=X.useRef(null),o=qn(f,u),v=Wre(r),w=sQ(t);return X.useEffect(()=>{const P=f.current;if(!P)return;const C=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(C,"checked").set;if(v!==r&&L){const $=new Event("click",{bubbles:n});L.call(P,r),P.dispatchEvent($)}},[v,r,n]),A.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...l,tabIndex:-1,ref:o,style:{...l.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Uoe.displayName=rRe;function Goe(e){return e?"checked":"unchecked"}var qoe=Boe,nRe=Voe;const X1=X.forwardRef(({className:e,...t},r)=>A.jsx(qoe,{className:sr("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e),...t,ref:r,children:A.jsx(nRe,{className:sr("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));X1.displayName=qoe.displayName;const iRe=HT({title:Ss().min(5,"Title must be at least 5 characters"),address:Ss().min(5,"Address is required"),city:Ss().min(2,"City is required"),state:Ss().min(2,"State is required"),zip:Ss().min(5,"ZIP code is required"),price:dP.number().min(1,"Price is required"),beds:dP.number().optional(),baths:dP.number().optional(),sqft:dP.number().optional(),lot_size:Ss().optional(),property_type:vW(["house","condo","townhouse","land","multi_family","commercial","other"]),status:vW(["for_sale","for_rent","sold","pending"]),description:Ss().optional(),zillow_url:Ss().url().optional().or(zPe("")),mls_number:Ss().optional(),published:NPe()});function MW(){const{id:e}=qQ(),t=MO(),r=!!e,n=Yte(),l=B2e(),[u,f]=X.useState([]),[o,v]=X.useState(""),[w,P]=X.useState([]),[C,k]=X.useState(""),{data:L,isLoading:$}=Qc({queryKey:["listing-edit",e],queryFn:async()=>{if(!e)return null;const{data:te,error:Q}=await ni.from("listings").select("*").eq("id",e).single();if(Q)throw Q;return te},enabled:!!e}),{data:j}=Qc({queryKey:["listing-images-edit",e],queryFn:async()=>{if(!e)return[];const{data:te,error:Q}=await ni.from("listing_images").select("*").eq("listing_id",e).order("sort_order");if(Q)throw Q;return te},enabled:!!e}),B=FS({resolver:BS(iRe),defaultValues:{title:"",address:"",city:"",state:"",zip:"",price:0,beds:void 0,baths:void 0,sqft:void 0,lot_size:"",property_type:"house",status:"for_sale",description:"",zillow_url:"",mls_number:"",published:!1}});X.useEffect(()=>{L&&(B.reset({title:L.title,address:L.address,city:L.city,state:L.state,zip:L.zip,price:Number(L.price),beds:L.beds||void 0,baths:L.baths||void 0,sqft:L.sqft||void 0,lot_size:L.lot_size||"",property_type:L.property_type,status:L.status,description:L.description||"",zillow_url:L.zillow_url||"",mls_number:L.mls_number||"",published:L.published}),v(L.cover_image_url||""),L.features_json&&P(L.features_json))},[L,B]),X.useEffect(()=>{j&&f(j.map(te=>te.image_url))},[j]);const U=async te=>{const Q=r&&L?L.slug:oz(te.title,te.city),ae={...te,slug:Q,cover_image_url:o||null,features_json:w,zillow_url:te.zillow_url||null};try{if(r&&e)await l.mutateAsync({id:e,data:ae}),await ni.from("listing_images").delete().eq("listing_id",e),u.length>0&&await ni.from("listing_images").insert(u.map((ue,me)=>({listing_id:e,image_url:ue,sort_order:me})));else{const ue=await n.mutateAsync(ae);ue&&u.length>0&&await ni.from("listing_images").insert(u.map((me,Ce)=>({listing_id:ue.id,image_url:me,sort_order:Ce})))}t("/admin/listings")}catch(ue){console.error("Save error:",ue)}},q=()=>{C.trim()&&(P([...w,C.trim()]),k(""))},H=te=>P(w.filter((Q,ae)=>ae!==te));return r&&$?A.jsx(Jh,{children:A.jsx("div",{className:"flex items-center justify-center py-20",children:A.jsx(Ar.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"h-12 w-12 rounded-full border-4 border-primary border-t-transparent"})})}):A.jsx(Jh,{children:A.jsx(j0,{...B,children:A.jsxs("form",{onSubmit:B.handleSubmit(U),className:"space-y-6",children:[A.jsxs(Ar.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx(fn,{type:"button",variant:"ghost",size:"icon",onClick:()=>t("/admin/listings"),className:"rounded-full",children:A.jsx(kJ,{className:"h-5 w-5"})}),A.jsxs("div",{children:[A.jsx("h1",{className:"font-display text-2xl font-bold text-gradient",children:r?"Edit Listing":"New Listing"}),A.jsx("p",{className:"text-muted-foreground",children:r?"Update your property details":"Add a new property to your portfolio"})]})]}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx(Gi,{control:B.control,name:"published",render:({field:te})=>A.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 rounded-full bg-muted/50",children:[A.jsx(X1,{checked:te.value,onCheckedChange:te.onChange}),A.jsx("span",{className:"text-sm font-medium",children:te.value?" Published":"Draft"})]})}),A.jsxs(fn,{type:"submit",className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:[A.jsx(rN,{className:"h-4 w-4 mr-2"}),"Save"]})]})]}),A.jsxs(ik,{defaultValue:"details",className:"space-y-6",children:[A.jsx(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:A.jsxs(eE,{className:"rounded-full bg-muted/50 p-1",children:[A.jsxs(Vu,{value:"details",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(tN,{className:"h-4 w-4 mr-2"}),"Details"]}),A.jsxs(Vu,{value:"images",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(Tye,{className:"h-4 w-4 mr-2"}),"Images"]}),A.jsxs(Vu,{value:"features",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(eB,{className:"h-4 w-4 mr-2"}),"Features"]})]})}),A.jsx(Uu,{value:"details",className:"space-y-6",children:A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Basic Information"})}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsx(Gi,{control:B.control,name:"title",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Title *"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"Beautiful 3BR Home",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[A.jsx(Gi,{control:B.control,name:"property_type",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Property Type *"}),A.jsxs(zc,{onValueChange:te.onChange,value:te.value,children:[A.jsx(Wi,{children:A.jsx(ec,{className:"rounded-xl",children:A.jsx(Fc,{})})}),A.jsxs(tc,{className:"rounded-2xl",children:[A.jsx(Qr,{value:"house",children:"House"}),A.jsx(Qr,{value:"condo",children:"Condo"}),A.jsx(Qr,{value:"townhouse",children:"Townhouse"}),A.jsx(Qr,{value:"land",children:"Land"}),A.jsx(Qr,{value:"multi_family",children:"Multi-Family"}),A.jsx(Qr,{value:"commercial",children:"Commercial"}),A.jsx(Qr,{value:"other",children:"Other"})]})]}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"status",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Status *"}),A.jsxs(zc,{onValueChange:te.onChange,value:te.value,children:[A.jsx(Wi,{children:A.jsx(ec,{className:"rounded-xl",children:A.jsx(Fc,{})})}),A.jsxs(tc,{className:"rounded-2xl",children:[A.jsx(Qr,{value:"for_sale",children:"For Sale"}),A.jsx(Qr,{value:"for_rent",children:"For Rent"}),A.jsx(Qr,{value:"pending",children:"Pending"}),A.jsx(Qr,{value:"sold",children:"Sold"})]})]}),A.jsx(Zi,{})]})})]}),A.jsx(Gi,{control:B.control,name:"price",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Price *"}),A.jsx(Wi,{children:A.jsx(jn,{type:"number",placeholder:"500000",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"description",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Description"}),A.jsx(Wi,{children:A.jsx(JT,{placeholder:"Describe the property...",className:"min-h-[100px] rounded-xl",...te})}),A.jsx(Zi,{})]})})]})]}),A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Location"})}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsx(Gi,{control:B.control,name:"address",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Street Address *"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"123 Main Street",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[A.jsx(Gi,{control:B.control,name:"city",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"City *"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"Austin",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"state",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"State *"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"TX",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"zip",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"ZIP *"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"78701",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})})]})]})]}),A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Property Details"})}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[A.jsx(Gi,{control:B.control,name:"beds",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Bedrooms"}),A.jsx(Wi,{children:A.jsx(jn,{type:"number",placeholder:"3",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"baths",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Bathrooms"}),A.jsx(Wi,{children:A.jsx(jn,{type:"number",step:"0.5",placeholder:"2",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})})]}),A.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[A.jsx(Gi,{control:B.control,name:"sqft",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Square Feet"}),A.jsx(Wi,{children:A.jsx(jn,{type:"number",placeholder:"2000",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"lot_size",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Lot Size"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"0.25 acres",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})})]})]})]}),A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"External Links"})}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsx(Gi,{control:B.control,name:"zillow_url",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"Zillow URL"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"https://zillow.com/...",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})}),A.jsx(Gi,{control:B.control,name:"mls_number",render:({field:te})=>A.jsxs(qi,{children:[A.jsx(Hi,{children:"MLS Number"}),A.jsx(Wi,{children:A.jsx(jn,{placeholder:"MLS123456",className:"rounded-xl",...te})}),A.jsx(Zi,{})]})})]})]})]})}),A.jsx(Uu,{value:"images",children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Photos"})}),A.jsx(Ii,{className:"p-6",children:A.jsx(Jke,{images:u,onImagesChange:f,coverImage:o,onCoverImageChange:v,listingId:e})})]})}),A.jsx(Uu,{value:"features",children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Features & Amenities"})}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsxs("div",{className:"flex gap-2",children:[A.jsx(jn,{placeholder:"Add a feature (e.g., Hardwood Floors)",value:C,onChange:te=>k(te.target.value),onKeyDown:te=>te.key==="Enter"&&(te.preventDefault(),q()),className:"rounded-xl"}),A.jsx(fn,{type:"button",onClick:q,variant:"outline",className:"rounded-full",children:"Add"})]}),A.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((te,Q)=>A.jsxs("span",{className:"inline-flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-full text-sm font-medium",children:[te,A.jsx("button",{type:"button",onClick:()=>H(Q),className:"hover:text-destructive",children:""})]},Q))})]})]})})]})]})})})}function oRe(){var C,k;const[e,t]=X.useState(!1),[r,n]=X.useState([]),l=X.useRef(null),u=Yte(),[f,o]=X.useState({title:"",address:"",city:"",state:"",zip:"",price:"",beds:"",baths:"",sqft:"",description:"",zillow_url:""}),v=L=>{var B;const $=(B=L.target.files)==null?void 0:B[0];if(!$)return;const j=new FileReader;j.onload=U=>{var ae;const H=((ae=U.target)==null?void 0:ae.result).split(`
`),te=H[0].split(",").map(ue=>ue.trim().toLowerCase()),Q=H.slice(1).filter(ue=>ue.trim()).map(ue=>{const me=ue.split(","),Ce={};return te.forEach((Fe,Ge)=>{var Ve;Ce[Fe]=((Ve=me[Ge])==null?void 0:Ve.trim())||""}),Ce});n(Q),Ni.success(`Parsed ${Q.length} listings from CSV`)},j.readAsText($)},w=async()=>{var j,B;if(r.length===0){Ni.error("No CSV data to import");return}t(!0);let L=0,$=0;for(const U of r)try{const q=oz(U.title||U.address,U.city);await u.mutateAsync({title:U.title||`${U.address}, ${U.city}`,address:U.address||"",city:U.city||"",state:U.state||"",zip:U.zip||"",price:parseFloat((j=U.price)==null?void 0:j.replace(/[^0-9.]/g,""))||0,beds:parseInt(U.beds)||void 0,baths:parseFloat(U.baths)||void 0,sqft:parseInt((B=U.sqft)==null?void 0:B.replace(/[^0-9]/g,""))||void 0,description:U.description||"",zillow_url:U.zillow_url||U.zillowurl||null,slug:q,property_type:"house",status:"for_sale",source:"csv",published:!1}),L++}catch(q){$++,console.error("Import error:",q)}t(!1),n([]),l.current&&(l.current.value=""),Ni.success(`Imported ${L} listings${$>0?`, ${$} failed`:""}`)},P=async L=>{if(L.preventDefault(),!f.title||!f.city||!f.price){Ni.error("Title, city, and price are required");return}t(!0);try{const $=oz(f.title,f.city);await u.mutateAsync({title:f.title,address:f.address||f.title,city:f.city,state:f.state||"",zip:f.zip||"",price:parseFloat(f.price),beds:f.beds?parseInt(f.beds):void 0,baths:f.baths?parseFloat(f.baths):void 0,sqft:f.sqft?parseInt(f.sqft):void 0,description:f.description,zillow_url:f.zillow_url||null,slug:$,property_type:"house",status:"for_sale",source:"manual",published:!1}),o({title:"",address:"",city:"",state:"",zip:"",price:"",beds:"",baths:"",sqft:"",description:"",zillow_url:""}),Ni.success("Listing added successfully")}catch($){console.error("Quick add error:",$)}finally{t(!1)}};return A.jsx(Jh,{children:A.jsxs("div",{className:"space-y-6",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[A.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[A.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-primary flex items-center justify-center",children:A.jsx(AO,{className:"h-5 w-5 text-primary-foreground"})}),A.jsx("h1",{className:"font-display text-3xl font-bold text-gradient",children:"Import Listings"})]}),A.jsx("p",{className:"text-muted-foreground",children:"Import listings from CSV or add them manually"})]}),A.jsxs(ik,{defaultValue:"csv",className:"space-y-6",children:[A.jsx(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:A.jsxs(eE,{className:"rounded-full bg-muted/50 p-1",children:[A.jsxs(Vu,{value:"csv",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(TG,{className:"h-4 w-4 mr-2"}),"CSV Upload"]}),A.jsxs(Vu,{value:"quick",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(PG,{className:"h-4 w-4 mr-2"}),"Quick Add"]}),A.jsxs(Vu,{value:"idx",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(VD,{className:"h-4 w-4 mr-2"}),"IDX/MLS Feed"]})]})}),A.jsx(Uu,{value:"csv",children:A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsxs(Vo,{className:"border-b border-border/50 bg-muted/30",children:[A.jsxs(Uo,{className:"font-display flex items-center gap-2",children:[A.jsx(tN,{className:"h-5 w-5 text-primary"}),"Upload CSV File"]}),A.jsx(Zg,{children:"Upload a CSV file with columns: title, address, city, state, zip, price, beds, baths, sqft, description, zillow_url"})]}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsxs(Ar.div,{whileHover:{scale:1.01},whileTap:{scale:.99},className:"border-2 border-dashed border-border/50 rounded-3xl p-12 text-center cursor-pointer hover:border-primary/50 hover:bg-muted/30 transition-all duration-300",onClick:()=>{var L;return(L=l.current)==null?void 0:L.click()},children:[A.jsx(Ar.div,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",children:A.jsx(TG,{className:"h-8 w-8 text-primary"})}),A.jsx("p",{className:"font-medium mb-1",children:"Click to select a CSV file"}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"or drag and drop your file here"}),A.jsx("input",{ref:l,type:"file",accept:".csv",className:"hidden",onChange:v})]}),r.length>0&&A.jsxs(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-4",children:[A.jsx("div",{className:"p-5 bg-success/10 border border-success/20 rounded-2xl",children:A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"h-10 w-10 rounded-full bg-success/20 flex items-center justify-center",children:A.jsx(eB,{className:"h-5 w-5 text-success"})}),A.jsxs("div",{children:[A.jsxs("p",{className:"font-medium text-success",children:[r.length," listings ready to import"]}),A.jsxs("p",{className:"text-sm text-muted-foreground",children:["Preview: ",((C=r[0])==null?void 0:C.title)||((k=r[0])==null?void 0:k.address)||"No title"]})]})]})}),A.jsx(fn,{onClick:w,disabled:e,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:e?A.jsxs(A.Fragment,{children:[A.jsx(Ld,{className:"h-4 w-4 mr-2 animate-spin"}),"Importing..."]}):A.jsxs(A.Fragment,{children:[A.jsx(tN,{className:"h-4 w-4 mr-2"}),"Import ",r.length," Listings"]})})]})]})]})})}),A.jsx(Uu,{value:"quick",children:A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsxs(Vo,{className:"border-b border-border/50 bg-muted/30",children:[A.jsxs(Uo,{className:"font-display flex items-center gap-2",children:[A.jsx(PG,{className:"h-5 w-5 text-primary"}),"Quick Add Listing"]}),A.jsx(Zg,{children:"Quickly add a listing with minimal information"})]}),A.jsx(Ii,{className:"p-6",children:A.jsxs("form",{onSubmit:P,className:"space-y-6",children:[A.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Title *"}),A.jsx(jn,{value:f.title,onChange:L=>o({...f,title:L.target.value}),placeholder:"Beautiful 3BR Home",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Price *"}),A.jsx(jn,{type:"number",value:f.price,onChange:L=>o({...f,price:L.target.value}),placeholder:"500000",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Address"}),A.jsx(jn,{value:f.address,onChange:L=>o({...f,address:L.target.value}),placeholder:"123 Main St",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"City *"}),A.jsx(jn,{value:f.city,onChange:L=>o({...f,city:L.target.value}),placeholder:"Austin",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"State"}),A.jsx(jn,{value:f.state,onChange:L=>o({...f,state:L.target.value}),placeholder:"TX",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"ZIP"}),A.jsx(jn,{value:f.zip,onChange:L=>o({...f,zip:L.target.value}),placeholder:"78701",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Beds"}),A.jsx(jn,{type:"number",value:f.beds,onChange:L=>o({...f,beds:L.target.value}),placeholder:"3",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Baths"}),A.jsx(jn,{type:"number",step:"0.5",value:f.baths,onChange:L=>o({...f,baths:L.target.value}),placeholder:"2",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Sq Ft"}),A.jsx(jn,{type:"number",value:f.sqft,onChange:L=>o({...f,sqft:L.target.value}),placeholder:"2000",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Zillow URL"}),A.jsx(jn,{value:f.zillow_url,onChange:L=>o({...f,zillow_url:L.target.value}),placeholder:"https://zillow.com/...",className:"rounded-xl"})]})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Description"}),A.jsx(JT,{value:f.description,onChange:L=>o({...f,description:L.target.value}),placeholder:"Property description...",className:"rounded-xl min-h-[100px]"})]}),A.jsxs(fn,{type:"submit",disabled:e,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:[e?A.jsx(Ld,{className:"h-4 w-4 mr-2 animate-spin"}):A.jsx(AC,{className:"h-4 w-4 mr-2"}),"Add Listing"]})]})})]})})}),A.jsx(Uu,{value:"idx",children:A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsxs(Vo,{className:"border-b border-border/50 bg-muted/30",children:[A.jsxs(Uo,{className:"font-display flex items-center gap-2",children:[A.jsx(VD,{className:"h-5 w-5 text-primary"}),"IDX/MLS Feed Integration"]}),A.jsx(Zg,{children:"Connect to your brokerage's IDX or MLS data feed for automatic listing sync"})]}),A.jsx(Ii,{className:"p-6",children:A.jsxs("div",{className:"p-12 border-2 border-dashed border-border/50 rounded-3xl text-center",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx(VD,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground mb-2",children:"IDX/MLS integration requires configuration with your brokerage or MLS provider."}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"Contact your MLS provider to obtain API credentials, then configure them in Settings."})]})})]})})})]})]})})}var sRe=Array.isArray,Vl=sRe,aRe=typeof m1=="object"&&m1&&m1.Object===Object&&m1,Hoe=aRe,lRe=Hoe,cRe=typeof self=="object"&&self&&self.Object===Object&&self,uRe=lRe||cRe||Function("return this")(),Xd=uRe,dRe=Xd,hRe=dRe.Symbol,nE=hRe,DW=nE,Woe=Object.prototype,fRe=Woe.hasOwnProperty,pRe=Woe.toString,o1=DW?DW.toStringTag:void 0;function mRe(e){var t=fRe.call(e,o1),r=e[o1];try{e[o1]=void 0;var n=!0}catch{}var l=pRe.call(e);return n&&(t?e[o1]=r:delete e[o1]),l}var gRe=mRe,yRe=Object.prototype,_Re=yRe.toString;function vRe(e){return _Re.call(e)}var xRe=vRe,LW=nE,bRe=gRe,wRe=xRe,SRe="[object Null]",TRe="[object Undefined]",jW=LW?LW.toStringTag:void 0;function ERe(e){return e==null?e===void 0?TRe:SRe:jW&&jW in Object(e)?bRe(e):wRe(e)}var lf=ERe;function ARe(e){return e!=null&&typeof e=="object"}var cf=ARe,PRe=lf,CRe=cf,IRe="[object Symbol]";function ORe(e){return typeof e=="symbol"||CRe(e)&&PRe(e)==IRe}var Sx=ORe,kRe=Vl,RRe=Sx,MRe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,DRe=/^\w*$/;function LRe(e,t){if(kRe(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||RRe(e)?!0:DRe.test(e)||!MRe.test(e)||t!=null&&e in Object(t)}var N5=LRe;function jRe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var sm=jRe;const Tx=zi(sm);var NRe=lf,zRe=sm,FRe="[object AsyncFunction]",BRe="[object Function]",$Re="[object GeneratorFunction]",VRe="[object Proxy]";function URe(e){if(!zRe(e))return!1;var t=NRe(e);return t==BRe||t==$Re||t==FRe||t==VRe}var z5=URe;const Rn=zi(z5);var GRe=Xd,qRe=GRe["__core-js_shared__"],HRe=qRe,IL=HRe,NW=function(){var e=/[^.]+$/.exec(IL&&IL.keys&&IL.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function WRe(e){return!!NW&&NW in e}var ZRe=WRe,XRe=Function.prototype,KRe=XRe.toString;function YRe(e){if(e!=null){try{return KRe.call(e)}catch{}try{return e+""}catch{}}return""}var Zoe=YRe,JRe=z5,QRe=ZRe,eMe=sm,tMe=Zoe,rMe=/[\\^$.*+?()[\]{}|]/g,nMe=/^\[object .+?Constructor\]$/,iMe=Function.prototype,oMe=Object.prototype,sMe=iMe.toString,aMe=oMe.hasOwnProperty,lMe=RegExp("^"+sMe.call(aMe).replace(rMe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function cMe(e){if(!eMe(e)||QRe(e))return!1;var t=JRe(e)?lMe:nMe;return t.test(tMe(e))}var uMe=cMe;function dMe(e,t){return e==null?void 0:e[t]}var hMe=dMe,fMe=uMe,pMe=hMe;function mMe(e,t){var r=pMe(e,t);return fMe(r)?r:void 0}var Py=mMe,gMe=Py,yMe=gMe(Object,"create"),ck=yMe,zW=ck;function _Me(){this.__data__=zW?zW(null):{},this.size=0}var vMe=_Me;function xMe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var bMe=xMe,wMe=ck,SMe="__lodash_hash_undefined__",TMe=Object.prototype,EMe=TMe.hasOwnProperty;function AMe(e){var t=this.__data__;if(wMe){var r=t[e];return r===SMe?void 0:r}return EMe.call(t,e)?t[e]:void 0}var PMe=AMe,CMe=ck,IMe=Object.prototype,OMe=IMe.hasOwnProperty;function kMe(e){var t=this.__data__;return CMe?t[e]!==void 0:OMe.call(t,e)}var RMe=kMe,MMe=ck,DMe="__lodash_hash_undefined__";function LMe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=MMe&&t===void 0?DMe:t,this}var jMe=LMe,NMe=vMe,zMe=bMe,FMe=PMe,BMe=RMe,$Me=jMe;function Ex(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ex.prototype.clear=NMe;Ex.prototype.delete=zMe;Ex.prototype.get=FMe;Ex.prototype.has=BMe;Ex.prototype.set=$Me;var VMe=Ex;function UMe(){this.__data__=[],this.size=0}var GMe=UMe;function qMe(e,t){return e===t||e!==e&&t!==t}var F5=qMe,HMe=F5;function WMe(e,t){for(var r=e.length;r--;)if(HMe(e[r][0],t))return r;return-1}var uk=WMe,ZMe=uk,XMe=Array.prototype,KMe=XMe.splice;function YMe(e){var t=this.__data__,r=ZMe(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():KMe.call(t,r,1),--this.size,!0}var JMe=YMe,QMe=uk;function eDe(e){var t=this.__data__,r=QMe(t,e);return r<0?void 0:t[r][1]}var tDe=eDe,rDe=uk;function nDe(e){return rDe(this.__data__,e)>-1}var iDe=nDe,oDe=uk;function sDe(e,t){var r=this.__data__,n=oDe(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var aDe=sDe,lDe=GMe,cDe=JMe,uDe=tDe,dDe=iDe,hDe=aDe;function Ax(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ax.prototype.clear=lDe;Ax.prototype.delete=cDe;Ax.prototype.get=uDe;Ax.prototype.has=dDe;Ax.prototype.set=hDe;var dk=Ax,fDe=Py,pDe=Xd,mDe=fDe(pDe,"Map"),B5=mDe,FW=VMe,gDe=dk,yDe=B5;function _De(){this.size=0,this.__data__={hash:new FW,map:new(yDe||gDe),string:new FW}}var vDe=_De;function xDe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var bDe=xDe,wDe=bDe;function SDe(e,t){var r=e.__data__;return wDe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var hk=SDe,TDe=hk;function EDe(e){var t=TDe(this,e).delete(e);return this.size-=t?1:0,t}var ADe=EDe,PDe=hk;function CDe(e){return PDe(this,e).get(e)}var IDe=CDe,ODe=hk;function kDe(e){return ODe(this,e).has(e)}var RDe=kDe,MDe=hk;function DDe(e,t){var r=MDe(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var LDe=DDe,jDe=vDe,NDe=ADe,zDe=IDe,FDe=RDe,BDe=LDe;function Px(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Px.prototype.clear=jDe;Px.prototype.delete=NDe;Px.prototype.get=zDe;Px.prototype.has=FDe;Px.prototype.set=BDe;var $5=Px,Xoe=$5,$De="Expected a function";function V5(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError($De);var r=function(){var n=arguments,l=t?t.apply(this,n):n[0],u=r.cache;if(u.has(l))return u.get(l);var f=e.apply(this,n);return r.cache=u.set(l,f)||u,f};return r.cache=new(V5.Cache||Xoe),r}V5.Cache=Xoe;var Koe=V5;const VDe=zi(Koe);var UDe=Koe,GDe=500;function qDe(e){var t=UDe(e,function(n){return r.size===GDe&&r.clear(),n}),r=t.cache;return t}var HDe=qDe,WDe=HDe,ZDe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,XDe=/\\(\\)?/g,KDe=WDe(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ZDe,function(r,n,l,u){t.push(l?u.replace(XDe,"$1"):n||r)}),t}),YDe=KDe;function JDe(e,t){for(var r=-1,n=e==null?0:e.length,l=Array(n);++r<n;)l[r]=t(e[r],r,e);return l}var U5=JDe,BW=nE,QDe=U5,eLe=Vl,tLe=Sx,rLe=1/0,$W=BW?BW.prototype:void 0,VW=$W?$W.toString:void 0;function Yoe(e){if(typeof e=="string")return e;if(eLe(e))return QDe(e,Yoe)+"";if(tLe(e))return VW?VW.call(e):"";var t=e+"";return t=="0"&&1/e==-rLe?"-0":t}var nLe=Yoe,iLe=nLe;function oLe(e){return e==null?"":iLe(e)}var Joe=oLe,sLe=Vl,aLe=N5,lLe=YDe,cLe=Joe;function uLe(e,t){return sLe(e)?e:aLe(e,t)?[e]:lLe(cLe(e))}var Qoe=uLe,dLe=Sx,hLe=1/0;function fLe(e){if(typeof e=="string"||dLe(e))return e;var t=e+"";return t=="0"&&1/e==-hLe?"-0":t}var fk=fLe,pLe=Qoe,mLe=fk;function gLe(e,t){t=pLe(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[mLe(t[r++])];return r&&r==n?e:void 0}var G5=gLe,yLe=G5;function _Le(e,t,r){var n=e==null?void 0:yLe(e,t);return n===void 0?r:n}var ese=_Le;const dc=zi(ese);function vLe(e){return e==null}var xLe=vLe;const oi=zi(xLe);var bLe=lf,wLe=Vl,SLe=cf,TLe="[object String]";function ELe(e){return typeof e=="string"||!wLe(e)&&SLe(e)&&bLe(e)==TLe}var ALe=ELe;const hy=zi(ALe);var tse={exports:{}},Yi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q5=Symbol.for("react.element"),H5=Symbol.for("react.portal"),pk=Symbol.for("react.fragment"),mk=Symbol.for("react.strict_mode"),gk=Symbol.for("react.profiler"),yk=Symbol.for("react.provider"),_k=Symbol.for("react.context"),PLe=Symbol.for("react.server_context"),vk=Symbol.for("react.forward_ref"),xk=Symbol.for("react.suspense"),bk=Symbol.for("react.suspense_list"),wk=Symbol.for("react.memo"),Sk=Symbol.for("react.lazy"),CLe=Symbol.for("react.offscreen"),rse;rse=Symbol.for("react.module.reference");function nu(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case q5:switch(e=e.type,e){case pk:case gk:case mk:case xk:case bk:return e;default:switch(e=e&&e.$$typeof,e){case PLe:case _k:case vk:case Sk:case wk:case yk:return e;default:return t}}case H5:return t}}}Yi.ContextConsumer=_k;Yi.ContextProvider=yk;Yi.Element=q5;Yi.ForwardRef=vk;Yi.Fragment=pk;Yi.Lazy=Sk;Yi.Memo=wk;Yi.Portal=H5;Yi.Profiler=gk;Yi.StrictMode=mk;Yi.Suspense=xk;Yi.SuspenseList=bk;Yi.isAsyncMode=function(){return!1};Yi.isConcurrentMode=function(){return!1};Yi.isContextConsumer=function(e){return nu(e)===_k};Yi.isContextProvider=function(e){return nu(e)===yk};Yi.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===q5};Yi.isForwardRef=function(e){return nu(e)===vk};Yi.isFragment=function(e){return nu(e)===pk};Yi.isLazy=function(e){return nu(e)===Sk};Yi.isMemo=function(e){return nu(e)===wk};Yi.isPortal=function(e){return nu(e)===H5};Yi.isProfiler=function(e){return nu(e)===gk};Yi.isStrictMode=function(e){return nu(e)===mk};Yi.isSuspense=function(e){return nu(e)===xk};Yi.isSuspenseList=function(e){return nu(e)===bk};Yi.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===pk||e===gk||e===mk||e===xk||e===bk||e===CLe||typeof e=="object"&&e!==null&&(e.$$typeof===Sk||e.$$typeof===wk||e.$$typeof===yk||e.$$typeof===_k||e.$$typeof===vk||e.$$typeof===rse||e.getModuleId!==void 0)};Yi.typeOf=nu;tse.exports=Yi;var ILe=tse.exports,OLe=lf,kLe=cf,RLe="[object Number]";function MLe(e){return typeof e=="number"||kLe(e)&&OLe(e)==RLe}var nse=MLe;const DLe=zi(nse);var LLe=nse;function jLe(e){return LLe(e)&&e!=+e}var NLe=jLe;const iE=zi(NLe);var gl=function(t){return t===0?0:t>0?1:-1},Rg=function(t){return hy(t)&&t.indexOf("%")===t.length-1},fr=function(t){return DLe(t)&&!iE(t)},zLe=function(t){return oi(t)},Us=function(t){return fr(t)||hy(t)},FLe=0,oE=function(t){var r=++FLe;return"".concat(t||"").concat(r)},yl=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!fr(t)&&!hy(t))return n;var u;if(Rg(t)){var f=t.indexOf("%");u=r*parseFloat(t.slice(0,f))/100}else u=+t;return iE(u)&&(u=n),l&&u>r&&(u=r),u},pp=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},BLe=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},l=0;l<r;l++)if(!n[t[l]])n[t[l]]=!0;else return!0;return!1},cp=function(t,r){return fr(t)&&fr(r)?function(n){return t+n*(r-t)}:function(){return r}};function wz(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):dc(n,t))===r})}var $Le=function(t,r){return fr(t)&&fr(r)?t-r:hy(t)&&hy(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function t0(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function Sz(e){"@babel/helpers - typeof";return Sz=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sz(e)}var VLe=["viewBox","children"],ULe=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],UW=["points","pathLength"],OL={svg:VLe,polygon:UW,polyline:UW},W5=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],lI=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(X.isValidElement(t)&&(n=t.props),!Tx(n))return null;var l={};return Object.keys(n).forEach(function(u){W5.includes(u)&&(l[u]=r||function(f){return n[u](n,f)})}),l},GLe=function(t,r,n){return function(l){return t(r,n,l),null}},fy=function(t,r,n){if(!Tx(t)||Sz(t)!=="object")return null;var l=null;return Object.keys(t).forEach(function(u){var f=t[u];W5.includes(u)&&typeof f=="function"&&(l||(l={}),l[u]=GLe(f,r,n))}),l},qLe=["children"],HLe=["children"];function GW(e,t){if(e==null)return{};var r=WLe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function WLe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var qW={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Bh=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},HW=null,kL=null,Z5=function e(t){if(t===HW&&Array.isArray(kL))return kL;var r=[];return X.Children.forEach(t,function(n){oi(n)||(ILe.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),kL=r,HW=t,r};function Kc(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(l){return Bh(l)}):n=[Bh(t)],Z5(e).forEach(function(l){var u=dc(l,"type.displayName")||dc(l,"type.name");n.indexOf(u)!==-1&&r.push(l)}),r}function rc(e,t){var r=Kc(e,t);return r&&r[0]}var WW=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,l=r.height;return!(!fr(n)||n<=0||!fr(l)||l<=0)},ZLe=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],XLe=function(t){return t&&t.type&&hy(t.type)&&ZLe.indexOf(t.type)>=0},KLe=function(t,r,n,l){var u,f=(u=OL==null?void 0:OL[l])!==null&&u!==void 0?u:[];return r.startsWith("data-")||!Rn(t)&&(l&&f.includes(r)||ULe.includes(r))||n&&W5.includes(r)},Pn=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var l=t;if(X.isValidElement(t)&&(l=t.props),!Tx(l))return null;var u={};return Object.keys(l).forEach(function(f){var o;KLe((o=l)===null||o===void 0?void 0:o[f],f,r,n)&&(u[f]=l[f])}),u},Tz=function e(t,r){if(t===r)return!0;var n=X.Children.count(t);if(n!==X.Children.count(r))return!1;if(n===0)return!0;if(n===1)return ZW(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var l=0;l<n;l++){var u=t[l],f=r[l];if(Array.isArray(u)||Array.isArray(f)){if(!e(u,f))return!1}else if(!ZW(u,f))return!1}return!0},ZW=function(t,r){if(oi(t)&&oi(r))return!0;if(!oi(t)&&!oi(r)){var n=t.props||{},l=n.children,u=GW(n,qLe),f=r.props||{},o=f.children,v=GW(f,HLe);return l&&o?t0(u,v)&&Tz(l,o):!l&&!o?t0(u,v):!1}return!1},XW=function(t,r){var n=[],l={};return Z5(t).forEach(function(u,f){if(XLe(u))n.push(u);else if(u){var o=Bh(u.type),v=r[o]||{},w=v.handler,P=v.once;if(w&&(!P||!l[o])){var C=w(u,o,f);n.push(C),l[o]=!0}}}),n},YLe=function(t){var r=t&&t.type;return r&&qW[r]?qW[r]:null},JLe=function(t,r){return Z5(r).indexOf(t)},QLe=["children","width","height","viewBox","className","style","title","desc"];function Ez(){return Ez=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ez.apply(this,arguments)}function eje(e,t){if(e==null)return{};var r=tje(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tje(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Az(e){var t=e.children,r=e.width,n=e.height,l=e.viewBox,u=e.className,f=e.style,o=e.title,v=e.desc,w=eje(e,QLe),P=l||{width:r,height:n,x:0,y:0},C=Gn("recharts-surface",u);return De.createElement("svg",Ez({},Pn(w,!0,"svg"),{className:C,width:r,height:n,style:f,viewBox:"".concat(P.x," ").concat(P.y," ").concat(P.width," ").concat(P.height)}),De.createElement("title",null,o),De.createElement("desc",null,v),t)}var rje=["children","className"];function Pz(){return Pz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pz.apply(this,arguments)}function nje(e,t){if(e==null)return{};var r=ije(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ije(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Xi=De.forwardRef(function(e,t){var r=e.children,n=e.className,l=nje(e,rje),u=Gn("recharts-layer",n);return De.createElement("g",Pz({className:u},Pn(l,!0),{ref:t}),r)}),Gu=function(t,r){for(var n=arguments.length,l=new Array(n>2?n-2:0),u=2;u<n;u++)l[u-2]=arguments[u]};function oje(e,t,r){var n=-1,l=e.length;t<0&&(t=-t>l?0:l+t),r=r>l?l:r,r<0&&(r+=l),l=t>r?0:r-t>>>0,t>>>=0;for(var u=Array(l);++n<l;)u[n]=e[n+t];return u}var sje=oje,aje=sje;function lje(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:aje(e,t,r)}var cje=lje,uje="\\ud800-\\udfff",dje="\\u0300-\\u036f",hje="\\ufe20-\\ufe2f",fje="\\u20d0-\\u20ff",pje=dje+hje+fje,mje="\\ufe0e\\ufe0f",gje="\\u200d",yje=RegExp("["+gje+uje+pje+mje+"]");function _je(e){return yje.test(e)}var ise=_je;function vje(e){return e.split("")}var xje=vje,ose="\\ud800-\\udfff",bje="\\u0300-\\u036f",wje="\\ufe20-\\ufe2f",Sje="\\u20d0-\\u20ff",Tje=bje+wje+Sje,Eje="\\ufe0e\\ufe0f",Aje="["+ose+"]",Cz="["+Tje+"]",Iz="\\ud83c[\\udffb-\\udfff]",Pje="(?:"+Cz+"|"+Iz+")",sse="[^"+ose+"]",ase="(?:\\ud83c[\\udde6-\\uddff]){2}",lse="[\\ud800-\\udbff][\\udc00-\\udfff]",Cje="\\u200d",cse=Pje+"?",use="["+Eje+"]?",Ije="(?:"+Cje+"(?:"+[sse,ase,lse].join("|")+")"+use+cse+")*",Oje=use+cse+Ije,kje="(?:"+[sse+Cz+"?",Cz,ase,lse,Aje].join("|")+")",Rje=RegExp(Iz+"(?="+Iz+")|"+kje+Oje,"g");function Mje(e){return e.match(Rje)||[]}var Dje=Mje,Lje=xje,jje=ise,Nje=Dje;function zje(e){return jje(e)?Nje(e):Lje(e)}var Fje=zje,Bje=cje,$je=ise,Vje=Fje,Uje=Joe;function Gje(e){return function(t){t=Uje(t);var r=$je(t)?Vje(t):void 0,n=r?r[0]:t.charAt(0),l=r?Bje(r,1).join(""):t.slice(1);return n[e]()+l}}var qje=Gje,Hje=qje,Wje=Hje("toUpperCase"),Zje=Wje;const Tk=zi(Zje);function lo(e){return function(){return e}}const dse=Math.cos,cI=Math.sin,Xu=Math.sqrt,uI=Math.PI,Ek=2*uI,Oz=Math.PI,kz=2*Oz,vg=1e-6,Xje=kz-vg;function hse(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function Kje(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return hse;const r=10**t;return function(n){this._+=n[0];for(let l=1,u=n.length;l<u;++l)this._+=Math.round(arguments[l]*r)/r+n[l]}}class Yje{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?hse:Kje(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,l){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+l}`}bezierCurveTo(t,r,n,l,u,f){this._append`C${+t},${+r},${+n},${+l},${this._x1=+u},${this._y1=+f}`}arcTo(t,r,n,l,u){if(t=+t,r=+r,n=+n,l=+l,u=+u,u<0)throw new Error(`negative radius: ${u}`);let f=this._x1,o=this._y1,v=n-t,w=l-r,P=f-t,C=o-r,k=P*P+C*C;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(k>vg)if(!(Math.abs(C*v-w*P)>vg)||!u)this._append`L${this._x1=t},${this._y1=r}`;else{let L=n-f,$=l-o,j=v*v+w*w,B=L*L+$*$,U=Math.sqrt(j),q=Math.sqrt(k),H=u*Math.tan((Oz-Math.acos((j+k-B)/(2*U*q)))/2),te=H/q,Q=H/U;Math.abs(te-1)>vg&&this._append`L${t+te*P},${r+te*C}`,this._append`A${u},${u},0,0,${+(C*L>P*$)},${this._x1=t+Q*v},${this._y1=r+Q*w}`}}arc(t,r,n,l,u,f){if(t=+t,r=+r,n=+n,f=!!f,n<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(l),v=n*Math.sin(l),w=t+o,P=r+v,C=1^f,k=f?l-u:u-l;this._x1===null?this._append`M${w},${P}`:(Math.abs(this._x1-w)>vg||Math.abs(this._y1-P)>vg)&&this._append`L${w},${P}`,n&&(k<0&&(k=k%kz+kz),k>Xje?this._append`A${n},${n},0,1,${C},${t-o},${r-v}A${n},${n},0,1,${C},${this._x1=w},${this._y1=P}`:k>vg&&this._append`A${n},${n},0,${+(k>=Oz)},${C},${this._x1=t+n*Math.cos(u)},${this._y1=r+n*Math.sin(u)}`)}rect(t,r,n,l){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+l}h${-n}Z`}toString(){return this._}}function X5(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new Yje(t)}function K5(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function fse(e){this._context=e}fse.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Ak(e){return new fse(e)}function pse(e){return e[0]}function mse(e){return e[1]}function gse(e,t){var r=lo(!0),n=null,l=Ak,u=null,f=X5(o);e=typeof e=="function"?e:e===void 0?pse:lo(e),t=typeof t=="function"?t:t===void 0?mse:lo(t);function o(v){var w,P=(v=K5(v)).length,C,k=!1,L;for(n==null&&(u=l(L=f())),w=0;w<=P;++w)!(w<P&&r(C=v[w],w,v))===k&&((k=!k)?u.lineStart():u.lineEnd()),k&&u.point(+e(C,w,v),+t(C,w,v));if(L)return u=null,L+""||null}return o.x=function(v){return arguments.length?(e=typeof v=="function"?v:lo(+v),o):e},o.y=function(v){return arguments.length?(t=typeof v=="function"?v:lo(+v),o):t},o.defined=function(v){return arguments.length?(r=typeof v=="function"?v:lo(!!v),o):r},o.curve=function(v){return arguments.length?(l=v,n!=null&&(u=l(n)),o):l},o.context=function(v){return arguments.length?(v==null?n=u=null:u=l(n=v),o):n},o}function gP(e,t,r){var n=null,l=lo(!0),u=null,f=Ak,o=null,v=X5(w);e=typeof e=="function"?e:e===void 0?pse:lo(+e),t=typeof t=="function"?t:lo(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?mse:lo(+r);function w(C){var k,L,$,j=(C=K5(C)).length,B,U=!1,q,H=new Array(j),te=new Array(j);for(u==null&&(o=f(q=v())),k=0;k<=j;++k){if(!(k<j&&l(B=C[k],k,C))===U)if(U=!U)L=k,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),$=k-1;$>=L;--$)o.point(H[$],te[$]);o.lineEnd(),o.areaEnd()}U&&(H[k]=+e(B,k,C),te[k]=+t(B,k,C),o.point(n?+n(B,k,C):H[k],r?+r(B,k,C):te[k]))}if(q)return o=null,q+""||null}function P(){return gse().defined(l).curve(f).context(u)}return w.x=function(C){return arguments.length?(e=typeof C=="function"?C:lo(+C),n=null,w):e},w.x0=function(C){return arguments.length?(e=typeof C=="function"?C:lo(+C),w):e},w.x1=function(C){return arguments.length?(n=C==null?null:typeof C=="function"?C:lo(+C),w):n},w.y=function(C){return arguments.length?(t=typeof C=="function"?C:lo(+C),r=null,w):t},w.y0=function(C){return arguments.length?(t=typeof C=="function"?C:lo(+C),w):t},w.y1=function(C){return arguments.length?(r=C==null?null:typeof C=="function"?C:lo(+C),w):r},w.lineX0=w.lineY0=function(){return P().x(e).y(t)},w.lineY1=function(){return P().x(e).y(r)},w.lineX1=function(){return P().x(n).y(t)},w.defined=function(C){return arguments.length?(l=typeof C=="function"?C:lo(!!C),w):l},w.curve=function(C){return arguments.length?(f=C,u!=null&&(o=f(u)),w):f},w.context=function(C){return arguments.length?(C==null?u=o=null:o=f(u=C),w):u},w}class yse{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function Jje(e){return new yse(e,!0)}function Qje(e){return new yse(e,!1)}const Y5={draw(e,t){const r=Xu(t/uI);e.moveTo(r,0),e.arc(0,0,r,0,Ek)}},eNe={draw(e,t){const r=Xu(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},_se=Xu(1/3),tNe=_se*2,rNe={draw(e,t){const r=Xu(t/tNe),n=r*_se;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},nNe={draw(e,t){const r=Xu(t),n=-r/2;e.rect(n,n,r,r)}},iNe=.8908130915292852,vse=cI(uI/10)/cI(7*uI/10),oNe=cI(Ek/10)*vse,sNe=-dse(Ek/10)*vse,aNe={draw(e,t){const r=Xu(t*iNe),n=oNe*r,l=sNe*r;e.moveTo(0,-r),e.lineTo(n,l);for(let u=1;u<5;++u){const f=Ek*u/5,o=dse(f),v=cI(f);e.lineTo(v*r,-o*r),e.lineTo(o*n-v*l,v*n+o*l)}e.closePath()}},RL=Xu(3),lNe={draw(e,t){const r=-Xu(t/(RL*3));e.moveTo(0,r*2),e.lineTo(-RL*r,-r),e.lineTo(RL*r,-r),e.closePath()}},Mc=-.5,Dc=Xu(3)/2,Rz=1/Xu(12),cNe=(Rz/2+1)*3,uNe={draw(e,t){const r=Xu(t/cNe),n=r/2,l=r*Rz,u=n,f=r*Rz+r,o=-u,v=f;e.moveTo(n,l),e.lineTo(u,f),e.lineTo(o,v),e.lineTo(Mc*n-Dc*l,Dc*n+Mc*l),e.lineTo(Mc*u-Dc*f,Dc*u+Mc*f),e.lineTo(Mc*o-Dc*v,Dc*o+Mc*v),e.lineTo(Mc*n+Dc*l,Mc*l-Dc*n),e.lineTo(Mc*u+Dc*f,Mc*f-Dc*u),e.lineTo(Mc*o+Dc*v,Mc*v-Dc*o),e.closePath()}};function dNe(e,t){let r=null,n=X5(l);e=typeof e=="function"?e:lo(e||Y5),t=typeof t=="function"?t:lo(t===void 0?64:+t);function l(){let u;if(r||(r=u=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),u)return r=null,u+""||null}return l.type=function(u){return arguments.length?(e=typeof u=="function"?u:lo(u),l):e},l.size=function(u){return arguments.length?(t=typeof u=="function"?u:lo(+u),l):t},l.context=function(u){return arguments.length?(r=u??null,l):r},l}function dI(){}function hI(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function xse(e){this._context=e}xse.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:hI(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:hI(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function hNe(e){return new xse(e)}function bse(e){this._context=e}bse.prototype={areaStart:dI,areaEnd:dI,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:hI(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function fNe(e){return new bse(e)}function wse(e){this._context=e}wse.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:hI(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function pNe(e){return new wse(e)}function Sse(e){this._context=e}Sse.prototype={areaStart:dI,areaEnd:dI,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function mNe(e){return new Sse(e)}function KW(e){return e<0?-1:1}function YW(e,t,r){var n=e._x1-e._x0,l=t-e._x1,u=(e._y1-e._y0)/(n||l<0&&-0),f=(r-e._y1)/(l||n<0&&-0),o=(u*l+f*n)/(n+l);return(KW(u)+KW(f))*Math.min(Math.abs(u),Math.abs(f),.5*Math.abs(o))||0}function JW(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function ML(e,t,r){var n=e._x0,l=e._y0,u=e._x1,f=e._y1,o=(u-n)/3;e._context.bezierCurveTo(n+o,l+o*t,u-o,f-o*r,u,f)}function fI(e){this._context=e}fI.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:ML(this,this._t0,JW(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,ML(this,JW(this,r=YW(this,e,t)),r);break;default:ML(this,this._t0,r=YW(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function Tse(e){this._context=new Ese(e)}(Tse.prototype=Object.create(fI.prototype)).point=function(e,t){fI.prototype.point.call(this,t,e)};function Ese(e){this._context=e}Ese.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,l,u){this._context.bezierCurveTo(t,e,n,r,u,l)}};function gNe(e){return new fI(e)}function yNe(e){return new Tse(e)}function Ase(e){this._context=e}Ase.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=QW(e),l=QW(t),u=0,f=1;f<r;++u,++f)this._context.bezierCurveTo(n[0][u],l[0][u],n[1][u],l[1][u],e[f],t[f]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function QW(e){var t,r=e.length-1,n,l=new Array(r),u=new Array(r),f=new Array(r);for(l[0]=0,u[0]=2,f[0]=e[0]+2*e[1],t=1;t<r-1;++t)l[t]=1,u[t]=4,f[t]=4*e[t]+2*e[t+1];for(l[r-1]=2,u[r-1]=7,f[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=l[t]/u[t-1],u[t]-=n,f[t]-=n*f[t-1];for(l[r-1]=f[r-1]/u[r-1],t=r-2;t>=0;--t)l[t]=(f[t]-l[t+1])/u[t];for(u[r-1]=(e[r]+l[r-1])/2,t=0;t<r-1;++t)u[t]=2*e[t+1]-l[t+1];return[l,u]}function _Ne(e){return new Ase(e)}function Pk(e,t){this._context=e,this._t=t}Pk.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function vNe(e){return new Pk(e,.5)}function xNe(e){return new Pk(e,0)}function bNe(e){return new Pk(e,1)}function z0(e,t){if((f=e.length)>1)for(var r=1,n,l,u=e[t[0]],f,o=u.length;r<f;++r)for(l=u,u=e[t[r]],n=0;n<o;++n)u[n][1]+=u[n][0]=isNaN(l[n][1])?l[n][0]:l[n][1]}function Mz(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function wNe(e,t){return e[t]}function SNe(e){const t=[];return t.key=e,t}function TNe(){var e=lo([]),t=Mz,r=z0,n=wNe;function l(u){var f=Array.from(e.apply(this,arguments),SNe),o,v=f.length,w=-1,P;for(const C of u)for(o=0,++w;o<v;++o)(f[o][w]=[0,+n(C,f[o].key,w,u)]).data=C;for(o=0,P=K5(t(f));o<v;++o)f[P[o]].index=o;return r(f,P),f}return l.keys=function(u){return arguments.length?(e=typeof u=="function"?u:lo(Array.from(u)),l):e},l.value=function(u){return arguments.length?(n=typeof u=="function"?u:lo(+u),l):n},l.order=function(u){return arguments.length?(t=u==null?Mz:typeof u=="function"?u:lo(Array.from(u)),l):t},l.offset=function(u){return arguments.length?(r=u??z0,l):r},l}function ENe(e,t){if((n=e.length)>0){for(var r,n,l=0,u=e[0].length,f;l<u;++l){for(f=r=0;r<n;++r)f+=e[r][l][1]||0;if(f)for(r=0;r<n;++r)e[r][l][1]/=f}z0(e,t)}}function ANe(e,t){if((l=e.length)>0){for(var r=0,n=e[t[0]],l,u=n.length;r<u;++r){for(var f=0,o=0;f<l;++f)o+=e[f][r][1]||0;n[r][1]+=n[r][0]=-o/2}z0(e,t)}}function PNe(e,t){if(!(!((f=e.length)>0)||!((u=(l=e[t[0]]).length)>0))){for(var r=0,n=1,l,u,f;n<u;++n){for(var o=0,v=0,w=0;o<f;++o){for(var P=e[t[o]],C=P[n][1]||0,k=P[n-1][1]||0,L=(C-k)/2,$=0;$<o;++$){var j=e[t[$]],B=j[n][1]||0,U=j[n-1][1]||0;L+=B-U}v+=C,w+=L*C}l[n-1][1]+=l[n-1][0]=r,v&&(r-=w/v)}l[n-1][1]+=l[n-1][0]=r,z0(e,t)}}function GS(e){"@babel/helpers - typeof";return GS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},GS(e)}var CNe=["type","size","sizeType"];function Dz(){return Dz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Dz.apply(this,arguments)}function e9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function t9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e9(Object(r),!0).forEach(function(n){INe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function INe(e,t,r){return t=ONe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ONe(e){var t=kNe(e,"string");return GS(t)=="symbol"?t:t+""}function kNe(e,t){if(GS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(GS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function RNe(e,t){if(e==null)return{};var r=MNe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function MNe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Pse={symbolCircle:Y5,symbolCross:eNe,symbolDiamond:rNe,symbolSquare:nNe,symbolStar:aNe,symbolTriangle:lNe,symbolWye:uNe},DNe=Math.PI/180,LNe=function(t){var r="symbol".concat(Tk(t));return Pse[r]||Y5},jNe=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var l=18*DNe;return 1.25*t*t*(Math.tan(l)-Math.tan(l*2)*Math.pow(Math.tan(l),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},NNe=function(t,r){Pse["symbol".concat(Tk(t))]=r},J5=function(t){var r=t.type,n=r===void 0?"circle":r,l=t.size,u=l===void 0?64:l,f=t.sizeType,o=f===void 0?"area":f,v=RNe(t,CNe),w=t9(t9({},v),{},{type:n,size:u,sizeType:o}),P=function(){var B=LNe(n),U=dNe().type(B).size(jNe(u,o,n));return U()},C=w.className,k=w.cx,L=w.cy,$=Pn(w,!0);return k===+k&&L===+L&&u===+u?De.createElement("path",Dz({},$,{className:Gn("recharts-symbols",C),transform:"translate(".concat(k,", ").concat(L,")"),d:P()})):null};J5.registerSymbol=NNe;function F0(e){"@babel/helpers - typeof";return F0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F0(e)}function Lz(){return Lz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lz.apply(this,arguments)}function r9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function zNe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?r9(Object(r),!0).forEach(function(n){qS(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FNe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BNe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ise(n.key),n)}}function $Ne(e,t,r){return t&&BNe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function VNe(e,t,r){return t=pI(t),UNe(e,Cse()?Reflect.construct(t,r||[],pI(e).constructor):t.apply(e,r))}function UNe(e,t){if(t&&(F0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GNe(e)}function GNe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Cse(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Cse=function(){return!!e})()}function pI(e){return pI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},pI(e)}function qNe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jz(e,t)}function jz(e,t){return jz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},jz(e,t)}function qS(e,t,r){return t=Ise(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ise(e){var t=HNe(e,"string");return F0(t)=="symbol"?t:t+""}function HNe(e,t){if(F0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(F0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Lc=32,Q5=function(e){function t(){return FNe(this,t),VNe(this,t,arguments)}return qNe(t,e),$Ne(t,[{key:"renderIcon",value:function(n){var l=this.props.inactiveColor,u=Lc/2,f=Lc/6,o=Lc/3,v=n.inactive?l:n.color;if(n.type==="plainline")return De.createElement("line",{strokeWidth:4,fill:"none",stroke:v,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:u,x2:Lc,y2:u,className:"recharts-legend-icon"});if(n.type==="line")return De.createElement("path",{strokeWidth:4,fill:"none",stroke:v,d:"M0,".concat(u,"h").concat(o,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(2*o,",").concat(u,`
            H`).concat(Lc,"M").concat(2*o,",").concat(u,`
            A`).concat(f,",").concat(f,",0,1,1,").concat(o,",").concat(u),className:"recharts-legend-icon"});if(n.type==="rect")return De.createElement("path",{stroke:"none",fill:v,d:"M0,".concat(Lc/8,"h").concat(Lc,"v").concat(Lc*3/4,"h").concat(-Lc,"z"),className:"recharts-legend-icon"});if(De.isValidElement(n.legendIcon)){var w=zNe({},n);return delete w.legendIcon,De.cloneElement(n.legendIcon,w)}return De.createElement(J5,{fill:v,cx:u,cy:u,size:Lc,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,l=this.props,u=l.payload,f=l.iconSize,o=l.layout,v=l.formatter,w=l.inactiveColor,P={x:0,y:0,width:Lc,height:Lc},C={display:o==="horizontal"?"inline-block":"block",marginRight:10},k={display:"inline-block",verticalAlign:"middle",marginRight:4};return u.map(function(L,$){var j=L.formatter||v,B=Gn(qS(qS({"recharts-legend-item":!0},"legend-item-".concat($),!0),"inactive",L.inactive));if(L.type==="none")return null;var U=Rn(L.value)?null:L.value;Gu(!Rn(L.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var q=L.inactive?w:L.color;return De.createElement("li",Lz({className:B,style:C,key:"legend-item-".concat($)},fy(n.props,L,$)),De.createElement(Az,{width:f,height:f,viewBox:P,style:k},n.renderIcon(L)),De.createElement("span",{className:"recharts-legend-item-text",style:{color:q}},j?j(U,L,$):U))})}},{key:"render",value:function(){var n=this.props,l=n.payload,u=n.layout,f=n.align;if(!l||!l.length)return null;var o={padding:0,margin:0,textAlign:u==="horizontal"?f:"left"};return De.createElement("ul",{className:"recharts-default-legend",style:o},this.renderItems())}}])}(X.PureComponent);qS(Q5,"displayName","Legend");qS(Q5,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var WNe=dk;function ZNe(){this.__data__=new WNe,this.size=0}var XNe=ZNe;function KNe(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var YNe=KNe;function JNe(e){return this.__data__.get(e)}var QNe=JNe;function eze(e){return this.__data__.has(e)}var tze=eze,rze=dk,nze=B5,ize=$5,oze=200;function sze(e,t){var r=this.__data__;if(r instanceof rze){var n=r.__data__;if(!nze||n.length<oze-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new ize(n)}return r.set(e,t),this.size=r.size,this}var aze=sze,lze=dk,cze=XNe,uze=YNe,dze=QNe,hze=tze,fze=aze;function Cx(e){var t=this.__data__=new lze(e);this.size=t.size}Cx.prototype.clear=cze;Cx.prototype.delete=uze;Cx.prototype.get=dze;Cx.prototype.has=hze;Cx.prototype.set=fze;var Ose=Cx,pze="__lodash_hash_undefined__";function mze(e){return this.__data__.set(e,pze),this}var gze=mze;function yze(e){return this.__data__.has(e)}var _ze=yze,vze=$5,xze=gze,bze=_ze;function mI(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new vze;++t<r;)this.add(e[t])}mI.prototype.add=mI.prototype.push=xze;mI.prototype.has=bze;var kse=mI;function wze(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Rse=wze;function Sze(e,t){return e.has(t)}var Mse=Sze,Tze=kse,Eze=Rse,Aze=Mse,Pze=1,Cze=2;function Ize(e,t,r,n,l,u){var f=r&Pze,o=e.length,v=t.length;if(o!=v&&!(f&&v>o))return!1;var w=u.get(e),P=u.get(t);if(w&&P)return w==t&&P==e;var C=-1,k=!0,L=r&Cze?new Tze:void 0;for(u.set(e,t),u.set(t,e);++C<o;){var $=e[C],j=t[C];if(n)var B=f?n(j,$,C,t,e,u):n($,j,C,e,t,u);if(B!==void 0){if(B)continue;k=!1;break}if(L){if(!Eze(t,function(U,q){if(!Aze(L,q)&&($===U||l($,U,r,n,u)))return L.push(q)})){k=!1;break}}else if(!($===j||l($,j,r,n,u))){k=!1;break}}return u.delete(e),u.delete(t),k}var Dse=Ize,Oze=Xd,kze=Oze.Uint8Array,Rze=kze;function Mze(e){var t=-1,r=Array(e.size);return e.forEach(function(n,l){r[++t]=[l,n]}),r}var Dze=Mze;function Lze(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var e4=Lze,n9=nE,i9=Rze,jze=F5,Nze=Dse,zze=Dze,Fze=e4,Bze=1,$ze=2,Vze="[object Boolean]",Uze="[object Date]",Gze="[object Error]",qze="[object Map]",Hze="[object Number]",Wze="[object RegExp]",Zze="[object Set]",Xze="[object String]",Kze="[object Symbol]",Yze="[object ArrayBuffer]",Jze="[object DataView]",o9=n9?n9.prototype:void 0,DL=o9?o9.valueOf:void 0;function Qze(e,t,r,n,l,u,f){switch(r){case Jze:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Yze:return!(e.byteLength!=t.byteLength||!u(new i9(e),new i9(t)));case Vze:case Uze:case Hze:return jze(+e,+t);case Gze:return e.name==t.name&&e.message==t.message;case Wze:case Xze:return e==t+"";case qze:var o=zze;case Zze:var v=n&Bze;if(o||(o=Fze),e.size!=t.size&&!v)return!1;var w=f.get(e);if(w)return w==t;n|=$ze,f.set(e,t);var P=Nze(o(e),o(t),n,l,u,f);return f.delete(e),P;case Kze:if(DL)return DL.call(e)==DL.call(t)}return!1}var eFe=Qze;function tFe(e,t){for(var r=-1,n=t.length,l=e.length;++r<n;)e[l+r]=t[r];return e}var Lse=tFe,rFe=Lse,nFe=Vl;function iFe(e,t,r){var n=t(e);return nFe(e)?n:rFe(n,r(e))}var oFe=iFe;function sFe(e,t){for(var r=-1,n=e==null?0:e.length,l=0,u=[];++r<n;){var f=e[r];t(f,r,e)&&(u[l++]=f)}return u}var aFe=sFe;function lFe(){return[]}var cFe=lFe,uFe=aFe,dFe=cFe,hFe=Object.prototype,fFe=hFe.propertyIsEnumerable,s9=Object.getOwnPropertySymbols,pFe=s9?function(e){return e==null?[]:(e=Object(e),uFe(s9(e),function(t){return fFe.call(e,t)}))}:dFe,mFe=pFe;function gFe(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var yFe=gFe,_Fe=lf,vFe=cf,xFe="[object Arguments]";function bFe(e){return vFe(e)&&_Fe(e)==xFe}var wFe=bFe,a9=wFe,SFe=cf,jse=Object.prototype,TFe=jse.hasOwnProperty,EFe=jse.propertyIsEnumerable,AFe=a9(function(){return arguments}())?a9:function(e){return SFe(e)&&TFe.call(e,"callee")&&!EFe.call(e,"callee")},t4=AFe,gI={exports:{}};function PFe(){return!1}var CFe=PFe;gI.exports;(function(e,t){var r=Xd,n=CFe,l=t&&!t.nodeType&&t,u=l&&!0&&e&&!e.nodeType&&e,f=u&&u.exports===l,o=f?r.Buffer:void 0,v=o?o.isBuffer:void 0,w=v||n;e.exports=w})(gI,gI.exports);var Nse=gI.exports,IFe=9007199254740991,OFe=/^(?:0|[1-9]\d*)$/;function kFe(e,t){var r=typeof e;return t=t??IFe,!!t&&(r=="number"||r!="symbol"&&OFe.test(e))&&e>-1&&e%1==0&&e<t}var r4=kFe,RFe=9007199254740991;function MFe(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=RFe}var n4=MFe,DFe=lf,LFe=n4,jFe=cf,NFe="[object Arguments]",zFe="[object Array]",FFe="[object Boolean]",BFe="[object Date]",$Fe="[object Error]",VFe="[object Function]",UFe="[object Map]",GFe="[object Number]",qFe="[object Object]",HFe="[object RegExp]",WFe="[object Set]",ZFe="[object String]",XFe="[object WeakMap]",KFe="[object ArrayBuffer]",YFe="[object DataView]",JFe="[object Float32Array]",QFe="[object Float64Array]",e3e="[object Int8Array]",t3e="[object Int16Array]",r3e="[object Int32Array]",n3e="[object Uint8Array]",i3e="[object Uint8ClampedArray]",o3e="[object Uint16Array]",s3e="[object Uint32Array]",So={};So[JFe]=So[QFe]=So[e3e]=So[t3e]=So[r3e]=So[n3e]=So[i3e]=So[o3e]=So[s3e]=!0;So[NFe]=So[zFe]=So[KFe]=So[FFe]=So[YFe]=So[BFe]=So[$Fe]=So[VFe]=So[UFe]=So[GFe]=So[qFe]=So[HFe]=So[WFe]=So[ZFe]=So[XFe]=!1;function a3e(e){return jFe(e)&&LFe(e.length)&&!!So[DFe(e)]}var l3e=a3e;function c3e(e){return function(t){return e(t)}}var zse=c3e,yI={exports:{}};yI.exports;(function(e,t){var r=Hoe,n=t&&!t.nodeType&&t,l=n&&!0&&e&&!e.nodeType&&e,u=l&&l.exports===n,f=u&&r.process,o=function(){try{var v=l&&l.require&&l.require("util").types;return v||f&&f.binding&&f.binding("util")}catch{}}();e.exports=o})(yI,yI.exports);var u3e=yI.exports,d3e=l3e,h3e=zse,l9=u3e,c9=l9&&l9.isTypedArray,f3e=c9?h3e(c9):d3e,Fse=f3e,p3e=yFe,m3e=t4,g3e=Vl,y3e=Nse,_3e=r4,v3e=Fse,x3e=Object.prototype,b3e=x3e.hasOwnProperty;function w3e(e,t){var r=g3e(e),n=!r&&m3e(e),l=!r&&!n&&y3e(e),u=!r&&!n&&!l&&v3e(e),f=r||n||l||u,o=f?p3e(e.length,String):[],v=o.length;for(var w in e)(t||b3e.call(e,w))&&!(f&&(w=="length"||l&&(w=="offset"||w=="parent")||u&&(w=="buffer"||w=="byteLength"||w=="byteOffset")||_3e(w,v)))&&o.push(w);return o}var S3e=w3e,T3e=Object.prototype;function E3e(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||T3e;return e===r}var A3e=E3e;function P3e(e,t){return function(r){return e(t(r))}}var Bse=P3e,C3e=Bse,I3e=C3e(Object.keys,Object),O3e=I3e,k3e=A3e,R3e=O3e,M3e=Object.prototype,D3e=M3e.hasOwnProperty;function L3e(e){if(!k3e(e))return R3e(e);var t=[];for(var r in Object(e))D3e.call(e,r)&&r!="constructor"&&t.push(r);return t}var j3e=L3e,N3e=z5,z3e=n4;function F3e(e){return e!=null&&z3e(e.length)&&!N3e(e)}var sE=F3e,B3e=S3e,$3e=j3e,V3e=sE;function U3e(e){return V3e(e)?B3e(e):$3e(e)}var Ck=U3e,G3e=oFe,q3e=mFe,H3e=Ck;function W3e(e){return G3e(e,H3e,q3e)}var Z3e=W3e,u9=Z3e,X3e=1,K3e=Object.prototype,Y3e=K3e.hasOwnProperty;function J3e(e,t,r,n,l,u){var f=r&X3e,o=u9(e),v=o.length,w=u9(t),P=w.length;if(v!=P&&!f)return!1;for(var C=v;C--;){var k=o[C];if(!(f?k in t:Y3e.call(t,k)))return!1}var L=u.get(e),$=u.get(t);if(L&&$)return L==t&&$==e;var j=!0;u.set(e,t),u.set(t,e);for(var B=f;++C<v;){k=o[C];var U=e[k],q=t[k];if(n)var H=f?n(q,U,k,t,e,u):n(U,q,k,e,t,u);if(!(H===void 0?U===q||l(U,q,r,n,u):H)){j=!1;break}B||(B=k=="constructor")}if(j&&!B){var te=e.constructor,Q=t.constructor;te!=Q&&"constructor"in e&&"constructor"in t&&!(typeof te=="function"&&te instanceof te&&typeof Q=="function"&&Q instanceof Q)&&(j=!1)}return u.delete(e),u.delete(t),j}var Q3e=J3e,eBe=Py,tBe=Xd,rBe=eBe(tBe,"DataView"),nBe=rBe,iBe=Py,oBe=Xd,sBe=iBe(oBe,"Promise"),aBe=sBe,lBe=Py,cBe=Xd,uBe=lBe(cBe,"Set"),$se=uBe,dBe=Py,hBe=Xd,fBe=dBe(hBe,"WeakMap"),pBe=fBe,Nz=nBe,zz=B5,Fz=aBe,Bz=$se,$z=pBe,Vse=lf,Ix=Zoe,d9="[object Map]",mBe="[object Object]",h9="[object Promise]",f9="[object Set]",p9="[object WeakMap]",m9="[object DataView]",gBe=Ix(Nz),yBe=Ix(zz),_Be=Ix(Fz),vBe=Ix(Bz),xBe=Ix($z),xg=Vse;(Nz&&xg(new Nz(new ArrayBuffer(1)))!=m9||zz&&xg(new zz)!=d9||Fz&&xg(Fz.resolve())!=h9||Bz&&xg(new Bz)!=f9||$z&&xg(new $z)!=p9)&&(xg=function(e){var t=Vse(e),r=t==mBe?e.constructor:void 0,n=r?Ix(r):"";if(n)switch(n){case gBe:return m9;case yBe:return d9;case _Be:return h9;case vBe:return f9;case xBe:return p9}return t});var bBe=xg,LL=Ose,wBe=Dse,SBe=eFe,TBe=Q3e,g9=bBe,y9=Vl,_9=Nse,EBe=Fse,ABe=1,v9="[object Arguments]",x9="[object Array]",yP="[object Object]",PBe=Object.prototype,b9=PBe.hasOwnProperty;function CBe(e,t,r,n,l,u){var f=y9(e),o=y9(t),v=f?x9:g9(e),w=o?x9:g9(t);v=v==v9?yP:v,w=w==v9?yP:w;var P=v==yP,C=w==yP,k=v==w;if(k&&_9(e)){if(!_9(t))return!1;f=!0,P=!1}if(k&&!P)return u||(u=new LL),f||EBe(e)?wBe(e,t,r,n,l,u):SBe(e,t,v,r,n,l,u);if(!(r&ABe)){var L=P&&b9.call(e,"__wrapped__"),$=C&&b9.call(t,"__wrapped__");if(L||$){var j=L?e.value():e,B=$?t.value():t;return u||(u=new LL),l(j,B,r,n,u)}}return k?(u||(u=new LL),TBe(e,t,r,n,l,u)):!1}var IBe=CBe,OBe=IBe,w9=cf;function Use(e,t,r,n,l){return e===t?!0:e==null||t==null||!w9(e)&&!w9(t)?e!==e&&t!==t:OBe(e,t,r,n,Use,l)}var i4=Use,kBe=Ose,RBe=i4,MBe=1,DBe=2;function LBe(e,t,r,n){var l=r.length,u=l,f=!n;if(e==null)return!u;for(e=Object(e);l--;){var o=r[l];if(f&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++l<u;){o=r[l];var v=o[0],w=e[v],P=o[1];if(f&&o[2]){if(w===void 0&&!(v in e))return!1}else{var C=new kBe;if(n)var k=n(w,P,v,e,t,C);if(!(k===void 0?RBe(P,w,MBe|DBe,n,C):k))return!1}}return!0}var jBe=LBe,NBe=sm;function zBe(e){return e===e&&!NBe(e)}var Gse=zBe,FBe=Gse,BBe=Ck;function $Be(e){for(var t=BBe(e),r=t.length;r--;){var n=t[r],l=e[n];t[r]=[n,l,FBe(l)]}return t}var VBe=$Be;function UBe(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var qse=UBe,GBe=jBe,qBe=VBe,HBe=qse;function WBe(e){var t=qBe(e);return t.length==1&&t[0][2]?HBe(t[0][0],t[0][1]):function(r){return r===e||GBe(r,e,t)}}var ZBe=WBe;function XBe(e,t){return e!=null&&t in Object(e)}var KBe=XBe,YBe=Qoe,JBe=t4,QBe=Vl,e5e=r4,t5e=n4,r5e=fk;function n5e(e,t,r){t=YBe(t,e);for(var n=-1,l=t.length,u=!1;++n<l;){var f=r5e(t[n]);if(!(u=e!=null&&r(e,f)))break;e=e[f]}return u||++n!=l?u:(l=e==null?0:e.length,!!l&&t5e(l)&&e5e(f,l)&&(QBe(e)||JBe(e)))}var i5e=n5e,o5e=KBe,s5e=i5e;function a5e(e,t){return e!=null&&s5e(e,t,o5e)}var l5e=a5e,c5e=i4,u5e=ese,d5e=l5e,h5e=N5,f5e=Gse,p5e=qse,m5e=fk,g5e=1,y5e=2;function _5e(e,t){return h5e(e)&&f5e(t)?p5e(m5e(e),t):function(r){var n=u5e(r,e);return n===void 0&&n===t?d5e(r,e):c5e(t,n,g5e|y5e)}}var v5e=_5e;function x5e(e){return e}var Ox=x5e;function b5e(e){return function(t){return t==null?void 0:t[e]}}var w5e=b5e,S5e=G5;function T5e(e){return function(t){return S5e(t,e)}}var E5e=T5e,A5e=w5e,P5e=E5e,C5e=N5,I5e=fk;function O5e(e){return C5e(e)?A5e(I5e(e)):P5e(e)}var k5e=O5e,R5e=ZBe,M5e=v5e,D5e=Ox,L5e=Vl,j5e=k5e;function N5e(e){return typeof e=="function"?e:e==null?D5e:typeof e=="object"?L5e(e)?M5e(e[0],e[1]):R5e(e):j5e(e)}var Kd=N5e;function z5e(e,t,r,n){for(var l=e.length,u=r+(n?1:-1);n?u--:++u<l;)if(t(e[u],u,e))return u;return-1}var Hse=z5e;function F5e(e){return e!==e}var B5e=F5e;function $5e(e,t,r){for(var n=r-1,l=e.length;++n<l;)if(e[n]===t)return n;return-1}var V5e=$5e,U5e=Hse,G5e=B5e,q5e=V5e;function H5e(e,t,r){return t===t?q5e(e,t,r):U5e(e,G5e,r)}var W5e=H5e,Z5e=W5e;function X5e(e,t){var r=e==null?0:e.length;return!!r&&Z5e(e,t,0)>-1}var K5e=X5e;function Y5e(e,t,r){for(var n=-1,l=e==null?0:e.length;++n<l;)if(r(t,e[n]))return!0;return!1}var J5e=Y5e;function Q5e(){}var e4e=Q5e,jL=$se,t4e=e4e,r4e=e4,n4e=1/0,i4e=jL&&1/r4e(new jL([,-0]))[1]==n4e?function(e){return new jL(e)}:t4e,o4e=i4e,s4e=kse,a4e=K5e,l4e=J5e,c4e=Mse,u4e=o4e,d4e=e4,h4e=200;function f4e(e,t,r){var n=-1,l=a4e,u=e.length,f=!0,o=[],v=o;if(r)f=!1,l=l4e;else if(u>=h4e){var w=t?null:u4e(e);if(w)return d4e(w);f=!1,l=c4e,v=new s4e}else v=t?[]:o;e:for(;++n<u;){var P=e[n],C=t?t(P):P;if(P=r||P!==0?P:0,f&&C===C){for(var k=v.length;k--;)if(v[k]===C)continue e;t&&v.push(C),o.push(P)}else l(v,C,r)||(v!==o&&v.push(C),o.push(P))}return o}var p4e=f4e,m4e=Kd,g4e=p4e;function y4e(e,t){return e&&e.length?g4e(e,m4e(t)):[]}var _4e=y4e;const S9=zi(_4e);function Wse(e,t,r){return t===!0?S9(e,r):Rn(t)?S9(e,t):e}function B0(e){"@babel/helpers - typeof";return B0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B0(e)}var v4e=["ref"];function T9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function wh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T9(Object(r),!0).forEach(function(n){Ik(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x4e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xse(n.key),n)}}function b4e(e,t,r){return t&&E9(e.prototype,t),r&&E9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function w4e(e,t,r){return t=_I(t),S4e(e,Zse()?Reflect.construct(t,r||[],_I(e).constructor):t.apply(e,r))}function S4e(e,t){if(t&&(B0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return T4e(e)}function T4e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Zse(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zse=function(){return!!e})()}function _I(e){return _I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_I(e)}function E4e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Vz(e,t)}function Vz(e,t){return Vz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},Vz(e,t)}function Ik(e,t,r){return t=Xse(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xse(e){var t=A4e(e,"string");return B0(t)=="symbol"?t:t+""}function A4e(e,t){if(B0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(B0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function P4e(e,t){if(e==null)return{};var r=C4e(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function C4e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function I4e(e){return e.value}function O4e(e,t){if(De.isValidElement(e))return De.cloneElement(e,t);if(typeof e=="function")return De.createElement(e,t);t.ref;var r=P4e(t,v4e);return De.createElement(Q5,r)}var A9=1,r0=function(e){function t(){var r;x4e(this,t);for(var n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];return r=w4e(this,t,[].concat(l)),Ik(r,"lastBoundingBox",{width:-1,height:-1}),r}return E4e(t,e),b4e(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,l=this.getBBox();l?(Math.abs(l.width-this.lastBoundingBox.width)>A9||Math.abs(l.height-this.lastBoundingBox.height)>A9)&&(this.lastBoundingBox.width=l.width,this.lastBoundingBox.height=l.height,n&&n(l)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?wh({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var l=this.props,u=l.layout,f=l.align,o=l.verticalAlign,v=l.margin,w=l.chartWidth,P=l.chartHeight,C,k;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(f==="center"&&u==="vertical"){var L=this.getBBoxSnapshot();C={left:((w||0)-L.width)/2}}else C=f==="right"?{right:v&&v.right||0}:{left:v&&v.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(o==="middle"){var $=this.getBBoxSnapshot();k={top:((P||0)-$.height)/2}}else k=o==="bottom"?{bottom:v&&v.bottom||0}:{top:v&&v.top||0};return wh(wh({},C),k)}},{key:"render",value:function(){var n=this,l=this.props,u=l.content,f=l.width,o=l.height,v=l.wrapperStyle,w=l.payloadUniqBy,P=l.payload,C=wh(wh({position:"absolute",width:f||"auto",height:o||"auto"},this.getDefaultPosition(v)),v);return De.createElement("div",{className:"recharts-legend-wrapper",style:C,ref:function(L){n.wrapperNode=L}},O4e(u,wh(wh({},this.props),{},{payload:Wse(P,w,I4e)})))}}],[{key:"getWithHeight",value:function(n,l){var u=wh(wh({},this.defaultProps),n.props),f=u.layout;return f==="vertical"&&fr(n.props.height)?{height:n.props.height}:f==="horizontal"?{width:n.props.width||l}:null}}])}(X.PureComponent);Ik(r0,"displayName","Legend");Ik(r0,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var P9=nE,k4e=t4,R4e=Vl,C9=P9?P9.isConcatSpreadable:void 0;function M4e(e){return R4e(e)||k4e(e)||!!(C9&&e&&e[C9])}var D4e=M4e,L4e=Lse,j4e=D4e;function Kse(e,t,r,n,l){var u=-1,f=e.length;for(r||(r=j4e),l||(l=[]);++u<f;){var o=e[u];t>0&&r(o)?t>1?Kse(o,t-1,r,n,l):L4e(l,o):n||(l[l.length]=o)}return l}var Yse=Kse;function N4e(e){return function(t,r,n){for(var l=-1,u=Object(t),f=n(t),o=f.length;o--;){var v=f[e?o:++l];if(r(u[v],v,u)===!1)break}return t}}var z4e=N4e,F4e=z4e,B4e=F4e(),$4e=B4e,V4e=$4e,U4e=Ck;function G4e(e,t){return e&&V4e(e,t,U4e)}var Jse=G4e,q4e=sE;function H4e(e,t){return function(r,n){if(r==null)return r;if(!q4e(r))return e(r,n);for(var l=r.length,u=t?l:-1,f=Object(r);(t?u--:++u<l)&&n(f[u],u,f)!==!1;);return r}}var W4e=H4e,Z4e=Jse,X4e=W4e,K4e=X4e(Z4e),o4=K4e,Y4e=o4,J4e=sE;function Q4e(e,t){var r=-1,n=J4e(e)?Array(e.length):[];return Y4e(e,function(l,u,f){n[++r]=t(l,u,f)}),n}var Qse=Q4e;function e$e(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var t$e=e$e,I9=Sx;function r$e(e,t){if(e!==t){var r=e!==void 0,n=e===null,l=e===e,u=I9(e),f=t!==void 0,o=t===null,v=t===t,w=I9(t);if(!o&&!w&&!u&&e>t||u&&f&&v&&!o&&!w||n&&f&&v||!r&&v||!l)return 1;if(!n&&!u&&!w&&e<t||w&&r&&l&&!n&&!u||o&&r&&l||!f&&l||!v)return-1}return 0}var n$e=r$e,i$e=n$e;function o$e(e,t,r){for(var n=-1,l=e.criteria,u=t.criteria,f=l.length,o=r.length;++n<f;){var v=i$e(l[n],u[n]);if(v){if(n>=o)return v;var w=r[n];return v*(w=="desc"?-1:1)}}return e.index-t.index}var s$e=o$e,NL=U5,a$e=G5,l$e=Kd,c$e=Qse,u$e=t$e,d$e=zse,h$e=s$e,f$e=Ox,p$e=Vl;function m$e(e,t,r){t.length?t=NL(t,function(u){return p$e(u)?function(f){return a$e(f,u.length===1?u[0]:u)}:u}):t=[f$e];var n=-1;t=NL(t,d$e(l$e));var l=c$e(e,function(u,f,o){var v=NL(t,function(w){return w(u)});return{criteria:v,index:++n,value:u}});return u$e(l,function(u,f){return h$e(u,f,r)})}var g$e=m$e;function y$e(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var _$e=y$e,v$e=_$e,O9=Math.max;function x$e(e,t,r){return t=O9(t===void 0?e.length-1:t,0),function(){for(var n=arguments,l=-1,u=O9(n.length-t,0),f=Array(u);++l<u;)f[l]=n[t+l];l=-1;for(var o=Array(t+1);++l<t;)o[l]=n[l];return o[t]=r(f),v$e(e,this,o)}}var b$e=x$e;function w$e(e){return function(){return e}}var S$e=w$e,T$e=Py,E$e=function(){try{var e=T$e(Object,"defineProperty");return e({},"",{}),e}catch{}}(),eae=E$e,A$e=S$e,k9=eae,P$e=Ox,C$e=k9?function(e,t){return k9(e,"toString",{configurable:!0,enumerable:!1,value:A$e(t),writable:!0})}:P$e,I$e=C$e,O$e=800,k$e=16,R$e=Date.now;function M$e(e){var t=0,r=0;return function(){var n=R$e(),l=k$e-(n-r);if(r=n,l>0){if(++t>=O$e)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var D$e=M$e,L$e=I$e,j$e=D$e,N$e=j$e(L$e),z$e=N$e,F$e=Ox,B$e=b$e,$$e=z$e;function V$e(e,t){return $$e(B$e(e,t,F$e),e+"")}var U$e=V$e,G$e=F5,q$e=sE,H$e=r4,W$e=sm;function Z$e(e,t,r){if(!W$e(r))return!1;var n=typeof t;return(n=="number"?q$e(r)&&H$e(t,r.length):n=="string"&&t in r)?G$e(r[t],e):!1}var Ok=Z$e,X$e=Yse,K$e=g$e,Y$e=U$e,R9=Ok,J$e=Y$e(function(e,t){if(e==null)return[];var r=t.length;return r>1&&R9(e,t[0],t[1])?t=[]:r>2&&R9(t[0],t[1],t[2])&&(t=[t[0]]),K$e(e,X$e(t,1),[])}),Q$e=J$e;const s4=zi(Q$e);function HS(e){"@babel/helpers - typeof";return HS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},HS(e)}function Uz(){return Uz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uz.apply(this,arguments)}function eVe(e,t){return iVe(e)||nVe(e,t)||rVe(e,t)||tVe()}function tVe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rVe(e,t){if(e){if(typeof e=="string")return M9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return M9(e,t)}}function M9(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function nVe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function iVe(e){if(Array.isArray(e))return e}function D9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function zL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D9(Object(r),!0).forEach(function(n){oVe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oVe(e,t,r){return t=sVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sVe(e){var t=aVe(e,"string");return HS(t)=="symbol"?t:t+""}function aVe(e,t){if(HS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(HS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lVe(e){return Array.isArray(e)&&Us(e[0])&&Us(e[1])?e.join(" ~ "):e}var cVe=function(t){var r=t.separator,n=r===void 0?" : ":r,l=t.contentStyle,u=l===void 0?{}:l,f=t.itemStyle,o=f===void 0?{}:f,v=t.labelStyle,w=v===void 0?{}:v,P=t.payload,C=t.formatter,k=t.itemSorter,L=t.wrapperClassName,$=t.labelClassName,j=t.label,B=t.labelFormatter,U=t.accessibilityLayer,q=U===void 0?!1:U,H=function(){if(P&&P.length){var Ve={padding:0,margin:0},Ze=(k?s4(P,k):P).map(function(nt,dt){if(nt.type==="none")return null;var rt=zL({display:"block",paddingTop:4,paddingBottom:4,color:nt.color||"#000"},o),at=nt.formatter||C||lVe,qe=nt.value,He=nt.name,Et=qe,Gt=He;if(at&&Et!=null&&Gt!=null){var Ot=at(qe,He,nt,dt,P);if(Array.isArray(Ot)){var $t=eVe(Ot,2);Et=$t[0],Gt=$t[1]}else Et=Ot}return De.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(dt),style:rt},Us(Gt)?De.createElement("span",{className:"recharts-tooltip-item-name"},Gt):null,Us(Gt)?De.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,De.createElement("span",{className:"recharts-tooltip-item-value"},Et),De.createElement("span",{className:"recharts-tooltip-item-unit"},nt.unit||""))});return De.createElement("ul",{className:"recharts-tooltip-item-list",style:Ve},Ze)}return null},te=zL({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},u),Q=zL({margin:0},w),ae=!oi(j),ue=ae?j:"",me=Gn("recharts-default-tooltip",L),Ce=Gn("recharts-tooltip-label",$);ae&&B&&P!==void 0&&P!==null&&(ue=B(j,P));var Fe=q?{role:"status","aria-live":"assertive"}:{};return De.createElement("div",Uz({className:me,style:te},Fe),De.createElement("p",{className:Ce,style:Q},De.isValidElement(ue)?ue:"".concat(ue)),H())};function WS(e){"@babel/helpers - typeof";return WS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},WS(e)}function _P(e,t,r){return t=uVe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uVe(e){var t=dVe(e,"string");return WS(t)=="symbol"?t:t+""}function dVe(e,t){if(WS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(WS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var s1="recharts-tooltip-wrapper",hVe={visibility:"hidden"};function fVe(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return Gn(s1,_P(_P(_P(_P({},"".concat(s1,"-right"),fr(r)&&t&&fr(t.x)&&r>=t.x),"".concat(s1,"-left"),fr(r)&&t&&fr(t.x)&&r<t.x),"".concat(s1,"-bottom"),fr(n)&&t&&fr(t.y)&&n>=t.y),"".concat(s1,"-top"),fr(n)&&t&&fr(t.y)&&n<t.y))}function L9(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,l=e.offsetTopLeft,u=e.position,f=e.reverseDirection,o=e.tooltipDimension,v=e.viewBox,w=e.viewBoxDimension;if(u&&fr(u[n]))return u[n];var P=r[n]-o-l,C=r[n]+l;if(t[n])return f[n]?P:C;if(f[n]){var k=P,L=v[n];return k<L?Math.max(C,v[n]):Math.max(P,v[n])}var $=C+o,j=v[n]+w;return $>j?Math.max(P,v[n]):Math.max(C,v[n])}function pVe(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function mVe(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,l=e.position,u=e.reverseDirection,f=e.tooltipBox,o=e.useTranslate3d,v=e.viewBox,w,P,C;return f.height>0&&f.width>0&&r?(P=L9({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:l,reverseDirection:u,tooltipDimension:f.width,viewBox:v,viewBoxDimension:v.width}),C=L9({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:l,reverseDirection:u,tooltipDimension:f.height,viewBox:v,viewBoxDimension:v.height}),w=pVe({translateX:P,translateY:C,useTranslate3d:o})):w=hVe,{cssProperties:w,cssClasses:fVe({translateX:P,translateY:C,coordinate:r})}}function $0(e){"@babel/helpers - typeof";return $0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$0(e)}function j9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function N9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j9(Object(r),!0).forEach(function(n){qz(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yVe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rae(n.key),n)}}function _Ve(e,t,r){return t&&yVe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function vVe(e,t,r){return t=vI(t),xVe(e,tae()?Reflect.construct(t,r||[],vI(e).constructor):t.apply(e,r))}function xVe(e,t){if(t&&($0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bVe(e)}function bVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tae(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tae=function(){return!!e})()}function vI(e){return vI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},vI(e)}function wVe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gz(e,t)}function Gz(e,t){return Gz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},Gz(e,t)}function qz(e,t,r){return t=rae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rae(e){var t=SVe(e,"string");return $0(t)=="symbol"?t:t+""}function SVe(e,t){if($0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if($0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var z9=1,TVe=function(e){function t(){var r;gVe(this,t);for(var n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];return r=vVe(this,t,[].concat(l)),qz(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),qz(r,"handleKeyDown",function(f){if(f.key==="Escape"){var o,v,w,P;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(o=(v=r.props.coordinate)===null||v===void 0?void 0:v.x)!==null&&o!==void 0?o:0,y:(w=(P=r.props.coordinate)===null||P===void 0?void 0:P.y)!==null&&w!==void 0?w:0}})}}),r}return wVe(t,e),_Ve(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>z9||Math.abs(n.height-this.state.lastBoundingBox.height)>z9)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,l;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((l=this.props.coordinate)===null||l===void 0?void 0:l.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,l=this.props,u=l.active,f=l.allowEscapeViewBox,o=l.animationDuration,v=l.animationEasing,w=l.children,P=l.coordinate,C=l.hasPayload,k=l.isAnimationActive,L=l.offset,$=l.position,j=l.reverseDirection,B=l.useTranslate3d,U=l.viewBox,q=l.wrapperStyle,H=mVe({allowEscapeViewBox:f,coordinate:P,offsetTopLeft:L,position:$,reverseDirection:j,tooltipBox:this.state.lastBoundingBox,useTranslate3d:B,viewBox:U}),te=H.cssClasses,Q=H.cssProperties,ae=N9(N9({transition:k&&u?"transform ".concat(o,"ms ").concat(v):void 0},Q),{},{pointerEvents:"none",visibility:!this.state.dismissed&&u&&C?"visible":"hidden",position:"absolute",top:0,left:0},q);return De.createElement("div",{tabIndex:-1,className:te,style:ae,ref:function(me){n.wrapperNode=me}},w)}}])}(X.PureComponent),EVe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},$h={isSsr:EVe(),get:function(t){return $h[t]},set:function(t,r){if(typeof t=="string")$h[t]=r;else{var n=Object.keys(t);n&&n.length&&n.forEach(function(l){$h[l]=t[l]})}}};function V0(e){"@babel/helpers - typeof";return V0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V0(e)}function F9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function B9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F9(Object(r),!0).forEach(function(n){a4(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AVe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PVe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,iae(n.key),n)}}function CVe(e,t,r){return t&&PVe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function IVe(e,t,r){return t=xI(t),OVe(e,nae()?Reflect.construct(t,r||[],xI(e).constructor):t.apply(e,r))}function OVe(e,t){if(t&&(V0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kVe(e)}function kVe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nae(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nae=function(){return!!e})()}function xI(e){return xI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},xI(e)}function RVe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Hz(e,t)}function Hz(e,t){return Hz=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},Hz(e,t)}function a4(e,t,r){return t=iae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iae(e){var t=MVe(e,"string");return V0(t)=="symbol"?t:t+""}function MVe(e,t){if(V0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(V0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function DVe(e){return e.dataKey}function LVe(e,t){return De.isValidElement(e)?De.cloneElement(e,t):typeof e=="function"?De.createElement(e,t):De.createElement(cVe,t)}var Du=function(e){function t(){return AVe(this,t),IVe(this,t,arguments)}return RVe(t,e),CVe(t,[{key:"render",value:function(){var n=this,l=this.props,u=l.active,f=l.allowEscapeViewBox,o=l.animationDuration,v=l.animationEasing,w=l.content,P=l.coordinate,C=l.filterNull,k=l.isAnimationActive,L=l.offset,$=l.payload,j=l.payloadUniqBy,B=l.position,U=l.reverseDirection,q=l.useTranslate3d,H=l.viewBox,te=l.wrapperStyle,Q=$??[];C&&Q.length&&(Q=Wse($.filter(function(ue){return ue.value!=null&&(ue.hide!==!0||n.props.includeHidden)}),j,DVe));var ae=Q.length>0;return De.createElement(TVe,{allowEscapeViewBox:f,animationDuration:o,animationEasing:v,isAnimationActive:k,active:u,coordinate:P,hasPayload:ae,offset:L,position:B,reverseDirection:U,useTranslate3d:q,viewBox:H,wrapperStyle:te},LVe(w,B9(B9({},this.props),{},{payload:Q})))}}])}(X.PureComponent);a4(Du,"displayName","Tooltip");a4(Du,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!$h.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var jVe=Xd,NVe=function(){return jVe.Date.now()},zVe=NVe,FVe=/\s/;function BVe(e){for(var t=e.length;t--&&FVe.test(e.charAt(t)););return t}var $Ve=BVe,VVe=$Ve,UVe=/^\s+/;function GVe(e){return e&&e.slice(0,VVe(e)+1).replace(UVe,"")}var qVe=GVe,HVe=qVe,$9=sm,WVe=Sx,V9=NaN,ZVe=/^[-+]0x[0-9a-f]+$/i,XVe=/^0b[01]+$/i,KVe=/^0o[0-7]+$/i,YVe=parseInt;function JVe(e){if(typeof e=="number")return e;if(WVe(e))return V9;if($9(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=$9(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=HVe(e);var r=XVe.test(e);return r||KVe.test(e)?YVe(e.slice(2),r?2:8):ZVe.test(e)?V9:+e}var oae=JVe,QVe=sm,FL=zVe,U9=oae,eUe="Expected a function",tUe=Math.max,rUe=Math.min;function nUe(e,t,r){var n,l,u,f,o,v,w=0,P=!1,C=!1,k=!0;if(typeof e!="function")throw new TypeError(eUe);t=U9(t)||0,QVe(r)&&(P=!!r.leading,C="maxWait"in r,u=C?tUe(U9(r.maxWait)||0,t):u,k="trailing"in r?!!r.trailing:k);function L(ae){var ue=n,me=l;return n=l=void 0,w=ae,f=e.apply(me,ue),f}function $(ae){return w=ae,o=setTimeout(U,t),P?L(ae):f}function j(ae){var ue=ae-v,me=ae-w,Ce=t-ue;return C?rUe(Ce,u-me):Ce}function B(ae){var ue=ae-v,me=ae-w;return v===void 0||ue>=t||ue<0||C&&me>=u}function U(){var ae=FL();if(B(ae))return q(ae);o=setTimeout(U,j(ae))}function q(ae){return o=void 0,k&&n?L(ae):(n=l=void 0,f)}function H(){o!==void 0&&clearTimeout(o),w=0,n=v=l=o=void 0}function te(){return o===void 0?f:q(FL())}function Q(){var ae=FL(),ue=B(ae);if(n=arguments,l=this,v=ae,ue){if(o===void 0)return $(v);if(C)return clearTimeout(o),o=setTimeout(U,t),L(v)}return o===void 0&&(o=setTimeout(U,t)),f}return Q.cancel=H,Q.flush=te,Q}var iUe=nUe,oUe=iUe,sUe=sm,aUe="Expected a function";function lUe(e,t,r){var n=!0,l=!0;if(typeof e!="function")throw new TypeError(aUe);return sUe(r)&&(n="leading"in r?!!r.leading:n,l="trailing"in r?!!r.trailing:l),oUe(e,t,{leading:n,maxWait:t,trailing:l})}var cUe=lUe;const sae=zi(cUe);function ZS(e){"@babel/helpers - typeof";return ZS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ZS(e)}function G9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function vP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G9(Object(r),!0).forEach(function(n){uUe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uUe(e,t,r){return t=dUe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dUe(e){var t=hUe(e,"string");return ZS(t)=="symbol"?t:t+""}function hUe(e,t){if(ZS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ZS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fUe(e,t){return yUe(e)||gUe(e,t)||mUe(e,t)||pUe()}function pUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mUe(e,t){if(e){if(typeof e=="string")return q9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q9(e,t)}}function q9(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function yUe(e){if(Array.isArray(e))return e}var H9=X.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,l=n===void 0?{width:-1,height:-1}:n,u=e.width,f=u===void 0?"100%":u,o=e.height,v=o===void 0?"100%":o,w=e.minWidth,P=w===void 0?0:w,C=e.minHeight,k=e.maxHeight,L=e.children,$=e.debounce,j=$===void 0?0:$,B=e.id,U=e.className,q=e.onResize,H=e.style,te=H===void 0?{}:H,Q=X.useRef(null),ae=X.useRef();ae.current=q,X.useImperativeHandle(t,function(){return Object.defineProperty(Q.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),Q.current},configurable:!0})});var ue=X.useState({containerWidth:l.width,containerHeight:l.height}),me=fUe(ue,2),Ce=me[0],Fe=me[1],Ge=X.useCallback(function(Ze,nt){Fe(function(dt){var rt=Math.round(Ze),at=Math.round(nt);return dt.containerWidth===rt&&dt.containerHeight===at?dt:{containerWidth:rt,containerHeight:at}})},[]);X.useEffect(function(){var Ze=function(He){var Et,Gt=He[0].contentRect,Ot=Gt.width,$t=Gt.height;Ge(Ot,$t),(Et=ae.current)===null||Et===void 0||Et.call(ae,Ot,$t)};j>0&&(Ze=sae(Ze,j,{trailing:!0,leading:!1}));var nt=new ResizeObserver(Ze),dt=Q.current.getBoundingClientRect(),rt=dt.width,at=dt.height;return Ge(rt,at),nt.observe(Q.current),function(){nt.disconnect()}},[Ge,j]);var Ve=X.useMemo(function(){var Ze=Ce.containerWidth,nt=Ce.containerHeight;if(Ze<0||nt<0)return null;Gu(Rg(f)||Rg(v),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,f,v),Gu(!r||r>0,"The aspect(%s) must be greater than zero.",r);var dt=Rg(f)?Ze:f,rt=Rg(v)?nt:v;r&&r>0&&(dt?rt=dt/r:rt&&(dt=rt*r),k&&rt>k&&(rt=k)),Gu(dt>0||rt>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,dt,rt,f,v,P,C,r);var at=!Array.isArray(L)&&Bh(L.type).endsWith("Chart");return De.Children.map(L,function(qe){return De.isValidElement(qe)?X.cloneElement(qe,vP({width:dt,height:rt},at?{style:vP({height:"100%",width:"100%",maxHeight:rt,maxWidth:dt},qe.props.style)}:{})):qe})},[r,L,v,k,C,P,Ce,f]);return De.createElement("div",{id:B?"".concat(B):void 0,className:Gn("recharts-responsive-container",U),style:vP(vP({},te),{},{width:f,height:v,minWidth:P,minHeight:C,maxHeight:k}),ref:Q},Ve)}),kk=function(t){return null};kk.displayName="Cell";function XS(e){"@babel/helpers - typeof";return XS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},XS(e)}function W9(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Wz(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W9(Object(r),!0).forEach(function(n){_Ue(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W9(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _Ue(e,t,r){return t=vUe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vUe(e){var t=xUe(e,"string");return XS(t)=="symbol"?t:t+""}function xUe(e,t){if(XS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(XS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var dv={widthCache:{},cacheCount:0},bUe=2e3,wUe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},Z9="recharts_measurement_span";function SUe(e){var t=Wz({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var K1=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||$h.isSsr)return{width:0,height:0};var n=SUe(r),l=JSON.stringify({text:t,copyStyle:n});if(dv.widthCache[l])return dv.widthCache[l];try{var u=document.getElementById(Z9);u||(u=document.createElement("span"),u.setAttribute("id",Z9),u.setAttribute("aria-hidden","true"),document.body.appendChild(u));var f=Wz(Wz({},wUe),n);Object.assign(u.style,f),u.textContent="".concat(t);var o=u.getBoundingClientRect(),v={width:o.width,height:o.height};return dv.widthCache[l]=v,++dv.cacheCount>bUe&&(dv.cacheCount=0,dv.widthCache={}),v}catch{return{width:0,height:0}}},TUe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function KS(e){"@babel/helpers - typeof";return KS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},KS(e)}function bI(e,t){return CUe(e)||PUe(e,t)||AUe(e,t)||EUe()}function EUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AUe(e,t){if(e){if(typeof e=="string")return X9(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return X9(e,t)}}function X9(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function PUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function CUe(e){if(Array.isArray(e))return e}function IUe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function K9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,kUe(n.key),n)}}function OUe(e,t,r){return t&&K9(e.prototype,t),r&&K9(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kUe(e){var t=RUe(e,"string");return KS(t)=="symbol"?t:t+""}function RUe(e,t){if(KS(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(KS(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Y9=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,J9=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,MUe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,DUe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,aae={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},LUe=Object.keys(aae),jv="NaN";function jUe(e,t){return e*aae[t]}var xP=function(){function e(t,r){IUe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!MUe.test(r)&&(this.num=NaN,this.unit=""),LUe.includes(r)&&(this.num=jUe(t,r),this.unit="px")}return OUe(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,l=(n=DUe.exec(r))!==null&&n!==void 0?n:[],u=bI(l,3),f=u[1],o=u[2];return new e(parseFloat(f),o??"")}}])}();function lae(e){if(e.includes(jv))return jv;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=Y9.exec(t))!==null&&r!==void 0?r:[],l=bI(n,4),u=l[1],f=l[2],o=l[3],v=xP.parse(u??""),w=xP.parse(o??""),P=f==="*"?v.multiply(w):v.divide(w);if(P.isNaN())return jv;t=t.replace(Y9,P.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var C,k=(C=J9.exec(t))!==null&&C!==void 0?C:[],L=bI(k,4),$=L[1],j=L[2],B=L[3],U=xP.parse($??""),q=xP.parse(B??""),H=j==="+"?U.add(q):U.subtract(q);if(H.isNaN())return jv;t=t.replace(J9,H.toString())}return t}var Q9=/\(([^()]*)\)/;function NUe(e){for(var t=e;t.includes("(");){var r=Q9.exec(t),n=bI(r,2),l=n[1];t=t.replace(Q9,lae(l))}return t}function zUe(e){var t=e.replace(/\s+/g,"");return t=NUe(t),t=lae(t),t}function FUe(e){try{return zUe(e)}catch{return jv}}function BL(e){var t=FUe(e.slice(5,-1));return t===jv?"":t}var BUe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],$Ue=["dx","dy","angle","className","breakAll"];function Zz(){return Zz=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Zz.apply(this,arguments)}function e7(e,t){if(e==null)return{};var r=VUe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VUe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function t7(e,t){return HUe(e)||qUe(e,t)||GUe(e,t)||UUe()}function UUe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GUe(e,t){if(e){if(typeof e=="string")return r7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return r7(e,t)}}function r7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qUe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;v=!1}else for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function HUe(e){if(Array.isArray(e))return e}var cae=/[ \f\n\r\t\v\u2028\u2029]+/,uae=function(t){var r=t.children,n=t.breakAll,l=t.style;try{var u=[];oi(r)||(n?u=r.toString().split(""):u=r.toString().split(cae));var f=u.map(function(v){return{word:v,width:K1(v,l).width}}),o=n?0:K1("",l).width;return{wordsWithComputedWidth:f,spaceWidth:o}}catch{return null}},WUe=function(t,r,n,l,u){var f=t.maxLines,o=t.children,v=t.style,w=t.breakAll,P=fr(f),C=o,k=function(){var dt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return dt.reduce(function(rt,at){var qe=at.word,He=at.width,Et=rt[rt.length-1];if(Et&&(l==null||u||Et.width+He+n<Number(l)))Et.words.push(qe),Et.width+=He+n;else{var Gt={words:[qe],width:He};rt.push(Gt)}return rt},[])},L=k(r),$=function(dt){return dt.reduce(function(rt,at){return rt.width>at.width?rt:at})};if(!P)return L;for(var j="",B=function(dt){var rt=C.slice(0,dt),at=uae({breakAll:w,style:v,children:rt+j}).wordsWithComputedWidth,qe=k(at),He=qe.length>f||$(qe).width>Number(l);return[He,qe]},U=0,q=C.length-1,H=0,te;U<=q&&H<=C.length-1;){var Q=Math.floor((U+q)/2),ae=Q-1,ue=B(ae),me=t7(ue,2),Ce=me[0],Fe=me[1],Ge=B(Q),Ve=t7(Ge,1),Ze=Ve[0];if(!Ce&&!Ze&&(U=Q+1),Ce&&Ze&&(q=Q-1),!Ce&&Ze){te=Fe;break}H++}return te||L},n7=function(t){var r=oi(t)?[]:t.toString().split(cae);return[{words:r}]},ZUe=function(t){var r=t.width,n=t.scaleToFit,l=t.children,u=t.style,f=t.breakAll,o=t.maxLines;if((r||n)&&!$h.isSsr){var v,w,P=uae({breakAll:f,children:l,style:u});if(P){var C=P.wordsWithComputedWidth,k=P.spaceWidth;v=C,w=k}else return n7(l);return WUe({breakAll:f,children:l,maxLines:o,style:u},v,w,r,n)}return n7(l)},i7="#808080",py=function(t){var r=t.x,n=r===void 0?0:r,l=t.y,u=l===void 0?0:l,f=t.lineHeight,o=f===void 0?"1em":f,v=t.capHeight,w=v===void 0?"0.71em":v,P=t.scaleToFit,C=P===void 0?!1:P,k=t.textAnchor,L=k===void 0?"start":k,$=t.verticalAnchor,j=$===void 0?"end":$,B=t.fill,U=B===void 0?i7:B,q=e7(t,BUe),H=X.useMemo(function(){return ZUe({breakAll:q.breakAll,children:q.children,maxLines:q.maxLines,scaleToFit:C,style:q.style,width:q.width})},[q.breakAll,q.children,q.maxLines,C,q.style,q.width]),te=q.dx,Q=q.dy,ae=q.angle,ue=q.className,me=q.breakAll,Ce=e7(q,$Ue);if(!Us(n)||!Us(u))return null;var Fe=n+(fr(te)?te:0),Ge=u+(fr(Q)?Q:0),Ve;switch(j){case"start":Ve=BL("calc(".concat(w,")"));break;case"middle":Ve=BL("calc(".concat((H.length-1)/2," * -").concat(o," + (").concat(w," / 2))"));break;default:Ve=BL("calc(".concat(H.length-1," * -").concat(o,")"));break}var Ze=[];if(C){var nt=H[0].width,dt=q.width;Ze.push("scale(".concat((fr(dt)?dt/nt:1)/nt,")"))}return ae&&Ze.push("rotate(".concat(ae,", ").concat(Fe,", ").concat(Ge,")")),Ze.length&&(Ce.transform=Ze.join(" ")),De.createElement("text",Zz({},Pn(Ce,!0),{x:Fe,y:Ge,className:Gn("recharts-text",ue),textAnchor:L,fill:U.includes("url")?i7:U}),H.map(function(rt,at){var qe=rt.words.join(me?"":" ");return De.createElement("tspan",{x:Fe,dy:at===0?Ve:o,key:"".concat(qe,"-").concat(at)},qe)}))};function $p(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function XUe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function l4(e){let t,r,n;e.length!==2?(t=$p,r=(o,v)=>$p(e(o),v),n=(o,v)=>e(o)-v):(t=e===$p||e===XUe?e:KUe,r=e,n=e);function l(o,v,w=0,P=o.length){if(w<P){if(t(v,v)!==0)return P;do{const C=w+P>>>1;r(o[C],v)<0?w=C+1:P=C}while(w<P)}return w}function u(o,v,w=0,P=o.length){if(w<P){if(t(v,v)!==0)return P;do{const C=w+P>>>1;r(o[C],v)<=0?w=C+1:P=C}while(w<P)}return w}function f(o,v,w=0,P=o.length){const C=l(o,v,w,P-1);return C>w&&n(o[C-1],v)>-n(o[C],v)?C-1:C}return{left:l,center:f,right:u}}function KUe(){return 0}function dae(e){return e===null?NaN:+e}function*YUe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const JUe=l4($p),aE=JUe.right;l4(dae).center;class o7 extends Map{constructor(t,r=t6e){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,l]of t)this.set(n,l)}get(t){return super.get(s7(this,t))}has(t){return super.has(s7(this,t))}set(t,r){return super.set(QUe(this,t),r)}delete(t){return super.delete(e6e(this,t))}}function s7({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function QUe({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function e6e({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function t6e(e){return e!==null&&typeof e=="object"?e.valueOf():e}function r6e(e=$p){if(e===$p)return hae;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function hae(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const n6e=Math.sqrt(50),i6e=Math.sqrt(10),o6e=Math.sqrt(2);function wI(e,t,r){const n=(t-e)/Math.max(0,r),l=Math.floor(Math.log10(n)),u=n/Math.pow(10,l),f=u>=n6e?10:u>=i6e?5:u>=o6e?2:1;let o,v,w;return l<0?(w=Math.pow(10,-l)/f,o=Math.round(e*w),v=Math.round(t*w),o/w<e&&++o,v/w>t&&--v,w=-w):(w=Math.pow(10,l)*f,o=Math.round(e/w),v=Math.round(t/w),o*w<e&&++o,v*w>t&&--v),v<o&&.5<=r&&r<2?wI(e,t,r*2):[o,v,w]}function Xz(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[l,u,f]=n?wI(t,e,r):wI(e,t,r);if(!(u>=l))return[];const o=u-l+1,v=new Array(o);if(n)if(f<0)for(let w=0;w<o;++w)v[w]=(u-w)/-f;else for(let w=0;w<o;++w)v[w]=(u-w)*f;else if(f<0)for(let w=0;w<o;++w)v[w]=(l+w)/-f;else for(let w=0;w<o;++w)v[w]=(l+w)*f;return v}function Kz(e,t,r){return t=+t,e=+e,r=+r,wI(e,t,r)[2]}function Yz(e,t,r){t=+t,e=+e,r=+r;const n=t<e,l=n?Kz(t,e,r):Kz(e,t,r);return(n?-1:1)*(l<0?1/-l:l)}function a7(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function l7(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function fae(e,t,r=0,n=1/0,l){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(l=l===void 0?hae:r6e(l);n>r;){if(n-r>600){const v=n-r+1,w=t-r+1,P=Math.log(v),C=.5*Math.exp(2*P/3),k=.5*Math.sqrt(P*C*(v-C)/v)*(w-v/2<0?-1:1),L=Math.max(r,Math.floor(t-w*C/v+k)),$=Math.min(n,Math.floor(t+(v-w)*C/v+k));fae(e,t,L,$,l)}const u=e[t];let f=r,o=n;for(a1(e,r,t),l(e[n],u)>0&&a1(e,r,n);f<o;){for(a1(e,f,o),++f,--o;l(e[f],u)<0;)++f;for(;l(e[o],u)>0;)--o}l(e[r],u)===0?a1(e,r,o):(++o,a1(e,o,n)),o<=t&&(r=o+1),t<=o&&(n=o-1)}return e}function a1(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function s6e(e,t,r){if(e=Float64Array.from(YUe(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return l7(e);if(t>=1)return a7(e);var n,l=(n-1)*t,u=Math.floor(l),f=a7(fae(e,u).subarray(0,u+1)),o=l7(e.subarray(u+1));return f+(o-f)*(l-u)}}function a6e(e,t,r=dae){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,l=(n-1)*t,u=Math.floor(l),f=+r(e[u],u,e),o=+r(e[u+1],u+1,e);return f+(o-f)*(l-u)}}function l6e(e,t,r){e=+e,t=+t,r=(l=arguments.length)<2?(t=e,e=0,1):l<3?1:+r;for(var n=-1,l=Math.max(0,Math.ceil((t-e)/r))|0,u=new Array(l);++n<l;)u[n]=e+n*r;return u}function iu(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function uf(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const Jz=Symbol("implicit");function c4(){var e=new o7,t=[],r=[],n=Jz;function l(u){let f=e.get(u);if(f===void 0){if(n!==Jz)return n;e.set(u,f=t.push(u)-1)}return r[f%r.length]}return l.domain=function(u){if(!arguments.length)return t.slice();t=[],e=new o7;for(const f of u)e.has(f)||e.set(f,t.push(f)-1);return l},l.range=function(u){return arguments.length?(r=Array.from(u),l):r.slice()},l.unknown=function(u){return arguments.length?(n=u,l):n},l.copy=function(){return c4(t,r).unknown(n)},iu.apply(l,arguments),l}function YS(){var e=c4().unknown(void 0),t=e.domain,r=e.range,n=0,l=1,u,f,o=!1,v=0,w=0,P=.5;delete e.unknown;function C(){var k=t().length,L=l<n,$=L?l:n,j=L?n:l;u=(j-$)/Math.max(1,k-v+w*2),o&&(u=Math.floor(u)),$+=(j-$-u*(k-v))*P,f=u*(1-v),o&&($=Math.round($),f=Math.round(f));var B=l6e(k).map(function(U){return $+u*U});return r(L?B.reverse():B)}return e.domain=function(k){return arguments.length?(t(k),C()):t()},e.range=function(k){return arguments.length?([n,l]=k,n=+n,l=+l,C()):[n,l]},e.rangeRound=function(k){return[n,l]=k,n=+n,l=+l,o=!0,C()},e.bandwidth=function(){return f},e.step=function(){return u},e.round=function(k){return arguments.length?(o=!!k,C()):o},e.padding=function(k){return arguments.length?(v=Math.min(1,w=+k),C()):v},e.paddingInner=function(k){return arguments.length?(v=Math.min(1,k),C()):v},e.paddingOuter=function(k){return arguments.length?(w=+k,C()):w},e.align=function(k){return arguments.length?(P=Math.max(0,Math.min(1,k)),C()):P},e.copy=function(){return YS(t(),[n,l]).round(o).paddingInner(v).paddingOuter(w).align(P)},iu.apply(C(),arguments)}function pae(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return pae(t())},e}function Y1(){return pae(YS.apply(null,arguments).paddingInner(1))}function u4(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function mae(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function lE(){}var JS=.7,SI=1/JS,n0="\\s*([+-]?\\d+)\\s*",QS="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",$d="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",c6e=/^#([0-9a-f]{3,8})$/,u6e=new RegExp(`^rgb\\(${n0},${n0},${n0}\\)$`),d6e=new RegExp(`^rgb\\(${$d},${$d},${$d}\\)$`),h6e=new RegExp(`^rgba\\(${n0},${n0},${n0},${QS}\\)$`),f6e=new RegExp(`^rgba\\(${$d},${$d},${$d},${QS}\\)$`),p6e=new RegExp(`^hsl\\(${QS},${$d},${$d}\\)$`),m6e=new RegExp(`^hsla\\(${QS},${$d},${$d},${QS}\\)$`),c7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};u4(lE,eT,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:u7,formatHex:u7,formatHex8:g6e,formatHsl:y6e,formatRgb:d7,toString:d7});function u7(){return this.rgb().formatHex()}function g6e(){return this.rgb().formatHex8()}function y6e(){return gae(this).formatHsl()}function d7(){return this.rgb().formatRgb()}function eT(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=c6e.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?h7(t):r===3?new Nl(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?bP(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?bP(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=u6e.exec(e))?new Nl(t[1],t[2],t[3],1):(t=d6e.exec(e))?new Nl(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=h6e.exec(e))?bP(t[1],t[2],t[3],t[4]):(t=f6e.exec(e))?bP(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=p6e.exec(e))?m7(t[1],t[2]/100,t[3]/100,1):(t=m6e.exec(e))?m7(t[1],t[2]/100,t[3]/100,t[4]):c7.hasOwnProperty(e)?h7(c7[e]):e==="transparent"?new Nl(NaN,NaN,NaN,0):null}function h7(e){return new Nl(e>>16&255,e>>8&255,e&255,1)}function bP(e,t,r,n){return n<=0&&(e=t=r=NaN),new Nl(e,t,r,n)}function _6e(e){return e instanceof lE||(e=eT(e)),e?(e=e.rgb(),new Nl(e.r,e.g,e.b,e.opacity)):new Nl}function Qz(e,t,r,n){return arguments.length===1?_6e(e):new Nl(e,t,r,n??1)}function Nl(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}u4(Nl,Qz,mae(lE,{brighter(e){return e=e==null?SI:Math.pow(SI,e),new Nl(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?JS:Math.pow(JS,e),new Nl(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Nl(Xg(this.r),Xg(this.g),Xg(this.b),TI(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:f7,formatHex:f7,formatHex8:v6e,formatRgb:p7,toString:p7}));function f7(){return`#${Mg(this.r)}${Mg(this.g)}${Mg(this.b)}`}function v6e(){return`#${Mg(this.r)}${Mg(this.g)}${Mg(this.b)}${Mg((isNaN(this.opacity)?1:this.opacity)*255)}`}function p7(){const e=TI(this.opacity);return`${e===1?"rgb(":"rgba("}${Xg(this.r)}, ${Xg(this.g)}, ${Xg(this.b)}${e===1?")":`, ${e})`}`}function TI(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Xg(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Mg(e){return e=Xg(e),(e<16?"0":"")+e.toString(16)}function m7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Fu(e,t,r,n)}function gae(e){if(e instanceof Fu)return new Fu(e.h,e.s,e.l,e.opacity);if(e instanceof lE||(e=eT(e)),!e)return new Fu;if(e instanceof Fu)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,l=Math.min(t,r,n),u=Math.max(t,r,n),f=NaN,o=u-l,v=(u+l)/2;return o?(t===u?f=(r-n)/o+(r<n)*6:r===u?f=(n-t)/o+2:f=(t-r)/o+4,o/=v<.5?u+l:2-u-l,f*=60):o=v>0&&v<1?0:f,new Fu(f,o,v,e.opacity)}function x6e(e,t,r,n){return arguments.length===1?gae(e):new Fu(e,t,r,n??1)}function Fu(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}u4(Fu,x6e,mae(lE,{brighter(e){return e=e==null?SI:Math.pow(SI,e),new Fu(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?JS:Math.pow(JS,e),new Fu(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,l=2*r-n;return new Nl($L(e>=240?e-240:e+120,l,n),$L(e,l,n),$L(e<120?e+240:e-120,l,n),this.opacity)},clamp(){return new Fu(g7(this.h),wP(this.s),wP(this.l),TI(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=TI(this.opacity);return`${e===1?"hsl(":"hsla("}${g7(this.h)}, ${wP(this.s)*100}%, ${wP(this.l)*100}%${e===1?")":`, ${e})`}`}}));function g7(e){return e=(e||0)%360,e<0?e+360:e}function wP(e){return Math.max(0,Math.min(1,e||0))}function $L(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const d4=e=>()=>e;function b6e(e,t){return function(r){return e+r*t}}function w6e(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function S6e(e){return(e=+e)==1?yae:function(t,r){return r-t?w6e(t,r,e):d4(isNaN(t)?r:t)}}function yae(e,t){var r=t-e;return r?b6e(e,r):d4(isNaN(e)?t:e)}const y7=function e(t){var r=S6e(t);function n(l,u){var f=r((l=Qz(l)).r,(u=Qz(u)).r),o=r(l.g,u.g),v=r(l.b,u.b),w=yae(l.opacity,u.opacity);return function(P){return l.r=f(P),l.g=o(P),l.b=v(P),l.opacity=w(P),l+""}}return n.gamma=e,n}(1);function T6e(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),l;return function(u){for(l=0;l<r;++l)n[l]=e[l]*(1-u)+t[l]*u;return n}}function E6e(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function A6e(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,l=new Array(n),u=new Array(r),f;for(f=0;f<n;++f)l[f]=kx(e[f],t[f]);for(;f<r;++f)u[f]=t[f];return function(o){for(f=0;f<n;++f)u[f]=l[f](o);return u}}function P6e(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function EI(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function C6e(e,t){var r={},n={},l;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(l in t)l in e?r[l]=kx(e[l],t[l]):n[l]=t[l];return function(u){for(l in r)n[l]=r[l](u);return n}}var eF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,VL=new RegExp(eF.source,"g");function I6e(e){return function(){return e}}function O6e(e){return function(t){return e(t)+""}}function k6e(e,t){var r=eF.lastIndex=VL.lastIndex=0,n,l,u,f=-1,o=[],v=[];for(e=e+"",t=t+"";(n=eF.exec(e))&&(l=VL.exec(t));)(u=l.index)>r&&(u=t.slice(r,u),o[f]?o[f]+=u:o[++f]=u),(n=n[0])===(l=l[0])?o[f]?o[f]+=l:o[++f]=l:(o[++f]=null,v.push({i:f,x:EI(n,l)})),r=VL.lastIndex;return r<t.length&&(u=t.slice(r),o[f]?o[f]+=u:o[++f]=u),o.length<2?v[0]?O6e(v[0].x):I6e(t):(t=v.length,function(w){for(var P=0,C;P<t;++P)o[(C=v[P]).i]=C.x(w);return o.join("")})}function kx(e,t){var r=typeof t,n;return t==null||r==="boolean"?d4(t):(r==="number"?EI:r==="string"?(n=eT(t))?(t=n,y7):k6e:t instanceof eT?y7:t instanceof Date?P6e:E6e(t)?T6e:Array.isArray(t)?A6e:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?C6e:EI)(e,t)}function h4(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function R6e(e,t){t===void 0&&(t=e,e=kx);for(var r=0,n=t.length-1,l=t[0],u=new Array(n<0?0:n);r<n;)u[r]=e(l,l=t[++r]);return function(f){var o=Math.max(0,Math.min(n-1,Math.floor(f*=n)));return u[o](f-o)}}function M6e(e){return function(){return e}}function AI(e){return+e}var _7=[0,1];function _l(e){return e}function tF(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:M6e(isNaN(t)?NaN:.5)}function D6e(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function L6e(e,t,r){var n=e[0],l=e[1],u=t[0],f=t[1];return l<n?(n=tF(l,n),u=r(f,u)):(n=tF(n,l),u=r(u,f)),function(o){return u(n(o))}}function j6e(e,t,r){var n=Math.min(e.length,t.length)-1,l=new Array(n),u=new Array(n),f=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++f<n;)l[f]=tF(e[f],e[f+1]),u[f]=r(t[f],t[f+1]);return function(o){var v=aE(e,o,1,n)-1;return u[v](l[v](o))}}function cE(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Rk(){var e=_7,t=_7,r=kx,n,l,u,f=_l,o,v,w;function P(){var k=Math.min(e.length,t.length);return f!==_l&&(f=D6e(e[0],e[k-1])),o=k>2?j6e:L6e,v=w=null,C}function C(k){return k==null||isNaN(k=+k)?u:(v||(v=o(e.map(n),t,r)))(n(f(k)))}return C.invert=function(k){return f(l((w||(w=o(t,e.map(n),EI)))(k)))},C.domain=function(k){return arguments.length?(e=Array.from(k,AI),P()):e.slice()},C.range=function(k){return arguments.length?(t=Array.from(k),P()):t.slice()},C.rangeRound=function(k){return t=Array.from(k),r=h4,P()},C.clamp=function(k){return arguments.length?(f=k?!0:_l,P()):f!==_l},C.interpolate=function(k){return arguments.length?(r=k,P()):r},C.unknown=function(k){return arguments.length?(u=k,C):u},function(k,L){return n=k,l=L,P()}}function f4(){return Rk()(_l,_l)}function N6e(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function PI(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function U0(e){return e=PI(Math.abs(e)),e?e[1]:NaN}function z6e(e,t){return function(r,n){for(var l=r.length,u=[],f=0,o=e[0],v=0;l>0&&o>0&&(v+o+1>n&&(o=Math.max(1,n-v)),u.push(r.substring(l-=o,l+o)),!((v+=o+1)>n));)o=e[f=(f+1)%e.length];return u.reverse().join(t)}}function F6e(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var B6e=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tT(e){if(!(t=B6e.exec(e)))throw new Error("invalid format: "+e);var t;return new p4({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}tT.prototype=p4.prototype;function p4(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}p4.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function $6e(e){e:for(var t=e.length,r=1,n=-1,l;r<t;++r)switch(e[r]){case".":n=l=r;break;case"0":n===0&&(n=r),l=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(l+1):e}var _ae;function V6e(e,t){var r=PI(e,t);if(!r)return e+"";var n=r[0],l=r[1],u=l-(_ae=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,f=n.length;return u===f?n:u>f?n+new Array(u-f+1).join("0"):u>0?n.slice(0,u)+"."+n.slice(u):"0."+new Array(1-u).join("0")+PI(e,Math.max(0,t+u-1))[0]}function v7(e,t){var r=PI(e,t);if(!r)return e+"";var n=r[0],l=r[1];return l<0?"0."+new Array(-l).join("0")+n:n.length>l+1?n.slice(0,l+1)+"."+n.slice(l+1):n+new Array(l-n.length+2).join("0")}const x7={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:N6e,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>v7(e*100,t),r:v7,s:V6e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function b7(e){return e}var w7=Array.prototype.map,S7=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function U6e(e){var t=e.grouping===void 0||e.thousands===void 0?b7:z6e(w7.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",l=e.decimal===void 0?".":e.decimal+"",u=e.numerals===void 0?b7:F6e(w7.call(e.numerals,String)),f=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"":e.minus+"",v=e.nan===void 0?"NaN":e.nan+"";function w(C){C=tT(C);var k=C.fill,L=C.align,$=C.sign,j=C.symbol,B=C.zero,U=C.width,q=C.comma,H=C.precision,te=C.trim,Q=C.type;Q==="n"?(q=!0,Q="g"):x7[Q]||(H===void 0&&(H=12),te=!0,Q="g"),(B||k==="0"&&L==="=")&&(B=!0,k="0",L="=");var ae=j==="$"?r:j==="#"&&/[boxX]/.test(Q)?"0"+Q.toLowerCase():"",ue=j==="$"?n:/[%p]/.test(Q)?f:"",me=x7[Q],Ce=/[defgprs%]/.test(Q);H=H===void 0?6:/[gprs]/.test(Q)?Math.max(1,Math.min(21,H)):Math.max(0,Math.min(20,H));function Fe(Ge){var Ve=ae,Ze=ue,nt,dt,rt;if(Q==="c")Ze=me(Ge)+Ze,Ge="";else{Ge=+Ge;var at=Ge<0||1/Ge<0;if(Ge=isNaN(Ge)?v:me(Math.abs(Ge),H),te&&(Ge=$6e(Ge)),at&&+Ge==0&&$!=="+"&&(at=!1),Ve=(at?$==="("?$:o:$==="-"||$==="("?"":$)+Ve,Ze=(Q==="s"?S7[8+_ae/3]:"")+Ze+(at&&$==="("?")":""),Ce){for(nt=-1,dt=Ge.length;++nt<dt;)if(rt=Ge.charCodeAt(nt),48>rt||rt>57){Ze=(rt===46?l+Ge.slice(nt+1):Ge.slice(nt))+Ze,Ge=Ge.slice(0,nt);break}}}q&&!B&&(Ge=t(Ge,1/0));var qe=Ve.length+Ge.length+Ze.length,He=qe<U?new Array(U-qe+1).join(k):"";switch(q&&B&&(Ge=t(He+Ge,He.length?U-Ze.length:1/0),He=""),L){case"<":Ge=Ve+Ge+Ze+He;break;case"=":Ge=Ve+He+Ge+Ze;break;case"^":Ge=He.slice(0,qe=He.length>>1)+Ve+Ge+Ze+He.slice(qe);break;default:Ge=He+Ve+Ge+Ze;break}return u(Ge)}return Fe.toString=function(){return C+""},Fe}function P(C,k){var L=w((C=tT(C),C.type="f",C)),$=Math.max(-8,Math.min(8,Math.floor(U0(k)/3)))*3,j=Math.pow(10,-$),B=S7[8+$/3];return function(U){return L(j*U)+B}}return{format:w,formatPrefix:P}}var SP,m4,vae;G6e({thousands:",",grouping:[3],currency:["$",""]});function G6e(e){return SP=U6e(e),m4=SP.format,vae=SP.formatPrefix,SP}function q6e(e){return Math.max(0,-U0(Math.abs(e)))}function H6e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(U0(t)/3)))*3-U0(Math.abs(e)))}function W6e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,U0(t)-U0(e))+1}function xae(e,t,r,n){var l=Yz(e,t,r),u;switch(n=tT(n??",f"),n.type){case"s":{var f=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(u=H6e(l,f))&&(n.precision=u),vae(n,f)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(u=W6e(l,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=u-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(u=q6e(l))&&(n.precision=u-(n.type==="%")*2);break}}return m4(n)}function am(e){var t=e.domain;return e.ticks=function(r){var n=t();return Xz(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var l=t();return xae(l[0],l[l.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),l=0,u=n.length-1,f=n[l],o=n[u],v,w,P=10;for(o<f&&(w=f,f=o,o=w,w=l,l=u,u=w);P-- >0;){if(w=Kz(f,o,r),w===v)return n[l]=f,n[u]=o,t(n);if(w>0)f=Math.floor(f/w)*w,o=Math.ceil(o/w)*w;else if(w<0)f=Math.ceil(f*w)/w,o=Math.floor(o*w)/w;else break;v=w}return e},e}function CI(){var e=f4();return e.copy=function(){return cE(e,CI())},iu.apply(e,arguments),am(e)}function bae(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,AI),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return bae(e).unknown(t)},e=arguments.length?Array.from(e,AI):[0,1],am(r)}function wae(e,t){e=e.slice();var r=0,n=e.length-1,l=e[r],u=e[n],f;return u<l&&(f=r,r=n,n=f,f=l,l=u,u=f),e[r]=t.floor(l),e[n]=t.ceil(u),e}function T7(e){return Math.log(e)}function E7(e){return Math.exp(e)}function Z6e(e){return-Math.log(-e)}function X6e(e){return-Math.exp(-e)}function K6e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Y6e(e){return e===10?K6e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function J6e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function A7(e){return(t,r)=>-e(-t,r)}function g4(e){const t=e(T7,E7),r=t.domain;let n=10,l,u;function f(){return l=J6e(n),u=Y6e(n),r()[0]<0?(l=A7(l),u=A7(u),e(Z6e,X6e)):e(T7,E7),t}return t.base=function(o){return arguments.length?(n=+o,f()):n},t.domain=function(o){return arguments.length?(r(o),f()):r()},t.ticks=o=>{const v=r();let w=v[0],P=v[v.length-1];const C=P<w;C&&([w,P]=[P,w]);let k=l(w),L=l(P),$,j;const B=o==null?10:+o;let U=[];if(!(n%1)&&L-k<B){if(k=Math.floor(k),L=Math.ceil(L),w>0){for(;k<=L;++k)for($=1;$<n;++$)if(j=k<0?$/u(-k):$*u(k),!(j<w)){if(j>P)break;U.push(j)}}else for(;k<=L;++k)for($=n-1;$>=1;--$)if(j=k>0?$/u(-k):$*u(k),!(j<w)){if(j>P)break;U.push(j)}U.length*2<B&&(U=Xz(w,P,B))}else U=Xz(k,L,Math.min(L-k,B)).map(u);return C?U.reverse():U},t.tickFormat=(o,v)=>{if(o==null&&(o=10),v==null&&(v=n===10?"s":","),typeof v!="function"&&(!(n%1)&&(v=tT(v)).precision==null&&(v.trim=!0),v=m4(v)),o===1/0)return v;const w=Math.max(1,n*o/t.ticks().length);return P=>{let C=P/u(Math.round(l(P)));return C*n<n-.5&&(C*=n),C<=w?v(P):""}},t.nice=()=>r(wae(r(),{floor:o=>u(Math.floor(l(o))),ceil:o=>u(Math.ceil(l(o)))})),t}function Sae(){const e=g4(Rk()).domain([1,10]);return e.copy=()=>cE(e,Sae()).base(e.base()),iu.apply(e,arguments),e}function P7(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function C7(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function y4(e){var t=1,r=e(P7(t),C7(t));return r.constant=function(n){return arguments.length?e(P7(t=+n),C7(t)):t},am(r)}function Tae(){var e=y4(Rk());return e.copy=function(){return cE(e,Tae()).constant(e.constant())},iu.apply(e,arguments)}function I7(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Q6e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function e8e(e){return e<0?-e*e:e*e}function _4(e){var t=e(_l,_l),r=1;function n(){return r===1?e(_l,_l):r===.5?e(Q6e,e8e):e(I7(r),I7(1/r))}return t.exponent=function(l){return arguments.length?(r=+l,n()):r},am(t)}function v4(){var e=_4(Rk());return e.copy=function(){return cE(e,v4()).exponent(e.exponent())},iu.apply(e,arguments),e}function t8e(){return v4.apply(null,arguments).exponent(.5)}function O7(e){return Math.sign(e)*e*e}function r8e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function Eae(){var e=f4(),t=[0,1],r=!1,n;function l(u){var f=r8e(e(u));return isNaN(f)?n:r?Math.round(f):f}return l.invert=function(u){return e.invert(O7(u))},l.domain=function(u){return arguments.length?(e.domain(u),l):e.domain()},l.range=function(u){return arguments.length?(e.range((t=Array.from(u,AI)).map(O7)),l):t.slice()},l.rangeRound=function(u){return l.range(u).round(!0)},l.round=function(u){return arguments.length?(r=!!u,l):r},l.clamp=function(u){return arguments.length?(e.clamp(u),l):e.clamp()},l.unknown=function(u){return arguments.length?(n=u,l):n},l.copy=function(){return Eae(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},iu.apply(l,arguments),am(l)}function Aae(){var e=[],t=[],r=[],n;function l(){var f=0,o=Math.max(1,t.length);for(r=new Array(o-1);++f<o;)r[f-1]=a6e(e,f/o);return u}function u(f){return f==null||isNaN(f=+f)?n:t[aE(r,f)]}return u.invertExtent=function(f){var o=t.indexOf(f);return o<0?[NaN,NaN]:[o>0?r[o-1]:e[0],o<r.length?r[o]:e[e.length-1]]},u.domain=function(f){if(!arguments.length)return e.slice();e=[];for(let o of f)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort($p),l()},u.range=function(f){return arguments.length?(t=Array.from(f),l()):t.slice()},u.unknown=function(f){return arguments.length?(n=f,u):n},u.quantiles=function(){return r.slice()},u.copy=function(){return Aae().domain(e).range(t).unknown(n)},iu.apply(u,arguments)}function Pae(){var e=0,t=1,r=1,n=[.5],l=[0,1],u;function f(v){return v!=null&&v<=v?l[aE(n,v,0,r)]:u}function o(){var v=-1;for(n=new Array(r);++v<r;)n[v]=((v+1)*t-(v-r)*e)/(r+1);return f}return f.domain=function(v){return arguments.length?([e,t]=v,e=+e,t=+t,o()):[e,t]},f.range=function(v){return arguments.length?(r=(l=Array.from(v)).length-1,o()):l.slice()},f.invertExtent=function(v){var w=l.indexOf(v);return w<0?[NaN,NaN]:w<1?[e,n[0]]:w>=r?[n[r-1],t]:[n[w-1],n[w]]},f.unknown=function(v){return arguments.length&&(u=v),f},f.thresholds=function(){return n.slice()},f.copy=function(){return Pae().domain([e,t]).range(l).unknown(u)},iu.apply(am(f),arguments)}function Cae(){var e=[.5],t=[0,1],r,n=1;function l(u){return u!=null&&u<=u?t[aE(e,u,0,n)]:r}return l.domain=function(u){return arguments.length?(e=Array.from(u),n=Math.min(e.length,t.length-1),l):e.slice()},l.range=function(u){return arguments.length?(t=Array.from(u),n=Math.min(e.length,t.length-1),l):t.slice()},l.invertExtent=function(u){var f=t.indexOf(u);return[e[f-1],e[f]]},l.unknown=function(u){return arguments.length?(r=u,l):r},l.copy=function(){return Cae().domain(e).range(t).unknown(r)},iu.apply(l,arguments)}const UL=new Date,GL=new Date;function Gs(e,t,r,n){function l(u){return e(u=arguments.length===0?new Date:new Date(+u)),u}return l.floor=u=>(e(u=new Date(+u)),u),l.ceil=u=>(e(u=new Date(u-1)),t(u,1),e(u),u),l.round=u=>{const f=l(u),o=l.ceil(u);return u-f<o-u?f:o},l.offset=(u,f)=>(t(u=new Date(+u),f==null?1:Math.floor(f)),u),l.range=(u,f,o)=>{const v=[];if(u=l.ceil(u),o=o==null?1:Math.floor(o),!(u<f)||!(o>0))return v;let w;do v.push(w=new Date(+u)),t(u,o),e(u);while(w<u&&u<f);return v},l.filter=u=>Gs(f=>{if(f>=f)for(;e(f),!u(f);)f.setTime(f-1)},(f,o)=>{if(f>=f)if(o<0)for(;++o<=0;)for(;t(f,-1),!u(f););else for(;--o>=0;)for(;t(f,1),!u(f););}),r&&(l.count=(u,f)=>(UL.setTime(+u),GL.setTime(+f),e(UL),e(GL),Math.floor(r(UL,GL))),l.every=u=>(u=Math.floor(u),!isFinite(u)||!(u>0)?null:u>1?l.filter(n?f=>n(f)%u===0:f=>l.count(0,f)%u===0):l)),l}const II=Gs(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);II.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Gs(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):II);II.range;const jh=1e3,Hc=jh*60,Nh=Hc*60,Qh=Nh*24,x4=Qh*7,k7=Qh*30,qL=Qh*365,Dg=Gs(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*jh)},(e,t)=>(t-e)/jh,e=>e.getUTCSeconds());Dg.range;const b4=Gs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jh)},(e,t)=>{e.setTime(+e+t*Hc)},(e,t)=>(t-e)/Hc,e=>e.getMinutes());b4.range;const w4=Gs(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Hc)},(e,t)=>(t-e)/Hc,e=>e.getUTCMinutes());w4.range;const S4=Gs(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jh-e.getMinutes()*Hc)},(e,t)=>{e.setTime(+e+t*Nh)},(e,t)=>(t-e)/Nh,e=>e.getHours());S4.range;const T4=Gs(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Nh)},(e,t)=>(t-e)/Nh,e=>e.getUTCHours());T4.range;const uE=Gs(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Hc)/Qh,e=>e.getDate()-1);uE.range;const Mk=Gs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Qh,e=>e.getUTCDate()-1);Mk.range;const Iae=Gs(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Qh,e=>Math.floor(e/Qh));Iae.range;function Cy(e){return Gs(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Hc)/x4)}const Dk=Cy(0),OI=Cy(1),n8e=Cy(2),i8e=Cy(3),G0=Cy(4),o8e=Cy(5),s8e=Cy(6);Dk.range;OI.range;n8e.range;i8e.range;G0.range;o8e.range;s8e.range;function Iy(e){return Gs(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/x4)}const Lk=Iy(0),kI=Iy(1),a8e=Iy(2),l8e=Iy(3),q0=Iy(4),c8e=Iy(5),u8e=Iy(6);Lk.range;kI.range;a8e.range;l8e.range;q0.range;c8e.range;u8e.range;const E4=Gs(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());E4.range;const A4=Gs(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());A4.range;const ef=Gs(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());ef.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Gs(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});ef.range;const tf=Gs(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());tf.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Gs(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});tf.range;function Oae(e,t,r,n,l,u){const f=[[Dg,1,jh],[Dg,5,5*jh],[Dg,15,15*jh],[Dg,30,30*jh],[u,1,Hc],[u,5,5*Hc],[u,15,15*Hc],[u,30,30*Hc],[l,1,Nh],[l,3,3*Nh],[l,6,6*Nh],[l,12,12*Nh],[n,1,Qh],[n,2,2*Qh],[r,1,x4],[t,1,k7],[t,3,3*k7],[e,1,qL]];function o(w,P,C){const k=P<w;k&&([w,P]=[P,w]);const L=C&&typeof C.range=="function"?C:v(w,P,C),$=L?L.range(w,+P+1):[];return k?$.reverse():$}function v(w,P,C){const k=Math.abs(P-w)/C,L=l4(([,,B])=>B).right(f,k);if(L===f.length)return e.every(Yz(w/qL,P/qL,C));if(L===0)return II.every(Math.max(Yz(w,P,C),1));const[$,j]=f[k/f[L-1][2]<f[L][2]/k?L-1:L];return $.every(j)}return[o,v]}const[d8e,h8e]=Oae(tf,A4,Lk,Iae,T4,w4),[f8e,p8e]=Oae(ef,E4,Dk,uE,S4,b4);function HL(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function WL(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function l1(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function m8e(e){var t=e.dateTime,r=e.date,n=e.time,l=e.periods,u=e.days,f=e.shortDays,o=e.months,v=e.shortMonths,w=c1(l),P=u1(l),C=c1(u),k=u1(u),L=c1(f),$=u1(f),j=c1(o),B=u1(o),U=c1(v),q=u1(v),H={a:at,A:qe,b:He,B:Et,c:null,d:N7,e:N7,f:z8e,g:Z8e,G:K8e,H:L8e,I:j8e,j:N8e,L:kae,m:F8e,M:B8e,p:Gt,q:Ot,Q:B7,s:$7,S:$8e,u:V8e,U:U8e,V:G8e,w:q8e,W:H8e,x:null,X:null,y:W8e,Y:X8e,Z:Y8e,"%":F7},te={a:$t,A:ur,b:Yr,B:hn,c:null,d:z7,e:z7,f:tGe,g:dGe,G:fGe,H:J8e,I:Q8e,j:eGe,L:Mae,m:rGe,M:nGe,p:rr,q:Wr,Q:B7,s:$7,S:iGe,u:oGe,U:sGe,V:aGe,w:lGe,W:cGe,x:null,X:null,y:uGe,Y:hGe,Z:pGe,"%":F7},Q={a:Fe,A:Ge,b:Ve,B:Ze,c:nt,d:L7,e:L7,f:k8e,g:D7,G:M7,H:j7,I:j7,j:P8e,L:O8e,m:A8e,M:C8e,p:Ce,q:E8e,Q:M8e,s:D8e,S:I8e,u:x8e,U:b8e,V:w8e,w:v8e,W:S8e,x:dt,X:rt,y:D7,Y:M7,Z:T8e,"%":R8e};H.x=ae(r,H),H.X=ae(n,H),H.c=ae(t,H),te.x=ae(r,te),te.X=ae(n,te),te.c=ae(t,te);function ae(Rt,Yt){return function(ir){var jt=[],Ir=-1,Xr=0,Vn=Rt.length,Hn,ei,Nn;for(ir instanceof Date||(ir=new Date(+ir));++Ir<Vn;)Rt.charCodeAt(Ir)===37&&(jt.push(Rt.slice(Xr,Ir)),(ei=R7[Hn=Rt.charAt(++Ir)])!=null?Hn=Rt.charAt(++Ir):ei=Hn==="e"?" ":"0",(Nn=Yt[Hn])&&(Hn=Nn(ir,ei)),jt.push(Hn),Xr=Ir+1);return jt.push(Rt.slice(Xr,Ir)),jt.join("")}}function ue(Rt,Yt){return function(ir){var jt=l1(1900,void 0,1),Ir=me(jt,Rt,ir+="",0),Xr,Vn;if(Ir!=ir.length)return null;if("Q"in jt)return new Date(jt.Q);if("s"in jt)return new Date(jt.s*1e3+("L"in jt?jt.L:0));if(Yt&&!("Z"in jt)&&(jt.Z=0),"p"in jt&&(jt.H=jt.H%12+jt.p*12),jt.m===void 0&&(jt.m="q"in jt?jt.q:0),"V"in jt){if(jt.V<1||jt.V>53)return null;"w"in jt||(jt.w=1),"Z"in jt?(Xr=WL(l1(jt.y,0,1)),Vn=Xr.getUTCDay(),Xr=Vn>4||Vn===0?kI.ceil(Xr):kI(Xr),Xr=Mk.offset(Xr,(jt.V-1)*7),jt.y=Xr.getUTCFullYear(),jt.m=Xr.getUTCMonth(),jt.d=Xr.getUTCDate()+(jt.w+6)%7):(Xr=HL(l1(jt.y,0,1)),Vn=Xr.getDay(),Xr=Vn>4||Vn===0?OI.ceil(Xr):OI(Xr),Xr=uE.offset(Xr,(jt.V-1)*7),jt.y=Xr.getFullYear(),jt.m=Xr.getMonth(),jt.d=Xr.getDate()+(jt.w+6)%7)}else("W"in jt||"U"in jt)&&("w"in jt||(jt.w="u"in jt?jt.u%7:"W"in jt?1:0),Vn="Z"in jt?WL(l1(jt.y,0,1)).getUTCDay():HL(l1(jt.y,0,1)).getDay(),jt.m=0,jt.d="W"in jt?(jt.w+6)%7+jt.W*7-(Vn+5)%7:jt.w+jt.U*7-(Vn+6)%7);return"Z"in jt?(jt.H+=jt.Z/100|0,jt.M+=jt.Z%100,WL(jt)):HL(jt)}}function me(Rt,Yt,ir,jt){for(var Ir=0,Xr=Yt.length,Vn=ir.length,Hn,ei;Ir<Xr;){if(jt>=Vn)return-1;if(Hn=Yt.charCodeAt(Ir++),Hn===37){if(Hn=Yt.charAt(Ir++),ei=Q[Hn in R7?Yt.charAt(Ir++):Hn],!ei||(jt=ei(Rt,ir,jt))<0)return-1}else if(Hn!=ir.charCodeAt(jt++))return-1}return jt}function Ce(Rt,Yt,ir){var jt=w.exec(Yt.slice(ir));return jt?(Rt.p=P.get(jt[0].toLowerCase()),ir+jt[0].length):-1}function Fe(Rt,Yt,ir){var jt=L.exec(Yt.slice(ir));return jt?(Rt.w=$.get(jt[0].toLowerCase()),ir+jt[0].length):-1}function Ge(Rt,Yt,ir){var jt=C.exec(Yt.slice(ir));return jt?(Rt.w=k.get(jt[0].toLowerCase()),ir+jt[0].length):-1}function Ve(Rt,Yt,ir){var jt=U.exec(Yt.slice(ir));return jt?(Rt.m=q.get(jt[0].toLowerCase()),ir+jt[0].length):-1}function Ze(Rt,Yt,ir){var jt=j.exec(Yt.slice(ir));return jt?(Rt.m=B.get(jt[0].toLowerCase()),ir+jt[0].length):-1}function nt(Rt,Yt,ir){return me(Rt,t,Yt,ir)}function dt(Rt,Yt,ir){return me(Rt,r,Yt,ir)}function rt(Rt,Yt,ir){return me(Rt,n,Yt,ir)}function at(Rt){return f[Rt.getDay()]}function qe(Rt){return u[Rt.getDay()]}function He(Rt){return v[Rt.getMonth()]}function Et(Rt){return o[Rt.getMonth()]}function Gt(Rt){return l[+(Rt.getHours()>=12)]}function Ot(Rt){return 1+~~(Rt.getMonth()/3)}function $t(Rt){return f[Rt.getUTCDay()]}function ur(Rt){return u[Rt.getUTCDay()]}function Yr(Rt){return v[Rt.getUTCMonth()]}function hn(Rt){return o[Rt.getUTCMonth()]}function rr(Rt){return l[+(Rt.getUTCHours()>=12)]}function Wr(Rt){return 1+~~(Rt.getUTCMonth()/3)}return{format:function(Rt){var Yt=ae(Rt+="",H);return Yt.toString=function(){return Rt},Yt},parse:function(Rt){var Yt=ue(Rt+="",!1);return Yt.toString=function(){return Rt},Yt},utcFormat:function(Rt){var Yt=ae(Rt+="",te);return Yt.toString=function(){return Rt},Yt},utcParse:function(Rt){var Yt=ue(Rt+="",!0);return Yt.toString=function(){return Rt},Yt}}}var R7={"-":"",_:" ",0:"0"},sa=/^\s*\d+/,g8e=/^%/,y8e=/[\\^$*+?|[\]().{}]/g;function Oi(e,t,r){var n=e<0?"-":"",l=(n?-e:e)+"",u=l.length;return n+(u<r?new Array(r-u+1).join(t)+l:l)}function _8e(e){return e.replace(y8e,"\\$&")}function c1(e){return new RegExp("^(?:"+e.map(_8e).join("|")+")","i")}function u1(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function v8e(e,t,r){var n=sa.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function x8e(e,t,r){var n=sa.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function b8e(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function w8e(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function S8e(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function M7(e,t,r){var n=sa.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function D7(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function T8e(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function E8e(e,t,r){var n=sa.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function A8e(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function L7(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function P8e(e,t,r){var n=sa.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function j7(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function C8e(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function I8e(e,t,r){var n=sa.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function O8e(e,t,r){var n=sa.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function k8e(e,t,r){var n=sa.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function R8e(e,t,r){var n=g8e.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function M8e(e,t,r){var n=sa.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function D8e(e,t,r){var n=sa.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function N7(e,t){return Oi(e.getDate(),t,2)}function L8e(e,t){return Oi(e.getHours(),t,2)}function j8e(e,t){return Oi(e.getHours()%12||12,t,2)}function N8e(e,t){return Oi(1+uE.count(ef(e),e),t,3)}function kae(e,t){return Oi(e.getMilliseconds(),t,3)}function z8e(e,t){return kae(e,t)+"000"}function F8e(e,t){return Oi(e.getMonth()+1,t,2)}function B8e(e,t){return Oi(e.getMinutes(),t,2)}function $8e(e,t){return Oi(e.getSeconds(),t,2)}function V8e(e){var t=e.getDay();return t===0?7:t}function U8e(e,t){return Oi(Dk.count(ef(e)-1,e),t,2)}function Rae(e){var t=e.getDay();return t>=4||t===0?G0(e):G0.ceil(e)}function G8e(e,t){return e=Rae(e),Oi(G0.count(ef(e),e)+(ef(e).getDay()===4),t,2)}function q8e(e){return e.getDay()}function H8e(e,t){return Oi(OI.count(ef(e)-1,e),t,2)}function W8e(e,t){return Oi(e.getFullYear()%100,t,2)}function Z8e(e,t){return e=Rae(e),Oi(e.getFullYear()%100,t,2)}function X8e(e,t){return Oi(e.getFullYear()%1e4,t,4)}function K8e(e,t){var r=e.getDay();return e=r>=4||r===0?G0(e):G0.ceil(e),Oi(e.getFullYear()%1e4,t,4)}function Y8e(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Oi(t/60|0,"0",2)+Oi(t%60,"0",2)}function z7(e,t){return Oi(e.getUTCDate(),t,2)}function J8e(e,t){return Oi(e.getUTCHours(),t,2)}function Q8e(e,t){return Oi(e.getUTCHours()%12||12,t,2)}function eGe(e,t){return Oi(1+Mk.count(tf(e),e),t,3)}function Mae(e,t){return Oi(e.getUTCMilliseconds(),t,3)}function tGe(e,t){return Mae(e,t)+"000"}function rGe(e,t){return Oi(e.getUTCMonth()+1,t,2)}function nGe(e,t){return Oi(e.getUTCMinutes(),t,2)}function iGe(e,t){return Oi(e.getUTCSeconds(),t,2)}function oGe(e){var t=e.getUTCDay();return t===0?7:t}function sGe(e,t){return Oi(Lk.count(tf(e)-1,e),t,2)}function Dae(e){var t=e.getUTCDay();return t>=4||t===0?q0(e):q0.ceil(e)}function aGe(e,t){return e=Dae(e),Oi(q0.count(tf(e),e)+(tf(e).getUTCDay()===4),t,2)}function lGe(e){return e.getUTCDay()}function cGe(e,t){return Oi(kI.count(tf(e)-1,e),t,2)}function uGe(e,t){return Oi(e.getUTCFullYear()%100,t,2)}function dGe(e,t){return e=Dae(e),Oi(e.getUTCFullYear()%100,t,2)}function hGe(e,t){return Oi(e.getUTCFullYear()%1e4,t,4)}function fGe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?q0(e):q0.ceil(e),Oi(e.getUTCFullYear()%1e4,t,4)}function pGe(){return"+0000"}function F7(){return"%"}function B7(e){return+e}function $7(e){return Math.floor(+e/1e3)}var hv,Lae,jae;mGe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function mGe(e){return hv=m8e(e),Lae=hv.format,hv.parse,jae=hv.utcFormat,hv.utcParse,hv}function gGe(e){return new Date(e)}function yGe(e){return e instanceof Date?+e:+new Date(+e)}function P4(e,t,r,n,l,u,f,o,v,w){var P=f4(),C=P.invert,k=P.domain,L=w(".%L"),$=w(":%S"),j=w("%I:%M"),B=w("%I %p"),U=w("%a %d"),q=w("%b %d"),H=w("%B"),te=w("%Y");function Q(ae){return(v(ae)<ae?L:o(ae)<ae?$:f(ae)<ae?j:u(ae)<ae?B:n(ae)<ae?l(ae)<ae?U:q:r(ae)<ae?H:te)(ae)}return P.invert=function(ae){return new Date(C(ae))},P.domain=function(ae){return arguments.length?k(Array.from(ae,yGe)):k().map(gGe)},P.ticks=function(ae){var ue=k();return e(ue[0],ue[ue.length-1],ae??10)},P.tickFormat=function(ae,ue){return ue==null?Q:w(ue)},P.nice=function(ae){var ue=k();return(!ae||typeof ae.range!="function")&&(ae=t(ue[0],ue[ue.length-1],ae??10)),ae?k(wae(ue,ae)):P},P.copy=function(){return cE(P,P4(e,t,r,n,l,u,f,o,v,w))},P}function _Ge(){return iu.apply(P4(f8e,p8e,ef,E4,Dk,uE,S4,b4,Dg,Lae).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function vGe(){return iu.apply(P4(d8e,h8e,tf,A4,Lk,Mk,T4,w4,Dg,jae).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function jk(){var e=0,t=1,r,n,l,u,f=_l,o=!1,v;function w(C){return C==null||isNaN(C=+C)?v:f(l===0?.5:(C=(u(C)-r)*l,o?Math.max(0,Math.min(1,C)):C))}w.domain=function(C){return arguments.length?([e,t]=C,r=u(e=+e),n=u(t=+t),l=r===n?0:1/(n-r),w):[e,t]},w.clamp=function(C){return arguments.length?(o=!!C,w):o},w.interpolator=function(C){return arguments.length?(f=C,w):f};function P(C){return function(k){var L,$;return arguments.length?([L,$]=k,f=C(L,$),w):[f(0),f(1)]}}return w.range=P(kx),w.rangeRound=P(h4),w.unknown=function(C){return arguments.length?(v=C,w):v},function(C){return u=C,r=C(e),n=C(t),l=r===n?0:1/(n-r),w}}function lm(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Nae(){var e=am(jk()(_l));return e.copy=function(){return lm(e,Nae())},uf.apply(e,arguments)}function zae(){var e=g4(jk()).domain([1,10]);return e.copy=function(){return lm(e,zae()).base(e.base())},uf.apply(e,arguments)}function Fae(){var e=y4(jk());return e.copy=function(){return lm(e,Fae()).constant(e.constant())},uf.apply(e,arguments)}function C4(){var e=_4(jk());return e.copy=function(){return lm(e,C4()).exponent(e.exponent())},uf.apply(e,arguments)}function xGe(){return C4.apply(null,arguments).exponent(.5)}function Bae(){var e=[],t=_l;function r(n){if(n!=null&&!isNaN(n=+n))return t((aE(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let l of n)l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort($p),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,l)=>t(l/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(l,u)=>s6e(e,u/n))},r.copy=function(){return Bae(t).domain(e)},uf.apply(r,arguments)}function Nk(){var e=0,t=.5,r=1,n=1,l,u,f,o,v,w=_l,P,C=!1,k;function L(j){return isNaN(j=+j)?k:(j=.5+((j=+P(j))-u)*(n*j<n*u?o:v),w(C?Math.max(0,Math.min(1,j)):j))}L.domain=function(j){return arguments.length?([e,t,r]=j,l=P(e=+e),u=P(t=+t),f=P(r=+r),o=l===u?0:.5/(u-l),v=u===f?0:.5/(f-u),n=u<l?-1:1,L):[e,t,r]},L.clamp=function(j){return arguments.length?(C=!!j,L):C},L.interpolator=function(j){return arguments.length?(w=j,L):w};function $(j){return function(B){var U,q,H;return arguments.length?([U,q,H]=B,w=R6e(j,[U,q,H]),L):[w(0),w(.5),w(1)]}}return L.range=$(kx),L.rangeRound=$(h4),L.unknown=function(j){return arguments.length?(k=j,L):k},function(j){return P=j,l=j(e),u=j(t),f=j(r),o=l===u?0:.5/(u-l),v=u===f?0:.5/(f-u),n=u<l?-1:1,L}}function $ae(){var e=am(Nk()(_l));return e.copy=function(){return lm(e,$ae())},uf.apply(e,arguments)}function Vae(){var e=g4(Nk()).domain([.1,1,10]);return e.copy=function(){return lm(e,Vae()).base(e.base())},uf.apply(e,arguments)}function Uae(){var e=y4(Nk());return e.copy=function(){return lm(e,Uae()).constant(e.constant())},uf.apply(e,arguments)}function I4(){var e=_4(Nk());return e.copy=function(){return lm(e,I4()).exponent(e.exponent())},uf.apply(e,arguments)}function bGe(){return I4.apply(null,arguments).exponent(.5)}const V7=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:YS,scaleDiverging:$ae,scaleDivergingLog:Vae,scaleDivergingPow:I4,scaleDivergingSqrt:bGe,scaleDivergingSymlog:Uae,scaleIdentity:bae,scaleImplicit:Jz,scaleLinear:CI,scaleLog:Sae,scaleOrdinal:c4,scalePoint:Y1,scalePow:v4,scaleQuantile:Aae,scaleQuantize:Pae,scaleRadial:Eae,scaleSequential:Nae,scaleSequentialLog:zae,scaleSequentialPow:C4,scaleSequentialQuantile:Bae,scaleSequentialSqrt:xGe,scaleSequentialSymlog:Fae,scaleSqrt:t8e,scaleSymlog:Tae,scaleThreshold:Cae,scaleTime:_Ge,scaleUtc:vGe,tickFormat:xae},Symbol.toStringTag,{value:"Module"}));var wGe=Sx;function SGe(e,t,r){for(var n=-1,l=e.length;++n<l;){var u=e[n],f=t(u);if(f!=null&&(o===void 0?f===f&&!wGe(f):r(f,o)))var o=f,v=u}return v}var zk=SGe;function TGe(e,t){return e>t}var Gae=TGe,EGe=zk,AGe=Gae,PGe=Ox;function CGe(e){return e&&e.length?EGe(e,PGe,AGe):void 0}var IGe=CGe;const Fk=zi(IGe);function OGe(e,t){return e<t}var qae=OGe,kGe=zk,RGe=qae,MGe=Ox;function DGe(e){return e&&e.length?kGe(e,MGe,RGe):void 0}var LGe=DGe;const Bk=zi(LGe);var jGe=U5,NGe=Kd,zGe=Qse,FGe=Vl;function BGe(e,t){var r=FGe(e)?jGe:zGe;return r(e,NGe(t))}var $Ge=BGe,VGe=Yse,UGe=$Ge;function GGe(e,t){return VGe(UGe(e,t),1)}var qGe=GGe;const HGe=zi(qGe);var WGe=i4;function ZGe(e,t){return WGe(e,t)}var XGe=ZGe;const $k=zi(XGe);var Rx=1e9,KGe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},k4,Ro=!0,eu="[DecimalError] ",Kg=eu+"Invalid argument: ",O4=eu+"Exponent out of range: ",Mx=Math.floor,bg=Math.pow,YGe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ac,ra=1e7,To=7,Hae=9007199254740991,RI=Mx(Hae/To),Fr={};Fr.absoluteValue=Fr.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Fr.comparedTo=Fr.cmp=function(e){var t,r,n,l,u=this;if(e=new u.constructor(e),u.s!==e.s)return u.s||-e.s;if(u.e!==e.e)return u.e>e.e^u.s<0?1:-1;for(n=u.d.length,l=e.d.length,t=0,r=n<l?n:l;t<r;++t)if(u.d[t]!==e.d[t])return u.d[t]>e.d[t]^u.s<0?1:-1;return n===l?0:n>l^u.s<0?1:-1};Fr.decimalPlaces=Fr.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*To;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Fr.dividedBy=Fr.div=function(e){return Vh(this,new this.constructor(e))};Fr.dividedToIntegerBy=Fr.idiv=function(e){var t=this,r=t.constructor;return ro(Vh(t,new r(e),0,1),r.precision)};Fr.equals=Fr.eq=function(e){return!this.cmp(e)};Fr.exponent=function(){return As(this)};Fr.greaterThan=Fr.gt=function(e){return this.cmp(e)>0};Fr.greaterThanOrEqualTo=Fr.gte=function(e){return this.cmp(e)>=0};Fr.isInteger=Fr.isint=function(){return this.e>this.d.length-2};Fr.isNegative=Fr.isneg=function(){return this.s<0};Fr.isPositive=Fr.ispos=function(){return this.s>0};Fr.isZero=function(){return this.s===0};Fr.lessThan=Fr.lt=function(e){return this.cmp(e)<0};Fr.lessThanOrEqualTo=Fr.lte=function(e){return this.cmp(e)<1};Fr.logarithm=Fr.log=function(e){var t,r=this,n=r.constructor,l=n.precision,u=l+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(ac))throw Error(eu+"NaN");if(r.s<1)throw Error(eu+(r.s?"NaN":"-Infinity"));return r.eq(ac)?new n(0):(Ro=!1,t=Vh(rT(r,u),rT(e,u),u),Ro=!0,ro(t,l))};Fr.minus=Fr.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Xae(t,e):Wae(t,(e.s=-e.s,e))};Fr.modulo=Fr.mod=function(e){var t,r=this,n=r.constructor,l=n.precision;if(e=new n(e),!e.s)throw Error(eu+"NaN");return r.s?(Ro=!1,t=Vh(r,e,0,1).times(e),Ro=!0,r.minus(t)):ro(new n(r),l)};Fr.naturalExponential=Fr.exp=function(){return Zae(this)};Fr.naturalLogarithm=Fr.ln=function(){return rT(this)};Fr.negated=Fr.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Fr.plus=Fr.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?Wae(t,e):Xae(t,(e.s=-e.s,e))};Fr.precision=Fr.sd=function(e){var t,r,n,l=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Kg+e);if(t=As(l)+1,n=l.d.length-1,r=n*To+1,n=l.d[n],n){for(;n%10==0;n/=10)r--;for(n=l.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Fr.squareRoot=Fr.sqrt=function(){var e,t,r,n,l,u,f,o=this,v=o.constructor;if(o.s<1){if(!o.s)return new v(0);throw Error(eu+"NaN")}for(e=As(o),Ro=!1,l=Math.sqrt(+o),l==0||l==1/0?(t=Rd(o.d),(t.length+e)%2==0&&(t+="0"),l=Math.sqrt(t),e=Mx((e+1)/2)-(e<0||e%2),l==1/0?t="5e"+e:(t=l.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new v(t)):n=new v(l.toString()),r=v.precision,l=f=r+3;;)if(u=n,n=u.plus(Vh(o,u,f+2)).times(.5),Rd(u.d).slice(0,f)===(t=Rd(n.d)).slice(0,f)){if(t=t.slice(f-3,f+1),l==f&&t=="4999"){if(ro(u,r+1,0),u.times(u).eq(o)){n=u;break}}else if(t!="9999")break;f+=4}return Ro=!0,ro(n,r)};Fr.times=Fr.mul=function(e){var t,r,n,l,u,f,o,v,w,P=this,C=P.constructor,k=P.d,L=(e=new C(e)).d;if(!P.s||!e.s)return new C(0);for(e.s*=P.s,r=P.e+e.e,v=k.length,w=L.length,v<w&&(u=k,k=L,L=u,f=v,v=w,w=f),u=[],f=v+w,n=f;n--;)u.push(0);for(n=w;--n>=0;){for(t=0,l=v+n;l>n;)o=u[l]+L[n]*k[l-n-1]+t,u[l--]=o%ra|0,t=o/ra|0;u[l]=(u[l]+t)%ra|0}for(;!u[--f];)u.pop();return t?++r:u.shift(),e.d=u,e.e=r,Ro?ro(e,C.precision):e};Fr.toDecimalPlaces=Fr.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(Hd(e,0,Rx),t===void 0?t=n.rounding:Hd(t,0,8),ro(r,e+As(r)+1,t))};Fr.toExponential=function(e,t){var r,n=this,l=n.constructor;return e===void 0?r=my(n,!0):(Hd(e,0,Rx),t===void 0?t=l.rounding:Hd(t,0,8),n=ro(new l(n),e+1,t),r=my(n,!0,e+1)),r};Fr.toFixed=function(e,t){var r,n,l=this,u=l.constructor;return e===void 0?my(l):(Hd(e,0,Rx),t===void 0?t=u.rounding:Hd(t,0,8),n=ro(new u(l),e+As(l)+1,t),r=my(n.abs(),!1,e+As(n)+1),l.isneg()&&!l.isZero()?"-"+r:r)};Fr.toInteger=Fr.toint=function(){var e=this,t=e.constructor;return ro(new t(e),As(e)+1,t.rounding)};Fr.toNumber=function(){return+this};Fr.toPower=Fr.pow=function(e){var t,r,n,l,u,f,o=this,v=o.constructor,w=12,P=+(e=new v(e));if(!e.s)return new v(ac);if(o=new v(o),!o.s){if(e.s<1)throw Error(eu+"Infinity");return o}if(o.eq(ac))return o;if(n=v.precision,e.eq(ac))return ro(o,n);if(t=e.e,r=e.d.length-1,f=t>=r,u=o.s,f){if((r=P<0?-P:P)<=Hae){for(l=new v(ac),t=Math.ceil(n/To+4),Ro=!1;r%2&&(l=l.times(o),G7(l.d,t)),r=Mx(r/2),r!==0;)o=o.times(o),G7(o.d,t);return Ro=!0,e.s<0?new v(ac).div(l):ro(l,n)}}else if(u<0)throw Error(eu+"NaN");return u=u<0&&e.d[Math.max(t,r)]&1?-1:1,o.s=1,Ro=!1,l=e.times(rT(o,n+w)),Ro=!0,l=Zae(l),l.s=u,l};Fr.toPrecision=function(e,t){var r,n,l=this,u=l.constructor;return e===void 0?(r=As(l),n=my(l,r<=u.toExpNeg||r>=u.toExpPos)):(Hd(e,1,Rx),t===void 0?t=u.rounding:Hd(t,0,8),l=ro(new u(l),e,t),r=As(l),n=my(l,e<=r||r<=u.toExpNeg,e)),n};Fr.toSignificantDigits=Fr.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(Hd(e,1,Rx),t===void 0?t=n.rounding:Hd(t,0,8)),ro(new n(r),e,t)};Fr.toString=Fr.valueOf=Fr.val=Fr.toJSON=Fr[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=As(e),r=e.constructor;return my(e,t<=r.toExpNeg||t>=r.toExpPos)};function Wae(e,t){var r,n,l,u,f,o,v,w,P=e.constructor,C=P.precision;if(!e.s||!t.s)return t.s||(t=new P(e)),Ro?ro(t,C):t;if(v=e.d,w=t.d,f=e.e,l=t.e,v=v.slice(),u=f-l,u){for(u<0?(n=v,u=-u,o=w.length):(n=w,l=f,o=v.length),f=Math.ceil(C/To),o=f>o?f+1:o+1,u>o&&(u=o,n.length=1),n.reverse();u--;)n.push(0);n.reverse()}for(o=v.length,u=w.length,o-u<0&&(u=o,n=w,w=v,v=n),r=0;u;)r=(v[--u]=v[u]+w[u]+r)/ra|0,v[u]%=ra;for(r&&(v.unshift(r),++l),o=v.length;v[--o]==0;)v.pop();return t.d=v,t.e=l,Ro?ro(t,C):t}function Hd(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Kg+e)}function Rd(e){var t,r,n,l=e.length-1,u="",f=e[0];if(l>0){for(u+=f,t=1;t<l;t++)n=e[t]+"",r=To-n.length,r&&(u+=up(r)),u+=n;f=e[t],n=f+"",r=To-n.length,r&&(u+=up(r))}else if(f===0)return"0";for(;f%10===0;)f/=10;return u+f}var Vh=function(){function e(n,l){var u,f=0,o=n.length;for(n=n.slice();o--;)u=n[o]*l+f,n[o]=u%ra|0,f=u/ra|0;return f&&n.unshift(f),n}function t(n,l,u,f){var o,v;if(u!=f)v=u>f?1:-1;else for(o=v=0;o<u;o++)if(n[o]!=l[o]){v=n[o]>l[o]?1:-1;break}return v}function r(n,l,u){for(var f=0;u--;)n[u]-=f,f=n[u]<l[u]?1:0,n[u]=f*ra+n[u]-l[u];for(;!n[0]&&n.length>1;)n.shift()}return function(n,l,u,f){var o,v,w,P,C,k,L,$,j,B,U,q,H,te,Q,ae,ue,me,Ce=n.constructor,Fe=n.s==l.s?1:-1,Ge=n.d,Ve=l.d;if(!n.s)return new Ce(n);if(!l.s)throw Error(eu+"Division by zero");for(v=n.e-l.e,ue=Ve.length,Q=Ge.length,L=new Ce(Fe),$=L.d=[],w=0;Ve[w]==(Ge[w]||0);)++w;if(Ve[w]>(Ge[w]||0)&&--v,u==null?q=u=Ce.precision:f?q=u+(As(n)-As(l))+1:q=u,q<0)return new Ce(0);if(q=q/To+2|0,w=0,ue==1)for(P=0,Ve=Ve[0],q++;(w<Q||P)&&q--;w++)H=P*ra+(Ge[w]||0),$[w]=H/Ve|0,P=H%Ve|0;else{for(P=ra/(Ve[0]+1)|0,P>1&&(Ve=e(Ve,P),Ge=e(Ge,P),ue=Ve.length,Q=Ge.length),te=ue,j=Ge.slice(0,ue),B=j.length;B<ue;)j[B++]=0;me=Ve.slice(),me.unshift(0),ae=Ve[0],Ve[1]>=ra/2&&++ae;do P=0,o=t(Ve,j,ue,B),o<0?(U=j[0],ue!=B&&(U=U*ra+(j[1]||0)),P=U/ae|0,P>1?(P>=ra&&(P=ra-1),C=e(Ve,P),k=C.length,B=j.length,o=t(C,j,k,B),o==1&&(P--,r(C,ue<k?me:Ve,k))):(P==0&&(o=P=1),C=Ve.slice()),k=C.length,k<B&&C.unshift(0),r(j,C,B),o==-1&&(B=j.length,o=t(Ve,j,ue,B),o<1&&(P++,r(j,ue<B?me:Ve,B))),B=j.length):o===0&&(P++,j=[0]),$[w++]=P,o&&j[0]?j[B++]=Ge[te]||0:(j=[Ge[te]],B=1);while((te++<Q||j[0]!==void 0)&&q--)}return $[0]||$.shift(),L.e=v,ro(L,f?u+As(L)+1:u)}}();function Zae(e,t){var r,n,l,u,f,o,v=0,w=0,P=e.constructor,C=P.precision;if(As(e)>16)throw Error(O4+As(e));if(!e.s)return new P(ac);for(t==null?(Ro=!1,o=C):o=t,f=new P(.03125);e.abs().gte(.1);)e=e.times(f),w+=5;for(n=Math.log(bg(2,w))/Math.LN10*2+5|0,o+=n,r=l=u=new P(ac),P.precision=o;;){if(l=ro(l.times(e),o),r=r.times(++v),f=u.plus(Vh(l,r,o)),Rd(f.d).slice(0,o)===Rd(u.d).slice(0,o)){for(;w--;)u=ro(u.times(u),o);return P.precision=C,t==null?(Ro=!0,ro(u,C)):u}u=f}}function As(e){for(var t=e.e*To,r=e.d[0];r>=10;r/=10)t++;return t}function ZL(e,t,r){if(t>e.LN10.sd())throw Ro=!0,r&&(e.precision=r),Error(eu+"LN10 precision limit exceeded");return ro(new e(e.LN10),t)}function up(e){for(var t="";e--;)t+="0";return t}function rT(e,t){var r,n,l,u,f,o,v,w,P,C=1,k=10,L=e,$=L.d,j=L.constructor,B=j.precision;if(L.s<1)throw Error(eu+(L.s?"NaN":"-Infinity"));if(L.eq(ac))return new j(0);if(t==null?(Ro=!1,w=B):w=t,L.eq(10))return t==null&&(Ro=!0),ZL(j,w);if(w+=k,j.precision=w,r=Rd($),n=r.charAt(0),u=As(L),Math.abs(u)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)L=L.times(e),r=Rd(L.d),n=r.charAt(0),C++;u=As(L),n>1?(L=new j("0."+r),u++):L=new j(n+"."+r.slice(1))}else return v=ZL(j,w+2,B).times(u+""),L=rT(new j(n+"."+r.slice(1)),w-k).plus(v),j.precision=B,t==null?(Ro=!0,ro(L,B)):L;for(o=f=L=Vh(L.minus(ac),L.plus(ac),w),P=ro(L.times(L),w),l=3;;){if(f=ro(f.times(P),w),v=o.plus(Vh(f,new j(l),w)),Rd(v.d).slice(0,w)===Rd(o.d).slice(0,w))return o=o.times(2),u!==0&&(o=o.plus(ZL(j,w+2,B).times(u+""))),o=Vh(o,new j(C),w),j.precision=B,t==null?(Ro=!0,ro(o,B)):o;o=v,l+=2}}function U7(e,t){var r,n,l;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(l=t.length;t.charCodeAt(l-1)===48;)--l;if(t=t.slice(n,l),t){if(l-=n,r=r-n-1,e.e=Mx(r/To),e.d=[],n=(r+1)%To,r<0&&(n+=To),n<l){for(n&&e.d.push(+t.slice(0,n)),l-=To;n<l;)e.d.push(+t.slice(n,n+=To));t=t.slice(n),n=To-t.length}else n-=l;for(;n--;)t+="0";if(e.d.push(+t),Ro&&(e.e>RI||e.e<-RI))throw Error(O4+r)}else e.s=0,e.e=0,e.d=[0];return e}function ro(e,t,r){var n,l,u,f,o,v,w,P,C=e.d;for(f=1,u=C[0];u>=10;u/=10)f++;if(n=t-f,n<0)n+=To,l=t,w=C[P=0];else{if(P=Math.ceil((n+1)/To),u=C.length,P>=u)return e;for(w=u=C[P],f=1;u>=10;u/=10)f++;n%=To,l=n-To+f}if(r!==void 0&&(u=bg(10,f-l-1),o=w/u%10|0,v=t<0||C[P+1]!==void 0||w%u,v=r<4?(o||v)&&(r==0||r==(e.s<0?3:2)):o>5||o==5&&(r==4||v||r==6&&(n>0?l>0?w/bg(10,f-l):0:C[P-1])%10&1||r==(e.s<0?8:7))),t<1||!C[0])return v?(u=As(e),C.length=1,t=t-u-1,C[0]=bg(10,(To-t%To)%To),e.e=Mx(-t/To)||0):(C.length=1,C[0]=e.e=e.s=0),e;if(n==0?(C.length=P,u=1,P--):(C.length=P+1,u=bg(10,To-n),C[P]=l>0?(w/bg(10,f-l)%bg(10,l)|0)*u:0),v)for(;;)if(P==0){(C[0]+=u)==ra&&(C[0]=1,++e.e);break}else{if(C[P]+=u,C[P]!=ra)break;C[P--]=0,u=1}for(n=C.length;C[--n]===0;)C.pop();if(Ro&&(e.e>RI||e.e<-RI))throw Error(O4+As(e));return e}function Xae(e,t){var r,n,l,u,f,o,v,w,P,C,k=e.constructor,L=k.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new k(e),Ro?ro(t,L):t;if(v=e.d,C=t.d,n=t.e,w=e.e,v=v.slice(),f=w-n,f){for(P=f<0,P?(r=v,f=-f,o=C.length):(r=C,n=w,o=v.length),l=Math.max(Math.ceil(L/To),o)+2,f>l&&(f=l,r.length=1),r.reverse(),l=f;l--;)r.push(0);r.reverse()}else{for(l=v.length,o=C.length,P=l<o,P&&(o=l),l=0;l<o;l++)if(v[l]!=C[l]){P=v[l]<C[l];break}f=0}for(P&&(r=v,v=C,C=r,t.s=-t.s),o=v.length,l=C.length-o;l>0;--l)v[o++]=0;for(l=C.length;l>f;){if(v[--l]<C[l]){for(u=l;u&&v[--u]===0;)v[u]=ra-1;--v[u],v[l]+=ra}v[l]-=C[l]}for(;v[--o]===0;)v.pop();for(;v[0]===0;v.shift())--n;return v[0]?(t.d=v,t.e=n,Ro?ro(t,L):t):new k(0)}function my(e,t,r){var n,l=As(e),u=Rd(e.d),f=u.length;return t?(r&&(n=r-f)>0?u=u.charAt(0)+"."+u.slice(1)+up(n):f>1&&(u=u.charAt(0)+"."+u.slice(1)),u=u+(l<0?"e":"e+")+l):l<0?(u="0."+up(-l-1)+u,r&&(n=r-f)>0&&(u+=up(n))):l>=f?(u+=up(l+1-f),r&&(n=r-l-1)>0&&(u=u+"."+up(n))):((n=l+1)<f&&(u=u.slice(0,n)+"."+u.slice(n)),r&&(n=r-f)>0&&(l+1===f&&(u+="."),u+=up(n))),e.s<0?"-"+u:u}function G7(e,t){if(e.length>t)return e.length=t,!0}function Kae(e){var t,r,n;function l(u){var f=this;if(!(f instanceof l))return new l(u);if(f.constructor=l,u instanceof l){f.s=u.s,f.e=u.e,f.d=(u=u.d)?u.slice():u;return}if(typeof u=="number"){if(u*0!==0)throw Error(Kg+u);if(u>0)f.s=1;else if(u<0)u=-u,f.s=-1;else{f.s=0,f.e=0,f.d=[0];return}if(u===~~u&&u<1e7){f.e=0,f.d=[u];return}return U7(f,u.toString())}else if(typeof u!="string")throw Error(Kg+u);if(u.charCodeAt(0)===45?(u=u.slice(1),f.s=-1):f.s=1,YGe.test(u))U7(f,u);else throw Error(Kg+u)}if(l.prototype=Fr,l.ROUND_UP=0,l.ROUND_DOWN=1,l.ROUND_CEIL=2,l.ROUND_FLOOR=3,l.ROUND_HALF_UP=4,l.ROUND_HALF_DOWN=5,l.ROUND_HALF_EVEN=6,l.ROUND_HALF_CEIL=7,l.ROUND_HALF_FLOOR=8,l.clone=Kae,l.config=l.set=JGe,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return l.config(e),l}function JGe(e){if(!e||typeof e!="object")throw Error(eu+"Object expected");var t,r,n,l=["precision",1,Rx,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<l.length;t+=3)if((n=e[r=l[t]])!==void 0)if(Mx(n)===n&&n>=l[t+1]&&n<=l[t+2])this[r]=n;else throw Error(Kg+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Kg+r+": "+n);return this}var k4=Kae(KGe);ac=new k4(1);const to=k4;function QGe(e){return nqe(e)||rqe(e)||tqe(e)||eqe()}function eqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tqe(e,t){if(e){if(typeof e=="string")return rF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rF(e,t)}}function rqe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function nqe(e){if(Array.isArray(e))return rF(e)}function rF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var iqe=function(t){return t},Yae={"@@functional/placeholder":!0},Jae=function(t){return t===Yae},q7=function(t){return function r(){return arguments.length===0||arguments.length===1&&Jae(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},oqe=function e(t,r){return t===1?r:q7(function(){for(var n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];var f=l.filter(function(o){return o!==Yae}).length;return f>=t?r.apply(void 0,l):e(t-f,q7(function(){for(var o=arguments.length,v=new Array(o),w=0;w<o;w++)v[w]=arguments[w];var P=l.map(function(C){return Jae(C)?v.shift():C});return r.apply(void 0,QGe(P).concat(v))}))})},Vk=function(t){return oqe(t.length,t)},nF=function(t,r){for(var n=[],l=t;l<r;++l)n[l-t]=l;return n},sqe=Vk(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),aqe=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return iqe;var l=r.reverse(),u=l[0],f=l.slice(1);return function(){return f.reduce(function(o,v){return v(o)},u.apply(void 0,arguments))}},iF=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},Qae=function(t){var r=null,n=null;return function(){for(var l=arguments.length,u=new Array(l),f=0;f<l;f++)u[f]=arguments[f];return r&&u.every(function(o,v){return o===r[v]})||(r=u,n=t.apply(void 0,u)),n}};function lqe(e){var t;return e===0?t=1:t=Math.floor(new to(e).abs().log(10).toNumber())+1,t}function cqe(e,t,r){for(var n=new to(e),l=0,u=[];n.lt(t)&&l<1e5;)u.push(n.toNumber()),n=n.add(r),l++;return u}var uqe=Vk(function(e,t,r){var n=+e,l=+t;return n+r*(l-n)}),dqe=Vk(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),hqe=Vk(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const Uk={rangeStep:cqe,getDigitCount:lqe,interpolateNumber:uqe,uninterpolateNumber:dqe,uninterpolateTruncation:hqe};function oF(e){return mqe(e)||pqe(e)||ele(e)||fqe()}function fqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pqe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function mqe(e){if(Array.isArray(e))return sF(e)}function nT(e,t){return _qe(e)||yqe(e,t)||ele(e,t)||gqe()}function gqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ele(e,t){if(e){if(typeof e=="string")return sF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sF(e,t)}}function sF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function yqe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,l=!1,u=void 0;try{for(var f=e[Symbol.iterator](),o;!(n=(o=f.next()).done)&&(r.push(o.value),!(t&&r.length===t));n=!0);}catch(v){l=!0,u=v}finally{try{!n&&f.return!=null&&f.return()}finally{if(l)throw u}}return r}}function _qe(e){if(Array.isArray(e))return e}function tle(e){var t=nT(e,2),r=t[0],n=t[1],l=r,u=n;return r>n&&(l=n,u=r),[l,u]}function rle(e,t,r){if(e.lte(0))return new to(0);var n=Uk.getDigitCount(e.toNumber()),l=new to(10).pow(n),u=e.div(l),f=n!==1?.05:.1,o=new to(Math.ceil(u.div(f).toNumber())).add(r).mul(f),v=o.mul(l);return t?v:new to(Math.ceil(v))}function vqe(e,t,r){var n=1,l=new to(e);if(!l.isint()&&r){var u=Math.abs(e);u<1?(n=new to(10).pow(Uk.getDigitCount(e)-1),l=new to(Math.floor(l.div(n).toNumber())).mul(n)):u>1&&(l=new to(Math.floor(e)))}else e===0?l=new to(Math.floor((t-1)/2)):r||(l=new to(Math.floor(e)));var f=Math.floor((t-1)/2),o=aqe(sqe(function(v){return l.add(new to(v-f).mul(n)).toNumber()}),nF);return o(0,t)}function nle(e,t,r,n){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new to(0),tickMin:new to(0),tickMax:new to(0)};var u=rle(new to(t).sub(e).div(r-1),n,l),f;e<=0&&t>=0?f=new to(0):(f=new to(e).add(t).div(2),f=f.sub(new to(f).mod(u)));var o=Math.ceil(f.sub(e).div(u).toNumber()),v=Math.ceil(new to(t).sub(f).div(u).toNumber()),w=o+v+1;return w>r?nle(e,t,r,n,l+1):(w<r&&(v=t>0?v+(r-w):v,o=t>0?o:o+(r-w)),{step:u,tickMin:f.sub(new to(o).mul(u)),tickMax:f.add(new to(v).mul(u))})}function xqe(e){var t=nT(e,2),r=t[0],n=t[1],l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=Math.max(l,2),o=tle([r,n]),v=nT(o,2),w=v[0],P=v[1];if(w===-1/0||P===1/0){var C=P===1/0?[w].concat(oF(nF(0,l-1).map(function(){return 1/0}))):[].concat(oF(nF(0,l-1).map(function(){return-1/0})),[P]);return r>n?iF(C):C}if(w===P)return vqe(w,l,u);var k=nle(w,P,f,u),L=k.step,$=k.tickMin,j=k.tickMax,B=Uk.rangeStep($,j.add(new to(.1).mul(L)),L);return r>n?iF(B):B}function bqe(e,t){var r=nT(e,2),n=r[0],l=r[1],u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,f=tle([n,l]),o=nT(f,2),v=o[0],w=o[1];if(v===-1/0||w===1/0)return[n,l];if(v===w)return[v];var P=Math.max(t,2),C=rle(new to(w).sub(v).div(P-1),u,0),k=[].concat(oF(Uk.rangeStep(new to(v),new to(w).sub(new to(.99).mul(C)),C)),[w]);return n>l?iF(k):k}var wqe=Qae(xqe),Sqe=Qae(bqe),Tqe="Invariant failed";function gy(e,t){throw new Error(Tqe)}var Eqe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function H0(e){"@babel/helpers - typeof";return H0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H0(e)}function MI(){return MI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},MI.apply(this,arguments)}function Aqe(e,t){return Oqe(e)||Iqe(e,t)||Cqe(e,t)||Pqe()}function Pqe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cqe(e,t){if(e){if(typeof e=="string")return H7(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return H7(e,t)}}function H7(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Iqe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function Oqe(e){if(Array.isArray(e))return e}function kqe(e,t){if(e==null)return{};var r=Rqe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Rqe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Mqe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dqe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sle(n.key),n)}}function Lqe(e,t,r){return t&&Dqe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function jqe(e,t,r){return t=DI(t),Nqe(e,ile()?Reflect.construct(t,r||[],DI(e).constructor):t.apply(e,r))}function Nqe(e,t){if(t&&(H0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return zqe(e)}function zqe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ile(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ile=function(){return!!e})()}function DI(e){return DI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DI(e)}function Fqe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&aF(e,t)}function aF(e,t){return aF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},aF(e,t)}function ole(e,t,r){return t=sle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sle(e){var t=Bqe(e,"string");return H0(t)=="symbol"?t:t+""}function Bqe(e,t){if(H0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(H0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Gk=function(e){function t(){return Mqe(this,t),jqe(this,t,arguments)}return Fqe(t,e),Lqe(t,[{key:"render",value:function(){var n=this.props,l=n.offset,u=n.layout,f=n.width,o=n.dataKey,v=n.data,w=n.dataPointFormatter,P=n.xAxis,C=n.yAxis,k=kqe(n,Eqe),L=Pn(k,!1);this.props.direction==="x"&&P.type!=="number"&&gy();var $=v.map(function(j){var B=w(j,o),U=B.x,q=B.y,H=B.value,te=B.errorVal;if(!te)return null;var Q=[],ae,ue;if(Array.isArray(te)){var me=Aqe(te,2);ae=me[0],ue=me[1]}else ae=ue=te;if(u==="vertical"){var Ce=P.scale,Fe=q+l,Ge=Fe+f,Ve=Fe-f,Ze=Ce(H-ae),nt=Ce(H+ue);Q.push({x1:nt,y1:Ge,x2:nt,y2:Ve}),Q.push({x1:Ze,y1:Fe,x2:nt,y2:Fe}),Q.push({x1:Ze,y1:Ge,x2:Ze,y2:Ve})}else if(u==="horizontal"){var dt=C.scale,rt=U+l,at=rt-f,qe=rt+f,He=dt(H-ae),Et=dt(H+ue);Q.push({x1:at,y1:Et,x2:qe,y2:Et}),Q.push({x1:rt,y1:He,x2:rt,y2:Et}),Q.push({x1:at,y1:He,x2:qe,y2:He})}return De.createElement(Xi,MI({className:"recharts-errorBar",key:"bar-".concat(Q.map(function(Gt){return"".concat(Gt.x1,"-").concat(Gt.x2,"-").concat(Gt.y1,"-").concat(Gt.y2)}))},L),Q.map(function(Gt){return De.createElement("line",MI({},Gt,{key:"line-".concat(Gt.x1,"-").concat(Gt.x2,"-").concat(Gt.y1,"-").concat(Gt.y2)}))}))});return De.createElement(Xi,{className:"recharts-errorBars"},$)}}])}(De.Component);ole(Gk,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});ole(Gk,"displayName","ErrorBar");function iT(e){"@babel/helpers - typeof";return iT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iT(e)}function W7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function hg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?W7(Object(r),!0).forEach(function(n){$qe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $qe(e,t,r){return t=Vqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Vqe(e){var t=Uqe(e,"string");return iT(t)=="symbol"?t:t+""}function Uqe(e,t){if(iT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(iT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ale=function(t){var r=t.children,n=t.formattedGraphicalItems,l=t.legendWidth,u=t.legendContent,f=rc(r,r0);if(!f)return null;var o=r0.defaultProps,v=o!==void 0?hg(hg({},o),f.props):{},w;return f.props&&f.props.payload?w=f.props&&f.props.payload:u==="children"?w=(n||[]).reduce(function(P,C){var k=C.item,L=C.props,$=L.sectors||L.data||[];return P.concat($.map(function(j){return{type:f.props.iconType||k.props.legendType,value:j.name,color:j.fill,payload:j}}))},[]):w=(n||[]).map(function(P){var C=P.item,k=C.type.defaultProps,L=k!==void 0?hg(hg({},k),C.props):{},$=L.dataKey,j=L.name,B=L.legendType,U=L.hide;return{inactive:U,dataKey:$,type:v.iconType||B||"square",color:R4(C),value:j||$,payload:L}}),hg(hg(hg({},v),r0.getWithHeight(f,l)),{},{payload:w,item:f})};function oT(e){"@babel/helpers - typeof";return oT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oT(e)}function Z7(e){return Wqe(e)||Hqe(e)||qqe(e)||Gqe()}function Gqe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qqe(e,t){if(e){if(typeof e=="string")return lF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lF(e,t)}}function Hqe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Wqe(e){if(Array.isArray(e))return lF(e)}function lF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function X7(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function os(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X7(Object(r),!0).forEach(function(n){i0(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X7(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i0(e,t,r){return t=Zqe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zqe(e){var t=Xqe(e,"string");return oT(t)=="symbol"?t:t+""}function Xqe(e,t){if(oT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(oT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Va(e,t,r){return oi(e)||oi(t)?r:Us(t)?dc(e,t,r):Rn(t)?t(e):r}function J1(e,t,r,n){var l=HGe(e,function(o){return Va(o,t)});if(r==="number"){var u=l.filter(function(o){return fr(o)||parseFloat(o)});return u.length?[Bk(u),Fk(u)]:[1/0,-1/0]}var f=n?l.filter(function(o){return!oi(o)}):l;return f.map(function(o){return Us(o)||o instanceof Date?o:""})}var Kqe=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],l=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,f=-1,o=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(o<=1)return 0;if(u&&u.axisType==="angleAxis"&&Math.abs(Math.abs(u.range[1]-u.range[0])-360)<=1e-6)for(var v=u.range,w=0;w<o;w++){var P=w>0?l[w-1].coordinate:l[o-1].coordinate,C=l[w].coordinate,k=w>=o-1?l[0].coordinate:l[w+1].coordinate,L=void 0;if(gl(C-P)!==gl(k-C)){var $=[];if(gl(k-C)===gl(v[1]-v[0])){L=k;var j=C+v[1]-v[0];$[0]=Math.min(j,(j+P)/2),$[1]=Math.max(j,(j+P)/2)}else{L=P;var B=k+v[1]-v[0];$[0]=Math.min(C,(B+C)/2),$[1]=Math.max(C,(B+C)/2)}var U=[Math.min(C,(L+C)/2),Math.max(C,(L+C)/2)];if(t>U[0]&&t<=U[1]||t>=$[0]&&t<=$[1]){f=l[w].index;break}}else{var q=Math.min(P,k),H=Math.max(P,k);if(t>(q+C)/2&&t<=(H+C)/2){f=l[w].index;break}}}else for(var te=0;te<o;te++)if(te===0&&t<=(n[te].coordinate+n[te+1].coordinate)/2||te>0&&te<o-1&&t>(n[te].coordinate+n[te-1].coordinate)/2&&t<=(n[te].coordinate+n[te+1].coordinate)/2||te===o-1&&t>(n[te].coordinate+n[te-1].coordinate)/2){f=n[te].index;break}return f},R4=function(t){var r,n=t,l=n.type.displayName,u=(r=t.type)!==null&&r!==void 0&&r.defaultProps?os(os({},t.type.defaultProps),t.props):t.props,f=u.stroke,o=u.fill,v;switch(l){case"Line":v=f;break;case"Area":case"Radar":v=f&&f!=="none"?f:o;break;default:v=o;break}return v},Yqe=function(t){var r=t.barSize,n=t.totalSize,l=t.stackGroups,u=l===void 0?{}:l;if(!u)return{};for(var f={},o=Object.keys(u),v=0,w=o.length;v<w;v++)for(var P=u[o[v]].stackGroups,C=Object.keys(P),k=0,L=C.length;k<L;k++){var $=P[C[k]],j=$.items,B=$.cateAxisId,U=j.filter(function(ue){return Bh(ue.type).indexOf("Bar")>=0});if(U&&U.length){var q=U[0].type.defaultProps,H=q!==void 0?os(os({},q),U[0].props):U[0].props,te=H.barSize,Q=H[B];f[Q]||(f[Q]=[]);var ae=oi(te)?r:te;f[Q].push({item:U[0],stackList:U.slice(1),barSize:oi(ae)?void 0:yl(ae,n,0)})}}return f},Jqe=function(t){var r=t.barGap,n=t.barCategoryGap,l=t.bandSize,u=t.sizeList,f=u===void 0?[]:u,o=t.maxBarSize,v=f.length;if(v<1)return null;var w=yl(r,l,0,!0),P,C=[];if(f[0].barSize===+f[0].barSize){var k=!1,L=l/v,$=f.reduce(function(te,Q){return te+Q.barSize||0},0);$+=(v-1)*w,$>=l&&($-=(v-1)*w,w=0),$>=l&&L>0&&(k=!0,L*=.9,$=v*L);var j=(l-$)/2>>0,B={offset:j-w,size:0};P=f.reduce(function(te,Q){var ae={item:Q.item,position:{offset:B.offset+B.size+w,size:k?L:Q.barSize}},ue=[].concat(Z7(te),[ae]);return B=ue[ue.length-1].position,Q.stackList&&Q.stackList.length&&Q.stackList.forEach(function(me){ue.push({item:me,position:B})}),ue},C)}else{var U=yl(n,l,0,!0);l-2*U-(v-1)*w<=0&&(w=0);var q=(l-2*U-(v-1)*w)/v;q>1&&(q>>=0);var H=o===+o?Math.min(q,o):q;P=f.reduce(function(te,Q,ae){var ue=[].concat(Z7(te),[{item:Q.item,position:{offset:U+(q+w)*ae+(q-H)/2,size:H}}]);return Q.stackList&&Q.stackList.length&&Q.stackList.forEach(function(me){ue.push({item:me,position:ue[ue.length-1].position})}),ue},C)}return P},Qqe=function(t,r,n,l){var u=n.children,f=n.width,o=n.margin,v=f-(o.left||0)-(o.right||0),w=ale({children:u,legendWidth:v});if(w){var P=l||{},C=P.width,k=P.height,L=w.align,$=w.verticalAlign,j=w.layout;if((j==="vertical"||j==="horizontal"&&$==="middle")&&L!=="center"&&fr(t[L]))return os(os({},t),{},i0({},L,t[L]+(C||0)));if((j==="horizontal"||j==="vertical"&&L==="center")&&$!=="middle"&&fr(t[$]))return os(os({},t),{},i0({},$,t[$]+(k||0)))}return t},eHe=function(t,r,n){return oi(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},lle=function(t,r,n,l,u){var f=r.props.children,o=Kc(f,Gk).filter(function(w){return eHe(l,u,w.props.direction)});if(o&&o.length){var v=o.map(function(w){return w.props.dataKey});return t.reduce(function(w,P){var C=Va(P,n);if(oi(C))return w;var k=Array.isArray(C)?[Bk(C),Fk(C)]:[C,C],L=v.reduce(function($,j){var B=Va(P,j,0),U=k[0]-Math.abs(Array.isArray(B)?B[0]:B),q=k[1]+Math.abs(Array.isArray(B)?B[1]:B);return[Math.min(U,$[0]),Math.max(q,$[1])]},[1/0,-1/0]);return[Math.min(L[0],w[0]),Math.max(L[1],w[1])]},[1/0,-1/0])}return null},tHe=function(t,r,n,l,u){var f=r.map(function(o){return lle(t,o,n,u,l)}).filter(function(o){return!oi(o)});return f&&f.length?f.reduce(function(o,v){return[Math.min(o[0],v[0]),Math.max(o[1],v[1])]},[1/0,-1/0]):null},cle=function(t,r,n,l,u){var f=r.map(function(v){var w=v.props.dataKey;return n==="number"&&w&&lle(t,v,w,l)||J1(t,w,n,u)});if(n==="number")return f.reduce(function(v,w){return[Math.min(v[0],w[0]),Math.max(v[1],w[1])]},[1/0,-1/0]);var o={};return f.reduce(function(v,w){for(var P=0,C=w.length;P<C;P++)o[w[P]]||(o[w[P]]=!0,v.push(w[P]));return v},[])},ule=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},dle=function(t,r,n,l){if(l)return t.map(function(v){return v.coordinate});var u,f,o=t.map(function(v){return v.coordinate===r&&(u=!0),v.coordinate===n&&(f=!0),v.coordinate});return u||o.push(r),f||o.push(n),o},zh=function(t,r,n){if(!t)return null;var l=t.scale,u=t.duplicateDomain,f=t.type,o=t.range,v=t.realScaleType==="scaleBand"?l.bandwidth()/2:2,w=(r||n)&&f==="category"&&l.bandwidth?l.bandwidth()/v:0;if(w=t.axisType==="angleAxis"&&(o==null?void 0:o.length)>=2?gl(o[0]-o[1])*2*w:w,r&&(t.ticks||t.niceTicks)){var P=(t.ticks||t.niceTicks).map(function(C){var k=u?u.indexOf(C):C;return{coordinate:l(k)+w,value:C,offset:w}});return P.filter(function(C){return!iE(C.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(C,k){return{coordinate:l(C)+w,value:C,index:k,offset:w}}):l.ticks&&!n?l.ticks(t.tickCount).map(function(C){return{coordinate:l(C)+w,value:C,offset:w}}):l.domain().map(function(C,k){return{coordinate:l(C)+w,value:u?u[C]:C,index:k,offset:w}})},XL=new WeakMap,TP=function(t,r){if(typeof r!="function")return t;XL.has(t)||XL.set(t,new WeakMap);var n=XL.get(t);if(n.has(r))return n.get(r);var l=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,l),l},hle=function(t,r,n){var l=t.scale,u=t.type,f=t.layout,o=t.axisType;if(l==="auto")return f==="radial"&&o==="radiusAxis"?{scale:YS(),realScaleType:"band"}:f==="radial"&&o==="angleAxis"?{scale:CI(),realScaleType:"linear"}:u==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Y1(),realScaleType:"point"}:u==="category"?{scale:YS(),realScaleType:"band"}:{scale:CI(),realScaleType:"linear"};if(hy(l)){var v="scale".concat(Tk(l));return{scale:(V7[v]||Y1)(),realScaleType:V7[v]?v:"point"}}return Rn(l)?{scale:l}:{scale:Y1(),realScaleType:"point"}},K7=1e-4,fle=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,l=t.range(),u=Math.min(l[0],l[1])-K7,f=Math.max(l[0],l[1])+K7,o=t(r[0]),v=t(r[n-1]);(o<u||o>f||v<u||v>f)&&t.domain([r[0],r[n-1]])}},rHe=function(t,r){if(!t)return null;for(var n=0,l=t.length;n<l;n++)if(t[n].item===r)return t[n].position;return null},nHe=function(t,r){if(!r||r.length!==2||!fr(r[0])||!fr(r[1]))return t;var n=Math.min(r[0],r[1]),l=Math.max(r[0],r[1]),u=[t[0],t[1]];return(!fr(t[0])||t[0]<n)&&(u[0]=n),(!fr(t[1])||t[1]>l)&&(u[1]=l),u[0]>l&&(u[0]=l),u[1]<n&&(u[1]=n),u},iHe=function(t){var r=t.length;if(!(r<=0))for(var n=0,l=t[0].length;n<l;++n)for(var u=0,f=0,o=0;o<r;++o){var v=iE(t[o][n][1])?t[o][n][0]:t[o][n][1];v>=0?(t[o][n][0]=u,t[o][n][1]=u+v,u=t[o][n][1]):(t[o][n][0]=f,t[o][n][1]=f+v,f=t[o][n][1])}},oHe=function(t){var r=t.length;if(!(r<=0))for(var n=0,l=t[0].length;n<l;++n)for(var u=0,f=0;f<r;++f){var o=iE(t[f][n][1])?t[f][n][0]:t[f][n][1];o>=0?(t[f][n][0]=u,t[f][n][1]=u+o,u=t[f][n][1]):(t[f][n][0]=0,t[f][n][1]=0)}},sHe={sign:iHe,expand:ENe,none:z0,silhouette:ANe,wiggle:PNe,positive:oHe},aHe=function(t,r,n){var l=r.map(function(o){return o.props.dataKey}),u=sHe[n],f=TNe().keys(l).value(function(o,v){return+Va(o,v,0)}).order(Mz).offset(u);return f(t)},lHe=function(t,r,n,l,u,f){if(!t)return null;var o=f?r.reverse():r,v={},w=o.reduce(function(C,k){var L,$=(L=k.type)!==null&&L!==void 0&&L.defaultProps?os(os({},k.type.defaultProps),k.props):k.props,j=$.stackId,B=$.hide;if(B)return C;var U=$[n],q=C[U]||{hasStack:!1,stackGroups:{}};if(Us(j)){var H=q.stackGroups[j]||{numericAxisId:n,cateAxisId:l,items:[]};H.items.push(k),q.hasStack=!0,q.stackGroups[j]=H}else q.stackGroups[oE("_stackId_")]={numericAxisId:n,cateAxisId:l,items:[k]};return os(os({},C),{},i0({},U,q))},v),P={};return Object.keys(w).reduce(function(C,k){var L=w[k];if(L.hasStack){var $={};L.stackGroups=Object.keys(L.stackGroups).reduce(function(j,B){var U=L.stackGroups[B];return os(os({},j),{},i0({},B,{numericAxisId:n,cateAxisId:l,items:U.items,stackedData:aHe(t,U.items,u)}))},$)}return os(os({},C),{},i0({},k,L))},P)},ple=function(t,r){var n=r.realScaleType,l=r.type,u=r.tickCount,f=r.originalDomain,o=r.allowDecimals,v=n||r.scale;if(v!=="auto"&&v!=="linear")return null;if(u&&l==="number"&&f&&(f[0]==="auto"||f[1]==="auto")){var w=t.domain();if(!w.length)return null;var P=wqe(w,u,o);return t.domain([Bk(P),Fk(P)]),{niceTicks:P}}if(u&&l==="number"){var C=t.domain(),k=Sqe(C,u,o);return{niceTicks:k}}return null},Y7=function(t){var r=t.axis,n=t.ticks,l=t.offset,u=t.bandSize,f=t.entry,o=t.index;if(r.type==="category")return n[o]?n[o].coordinate+l:null;var v=Va(f,r.dataKey,r.domain[o]);return oi(v)?null:r.scale(v)-u/2+l},cHe=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var l=Math.min(n[0],n[1]),u=Math.max(n[0],n[1]);return l<=0&&u>=0?0:u<0?u:l}return n[0]},uHe=function(t,r){var n,l=(n=t.type)!==null&&n!==void 0&&n.defaultProps?os(os({},t.type.defaultProps),t.props):t.props,u=l.stackId;if(Us(u)){var f=r[u];if(f){var o=f.items.indexOf(t);return o>=0?f.stackedData[o]:null}}return null},dHe=function(t){return t.reduce(function(r,n){return[Bk(n.concat([r[0]]).filter(fr)),Fk(n.concat([r[1]]).filter(fr))]},[1/0,-1/0])},mle=function(t,r,n){return Object.keys(t).reduce(function(l,u){var f=t[u],o=f.stackedData,v=o.reduce(function(w,P){var C=dHe(P.slice(r,n+1));return[Math.min(w[0],C[0]),Math.max(w[1],C[1])]},[1/0,-1/0]);return[Math.min(v[0],l[0]),Math.max(v[1],l[1])]},[1/0,-1/0]).map(function(l){return l===1/0||l===-1/0?0:l})},J7=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Q7=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,cF=function(t,r,n){if(Rn(t))return t(r,n);if(!Array.isArray(t))return r;var l=[];if(fr(t[0]))l[0]=n?t[0]:Math.min(t[0],r[0]);else if(J7.test(t[0])){var u=+J7.exec(t[0])[1];l[0]=r[0]-u}else Rn(t[0])?l[0]=t[0](r[0]):l[0]=r[0];if(fr(t[1]))l[1]=n?t[1]:Math.max(t[1],r[1]);else if(Q7.test(t[1])){var f=+Q7.exec(t[1])[1];l[1]=r[1]+f}else Rn(t[1])?l[1]=t[1](r[1]):l[1]=r[1];return l},LI=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var l=t.scale.bandwidth();if(!n||l>0)return l}if(t&&r&&r.length>=2){for(var u=s4(r,function(C){return C.coordinate}),f=1/0,o=1,v=u.length;o<v;o++){var w=u[o],P=u[o-1];f=Math.min((w.coordinate||0)-(P.coordinate||0),f)}return f===1/0?0:f}return n?void 0:0},eZ=function(t,r,n){return!t||!t.length||$k(t,dc(n,"type.defaultProps.domain"))?r:t},gle=function(t,r){var n=t.type.defaultProps?os(os({},t.type.defaultProps),t.props):t.props,l=n.dataKey,u=n.name,f=n.unit,o=n.formatter,v=n.tooltipType,w=n.chartType,P=n.hide;return os(os({},Pn(t,!1)),{},{dataKey:l,unit:f,formatter:o,name:u||l,color:R4(t),value:Va(r,l),type:v,payload:r,chartType:w,hide:P})};function sT(e){"@babel/helpers - typeof";return sT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sT(e)}function tZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Ah(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tZ(Object(r),!0).forEach(function(n){yle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yle(e,t,r){return t=hHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hHe(e){var t=fHe(e,"string");return sT(t)=="symbol"?t:t+""}function fHe(e,t){if(sT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(sT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function pHe(e,t){return _He(e)||yHe(e,t)||gHe(e,t)||mHe()}function mHe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gHe(e,t){if(e){if(typeof e=="string")return rZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rZ(e,t)}}function rZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function yHe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function _He(e){if(Array.isArray(e))return e}var jI=Math.PI/180,vHe=function(t){return t*180/Math.PI},uo=function(t,r,n,l){return{x:t+Math.cos(-jI*l)*n,y:r+Math.sin(-jI*l)*n}},_le=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(n.left||0)-(n.right||0)),Math.abs(r-(n.top||0)-(n.bottom||0)))/2},xHe=function(t,r,n,l,u){var f=t.width,o=t.height,v=t.startAngle,w=t.endAngle,P=yl(t.cx,f,f/2),C=yl(t.cy,o,o/2),k=_le(f,o,n),L=yl(t.innerRadius,k,0),$=yl(t.outerRadius,k,k*.8),j=Object.keys(r);return j.reduce(function(B,U){var q=r[U],H=q.domain,te=q.reversed,Q;if(oi(q.range))l==="angleAxis"?Q=[v,w]:l==="radiusAxis"&&(Q=[L,$]),te&&(Q=[Q[1],Q[0]]);else{Q=q.range;var ae=Q,ue=pHe(ae,2);v=ue[0],w=ue[1]}var me=hle(q,u),Ce=me.realScaleType,Fe=me.scale;Fe.domain(H).range(Q),fle(Fe);var Ge=ple(Fe,Ah(Ah({},q),{},{realScaleType:Ce})),Ve=Ah(Ah(Ah({},q),Ge),{},{range:Q,radius:$,realScaleType:Ce,scale:Fe,cx:P,cy:C,innerRadius:L,outerRadius:$,startAngle:v,endAngle:w});return Ah(Ah({},B),{},yle({},U,Ve))},{})},bHe=function(t,r){var n=t.x,l=t.y,u=r.x,f=r.y;return Math.sqrt(Math.pow(n-u,2)+Math.pow(l-f,2))},wHe=function(t,r){var n=t.x,l=t.y,u=r.cx,f=r.cy,o=bHe({x:n,y:l},{x:u,y:f});if(o<=0)return{radius:o};var v=(n-u)/o,w=Math.acos(v);return l>f&&(w=2*Math.PI-w),{radius:o,angle:vHe(w),angleInRadian:w}},SHe=function(t){var r=t.startAngle,n=t.endAngle,l=Math.floor(r/360),u=Math.floor(n/360),f=Math.min(l,u);return{startAngle:r-f*360,endAngle:n-f*360}},THe=function(t,r){var n=r.startAngle,l=r.endAngle,u=Math.floor(n/360),f=Math.floor(l/360),o=Math.min(u,f);return t+o*360},nZ=function(t,r){var n=t.x,l=t.y,u=wHe({x:n,y:l},r),f=u.radius,o=u.angle,v=r.innerRadius,w=r.outerRadius;if(f<v||f>w)return!1;if(f===0)return!0;var P=SHe(r),C=P.startAngle,k=P.endAngle,L=o,$;if(C<=k){for(;L>k;)L-=360;for(;L<C;)L+=360;$=L>=C&&L<=k}else{for(;L>C;)L-=360;for(;L<k;)L+=360;$=L>=k&&L<=C}return $?Ah(Ah({},r),{},{radius:f,angle:THe(L,r)}):null},vle=function(t){return!X.isValidElement(t)&&!Rn(t)&&typeof t!="boolean"?t.className:""};function aT(e){"@babel/helpers - typeof";return aT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},aT(e)}var EHe=["offset"];function AHe(e){return OHe(e)||IHe(e)||CHe(e)||PHe()}function PHe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CHe(e,t){if(e){if(typeof e=="string")return uF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uF(e,t)}}function IHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function OHe(e){if(Array.isArray(e))return uF(e)}function uF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function kHe(e,t){if(e==null)return{};var r=RHe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function RHe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function iZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function js(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iZ(Object(r),!0).forEach(function(n){MHe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function MHe(e,t,r){return t=DHe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DHe(e){var t=LHe(e,"string");return aT(t)=="symbol"?t:t+""}function LHe(e,t){if(aT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(aT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function lT(){return lT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lT.apply(this,arguments)}var jHe=function(t){var r=t.value,n=t.formatter,l=oi(t.children)?r:t.children;return Rn(n)?n(l):l},NHe=function(t,r){var n=gl(r-t),l=Math.min(Math.abs(r-t),360);return n*l},zHe=function(t,r,n){var l=t.position,u=t.viewBox,f=t.offset,o=t.className,v=u,w=v.cx,P=v.cy,C=v.innerRadius,k=v.outerRadius,L=v.startAngle,$=v.endAngle,j=v.clockWise,B=(C+k)/2,U=NHe(L,$),q=U>=0?1:-1,H,te;l==="insideStart"?(H=L+q*f,te=j):l==="insideEnd"?(H=$-q*f,te=!j):l==="end"&&(H=$+q*f,te=j),te=U<=0?te:!te;var Q=uo(w,P,B,H),ae=uo(w,P,B,H+(te?1:-1)*359),ue="M".concat(Q.x,",").concat(Q.y,`
    A`).concat(B,",").concat(B,",0,1,").concat(te?0:1,`,
    `).concat(ae.x,",").concat(ae.y),me=oi(t.id)?oE("recharts-radial-line-"):t.id;return De.createElement("text",lT({},n,{dominantBaseline:"central",className:Gn("recharts-radial-bar-label",o)}),De.createElement("defs",null,De.createElement("path",{id:me,d:ue})),De.createElement("textPath",{xlinkHref:"#".concat(me)},r))},FHe=function(t){var r=t.viewBox,n=t.offset,l=t.position,u=r,f=u.cx,o=u.cy,v=u.innerRadius,w=u.outerRadius,P=u.startAngle,C=u.endAngle,k=(P+C)/2;if(l==="outside"){var L=uo(f,o,w+n,k),$=L.x,j=L.y;return{x:$,y:j,textAnchor:$>=f?"start":"end",verticalAnchor:"middle"}}if(l==="center")return{x:f,y:o,textAnchor:"middle",verticalAnchor:"middle"};if(l==="centerTop")return{x:f,y:o,textAnchor:"middle",verticalAnchor:"start"};if(l==="centerBottom")return{x:f,y:o,textAnchor:"middle",verticalAnchor:"end"};var B=(v+w)/2,U=uo(f,o,B,k),q=U.x,H=U.y;return{x:q,y:H,textAnchor:"middle",verticalAnchor:"middle"}},BHe=function(t){var r=t.viewBox,n=t.parentViewBox,l=t.offset,u=t.position,f=r,o=f.x,v=f.y,w=f.width,P=f.height,C=P>=0?1:-1,k=C*l,L=C>0?"end":"start",$=C>0?"start":"end",j=w>=0?1:-1,B=j*l,U=j>0?"end":"start",q=j>0?"start":"end";if(u==="top"){var H={x:o+w/2,y:v-C*l,textAnchor:"middle",verticalAnchor:L};return js(js({},H),n?{height:Math.max(v-n.y,0),width:w}:{})}if(u==="bottom"){var te={x:o+w/2,y:v+P+k,textAnchor:"middle",verticalAnchor:$};return js(js({},te),n?{height:Math.max(n.y+n.height-(v+P),0),width:w}:{})}if(u==="left"){var Q={x:o-B,y:v+P/2,textAnchor:U,verticalAnchor:"middle"};return js(js({},Q),n?{width:Math.max(Q.x-n.x,0),height:P}:{})}if(u==="right"){var ae={x:o+w+B,y:v+P/2,textAnchor:q,verticalAnchor:"middle"};return js(js({},ae),n?{width:Math.max(n.x+n.width-ae.x,0),height:P}:{})}var ue=n?{width:w,height:P}:{};return u==="insideLeft"?js({x:o+B,y:v+P/2,textAnchor:q,verticalAnchor:"middle"},ue):u==="insideRight"?js({x:o+w-B,y:v+P/2,textAnchor:U,verticalAnchor:"middle"},ue):u==="insideTop"?js({x:o+w/2,y:v+k,textAnchor:"middle",verticalAnchor:$},ue):u==="insideBottom"?js({x:o+w/2,y:v+P-k,textAnchor:"middle",verticalAnchor:L},ue):u==="insideTopLeft"?js({x:o+B,y:v+k,textAnchor:q,verticalAnchor:$},ue):u==="insideTopRight"?js({x:o+w-B,y:v+k,textAnchor:U,verticalAnchor:$},ue):u==="insideBottomLeft"?js({x:o+B,y:v+P-k,textAnchor:q,verticalAnchor:L},ue):u==="insideBottomRight"?js({x:o+w-B,y:v+P-k,textAnchor:U,verticalAnchor:L},ue):Tx(u)&&(fr(u.x)||Rg(u.x))&&(fr(u.y)||Rg(u.y))?js({x:o+yl(u.x,w),y:v+yl(u.y,P),textAnchor:"end",verticalAnchor:"end"},ue):js({x:o+w/2,y:v+P/2,textAnchor:"middle",verticalAnchor:"middle"},ue)},$He=function(t){return"cx"in t&&fr(t.cx)};function ia(e){var t=e.offset,r=t===void 0?5:t,n=kHe(e,EHe),l=js({offset:r},n),u=l.viewBox,f=l.position,o=l.value,v=l.children,w=l.content,P=l.className,C=P===void 0?"":P,k=l.textBreakAll;if(!u||oi(o)&&oi(v)&&!X.isValidElement(w)&&!Rn(w))return null;if(X.isValidElement(w))return X.cloneElement(w,l);var L;if(Rn(w)){if(L=X.createElement(w,l),X.isValidElement(L))return L}else L=jHe(l);var $=$He(u),j=Pn(l,!0);if($&&(f==="insideStart"||f==="insideEnd"||f==="end"))return zHe(l,L,j);var B=$?FHe(l):BHe(l);return De.createElement(py,lT({className:Gn("recharts-label",C)},j,B,{breakAll:k}),L)}ia.displayName="Label";var xle=function(t){var r=t.cx,n=t.cy,l=t.angle,u=t.startAngle,f=t.endAngle,o=t.r,v=t.radius,w=t.innerRadius,P=t.outerRadius,C=t.x,k=t.y,L=t.top,$=t.left,j=t.width,B=t.height,U=t.clockWise,q=t.labelViewBox;if(q)return q;if(fr(j)&&fr(B)){if(fr(C)&&fr(k))return{x:C,y:k,width:j,height:B};if(fr(L)&&fr($))return{x:L,y:$,width:j,height:B}}return fr(C)&&fr(k)?{x:C,y:k,width:0,height:0}:fr(r)&&fr(n)?{cx:r,cy:n,startAngle:u||l||0,endAngle:f||l||0,innerRadius:w||0,outerRadius:P||v||o||0,clockWise:U}:t.viewBox?t.viewBox:{}},VHe=function(t,r){return t?t===!0?De.createElement(ia,{key:"label-implicit",viewBox:r}):Us(t)?De.createElement(ia,{key:"label-implicit",viewBox:r,value:t}):X.isValidElement(t)?t.type===ia?X.cloneElement(t,{key:"label-implicit",viewBox:r}):De.createElement(ia,{key:"label-implicit",content:t,viewBox:r}):Rn(t)?De.createElement(ia,{key:"label-implicit",content:t,viewBox:r}):Tx(t)?De.createElement(ia,lT({viewBox:r},t,{key:"label-implicit"})):null:null},UHe=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var l=t.children,u=xle(t),f=Kc(l,ia).map(function(v,w){return X.cloneElement(v,{viewBox:r||u,key:"label-".concat(w)})});if(!n)return f;var o=VHe(t.label,r||u);return[o].concat(AHe(f))};ia.parseViewBox=xle;ia.renderCallByParent=UHe;function GHe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var qHe=GHe;const HHe=zi(qHe);function cT(e){"@babel/helpers - typeof";return cT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cT(e)}var WHe=["valueAccessor"],ZHe=["data","dataKey","clockWise","id","textBreakAll"];function XHe(e){return QHe(e)||JHe(e)||YHe(e)||KHe()}function KHe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function YHe(e,t){if(e){if(typeof e=="string")return dF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dF(e,t)}}function JHe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function QHe(e){if(Array.isArray(e))return dF(e)}function dF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function NI(){return NI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NI.apply(this,arguments)}function oZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function sZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oZ(Object(r),!0).forEach(function(n){eWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eWe(e,t,r){return t=tWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tWe(e){var t=rWe(e,"string");return cT(t)=="symbol"?t:t+""}function rWe(e,t){if(cT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(cT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function aZ(e,t){if(e==null)return{};var r=nWe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function nWe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var iWe=function(t){return Array.isArray(t.value)?HHe(t.value):t.value};function Vp(e){var t=e.valueAccessor,r=t===void 0?iWe:t,n=aZ(e,WHe),l=n.data,u=n.dataKey,f=n.clockWise,o=n.id,v=n.textBreakAll,w=aZ(n,ZHe);return!l||!l.length?null:De.createElement(Xi,{className:"recharts-label-list"},l.map(function(P,C){var k=oi(u)?r(P,C):Va(P&&P.payload,u),L=oi(o)?{}:{id:"".concat(o,"-").concat(C)};return De.createElement(ia,NI({},Pn(P,!0),w,L,{parentViewBox:P.parentViewBox,value:k,textBreakAll:v,viewBox:ia.parseViewBox(oi(f)?P:sZ(sZ({},P),{},{clockWise:f})),key:"label-".concat(C),index:C}))}))}Vp.displayName="LabelList";function oWe(e,t){return e?e===!0?De.createElement(Vp,{key:"labelList-implicit",data:t}):De.isValidElement(e)||Rn(e)?De.createElement(Vp,{key:"labelList-implicit",data:t,content:e}):Tx(e)?De.createElement(Vp,NI({data:t},e,{key:"labelList-implicit"})):null:null}function sWe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,l=Kc(n,Vp).map(function(f,o){return X.cloneElement(f,{data:t,key:"labelList-".concat(o)})});if(!r)return l;var u=oWe(e.label,t);return[u].concat(XHe(l))}Vp.renderCallByParent=sWe;function uT(e){"@babel/helpers - typeof";return uT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uT(e)}function hF(){return hF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hF.apply(this,arguments)}function lZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function cZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lZ(Object(r),!0).forEach(function(n){aWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aWe(e,t,r){return t=lWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lWe(e){var t=cWe(e,"string");return uT(t)=="symbol"?t:t+""}function cWe(e,t){if(uT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(uT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var uWe=function(t,r){var n=gl(r-t),l=Math.min(Math.abs(r-t),359.999);return n*l},EP=function(t){var r=t.cx,n=t.cy,l=t.radius,u=t.angle,f=t.sign,o=t.isExternal,v=t.cornerRadius,w=t.cornerIsExternal,P=v*(o?1:-1)+l,C=Math.asin(v/P)/jI,k=w?u:u+f*C,L=uo(r,n,P,k),$=uo(r,n,l,k),j=w?u-f*C:u,B=uo(r,n,P*Math.cos(C*jI),j);return{center:L,circleTangency:$,lineTangency:B,theta:C}},ble=function(t){var r=t.cx,n=t.cy,l=t.innerRadius,u=t.outerRadius,f=t.startAngle,o=t.endAngle,v=uWe(f,o),w=f+v,P=uo(r,n,u,f),C=uo(r,n,u,w),k="M ".concat(P.x,",").concat(P.y,`
    A `).concat(u,",").concat(u,`,0,
    `).concat(+(Math.abs(v)>180),",").concat(+(f>w),`,
    `).concat(C.x,",").concat(C.y,`
  `);if(l>0){var L=uo(r,n,l,f),$=uo(r,n,l,w);k+="L ".concat($.x,",").concat($.y,`
            A `).concat(l,",").concat(l,`,0,
            `).concat(+(Math.abs(v)>180),",").concat(+(f<=w),`,
            `).concat(L.x,",").concat(L.y," Z")}else k+="L ".concat(r,",").concat(n," Z");return k},dWe=function(t){var r=t.cx,n=t.cy,l=t.innerRadius,u=t.outerRadius,f=t.cornerRadius,o=t.forceCornerRadius,v=t.cornerIsExternal,w=t.startAngle,P=t.endAngle,C=gl(P-w),k=EP({cx:r,cy:n,radius:u,angle:w,sign:C,cornerRadius:f,cornerIsExternal:v}),L=k.circleTangency,$=k.lineTangency,j=k.theta,B=EP({cx:r,cy:n,radius:u,angle:P,sign:-C,cornerRadius:f,cornerIsExternal:v}),U=B.circleTangency,q=B.lineTangency,H=B.theta,te=v?Math.abs(w-P):Math.abs(w-P)-j-H;if(te<0)return o?"M ".concat($.x,",").concat($.y,`
        a`).concat(f,",").concat(f,",0,0,1,").concat(f*2,`,0
        a`).concat(f,",").concat(f,",0,0,1,").concat(-f*2,`,0
      `):ble({cx:r,cy:n,innerRadius:l,outerRadius:u,startAngle:w,endAngle:P});var Q="M ".concat($.x,",").concat($.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(C<0),",").concat(L.x,",").concat(L.y,`
    A`).concat(u,",").concat(u,",0,").concat(+(te>180),",").concat(+(C<0),",").concat(U.x,",").concat(U.y,`
    A`).concat(f,",").concat(f,",0,0,").concat(+(C<0),",").concat(q.x,",").concat(q.y,`
  `);if(l>0){var ae=EP({cx:r,cy:n,radius:l,angle:w,sign:C,isExternal:!0,cornerRadius:f,cornerIsExternal:v}),ue=ae.circleTangency,me=ae.lineTangency,Ce=ae.theta,Fe=EP({cx:r,cy:n,radius:l,angle:P,sign:-C,isExternal:!0,cornerRadius:f,cornerIsExternal:v}),Ge=Fe.circleTangency,Ve=Fe.lineTangency,Ze=Fe.theta,nt=v?Math.abs(w-P):Math.abs(w-P)-Ce-Ze;if(nt<0&&f===0)return"".concat(Q,"L").concat(r,",").concat(n,"Z");Q+="L".concat(Ve.x,",").concat(Ve.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(C<0),",").concat(Ge.x,",").concat(Ge.y,`
      A`).concat(l,",").concat(l,",0,").concat(+(nt>180),",").concat(+(C>0),",").concat(ue.x,",").concat(ue.y,`
      A`).concat(f,",").concat(f,",0,0,").concat(+(C<0),",").concat(me.x,",").concat(me.y,"Z")}else Q+="L".concat(r,",").concat(n,"Z");return Q},hWe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},wle=function(t){var r=cZ(cZ({},hWe),t),n=r.cx,l=r.cy,u=r.innerRadius,f=r.outerRadius,o=r.cornerRadius,v=r.forceCornerRadius,w=r.cornerIsExternal,P=r.startAngle,C=r.endAngle,k=r.className;if(f<u||P===C)return null;var L=Gn("recharts-sector",k),$=f-u,j=yl(o,$,0,!0),B;return j>0&&Math.abs(P-C)<360?B=dWe({cx:n,cy:l,innerRadius:u,outerRadius:f,cornerRadius:Math.min(j,$/2),forceCornerRadius:v,cornerIsExternal:w,startAngle:P,endAngle:C}):B=ble({cx:n,cy:l,innerRadius:u,outerRadius:f,startAngle:P,endAngle:C}),De.createElement("path",hF({},Pn(r,!0),{className:L,d:B,role:"img"}))};function dT(e){"@babel/helpers - typeof";return dT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},dT(e)}function fF(){return fF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fF.apply(this,arguments)}function uZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function dZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uZ(Object(r),!0).forEach(function(n){fWe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fWe(e,t,r){return t=pWe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pWe(e){var t=mWe(e,"string");return dT(t)=="symbol"?t:t+""}function mWe(e,t){if(dT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(dT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hZ={curveBasisClosed:fNe,curveBasisOpen:pNe,curveBasis:hNe,curveBumpX:Jje,curveBumpY:Qje,curveLinearClosed:mNe,curveLinear:Ak,curveMonotoneX:gNe,curveMonotoneY:yNe,curveNatural:_Ne,curveStep:vNe,curveStepAfter:bNe,curveStepBefore:xNe},AP=function(t){return t.x===+t.x&&t.y===+t.y},d1=function(t){return t.x},h1=function(t){return t.y},gWe=function(t,r){if(Rn(t))return t;var n="curve".concat(Tk(t));return(n==="curveMonotone"||n==="curveBump")&&r?hZ["".concat(n).concat(r==="vertical"?"Y":"X")]:hZ[n]||Ak},yWe=function(t){var r=t.type,n=r===void 0?"linear":r,l=t.points,u=l===void 0?[]:l,f=t.baseLine,o=t.layout,v=t.connectNulls,w=v===void 0?!1:v,P=gWe(n,o),C=w?u.filter(function(j){return AP(j)}):u,k;if(Array.isArray(f)){var L=w?f.filter(function(j){return AP(j)}):f,$=C.map(function(j,B){return dZ(dZ({},j),{},{base:L[B]})});return o==="vertical"?k=gP().y(h1).x1(d1).x0(function(j){return j.base.x}):k=gP().x(d1).y1(h1).y0(function(j){return j.base.y}),k.defined(AP).curve(P),k($)}return o==="vertical"&&fr(f)?k=gP().y(h1).x1(d1).x0(f):fr(f)?k=gP().x(d1).y1(h1).y0(f):k=gse().x(d1).y(h1),k.defined(AP).curve(P),k(C)},pF=function(t){var r=t.className,n=t.points,l=t.path,u=t.pathRef;if((!n||!n.length)&&!l)return null;var f=n&&n.length?yWe(t):l;return X.createElement("path",fF({},Pn(t,!1),lI(t),{className:Gn("recharts-curve",r),d:f,ref:u}))},Sle={exports:{}},_We="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",vWe=_We,xWe=vWe;function Tle(){}function Ele(){}Ele.resetWarningCache=Tle;var bWe=function(){function e(n,l,u,f,o,v){if(v!==xWe){var w=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw w.name="Invariant Violation",w}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Ele,resetWarningCache:Tle};return r.PropTypes=r,r};Sle.exports=bWe();var wWe=Sle.exports;const Bi=zi(wWe);var SWe=Object.getOwnPropertyNames,TWe=Object.getOwnPropertySymbols,EWe=Object.prototype.hasOwnProperty;function fZ(e,t){return function(n,l,u){return e(n,l,u)&&t(n,l,u)}}function PP(e){return function(r,n,l){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,l);var u=l.cache,f=u.get(r),o=u.get(n);if(f&&o)return f===n&&o===r;u.set(r,n),u.set(n,r);var v=e(r,n,l);return u.delete(r),u.delete(n),v}}function pZ(e){return SWe(e).concat(TWe(e))}var AWe=Object.hasOwn||function(e,t){return EWe.call(e,t)};function Oy(e,t){return e===t||!e&&!t&&e!==e&&t!==t}var PWe="__v",CWe="__o",IWe="_owner",mZ=Object.getOwnPropertyDescriptor,gZ=Object.keys;function OWe(e,t,r){var n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function kWe(e,t){return Oy(e.getTime(),t.getTime())}function RWe(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function MWe(e,t){return e===t}function yZ(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var l=new Array(n),u=e.entries(),f,o,v=0;(f=u.next())&&!f.done;){for(var w=t.entries(),P=!1,C=0;(o=w.next())&&!o.done;){if(l[C]){C++;continue}var k=f.value,L=o.value;if(r.equals(k[0],L[0],v,C,e,t,r)&&r.equals(k[1],L[1],k[0],L[0],e,t,r)){P=l[C]=!0;break}C++}if(!P)return!1;v++}return!0}var DWe=Oy;function LWe(e,t,r){var n=gZ(e),l=n.length;if(gZ(t).length!==l)return!1;for(;l-- >0;)if(!Ale(e,t,r,n[l]))return!1;return!0}function f1(e,t,r){var n=pZ(e),l=n.length;if(pZ(t).length!==l)return!1;for(var u,f,o;l-- >0;)if(u=n[l],!Ale(e,t,r,u)||(f=mZ(e,u),o=mZ(t,u),(f||o)&&(!f||!o||f.configurable!==o.configurable||f.enumerable!==o.enumerable||f.writable!==o.writable)))return!1;return!0}function jWe(e,t){return Oy(e.valueOf(),t.valueOf())}function NWe(e,t){return e.source===t.source&&e.flags===t.flags}function _Z(e,t,r){var n=e.size;if(n!==t.size)return!1;if(!n)return!0;for(var l=new Array(n),u=e.values(),f,o;(f=u.next())&&!f.done;){for(var v=t.values(),w=!1,P=0;(o=v.next())&&!o.done;){if(!l[P]&&r.equals(f.value,o.value,f.value,o.value,e,t,r)){w=l[P]=!0;break}P++}if(!w)return!1}return!0}function zWe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function FWe(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function Ale(e,t,r,n){return(n===IWe||n===CWe||n===PWe)&&(e.$$typeof||t.$$typeof)?!0:AWe(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}var BWe="[object Arguments]",$We="[object Boolean]",VWe="[object Date]",UWe="[object Error]",GWe="[object Map]",qWe="[object Number]",HWe="[object Object]",WWe="[object RegExp]",ZWe="[object Set]",XWe="[object String]",KWe="[object URL]",YWe=Array.isArray,vZ=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,xZ=Object.assign,JWe=Object.prototype.toString.call.bind(Object.prototype.toString);function QWe(e){var t=e.areArraysEqual,r=e.areDatesEqual,n=e.areErrorsEqual,l=e.areFunctionsEqual,u=e.areMapsEqual,f=e.areNumbersEqual,o=e.areObjectsEqual,v=e.arePrimitiveWrappersEqual,w=e.areRegExpsEqual,P=e.areSetsEqual,C=e.areTypedArraysEqual,k=e.areUrlsEqual;return function($,j,B){if($===j)return!0;if($==null||j==null)return!1;var U=typeof $;if(U!==typeof j)return!1;if(U!=="object")return U==="number"?f($,j,B):U==="function"?l($,j,B):!1;var q=$.constructor;if(q!==j.constructor)return!1;if(q===Object)return o($,j,B);if(YWe($))return t($,j,B);if(vZ!=null&&vZ($))return C($,j,B);if(q===Date)return r($,j,B);if(q===RegExp)return w($,j,B);if(q===Map)return u($,j,B);if(q===Set)return P($,j,B);var H=JWe($);return H===VWe?r($,j,B):H===WWe?w($,j,B):H===GWe?u($,j,B):H===ZWe?P($,j,B):H===HWe?typeof $.then!="function"&&typeof j.then!="function"&&o($,j,B):H===KWe?k($,j,B):H===UWe?n($,j,B):H===BWe?o($,j,B):H===$We||H===qWe||H===XWe?v($,j,B):!1}}function e9e(e){var t=e.circular,r=e.createCustomConfig,n=e.strict,l={areArraysEqual:n?f1:OWe,areDatesEqual:kWe,areErrorsEqual:RWe,areFunctionsEqual:MWe,areMapsEqual:n?fZ(yZ,f1):yZ,areNumbersEqual:DWe,areObjectsEqual:n?f1:LWe,arePrimitiveWrappersEqual:jWe,areRegExpsEqual:NWe,areSetsEqual:n?fZ(_Z,f1):_Z,areTypedArraysEqual:n?f1:zWe,areUrlsEqual:FWe};if(r&&(l=xZ({},l,r(l))),t){var u=PP(l.areArraysEqual),f=PP(l.areMapsEqual),o=PP(l.areObjectsEqual),v=PP(l.areSetsEqual);l=xZ({},l,{areArraysEqual:u,areMapsEqual:f,areObjectsEqual:o,areSetsEqual:v})}return l}function t9e(e){return function(t,r,n,l,u,f,o){return e(t,r,o)}}function r9e(e){var t=e.circular,r=e.comparator,n=e.createState,l=e.equals,u=e.strict;if(n)return function(v,w){var P=n(),C=P.cache,k=C===void 0?t?new WeakMap:void 0:C,L=P.meta;return r(v,w,{cache:k,equals:l,meta:L,strict:u})};if(t)return function(v,w){return r(v,w,{cache:new WeakMap,equals:l,meta:void 0,strict:u})};var f={cache:void 0,equals:l,meta:void 0,strict:u};return function(v,w){return r(v,w,f)}}var n9e=cm();cm({strict:!0});cm({circular:!0});cm({circular:!0,strict:!0});cm({createInternalComparator:function(){return Oy}});cm({strict:!0,createInternalComparator:function(){return Oy}});cm({circular:!0,createInternalComparator:function(){return Oy}});cm({circular:!0,createInternalComparator:function(){return Oy},strict:!0});function cm(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,n=e.createInternalComparator,l=e.createState,u=e.strict,f=u===void 0?!1:u,o=e9e(e),v=QWe(o),w=n?n(v):t9e(v);return r9e({circular:r,comparator:v,createState:l,equals:w,strict:f})}function i9e(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function bZ(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function l(u){r<0&&(r=u),u-r>t?(e(u),r=-1):i9e(l)};requestAnimationFrame(n)}function mF(e){"@babel/helpers - typeof";return mF=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mF(e)}function o9e(e){return c9e(e)||l9e(e)||a9e(e)||s9e()}function s9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function a9e(e,t){if(e){if(typeof e=="string")return wZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wZ(e,t)}}function wZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function c9e(e){if(Array.isArray(e))return e}function u9e(){var e={},t=function(){return null},r=!1,n=function l(u){if(!r){if(Array.isArray(u)){if(!u.length)return;var f=u,o=o9e(f),v=o[0],w=o.slice(1);if(typeof v=="number"){bZ(l.bind(null,w),v);return}l(v),bZ(l.bind(null,w));return}mF(u)==="object"&&(e=u,t(e)),typeof u=="function"&&u()}};return{stop:function(){r=!0},start:function(u){r=!1,n(u)},subscribe:function(u){return t=u,function(){t=function(){return null}}}}}function hT(e){"@babel/helpers - typeof";return hT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hT(e)}function SZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function TZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SZ(Object(r),!0).forEach(function(n){Ple(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ple(e,t,r){return t=d9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d9e(e){var t=h9e(e,"string");return hT(t)==="symbol"?t:String(t)}function h9e(e,t){if(hT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(hT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var f9e=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,l){return n.filter(function(u){return l.includes(u)})})},p9e=function(t){return t},m9e=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Q1=function(t,r){return Object.keys(r).reduce(function(n,l){return TZ(TZ({},n),{},Ple({},l,t(l,r[l])))},{})},EZ=function(t,r,n){return t.map(function(l){return"".concat(m9e(l)," ").concat(r,"ms ").concat(n)}).join(",")};function g9e(e,t){return v9e(e)||_9e(e,t)||Cle(e,t)||y9e()}function y9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function v9e(e){if(Array.isArray(e))return e}function x9e(e){return S9e(e)||w9e(e)||Cle(e)||b9e()}function b9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cle(e,t){if(e){if(typeof e=="string")return gF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gF(e,t)}}function w9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function S9e(e){if(Array.isArray(e))return gF(e)}function gF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var zI=1e-4,Ile=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},Ole=function(t,r){return t.map(function(n,l){return n*Math.pow(r,l)}).reduce(function(n,l){return n+l})},AZ=function(t,r){return function(n){var l=Ile(t,r);return Ole(l,n)}},T9e=function(t,r){return function(n){var l=Ile(t,r),u=[].concat(x9e(l.map(function(f,o){return f*o}).slice(1)),[0]);return Ole(u,n)}},PZ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var l=r[0],u=r[1],f=r[2],o=r[3];if(r.length===1)switch(r[0]){case"linear":l=0,u=0,f=1,o=1;break;case"ease":l=.25,u=.1,f=.25,o=1;break;case"ease-in":l=.42,u=0,f=1,o=1;break;case"ease-out":l=.42,u=0,f=.58,o=1;break;case"ease-in-out":l=0,u=0,f=.58,o=1;break;default:{var v=r[0].split("(");if(v[0]==="cubic-bezier"&&v[1].split(")")[0].split(",").length===4){var w=v[1].split(")")[0].split(",").map(function(B){return parseFloat(B)}),P=g9e(w,4);l=P[0],u=P[1],f=P[2],o=P[3]}}}var C=AZ(l,f),k=AZ(u,o),L=T9e(l,f),$=function(U){return U>1?1:U<0?0:U},j=function(U){for(var q=U>1?1:U,H=q,te=0;te<8;++te){var Q=C(H)-q,ae=L(H);if(Math.abs(Q-q)<zI||ae<zI)return k(H);H=$(H-Q/ae)}return k(H)};return j.isStepper=!1,j},E9e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,l=t.damping,u=l===void 0?8:l,f=t.dt,o=f===void 0?17:f,v=function(P,C,k){var L=-(P-C)*n,$=k*u,j=k+(L-$)*o/1e3,B=k*o/1e3+P;return Math.abs(B-C)<zI&&Math.abs(j)<zI?[C,0]:[B,j]};return v.isStepper=!0,v.dt=o,v},A9e=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var l=r[0];if(typeof l=="string")switch(l){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return PZ(l);case"spring":return E9e();default:if(l.split("(")[0]==="cubic-bezier")return PZ(l)}return typeof l=="function"?l:null};function fT(e){"@babel/helpers - typeof";return fT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fT(e)}function CZ(e){return I9e(e)||C9e(e)||kle(e)||P9e()}function P9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function C9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function I9e(e){if(Array.isArray(e))return _F(e)}function IZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ba(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IZ(Object(r),!0).forEach(function(n){yF(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yF(e,t,r){return t=O9e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O9e(e){var t=k9e(e,"string");return fT(t)==="symbol"?t:String(t)}function k9e(e,t){if(fT(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(fT(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function R9e(e,t){return L9e(e)||D9e(e,t)||kle(e,t)||M9e()}function M9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kle(e,t){if(e){if(typeof e=="string")return _F(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _F(e,t)}}function _F(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function D9e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function L9e(e){if(Array.isArray(e))return e}var FI=function(t,r,n){return t+(r-t)*n},vF=function(t){var r=t.from,n=t.to;return r!==n},j9e=function e(t,r,n){var l=Q1(function(u,f){if(vF(f)){var o=t(f.from,f.to,f.velocity),v=R9e(o,2),w=v[0],P=v[1];return ba(ba({},f),{},{from:w,velocity:P})}return f},r);return n<1?Q1(function(u,f){return vF(f)?ba(ba({},f),{},{velocity:FI(f.velocity,l[u].velocity,n),from:FI(f.from,l[u].from,n)}):f},r):e(t,l,n-1)};const N9e=function(e,t,r,n,l){var u=f9e(e,t),f=u.reduce(function(B,U){return ba(ba({},B),{},yF({},U,[e[U],t[U]]))},{}),o=u.reduce(function(B,U){return ba(ba({},B),{},yF({},U,{from:e[U],velocity:0,to:t[U]}))},{}),v=-1,w,P,C=function(){return null},k=function(){return Q1(function(U,q){return q.from},o)},L=function(){return!Object.values(o).filter(vF).length},$=function(U){w||(w=U);var q=U-w,H=q/r.dt;o=j9e(r,o,H),l(ba(ba(ba({},e),t),k())),w=U,L()||(v=requestAnimationFrame(C))},j=function(U){P||(P=U);var q=(U-P)/n,H=Q1(function(Q,ae){return FI.apply(void 0,CZ(ae).concat([r(q)]))},f);if(l(ba(ba(ba({},e),t),H)),q<1)v=requestAnimationFrame(C);else{var te=Q1(function(Q,ae){return FI.apply(void 0,CZ(ae).concat([r(1)]))},f);l(ba(ba(ba({},e),t),te))}};return C=r.isStepper?$:j,function(){return requestAnimationFrame(C),function(){cancelAnimationFrame(v)}}};function W0(e){"@babel/helpers - typeof";return W0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W0(e)}var z9e=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function F9e(e,t){if(e==null)return{};var r=B9e(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function B9e(e,t){if(e==null)return{};var r={},n=Object.keys(e),l,u;for(u=0;u<n.length;u++)l=n[u],!(t.indexOf(l)>=0)&&(r[l]=e[l]);return r}function KL(e){return G9e(e)||U9e(e)||V9e(e)||$9e()}function $9e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function V9e(e,t){if(e){if(typeof e=="string")return xF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xF(e,t)}}function U9e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function G9e(e){if(Array.isArray(e))return xF(e)}function xF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function OZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Tu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?OZ(Object(r),!0).forEach(function(n){P1(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):OZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function P1(e,t,r){return t=Rle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function q9e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H9e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Rle(n.key),n)}}function W9e(e,t,r){return t&&H9e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rle(e){var t=Z9e(e,"string");return W0(t)==="symbol"?t:String(t)}function Z9e(e,t){if(W0(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(W0(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function X9e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bF(e,t)}function bF(e,t){return bF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},bF(e,t)}function K9e(e){var t=Y9e();return function(){var n=BI(e),l;if(t){var u=BI(this).constructor;l=Reflect.construct(n,arguments,u)}else l=n.apply(this,arguments);return wF(this,l)}}function wF(e,t){if(t&&(W0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SF(e)}function SF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y9e(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function BI(e){return BI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},BI(e)}var rf=function(e){X9e(r,e);var t=K9e(r);function r(n,l){var u;q9e(this,r),u=t.call(this,n,l);var f=u.props,o=f.isActive,v=f.attributeName,w=f.from,P=f.to,C=f.steps,k=f.children,L=f.duration;if(u.handleStyleChange=u.handleStyleChange.bind(SF(u)),u.changeStyle=u.changeStyle.bind(SF(u)),!o||L<=0)return u.state={style:{}},typeof k=="function"&&(u.state={style:P}),wF(u);if(C&&C.length)u.state={style:C[0].style};else if(w){if(typeof k=="function")return u.state={style:w},wF(u);u.state={style:v?P1({},v,w):w}}else u.state={style:{}};return u}return W9e(r,[{key:"componentDidMount",value:function(){var l=this.props,u=l.isActive,f=l.canBegin;this.mounted=!0,!(!u||!f)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(l){var u=this.props,f=u.isActive,o=u.canBegin,v=u.attributeName,w=u.shouldReAnimate,P=u.to,C=u.from,k=this.state.style;if(o){if(!f){var L={style:v?P1({},v,P):P};this.state&&k&&(v&&k[v]!==P||!v&&k!==P)&&this.setState(L);return}if(!(n9e(l.to,P)&&l.canBegin&&l.isActive)){var $=!l.canBegin||!l.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var j=$||w?C:l.to;if(this.state&&k){var B={style:v?P1({},v,j):j};(v&&k[v]!==j||!v&&k!==j)&&this.setState(B)}this.runAnimation(Tu(Tu({},this.props),{},{from:j,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var l=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),l&&l()}},{key:"handleStyleChange",value:function(l){this.changeStyle(l)}},{key:"changeStyle",value:function(l){this.mounted&&this.setState({style:l})}},{key:"runJSAnimation",value:function(l){var u=this,f=l.from,o=l.to,v=l.duration,w=l.easing,P=l.begin,C=l.onAnimationEnd,k=l.onAnimationStart,L=N9e(f,o,A9e(w),v,this.changeStyle),$=function(){u.stopJSAnimation=L()};this.manager.start([k,P,$,v,C])}},{key:"runStepAnimation",value:function(l){var u=this,f=l.steps,o=l.begin,v=l.onAnimationStart,w=f[0],P=w.style,C=w.duration,k=C===void 0?0:C,L=function(j,B,U){if(U===0)return j;var q=B.duration,H=B.easing,te=H===void 0?"ease":H,Q=B.style,ae=B.properties,ue=B.onAnimationEnd,me=U>0?f[U-1]:B,Ce=ae||Object.keys(Q);if(typeof te=="function"||te==="spring")return[].concat(KL(j),[u.runJSAnimation.bind(u,{from:me.style,to:Q,duration:q,easing:te}),q]);var Fe=EZ(Ce,q,te),Ge=Tu(Tu(Tu({},me.style),Q),{},{transition:Fe});return[].concat(KL(j),[Ge,q,ue]).filter(p9e)};return this.manager.start([v].concat(KL(f.reduce(L,[P,Math.max(k,o)])),[l.onAnimationEnd]))}},{key:"runAnimation",value:function(l){this.manager||(this.manager=u9e());var u=l.begin,f=l.duration,o=l.attributeName,v=l.to,w=l.easing,P=l.onAnimationStart,C=l.onAnimationEnd,k=l.steps,L=l.children,$=this.manager;if(this.unSubscribe=$.subscribe(this.handleStyleChange),typeof w=="function"||typeof L=="function"||w==="spring"){this.runJSAnimation(l);return}if(k.length>1){this.runStepAnimation(l);return}var j=o?P1({},o,v):v,B=EZ(Object.keys(j),f,w);$.start([P,u,Tu(Tu({},j),{},{transition:B}),f,C])}},{key:"render",value:function(){var l=this.props,u=l.children;l.begin;var f=l.duration;l.attributeName,l.easing;var o=l.isActive;l.steps,l.from,l.to,l.canBegin,l.onAnimationEnd,l.shouldReAnimate,l.onAnimationReStart;var v=F9e(l,z9e),w=X.Children.count(u),P=this.state.style;if(typeof u=="function")return u(P);if(!o||w===0||f<=0)return u;var C=function(L){var $=L.props,j=$.style,B=j===void 0?{}:j,U=$.className,q=X.cloneElement(L,Tu(Tu({},v),{},{style:Tu(Tu({},B),P),className:U}));return q};return w===1?C(X.Children.only(u)):De.createElement("div",null,X.Children.map(u,function(k){return C(k)}))}}]),r}(X.PureComponent);rf.displayName="Animate";rf.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};rf.propTypes={from:Bi.oneOfType([Bi.object,Bi.string]),to:Bi.oneOfType([Bi.object,Bi.string]),attributeName:Bi.string,duration:Bi.number,begin:Bi.number,easing:Bi.oneOfType([Bi.string,Bi.func]),steps:Bi.arrayOf(Bi.shape({duration:Bi.number.isRequired,style:Bi.object.isRequired,easing:Bi.oneOfType([Bi.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Bi.func]),properties:Bi.arrayOf("string"),onAnimationEnd:Bi.func})),children:Bi.oneOfType([Bi.node,Bi.func]),isActive:Bi.bool,canBegin:Bi.bool,onAnimationEnd:Bi.func,shouldReAnimate:Bi.bool,onAnimationStart:Bi.func,onAnimationReStart:Bi.func};function pT(e){"@babel/helpers - typeof";return pT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pT(e)}function $I(){return $I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$I.apply(this,arguments)}function J9e(e,t){return r7e(e)||t7e(e,t)||e7e(e,t)||Q9e()}function Q9e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function e7e(e,t){if(e){if(typeof e=="string")return kZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return kZ(e,t)}}function kZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function t7e(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function r7e(e){if(Array.isArray(e))return e}function RZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function MZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RZ(Object(r),!0).forEach(function(n){n7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function n7e(e,t,r){return t=i7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i7e(e){var t=o7e(e,"string");return pT(t)=="symbol"?t:t+""}function o7e(e,t){if(pT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(pT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var DZ=function(t,r,n,l,u){var f=Math.min(Math.abs(n)/2,Math.abs(l)/2),o=l>=0?1:-1,v=n>=0?1:-1,w=l>=0&&n>=0||l<0&&n<0?1:0,P;if(f>0&&u instanceof Array){for(var C=[0,0,0,0],k=0,L=4;k<L;k++)C[k]=u[k]>f?f:u[k];P="M".concat(t,",").concat(r+o*C[0]),C[0]>0&&(P+="A ".concat(C[0],",").concat(C[0],",0,0,").concat(w,",").concat(t+v*C[0],",").concat(r)),P+="L ".concat(t+n-v*C[1],",").concat(r),C[1]>0&&(P+="A ".concat(C[1],",").concat(C[1],",0,0,").concat(w,`,
        `).concat(t+n,",").concat(r+o*C[1])),P+="L ".concat(t+n,",").concat(r+l-o*C[2]),C[2]>0&&(P+="A ".concat(C[2],",").concat(C[2],",0,0,").concat(w,`,
        `).concat(t+n-v*C[2],",").concat(r+l)),P+="L ".concat(t+v*C[3],",").concat(r+l),C[3]>0&&(P+="A ".concat(C[3],",").concat(C[3],",0,0,").concat(w,`,
        `).concat(t,",").concat(r+l-o*C[3])),P+="Z"}else if(f>0&&u===+u&&u>0){var $=Math.min(f,u);P="M ".concat(t,",").concat(r+o*$,`
            A `).concat($,",").concat($,",0,0,").concat(w,",").concat(t+v*$,",").concat(r,`
            L `).concat(t+n-v*$,",").concat(r,`
            A `).concat($,",").concat($,",0,0,").concat(w,",").concat(t+n,",").concat(r+o*$,`
            L `).concat(t+n,",").concat(r+l-o*$,`
            A `).concat($,",").concat($,",0,0,").concat(w,",").concat(t+n-v*$,",").concat(r+l,`
            L `).concat(t+v*$,",").concat(r+l,`
            A `).concat($,",").concat($,",0,0,").concat(w,",").concat(t,",").concat(r+l-o*$," Z")}else P="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(l," h ").concat(-n," Z");return P},s7e=function(t,r){if(!t||!r)return!1;var n=t.x,l=t.y,u=r.x,f=r.y,o=r.width,v=r.height;if(Math.abs(o)>0&&Math.abs(v)>0){var w=Math.min(u,u+o),P=Math.max(u,u+o),C=Math.min(f,f+v),k=Math.max(f,f+v);return n>=w&&n<=P&&l>=C&&l<=k}return!1},a7e={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},M4=function(t){var r=MZ(MZ({},a7e),t),n=X.useRef(),l=X.useState(-1),u=J9e(l,2),f=u[0],o=u[1];X.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var te=n.current.getTotalLength();te&&o(te)}catch{}},[]);var v=r.x,w=r.y,P=r.width,C=r.height,k=r.radius,L=r.className,$=r.animationEasing,j=r.animationDuration,B=r.animationBegin,U=r.isAnimationActive,q=r.isUpdateAnimationActive;if(v!==+v||w!==+w||P!==+P||C!==+C||P===0||C===0)return null;var H=Gn("recharts-rectangle",L);return q?De.createElement(rf,{canBegin:f>0,from:{width:P,height:C,x:v,y:w},to:{width:P,height:C,x:v,y:w},duration:j,animationEasing:$,isActive:q},function(te){var Q=te.width,ae=te.height,ue=te.x,me=te.y;return De.createElement(rf,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:B,duration:j,isActive:U,easing:$},De.createElement("path",$I({},Pn(r,!0),{className:H,d:DZ(ue,me,Q,ae,k),ref:n})))}):De.createElement("path",$I({},Pn(r,!0),{className:H,d:DZ(v,w,P,C,k)}))},l7e=["points","className","baseLinePoints","connectNulls"];function Nv(){return Nv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Nv.apply(this,arguments)}function c7e(e,t){if(e==null)return{};var r=u7e(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function u7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function LZ(e){return p7e(e)||f7e(e)||h7e(e)||d7e()}function d7e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h7e(e,t){if(e){if(typeof e=="string")return TF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return TF(e,t)}}function f7e(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function p7e(e){if(Array.isArray(e))return TF(e)}function TF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var jZ=function(t){return t&&t.x===+t.x&&t.y===+t.y},m7e=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(n){jZ(n)?r[r.length-1].push(n):r[r.length-1].length>0&&r.push([])}),jZ(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},eS=function(t,r){var n=m7e(t);r&&(n=[n.reduce(function(u,f){return[].concat(LZ(u),LZ(f))},[])]);var l=n.map(function(u){return u.reduce(function(f,o,v){return"".concat(f).concat(v===0?"M":"L").concat(o.x,",").concat(o.y)},"")}).join("");return n.length===1?"".concat(l,"Z"):l},g7e=function(t,r,n){var l=eS(t,n);return"".concat(l.slice(-1)==="Z"?l.slice(0,-1):l,"L").concat(eS(r.reverse(),n).slice(1))},y7e=function(t){var r=t.points,n=t.className,l=t.baseLinePoints,u=t.connectNulls,f=c7e(t,l7e);if(!r||!r.length)return null;var o=Gn("recharts-polygon",n);if(l&&l.length){var v=f.stroke&&f.stroke!=="none",w=g7e(r,l,u);return De.createElement("g",{className:o},De.createElement("path",Nv({},Pn(f,!0),{fill:w.slice(-1)==="Z"?f.fill:"none",stroke:"none",d:w})),v?De.createElement("path",Nv({},Pn(f,!0),{fill:"none",d:eS(r,u)})):null,v?De.createElement("path",Nv({},Pn(f,!0),{fill:"none",d:eS(l,u)})):null)}var P=eS(r,u);return De.createElement("path",Nv({},Pn(f,!0),{fill:P.slice(-1)==="Z"?f.fill:"none",className:o,d:P}))};function EF(){return EF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},EF.apply(this,arguments)}var D4=function(t){var r=t.cx,n=t.cy,l=t.r,u=t.className,f=Gn("recharts-dot",u);return r===+r&&n===+n&&l===+l?X.createElement("circle",EF({},Pn(t,!1),lI(t),{className:f,cx:r,cy:n,r:l})):null};function mT(e){"@babel/helpers - typeof";return mT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mT(e)}var _7e=["x","y","top","left","width","height","className"];function AF(){return AF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},AF.apply(this,arguments)}function NZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function v7e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NZ(Object(r),!0).forEach(function(n){x7e(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x7e(e,t,r){return t=b7e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b7e(e){var t=w7e(e,"string");return mT(t)=="symbol"?t:t+""}function w7e(e,t){if(mT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(mT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function S7e(e,t){if(e==null)return{};var r=T7e(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function T7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var E7e=function(t,r,n,l,u,f){return"M".concat(t,",").concat(u,"v").concat(l,"M").concat(f,",").concat(r,"h").concat(n)},A7e=function(t){var r=t.x,n=r===void 0?0:r,l=t.y,u=l===void 0?0:l,f=t.top,o=f===void 0?0:f,v=t.left,w=v===void 0?0:v,P=t.width,C=P===void 0?0:P,k=t.height,L=k===void 0?0:k,$=t.className,j=S7e(t,_7e),B=v7e({x:n,y:u,top:o,left:w,width:C,height:L},j);return!fr(n)||!fr(u)||!fr(C)||!fr(L)||!fr(o)||!fr(w)?null:De.createElement("path",AF({},Pn(B,!0),{className:Gn("recharts-cross",$),d:E7e(n,u,C,L,o,w)}))},P7e=zk,C7e=Gae,I7e=Kd;function O7e(e,t){return e&&e.length?P7e(e,I7e(t),C7e):void 0}var k7e=O7e;const R7e=zi(k7e);var M7e=zk,D7e=Kd,L7e=qae;function j7e(e,t){return e&&e.length?M7e(e,D7e(t),L7e):void 0}var N7e=j7e;const z7e=zi(N7e);var F7e=["cx","cy","angle","ticks","axisLine"],B7e=["ticks","tick","angle","tickFormatter","stroke"];function Z0(e){"@babel/helpers - typeof";return Z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z0(e)}function tS(){return tS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},tS.apply(this,arguments)}function zZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function fg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zZ(Object(r),!0).forEach(function(n){qk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FZ(e,t){if(e==null)return{};var r=$7e(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function $7e(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function V7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Dle(n.key),n)}}function U7e(e,t,r){return t&&BZ(e.prototype,t),r&&BZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function G7e(e,t,r){return t=VI(t),q7e(e,Mle()?Reflect.construct(t,r||[],VI(e).constructor):t.apply(e,r))}function q7e(e,t){if(t&&(Z0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return H7e(e)}function H7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Mle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Mle=function(){return!!e})()}function VI(e){return VI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},VI(e)}function W7e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PF(e,t)}function PF(e,t){return PF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},PF(e,t)}function qk(e,t,r){return t=Dle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dle(e){var t=Z7e(e,"string");return Z0(t)=="symbol"?t:t+""}function Z7e(e,t){if(Z0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Z0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Hk=function(e){function t(){return V7e(this,t),G7e(this,t,arguments)}return W7e(t,e),U7e(t,[{key:"getTickValueCoord",value:function(n){var l=n.coordinate,u=this.props,f=u.angle,o=u.cx,v=u.cy;return uo(o,v,l,f)}},{key:"getTickTextAnchor",value:function(){var n=this.props.orientation,l;switch(n){case"left":l="end";break;case"right":l="start";break;default:l="middle";break}return l}},{key:"getViewBox",value:function(){var n=this.props,l=n.cx,u=n.cy,f=n.angle,o=n.ticks,v=R7e(o,function(P){return P.coordinate||0}),w=z7e(o,function(P){return P.coordinate||0});return{cx:l,cy:u,startAngle:f,endAngle:f,innerRadius:w.coordinate||0,outerRadius:v.coordinate||0}}},{key:"renderAxisLine",value:function(){var n=this.props,l=n.cx,u=n.cy,f=n.angle,o=n.ticks,v=n.axisLine,w=FZ(n,F7e),P=o.reduce(function($,j){return[Math.min($[0],j.coordinate),Math.max($[1],j.coordinate)]},[1/0,-1/0]),C=uo(l,u,P[0],f),k=uo(l,u,P[1],f),L=fg(fg(fg({},Pn(w,!1)),{},{fill:"none"},Pn(v,!1)),{},{x1:C.x,y1:C.y,x2:k.x,y2:k.y});return De.createElement("line",tS({className:"recharts-polar-radius-axis-line"},L))}},{key:"renderTicks",value:function(){var n=this,l=this.props,u=l.ticks,f=l.tick,o=l.angle,v=l.tickFormatter,w=l.stroke,P=FZ(l,B7e),C=this.getTickTextAnchor(),k=Pn(P,!1),L=Pn(f,!1),$=u.map(function(j,B){var U=n.getTickValueCoord(j),q=fg(fg(fg(fg({textAnchor:C,transform:"rotate(".concat(90-o,", ").concat(U.x,", ").concat(U.y,")")},k),{},{stroke:"none",fill:w},L),{},{index:B},U),{},{payload:j});return De.createElement(Xi,tS({className:Gn("recharts-polar-radius-axis-tick",vle(f)),key:"tick-".concat(j.coordinate)},fy(n.props,j,B)),t.renderTickItem(f,q,v?v(j.value,B):j.value))});return De.createElement(Xi,{className:"recharts-polar-radius-axis-ticks"},$)}},{key:"render",value:function(){var n=this.props,l=n.ticks,u=n.axisLine,f=n.tick;return!l||!l.length?null:De.createElement(Xi,{className:Gn("recharts-polar-radius-axis",this.props.className)},u&&this.renderAxisLine(),f&&this.renderTicks(),ia.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(n,l,u){var f;return De.isValidElement(n)?f=De.cloneElement(n,l):Rn(n)?f=n(l):f=De.createElement(py,tS({},l,{className:"recharts-polar-radius-axis-tick-value"}),u),f}}])}(X.PureComponent);qk(Hk,"displayName","PolarRadiusAxis");qk(Hk,"axisType","radiusAxis");qk(Hk,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function X0(e){"@babel/helpers - typeof";return X0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X0(e)}function Tg(){return Tg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tg.apply(this,arguments)}function $Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function pg(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$Z(Object(r),!0).forEach(function(n){Wk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$Z(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function X7e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jle(n.key),n)}}function K7e(e,t,r){return t&&VZ(e.prototype,t),r&&VZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Y7e(e,t,r){return t=UI(t),J7e(e,Lle()?Reflect.construct(t,r||[],UI(e).constructor):t.apply(e,r))}function J7e(e,t){if(t&&(X0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Q7e(e)}function Q7e(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Lle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Lle=function(){return!!e})()}function UI(e){return UI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},UI(e)}function eZe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CF(e,t)}function CF(e,t){return CF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},CF(e,t)}function Wk(e,t,r){return t=jle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jle(e){var t=tZe(e,"string");return X0(t)=="symbol"?t:t+""}function tZe(e,t){if(X0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(X0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var rZe=Math.PI/180,UZ=1e-5,Zk=function(e){function t(){return X7e(this,t),Y7e(this,t,arguments)}return eZe(t,e),K7e(t,[{key:"getTickLineCoord",value:function(n){var l=this.props,u=l.cx,f=l.cy,o=l.radius,v=l.orientation,w=l.tickSize,P=w||8,C=uo(u,f,o,n.coordinate),k=uo(u,f,o+(v==="inner"?-1:1)*P,n.coordinate);return{x1:C.x,y1:C.y,x2:k.x,y2:k.y}}},{key:"getTickTextAnchor",value:function(n){var l=this.props.orientation,u=Math.cos(-n.coordinate*rZe),f;return u>UZ?f=l==="outer"?"start":"end":u<-UZ?f=l==="outer"?"end":"start":f="middle",f}},{key:"renderAxisLine",value:function(){var n=this.props,l=n.cx,u=n.cy,f=n.radius,o=n.axisLine,v=n.axisLineType,w=pg(pg({},Pn(this.props,!1)),{},{fill:"none"},Pn(o,!1));if(v==="circle")return De.createElement(D4,Tg({className:"recharts-polar-angle-axis-line"},w,{cx:l,cy:u,r:f}));var P=this.props.ticks,C=P.map(function(k){return uo(l,u,f,k.coordinate)});return De.createElement(y7e,Tg({className:"recharts-polar-angle-axis-line"},w,{points:C}))}},{key:"renderTicks",value:function(){var n=this,l=this.props,u=l.ticks,f=l.tick,o=l.tickLine,v=l.tickFormatter,w=l.stroke,P=Pn(this.props,!1),C=Pn(f,!1),k=pg(pg({},P),{},{fill:"none"},Pn(o,!1)),L=u.map(function($,j){var B=n.getTickLineCoord($),U=n.getTickTextAnchor($),q=pg(pg(pg({textAnchor:U},P),{},{stroke:"none",fill:w},C),{},{index:j,payload:$,x:B.x2,y:B.y2});return De.createElement(Xi,Tg({className:Gn("recharts-polar-angle-axis-tick",vle(f)),key:"tick-".concat($.coordinate)},fy(n.props,$,j)),o&&De.createElement("line",Tg({className:"recharts-polar-angle-axis-tick-line"},k,B)),f&&t.renderTickItem(f,q,v?v($.value,j):$.value))});return De.createElement(Xi,{className:"recharts-polar-angle-axis-ticks"},L)}},{key:"render",value:function(){var n=this.props,l=n.ticks,u=n.radius,f=n.axisLine;return u<=0||!l||!l.length?null:De.createElement(Xi,{className:Gn("recharts-polar-angle-axis",this.props.className)},f&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(n,l,u){var f;return De.isValidElement(n)?f=De.cloneElement(n,l):Rn(n)?f=n(l):f=De.createElement(py,Tg({},l,{className:"recharts-polar-angle-axis-tick-value"}),u),f}}])}(X.PureComponent);Wk(Zk,"displayName","PolarAngleAxis");Wk(Zk,"axisType","angleAxis");Wk(Zk,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var nZe=Bse,iZe=nZe(Object.getPrototypeOf,Object),oZe=iZe,sZe=lf,aZe=oZe,lZe=cf,cZe="[object Object]",uZe=Function.prototype,dZe=Object.prototype,Nle=uZe.toString,hZe=dZe.hasOwnProperty,fZe=Nle.call(Object);function pZe(e){if(!lZe(e)||sZe(e)!=cZe)return!1;var t=aZe(e);if(t===null)return!0;var r=hZe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&Nle.call(r)==fZe}var mZe=pZe;const gZe=zi(mZe);var yZe=lf,_Ze=cf,vZe="[object Boolean]";function xZe(e){return e===!0||e===!1||_Ze(e)&&yZe(e)==vZe}var bZe=xZe;const wZe=zi(bZe);function gT(e){"@babel/helpers - typeof";return gT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gT(e)}function GI(){return GI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},GI.apply(this,arguments)}function SZe(e,t){return PZe(e)||AZe(e,t)||EZe(e,t)||TZe()}function TZe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EZe(e,t){if(e){if(typeof e=="string")return GZ(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GZ(e,t)}}function GZ(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function AZe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function PZe(e){if(Array.isArray(e))return e}function qZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function HZ(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?qZ(Object(r),!0).forEach(function(n){CZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CZe(e,t,r){return t=IZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IZe(e){var t=OZe(e,"string");return gT(t)=="symbol"?t:t+""}function OZe(e,t){if(gT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(gT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var WZ=function(t,r,n,l,u){var f=n-l,o;return o="M ".concat(t,",").concat(r),o+="L ".concat(t+n,",").concat(r),o+="L ".concat(t+n-f/2,",").concat(r+u),o+="L ".concat(t+n-f/2-l,",").concat(r+u),o+="L ".concat(t,",").concat(r," Z"),o},kZe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},RZe=function(t){var r=HZ(HZ({},kZe),t),n=X.useRef(),l=X.useState(-1),u=SZe(l,2),f=u[0],o=u[1];X.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var H=n.current.getTotalLength();H&&o(H)}catch{}},[]);var v=r.x,w=r.y,P=r.upperWidth,C=r.lowerWidth,k=r.height,L=r.className,$=r.animationEasing,j=r.animationDuration,B=r.animationBegin,U=r.isUpdateAnimationActive;if(v!==+v||w!==+w||P!==+P||C!==+C||k!==+k||P===0&&C===0||k===0)return null;var q=Gn("recharts-trapezoid",L);return U?De.createElement(rf,{canBegin:f>0,from:{upperWidth:0,lowerWidth:0,height:k,x:v,y:w},to:{upperWidth:P,lowerWidth:C,height:k,x:v,y:w},duration:j,animationEasing:$,isActive:U},function(H){var te=H.upperWidth,Q=H.lowerWidth,ae=H.height,ue=H.x,me=H.y;return De.createElement(rf,{canBegin:f>0,from:"0px ".concat(f===-1?1:f,"px"),to:"".concat(f,"px 0px"),attributeName:"strokeDasharray",begin:B,duration:j,easing:$},De.createElement("path",GI({},Pn(r,!0),{className:q,d:WZ(ue,me,te,Q,ae),ref:n})))}):De.createElement("g",null,De.createElement("path",GI({},Pn(r,!0),{className:q,d:WZ(v,w,P,C,k)})))},MZe=["option","shapeType","propTransformer","activeClassName","isActive"];function yT(e){"@babel/helpers - typeof";return yT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yT(e)}function DZe(e,t){if(e==null)return{};var r=LZe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function LZe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ZZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function qI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZZ(Object(r),!0).forEach(function(n){jZe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jZe(e,t,r){return t=NZe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NZe(e){var t=zZe(e,"string");return yT(t)=="symbol"?t:t+""}function zZe(e,t){if(yT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(yT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function FZe(e,t){return qI(qI({},t),e)}function BZe(e,t){return e==="symbols"}function XZ(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return De.createElement(M4,r);case"trapezoid":return De.createElement(RZe,r);case"sector":return De.createElement(wle,r);case"symbols":if(BZe(t))return De.createElement(J5,r);break;default:return null}}function $Ze(e){return X.isValidElement(e)?e.props:e}function zle(e){var t=e.option,r=e.shapeType,n=e.propTransformer,l=n===void 0?FZe:n,u=e.activeClassName,f=u===void 0?"recharts-active-shape":u,o=e.isActive,v=DZe(e,MZe),w;if(X.isValidElement(t))w=X.cloneElement(t,qI(qI({},v),$Ze(t)));else if(Rn(t))w=t(v);else if(gZe(t)&&!wZe(t)){var P=l(t,v);w=De.createElement(XZ,{shapeType:r,elementProps:P})}else{var C=v;w=De.createElement(XZ,{shapeType:r,elementProps:C})}return o?De.createElement(Xi,{className:f},w):w}function Xk(e,t){return t!=null&&"trapezoids"in e.props}function Kk(e,t){return t!=null&&"sectors"in e.props}function _T(e,t){return t!=null&&"points"in e.props}function VZe(e,t){var r,n,l=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,u=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return l&&u}function UZe(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function GZe(e,t){var r=e.x===t.x,n=e.y===t.y,l=e.z===t.z;return r&&n&&l}function qZe(e,t){var r;return Xk(e,t)?r=VZe:Kk(e,t)?r=UZe:_T(e,t)&&(r=GZe),r}function HZe(e,t){var r;return Xk(e,t)?r="trapezoids":Kk(e,t)?r="sectors":_T(e,t)&&(r="points"),r}function WZe(e,t){if(Xk(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(Kk(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return _T(e,t)?t.payload:{}}function ZZe(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,l=HZe(r,t),u=WZe(r,t),f=n.filter(function(v,w){var P=$k(u,v),C=r.props[l].filter(function($){var j=qZe(r,t);return j($,t)}),k=r.props[l].indexOf(C[C.length-1]),L=w===k;return P&&L}),o=n.indexOf(f[f.length-1]);return o}var eC;function K0(e){"@babel/helpers - typeof";return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K0(e)}function zv(){return zv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},zv.apply(this,arguments)}function KZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function ao(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KZ(Object(r),!0).forEach(function(n){Uc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function XZe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function YZ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ble(n.key),n)}}function KZe(e,t,r){return t&&YZ(e.prototype,t),r&&YZ(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function YZe(e,t,r){return t=HI(t),JZe(e,Fle()?Reflect.construct(t,r||[],HI(e).constructor):t.apply(e,r))}function JZe(e,t){if(t&&(K0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QZe(e)}function QZe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Fle=function(){return!!e})()}function HI(e){return HI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},HI(e)}function eXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&IF(e,t)}function IF(e,t){return IF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},IF(e,t)}function Uc(e,t,r){return t=Ble(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ble(e){var t=tXe(e,"string");return K0(t)=="symbol"?t:t+""}function tXe(e,t){if(K0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(K0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var df=function(e){function t(r){var n;return XZe(this,t),n=YZe(this,t,[r]),Uc(n,"pieRef",null),Uc(n,"sectorRefs",[]),Uc(n,"id",oE("recharts-pie-")),Uc(n,"handleAnimationEnd",function(){var l=n.props.onAnimationEnd;n.setState({isAnimationFinished:!0}),Rn(l)&&l()}),Uc(n,"handleAnimationStart",function(){var l=n.props.onAnimationStart;n.setState({isAnimationFinished:!1}),Rn(l)&&l()}),n.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},n}return eXe(t,e),KZe(t,[{key:"isActiveIndex",value:function(n){var l=this.props.activeIndex;return Array.isArray(l)?l.indexOf(n)!==-1:n===l}},{key:"hasActiveIndex",value:function(){var n=this.props.activeIndex;return Array.isArray(n)?n.length!==0:n||n===0}},{key:"renderLabels",value:function(n){var l=this.props.isAnimationActive;if(l&&!this.state.isAnimationFinished)return null;var u=this.props,f=u.label,o=u.labelLine,v=u.dataKey,w=u.valueKey,P=Pn(this.props,!1),C=Pn(f,!1),k=Pn(o,!1),L=f&&f.offsetRadius||20,$=n.map(function(j,B){var U=(j.startAngle+j.endAngle)/2,q=uo(j.cx,j.cy,j.outerRadius+L,U),H=ao(ao(ao(ao({},P),j),{},{stroke:"none"},C),{},{index:B,textAnchor:t.getTextAnchor(q.x,j.cx)},q),te=ao(ao(ao(ao({},P),j),{},{fill:"none",stroke:j.fill},k),{},{index:B,points:[uo(j.cx,j.cy,j.outerRadius,U),q]}),Q=v;return oi(v)&&oi(w)?Q="value":oi(v)&&(Q=w),De.createElement(Xi,{key:"label-".concat(j.startAngle,"-").concat(j.endAngle,"-").concat(j.midAngle,"-").concat(B)},o&&t.renderLabelLineItem(o,te,"line"),t.renderLabelItem(f,H,Va(j,Q)))});return De.createElement(Xi,{className:"recharts-pie-labels"},$)}},{key:"renderSectorsStatically",value:function(n){var l=this,u=this.props,f=u.activeShape,o=u.blendStroke,v=u.inactiveShape;return n.map(function(w,P){if((w==null?void 0:w.startAngle)===0&&(w==null?void 0:w.endAngle)===0&&n.length!==1)return null;var C=l.isActiveIndex(P),k=v&&l.hasActiveIndex()?v:null,L=C?f:k,$=ao(ao({},w),{},{stroke:o?w.fill:w.stroke,tabIndex:-1});return De.createElement(Xi,zv({ref:function(B){B&&!l.sectorRefs.includes(B)&&l.sectorRefs.push(B)},tabIndex:-1,className:"recharts-pie-sector"},fy(l.props,w,P),{key:"sector-".concat(w==null?void 0:w.startAngle,"-").concat(w==null?void 0:w.endAngle,"-").concat(w.midAngle,"-").concat(P)}),De.createElement(zle,zv({option:L,isActive:C,shapeType:"sector"},$)))})}},{key:"renderSectorsWithAnimation",value:function(){var n=this,l=this.props,u=l.sectors,f=l.isAnimationActive,o=l.animationBegin,v=l.animationDuration,w=l.animationEasing,P=l.animationId,C=this.state,k=C.prevSectors,L=C.prevIsAnimationActive;return De.createElement(rf,{begin:o,duration:v,isActive:f,easing:w,from:{t:0},to:{t:1},key:"pie-".concat(P,"-").concat(L),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function($){var j=$.t,B=[],U=u&&u[0],q=U.startAngle;return u.forEach(function(H,te){var Q=k&&k[te],ae=te>0?dc(H,"paddingAngle",0):0;if(Q){var ue=cp(Q.endAngle-Q.startAngle,H.endAngle-H.startAngle),me=ao(ao({},H),{},{startAngle:q+ae,endAngle:q+ue(j)+ae});B.push(me),q=me.endAngle}else{var Ce=H.endAngle,Fe=H.startAngle,Ge=cp(0,Ce-Fe),Ve=Ge(j),Ze=ao(ao({},H),{},{startAngle:q+ae,endAngle:q+Ve+ae});B.push(Ze),q=Ze.endAngle}}),De.createElement(Xi,null,n.renderSectorsStatically(B))})}},{key:"attachKeyboardHandlers",value:function(n){var l=this;n.onkeydown=function(u){if(!u.altKey)switch(u.key){case"ArrowLeft":{var f=++l.state.sectorToFocus%l.sectorRefs.length;l.sectorRefs[f].focus(),l.setState({sectorToFocus:f});break}case"ArrowRight":{var o=--l.state.sectorToFocus<0?l.sectorRefs.length-1:l.state.sectorToFocus%l.sectorRefs.length;l.sectorRefs[o].focus(),l.setState({sectorToFocus:o});break}case"Escape":{l.sectorRefs[l.state.sectorToFocus].blur(),l.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var n=this.props,l=n.sectors,u=n.isAnimationActive,f=this.state.prevSectors;return u&&l&&l.length&&(!f||!$k(f,l))?this.renderSectorsWithAnimation():this.renderSectorsStatically(l)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var n=this,l=this.props,u=l.hide,f=l.sectors,o=l.className,v=l.label,w=l.cx,P=l.cy,C=l.innerRadius,k=l.outerRadius,L=l.isAnimationActive,$=this.state.isAnimationFinished;if(u||!f||!f.length||!fr(w)||!fr(P)||!fr(C)||!fr(k))return null;var j=Gn("recharts-pie",o);return De.createElement(Xi,{tabIndex:this.props.rootTabIndex,className:j,ref:function(U){n.pieRef=U}},this.renderSectors(),v&&this.renderLabels(f),ia.renderCallByParent(this.props,null,!1),(!L||$)&&Vp.renderCallByParent(this.props,f,!1))}}],[{key:"getDerivedStateFromProps",value:function(n,l){return l.prevIsAnimationActive!==n.isAnimationActive?{prevIsAnimationActive:n.isAnimationActive,prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:[],isAnimationFinished:!0}:n.isAnimationActive&&n.animationId!==l.prevAnimationId?{prevAnimationId:n.animationId,curSectors:n.sectors,prevSectors:l.curSectors,isAnimationFinished:!0}:n.sectors!==l.curSectors?{curSectors:n.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(n,l){return n>l?"start":n<l?"end":"middle"}},{key:"renderLabelLineItem",value:function(n,l,u){if(De.isValidElement(n))return De.cloneElement(n,l);if(Rn(n))return n(l);var f=Gn("recharts-pie-label-line",typeof n!="boolean"?n.className:"");return De.createElement(pF,zv({},l,{key:u,type:"linear",className:f}))}},{key:"renderLabelItem",value:function(n,l,u){if(De.isValidElement(n))return De.cloneElement(n,l);var f=u;if(Rn(n)&&(f=n(l),De.isValidElement(f)))return f;var o=Gn("recharts-pie-label-text",typeof n!="boolean"&&!Rn(n)?n.className:"");return De.createElement(py,zv({},l,{alignmentBaseline:"middle",className:o}),f)}}])}(X.PureComponent);eC=df;Uc(df,"displayName","Pie");Uc(df,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!$h.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Uc(df,"parseDeltaAngle",function(e,t){var r=gl(t-e),n=Math.min(Math.abs(t-e),360);return r*n});Uc(df,"getRealPieData",function(e){var t=e.data,r=e.children,n=Pn(e,!1),l=Kc(r,kk);return t&&t.length?t.map(function(u,f){return ao(ao(ao({payload:u},n),u),l&&l[f]&&l[f].props)}):l&&l.length?l.map(function(u){return ao(ao({},n),u.props)}):[]});Uc(df,"parseCoordinateOfPie",function(e,t){var r=t.top,n=t.left,l=t.width,u=t.height,f=_le(l,u),o=n+yl(e.cx,l,l/2),v=r+yl(e.cy,u,u/2),w=yl(e.innerRadius,f,0),P=yl(e.outerRadius,f,f*.8),C=e.maxRadius||Math.sqrt(l*l+u*u)/2;return{cx:o,cy:v,innerRadius:w,outerRadius:P,maxRadius:C}});Uc(df,"getComposedData",function(e){var t=e.item,r=e.offset,n=t.type.defaultProps!==void 0?ao(ao({},t.type.defaultProps),t.props):t.props,l=eC.getRealPieData(n);if(!l||!l.length)return null;var u=n.cornerRadius,f=n.startAngle,o=n.endAngle,v=n.paddingAngle,w=n.dataKey,P=n.nameKey,C=n.valueKey,k=n.tooltipType,L=Math.abs(n.minAngle),$=eC.parseCoordinateOfPie(n,r),j=eC.parseDeltaAngle(f,o),B=Math.abs(j),U=w;oi(w)&&oi(C)?(Gu(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),U="value"):oi(w)&&(Gu(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),U=C);var q=l.filter(function(me){return Va(me,U,0)!==0}).length,H=(B>=360?q:q-1)*v,te=B-q*L-H,Q=l.reduce(function(me,Ce){var Fe=Va(Ce,U,0);return me+(fr(Fe)?Fe:0)},0),ae;if(Q>0){var ue;ae=l.map(function(me,Ce){var Fe=Va(me,U,0),Ge=Va(me,P,Ce),Ve=(fr(Fe)?Fe:0)/Q,Ze;Ce?Ze=ue.endAngle+gl(j)*v*(Fe!==0?1:0):Ze=f;var nt=Ze+gl(j)*((Fe!==0?L:0)+Ve*te),dt=(Ze+nt)/2,rt=($.innerRadius+$.outerRadius)/2,at=[{name:Ge,value:Fe,payload:me,dataKey:U,type:k}],qe=uo($.cx,$.cy,rt,dt);return ue=ao(ao(ao({percent:Ve,cornerRadius:u,name:Ge,tooltipPayload:at,midAngle:dt,middleRadius:rt,tooltipPosition:qe},me),$),{},{value:Va(me,U),startAngle:Ze,endAngle:nt,payload:me,paddingAngle:gl(j)*v}),ue})}return ao(ao({},$),{},{sectors:ae,data:l})});var rXe=Math.ceil,nXe=Math.max;function iXe(e,t,r,n){for(var l=-1,u=nXe(rXe((t-e)/(r||1)),0),f=Array(u);u--;)f[n?u:++l]=e,e+=r;return f}var oXe=iXe,sXe=oae,JZ=1/0,aXe=17976931348623157e292;function lXe(e){if(!e)return e===0?e:0;if(e=sXe(e),e===JZ||e===-JZ){var t=e<0?-1:1;return t*aXe}return e===e?e:0}var $le=lXe,cXe=oXe,uXe=Ok,YL=$le;function dXe(e){return function(t,r,n){return n&&typeof n!="number"&&uXe(t,r,n)&&(r=n=void 0),t=YL(t),r===void 0?(r=t,t=0):r=YL(r),n=n===void 0?t<r?1:-1:YL(n),cXe(t,r,n,e)}}var hXe=dXe,fXe=hXe,pXe=fXe(),mXe=pXe;const WI=zi(mXe);function vT(e){"@babel/helpers - typeof";return vT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vT(e)}function QZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function eX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QZ(Object(r),!0).forEach(function(n){Vle(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QZ(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vle(e,t,r){return t=gXe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gXe(e){var t=yXe(e,"string");return vT(t)=="symbol"?t:t+""}function yXe(e,t){if(vT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(vT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _Xe=["Webkit","Moz","O","ms"],vXe=function(t,r){var n=t.replace(/(\w)/,function(u){return u.toUpperCase()}),l=_Xe.reduce(function(u,f){return eX(eX({},u),{},Vle({},f+n,r))},{});return l[t]=r,l};function Y0(e){"@babel/helpers - typeof";return Y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y0(e)}function ZI(){return ZI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ZI.apply(this,arguments)}function tX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function JL(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tX(Object(r),!0).forEach(function(n){Jl(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xXe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Gle(n.key),n)}}function bXe(e,t,r){return t&&rX(e.prototype,t),r&&rX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wXe(e,t,r){return t=XI(t),SXe(e,Ule()?Reflect.construct(t,r||[],XI(e).constructor):t.apply(e,r))}function SXe(e,t){if(t&&(Y0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return TXe(e)}function TXe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ule(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ule=function(){return!!e})()}function XI(e){return XI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},XI(e)}function EXe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OF(e,t)}function OF(e,t){return OF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},OF(e,t)}function Jl(e,t,r){return t=Gle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Gle(e){var t=AXe(e,"string");return Y0(t)=="symbol"?t:t+""}function AXe(e,t){if(Y0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Y0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var PXe=function(t){var r=t.data,n=t.startIndex,l=t.endIndex,u=t.x,f=t.width,o=t.travellerWidth;if(!r||!r.length)return{};var v=r.length,w=Y1().domain(WI(0,v)).range([u,u+f-o]),P=w.domain().map(function(C){return w(C)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:w(n),endX:w(l),scale:w,scaleValues:P}},nX=function(t){return t.changedTouches&&!!t.changedTouches.length},J0=function(e){function t(r){var n;return xXe(this,t),n=wXe(this,t,[r]),Jl(n,"handleDrag",function(l){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(l):n.state.isSlideMoving&&n.handleSlideDrag(l)}),Jl(n,"handleTouchMove",function(l){l.changedTouches!=null&&l.changedTouches.length>0&&n.handleDrag(l.changedTouches[0])}),Jl(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var l=n.props,u=l.endIndex,f=l.onDragEnd,o=l.startIndex;f==null||f({endIndex:u,startIndex:o})}),n.detachDragEndListener()}),Jl(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Jl(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Jl(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Jl(n,"handleSlideDragStart",function(l){var u=nX(l)?l.changedTouches[0]:l;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:u.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return EXe(t,e),bXe(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var l=n.startX,u=n.endX,f=this.state.scaleValues,o=this.props,v=o.gap,w=o.data,P=w.length-1,C=Math.min(l,u),k=Math.max(l,u),L=t.getIndexInRange(f,C),$=t.getIndexInRange(f,k);return{startIndex:L-L%v,endIndex:$===P?P:$-$%v}}},{key:"getTextOfTick",value:function(n){var l=this.props,u=l.data,f=l.tickFormatter,o=l.dataKey,v=Va(u[n],o,n);return Rn(f)?f(v,n):v}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var l=this.state,u=l.slideMoveStartX,f=l.startX,o=l.endX,v=this.props,w=v.x,P=v.width,C=v.travellerWidth,k=v.startIndex,L=v.endIndex,$=v.onChange,j=n.pageX-u;j>0?j=Math.min(j,w+P-C-o,w+P-C-f):j<0&&(j=Math.max(j,w-f,w-o));var B=this.getIndex({startX:f+j,endX:o+j});(B.startIndex!==k||B.endIndex!==L)&&$&&$(B),this.setState({startX:f+j,endX:o+j,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,l){var u=nX(l)?l.changedTouches[0]:l;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:u.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var l=this.state,u=l.brushMoveStartX,f=l.movingTravellerId,o=l.endX,v=l.startX,w=this.state[f],P=this.props,C=P.x,k=P.width,L=P.travellerWidth,$=P.onChange,j=P.gap,B=P.data,U={startX:this.state.startX,endX:this.state.endX},q=n.pageX-u;q>0?q=Math.min(q,C+k-L-w):q<0&&(q=Math.max(q,C-w)),U[f]=w+q;var H=this.getIndex(U),te=H.startIndex,Q=H.endIndex,ae=function(){var me=B.length-1;return f==="startX"&&(o>v?te%j===0:Q%j===0)||o<v&&Q===me||f==="endX"&&(o>v?Q%j===0:te%j===0)||o>v&&Q===me};this.setState(Jl(Jl({},f,w+q),"brushMoveStartX",n.pageX),function(){$&&ae()&&$(H)})}},{key:"handleTravellerMoveKeyboard",value:function(n,l){var u=this,f=this.state,o=f.scaleValues,v=f.startX,w=f.endX,P=this.state[l],C=o.indexOf(P);if(C!==-1){var k=C+n;if(!(k===-1||k>=o.length)){var L=o[k];l==="startX"&&L>=w||l==="endX"&&L<=v||this.setState(Jl({},l,L),function(){u.props.onChange(u.getIndex({startX:u.state.startX,endX:u.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,l=n.x,u=n.y,f=n.width,o=n.height,v=n.fill,w=n.stroke;return De.createElement("rect",{stroke:w,fill:v,x:l,y:u,width:f,height:o})}},{key:"renderPanorama",value:function(){var n=this.props,l=n.x,u=n.y,f=n.width,o=n.height,v=n.data,w=n.children,P=n.padding,C=X.Children.only(w);return C?De.cloneElement(C,{x:l,y:u,width:f,height:o,margin:P,compact:!0,data:v}):null}},{key:"renderTravellerLayer",value:function(n,l){var u,f,o=this,v=this.props,w=v.y,P=v.travellerWidth,C=v.height,k=v.traveller,L=v.ariaLabel,$=v.data,j=v.startIndex,B=v.endIndex,U=Math.max(n,this.props.x),q=JL(JL({},Pn(this.props,!1)),{},{x:U,y:w,width:P,height:C}),H=L||"Min value: ".concat((u=$[j])===null||u===void 0?void 0:u.name,", Max value: ").concat((f=$[B])===null||f===void 0?void 0:f.name);return De.createElement(Xi,{tabIndex:0,role:"slider","aria-label":H,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[l],onTouchStart:this.travellerDragStartHandlers[l],onKeyDown:function(Q){["ArrowLeft","ArrowRight"].includes(Q.key)&&(Q.preventDefault(),Q.stopPropagation(),o.handleTravellerMoveKeyboard(Q.key==="ArrowRight"?1:-1,l))},onFocus:function(){o.setState({isTravellerFocused:!0})},onBlur:function(){o.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(k,q))}},{key:"renderSlide",value:function(n,l){var u=this.props,f=u.y,o=u.height,v=u.stroke,w=u.travellerWidth,P=Math.min(n,l)+w,C=Math.max(Math.abs(l-n)-w,0);return De.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:v,fillOpacity:.2,x:P,y:f,width:C,height:o})}},{key:"renderText",value:function(){var n=this.props,l=n.startIndex,u=n.endIndex,f=n.y,o=n.height,v=n.travellerWidth,w=n.stroke,P=this.state,C=P.startX,k=P.endX,L=5,$={pointerEvents:"none",fill:w};return De.createElement(Xi,{className:"recharts-brush-texts"},De.createElement(py,ZI({textAnchor:"end",verticalAnchor:"middle",x:Math.min(C,k)-L,y:f+o/2},$),this.getTextOfTick(l)),De.createElement(py,ZI({textAnchor:"start",verticalAnchor:"middle",x:Math.max(C,k)+v+L,y:f+o/2},$),this.getTextOfTick(u)))}},{key:"render",value:function(){var n=this.props,l=n.data,u=n.className,f=n.children,o=n.x,v=n.y,w=n.width,P=n.height,C=n.alwaysShowText,k=this.state,L=k.startX,$=k.endX,j=k.isTextActive,B=k.isSlideMoving,U=k.isTravellerMoving,q=k.isTravellerFocused;if(!l||!l.length||!fr(o)||!fr(v)||!fr(w)||!fr(P)||w<=0||P<=0)return null;var H=Gn("recharts-brush",u),te=De.Children.count(f)===1,Q=vXe("userSelect","none");return De.createElement(Xi,{className:H,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:Q},this.renderBackground(),te&&this.renderPanorama(),this.renderSlide(L,$),this.renderTravellerLayer(L,"startX"),this.renderTravellerLayer($,"endX"),(j||B||U||q||C)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var l=n.x,u=n.y,f=n.width,o=n.height,v=n.stroke,w=Math.floor(u+o/2)-1;return De.createElement(De.Fragment,null,De.createElement("rect",{x:l,y:u,width:f,height:o,fill:v,stroke:"none"}),De.createElement("line",{x1:l+1,y1:w,x2:l+f-1,y2:w,fill:"none",stroke:"#fff"}),De.createElement("line",{x1:l+1,y1:w+2,x2:l+f-1,y2:w+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,l){var u;return De.isValidElement(n)?u=De.cloneElement(n,l):Rn(n)?u=n(l):u=t.renderDefaultTraveller(l),u}},{key:"getDerivedStateFromProps",value:function(n,l){var u=n.data,f=n.width,o=n.x,v=n.travellerWidth,w=n.updateId,P=n.startIndex,C=n.endIndex;if(u!==l.prevData||w!==l.prevUpdateId)return JL({prevData:u,prevTravellerWidth:v,prevUpdateId:w,prevX:o,prevWidth:f},u&&u.length?PXe({data:u,width:f,x:o,travellerWidth:v,startIndex:P,endIndex:C}):{scale:null,scaleValues:null});if(l.scale&&(f!==l.prevWidth||o!==l.prevX||v!==l.prevTravellerWidth)){l.scale.range([o,o+f-v]);var k=l.scale.domain().map(function(L){return l.scale(L)});return{prevData:u,prevTravellerWidth:v,prevUpdateId:w,prevX:o,prevWidth:f,startX:l.scale(n.startIndex),endX:l.scale(n.endIndex),scaleValues:k}}return null}},{key:"getIndexInRange",value:function(n,l){for(var u=n.length,f=0,o=u-1;o-f>1;){var v=Math.floor((f+o)/2);n[v]>l?o=v:f=v}return l>=n[o]?o:f}}])}(X.PureComponent);Jl(J0,"displayName","Brush");Jl(J0,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var CXe=o4;function IXe(e,t){var r;return CXe(e,function(n,l,u){return r=t(n,l,u),!r}),!!r}var OXe=IXe,kXe=Rse,RXe=Kd,MXe=OXe,DXe=Vl,LXe=Ok;function jXe(e,t,r){var n=DXe(e)?kXe:MXe;return r&&LXe(e,t,r)&&(t=void 0),n(e,RXe(t))}var NXe=jXe;const zXe=zi(NXe);var Vd=function(t,r){var n=t.alwaysShow,l=t.ifOverflow;return n&&(l="extendDomain"),l===r},iX=eae;function FXe(e,t,r){t=="__proto__"&&iX?iX(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var BXe=FXe,$Xe=BXe,VXe=Jse,UXe=Kd;function GXe(e,t){var r={};return t=UXe(t),VXe(e,function(n,l,u){$Xe(r,l,t(n,l,u))}),r}var qXe=GXe;const HXe=zi(qXe);function WXe(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var ZXe=WXe,XXe=o4;function KXe(e,t){var r=!0;return XXe(e,function(n,l,u){return r=!!t(n,l,u),r}),r}var YXe=KXe,JXe=ZXe,QXe=YXe,eKe=Kd,tKe=Vl,rKe=Ok;function nKe(e,t,r){var n=tKe(e)?JXe:QXe;return r&&rKe(e,t,r)&&(t=void 0),n(e,eKe(t))}var iKe=nKe;const qle=zi(iKe);var oKe=["x","y"];function xT(e){"@babel/helpers - typeof";return xT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xT(e)}function kF(){return kF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},kF.apply(this,arguments)}function oX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function p1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oX(Object(r),!0).forEach(function(n){sKe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sKe(e,t,r){return t=aKe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aKe(e){var t=lKe(e,"string");return xT(t)=="symbol"?t:t+""}function lKe(e,t){if(xT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(xT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cKe(e,t){if(e==null)return{};var r=uKe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function uKe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function dKe(e,t){var r=e.x,n=e.y,l=cKe(e,oKe),u="".concat(r),f=parseInt(u,10),o="".concat(n),v=parseInt(o,10),w="".concat(t.height||l.height),P=parseInt(w,10),C="".concat(t.width||l.width),k=parseInt(C,10);return p1(p1(p1(p1(p1({},t),l),f?{x:f}:{}),v?{y:v}:{}),{},{height:P,width:k,name:t.name,radius:t.radius})}function sX(e){return De.createElement(zle,kF({shapeType:"rectangle",propTransformer:dKe,activeClassName:"recharts-active-bar"},e))}var hKe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,l){if(typeof t=="number")return t;var u=fr(n)||zLe(n);return u?t(n,l):(u||gy(),r)}},fKe=["value","background"],Hle;function Q0(e){"@babel/helpers - typeof";return Q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q0(e)}function pKe(e,t){if(e==null)return{};var r=mKe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function mKe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function KI(){return KI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KI.apply(this,arguments)}function aX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function xs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aX(Object(r),!0).forEach(function(n){Ip(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Zle(n.key),n)}}function yKe(e,t,r){return t&&lX(e.prototype,t),r&&lX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function _Ke(e,t,r){return t=YI(t),vKe(e,Wle()?Reflect.construct(t,r||[],YI(e).constructor):t.apply(e,r))}function vKe(e,t){if(t&&(Q0(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xKe(e)}function xKe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wle(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Wle=function(){return!!e})()}function YI(e){return YI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},YI(e)}function bKe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&RF(e,t)}function RF(e,t){return RF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},RF(e,t)}function Ip(e,t,r){return t=Zle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Zle(e){var t=wKe(e,"string");return Q0(t)=="symbol"?t:t+""}function wKe(e,t){if(Q0(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(Q0(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ky=function(e){function t(){var r;gKe(this,t);for(var n=arguments.length,l=new Array(n),u=0;u<n;u++)l[u]=arguments[u];return r=_Ke(this,t,[].concat(l)),Ip(r,"state",{isAnimationFinished:!1}),Ip(r,"id",oE("recharts-bar-")),Ip(r,"handleAnimationEnd",function(){var f=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),f&&f()}),Ip(r,"handleAnimationStart",function(){var f=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),f&&f()}),r}return bKe(t,e),yKe(t,[{key:"renderRectanglesStatically",value:function(n){var l=this,u=this.props,f=u.shape,o=u.dataKey,v=u.activeIndex,w=u.activeBar,P=Pn(this.props,!1);return n&&n.map(function(C,k){var L=k===v,$=L?w:f,j=xs(xs(xs({},P),C),{},{isActive:L,option:$,index:k,dataKey:o,onAnimationStart:l.handleAnimationStart,onAnimationEnd:l.handleAnimationEnd});return De.createElement(Xi,KI({className:"recharts-bar-rectangle"},fy(l.props,C,k),{key:"rectangle-".concat(C==null?void 0:C.x,"-").concat(C==null?void 0:C.y,"-").concat(C==null?void 0:C.value,"-").concat(k)}),De.createElement(sX,j))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,l=this.props,u=l.data,f=l.layout,o=l.isAnimationActive,v=l.animationBegin,w=l.animationDuration,P=l.animationEasing,C=l.animationId,k=this.state.prevData;return De.createElement(rf,{begin:v,duration:w,isActive:o,easing:P,from:{t:0},to:{t:1},key:"bar-".concat(C),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(L){var $=L.t,j=u.map(function(B,U){var q=k&&k[U];if(q){var H=cp(q.x,B.x),te=cp(q.y,B.y),Q=cp(q.width,B.width),ae=cp(q.height,B.height);return xs(xs({},B),{},{x:H($),y:te($),width:Q($),height:ae($)})}if(f==="horizontal"){var ue=cp(0,B.height),me=ue($);return xs(xs({},B),{},{y:B.y+B.height-me,height:me})}var Ce=cp(0,B.width),Fe=Ce($);return xs(xs({},B),{},{width:Fe})});return De.createElement(Xi,null,n.renderRectanglesStatically(j))})}},{key:"renderRectangles",value:function(){var n=this.props,l=n.data,u=n.isAnimationActive,f=this.state.prevData;return u&&l&&l.length&&(!f||!$k(f,l))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(l)}},{key:"renderBackground",value:function(){var n=this,l=this.props,u=l.data,f=l.dataKey,o=l.activeIndex,v=Pn(this.props.background,!1);return u.map(function(w,P){w.value;var C=w.background,k=pKe(w,fKe);if(!C)return null;var L=xs(xs(xs(xs(xs({},k),{},{fill:"#eee"},C),v),fy(n.props,w,P)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:f,index:P,className:"recharts-bar-background-rectangle"});return De.createElement(sX,KI({key:"background-bar-".concat(P),option:n.props.background,isActive:P===o},L))})}},{key:"renderErrorBar",value:function(n,l){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var u=this.props,f=u.data,o=u.xAxis,v=u.yAxis,w=u.layout,P=u.children,C=Kc(P,Gk);if(!C)return null;var k=w==="vertical"?f[0].height/2:f[0].width/2,L=function(B,U){var q=Array.isArray(B.value)?B.value[1]:B.value;return{x:B.x,y:B.y,value:q,errorVal:Va(B,U)}},$={clipPath:n?"url(#clipPath-".concat(l,")"):null};return De.createElement(Xi,$,C.map(function(j){return De.cloneElement(j,{key:"error-bar-".concat(l,"-").concat(j.props.dataKey),data:f,xAxis:o,yAxis:v,layout:w,offset:k,dataPointFormatter:L})}))}},{key:"render",value:function(){var n=this.props,l=n.hide,u=n.data,f=n.className,o=n.xAxis,v=n.yAxis,w=n.left,P=n.top,C=n.width,k=n.height,L=n.isAnimationActive,$=n.background,j=n.id;if(l||!u||!u.length)return null;var B=this.state.isAnimationFinished,U=Gn("recharts-bar",f),q=o&&o.allowDataOverflow,H=v&&v.allowDataOverflow,te=q||H,Q=oi(j)?this.id:j;return De.createElement(Xi,{className:U},q||H?De.createElement("defs",null,De.createElement("clipPath",{id:"clipPath-".concat(Q)},De.createElement("rect",{x:q?w:w-C/2,y:H?P:P-k/2,width:q?C:C*2,height:H?k:k*2}))):null,De.createElement(Xi,{className:"recharts-bar-rectangles",clipPath:te?"url(#clipPath-".concat(Q,")"):null},$?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(te,Q),(!L||B)&&Vp.renderCallByParent(this.props,u))}}],[{key:"getDerivedStateFromProps",value:function(n,l){return n.animationId!==l.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:l.curData}:n.data!==l.curData?{curData:n.data}:null}}])}(X.PureComponent);Hle=ky;Ip(ky,"displayName","Bar");Ip(ky,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!$h.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Ip(ky,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,l=e.bandSize,u=e.xAxis,f=e.yAxis,o=e.xAxisTicks,v=e.yAxisTicks,w=e.stackedData,P=e.dataStartIndex,C=e.displayedData,k=e.offset,L=rHe(n,r);if(!L)return null;var $=t.layout,j=r.type.defaultProps,B=j!==void 0?xs(xs({},j),r.props):r.props,U=B.dataKey,q=B.children,H=B.minPointSize,te=$==="horizontal"?f:u,Q=w?te.scale.domain():null,ae=cHe({numericAxis:te}),ue=Kc(q,kk),me=C.map(function(Ce,Fe){var Ge,Ve,Ze,nt,dt,rt;w?Ge=nHe(w[P+Fe],Q):(Ge=Va(Ce,U),Array.isArray(Ge)||(Ge=[ae,Ge]));var at=hKe(H,Hle.defaultProps.minPointSize)(Ge[1],Fe);if($==="horizontal"){var qe,He=[f.scale(Ge[0]),f.scale(Ge[1])],Et=He[0],Gt=He[1];Ve=Y7({axis:u,ticks:o,bandSize:l,offset:L.offset,entry:Ce,index:Fe}),Ze=(qe=Gt??Et)!==null&&qe!==void 0?qe:void 0,nt=L.size;var Ot=Et-Gt;if(dt=Number.isNaN(Ot)?0:Ot,rt={x:Ve,y:f.y,width:nt,height:f.height},Math.abs(at)>0&&Math.abs(dt)<Math.abs(at)){var $t=gl(dt||at)*(Math.abs(at)-Math.abs(dt));Ze-=$t,dt+=$t}}else{var ur=[u.scale(Ge[0]),u.scale(Ge[1])],Yr=ur[0],hn=ur[1];if(Ve=Yr,Ze=Y7({axis:f,ticks:v,bandSize:l,offset:L.offset,entry:Ce,index:Fe}),nt=hn-Yr,dt=L.size,rt={x:u.x,y:Ze,width:u.width,height:dt},Math.abs(at)>0&&Math.abs(nt)<Math.abs(at)){var rr=gl(nt||at)*(Math.abs(at)-Math.abs(nt));nt+=rr}}return xs(xs(xs({},Ce),{},{x:Ve,y:Ze,width:nt,height:dt,value:w?Ge:Ge[1],payload:Ce,background:rt},ue&&ue[Fe]&&ue[Fe].props),{},{tooltipPayload:[gle(r,Ce)],tooltipPosition:{x:Ve+nt/2,y:Ze+dt/2}})});return xs({data:me,layout:$},k)});function bT(e){"@babel/helpers - typeof";return bT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bT(e)}function SKe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Xle(n.key),n)}}function TKe(e,t,r){return t&&cX(e.prototype,t),r&&cX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function uX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Lu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uX(Object(r),!0).forEach(function(n){Yk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yk(e,t,r){return t=Xle(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Xle(e){var t=EKe(e,"string");return bT(t)=="symbol"?t:t+""}function EKe(e,t){if(bT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(bT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AKe=function(t,r,n,l,u){var f=t.width,o=t.height,v=t.layout,w=t.children,P=Object.keys(r),C={left:n.left,leftMirror:n.left,right:f-n.right,rightMirror:f-n.right,top:n.top,topMirror:n.top,bottom:o-n.bottom,bottomMirror:o-n.bottom},k=!!rc(w,ky);return P.reduce(function(L,$){var j=r[$],B=j.orientation,U=j.domain,q=j.padding,H=q===void 0?{}:q,te=j.mirror,Q=j.reversed,ae="".concat(B).concat(te?"Mirror":""),ue,me,Ce,Fe,Ge;if(j.type==="number"&&(j.padding==="gap"||j.padding==="no-gap")){var Ve=U[1]-U[0],Ze=1/0,nt=j.categoricalDomain.sort($Le);if(nt.forEach(function(ur,Yr){Yr>0&&(Ze=Math.min((ur||0)-(nt[Yr-1]||0),Ze))}),Number.isFinite(Ze)){var dt=Ze/Ve,rt=j.layout==="vertical"?n.height:n.width;if(j.padding==="gap"&&(ue=dt*rt/2),j.padding==="no-gap"){var at=yl(t.barCategoryGap,dt*rt),qe=dt*rt/2;ue=qe-at-(qe-at)/rt*at}}}l==="xAxis"?me=[n.left+(H.left||0)+(ue||0),n.left+n.width-(H.right||0)-(ue||0)]:l==="yAxis"?me=v==="horizontal"?[n.top+n.height-(H.bottom||0),n.top+(H.top||0)]:[n.top+(H.top||0)+(ue||0),n.top+n.height-(H.bottom||0)-(ue||0)]:me=j.range,Q&&(me=[me[1],me[0]]);var He=hle(j,u,k),Et=He.scale,Gt=He.realScaleType;Et.domain(U).range(me),fle(Et);var Ot=ple(Et,Lu(Lu({},j),{},{realScaleType:Gt}));l==="xAxis"?(Ge=B==="top"&&!te||B==="bottom"&&te,Ce=n.left,Fe=C[ae]-Ge*j.height):l==="yAxis"&&(Ge=B==="left"&&!te||B==="right"&&te,Ce=C[ae]-Ge*j.width,Fe=n.top);var $t=Lu(Lu(Lu({},j),Ot),{},{realScaleType:Gt,x:Ce,y:Fe,scale:Et,width:l==="xAxis"?n.width:j.width,height:l==="yAxis"?n.height:j.height});return $t.bandSize=LI($t,Ot),!j.hide&&l==="xAxis"?C[ae]+=(Ge?-1:1)*$t.height:j.hide||(C[ae]+=(Ge?-1:1)*$t.width),Lu(Lu({},L),{},Yk({},$,$t))},{})},Kle=function(t,r){var n=t.x,l=t.y,u=r.x,f=r.y;return{x:Math.min(n,u),y:Math.min(l,f),width:Math.abs(u-n),height:Math.abs(f-l)}},PKe=function(t){var r=t.x1,n=t.y1,l=t.x2,u=t.y2;return Kle({x:r,y:n},{x:l,y:u})},Yle=function(){function e(t){SKe(this,e),this.scale=t}return TKe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=n.bandAware,u=n.position;if(r!==void 0){if(u)switch(u){case"start":return this.scale(r);case"middle":{var f=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+f}case"end":{var o=this.bandwidth?this.bandwidth():0;return this.scale(r)+o}default:return this.scale(r)}if(l){var v=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+v}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),l=n[0],u=n[n.length-1];return l<=u?r>=l&&r<=u:r>=u&&r<=l}}],[{key:"create",value:function(r){return new e(r)}}])}();Yk(Yle,"EPS",1e-4);var L4=function(t){var r=Object.keys(t).reduce(function(n,l){return Lu(Lu({},n),{},Yk({},l,Yle.create(t[l])))},{});return Lu(Lu({},r),{},{apply:function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=u.bandAware,o=u.position;return HXe(l,function(v,w){return r[w].apply(v,{bandAware:f,position:o})})},isInRange:function(l){return qle(l,function(u,f){return r[f].isInRange(u)})}})};function CKe(e){return(e%180+180)%180}var IKe=function(t){var r=t.width,n=t.height,l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=CKe(l),f=u*Math.PI/180,o=Math.atan(n/r),v=f>o&&f<Math.PI-o?n/Math.sin(f):r/Math.cos(f);return Math.abs(v)},OKe=Kd,kKe=sE,RKe=Ck;function MKe(e){return function(t,r,n){var l=Object(t);if(!kKe(t)){var u=OKe(r);t=RKe(t),r=function(o){return u(l[o],o,l)}}var f=e(t,r,n);return f>-1?l[u?t[f]:f]:void 0}}var DKe=MKe,LKe=$le;function jKe(e){var t=LKe(e),r=t%1;return t===t?r?t-r:t:0}var NKe=jKe,zKe=Hse,FKe=Kd,BKe=NKe,$Ke=Math.max;function VKe(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var l=r==null?0:BKe(r);return l<0&&(l=$Ke(n+l,0)),zKe(e,FKe(t),l)}var UKe=VKe,GKe=DKe,qKe=UKe,HKe=GKe(qKe),WKe=HKe;const ZKe=zi(WKe);var XKe=VDe(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),j4=X.createContext(void 0),N4=X.createContext(void 0),Jle=X.createContext(void 0),Qle=X.createContext({}),ece=X.createContext(void 0),tce=X.createContext(0),rce=X.createContext(0),dX=function(t){var r=t.state,n=r.xAxisMap,l=r.yAxisMap,u=r.offset,f=t.clipPathId,o=t.children,v=t.width,w=t.height,P=XKe(u);return De.createElement(j4.Provider,{value:n},De.createElement(N4.Provider,{value:l},De.createElement(Qle.Provider,{value:u},De.createElement(Jle.Provider,{value:P},De.createElement(ece.Provider,{value:f},De.createElement(tce.Provider,{value:w},De.createElement(rce.Provider,{value:v},o)))))))},KKe=function(){return X.useContext(ece)},nce=function(t){var r=X.useContext(j4);r==null&&gy();var n=r[t];return n==null&&gy(),n},YKe=function(){var t=X.useContext(j4);return pp(t)},JKe=function(){var t=X.useContext(N4),r=ZKe(t,function(n){return qle(n.domain,Number.isFinite)});return r||pp(t)},ice=function(t){var r=X.useContext(N4);r==null&&gy();var n=r[t];return n==null&&gy(),n},QKe=function(){var t=X.useContext(Jle);return t},eYe=function(){return X.useContext(Qle)},z4=function(){return X.useContext(rce)},F4=function(){return X.useContext(tce)};function ex(e){"@babel/helpers - typeof";return ex=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ex(e)}function tYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function rYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sce(n.key),n)}}function nYe(e,t,r){return t&&rYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function iYe(e,t,r){return t=JI(t),oYe(e,oce()?Reflect.construct(t,r||[],JI(e).constructor):t.apply(e,r))}function oYe(e,t){if(t&&(ex(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sYe(e)}function sYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oce=function(){return!!e})()}function JI(e){return JI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},JI(e)}function aYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MF(e,t)}function MF(e,t){return MF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},MF(e,t)}function hX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function fX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hX(Object(r),!0).forEach(function(n){B4(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function B4(e,t,r){return t=sce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sce(e){var t=lYe(e,"string");return ex(t)=="symbol"?t:t+""}function lYe(e,t){if(ex(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ex(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cYe(e,t){return fYe(e)||hYe(e,t)||dYe(e,t)||uYe()}function uYe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dYe(e,t){if(e){if(typeof e=="string")return pX(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pX(e,t)}}function pX(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function hYe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function fYe(e){if(Array.isArray(e))return e}function DF(){return DF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},DF.apply(this,arguments)}var pYe=function(t,r){var n;return De.isValidElement(t)?n=De.cloneElement(t,r):Rn(t)?n=t(r):n=De.createElement("line",DF({},r,{className:"recharts-reference-line-line"})),n},mYe=function(t,r,n,l,u,f,o,v,w){var P=u.x,C=u.y,k=u.width,L=u.height;if(n){var $=w.y,j=t.y.apply($,{position:f});if(Vd(w,"discard")&&!t.y.isInRange(j))return null;var B=[{x:P+k,y:j},{x:P,y:j}];return v==="left"?B.reverse():B}if(r){var U=w.x,q=t.x.apply(U,{position:f});if(Vd(w,"discard")&&!t.x.isInRange(q))return null;var H=[{x:q,y:C+L},{x:q,y:C}];return o==="top"?H.reverse():H}if(l){var te=w.segment,Q=te.map(function(ae){return t.apply(ae,{position:f})});return Vd(w,"discard")&&zXe(Q,function(ae){return!t.isInRange(ae)})?null:Q}return null};function gYe(e){var t=e.x,r=e.y,n=e.segment,l=e.xAxisId,u=e.yAxisId,f=e.shape,o=e.className,v=e.alwaysShow,w=KKe(),P=nce(l),C=ice(u),k=QKe();if(!w||!k)return null;Gu(v===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var L=L4({x:P.scale,y:C.scale}),$=Us(t),j=Us(r),B=n&&n.length===2,U=mYe(L,$,j,B,k,e.position,P.orientation,C.orientation,e);if(!U)return null;var q=cYe(U,2),H=q[0],te=H.x,Q=H.y,ae=q[1],ue=ae.x,me=ae.y,Ce=Vd(e,"hidden")?"url(#".concat(w,")"):void 0,Fe=fX(fX({clipPath:Ce},Pn(e,!0)),{},{x1:te,y1:Q,x2:ue,y2:me});return De.createElement(Xi,{className:Gn("recharts-reference-line",o)},pYe(f,Fe),ia.renderCallByParent(e,PKe({x1:te,y1:Q,x2:ue,y2:me})))}var $4=function(e){function t(){return tYe(this,t),iYe(this,t,arguments)}return aYe(t,e),nYe(t,[{key:"render",value:function(){return De.createElement(gYe,this.props)}}])}(De.Component);B4($4,"displayName","ReferenceLine");B4($4,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function LF(){return LF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},LF.apply(this,arguments)}function tx(e){"@babel/helpers - typeof";return tx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tx(e)}function mX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function gX(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mX(Object(r),!0).forEach(function(n){Jk(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _Ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,lce(n.key),n)}}function vYe(e,t,r){return t&&_Ye(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function xYe(e,t,r){return t=QI(t),bYe(e,ace()?Reflect.construct(t,r||[],QI(e).constructor):t.apply(e,r))}function bYe(e,t){if(t&&(tx(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wYe(e)}function wYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ace(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ace=function(){return!!e})()}function QI(e){return QI=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},QI(e)}function SYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jF(e,t)}function jF(e,t){return jF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},jF(e,t)}function Jk(e,t,r){return t=lce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lce(e){var t=TYe(e,"string");return tx(t)=="symbol"?t:t+""}function TYe(e,t){if(tx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(tx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var EYe=function(t){var r=t.x,n=t.y,l=t.xAxis,u=t.yAxis,f=L4({x:l.scale,y:u.scale}),o=f.apply({x:r,y:n},{bandAware:!0});return Vd(t,"discard")&&!f.isInRange(o)?null:o},Qk=function(e){function t(){return yYe(this,t),xYe(this,t,arguments)}return SYe(t,e),vYe(t,[{key:"render",value:function(){var n=this.props,l=n.x,u=n.y,f=n.r,o=n.alwaysShow,v=n.clipPathId,w=Us(l),P=Us(u);if(Gu(o===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!w||!P)return null;var C=EYe(this.props);if(!C)return null;var k=C.x,L=C.y,$=this.props,j=$.shape,B=$.className,U=Vd(this.props,"hidden")?"url(#".concat(v,")"):void 0,q=gX(gX({clipPath:U},Pn(this.props,!0)),{},{cx:k,cy:L});return De.createElement(Xi,{className:Gn("recharts-reference-dot",B)},t.renderDot(j,q),ia.renderCallByParent(this.props,{x:k-f,y:L-f,width:2*f,height:2*f}))}}])}(De.Component);Jk(Qk,"displayName","ReferenceDot");Jk(Qk,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});Jk(Qk,"renderDot",function(e,t){var r;return De.isValidElement(e)?r=De.cloneElement(e,t):Rn(e)?r=e(t):r=De.createElement(D4,LF({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function NF(){return NF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},NF.apply(this,arguments)}function rx(e){"@babel/helpers - typeof";return rx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rx(e)}function yX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function _X(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yX(Object(r),!0).forEach(function(n){eR(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function PYe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uce(n.key),n)}}function CYe(e,t,r){return t&&PYe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function IYe(e,t,r){return t=eO(t),OYe(e,cce()?Reflect.construct(t,r||[],eO(e).constructor):t.apply(e,r))}function OYe(e,t){if(t&&(rx(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return kYe(e)}function kYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cce=function(){return!!e})()}function eO(e){return eO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},eO(e)}function RYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zF(e,t)}function zF(e,t){return zF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},zF(e,t)}function eR(e,t,r){return t=uce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uce(e){var t=MYe(e,"string");return rx(t)=="symbol"?t:t+""}function MYe(e,t){if(rx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(rx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var DYe=function(t,r,n,l,u){var f=u.x1,o=u.x2,v=u.y1,w=u.y2,P=u.xAxis,C=u.yAxis;if(!P||!C)return null;var k=L4({x:P.scale,y:C.scale}),L={x:t?k.x.apply(f,{position:"start"}):k.x.rangeMin,y:n?k.y.apply(v,{position:"start"}):k.y.rangeMin},$={x:r?k.x.apply(o,{position:"end"}):k.x.rangeMax,y:l?k.y.apply(w,{position:"end"}):k.y.rangeMax};return Vd(u,"discard")&&(!k.isInRange(L)||!k.isInRange($))?null:Kle(L,$)},tR=function(e){function t(){return AYe(this,t),IYe(this,t,arguments)}return RYe(t,e),CYe(t,[{key:"render",value:function(){var n=this.props,l=n.x1,u=n.x2,f=n.y1,o=n.y2,v=n.className,w=n.alwaysShow,P=n.clipPathId;Gu(w===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var C=Us(l),k=Us(u),L=Us(f),$=Us(o),j=this.props.shape;if(!C&&!k&&!L&&!$&&!j)return null;var B=DYe(C,k,L,$,this.props);if(!B&&!j)return null;var U=Vd(this.props,"hidden")?"url(#".concat(P,")"):void 0;return De.createElement(Xi,{className:Gn("recharts-reference-area",v)},t.renderRect(j,_X(_X({clipPath:U},Pn(this.props,!0)),B)),ia.renderCallByParent(this.props,B))}}])}(De.Component);eR(tR,"displayName","ReferenceArea");eR(tR,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});eR(tR,"renderRect",function(e,t){var r;return De.isValidElement(e)?r=De.cloneElement(e,t):Rn(e)?r=e(t):r=De.createElement(M4,NF({},t,{className:"recharts-reference-area-rect"})),r});function dce(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],l=0;l<e.length;l+=t)n.push(e[l]);return n}function LYe(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return IKe(n,r)}function jYe(e,t,r){var n=r==="width",l=e.x,u=e.y,f=e.width,o=e.height;return t===1?{start:n?l:u,end:n?l+f:u+o}:{start:n?l+f:u+o,end:n?l:u}}function tO(e,t,r,n,l){if(e*t<e*n||e*t>e*l)return!1;var u=r();return e*(t-e*u/2-n)>=0&&e*(t+e*u/2-l)<=0}function NYe(e,t){return dce(e,t+1)}function zYe(e,t,r,n,l){for(var u=(n||[]).slice(),f=t.start,o=t.end,v=0,w=1,P=f,C=function(){var $=n==null?void 0:n[v];if($===void 0)return{v:dce(n,w)};var j=v,B,U=function(){return B===void 0&&(B=r($,j)),B},q=$.coordinate,H=v===0||tO(e,q,U,P,o);H||(v=0,P=f,w+=1),H&&(P=q+e*(U()/2+l),v+=w)},k;w<=u.length;)if(k=C(),k)return k.v;return[]}function wT(e){"@babel/helpers - typeof";return wT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wT(e)}function vX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Fa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?vX(Object(r),!0).forEach(function(n){FYe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FYe(e,t,r){return t=BYe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BYe(e){var t=$Ye(e,"string");return wT(t)=="symbol"?t:t+""}function $Ye(e,t){if(wT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(wT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function VYe(e,t,r,n,l){for(var u=(n||[]).slice(),f=u.length,o=t.start,v=t.end,w=function(k){var L=u[k],$,j=function(){return $===void 0&&($=r(L,k)),$};if(k===f-1){var B=e*(L.coordinate+e*j()/2-v);u[k]=L=Fa(Fa({},L),{},{tickCoord:B>0?L.coordinate-B*e:L.coordinate})}else u[k]=L=Fa(Fa({},L),{},{tickCoord:L.coordinate});var U=tO(e,L.tickCoord,j,o,v);U&&(v=L.tickCoord-e*(j()/2+l),u[k]=Fa(Fa({},L),{},{isShow:!0}))},P=f-1;P>=0;P--)w(P);return u}function UYe(e,t,r,n,l,u){var f=(n||[]).slice(),o=f.length,v=t.start,w=t.end;if(u){var P=n[o-1],C=r(P,o-1),k=e*(P.coordinate+e*C/2-w);f[o-1]=P=Fa(Fa({},P),{},{tickCoord:k>0?P.coordinate-k*e:P.coordinate});var L=tO(e,P.tickCoord,function(){return C},v,w);L&&(w=P.tickCoord-e*(C/2+l),f[o-1]=Fa(Fa({},P),{},{isShow:!0}))}for(var $=u?o-1:o,j=function(q){var H=f[q],te,Q=function(){return te===void 0&&(te=r(H,q)),te};if(q===0){var ae=e*(H.coordinate-e*Q()/2-v);f[q]=H=Fa(Fa({},H),{},{tickCoord:ae<0?H.coordinate-ae*e:H.coordinate})}else f[q]=H=Fa(Fa({},H),{},{tickCoord:H.coordinate});var ue=tO(e,H.tickCoord,Q,v,w);ue&&(v=H.tickCoord+e*(Q()/2+l),f[q]=Fa(Fa({},H),{},{isShow:!0}))},B=0;B<$;B++)j(B);return f}function V4(e,t,r){var n=e.tick,l=e.ticks,u=e.viewBox,f=e.minTickGap,o=e.orientation,v=e.interval,w=e.tickFormatter,P=e.unit,C=e.angle;if(!l||!l.length||!n)return[];if(fr(v)||$h.isSsr)return NYe(l,typeof v=="number"&&fr(v)?v:0);var k=[],L=o==="top"||o==="bottom"?"width":"height",$=P&&L==="width"?K1(P,{fontSize:t,letterSpacing:r}):{width:0,height:0},j=function(H,te){var Q=Rn(w)?w(H.value,te):H.value;return L==="width"?LYe(K1(Q,{fontSize:t,letterSpacing:r}),$,C):K1(Q,{fontSize:t,letterSpacing:r})[L]},B=l.length>=2?gl(l[1].coordinate-l[0].coordinate):1,U=jYe(u,B,L);return v==="equidistantPreserveStart"?zYe(B,U,j,l,f):(v==="preserveStart"||v==="preserveStartEnd"?k=UYe(B,U,j,l,f,v==="preserveStartEnd"):k=VYe(B,U,j,l,f),k.filter(function(q){return q.isShow}))}var GYe=["viewBox"],qYe=["viewBox"],HYe=["ticks"];function nx(e){"@babel/helpers - typeof";return nx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nx(e)}function Fv(){return Fv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fv.apply(this,arguments)}function xX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Ls(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xX(Object(r),!0).forEach(function(n){U4(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QL(e,t){if(e==null)return{};var r=WYe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function WYe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function ZYe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bX(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fce(n.key),n)}}function XYe(e,t,r){return t&&bX(e.prototype,t),r&&bX(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function KYe(e,t,r){return t=rO(t),YYe(e,hce()?Reflect.construct(t,r||[],rO(e).constructor):t.apply(e,r))}function YYe(e,t){if(t&&(nx(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return JYe(e)}function JYe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hce=function(){return!!e})()}function rO(e){return rO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},rO(e)}function QYe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&FF(e,t)}function FF(e,t){return FF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},FF(e,t)}function U4(e,t,r){return t=fce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fce(e){var t=eJe(e,"string");return nx(t)=="symbol"?t:t+""}function eJe(e,t){if(nx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(nx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Dx=function(e){function t(r){var n;return ZYe(this,t),n=KYe(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return QYe(t,e),XYe(t,[{key:"shouldComponentUpdate",value:function(n,l){var u=n.viewBox,f=QL(n,GYe),o=this.props,v=o.viewBox,w=QL(o,qYe);return!t0(u,v)||!t0(f,w)||!t0(l,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var l=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];l&&this.setState({fontSize:window.getComputedStyle(l).fontSize,letterSpacing:window.getComputedStyle(l).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var l=this.props,u=l.x,f=l.y,o=l.width,v=l.height,w=l.orientation,P=l.tickSize,C=l.mirror,k=l.tickMargin,L,$,j,B,U,q,H=C?-1:1,te=n.tickSize||P,Q=fr(n.tickCoord)?n.tickCoord:n.coordinate;switch(w){case"top":L=$=n.coordinate,B=f+ +!C*v,j=B-H*te,q=j-H*k,U=Q;break;case"left":j=B=n.coordinate,$=u+ +!C*o,L=$-H*te,U=L-H*k,q=Q;break;case"right":j=B=n.coordinate,$=u+ +C*o,L=$+H*te,U=L+H*k,q=Q;break;default:L=$=n.coordinate,B=f+ +C*v,j=B+H*te,q=j+H*k,U=Q;break}return{line:{x1:L,y1:j,x2:$,y2:B},tick:{x:U,y:q}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,l=n.orientation,u=n.mirror,f;switch(l){case"left":f=u?"start":"end";break;case"right":f=u?"end":"start";break;default:f="middle";break}return f}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,l=n.orientation,u=n.mirror,f="end";switch(l){case"left":case"right":f="middle";break;case"top":f=u?"start":"end";break;default:f=u?"end":"start";break}return f}},{key:"renderAxisLine",value:function(){var n=this.props,l=n.x,u=n.y,f=n.width,o=n.height,v=n.orientation,w=n.mirror,P=n.axisLine,C=Ls(Ls(Ls({},Pn(this.props,!1)),Pn(P,!1)),{},{fill:"none"});if(v==="top"||v==="bottom"){var k=+(v==="top"&&!w||v==="bottom"&&w);C=Ls(Ls({},C),{},{x1:l,y1:u+k*o,x2:l+f,y2:u+k*o})}else{var L=+(v==="left"&&!w||v==="right"&&w);C=Ls(Ls({},C),{},{x1:l+L*f,y1:u,x2:l+L*f,y2:u+o})}return De.createElement("line",Fv({},C,{className:Gn("recharts-cartesian-axis-line",dc(P,"className"))}))}},{key:"renderTicks",value:function(n,l,u){var f=this,o=this.props,v=o.tickLine,w=o.stroke,P=o.tick,C=o.tickFormatter,k=o.unit,L=V4(Ls(Ls({},this.props),{},{ticks:n}),l,u),$=this.getTickTextAnchor(),j=this.getTickVerticalAnchor(),B=Pn(this.props,!1),U=Pn(P,!1),q=Ls(Ls({},B),{},{fill:"none"},Pn(v,!1)),H=L.map(function(te,Q){var ae=f.getTickLineCoord(te),ue=ae.line,me=ae.tick,Ce=Ls(Ls(Ls(Ls({textAnchor:$,verticalAnchor:j},B),{},{stroke:"none",fill:w},U),me),{},{index:Q,payload:te,visibleTicksCount:L.length,tickFormatter:C});return De.createElement(Xi,Fv({className:"recharts-cartesian-axis-tick",key:"tick-".concat(te.value,"-").concat(te.coordinate,"-").concat(te.tickCoord)},fy(f.props,te,Q)),v&&De.createElement("line",Fv({},q,ue,{className:Gn("recharts-cartesian-axis-tick-line",dc(v,"className"))})),P&&t.renderTickItem(P,Ce,"".concat(Rn(C)?C(te.value,Q):te.value).concat(k||"")))});return De.createElement("g",{className:"recharts-cartesian-axis-ticks"},H)}},{key:"render",value:function(){var n=this,l=this.props,u=l.axisLine,f=l.width,o=l.height,v=l.ticksGenerator,w=l.className,P=l.hide;if(P)return null;var C=this.props,k=C.ticks,L=QL(C,HYe),$=k;return Rn(v)&&($=k&&k.length>0?v(this.props):v(L)),f<=0||o<=0||!$||!$.length?null:De.createElement(Xi,{className:Gn("recharts-cartesian-axis",w),ref:function(B){n.layerReference=B}},u&&this.renderAxisLine(),this.renderTicks($,this.state.fontSize,this.state.letterSpacing),ia.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,l,u){var f,o=Gn(l.className,"recharts-cartesian-axis-tick-value");return De.isValidElement(n)?f=De.cloneElement(n,Ls(Ls({},l),{},{className:o})):Rn(n)?f=n(Ls(Ls({},l),{},{className:o})):f=De.createElement(py,Fv({},l,{className:"recharts-cartesian-axis-tick-value"}),u),f}}])}(X.Component);U4(Dx,"displayName","CartesianAxis");U4(Dx,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var tJe=["x1","y1","x2","y2","key"],rJe=["offset"];function yy(e){"@babel/helpers - typeof";return yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yy(e)}function wX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function $a(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wX(Object(r),!0).forEach(function(n){nJe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nJe(e,t,r){return t=iJe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iJe(e){var t=oJe(e,"string");return yy(t)=="symbol"?t:t+""}function oJe(e,t){if(yy(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(yy(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Lg(){return Lg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lg.apply(this,arguments)}function SX(e,t){if(e==null)return{};var r=sJe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function sJe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var aJe=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,l=t.x,u=t.y,f=t.width,o=t.height,v=t.ry;return De.createElement("rect",{x:l,y:u,ry:v,width:f,height:o,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function pce(e,t){var r;if(De.isValidElement(e))r=De.cloneElement(e,t);else if(Rn(e))r=e(t);else{var n=t.x1,l=t.y1,u=t.x2,f=t.y2,o=t.key,v=SX(t,tJe),w=Pn(v,!1);w.offset;var P=SX(w,rJe);r=De.createElement("line",Lg({},P,{x1:n,y1:l,x2:u,y2:f,fill:"none",key:o}))}return r}function lJe(e){var t=e.x,r=e.width,n=e.horizontal,l=n===void 0?!0:n,u=e.horizontalPoints;if(!l||!u||!u.length)return null;var f=u.map(function(o,v){var w=$a($a({},e),{},{x1:t,y1:o,x2:t+r,y2:o,key:"line-".concat(v),index:v});return pce(l,w)});return De.createElement("g",{className:"recharts-cartesian-grid-horizontal"},f)}function cJe(e){var t=e.y,r=e.height,n=e.vertical,l=n===void 0?!0:n,u=e.verticalPoints;if(!l||!u||!u.length)return null;var f=u.map(function(o,v){var w=$a($a({},e),{},{x1:o,y1:t,x2:o,y2:t+r,key:"line-".concat(v),index:v});return pce(l,w)});return De.createElement("g",{className:"recharts-cartesian-grid-vertical"},f)}function uJe(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,l=e.y,u=e.width,f=e.height,o=e.horizontalPoints,v=e.horizontal,w=v===void 0?!0:v;if(!w||!t||!t.length)return null;var P=o.map(function(k){return Math.round(k+l-l)}).sort(function(k,L){return k-L});l!==P[0]&&P.unshift(0);var C=P.map(function(k,L){var $=!P[L+1],j=$?l+f-k:P[L+1]-k;if(j<=0)return null;var B=L%t.length;return De.createElement("rect",{key:"react-".concat(L),y:k,x:n,height:j,width:u,stroke:"none",fill:t[B],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return De.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},C)}function dJe(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,l=e.fillOpacity,u=e.x,f=e.y,o=e.width,v=e.height,w=e.verticalPoints;if(!r||!n||!n.length)return null;var P=w.map(function(k){return Math.round(k+u-u)}).sort(function(k,L){return k-L});u!==P[0]&&P.unshift(0);var C=P.map(function(k,L){var $=!P[L+1],j=$?u+o-k:P[L+1]-k;if(j<=0)return null;var B=L%n.length;return De.createElement("rect",{key:"react-".concat(L),x:k,y:f,width:j,height:v,stroke:"none",fill:n[B],fillOpacity:l,className:"recharts-cartesian-grid-bg"})});return De.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},C)}var hJe=function(t,r){var n=t.xAxis,l=t.width,u=t.height,f=t.offset;return dle(V4($a($a($a({},Dx.defaultProps),n),{},{ticks:zh(n,!0),viewBox:{x:0,y:0,width:l,height:u}})),f.left,f.left+f.width,r)},fJe=function(t,r){var n=t.yAxis,l=t.width,u=t.height,f=t.offset;return dle(V4($a($a($a({},Dx.defaultProps),n),{},{ticks:zh(n,!0),viewBox:{x:0,y:0,width:l,height:u}})),f.top,f.top+f.height,r)},fv={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function mce(e){var t,r,n,l,u,f,o=z4(),v=F4(),w=eYe(),P=$a($a({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:fv.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:fv.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:fv.horizontal,horizontalFill:(l=e.horizontalFill)!==null&&l!==void 0?l:fv.horizontalFill,vertical:(u=e.vertical)!==null&&u!==void 0?u:fv.vertical,verticalFill:(f=e.verticalFill)!==null&&f!==void 0?f:fv.verticalFill,x:fr(e.x)?e.x:w.left,y:fr(e.y)?e.y:w.top,width:fr(e.width)?e.width:w.width,height:fr(e.height)?e.height:w.height}),C=P.x,k=P.y,L=P.width,$=P.height,j=P.syncWithTicks,B=P.horizontalValues,U=P.verticalValues,q=YKe(),H=JKe();if(!fr(L)||L<=0||!fr($)||$<=0||!fr(C)||C!==+C||!fr(k)||k!==+k)return null;var te=P.verticalCoordinatesGenerator||hJe,Q=P.horizontalCoordinatesGenerator||fJe,ae=P.horizontalPoints,ue=P.verticalPoints;if((!ae||!ae.length)&&Rn(Q)){var me=B&&B.length,Ce=Q({yAxis:H?$a($a({},H),{},{ticks:me?B:H.ticks}):void 0,width:o,height:v,offset:w},me?!0:j);Gu(Array.isArray(Ce),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(yy(Ce),"]")),Array.isArray(Ce)&&(ae=Ce)}if((!ue||!ue.length)&&Rn(te)){var Fe=U&&U.length,Ge=te({xAxis:q?$a($a({},q),{},{ticks:Fe?U:q.ticks}):void 0,width:o,height:v,offset:w},Fe?!0:j);Gu(Array.isArray(Ge),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(yy(Ge),"]")),Array.isArray(Ge)&&(ue=Ge)}return De.createElement("g",{className:"recharts-cartesian-grid"},De.createElement(aJe,{fill:P.fill,fillOpacity:P.fillOpacity,x:P.x,y:P.y,width:P.width,height:P.height,ry:P.ry}),De.createElement(lJe,Lg({},P,{offset:w,horizontalPoints:ae,xAxis:q,yAxis:H})),De.createElement(cJe,Lg({},P,{offset:w,verticalPoints:ue,xAxis:q,yAxis:H})),De.createElement(uJe,Lg({},P,{horizontalPoints:ae})),De.createElement(dJe,Lg({},P,{verticalPoints:ue})))}mce.displayName="CartesianGrid";function ix(e){"@babel/helpers - typeof";return ix=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ix(e)}function pJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mJe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_ce(n.key),n)}}function gJe(e,t,r){return t&&mJe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function yJe(e,t,r){return t=nO(t),_Je(e,gce()?Reflect.construct(t,r||[],nO(e).constructor):t.apply(e,r))}function _Je(e,t){if(t&&(ix(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vJe(e)}function vJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gce=function(){return!!e})()}function nO(e){return nO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},nO(e)}function xJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BF(e,t)}function BF(e,t){return BF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},BF(e,t)}function yce(e,t,r){return t=_ce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ce(e){var t=bJe(e,"string");return ix(t)=="symbol"?t:t+""}function bJe(e,t){if(ix(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ix(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $F(){return $F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$F.apply(this,arguments)}function wJe(e){var t=e.xAxisId,r=z4(),n=F4(),l=nce(t);return l==null?null:X.createElement(Dx,$F({},l,{className:Gn("recharts-".concat(l.axisType," ").concat(l.axisType),l.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(f){return zh(f,!0)}}))}var rR=function(e){function t(){return pJe(this,t),yJe(this,t,arguments)}return xJe(t,e),gJe(t,[{key:"render",value:function(){return X.createElement(wJe,this.props)}}])}(X.Component);yce(rR,"displayName","XAxis");yce(rR,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function ox(e){"@babel/helpers - typeof";return ox=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ox(e)}function SJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function TJe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bce(n.key),n)}}function EJe(e,t,r){return t&&TJe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function AJe(e,t,r){return t=iO(t),PJe(e,vce()?Reflect.construct(t,r||[],iO(e).constructor):t.apply(e,r))}function PJe(e,t){if(t&&(ox(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return CJe(e)}function CJe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vce(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vce=function(){return!!e})()}function iO(e){return iO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},iO(e)}function IJe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&VF(e,t)}function VF(e,t){return VF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},VF(e,t)}function xce(e,t,r){return t=bce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bce(e){var t=OJe(e,"string");return ox(t)=="symbol"?t:t+""}function OJe(e,t){if(ox(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(ox(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function UF(){return UF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},UF.apply(this,arguments)}var kJe=function(t){var r=t.yAxisId,n=z4(),l=F4(),u=ice(r);return u==null?null:X.createElement(Dx,UF({},u,{className:Gn("recharts-".concat(u.axisType," ").concat(u.axisType),u.className),viewBox:{x:0,y:0,width:n,height:l},ticksGenerator:function(o){return zh(o,!0)}}))},nR=function(e){function t(){return SJe(this,t),AJe(this,t,arguments)}return IJe(t,e),EJe(t,[{key:"render",value:function(){return X.createElement(kJe,this.props)}}])}(X.Component);xce(nR,"displayName","YAxis");xce(nR,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function TX(e){return LJe(e)||DJe(e)||MJe(e)||RJe()}function RJe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MJe(e,t){if(e){if(typeof e=="string")return GF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return GF(e,t)}}function DJe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function LJe(e){if(Array.isArray(e))return GF(e)}function GF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var qF=function(t,r,n,l,u){var f=Kc(t,$4),o=Kc(t,Qk),v=[].concat(TX(f),TX(o)),w=Kc(t,tR),P="".concat(l,"Id"),C=l[0],k=r;if(v.length&&(k=v.reduce(function(j,B){if(B.props[P]===n&&Vd(B.props,"extendDomain")&&fr(B.props[C])){var U=B.props[C];return[Math.min(j[0],U),Math.max(j[1],U)]}return j},k)),w.length){var L="".concat(C,"1"),$="".concat(C,"2");k=w.reduce(function(j,B){if(B.props[P]===n&&Vd(B.props,"extendDomain")&&fr(B.props[L])&&fr(B.props[$])){var U=B.props[L],q=B.props[$];return[Math.min(j[0],U,q),Math.max(j[1],U,q)]}return j},k)}return u&&u.length&&(k=u.reduce(function(j,B){return fr(B)?[Math.min(j[0],B),Math.max(j[1],B)]:j},k)),k},wce={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function l(v,w,P){this.fn=v,this.context=w,this.once=P||!1}function u(v,w,P,C,k){if(typeof P!="function")throw new TypeError("The listener must be a function");var L=new l(P,C||v,k),$=r?r+w:w;return v._events[$]?v._events[$].fn?v._events[$]=[v._events[$],L]:v._events[$].push(L):(v._events[$]=L,v._eventsCount++),v}function f(v,w){--v._eventsCount===0?v._events=new n:delete v._events[w]}function o(){this._events=new n,this._eventsCount=0}o.prototype.eventNames=function(){var w=[],P,C;if(this._eventsCount===0)return w;for(C in P=this._events)t.call(P,C)&&w.push(r?C.slice(1):C);return Object.getOwnPropertySymbols?w.concat(Object.getOwnPropertySymbols(P)):w},o.prototype.listeners=function(w){var P=r?r+w:w,C=this._events[P];if(!C)return[];if(C.fn)return[C.fn];for(var k=0,L=C.length,$=new Array(L);k<L;k++)$[k]=C[k].fn;return $},o.prototype.listenerCount=function(w){var P=r?r+w:w,C=this._events[P];return C?C.fn?1:C.length:0},o.prototype.emit=function(w,P,C,k,L,$){var j=r?r+w:w;if(!this._events[j])return!1;var B=this._events[j],U=arguments.length,q,H;if(B.fn){switch(B.once&&this.removeListener(w,B.fn,void 0,!0),U){case 1:return B.fn.call(B.context),!0;case 2:return B.fn.call(B.context,P),!0;case 3:return B.fn.call(B.context,P,C),!0;case 4:return B.fn.call(B.context,P,C,k),!0;case 5:return B.fn.call(B.context,P,C,k,L),!0;case 6:return B.fn.call(B.context,P,C,k,L,$),!0}for(H=1,q=new Array(U-1);H<U;H++)q[H-1]=arguments[H];B.fn.apply(B.context,q)}else{var te=B.length,Q;for(H=0;H<te;H++)switch(B[H].once&&this.removeListener(w,B[H].fn,void 0,!0),U){case 1:B[H].fn.call(B[H].context);break;case 2:B[H].fn.call(B[H].context,P);break;case 3:B[H].fn.call(B[H].context,P,C);break;case 4:B[H].fn.call(B[H].context,P,C,k);break;default:if(!q)for(Q=1,q=new Array(U-1);Q<U;Q++)q[Q-1]=arguments[Q];B[H].fn.apply(B[H].context,q)}}return!0},o.prototype.on=function(w,P,C){return u(this,w,P,C,!1)},o.prototype.once=function(w,P,C){return u(this,w,P,C,!0)},o.prototype.removeListener=function(w,P,C,k){var L=r?r+w:w;if(!this._events[L])return this;if(!P)return f(this,L),this;var $=this._events[L];if($.fn)$.fn===P&&(!k||$.once)&&(!C||$.context===C)&&f(this,L);else{for(var j=0,B=[],U=$.length;j<U;j++)($[j].fn!==P||k&&!$[j].once||C&&$[j].context!==C)&&B.push($[j]);B.length?this._events[L]=B.length===1?B[0]:B:f(this,L)}return this},o.prototype.removeAllListeners=function(w){var P;return w?(P=r?r+w:w,this._events[P]&&f(this,P)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(wce);var jJe=wce.exports;const NJe=zi(jJe);var ej=new NJe,tj="recharts.syncMouseEvents";function ST(e){"@babel/helpers - typeof";return ST=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ST(e)}function zJe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function FJe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Sce(n.key),n)}}function BJe(e,t,r){return t&&FJe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function rj(e,t,r){return t=Sce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sce(e){var t=$Je(e,"string");return ST(t)=="symbol"?t:t+""}function $Je(e,t){if(ST(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ST(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var VJe=function(){function e(){zJe(this,e),rj(this,"activeIndex",0),rj(this,"coordinateList",[]),rj(this,"layout","horizontal")}return BJe(e,[{key:"setDetails",value:function(r){var n,l=r.coordinateList,u=l===void 0?null:l,f=r.container,o=f===void 0?null:f,v=r.layout,w=v===void 0?null:v,P=r.offset,C=P===void 0?null:P,k=r.mouseHandlerCallback,L=k===void 0?null:k;this.coordinateList=(n=u??this.coordinateList)!==null&&n!==void 0?n:[],this.container=o??this.container,this.layout=w??this.layout,this.offset=C??this.offset,this.mouseHandlerCallback=L??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var l=this.container.getBoundingClientRect(),u=l.x,f=l.y,o=l.height,v=this.coordinateList[this.activeIndex].coordinate,w=((r=window)===null||r===void 0?void 0:r.scrollX)||0,P=((n=window)===null||n===void 0?void 0:n.scrollY)||0,C=u+v+w,k=f+this.offset.top+o/2+P;this.mouseHandlerCallback({pageX:C,pageY:k})}}}])}();function UJe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],l=e==null?void 0:e[1];if(n&&l&&fr(n)&&fr(l))return!0}return!1}function GJe(e,t,r,n){var l=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-l:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-l,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function Tce(e){var t=e.cx,r=e.cy,n=e.radius,l=e.startAngle,u=e.endAngle,f=uo(t,r,n,l),o=uo(t,r,n,u);return{points:[f,o],cx:t,cy:r,radius:n,startAngle:l,endAngle:u}}function qJe(e,t,r){var n,l,u,f;if(e==="horizontal")n=t.x,u=n,l=r.top,f=r.top+r.height;else if(e==="vertical")l=t.y,f=l,n=r.left,u=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var o=t.cx,v=t.cy,w=t.innerRadius,P=t.outerRadius,C=t.angle,k=uo(o,v,w,C),L=uo(o,v,P,C);n=k.x,l=k.y,u=L.x,f=L.y}else return Tce(t);return[{x:n,y:l},{x:u,y:f}]}function TT(e){"@babel/helpers - typeof";return TT=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},TT(e)}function EX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function CP(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?EX(Object(r),!0).forEach(function(n){HJe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):EX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HJe(e,t,r){return t=WJe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WJe(e){var t=ZJe(e,"string");return TT(t)=="symbol"?t:t+""}function ZJe(e,t){if(TT(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(TT(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function XJe(e){var t,r,n=e.element,l=e.tooltipEventType,u=e.isActive,f=e.activeCoordinate,o=e.activePayload,v=e.offset,w=e.activeTooltipIndex,P=e.tooltipAxisBandSize,C=e.layout,k=e.chartName,L=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!L||!u||!f||k!=="ScatterChart"&&l!=="axis")return null;var $,j=pF;if(k==="ScatterChart")$=f,j=A7e;else if(k==="BarChart")$=GJe(C,f,v,P),j=M4;else if(C==="radial"){var B=Tce(f),U=B.cx,q=B.cy,H=B.radius,te=B.startAngle,Q=B.endAngle;$={cx:U,cy:q,startAngle:te,endAngle:Q,innerRadius:H,outerRadius:H},j=wle}else $={points:qJe(C,f,v)},j=pF;var ae=CP(CP(CP(CP({stroke:"#ccc",pointerEvents:"none"},v),$),Pn(L,!1)),{},{payload:o,payloadIndex:w,className:Gn("recharts-tooltip-cursor",L.className)});return X.isValidElement(L)?X.cloneElement(L,ae):X.createElement(j,ae)}var KJe=["item"],YJe=["children","className","width","height","style","compact","title","desc"];function sx(e){"@babel/helpers - typeof";return sx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sx(e)}function Bv(){return Bv=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Bv.apply(this,arguments)}function AX(e,t){return eQe(e)||QJe(e,t)||Ace(e,t)||JJe()}function JJe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QJe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,l,u,f,o=[],v=!0,w=!1;try{if(u=(r=r.call(e)).next,t!==0)for(;!(v=(n=u.call(r)).done)&&(o.push(n.value),o.length!==t);v=!0);}catch(P){w=!0,l=P}finally{try{if(!v&&r.return!=null&&(f=r.return(),Object(f)!==f))return}finally{if(w)throw l}}return o}}function eQe(e){if(Array.isArray(e))return e}function PX(e,t){if(e==null)return{};var r=tQe(e,t),n,l;if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(l=0;l<u.length;l++)n=u[l],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tQe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function rQe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nQe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Pce(n.key),n)}}function iQe(e,t,r){return t&&nQe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function oQe(e,t,r){return t=oO(t),sQe(e,Ece()?Reflect.construct(t,r||[],oO(e).constructor):t.apply(e,r))}function sQe(e,t){if(t&&(sx(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aQe(e)}function aQe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ece(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ece=function(){return!!e})()}function oO(e){return oO=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},oO(e)}function lQe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&HF(e,t)}function HF(e,t){return HF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,l){return n.__proto__=l,n},HF(e,t)}function ax(e){return dQe(e)||uQe(e)||Ace(e)||cQe()}function cQe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ace(e,t){if(e){if(typeof e=="string")return WF(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return WF(e,t)}}function uQe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function dQe(e){if(Array.isArray(e))return WF(e)}function WF(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function CX(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(l){return Object.getOwnPropertyDescriptor(e,l).enumerable})),r.push.apply(r,n)}return r}function Ht(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CX(Object(r),!0).forEach(function(n){xn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CX(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xn(e,t,r){return t=Pce(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pce(e){var t=hQe(e,"string");return sx(t)=="symbol"?t:t+""}function hQe(e,t){if(sx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(sx(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fQe={xAxis:["bottom","top"],yAxis:["left","right"]},pQe={width:"100%",height:"100%"},Cce={x:0,y:0};function IP(e){return e}var mQe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},gQe=function(t,r,n,l){var u=r.find(function(P){return P&&P.index===n});if(u){if(t==="horizontal")return{x:u.coordinate,y:l.y};if(t==="vertical")return{x:l.x,y:u.coordinate};if(t==="centric"){var f=u.coordinate,o=l.radius;return Ht(Ht(Ht({},l),uo(l.cx,l.cy,o,f)),{},{angle:f,radius:o})}var v=u.coordinate,w=l.angle;return Ht(Ht(Ht({},l),uo(l.cx,l.cy,v,w)),{},{angle:w,radius:v})}return Cce},iR=function(t,r){var n=r.graphicalItems,l=r.dataStartIndex,u=r.dataEndIndex,f=(n??[]).reduce(function(o,v){var w=v.props.data;return w&&w.length?[].concat(ax(o),ax(w)):o},[]);return f.length>0?f:t&&t.length&&fr(l)&&fr(u)?t.slice(l,u+1):[]};function Ice(e){return e==="number"?[0,"auto"]:void 0}var ZF=function(t,r,n,l){var u=t.graphicalItems,f=t.tooltipAxis,o=iR(r,t);return n<0||!u||!u.length||n>=o.length?null:u.reduce(function(v,w){var P,C=(P=w.props.data)!==null&&P!==void 0?P:r;C&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(C=C.slice(t.dataStartIndex,t.dataEndIndex+1));var k;if(f.dataKey&&!f.allowDuplicatedCategory){var L=C===void 0?o:C;k=wz(L,f.dataKey,l)}else k=C&&C[n]||o[n];return k?[].concat(ax(v),[gle(w,k)]):v},[])},IX=function(t,r,n,l){var u=l||{x:t.chartX,y:t.chartY},f=mQe(u,n),o=t.orderedTooltipTicks,v=t.tooltipAxis,w=t.tooltipTicks,P=Kqe(f,o,w,v);if(P>=0&&w){var C=w[P]&&w[P].value,k=ZF(t,r,P,C),L=gQe(n,o,P,u);return{activeTooltipIndex:P,activeLabel:C,activePayload:k,activeCoordinate:L}}return null},yQe=function(t,r){var n=r.axes,l=r.graphicalItems,u=r.axisType,f=r.axisIdKey,o=r.stackGroups,v=r.dataStartIndex,w=r.dataEndIndex,P=t.layout,C=t.children,k=t.stackOffset,L=ule(P,u);return n.reduce(function($,j){var B,U=j.type.defaultProps!==void 0?Ht(Ht({},j.type.defaultProps),j.props):j.props,q=U.type,H=U.dataKey,te=U.allowDataOverflow,Q=U.allowDuplicatedCategory,ae=U.scale,ue=U.ticks,me=U.includeHidden,Ce=U[f];if($[Ce])return $;var Fe=iR(t.data,{graphicalItems:l.filter(function(Ot){var $t,ur=f in Ot.props?Ot.props[f]:($t=Ot.type.defaultProps)===null||$t===void 0?void 0:$t[f];return ur===Ce}),dataStartIndex:v,dataEndIndex:w}),Ge=Fe.length,Ve,Ze,nt;UJe(U.domain,te,q)&&(Ve=cF(U.domain,null,te),L&&(q==="number"||ae!=="auto")&&(nt=J1(Fe,H,"category")));var dt=Ice(q);if(!Ve||Ve.length===0){var rt,at=(rt=U.domain)!==null&&rt!==void 0?rt:dt;if(H){if(Ve=J1(Fe,H,q),q==="category"&&L){var qe=BLe(Ve);Q&&qe?(Ze=Ve,Ve=WI(0,Ge)):Q||(Ve=eZ(at,Ve,j).reduce(function(Ot,$t){return Ot.indexOf($t)>=0?Ot:[].concat(ax(Ot),[$t])},[]))}else if(q==="category")Q?Ve=Ve.filter(function(Ot){return Ot!==""&&!oi(Ot)}):Ve=eZ(at,Ve,j).reduce(function(Ot,$t){return Ot.indexOf($t)>=0||$t===""||oi($t)?Ot:[].concat(ax(Ot),[$t])},[]);else if(q==="number"){var He=tHe(Fe,l.filter(function(Ot){var $t,ur,Yr=f in Ot.props?Ot.props[f]:($t=Ot.type.defaultProps)===null||$t===void 0?void 0:$t[f],hn="hide"in Ot.props?Ot.props.hide:(ur=Ot.type.defaultProps)===null||ur===void 0?void 0:ur.hide;return Yr===Ce&&(me||!hn)}),H,u,P);He&&(Ve=He)}L&&(q==="number"||ae!=="auto")&&(nt=J1(Fe,H,"category"))}else L?Ve=WI(0,Ge):o&&o[Ce]&&o[Ce].hasStack&&q==="number"?Ve=k==="expand"?[0,1]:mle(o[Ce].stackGroups,v,w):Ve=cle(Fe,l.filter(function(Ot){var $t=f in Ot.props?Ot.props[f]:Ot.type.defaultProps[f],ur="hide"in Ot.props?Ot.props.hide:Ot.type.defaultProps.hide;return $t===Ce&&(me||!ur)}),q,P,!0);if(q==="number")Ve=qF(C,Ve,Ce,u,ue),at&&(Ve=cF(at,Ve,te));else if(q==="category"&&at){var Et=at,Gt=Ve.every(function(Ot){return Et.indexOf(Ot)>=0});Gt&&(Ve=Et)}}return Ht(Ht({},$),{},xn({},Ce,Ht(Ht({},U),{},{axisType:u,domain:Ve,categoricalDomain:nt,duplicateDomain:Ze,originalDomain:(B=U.domain)!==null&&B!==void 0?B:dt,isCategorical:L,layout:P})))},{})},_Qe=function(t,r){var n=r.graphicalItems,l=r.Axis,u=r.axisType,f=r.axisIdKey,o=r.stackGroups,v=r.dataStartIndex,w=r.dataEndIndex,P=t.layout,C=t.children,k=iR(t.data,{graphicalItems:n,dataStartIndex:v,dataEndIndex:w}),L=k.length,$=ule(P,u),j=-1;return n.reduce(function(B,U){var q=U.type.defaultProps!==void 0?Ht(Ht({},U.type.defaultProps),U.props):U.props,H=q[f],te=Ice("number");if(!B[H]){j++;var Q;return $?Q=WI(0,L):o&&o[H]&&o[H].hasStack?(Q=mle(o[H].stackGroups,v,w),Q=qF(C,Q,H,u)):(Q=cF(te,cle(k,n.filter(function(ae){var ue,me,Ce=f in ae.props?ae.props[f]:(ue=ae.type.defaultProps)===null||ue===void 0?void 0:ue[f],Fe="hide"in ae.props?ae.props.hide:(me=ae.type.defaultProps)===null||me===void 0?void 0:me.hide;return Ce===H&&!Fe}),"number",P),l.defaultProps.allowDataOverflow),Q=qF(C,Q,H,u)),Ht(Ht({},B),{},xn({},H,Ht(Ht({axisType:u},l.defaultProps),{},{hide:!0,orientation:dc(fQe,"".concat(u,".").concat(j%2),null),domain:Q,originalDomain:te,isCategorical:$,layout:P})))}return B},{})},vQe=function(t,r){var n=r.axisType,l=n===void 0?"xAxis":n,u=r.AxisComp,f=r.graphicalItems,o=r.stackGroups,v=r.dataStartIndex,w=r.dataEndIndex,P=t.children,C="".concat(l,"Id"),k=Kc(P,u),L={};return k&&k.length?L=yQe(t,{axes:k,graphicalItems:f,axisType:l,axisIdKey:C,stackGroups:o,dataStartIndex:v,dataEndIndex:w}):f&&f.length&&(L=_Qe(t,{Axis:u,graphicalItems:f,axisType:l,axisIdKey:C,stackGroups:o,dataStartIndex:v,dataEndIndex:w})),L},xQe=function(t){var r=pp(t),n=zh(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:s4(n,function(l){return l.coordinate}),tooltipAxis:r,tooltipAxisBandSize:LI(r,n)}},OX=function(t){var r=t.children,n=t.defaultShowTooltip,l=rc(r,J0),u=0,f=0;return t.data&&t.data.length!==0&&(f=t.data.length-1),l&&l.props&&(l.props.startIndex>=0&&(u=l.props.startIndex),l.props.endIndex>=0&&(f=l.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:u,dataEndIndex:f,activeTooltipIndex:-1,isTooltipActive:!!n}},bQe=function(t){return!t||!t.length?!1:t.some(function(r){var n=Bh(r&&r.type);return n&&n.indexOf("Bar")>=0})},kX=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},wQe=function(t,r){var n=t.props,l=t.graphicalItems,u=t.xAxisMap,f=u===void 0?{}:u,o=t.yAxisMap,v=o===void 0?{}:o,w=n.width,P=n.height,C=n.children,k=n.margin||{},L=rc(C,J0),$=rc(C,r0),j=Object.keys(v).reduce(function(Q,ae){var ue=v[ae],me=ue.orientation;return!ue.mirror&&!ue.hide?Ht(Ht({},Q),{},xn({},me,Q[me]+ue.width)):Q},{left:k.left||0,right:k.right||0}),B=Object.keys(f).reduce(function(Q,ae){var ue=f[ae],me=ue.orientation;return!ue.mirror&&!ue.hide?Ht(Ht({},Q),{},xn({},me,dc(Q,"".concat(me))+ue.height)):Q},{top:k.top||0,bottom:k.bottom||0}),U=Ht(Ht({},B),j),q=U.bottom;L&&(U.bottom+=L.props.height||J0.defaultProps.height),$&&r&&(U=Qqe(U,l,n,r));var H=w-U.left-U.right,te=P-U.top-U.bottom;return Ht(Ht({brushBottom:q},U),{},{width:Math.max(H,0),height:Math.max(te,0)})},SQe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},Oce=function(t){var r=t.chartName,n=t.GraphicalChild,l=t.defaultTooltipEventType,u=l===void 0?"axis":l,f=t.validateTooltipEventTypes,o=f===void 0?["axis"]:f,v=t.axisComponents,w=t.legendContent,P=t.formatAxisMap,C=t.defaultProps,k=function(U,q){var H=q.graphicalItems,te=q.stackGroups,Q=q.offset,ae=q.updateId,ue=q.dataStartIndex,me=q.dataEndIndex,Ce=U.barSize,Fe=U.layout,Ge=U.barGap,Ve=U.barCategoryGap,Ze=U.maxBarSize,nt=kX(Fe),dt=nt.numericAxisName,rt=nt.cateAxisName,at=bQe(H),qe=[];return H.forEach(function(He,Et){var Gt=iR(U.data,{graphicalItems:[He],dataStartIndex:ue,dataEndIndex:me}),Ot=He.type.defaultProps!==void 0?Ht(Ht({},He.type.defaultProps),He.props):He.props,$t=Ot.dataKey,ur=Ot.maxBarSize,Yr=Ot["".concat(dt,"Id")],hn=Ot["".concat(rt,"Id")],rr={},Wr=v.reduce(function(St,Nt){var dr=q["".concat(Nt.axisType,"Map")],nr=Ot["".concat(Nt.axisType,"Id")];dr&&dr[nr]||Nt.axisType==="zAxis"||gy();var er=dr[nr];return Ht(Ht({},St),{},xn(xn({},Nt.axisType,er),"".concat(Nt.axisType,"Ticks"),zh(er)))},rr),Rt=Wr[rt],Yt=Wr["".concat(rt,"Ticks")],ir=te&&te[Yr]&&te[Yr].hasStack&&uHe(He,te[Yr].stackGroups),jt=Bh(He.type).indexOf("Bar")>=0,Ir=LI(Rt,Yt),Xr=[],Vn=at&&Yqe({barSize:Ce,stackGroups:te,totalSize:SQe(Wr,rt)});if(jt){var Hn,ei,Nn=oi(ur)?Ze:ur,ho=(Hn=(ei=LI(Rt,Yt,!0))!==null&&ei!==void 0?ei:Nn)!==null&&Hn!==void 0?Hn:0;Xr=Jqe({barGap:Ge,barCategoryGap:Ve,bandSize:ho!==Ir?ho:Ir,sizeList:Vn[hn],maxBarSize:Nn}),ho!==Ir&&(Xr=Xr.map(function(St){return Ht(Ht({},St),{},{position:Ht(Ht({},St.position),{},{offset:St.position.offset-ho/2})})}))}var ot=He&&He.type&&He.type.getComposedData;ot&&qe.push({props:Ht(Ht({},ot(Ht(Ht({},Wr),{},{displayedData:Gt,props:U,dataKey:$t,item:He,bandSize:Ir,barPosition:Xr,offset:Q,stackedData:ir,layout:Fe,dataStartIndex:ue,dataEndIndex:me}))),{},xn(xn(xn({key:He.key||"item-".concat(Et)},dt,Wr[dt]),rt,Wr[rt]),"animationId",ae)),childIndex:JLe(He,U.children),item:He})}),qe},L=function(U,q){var H=U.props,te=U.dataStartIndex,Q=U.dataEndIndex,ae=U.updateId;if(!WW({props:H}))return null;var ue=H.children,me=H.layout,Ce=H.stackOffset,Fe=H.data,Ge=H.reverseStackOrder,Ve=kX(me),Ze=Ve.numericAxisName,nt=Ve.cateAxisName,dt=Kc(ue,n),rt=lHe(Fe,dt,"".concat(Ze,"Id"),"".concat(nt,"Id"),Ce,Ge),at=v.reduce(function(Ot,$t){var ur="".concat($t.axisType,"Map");return Ht(Ht({},Ot),{},xn({},ur,vQe(H,Ht(Ht({},$t),{},{graphicalItems:dt,stackGroups:$t.axisType===Ze&&rt,dataStartIndex:te,dataEndIndex:Q}))))},{}),qe=wQe(Ht(Ht({},at),{},{props:H,graphicalItems:dt}),q==null?void 0:q.legendBBox);Object.keys(at).forEach(function(Ot){at[Ot]=P(H,at[Ot],qe,Ot.replace("Map",""),r)});var He=at["".concat(nt,"Map")],Et=xQe(He),Gt=k(H,Ht(Ht({},at),{},{dataStartIndex:te,dataEndIndex:Q,updateId:ae,graphicalItems:dt,stackGroups:rt,offset:qe}));return Ht(Ht({formattedGraphicalItems:Gt,graphicalItems:dt,offset:qe,stackGroups:rt},Et),at)},$=function(B){function U(q){var H,te,Q;return rQe(this,U),Q=oQe(this,U,[q]),xn(Q,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),xn(Q,"accessibilityManager",new VJe),xn(Q,"handleLegendBBoxUpdate",function(ae){if(ae){var ue=Q.state,me=ue.dataStartIndex,Ce=ue.dataEndIndex,Fe=ue.updateId;Q.setState(Ht({legendBBox:ae},L({props:Q.props,dataStartIndex:me,dataEndIndex:Ce,updateId:Fe},Ht(Ht({},Q.state),{},{legendBBox:ae}))))}}),xn(Q,"handleReceiveSyncEvent",function(ae,ue,me){if(Q.props.syncId===ae){if(me===Q.eventEmitterSymbol&&typeof Q.props.syncMethod!="function")return;Q.applySyncEvent(ue)}}),xn(Q,"handleBrushChange",function(ae){var ue=ae.startIndex,me=ae.endIndex;if(ue!==Q.state.dataStartIndex||me!==Q.state.dataEndIndex){var Ce=Q.state.updateId;Q.setState(function(){return Ht({dataStartIndex:ue,dataEndIndex:me},L({props:Q.props,dataStartIndex:ue,dataEndIndex:me,updateId:Ce},Q.state))}),Q.triggerSyncEvent({dataStartIndex:ue,dataEndIndex:me})}}),xn(Q,"handleMouseEnter",function(ae){var ue=Q.getMouseInfo(ae);if(ue){var me=Ht(Ht({},ue),{},{isTooltipActive:!0});Q.setState(me),Q.triggerSyncEvent(me);var Ce=Q.props.onMouseEnter;Rn(Ce)&&Ce(me,ae)}}),xn(Q,"triggeredAfterMouseMove",function(ae){var ue=Q.getMouseInfo(ae),me=ue?Ht(Ht({},ue),{},{isTooltipActive:!0}):{isTooltipActive:!1};Q.setState(me),Q.triggerSyncEvent(me);var Ce=Q.props.onMouseMove;Rn(Ce)&&Ce(me,ae)}),xn(Q,"handleItemMouseEnter",function(ae){Q.setState(function(){return{isTooltipActive:!0,activeItem:ae,activePayload:ae.tooltipPayload,activeCoordinate:ae.tooltipPosition||{x:ae.cx,y:ae.cy}}})}),xn(Q,"handleItemMouseLeave",function(){Q.setState(function(){return{isTooltipActive:!1}})}),xn(Q,"handleMouseMove",function(ae){ae.persist(),Q.throttleTriggeredAfterMouseMove(ae)}),xn(Q,"handleMouseLeave",function(ae){Q.throttleTriggeredAfterMouseMove.cancel();var ue={isTooltipActive:!1};Q.setState(ue),Q.triggerSyncEvent(ue);var me=Q.props.onMouseLeave;Rn(me)&&me(ue,ae)}),xn(Q,"handleOuterEvent",function(ae){var ue=YLe(ae),me=dc(Q.props,"".concat(ue));if(ue&&Rn(me)){var Ce,Fe;/.*touch.*/i.test(ue)?Fe=Q.getMouseInfo(ae.changedTouches[0]):Fe=Q.getMouseInfo(ae),me((Ce=Fe)!==null&&Ce!==void 0?Ce:{},ae)}}),xn(Q,"handleClick",function(ae){var ue=Q.getMouseInfo(ae);if(ue){var me=Ht(Ht({},ue),{},{isTooltipActive:!0});Q.setState(me),Q.triggerSyncEvent(me);var Ce=Q.props.onClick;Rn(Ce)&&Ce(me,ae)}}),xn(Q,"handleMouseDown",function(ae){var ue=Q.props.onMouseDown;if(Rn(ue)){var me=Q.getMouseInfo(ae);ue(me,ae)}}),xn(Q,"handleMouseUp",function(ae){var ue=Q.props.onMouseUp;if(Rn(ue)){var me=Q.getMouseInfo(ae);ue(me,ae)}}),xn(Q,"handleTouchMove",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&Q.throttleTriggeredAfterMouseMove(ae.changedTouches[0])}),xn(Q,"handleTouchStart",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&Q.handleMouseDown(ae.changedTouches[0])}),xn(Q,"handleTouchEnd",function(ae){ae.changedTouches!=null&&ae.changedTouches.length>0&&Q.handleMouseUp(ae.changedTouches[0])}),xn(Q,"handleDoubleClick",function(ae){var ue=Q.props.onDoubleClick;if(Rn(ue)){var me=Q.getMouseInfo(ae);ue(me,ae)}}),xn(Q,"handleContextMenu",function(ae){var ue=Q.props.onContextMenu;if(Rn(ue)){var me=Q.getMouseInfo(ae);ue(me,ae)}}),xn(Q,"triggerSyncEvent",function(ae){Q.props.syncId!==void 0&&ej.emit(tj,Q.props.syncId,ae,Q.eventEmitterSymbol)}),xn(Q,"applySyncEvent",function(ae){var ue=Q.props,me=ue.layout,Ce=ue.syncMethod,Fe=Q.state.updateId,Ge=ae.dataStartIndex,Ve=ae.dataEndIndex;if(ae.dataStartIndex!==void 0||ae.dataEndIndex!==void 0)Q.setState(Ht({dataStartIndex:Ge,dataEndIndex:Ve},L({props:Q.props,dataStartIndex:Ge,dataEndIndex:Ve,updateId:Fe},Q.state)));else if(ae.activeTooltipIndex!==void 0){var Ze=ae.chartX,nt=ae.chartY,dt=ae.activeTooltipIndex,rt=Q.state,at=rt.offset,qe=rt.tooltipTicks;if(!at)return;if(typeof Ce=="function")dt=Ce(qe,ae);else if(Ce==="value"){dt=-1;for(var He=0;He<qe.length;He++)if(qe[He].value===ae.activeLabel){dt=He;break}}var Et=Ht(Ht({},at),{},{x:at.left,y:at.top}),Gt=Math.min(Ze,Et.x+Et.width),Ot=Math.min(nt,Et.y+Et.height),$t=qe[dt]&&qe[dt].value,ur=ZF(Q.state,Q.props.data,dt),Yr=qe[dt]?{x:me==="horizontal"?qe[dt].coordinate:Gt,y:me==="horizontal"?Ot:qe[dt].coordinate}:Cce;Q.setState(Ht(Ht({},ae),{},{activeLabel:$t,activeCoordinate:Yr,activePayload:ur,activeTooltipIndex:dt}))}else Q.setState(ae)}),xn(Q,"renderCursor",function(ae){var ue,me=Q.state,Ce=me.isTooltipActive,Fe=me.activeCoordinate,Ge=me.activePayload,Ve=me.offset,Ze=me.activeTooltipIndex,nt=me.tooltipAxisBandSize,dt=Q.getTooltipEventType(),rt=(ue=ae.props.active)!==null&&ue!==void 0?ue:Ce,at=Q.props.layout,qe=ae.key||"_recharts-cursor";return De.createElement(XJe,{key:qe,activeCoordinate:Fe,activePayload:Ge,activeTooltipIndex:Ze,chartName:r,element:ae,isActive:rt,layout:at,offset:Ve,tooltipAxisBandSize:nt,tooltipEventType:dt})}),xn(Q,"renderPolarAxis",function(ae,ue,me){var Ce=dc(ae,"type.axisType"),Fe=dc(Q.state,"".concat(Ce,"Map")),Ge=ae.type.defaultProps,Ve=Ge!==void 0?Ht(Ht({},Ge),ae.props):ae.props,Ze=Fe&&Fe[Ve["".concat(Ce,"Id")]];return X.cloneElement(ae,Ht(Ht({},Ze),{},{className:Gn(Ce,Ze.className),key:ae.key||"".concat(ue,"-").concat(me),ticks:zh(Ze,!0)}))}),xn(Q,"renderPolarGrid",function(ae){var ue=ae.props,me=ue.radialLines,Ce=ue.polarAngles,Fe=ue.polarRadius,Ge=Q.state,Ve=Ge.radiusAxisMap,Ze=Ge.angleAxisMap,nt=pp(Ve),dt=pp(Ze),rt=dt.cx,at=dt.cy,qe=dt.innerRadius,He=dt.outerRadius;return X.cloneElement(ae,{polarAngles:Array.isArray(Ce)?Ce:zh(dt,!0).map(function(Et){return Et.coordinate}),polarRadius:Array.isArray(Fe)?Fe:zh(nt,!0).map(function(Et){return Et.coordinate}),cx:rt,cy:at,innerRadius:qe,outerRadius:He,key:ae.key||"polar-grid",radialLines:me})}),xn(Q,"renderLegend",function(){var ae=Q.state.formattedGraphicalItems,ue=Q.props,me=ue.children,Ce=ue.width,Fe=ue.height,Ge=Q.props.margin||{},Ve=Ce-(Ge.left||0)-(Ge.right||0),Ze=ale({children:me,formattedGraphicalItems:ae,legendWidth:Ve,legendContent:w});if(!Ze)return null;var nt=Ze.item,dt=PX(Ze,KJe);return X.cloneElement(nt,Ht(Ht({},dt),{},{chartWidth:Ce,chartHeight:Fe,margin:Ge,onBBoxUpdate:Q.handleLegendBBoxUpdate}))}),xn(Q,"renderTooltip",function(){var ae,ue=Q.props,me=ue.children,Ce=ue.accessibilityLayer,Fe=rc(me,Du);if(!Fe)return null;var Ge=Q.state,Ve=Ge.isTooltipActive,Ze=Ge.activeCoordinate,nt=Ge.activePayload,dt=Ge.activeLabel,rt=Ge.offset,at=(ae=Fe.props.active)!==null&&ae!==void 0?ae:Ve;return X.cloneElement(Fe,{viewBox:Ht(Ht({},rt),{},{x:rt.left,y:rt.top}),active:at,label:dt,payload:at?nt:[],coordinate:Ze,accessibilityLayer:Ce})}),xn(Q,"renderBrush",function(ae){var ue=Q.props,me=ue.margin,Ce=ue.data,Fe=Q.state,Ge=Fe.offset,Ve=Fe.dataStartIndex,Ze=Fe.dataEndIndex,nt=Fe.updateId;return X.cloneElement(ae,{key:ae.key||"_recharts-brush",onChange:TP(Q.handleBrushChange,ae.props.onChange),data:Ce,x:fr(ae.props.x)?ae.props.x:Ge.left,y:fr(ae.props.y)?ae.props.y:Ge.top+Ge.height+Ge.brushBottom-(me.bottom||0),width:fr(ae.props.width)?ae.props.width:Ge.width,startIndex:Ve,endIndex:Ze,updateId:"brush-".concat(nt)})}),xn(Q,"renderReferenceElement",function(ae,ue,me){if(!ae)return null;var Ce=Q,Fe=Ce.clipPathId,Ge=Q.state,Ve=Ge.xAxisMap,Ze=Ge.yAxisMap,nt=Ge.offset,dt=ae.type.defaultProps||{},rt=ae.props,at=rt.xAxisId,qe=at===void 0?dt.xAxisId:at,He=rt.yAxisId,Et=He===void 0?dt.yAxisId:He;return X.cloneElement(ae,{key:ae.key||"".concat(ue,"-").concat(me),xAxis:Ve[qe],yAxis:Ze[Et],viewBox:{x:nt.left,y:nt.top,width:nt.width,height:nt.height},clipPathId:Fe})}),xn(Q,"renderActivePoints",function(ae){var ue=ae.item,me=ae.activePoint,Ce=ae.basePoint,Fe=ae.childIndex,Ge=ae.isRange,Ve=[],Ze=ue.props.key,nt=ue.item.type.defaultProps!==void 0?Ht(Ht({},ue.item.type.defaultProps),ue.item.props):ue.item.props,dt=nt.activeDot,rt=nt.dataKey,at=Ht(Ht({index:Fe,dataKey:rt,cx:me.x,cy:me.y,r:4,fill:R4(ue.item),strokeWidth:2,stroke:"#fff",payload:me.payload,value:me.value},Pn(dt,!1)),lI(dt));return Ve.push(U.renderActiveDot(dt,at,"".concat(Ze,"-activePoint-").concat(Fe))),Ce?Ve.push(U.renderActiveDot(dt,Ht(Ht({},at),{},{cx:Ce.x,cy:Ce.y}),"".concat(Ze,"-basePoint-").concat(Fe))):Ge&&Ve.push(null),Ve}),xn(Q,"renderGraphicChild",function(ae,ue,me){var Ce=Q.filterFormatItem(ae,ue,me);if(!Ce)return null;var Fe=Q.getTooltipEventType(),Ge=Q.state,Ve=Ge.isTooltipActive,Ze=Ge.tooltipAxis,nt=Ge.activeTooltipIndex,dt=Ge.activeLabel,rt=Q.props.children,at=rc(rt,Du),qe=Ce.props,He=qe.points,Et=qe.isRange,Gt=qe.baseLine,Ot=Ce.item.type.defaultProps!==void 0?Ht(Ht({},Ce.item.type.defaultProps),Ce.item.props):Ce.item.props,$t=Ot.activeDot,ur=Ot.hide,Yr=Ot.activeBar,hn=Ot.activeShape,rr=!!(!ur&&Ve&&at&&($t||Yr||hn)),Wr={};Fe!=="axis"&&at&&at.props.trigger==="click"?Wr={onClick:TP(Q.handleItemMouseEnter,ae.props.onClick)}:Fe!=="axis"&&(Wr={onMouseLeave:TP(Q.handleItemMouseLeave,ae.props.onMouseLeave),onMouseEnter:TP(Q.handleItemMouseEnter,ae.props.onMouseEnter)});var Rt=X.cloneElement(ae,Ht(Ht({},Ce.props),Wr));function Yt(Nt){return typeof Ze.dataKey=="function"?Ze.dataKey(Nt.payload):null}if(rr)if(nt>=0){var ir,jt;if(Ze.dataKey&&!Ze.allowDuplicatedCategory){var Ir=typeof Ze.dataKey=="function"?Yt:"payload.".concat(Ze.dataKey.toString());ir=wz(He,Ir,dt),jt=Et&&Gt&&wz(Gt,Ir,dt)}else ir=He==null?void 0:He[nt],jt=Et&&Gt&&Gt[nt];if(hn||Yr){var Xr=ae.props.activeIndex!==void 0?ae.props.activeIndex:nt;return[X.cloneElement(ae,Ht(Ht(Ht({},Ce.props),Wr),{},{activeIndex:Xr})),null,null]}if(!oi(ir))return[Rt].concat(ax(Q.renderActivePoints({item:Ce,activePoint:ir,basePoint:jt,childIndex:nt,isRange:Et})))}else{var Vn,Hn=(Vn=Q.getItemByXY(Q.state.activeCoordinate))!==null&&Vn!==void 0?Vn:{graphicalItem:Rt},ei=Hn.graphicalItem,Nn=ei.item,ho=Nn===void 0?ae:Nn,ot=ei.childIndex,St=Ht(Ht(Ht({},Ce.props),Wr),{},{activeIndex:ot});return[X.cloneElement(ho,St),null,null]}return Et?[Rt,null,null]:[Rt,null]}),xn(Q,"renderCustomized",function(ae,ue,me){return X.cloneElement(ae,Ht(Ht({key:"recharts-customized-".concat(me)},Q.props),Q.state))}),xn(Q,"renderMap",{CartesianGrid:{handler:IP,once:!0},ReferenceArea:{handler:Q.renderReferenceElement},ReferenceLine:{handler:IP},ReferenceDot:{handler:Q.renderReferenceElement},XAxis:{handler:IP},YAxis:{handler:IP},Brush:{handler:Q.renderBrush,once:!0},Bar:{handler:Q.renderGraphicChild},Line:{handler:Q.renderGraphicChild},Area:{handler:Q.renderGraphicChild},Radar:{handler:Q.renderGraphicChild},RadialBar:{handler:Q.renderGraphicChild},Scatter:{handler:Q.renderGraphicChild},Pie:{handler:Q.renderGraphicChild},Funnel:{handler:Q.renderGraphicChild},Tooltip:{handler:Q.renderCursor,once:!0},PolarGrid:{handler:Q.renderPolarGrid,once:!0},PolarAngleAxis:{handler:Q.renderPolarAxis},PolarRadiusAxis:{handler:Q.renderPolarAxis},Customized:{handler:Q.renderCustomized}}),Q.clipPathId="".concat((H=q.id)!==null&&H!==void 0?H:oE("recharts"),"-clip"),Q.throttleTriggeredAfterMouseMove=sae(Q.triggeredAfterMouseMove,(te=q.throttleDelay)!==null&&te!==void 0?te:1e3/60),Q.state={},Q}return lQe(U,B),iQe(U,[{key:"componentDidMount",value:function(){var H,te;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(H=this.props.margin.left)!==null&&H!==void 0?H:0,top:(te=this.props.margin.top)!==null&&te!==void 0?te:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var H=this.props,te=H.children,Q=H.data,ae=H.height,ue=H.layout,me=rc(te,Du);if(me){var Ce=me.props.defaultIndex;if(!(typeof Ce!="number"||Ce<0||Ce>this.state.tooltipTicks.length-1)){var Fe=this.state.tooltipTicks[Ce]&&this.state.tooltipTicks[Ce].value,Ge=ZF(this.state,Q,Ce,Fe),Ve=this.state.tooltipTicks[Ce].coordinate,Ze=(this.state.offset.top+ae)/2,nt=ue==="horizontal",dt=nt?{x:Ve,y:Ze}:{y:Ve,x:Ze},rt=this.state.formattedGraphicalItems.find(function(qe){var He=qe.item;return He.type.name==="Scatter"});rt&&(dt=Ht(Ht({},dt),rt.props.points[Ce].tooltipPosition),Ge=rt.props.points[Ce].tooltipPayload);var at={activeTooltipIndex:Ce,isTooltipActive:!0,activeLabel:Fe,activePayload:Ge,activeCoordinate:dt};this.setState(at),this.renderCursor(me),this.accessibilityManager.setIndex(Ce)}}}},{key:"getSnapshotBeforeUpdate",value:function(H,te){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==te.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==H.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==H.margin){var Q,ae;this.accessibilityManager.setDetails({offset:{left:(Q=this.props.margin.left)!==null&&Q!==void 0?Q:0,top:(ae=this.props.margin.top)!==null&&ae!==void 0?ae:0}})}return null}},{key:"componentDidUpdate",value:function(H){Tz([rc(H.children,Du)],[rc(this.props.children,Du)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var H=rc(this.props.children,Du);if(H&&typeof H.props.shared=="boolean"){var te=H.props.shared?"axis":"item";return o.indexOf(te)>=0?te:u}return u}},{key:"getMouseInfo",value:function(H){if(!this.container)return null;var te=this.container,Q=te.getBoundingClientRect(),ae=TUe(Q),ue={chartX:Math.round(H.pageX-ae.left),chartY:Math.round(H.pageY-ae.top)},me=Q.width/te.offsetWidth||1,Ce=this.inRange(ue.chartX,ue.chartY,me);if(!Ce)return null;var Fe=this.state,Ge=Fe.xAxisMap,Ve=Fe.yAxisMap,Ze=this.getTooltipEventType(),nt=IX(this.state,this.props.data,this.props.layout,Ce);if(Ze!=="axis"&&Ge&&Ve){var dt=pp(Ge).scale,rt=pp(Ve).scale,at=dt&&dt.invert?dt.invert(ue.chartX):null,qe=rt&&rt.invert?rt.invert(ue.chartY):null;return Ht(Ht({},ue),{},{xValue:at,yValue:qe},nt)}return nt?Ht(Ht({},ue),nt):null}},{key:"inRange",value:function(H,te){var Q=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ae=this.props.layout,ue=H/Q,me=te/Q;if(ae==="horizontal"||ae==="vertical"){var Ce=this.state.offset,Fe=ue>=Ce.left&&ue<=Ce.left+Ce.width&&me>=Ce.top&&me<=Ce.top+Ce.height;return Fe?{x:ue,y:me}:null}var Ge=this.state,Ve=Ge.angleAxisMap,Ze=Ge.radiusAxisMap;if(Ve&&Ze){var nt=pp(Ve);return nZ({x:ue,y:me},nt)}return null}},{key:"parseEventsOfWrapper",value:function(){var H=this.props.children,te=this.getTooltipEventType(),Q=rc(H,Du),ae={};Q&&te==="axis"&&(Q.props.trigger==="click"?ae={onClick:this.handleClick}:ae={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ue=lI(this.props,this.handleOuterEvent);return Ht(Ht({},ue),ae)}},{key:"addListener",value:function(){ej.on(tj,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){ej.removeListener(tj,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(H,te,Q){for(var ae=this.state.formattedGraphicalItems,ue=0,me=ae.length;ue<me;ue++){var Ce=ae[ue];if(Ce.item===H||Ce.props.key===H.key||te===Bh(Ce.item.type)&&Q===Ce.childIndex)return Ce}return null}},{key:"renderClipPath",value:function(){var H=this.clipPathId,te=this.state.offset,Q=te.left,ae=te.top,ue=te.height,me=te.width;return De.createElement("defs",null,De.createElement("clipPath",{id:H},De.createElement("rect",{x:Q,y:ae,height:ue,width:me})))}},{key:"getXScales",value:function(){var H=this.state.xAxisMap;return H?Object.entries(H).reduce(function(te,Q){var ae=AX(Q,2),ue=ae[0],me=ae[1];return Ht(Ht({},te),{},xn({},ue,me.scale))},{}):null}},{key:"getYScales",value:function(){var H=this.state.yAxisMap;return H?Object.entries(H).reduce(function(te,Q){var ae=AX(Q,2),ue=ae[0],me=ae[1];return Ht(Ht({},te),{},xn({},ue,me.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(H){var te;return(te=this.state.xAxisMap)===null||te===void 0||(te=te[H])===null||te===void 0?void 0:te.scale}},{key:"getYScaleByAxisId",value:function(H){var te;return(te=this.state.yAxisMap)===null||te===void 0||(te=te[H])===null||te===void 0?void 0:te.scale}},{key:"getItemByXY",value:function(H){var te=this.state,Q=te.formattedGraphicalItems,ae=te.activeItem;if(Q&&Q.length)for(var ue=0,me=Q.length;ue<me;ue++){var Ce=Q[ue],Fe=Ce.props,Ge=Ce.item,Ve=Ge.type.defaultProps!==void 0?Ht(Ht({},Ge.type.defaultProps),Ge.props):Ge.props,Ze=Bh(Ge.type);if(Ze==="Bar"){var nt=(Fe.data||[]).find(function(qe){return s7e(H,qe)});if(nt)return{graphicalItem:Ce,payload:nt}}else if(Ze==="RadialBar"){var dt=(Fe.data||[]).find(function(qe){return nZ(H,qe)});if(dt)return{graphicalItem:Ce,payload:dt}}else if(Xk(Ce,ae)||Kk(Ce,ae)||_T(Ce,ae)){var rt=ZZe({graphicalItem:Ce,activeTooltipItem:ae,itemData:Ve.data}),at=Ve.activeIndex===void 0?rt:Ve.activeIndex;return{graphicalItem:Ht(Ht({},Ce),{},{childIndex:at}),payload:_T(Ce,ae)?Ve.data[rt]:Ce.props.data[rt]}}}return null}},{key:"render",value:function(){var H=this;if(!WW(this))return null;var te=this.props,Q=te.children,ae=te.className,ue=te.width,me=te.height,Ce=te.style,Fe=te.compact,Ge=te.title,Ve=te.desc,Ze=PX(te,YJe),nt=Pn(Ze,!1);if(Fe)return De.createElement(dX,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},De.createElement(Az,Bv({},nt,{width:ue,height:me,title:Ge,desc:Ve}),this.renderClipPath(),XW(Q,this.renderMap)));if(this.props.accessibilityLayer){var dt,rt;nt.tabIndex=(dt=this.props.tabIndex)!==null&&dt!==void 0?dt:0,nt.role=(rt=this.props.role)!==null&&rt!==void 0?rt:"application",nt.onKeyDown=function(qe){H.accessibilityManager.keyboardEvent(qe)},nt.onFocus=function(){H.accessibilityManager.focus()}}var at=this.parseEventsOfWrapper();return De.createElement(dX,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},De.createElement("div",Bv({className:Gn("recharts-wrapper",ae),style:Ht({position:"relative",cursor:"default",width:ue,height:me},Ce)},at,{ref:function(He){H.container=He}}),De.createElement(Az,Bv({},nt,{width:ue,height:me,title:Ge,desc:Ve,style:pQe}),this.renderClipPath(),XW(Q,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(X.Component);xn($,"displayName",r),xn($,"defaultProps",Ht({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},C)),xn($,"getDerivedStateFromProps",function(B,U){var q=B.dataKey,H=B.data,te=B.children,Q=B.width,ae=B.height,ue=B.layout,me=B.stackOffset,Ce=B.margin,Fe=U.dataStartIndex,Ge=U.dataEndIndex;if(U.updateId===void 0){var Ve=OX(B);return Ht(Ht(Ht({},Ve),{},{updateId:0},L(Ht(Ht({props:B},Ve),{},{updateId:0}),U)),{},{prevDataKey:q,prevData:H,prevWidth:Q,prevHeight:ae,prevLayout:ue,prevStackOffset:me,prevMargin:Ce,prevChildren:te})}if(q!==U.prevDataKey||H!==U.prevData||Q!==U.prevWidth||ae!==U.prevHeight||ue!==U.prevLayout||me!==U.prevStackOffset||!t0(Ce,U.prevMargin)){var Ze=OX(B),nt={chartX:U.chartX,chartY:U.chartY,isTooltipActive:U.isTooltipActive},dt=Ht(Ht({},IX(U,H,ue)),{},{updateId:U.updateId+1}),rt=Ht(Ht(Ht({},Ze),nt),dt);return Ht(Ht(Ht({},rt),L(Ht({props:B},rt),U)),{},{prevDataKey:q,prevData:H,prevWidth:Q,prevHeight:ae,prevLayout:ue,prevStackOffset:me,prevMargin:Ce,prevChildren:te})}if(!Tz(te,U.prevChildren)){var at,qe,He,Et,Gt=rc(te,J0),Ot=Gt&&(at=(qe=Gt.props)===null||qe===void 0?void 0:qe.startIndex)!==null&&at!==void 0?at:Fe,$t=Gt&&(He=(Et=Gt.props)===null||Et===void 0?void 0:Et.endIndex)!==null&&He!==void 0?He:Ge,ur=Ot!==Fe||$t!==Ge,Yr=!oi(H),hn=Yr&&!ur?U.updateId:U.updateId+1;return Ht(Ht({updateId:hn},L(Ht(Ht({props:B},U),{},{updateId:hn,dataStartIndex:Ot,dataEndIndex:$t}),U)),{},{prevChildren:te,dataStartIndex:Ot,dataEndIndex:$t})}return null}),xn($,"renderActiveDot",function(B,U,q){var H;return X.isValidElement(B)?H=X.cloneElement(B,U):Rn(B)?H=B(U):H=De.createElement(D4,U),De.createElement(Xi,{className:"recharts-active-dot",key:q},H)});var j=X.forwardRef(function(U,q){return De.createElement($,Bv({},U,{ref:q}))});return j.displayName=$.displayName,j},TQe=Oce({chartName:"BarChart",GraphicalChild:ky,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:rR},{axisType:"yAxis",AxisComp:nR}],formatAxisMap:AKe}),EQe=Oce({chartName:"PieChart",GraphicalChild:df,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Zk},{axisType:"radiusAxis",AxisComp:Hk}],formatAxisMap:xHe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const pv=["hsl(var(--primary))","hsl(var(--accent))","hsl(var(--success))","hsl(var(--secondary))"];function AQe(){const{user:e}=sf(),{data:t}=$O(),{data:r}=Qc({queryKey:["analytics-events",e==null?void 0:e.id],queryFn:async()=>{if(!e||!(t!=null&&t.length))return[];const{data:j}=await ni.from("events").select("*").in("listing_id",t.map(B=>B.id)).order("created_at",{ascending:!1});return j||[]},enabled:!!e&&!!(t!=null&&t.length)}),n=(r==null?void 0:r.filter(j=>j.event_type==="page_view").length)||0,l=(r==null?void 0:r.filter(j=>j.event_type==="contact_click"||j.event_type==="schedule_showing").length)||0,u=(r==null?void 0:r.filter(j=>j.event_type==="outbound_click").length)||0,f=(t==null?void 0:t.map(j=>({name:j.title.length>20?j.title.substring(0,20)+"...":j.title,views:(r==null?void 0:r.filter(B=>B.listing_id===j.id&&B.event_type==="page_view").length)||0})).sort((j,B)=>B.views-j.views).slice(0,5))||[],o={};r==null||r.forEach(j=>{if(j.referrer)try{const B=new URL(j.referrer).hostname.replace("www.","");o[B]=(o[B]||0)+1}catch{o.Direct=(o.Direct||0)+1}else o.Direct=(o.Direct||0)+1});const v=Object.entries(o).sort((j,B)=>B[1]-j[1]).slice(0,5).map(([j,B])=>({name:j,value:B})),w={};r==null||r.forEach(j=>{const B=j.utm_json;B!=null&&B.utm_source&&(w[B.utm_source]=(w[B.utm_source]||0)+1)});const P=Object.entries(w).sort((j,B)=>B[1]-j[1]).slice(0,5).map(([j,B])=>({name:j,value:B})),C={mobile:0,desktop:0};r==null||r.forEach(j=>{const B=j.device_json;B!=null&&B.type&&(C[B.type]=(C[B.type]||0)+1)});const k=Object.entries(C).map(([j,B])=>({name:j,value:B})),L=(r==null?void 0:r.slice(0,10))||[],$=[{title:"Page Views",value:n,icon:Zv,gradient:"from-primary to-primary/70"},{title:"Contact Clicks",value:l,icon:Mye,gradient:"from-accent to-accent/70"},{title:"Outbound Clicks",value:u,icon:nN,gradient:"from-success to-success/70"},{title:"Conversion Rate",value:`${n>0?(l/n*100).toFixed(1):0}%`,icon:Z3,gradient:"from-secondary to-secondary/70"}];return A.jsx(Jh,{children:A.jsxs("div",{className:"space-y-6",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[A.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[A.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-primary flex items-center justify-center",children:A.jsx(eN,{className:"h-5 w-5 text-primary-foreground"})}),A.jsx("h1",{className:"font-display text-3xl font-bold text-gradient",children:"Analytics"})]}),A.jsx("p",{className:"text-muted-foreground",children:"Track visitor engagement and listing performance"})]}),A.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:$.map((j,B)=>A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:B*.1},children:A.jsx(Ci,{className:"overflow-hidden rounded-3xl border-0 shadow-card hover:shadow-float transition-all duration-300 hover-lift bg-card/80 backdrop-blur-sm",children:A.jsx(Ii,{className:"p-6",children:A.jsxs("div",{className:"flex items-start justify-between",children:[A.jsxs("div",{children:[A.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:j.title}),A.jsx("p",{className:"text-3xl font-bold font-display",children:j.value})]}),A.jsx("div",{className:`h-12 w-12 rounded-2xl bg-gradient-to-br ${j.gradient} flex items-center justify-center shadow-md`,children:A.jsx(j.icon,{className:"h-6 w-6 text-primary-foreground"})})]})})})},j.title))}),A.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Views by Listing"})}),A.jsx(Ii,{className:"p-6",children:f.length>0?A.jsx(H9,{width:"100%",height:300,children:A.jsxs(TQe,{data:f,layout:"vertical",children:[A.jsx(mce,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),A.jsx(rR,{type:"number",stroke:"hsl(var(--muted-foreground))"}),A.jsx(nR,{dataKey:"name",type:"category",width:120,fontSize:12,stroke:"hsl(var(--muted-foreground))"}),A.jsx(Du,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"none",borderRadius:"1rem",boxShadow:"0 10px 40px rgba(0,0,0,0.1)"}}),A.jsx(ky,{dataKey:"views",fill:"hsl(var(--primary))",radius:[0,8,8,0]})]})}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx(eN,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No data yet"})]})})]})}),A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Device Types"})}),A.jsx(Ii,{className:"p-6",children:k.some(j=>j.value>0)?A.jsx(H9,{width:"100%",height:300,children:A.jsxs(EQe,{children:[A.jsx(df,{data:k,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",label:({name:j,percent:B})=>`${j} ${(B*100).toFixed(0)}%`,children:k.map((j,B)=>A.jsx(kk,{fill:pv[B%pv.length]},`cell-${B}`))}),A.jsx(Du,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"none",borderRadius:"1rem",boxShadow:"0 10px 40px rgba(0,0,0,0.1)"}})]})}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx(Zv,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No data yet"})]})})]})}),A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"Top Referrers"})}),A.jsx(Ii,{className:"p-6",children:v.length>0?A.jsx("div",{className:"space-y-4",children:v.map((j,B)=>A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.7+B*.05},className:"flex items-center justify-between p-3 rounded-2xl bg-muted/30 hover:bg-muted/50 transition-all",children:[A.jsx("span",{className:"text-sm font-medium",children:j.name}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${Math.max(j.value/v[0].value*80,20)}px`,backgroundColor:pv[B%pv.length]}}),A.jsx("span",{className:"text-sm font-bold w-10 text-right",children:j.value})]})]},j.name))}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx(nN,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No referrer data yet"})]})})]})}),A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsx(Uo,{className:"font-display",children:"UTM Sources"})}),A.jsx(Ii,{className:"p-6",children:P.length>0?A.jsx("div",{className:"space-y-4",children:P.map((j,B)=>A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.8+B*.05},className:"flex items-center justify-between p-3 rounded-2xl bg-muted/30 hover:bg-muted/50 transition-all",children:[A.jsx("span",{className:"text-sm font-medium",children:j.name}),A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"h-2 rounded-full transition-all",style:{width:`${Math.max(j.value/P[0].value*80,20)}px`,backgroundColor:pv[B%pv.length]}}),A.jsx("span",{className:"text-sm font-bold w-10 text-right",children:j.value})]})]},j.name))}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx($D,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No UTM data yet"})]})})]})})]}),A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsx(Vo,{className:"border-b border-border/50 bg-muted/30",children:A.jsxs(Uo,{className:"font-display flex items-center gap-2",children:[A.jsx($D,{className:"h-5 w-5 text-primary"}),"Recent Activity"]})}),A.jsx(Ii,{className:"p-6",children:L.length>0?A.jsx("div",{className:"space-y-3",children:L.map((j,B)=>{const U=t==null?void 0:t.find(H=>H.id===j.listing_id),q=j.device_json;return A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.9+B*.03},className:"flex items-center justify-between p-4 bg-muted/30 rounded-2xl hover:bg-muted/50 transition-all",children:[A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:A.jsx(Zv,{className:"h-5 w-5 text-primary"})}),A.jsxs("div",{children:[A.jsx("p",{className:"font-medium text-sm",children:j.event_type.replace("_"," ").replace(/\b\w/g,H=>H.toUpperCase())}),A.jsxs("p",{className:"text-xs text-muted-foreground",children:[(U==null?void 0:U.title)||"Unknown listing","  ",(q==null?void 0:q.type)||"Unknown device"]})]})]}),A.jsx("span",{className:"text-xs text-muted-foreground bg-background px-3 py-1.5 rounded-full",children:zC(j.created_at)})]},j.id)})}):A.jsxs("div",{className:"text-center py-12",children:[A.jsx("div",{className:"h-16 w-16 rounded-full bg-muted flex items-center justify-center mx-auto mb-4",children:A.jsx($D,{className:"h-8 w-8 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground",children:"No activity yet"})]})})]})})]})})}var kce={exports:{}},Rce={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lx=X;function PQe(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var CQe=typeof Object.is=="function"?Object.is:PQe,IQe=lx.useState,OQe=lx.useEffect,kQe=lx.useLayoutEffect,RQe=lx.useDebugValue;function MQe(e,t){var r=t(),n=IQe({inst:{value:r,getSnapshot:t}}),l=n[0].inst,u=n[1];return kQe(function(){l.value=r,l.getSnapshot=t,nj(l)&&u({inst:l})},[e,r,t]),OQe(function(){return nj(l)&&u({inst:l}),e(function(){nj(l)&&u({inst:l})})},[e]),RQe(r),r}function nj(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!CQe(e,r)}catch{return!0}}function DQe(e,t){return t()}var LQe=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?DQe:MQe;Rce.useSyncExternalStore=lx.useSyncExternalStore!==void 0?lx.useSyncExternalStore:LQe;kce.exports=Rce;var jQe=kce.exports;function NQe(){return jQe.useSyncExternalStore(zQe,()=>!0,()=>!1)}function zQe(){return()=>{}}var G4="Avatar",[FQe,cet]=$l(G4),[BQe,Mce]=FQe(G4),Dce=X.forwardRef((e,t)=>{const{__scopeAvatar:r,...n}=e,[l,u]=X.useState("idle");return A.jsx(BQe,{scope:r,imageLoadingStatus:l,onImageLoadingStatusChange:u,children:A.jsx(nn.span,{...n,ref:t})})});Dce.displayName=G4;var Lce="AvatarImage",jce=X.forwardRef((e,t)=>{const{__scopeAvatar:r,src:n,onLoadingStatusChange:l=()=>{},...u}=e,f=Mce(Lce,r),o=$Qe(n,u),v=ss(w=>{l(w),f.onImageLoadingStatusChange(w)});return fs(()=>{o!=="idle"&&v(o)},[o,v]),o==="loaded"?A.jsx(nn.img,{...u,ref:t,src:n}):null});jce.displayName=Lce;var Nce="AvatarFallback",zce=X.forwardRef((e,t)=>{const{__scopeAvatar:r,delayMs:n,...l}=e,u=Mce(Nce,r),[f,o]=X.useState(n===void 0);return X.useEffect(()=>{if(n!==void 0){const v=window.setTimeout(()=>o(!0),n);return()=>window.clearTimeout(v)}},[n]),f&&u.imageLoadingStatus!=="loaded"?A.jsx(nn.span,{...l,ref:t}):null});zce.displayName=Nce;function RX(e,t){return e?t?(e.src!==t&&(e.src=t),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function $Qe(e,{referrerPolicy:t,crossOrigin:r}){const n=NQe(),l=X.useRef(null),u=n?(l.current||(l.current=new window.Image),l.current):null,[f,o]=X.useState(()=>RX(u,e));return fs(()=>{o(RX(u,e))},[u,e]),fs(()=>{const v=C=>()=>{o(C)};if(!u)return;const w=v("loaded"),P=v("error");return u.addEventListener("load",w),u.addEventListener("error",P),t&&(u.referrerPolicy=t),typeof r=="string"&&(u.crossOrigin=r),()=>{u.removeEventListener("load",w),u.removeEventListener("error",P)}},[u,r,t]),f}var Fce=Dce,Bce=jce,$ce=zce;const Vce=X.forwardRef(({className:e,...t},r)=>A.jsx(Fce,{ref:r,className:sr("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...t}));Vce.displayName=Fce.displayName;const Uce=X.forwardRef(({className:e,...t},r)=>A.jsx(Bce,{ref:r,className:sr("aspect-square h-full w-full",e),...t}));Uce.displayName=Bce.displayName;const Gce=X.forwardRef(({className:e,...t},r)=>A.jsx($ce,{ref:r,className:sr("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...t}));Gce.displayName=$ce.displayName;function VQe(){var B;const{user:e}=sf(),t=by(),[r,n]=X.useState({name:"",phone:"",email:"",bio:"",zillow_profile_url:"",headshot_url:""}),[l,u]=X.useState(!1),f=X.useRef(null),[o,v]=X.useState({immediate_email:!0,daily_digest:!1,weekly_digest:!1}),{data:w,isLoading:P}=Qc({queryKey:["realtor-profile",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:U,error:q}=await ni.from("realtor_profiles").select("*").eq("id",e.id).single();if(q)throw q;return U},enabled:!!e}),{data:C,isLoading:k}=Qc({queryKey:["notification-settings",e==null?void 0:e.id],queryFn:async()=>{if(!e)return null;const{data:U,error:q}=await ni.from("notification_settings").select("*").eq("user_id",e.id).single();if(q&&q.code!=="PGRST116")throw q;return U},enabled:!!e});X.useEffect(()=>{w&&n({name:w.name||"",phone:w.phone||"",email:w.email||"",bio:w.bio||"",zillow_profile_url:w.zillow_profile_url||"",headshot_url:w.headshot_url||""})},[w]);const L=async U=>{var H;const q=(H=U.target.files)==null?void 0:H[0];if(!(!q||!e)){if(!q.type.startsWith("image/")){Ni.error("Please upload an image file");return}if(q.size>5*1024*1024){Ni.error("Image must be less than 5MB");return}u(!0);try{const te=q.name.split(".").pop(),Q=`${e.id}/headshot.${te}`,{error:ae}=await ni.storage.from("listing-images").upload(Q,q,{upsert:!0});if(ae)throw ae;const{data:ue}=ni.storage.from("listing-images").getPublicUrl(Q),me=`${ue.publicUrl}?t=${Date.now()}`;n(Ce=>({...Ce,headshot_url:me})),await ni.from("realtor_profiles").update({headshot_url:me}).eq("id",e.id),t.invalidateQueries({queryKey:["realtor-profile"]}),Ni.success("Photo uploaded successfully")}catch(te){Ni.error(`Upload failed: ${te.message}`)}finally{u(!1)}}};X.useEffect(()=>{C&&v({immediate_email:C.immediate_email,daily_digest:C.daily_digest,weekly_digest:C.weekly_digest})},[C]);const $=P0({mutationFn:async()=>{if(!e)throw new Error("Not authenticated");const{error:U}=await ni.from("realtor_profiles").update(r).eq("id",e.id);if(U)throw U},onSuccess:()=>{t.invalidateQueries({queryKey:["realtor-profile"]}),Ni.success("Profile saved successfully")},onError:U=>{Ni.error(`Failed to save profile: ${U.message}`)}}),j=P0({mutationFn:async()=>{if(!e)throw new Error("Not authenticated");const{error:U}=await ni.from("notification_settings").upsert({user_id:e.id,...o});if(U)throw U},onSuccess:()=>{t.invalidateQueries({queryKey:["notification-settings"]}),Ni.success("Notification settings saved")},onError:U=>{Ni.error(`Failed to save settings: ${U.message}`)}});return P||k?A.jsx(Jh,{children:A.jsx("div",{className:"flex items-center justify-center py-20",children:A.jsx(Ar.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"h-12 w-12 rounded-full border-4 border-primary border-t-transparent"})})}):A.jsx(Jh,{children:A.jsxs("div",{className:"space-y-6",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[A.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[A.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-primary flex items-center justify-center",children:A.jsx(jJ,{className:"h-5 w-5 text-primary-foreground"})}),A.jsx("h1",{className:"font-display text-3xl font-bold text-gradient",children:"Settings"})]}),A.jsx("p",{className:"text-muted-foreground",children:"Manage your profile and preferences"})]}),A.jsxs(ik,{defaultValue:"profile",className:"space-y-6",children:[A.jsx(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},children:A.jsxs(eE,{className:"rounded-full bg-muted/50 p-1",children:[A.jsxs(Vu,{value:"profile",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(wS,{className:"h-4 w-4 mr-2"}),"Profile"]}),A.jsxs(Vu,{value:"notifications",className:"rounded-full data-[state=active]:bg-background data-[state=active]:shadow-md",children:[A.jsx(SG,{className:"h-4 w-4 mr-2"}),"Notifications"]})]})}),A.jsx(Uu,{value:"profile",children:A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsxs(Vo,{className:"border-b border-border/50 bg-muted/30",children:[A.jsxs(Uo,{className:"font-display flex items-center gap-2",children:[A.jsx(wS,{className:"h-5 w-5 text-primary"}),"Your Profile"]}),A.jsx(Zg,{children:"This information will be displayed on your public listings"})]}),A.jsxs(Ii,{className:"p-6 space-y-6",children:[A.jsxs("div",{className:"flex items-center gap-6",children:[A.jsxs("div",{className:"relative",children:[A.jsxs(Vce,{className:"h-24 w-24 border-4 border-background shadow-lg",children:[A.jsx(Uce,{src:r.headshot_url,alt:r.name}),A.jsx(Gce,{className:"bg-primary/10 text-primary text-2xl font-display",children:((B=r.name)==null?void 0:B.split(" ").map(U=>U[0]).join("").toUpperCase())||"U"})]}),A.jsx("button",{type:"button",onClick:()=>{var U;return(U=f.current)==null?void 0:U.click()},disabled:l,className:"absolute -bottom-1 -right-1 h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center shadow-md hover:scale-105 transition-transform disabled:opacity-50",children:l?A.jsx(Ld,{className:"h-4 w-4 animate-spin"}):A.jsx(mye,{className:"h-4 w-4"})}),A.jsx("input",{ref:f,type:"file",accept:"image/*",onChange:L,className:"hidden"})]}),A.jsxs("div",{children:[A.jsx("p",{className:"font-medium",children:"Profile Photo"}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"This photo will appear on your listings and contact page"}),A.jsxs(fn,{type:"button",variant:"outline",size:"sm",className:"mt-2 rounded-full",onClick:()=>{var U;return(U=f.current)==null?void 0:U.click()},disabled:l,children:[A.jsx(AO,{className:"h-4 w-4 mr-2"}),"Upload Photo"]})]})]}),A.jsxs("div",{className:"border-t border-border pt-6 space-y-4",children:[A.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Name"}),A.jsx(jn,{value:r.name,onChange:U=>n({...r,name:U.target.value}),placeholder:"Your full name",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Phone"}),A.jsx(jn,{value:r.phone,onChange:U=>n({...r,phone:U.target.value}),placeholder:"(555) 123-4567",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Email"}),A.jsx(jn,{type:"email",value:r.email,onChange:U=>n({...r,email:U.target.value}),placeholder:"agent@example.com",className:"rounded-xl"})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Zillow Profile URL"}),A.jsx(jn,{value:r.zillow_profile_url,onChange:U=>n({...r,zillow_profile_url:U.target.value}),placeholder:"https://zillow.com/profile/...",className:"rounded-xl"})]})]}),A.jsxs("div",{className:"space-y-2",children:[A.jsx(Oo,{className:"text-sm font-medium",children:"Bio"}),A.jsx(JT,{value:r.bio,onChange:U=>n({...r,bio:U.target.value}),placeholder:"Tell potential clients about yourself...",className:"min-h-[120px] rounded-xl"})]})]}),A.jsxs(fn,{onClick:()=>$.mutate(),disabled:$.isPending,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift",children:[$.isPending?A.jsx(Ld,{className:"h-4 w-4 mr-2 animate-spin"}):A.jsx(rN,{className:"h-4 w-4 mr-2"}),"Save Profile"]})]})]})})}),A.jsx(Uu,{value:"notifications",children:A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:A.jsxs(Ci,{className:"rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm overflow-hidden",children:[A.jsxs(Vo,{className:"border-b border-border/50 bg-muted/30",children:[A.jsxs(Uo,{className:"font-display flex items-center gap-2",children:[A.jsx(SG,{className:"h-5 w-5 text-primary"}),"Email Notifications"]}),A.jsx(Zg,{children:"Choose when you want to receive email notifications"})]}),A.jsxs(Ii,{className:"p-6 space-y-4",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"flex items-center justify-between p-5 rounded-2xl bg-muted/30 hover:bg-muted/50 transition-all",children:[A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("div",{className:"h-12 w-12 rounded-2xl bg-primary/10 flex items-center justify-center",children:A.jsx(T0,{className:"h-6 w-6 text-primary"})}),A.jsxs("div",{children:[A.jsx("p",{className:"font-medium",children:"Immediate Notifications"}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified immediately when someone views your listing from Zillow or submits a contact form"})]})]}),A.jsx(X1,{checked:o.immediate_email,onCheckedChange:U=>v({...o,immediate_email:U}),className:"data-[state=checked]:bg-primary"})]}),A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"flex items-center justify-between p-5 rounded-2xl bg-muted/30 hover:bg-muted/50 transition-all",children:[A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("div",{className:"h-12 w-12 rounded-2xl bg-accent/10 flex items-center justify-center",children:A.jsx(Y3,{className:"h-6 w-6 text-accent"})}),A.jsxs("div",{children:[A.jsx("p",{className:"font-medium",children:"Daily Digest"}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive a daily summary of all activity on your listings"})]})]}),A.jsx(X1,{checked:o.daily_digest,onCheckedChange:U=>v({...o,daily_digest:U}),className:"data-[state=checked]:bg-accent"})]}),A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.5},className:"flex items-center justify-between p-5 rounded-2xl bg-muted/30 hover:bg-muted/50 transition-all",children:[A.jsxs("div",{className:"flex items-center gap-4",children:[A.jsx("div",{className:"h-12 w-12 rounded-2xl bg-success/10 flex items-center justify-center",children:A.jsx(Z3,{className:"h-6 w-6 text-success"})}),A.jsxs("div",{children:[A.jsx("p",{className:"font-medium",children:"Weekly Digest"}),A.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive a weekly summary with analytics and performance insights"})]})]}),A.jsx(X1,{checked:o.weekly_digest,onCheckedChange:U=>v({...o,weekly_digest:U}),className:"data-[state=checked]:bg-success"})]}),A.jsxs(fn,{onClick:()=>j.mutate(),disabled:j.isPending,className:"rounded-full bg-gradient-primary text-primary-foreground shadow-glow hover:shadow-xl transition-all hover-lift mt-4",children:[j.isPending?A.jsx(Ld,{className:"h-4 w-4 mr-2 animate-spin"}):A.jsx(rN,{className:"h-4 w-4 mr-2"}),"Save Notifications"]})]})]})})})]})]})})}function UQe(){var B;const{user:e}=sf(),t=by(),{data:r}=$O(),[n,l]=X.useState(""),[u,f]=X.useState("all"),[o,v]=X.useState(null),{data:w,isLoading:P}=Qc({queryKey:["admin-contacts",e==null?void 0:e.id],queryFn:async()=>{if(!e||!(r!=null&&r.length))return[];const{data:U,error:q}=await ni.from("contact_requests").select("*").in("listing_id",r.map(H=>H.id)).order("created_at",{ascending:!1});if(q)throw q;return U},enabled:!!e&&!!(r!=null&&r.length)}),C=P0({mutationFn:async({id:U,status:q})=>{const{error:H}=await ni.from("contact_requests").update({status:q}).eq("id",U);if(H)throw H},onSuccess:()=>{t.invalidateQueries({queryKey:["admin-contacts"]}),t.invalidateQueries({queryKey:["recent-contacts"]}),Ni.success("Status updated")},onError:U=>{Ni.error(`Failed to update status: ${U.message}`)}}),k=w==null?void 0:w.filter(U=>{var te;const q=U.name.toLowerCase().includes(n.toLowerCase())||U.email.toLowerCase().includes(n.toLowerCase())||((te=U.message)==null?void 0:te.toLowerCase().includes(n.toLowerCase())),H=u==="all"||U.status===u;return q&&H}),L=U=>{switch(U){case"new":return A.jsxs(Dh,{className:"bg-primary/10 text-primary border-primary/20 rounded-full",children:[A.jsx(Y3,{className:"h-3 w-3 mr-1"}),"New"]});case"contacted":return A.jsxs(Dh,{className:"bg-accent/10 text-accent border-accent/20 rounded-full",children:[A.jsx(K3,{className:"h-3 w-3 mr-1"}),"Contacted"]});case"closed":return A.jsxs(Dh,{className:"bg-muted text-muted-foreground rounded-full",children:[A.jsx(vye,{className:"h-3 w-3 mr-1"}),"Closed"]});default:return A.jsx(Dh,{variant:"secondary",className:"rounded-full",children:U})}},$=U=>U?r==null?void 0:r.find(q=>q.id===U):null,j={total:(w==null?void 0:w.length)||0,new:(w==null?void 0:w.filter(U=>U.status==="new").length)||0,contacted:(w==null?void 0:w.filter(U=>U.status==="contacted").length)||0,closed:(w==null?void 0:w.filter(U=>U.status==="closed").length)||0};return A.jsx(Jh,{children:A.jsxs("div",{className:"space-y-6",children:[A.jsxs(Ar.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},children:[A.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[A.jsx("div",{className:"h-10 w-10 rounded-2xl bg-gradient-primary flex items-center justify-center",children:A.jsx(vS,{className:"h-5 w-5 text-primary-foreground"})}),A.jsx("h1",{className:"font-display text-3xl font-bold text-gradient",children:"Contact Requests"})]}),A.jsx("p",{className:"text-muted-foreground",children:"Manage inquiries from potential buyers"})]}),A.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[{label:"Total",value:j.total,color:"from-primary to-primary/70"},{label:"New",value:j.new,color:"from-primary to-primary/70"},{label:"Contacted",value:j.contacted,color:"from-accent to-accent/70"},{label:"Closed",value:j.closed,color:"from-muted to-muted/70"}].map((U,q)=>A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:q*.1},children:A.jsx(Ci,{className:"rounded-2xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:A.jsxs(Ii,{className:"p-4",children:[A.jsx("p",{className:"text-sm text-muted-foreground",children:U.label}),A.jsx("p",{className:"text-2xl font-bold font-display",children:U.value})]})})},U.label))}),A.jsxs(Ar.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.2},className:"flex flex-col sm:flex-row gap-4",children:[A.jsxs("div",{className:"relative flex-1 max-w-md",children:[A.jsx(bS,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),A.jsx(jn,{placeholder:"Search contacts...",className:"pl-11 rounded-full border-border/50 bg-card/80 backdrop-blur-sm",value:n,onChange:U=>l(U.target.value)})]}),A.jsxs(zc,{value:u,onValueChange:f,children:[A.jsx(ec,{className:"w-full sm:w-40 rounded-full",children:A.jsx(Fc,{placeholder:"Filter by status"})}),A.jsxs(tc,{className:"rounded-2xl",children:[A.jsx(Qr,{value:"all",children:"All Status"}),A.jsx(Qr,{value:"new",children:"New"}),A.jsx(Qr,{value:"contacted",children:"Contacted"}),A.jsx(Qr,{value:"closed",children:"Closed"})]})]})]}),P?A.jsx("div",{className:"space-y-4",children:[1,2,3].map(U=>A.jsx("div",{className:"animate-pulse h-28 bg-muted rounded-3xl"},U))}):k&&k.length>0?A.jsx("div",{className:"space-y-4",children:A.jsx(O0,{mode:"popLayout",children:k.map((U,q)=>{const H=$(U.listing_id);return A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.95},transition:{delay:q*.05},layout:!0,children:A.jsx(Ci,{className:"rounded-3xl border-0 shadow-card hover:shadow-float transition-all duration-300 bg-card/80 backdrop-blur-sm overflow-hidden",children:A.jsx(Ii,{className:"p-0",children:A.jsxs("div",{className:"flex flex-col lg:flex-row",children:[A.jsxs("div",{className:"flex-1 p-5",children:[A.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-3",children:[A.jsxs("div",{className:"flex items-center gap-3",children:[A.jsx("div",{className:"h-11 w-11 rounded-full bg-primary/10 flex items-center justify-center",children:A.jsx(wS,{className:"h-5 w-5 text-primary"})}),A.jsxs("div",{children:[A.jsx("h3",{className:"font-semibold",children:U.name}),A.jsx("p",{className:"text-sm text-muted-foreground",children:U.email})]})]}),A.jsxs("div",{className:"flex items-center gap-2",children:[L(U.status),A.jsx("span",{className:"text-xs text-muted-foreground bg-muted px-2 py-1 rounded-full",children:zC(U.created_at)})]})]}),U.message&&A.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-3",children:U.message}),H&&A.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[A.jsx(Ud,{className:"h-4 w-4"}),A.jsxs("span",{children:["Re: ",H.title]})]})]}),A.jsxs("div",{className:"flex lg:flex-col items-center justify-end gap-2 p-4 bg-muted/30 lg:border-l border-t lg:border-t-0 border-border/50",children:[A.jsxs(fn,{variant:"outline",size:"sm",className:"rounded-full",onClick:()=>v(U),children:[A.jsx(Zv,{className:"h-4 w-4 mr-1"}),"View"]}),A.jsxs(zc,{value:U.status,onValueChange:te=>C.mutate({id:U.id,status:te}),children:[A.jsx(ec,{className:"w-32 rounded-full text-xs h-8",children:A.jsx(Fc,{})}),A.jsxs(tc,{className:"rounded-xl",children:[A.jsx(Qr,{value:"new",children:"New"}),A.jsx(Qr,{value:"contacted",children:"Contacted"}),A.jsx(Qr,{value:"closed",children:"Closed"})]})]})]})]})})})},U.id)})})}):A.jsx(Ar.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:A.jsx(Ci,{className:"py-16 rounded-3xl border-0 shadow-card bg-card/80 backdrop-blur-sm",children:A.jsxs(Ii,{className:"text-center",children:[A.jsx("div",{className:"h-20 w-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-6",children:A.jsx(vS,{className:"h-10 w-10 text-muted-foreground"})}),A.jsx("p",{className:"text-muted-foreground text-lg",children:"No contact requests yet"}),A.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"When potential buyers submit inquiries, they'll appear here."})]})})}),A.jsx(qre,{open:!!o,onOpenChange:()=>v(null),children:A.jsxs(w5,{className:"rounded-3xl max-w-lg",children:[A.jsxs(rI,{children:[A.jsx(W1,{className:"font-display",children:"Contact Details"}),A.jsx(Z1,{children:"View the full inquiry details"})]}),o&&A.jsxs("div",{className:"space-y-4",children:[A.jsxs("div",{className:"flex items-center gap-4 p-4 bg-muted/30 rounded-2xl",children:[A.jsx("div",{className:"h-14 w-14 rounded-full bg-primary/10 flex items-center justify-center",children:A.jsx(wS,{className:"h-7 w-7 text-primary"})}),A.jsxs("div",{children:[A.jsx("h3",{className:"font-semibold text-lg",children:o.name}),A.jsx("p",{className:"text-sm text-muted-foreground",children:zC(o.created_at)})]})]}),A.jsxs("div",{className:"space-y-3",children:[A.jsxs("a",{href:`mailto:${o.email}`,className:"flex items-center gap-3 p-3 rounded-xl hover:bg-muted/50 transition-colors",children:[A.jsx(T0,{className:"h-5 w-5 text-primary"}),A.jsx("span",{children:o.email})]}),o.phone&&A.jsxs("a",{href:`tel:${o.phone}`,className:"flex items-center gap-3 p-3 rounded-xl hover:bg-muted/50 transition-colors",children:[A.jsx(xS,{className:"h-5 w-5 text-primary"}),A.jsx("span",{children:o.phone})]}),$(o.listing_id)&&A.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-muted/30",children:[A.jsx(Ud,{className:"h-5 w-5 text-muted-foreground"}),A.jsxs("span",{className:"text-sm",children:["Interested in: ",A.jsx("strong",{children:(B=$(o.listing_id))==null?void 0:B.title})]})]})]}),o.message&&A.jsxs("div",{className:"p-4 bg-muted/30 rounded-2xl",children:[A.jsx("p",{className:"text-xs uppercase tracking-wider text-muted-foreground mb-2",children:"Message"}),A.jsx("p",{className:"text-sm whitespace-pre-wrap",children:o.message})]}),A.jsxs("div",{className:"flex gap-2 pt-2",children:[A.jsx(fn,{asChild:!0,className:"flex-1 rounded-full bg-gradient-primary text-primary-foreground",children:A.jsxs("a",{href:`mailto:${o.email}`,children:[A.jsx(T0,{className:"h-4 w-4 mr-2"}),"Send Email"]})}),o.phone&&A.jsx(fn,{asChild:!0,variant:"outline",className:"flex-1 rounded-full",children:A.jsxs("a",{href:`tel:${o.phone}`,children:[A.jsx(xS,{className:"h-4 w-4 mr-2"}),"Call"]})})]})]})]})})]})})}const GQe=new exe,qQe=()=>A.jsx(oxe,{client:GQe,children:A.jsx(Y1e,{children:A.jsxs(N0e,{children:[A.jsx(b_e,{}),A.jsx(Q_e,{}),A.jsx(hbe,{children:A.jsxs(obe,{children:[A.jsx(ll,{path:"/",element:A.jsx(YCe,{})}),A.jsx(ll,{path:"/listings",element:A.jsx(JIe,{})}),A.jsx(ll,{path:"/listings/:slug",element:A.jsx(tOe,{})}),A.jsx(ll,{path:"/contact",element:A.jsx(rOe,{})}),A.jsx(ll,{path:"/auth",element:A.jsx(yOe,{})}),A.jsx(ll,{path:"/admin",element:A.jsx(vOe,{})}),A.jsx(ll,{path:"/admin/listings",element:A.jsx(Yke,{})}),A.jsx(ll,{path:"/admin/listings/new",element:A.jsx(MW,{})}),A.jsx(ll,{path:"/admin/listings/:id",element:A.jsx(MW,{})}),A.jsx(ll,{path:"/admin/contacts",element:A.jsx(UQe,{})}),A.jsx(ll,{path:"/admin/import",element:A.jsx(oRe,{})}),A.jsx(ll,{path:"/admin/analytics",element:A.jsx(AQe,{})}),A.jsx(ll,{path:"/admin/settings",element:A.jsx(VQe,{})}),A.jsx(ll,{path:"*",element:A.jsx(_Oe,{})})]})})]})})});rJ(document.getElementById("root")).render(A.jsx(qQe,{}));
